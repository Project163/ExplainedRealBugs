<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:26:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-6738] EstimateSize  is difference with spill file size</title>
                <link>https://issues.apache.org/jira/browse/SPARK-6738</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;ExternalAppendOnlyMap spill 2.2 GB data to disk:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
15/04/07 20:27:37 INFO collection.ExternalAppendOnlyMap: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; 54 spilling in-memory map of 2.2 GB to disk (61 times so far)
15/04/07 20:27:37 INFO collection.ExternalAppendOnlyMap: /data11/yarnenv/local/usercache/spark/appcache/application_1423737010718_40455651/spark-local-20150407202613-4e80/11/temp_local_fdb4a583-5d13-4394-bccb-e1217d5db812
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But the file size is only 2.2M.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ll -h /data11/yarnenv/local/usercache/spark/appcache/application_1423737010718_40455651/spark-local-20150407202613-4e80/11/
total 2.2M
-rw-r----- 1 spark users 2.2M Apr  7 20:27 temp_local_fdb4a583-5d13-4394-bccb-e1217d5db812
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The GC log show that the jvm memory is less than 1GB.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2015-04-07T20:27:08.023+0800: [GC 981981K-&amp;gt;55363K(3961344K), 0.0341720 secs]
2015-04-07T20:27:14.483+0800: [GC 987523K-&amp;gt;53737K(3961344K), 0.0252660 secs]
2015-04-07T20:27:20.793+0800: [GC 985897K-&amp;gt;56370K(3961344K), 0.0606460 secs]
2015-04-07T20:27:27.553+0800: [GC 988530K-&amp;gt;59089K(3961344K), 0.0651840 secs]
2015-04-07T20:27:34.067+0800: [GC 991249K-&amp;gt;62153K(3961344K), 0.0288460 secs]
2015-04-07T20:27:40.180+0800: [GC 994313K-&amp;gt;61344K(3961344K), 0.0388970 secs]
2015-04-07T20:27:46.490+0800: [GC 993504K-&amp;gt;59915K(3961344K), 0.0235150 secs]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The estimateSize  is hugh difference with spill file size, there is a bug in SizeEstimator.visitArray.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12818852">SPARK-6738</key>
            <summary>EstimateSize  is difference with spill file size</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shenhong">shenh062326</assignee>
                                    <reporter username="shenhong">shenh062326</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Apr 2015 09:02:45 +0000</created>
                <updated>Mon, 27 Apr 2015 23:02:18 +0000</updated>
                            <resolved>Mon, 27 Apr 2015 23:02:18 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14482987" author="srowen" created="Tue, 7 Apr 2015 10:44:09 +0000"  >&lt;p&gt;Is that the only file spilled though? I&apos;m not an expert but it looks like lots of files are spilled to here.&lt;/p&gt;</comment>
                            <comment id="14482988" author="srowen" created="Tue, 7 Apr 2015 10:44:45 +0000"  >&lt;p&gt;(Please use the code tag to format output)&lt;/p&gt;</comment>
                            <comment id="14483011" author="shenhong" created="Tue, 7 Apr 2015 11:06:56 +0000"  >&lt;p&gt;Yes, it spill lots of files, but each one has only 1.1M. &lt;/p&gt;</comment>
                            <comment id="14483025" author="srowen" created="Tue, 7 Apr 2015 11:15:40 +0000"  >&lt;p&gt;Do you observe a problem? is it possible that you are looking at unserialized objects in memory but serialized representation on disk? what is the nature of the data? More info would be much more helpful&lt;/p&gt;</comment>
                            <comment id="14483103" author="srowen" created="Tue, 7 Apr 2015 12:37:17 +0000"  >&lt;p&gt;To be clear I am asking how big the data being spilled is in memory. The GC state isnt relevant. That is, are they just compressing 10x on serialization into the files you see? It is not crazy.&lt;/p&gt;</comment>
                            <comment id="14483104" author="shenhong" created="Tue, 7 Apr 2015 12:37:18 +0000"  >&lt;p&gt;I don&apos;t think it&apos;s serialized cause the problem. the input data is a hive table, and the spark job is a spark SQL.&lt;br/&gt;
In the fact, when the log show that spilling in-memory map of 2.2 GB to disk, the file is only 2.2M, and the GC log show the jvm is less than 1GB. the estimateSize also deviation with the jvm memory.&lt;/p&gt;</comment>
                            <comment id="14492274" author="srowen" created="Mon, 13 Apr 2015 11:06:37 +0000"  >&lt;p&gt;We can reopen if there is more detail, but the problem report is focusing on the size of one spill file when there are lots of them. The in-memory size is also not necessarily the on-disk size. I haven&apos;t seen a report of a problem here either, like something that then fails.&lt;/p&gt;</comment>
                            <comment id="14504202" author="shenhong" created="Tue, 21 Apr 2015 02:54:37 +0000"  >&lt;p&gt;There is a bug in SizeEstimator&lt;/p&gt;</comment>
                            <comment id="14504638" author="apachespark" created="Tue, 21 Apr 2015 08:55:36 +0000"  >&lt;p&gt;User &apos;shenh062326&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/5608&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/5608&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14515184" author="srowen" created="Mon, 27 Apr 2015 23:02:18 +0000"  >&lt;p&gt;Resolved by &lt;a href=&quot;https://github.com/apache/spark/pull/5608&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/5608&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 30 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cw9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>