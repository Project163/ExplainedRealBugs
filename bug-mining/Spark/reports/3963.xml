<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:46:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-17243] Spark 2.0 history server summary page gets stuck at &quot;loading history summary&quot; with 10K+ application history</title>
                <link>https://issues.apache.org/jira/browse/SPARK-17243</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The summary page of Spark 2.0 history server web UI keep displaying &quot;Loading history summary...&quot; all the time and crashes the browser when there are more than 10K application history event logs on HDFS. &lt;/p&gt;

&lt;p&gt;I did some investigation, &quot;historypage.js&quot; file sends a REST request to /api/v1/applications endpoint of history server REST endpoint and gets back json response. When there are more than 10K applications inside the event log directory it takes forever to parse them and render the page. When there are only hundreds or thousands of application history it is running fine.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux&lt;/p&gt;</environment>
        <key id="13000165">SPARK-17243</key>
            <summary>Spark 2.0 history server summary page gets stuck at &quot;loading history summary&quot; with 10K+ application history</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ajbozarth">Alex Bozarth</assignee>
                                    <reporter username="wgtmac">Gang Wu</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Aug 2016 20:41:35 +0000</created>
                <updated>Wed, 31 Aug 2016 13:51:21 +0000</updated>
                            <resolved>Tue, 30 Aug 2016 21:35:53 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.1</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>Web UI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15437653" author="srowen" created="Thu, 25 Aug 2016 20:58:12 +0000"  >&lt;p&gt;Related, but not identical: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-15083&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-15083&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15437668" author="ajbozarth" created="Thu, 25 Aug 2016 21:04:35 +0000"  >&lt;p&gt;I&apos;m not sure I agree that this should be a blocker, but I was actually planning on filing a JIRA and starting work on a pr next month (September) that will switch the history server to only load application data when an application ui is opened and only loading application metadata on the initial load of the history server. This is just one of many problems that would be fixed by such a change. I won&apos;t have the bandwidth to start working on it for another week or two though.&lt;/p&gt;

&lt;p&gt;tl;dr I plan to fix this but not until next month&lt;/p&gt;</comment>
                            <comment id="15437673" author="srowen" created="Thu, 25 Aug 2016 21:06:03 +0000"  >&lt;p&gt;Yes, should not be assigned as a Blocker.&lt;/p&gt;</comment>
                            <comment id="15437682" author="ajbozarth" created="Thu, 25 Aug 2016 21:12:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wgtmac&quot; class=&quot;user-hover&quot; rel=&quot;wgtmac&quot;&gt;wgtmac&lt;/a&gt; until this is fixed you can limit the number of applications available by setting &lt;tt&gt;spark.history.retainedApplications&lt;/tt&gt; It limits the apps the history server loads&lt;/p&gt;</comment>
                            <comment id="15437688" author="wgtmac" created="Thu, 25 Aug 2016 21:16:02 +0000"  >&lt;p&gt;Hi Alex, I think in Spark 1.5 history server obtains all application summary metadata directly from class FsHistoryProvider. You can check in HistoryPage.scala. While in Spark 2.0 it deals with JSON string (in historypage.js) which is MUCH slower than before. It may make sense if the old way is used?&lt;/p&gt;</comment>
                            <comment id="15437691" author="wgtmac" created="Thu, 25 Aug 2016 21:17:41 +0000"  >&lt;p&gt;This doesn&apos;t work. This is for the cache of WEB UIs not for the application metadata. The default value is 50 which is small enough.&lt;/p&gt;</comment>
                            <comment id="15437764" author="ajbozarth" created="Thu, 25 Aug 2016 21:49:35 +0000"  >&lt;p&gt;Thanks, that&apos;ll help when I look into it&lt;/p&gt;</comment>
                            <comment id="15437768" author="ajbozarth" created="Thu, 25 Aug 2016 21:50:41 +0000"  >&lt;p&gt;Sorry, my misunderstanding of your problem, I will make sure to keep this in mind once I start my work&lt;/p&gt;</comment>
                            <comment id="15439352" author="stevel@apache.org" created="Fri, 26 Aug 2016 16:31:45 +0000"  >&lt;p&gt;The REST API actually lets you set a time range for querying entries coming back, though not a limit.&lt;/p&gt;

&lt;p&gt;This problem could presumably be addressed in a couple of ways&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;add a &lt;tt&gt;limit&lt;/tt&gt; argument to the REST API, declaring the max #of responses to return&lt;/li&gt;
	&lt;li&gt;leave the REST API alone but tweak the client code to work backwards from now to try and get a range. That&apos;s more convoluted and is probably brittle to clocks.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;strategy #1 is simpler and would avoid the server being overloaded from large requests made directly by arbitrary callers &#8212;that serialization is going to be expensive too, and an easy to way to bring the history server down.&lt;/p&gt;</comment>
                            <comment id="15439470" author="ajbozarth" created="Fri, 26 Aug 2016 17:58:35 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt;, this idea is great. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wgtmac&quot; class=&quot;user-hover&quot; rel=&quot;wgtmac&quot;&gt;wgtmac&lt;/a&gt;, based on this I might be able to get a small fix for this out next week instead of waiting to include it in my larger update next month.&lt;/p&gt;</comment>
                            <comment id="15439517" author="wgtmac" created="Fri, 26 Aug 2016 18:22:05 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ajbozarth&quot; class=&quot;user-hover&quot; rel=&quot;ajbozarth&quot;&gt;ajbozarth&lt;/a&gt;! Let me know when it is done.&lt;/p&gt;</comment>
                            <comment id="15439799" author="ajbozarth" created="Fri, 26 Aug 2016 20:43:40 +0000"  >&lt;p&gt;So I decided to work on this as a short break from my current work and I have a fix that just requires some final testing before I open a pr, should be open by EOD.&lt;/p&gt;</comment>
                            <comment id="15439857" author="apachespark" created="Fri, 26 Aug 2016 21:08:07 +0000"  >&lt;p&gt;User &apos;ajbozarth&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/14835&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14835&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15447099" author="wgtmac" created="Mon, 29 Aug 2016 21:28:32 +0000"  >&lt;p&gt;I&apos;ve test this PR. It indeed reduces the number of application metadata list. I think it intends to restrict only the summary page; jobs that are dropped from summary web ui should still be available via its URL like &lt;a href=&quot;http://x.x.x.x:18080/history/application_id/jobs&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://x.x.x.x:18080/history/application_id/jobs&lt;/a&gt;. However, those dropped ones cannot be accessed. This may heavily decrease the usability of history server.&lt;/p&gt;</comment>
                            <comment id="15447112" author="ajbozarth" created="Mon, 29 Aug 2016 21:35:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wgtmac&quot; class=&quot;user-hover&quot; rel=&quot;wgtmac&quot;&gt;wgtmac&lt;/a&gt; I&apos;m not sure which version of the pr you tested, in my initial commit the issue you saw still existed but I updated it EOD Friday to switch to a version that only restricts the summary display, leaving all the applications available via their direct url as you would expect.&lt;/p&gt;</comment>
                            <comment id="15447172" author="wgtmac" created="Mon, 29 Aug 2016 21:54:56 +0000"  >&lt;p&gt;I imported the last change. I can get all application list from rest endpoint /api/v1/applications, (without limit parameter). However, the web UI indicates the app_id is not found when I specify the app_id. I can get it using spark 1.5 history server. &lt;/p&gt;</comment>
                            <comment id="15447266" author="ajbozarth" created="Mon, 29 Aug 2016 22:33:15 +0000"  >&lt;p&gt;that&apos;s odd, how long did you wait before accessing the app url? because the history server still needs to propagate after starting and that can take a long time, I was testing with a limit of 50 and testing an app in the thousands and it took about 5min to propagate for me to see it&lt;/p&gt;</comment>
                            <comment id="15447285" author="wgtmac" created="Mon, 29 Aug 2016 22:42:03 +0000"  >&lt;p&gt;Yup you&apos;re right. I finally got some app_ids that were not in the summary page but their urls can be accessed. Our cluster has 100K+ app_ids so it took me a long time to figure it out. Thanks for your help!&lt;/p&gt;</comment>
                            <comment id="15448732" author="stevel@apache.org" created="Tue, 30 Aug 2016 10:55:56 +0000"  >&lt;p&gt;One thing to consider here whether there are any ways to improve incremental loading of histories; start at the most recent and work backwards.&lt;/p&gt;

&lt;p&gt;There&apos;s also the fact that the entire history is loaded just to get the final summary info (success/failure). Once parsed once, this could just be saved in a summary file alongside the original. That&apos;d reduce load time from O(files * events) to O(files)&lt;/p&gt;</comment>
                            <comment id="15449250" author="tgraves" created="Tue, 30 Aug 2016 15:02:10 +0000"  >&lt;p&gt;I agree, there are a ton of ways to improve the history server. I think these should be separate jiras though. Ideally it is much faster to load all the apps and get the initial list very quickly. Only load the entire application as a user requests or in the background to fill the cache.   Like you mention could have summary file written after loaded.  They could be stored differently so basic data is in dir or file path (like MapReduce history server), etc.  I just haven&apos;t had time to do this myself.&lt;/p&gt;

&lt;p&gt;Right now this seems like a good workaround and as I mention in Pr  spark.history.retainedApplications used to do this limiting in of the display but things have changed and I guess it broke/wasn&apos;t updated.&lt;/p&gt;</comment>
                            <comment id="15449790" author="ajbozarth" created="Tue, 30 Aug 2016 18:43:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tgraves&quot; class=&quot;user-hover&quot; rel=&quot;tgraves&quot;&gt;tgraves&lt;/a&gt; The issues you mentioned are what I&apos;m hoping to work on next month (what I mentioned above) when I&apos;m given the bandwidth to do so. When that comes I&apos;ll file a JIRA and loop you two in to discuss implementation ideas. (Unless some brave soul decides to give it a try before then)&lt;/p&gt;</comment>
                            <comment id="15450270" author="apachespark" created="Tue, 30 Aug 2016 21:59:08 +0000"  >&lt;p&gt;User &apos;ajbozarth&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/14886&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14886&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 11 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32t7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>