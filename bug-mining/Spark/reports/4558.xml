<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:51:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-19618] Inconsistency wrt max. buckets allowed from Dataframe API vs SQL</title>
                <link>https://issues.apache.org/jira/browse/SPARK-19618</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;High number of buckets is allowed while creating a table via SQL query:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sparkSession.sql(&quot;&quot;&quot;
CREATE TABLE bucketed_table(col1 INT) USING parquet 
CLUSTERED BY (col1) SORTED BY (col1) INTO 147483647 BUCKETS
&quot;&quot;&quot;)

sparkSession.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;DESC FORMATTED bucketed_table&quot;&lt;/span&gt;).collect.foreach(println)
....
[Num Buckets:,147483647,]
[Bucket Columns:,[col1],]
[Sort Columns:,[col1],]
....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Trying the same via dataframe API does not work:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt; df.write.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;orc&quot;&lt;/span&gt;).bucketBy(147483647, &lt;span class=&quot;code-quote&quot;&gt;&quot;j&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;k&quot;&lt;/span&gt;).sortBy(&lt;span class=&quot;code-quote&quot;&gt;&quot;j&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;k&quot;&lt;/span&gt;).saveAsTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;bucketed_table&quot;&lt;/span&gt;)

java.lang.IllegalArgumentException: requirement failed: Bucket number must be greater than 0 and less than 100000.
  at scala.Predef$.require(Predef.scala:224)
  at org.apache.spark.sql.DataFrameWriter$$anonfun$getBucketSpec$2.apply(DataFrameWriter.scala:293)
  at org.apache.spark.sql.DataFrameWriter$$anonfun$getBucketSpec$2.apply(DataFrameWriter.scala:291)
  at scala.Option.map(Option.scala:146)
  at org.apache.spark.sql.DataFrameWriter.getBucketSpec(DataFrameWriter.scala:291)
  at org.apache.spark.sql.DataFrameWriter.createTable(DataFrameWriter.scala:429)
  at org.apache.spark.sql.DataFrameWriter.saveAsTable(DataFrameWriter.scala:410)
  at org.apache.spark.sql.DataFrameWriter.saveAsTable(DataFrameWriter.scala:365)
  ... 50 elided
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13043443">SPARK-19618</key>
            <summary>Inconsistency wrt max. buckets allowed from Dataframe API vs SQL</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tejasp">Tejas Patil</assignee>
                                    <reporter username="tejasp">Tejas Patil</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Feb 2017 01:44:37 +0000</created>
                <updated>Sun, 13 May 2018 17:47:14 +0000</updated>
                            <resolved>Thu, 16 Feb 2017 06:46:36 +0000</resolved>
                                    <version>2.1.0</version>
                                    <fixVersion>2.2.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15868963" author="apachespark" created="Thu, 16 Feb 2017 01:50:04 +0000"  >&lt;p&gt;User &apos;tejasapatil&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/16948&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/16948&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15869341" author="cloud_fan" created="Thu, 16 Feb 2017 06:46:36 +0000"  >&lt;p&gt;Issue resolved by pull request 16948&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/16948&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/16948&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16438822" author="ferdonline" created="Sun, 15 Apr 2018 19:57:56 +0000"  >&lt;p&gt;Is there any technological problem in using more than 100k buckets? Otherwise what about making it configurable?&lt;/p&gt;

&lt;p&gt;We have an&#160;80TB workload and to keep partitions &quot;manageable&quot; we do need to use a large number of buckets. While it might seem a lot today it is expected that workloads will continue to increase in size...&lt;/p&gt;</comment>
                            <comment id="16438912" author="cloud_fan" created="Mon, 16 Apr 2018 01:34:19 +0000"  >&lt;p&gt;making it configurable sounds like a good idea, can you open a JIRA for it? thanks!&lt;/p&gt;</comment>
                            <comment id="16440085" author="ferdonline" created="Mon, 16 Apr 2018 22:01:31 +0000"  >&lt;p&gt;Opened&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-23997&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;SPARK-23997&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="16473584" author="ferdonline" created="Sun, 13 May 2018 17:47:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt; I have created the Jira and an implementation to lift the limit via a configuration option. Internally we are forced to use our mod, and it would be nice to get in sync with&#160;upstream again at some point. It is a very small&#160;patch in the end. Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 27 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3a58f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>