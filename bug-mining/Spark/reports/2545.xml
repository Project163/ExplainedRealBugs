<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:33:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-10858] YARN: archives/jar/files rename with # doesn&apos;t work unless scheme given</title>
                <link>https://issues.apache.org/jira/browse/SPARK-10858</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The YARN distributed cache feature with --jars, --archives, --files where you can rename the file/archive using a # symbol only works if you explicitly include the scheme in the path:&lt;/p&gt;

&lt;p&gt;works:&lt;br/&gt;
--jars &lt;a href=&quot;file:///home/foo/my.jar#renamed.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:///home/foo/my.jar#renamed.jar&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;doesn&apos;t work:&lt;br/&gt;
--jars /home/foo/my.jar#renamed.jar&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.io.FileNotFoundException: File &lt;a href=&quot;file:/home/foo/my.jar#renamed.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/home/foo/my.jar#renamed.jar&lt;/a&gt; does not exist&lt;br/&gt;
        at org.apache.hadoop.fs.RawLocalFileSystem.deprecatedGetFileStatus(RawLocalFileSystem.java:534)&lt;br/&gt;
        at org.apache.hadoop.fs.RawLocalFileSystem.getFileLinkStatusInternal(RawLocalFileSystem.java:747)&lt;br/&gt;
        at org.apache.hadoop.fs.RawLocalFileSystem.getFileStatus(RawLocalFileSystem.java:524)&lt;br/&gt;
        at org.apache.hadoop.fs.FilterFileSystem.getFileStatus(FilterFileSystem.java:416)&lt;br/&gt;
        at org.apache.hadoop.fs.FileUtil.copy(FileUtil.java:337)&lt;br/&gt;
        at org.apache.hadoop.fs.FileUtil.copy(FileUtil.java:289)&lt;br/&gt;
        at org.apache.spark.deploy.yarn.Client.copyFileToRemote(Client.scala:240)&lt;br/&gt;
        at org.apache.spark.deploy.yarn.Client.org$apache$spark$deploy$yarn$Client$$distribute$1(Client.scala:329)&lt;br/&gt;
        at org.apache.spark.deploy.yarn.Client$$anonfun$prepareLocalResources$6$$anonfun$apply$2.apply(Client.scala:393)&lt;br/&gt;
        at org.apache.spark.deploy.yarn.Client$$anonfun$prepareLocalResources$6$$anonfun$apply$2.apply(Client.scala:392)&lt;br/&gt;
        at scala.collection.IndexedSeqOptimized$class.foreach(IndexedSeqOptimized.scala:33)&lt;br/&gt;
        at scala.collection.mutable.ArrayOps$ofRef.foreach(ArrayOps.scala:108)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12901099">SPARK-10858</key>
            <summary>YARN: archives/jar/files rename with # doesn&apos;t work unless scheme given</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tgraves">Thomas Graves</assignee>
                                    <reporter username="tgraves">Thomas Graves</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Sep 2015 18:22:09 +0000</created>
                <updated>Fri, 9 Oct 2015 21:23:33 +0000</updated>
                            <resolved>Fri, 9 Oct 2015 21:23:33 +0000</resolved>
                                    <version>1.5.1</version>
                                    <fixVersion>1.5.2</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14934531" author="srowen" created="Tue, 29 Sep 2015 02:45:33 +0000"  >&lt;p&gt;Is that such a bad thing? it seems specific to the file scheme?&lt;/p&gt;</comment>
                            <comment id="14934724" author="jerryshao" created="Tue, 29 Sep 2015 06:36:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tgraves&quot; class=&quot;user-hover&quot; rel=&quot;tgraves&quot;&gt;tgraves&lt;/a&gt;, I assume you&apos;re using yarn-cluster mode to submit application, because the way of yarn-client to deal with &lt;tt&gt;--jars&lt;/tt&gt; is different and the stack shall be different.&lt;/p&gt;

&lt;p&gt;The interesting thing is that I get the opposite result compared to yours. I succeed without added scheme, but failed with scheme added, here are my two commands:&lt;/p&gt;

&lt;p&gt;success:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;./bin/spark-submit --master yarn-cluster --queue a --jars /Users/sshao/projects/apache-spark/my.jar\#renamed.jar  --&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.spark.examples.SparkPi examples/target/scala-2.10/spark-examples-1.6.0-SNAPSHOT-hadoop2.6.0.jar 10
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;failed:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;./bin/spark-submit --master yarn-cluster --queue a --jars file:&lt;span class=&quot;code-comment&quot;&gt;///Users/sshao/projects/apache-spark/my.jar#renamed.jar  --&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.spark.examples.SparkPi examples/target/scala-2.10/spark-examples-1.6.0-SNAPSHOT-hadoop2.6.0.jar 10&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="14935129" author="tgraves" created="Tue, 29 Sep 2015 13:05:56 +0000"  >&lt;p&gt;yes its a bad thing as users don&apos;t know when # works.  It should work in all cases, &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file://&lt;/a&gt;, hdfs://. The default is &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file://&lt;/a&gt; so I would expect it to act the same whether you specify the scheme or not since that is the default.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt;  what was the error you got in the failed case?  You escaped the # in the first case and not the second. what platform are you on?&lt;/p&gt;

&lt;p&gt;I was assuming it was failing when the scheme was explicit because we are using getFragment() for perhaps it wasn&apos;t fully parsing the URI without the scheme.&lt;/p&gt;</comment>
                            <comment id="14935134" author="tgraves" created="Tue, 29 Sep 2015 13:09:19 +0000"  >&lt;p&gt;Note the # is the name that we give it on the yarn side that the executor actually see so it doesn&apos;t matter where the file is originating from (&lt;a href=&quot;file://&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file://&lt;/a&gt; or hdfs://).&lt;/p&gt;</comment>
                            <comment id="14936174" author="jerryshao" created="Wed, 30 Sep 2015 00:48:44 +0000"  >&lt;p&gt;The error I got in the failed case is the same as you mentioned above, I&apos;m running on Mac OS with Hadoop 2.6.0.&lt;/p&gt;</comment>
                            <comment id="14936313" author="jerryshao" created="Wed, 30 Sep 2015 03:24:15 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tgraves&quot; class=&quot;user-hover&quot; rel=&quot;tgraves&quot;&gt;tgraves&lt;/a&gt;, I tested again with Mac and Linux (centos).&lt;/p&gt;


&lt;p&gt;if we use &lt;tt&gt;--jars my.jar#renamed.jar&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;this file path will be resolved to URI &lt;tt&gt;&lt;a href=&quot;file:/Users/sshao/projects/apache-spark/my.jar%23renamed.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/Users/sshao/projects/apache-spark/my.jar%23renamed.jar&lt;/a&gt;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;if we use &lt;tt&gt;--jars &lt;a href=&quot;file:///Users/sshao/projects/apache-spark/my.jar#renamed.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:///Users/sshao/projects/apache-spark/my.jar#renamed.jar&lt;/a&gt;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;this file path will be resolved to URI &lt;tt&gt;&lt;a href=&quot;file:/Users/sshao/projects/apache-spark/my.jar#renamed.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/Users/sshao/projects/apache-spark/my.jar#renamed.jar&lt;/a&gt;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;This is done by Utils#resolveURI&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  def resolveURI(path: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;): URI = {
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      val uri = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URI(path)
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (uri.getScheme() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; uri
      }
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; e: URISyntaxException =&amp;gt;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(path).getAbsoluteFile().toURI()
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Where if scheme is not specified, this code will transform the file path into URI, the noted thing is that &quot;#&quot; will be translated into &quot;%23&quot; in this `toURI`.&lt;/p&gt;

&lt;p&gt;After digging into the Hadoop code RawLocalFileSystem#pathToFile:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; File pathToFile(Path path) {
    checkPath(path);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!path.isAbsolute()) {
      path = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(getWorkingDirectory(), path);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(path.toUri().getPath());
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here using `URI.getPath` to get file path will lead to different behavior if we do not escape &quot;#&quot; to &quot;%23&quot;, which will treat the part after &quot;#&quot; as fragment, not path.&lt;br/&gt;
But if we instead using &lt;/p&gt;

&lt;p&gt;&lt;tt&gt;--jars my.jar%23renamed.jar&lt;/tt&gt; &lt;/p&gt;

&lt;p&gt;or &lt;/p&gt;

&lt;p&gt;&lt;tt&gt;--jars &lt;a href=&quot;file:///path/to/my.jar%23renamed.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:///path/to/my.jar%23renamed.jar&lt;/a&gt;&lt;/tt&gt;,&lt;/p&gt;

&lt;p&gt;it can be succeeded in both way.&lt;/p&gt;










</comment>
                            <comment id="14936317" author="jerryshao" created="Wed, 30 Sep 2015 03:28:55 +0000"  >&lt;p&gt;So basically I think the problem is if we specify the scheme, do we need to guarantee the preserved chars to be escaped by our own. If we rely on Spark to handle this, I think we need to fix this issue.&lt;/p&gt;

&lt;p&gt;Another interesting thing is that not sure why your result is different from mine.&lt;/p&gt;</comment>
                            <comment id="14948941" author="tgraves" created="Thu, 8 Oct 2015 16:27:05 +0000"  >&lt;p&gt;Sorry for the delay on this didn&apos;t have time to look at it.  Not sure why you are seeing different from me.&lt;/p&gt;

&lt;p&gt;thanks for looking into this.  I agree its in the parsing  in the resolveURI where its calling     new File(path).getAbsoluteFile().toURI().&lt;/p&gt;

&lt;p&gt;When I don&apos;t specify &lt;a href=&quot;file://:&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file://:&lt;/a&gt;&lt;br/&gt;
15/10/08 15:35:56 INFO Client: local uri is: &lt;a href=&quot;file:/homes/tgraves/R_install/R_install.tgz%23R_installation&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/homes/tgraves/R_install/R_install.tgz%23R_installation&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;with &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file://&lt;/a&gt;&lt;br/&gt;
15/10/08 15:38:27 INFO Client: local uri is: &lt;a href=&quot;file:/homes/tgraves/R_install/R_install.tgz#R_installation&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/homes/tgraves/R_install/R_install.tgz#R_installation&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;That is coming back with the %23 encoded versus the #.   when I originally wrote those code it wasn&apos;t calling the Utils.resolveURIs.  &lt;/p&gt;

&lt;p&gt; Looking at the actual code for File.toURI() you will see its not really parsing the fragment out before calling URI() which I think is the problem:&lt;/p&gt;

&lt;p&gt;   public URI toURI() {&lt;br/&gt;
        try &lt;/p&gt;
{
            File f = getAbsoluteFile();
            String sp = slashify(f.getPath(), f.isDirectory());
            if (sp.startsWith(&quot;//&quot;))
                sp = &quot;//&quot; + sp;
            return new URI(&quot;file&quot;, null, sp, null);
        }
&lt;p&gt; catch (URISyntaxException x) &lt;/p&gt;
{
            throw new Error(x);         // Can&apos;t happen
        }
&lt;p&gt;    }&lt;/p&gt;


&lt;p&gt;It seems like a bad idea to call this based on the fact that the string might already be URI format.  So we are now going from possible URI to File and back to URI.  When we change it to a File its not expecting it to be URI with fragment already so its treating it as part of the path.&lt;/p&gt;</comment>
                            <comment id="14949334" author="tgraves" created="Thu, 8 Oct 2015 20:29:34 +0000"  >&lt;p&gt;so now I&apos;m really confused why this is backwards for you.    The code in resolveURI, clearly skips the code causing the problem if it already has a scheme on it:&lt;/p&gt;

&lt;p&gt;def resolveURI(path: String): URI = {&lt;br/&gt;
    try {&lt;br/&gt;
      val uri = new URI(path)&lt;br/&gt;
      if (uri.getScheme() != null) &lt;/p&gt;
{
        return uri
      }

&lt;p&gt;Unless perhaps your shell environment is doing something.  Which perhaps is why if you escape it with &amp;#35; it works.   I&apos;m using bash.&lt;/p&gt;</comment>
                            <comment id="14949372" author="apachespark" created="Thu, 8 Oct 2015 20:56:04 +0000"  >&lt;p&gt;User &apos;tgravescs&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9035&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9035&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mdbz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>