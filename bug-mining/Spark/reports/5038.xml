<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:54:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-21447] Spark history server fails to render compressed inprogress history file in some cases.</title>
                <link>https://issues.apache.org/jira/browse/SPARK-21447</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;We&apos;ve observed the Spark History Server sometimes fails to load event data from a compressed .inprogress spark history file.  Note the existing logic in ReplayListenerBus is to read each line, if it can&apos;t json parse the last line and it&apos;s inprogress (maybeTruncated) then it is accepted as best effort.&lt;/p&gt;

&lt;p&gt;In the case of compressed files, the output stream will compress on the fly json serialized event data.  The output is periodically flushed to disk when internal buffers are full.  A consequence of that is a partially compressed frame may be flushed, and not being a complete frame, it can not be decompressed.  If the spark history server attempts to read such an .inprogress compressed file it will throw an EOFException.  This is really analogous to the case of failing to json parse the last line in the file (because the full line was not flushed), the difference is that since the file is compressed it is possible the compression frame was not flushed, and trying to decompress a partial frame fails in a different way the code doesn&apos;t currently handle.&lt;/p&gt;

&lt;p&gt;17/07/13 17:24:59 ERROR FsHistoryProvider: Exception encountered when attempting to load application log hdfs://*******&lt;b&gt;/user/hadoop/&lt;/b&gt;****&lt;b&gt;/spark/logs/job_&lt;/b&gt;********&lt;b&gt;&lt;del&gt;&lt;/b&gt;***********&lt;b&gt;&lt;/del&gt;&lt;/b&gt;****.lz4.inprogress&lt;br/&gt;
java.io.EOFException: Stream ended prematurely&lt;br/&gt;
        at org.apache.spark.io.LZ4BlockInputStream.readFully(LZ4BlockInputStream.java:230)&lt;br/&gt;
        at org.apache.spark.io.LZ4BlockInputStream.refill(LZ4BlockInputStream.java:203)&lt;br/&gt;
        at org.apache.spark.io.LZ4BlockInputStream.read(LZ4BlockInputStream.java:125)&lt;br/&gt;
        at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:284)&lt;br/&gt;
        at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:326)&lt;br/&gt;
        at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178)&lt;br/&gt;
        at java.io.InputStreamReader.read(InputStreamReader.java:184)&lt;br/&gt;
        at java.io.BufferedReader.fill(BufferedReader.java:161)&lt;br/&gt;
        at java.io.BufferedReader.readLine(BufferedReader.java:324)&lt;br/&gt;
        at java.io.BufferedReader.readLine(BufferedReader.java:389)&lt;br/&gt;
        at scala.io.BufferedSource$BufferedLineIterator.hasNext(BufferedSource.scala:72)&lt;br/&gt;
        at scala.collection.Iterator$$anon$21.hasNext(Iterator.scala:836)&lt;br/&gt;
        at scala.collection.Iterator$$anon$13.hasNext(Iterator.scala:461)&lt;br/&gt;
        at org.apache.spark.scheduler.ReplayListenerBus.replay(ReplayListenerBus.scala:66)&lt;br/&gt;
        at org.apache.spark.deploy.history.FsHistoryProvider.org$apache$spark$deploy$history$FsHistoryProvider$$replay(FsHistoryProvider.scala:601)&lt;br/&gt;
        at org.apache.spark.deploy.history.FsHistoryProvider.org$apache$spark$deploy$history$FsHistoryProvider$$mergeApplicationListing(FsHistoryProvider.scala:409)&lt;br/&gt;
        at org.apache.spark.deploy.history.FsHistoryProvider$$anonfun$checkForLogs$3$$anon$4.run(FsHistoryProvider.scala:310)&lt;br/&gt;
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:266)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:745)&lt;/p&gt;

</description>
                <environment>&lt;p&gt;Spark History Server&lt;/p&gt;</environment>
        <key id="13087798">SPARK-21447</key>
            <summary>Spark history server fails to render compressed inprogress history file in some cases.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ericvandenbergfb">Eric Vandenberg</assignee>
                                    <reporter username="ericvandenbergfb">Eric Vandenberg</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Jul 2017 01:05:12 +0000</created>
                <updated>Tue, 25 Jul 2017 18:51:49 +0000</updated>
                            <resolved>Tue, 25 Jul 2017 18:50:23 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.2.1</fixVersion>
                    <fixVersion>2.3.0</fixVersion>
                                    <component>Web UI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16091834" author="apachespark" created="Tue, 18 Jul 2017 17:20:03 +0000"  >&lt;p&gt;User &apos;ericvandenbergfb&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18673&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18673&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12905751">SPARK-11170</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 18 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hmvj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>