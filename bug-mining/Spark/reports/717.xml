<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:17:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-3447] Kryo NPE when serializing JListWrapper</title>
                <link>https://issues.apache.org/jira/browse/SPARK-3447</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Repro (provided by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davies&quot; class=&quot;user-hover&quot; rel=&quot;davies&quot;&gt;davies&lt;/a&gt;):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from pyspark.sql &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; SQLContext; SQLContext(sc).inferSchema(sc.parallelize([{&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;: [3]}]))._jschema_rdd.collect()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;14/09/05 21:59:47 ERROR TaskResultGetter: Exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; getting task result
com.esotericsoftware.kryo.KryoException: java.lang.NullPointerException
Serialization trace:
underlying (scala.collection.convert.Wrappers$JListWrapper)
values (org.apache.spark.sql.catalyst.expressions.GenericRow)
at com.esotericsoftware.kryo.serializers.FieldSerializer$ObjectField.read(FieldSerializer.java:626)
at com.esotericsoftware.kryo.serializers.FieldSerializer.read(FieldSerializer.java:221)
at com.esotericsoftware.kryo.Kryo.readClassAndObject(Kryo.java:729)
at com.esotericsoftware.kryo.serializers.DefaultArraySerializers$ObjectArraySerializer.read(DefaultArraySerializers.java:338)
at com.esotericsoftware.kryo.serializers.DefaultArraySerializers$ObjectArraySerializer.read(DefaultArraySerializers.java:293)
at com.esotericsoftware.kryo.Kryo.readObject(Kryo.java:648)
at com.esotericsoftware.kryo.serializers.FieldSerializer$ObjectField.read(FieldSerializer.java:605)
at com.esotericsoftware.kryo.serializers.FieldSerializer.read(FieldSerializer.java:221)
at com.esotericsoftware.kryo.Kryo.readClassAndObject(Kryo.java:729)
at com.esotericsoftware.kryo.serializers.DefaultArraySerializers$ObjectArraySerializer.read(DefaultArraySerializers.java:338)
at com.esotericsoftware.kryo.serializers.DefaultArraySerializers$ObjectArraySerializer.read(DefaultArraySerializers.java:293)
at com.esotericsoftware.kryo.Kryo.readClassAndObject(Kryo.java:729)
at org.apache.spark.serializer.KryoSerializerInstance.deserialize(KryoSerializer.scala:162)
at org.apache.spark.scheduler.DirectTaskResult.value(TaskResult.scala:79)
at org.apache.spark.scheduler.TaskSetManager.handleSuccessfulTask(TaskSetManager.scala:514)
at org.apache.spark.scheduler.TaskSchedulerImpl.handleSuccessfulTask(TaskSchedulerImpl.scala:355)
at org.apache.spark.scheduler.TaskResultGetter$$anon$2$$anonfun$run$1.apply$mcV$sp(TaskResultGetter.scala:68)
at org.apache.spark.scheduler.TaskResultGetter$$anon$2$$anonfun$run$1.apply(TaskResultGetter.scala:47)
at org.apache.spark.scheduler.TaskResultGetter$$anon$2$$anonfun$run$1.apply(TaskResultGetter.scala:47)
at org.apache.spark.util.Utils$.logUncaughtExceptions(Utils.scala:1276)
at org.apache.spark.scheduler.TaskResultGetter$$anon$2.run(TaskResultGetter.scala:46)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1146)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:701)
Caused by: java.lang.NullPointerException
at scala.collection.convert.Wrappers$MutableBufferWrapper.add(Wrappers.scala:80)
at com.esotericsoftware.kryo.serializers.CollectionSerializer.read(CollectionSerializer.java:109)
at com.esotericsoftware.kryo.serializers.CollectionSerializer.read(CollectionSerializer.java:18)
at com.esotericsoftware.kryo.Kryo.readObject(Kryo.java:648)
at com.esotericsoftware.kryo.serializers.FieldSerializer$ObjectField.read(FieldSerializer.java:605)
... 23 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12740003">SPARK-3447</key>
            <summary>Kryo NPE when serializing JListWrapper</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marmbrus">Michael Armbrust</assignee>
                                    <reporter username="marmbrus">Michael Armbrust</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Sep 2014 23:00:08 +0000</created>
                <updated>Thu, 18 Sep 2014 14:33:35 +0000</updated>
                            <resolved>Thu, 11 Sep 2014 04:00:24 +0000</resolved>
                                                    <fixVersion>1.2.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14126323" author="apachespark" created="Mon, 8 Sep 2014 23:47:19 +0000"  >&lt;p&gt;User &apos;marmbrus&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2323&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2323&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14138873" author="mohan.gadm" created="Thu, 18 Sep 2014 12:51:19 +0000"  >&lt;p&gt;I am also facing the same issue with spark streaming API, kryo serializer and Avro Objects.&lt;br/&gt;
I have observed this behavior with output operations like print, collect etc. also observed that if the avro object is simple, no problem. but if the avro objects are complex with unions/Arrays, gives the exception.&lt;/p&gt;

&lt;p&gt;find the stack trace below:&lt;br/&gt;
ERROR scheduler.JobScheduler: Error running job streaming job 1411043845000 ms.0&lt;br/&gt;
org.apache.spark.SparkException: Job aborted due to stage failure: Exception while getting task result: com.esotericsoftware.kryo.KryoException: java.lang.NullPointerException&lt;br/&gt;
Serialization trace:&lt;br/&gt;
value (xyz.Datum)&lt;br/&gt;
data (xyz.ResourceMessage)&lt;br/&gt;
at org.apache.spark.scheduler.DAGScheduler.org$apache$spark$scheduler$DAGScheduler$$failJobAndIndependentStages(DAGScheduler.scala:1185)&lt;br/&gt;
at org.apache.spark.scheduler.DAGScheduler$$anonfun$abortStage$1.apply(DAGScheduler.scala:1174)&lt;br/&gt;
at org.apache.spark.scheduler.DAGScheduler$$anonfun$abortStage$1.apply(DAGScheduler.scala:1173)&lt;br/&gt;
at scala.collection.mutable.ResizableArray$class.foreach(ResizableArray.scala:59)&lt;br/&gt;
at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:47)&lt;br/&gt;
at org.apache.spark.scheduler.DAGScheduler.abortStage(DAGScheduler.scala:1173)&lt;br/&gt;
at org.apache.spark.scheduler.DAGScheduler$$anonfun$handleTaskSetFailed$1.apply(DAGScheduler.scala:688)&lt;br/&gt;
at org.apache.spark.scheduler.DAGScheduler$$anonfun$handleTaskSetFailed$1.apply(DAGScheduler.scala:688)&lt;br/&gt;
at scala.Option.foreach(Option.scala:236)&lt;br/&gt;
at org.apache.spark.scheduler.DAGScheduler.handleTaskSetFailed(DAGScheduler.scala:688)&lt;br/&gt;
at org.apache.spark.scheduler.DAGSchedulerEventProcessActor$$anonfun$receive$2.applyOrElse(DAGScheduler.scala:1391)&lt;br/&gt;
at akka.actor.ActorCell.receiveMessage(ActorCell.scala:498)&lt;br/&gt;
at akka.actor.ActorCell.invoke(ActorCell.scala:456)&lt;br/&gt;
at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:237)&lt;br/&gt;
at akka.dispatch.Mailbox.run(Mailbox.scala:219)&lt;br/&gt;
at akka.dispatch.ForkJoinExecutorConfigurator$AkkaForkJoinTask.exec(AbstractDispatcher.scala:386)&lt;br/&gt;
at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)&lt;br/&gt;
at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)&lt;br/&gt;
at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)&lt;br/&gt;
at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)&lt;/p&gt;


&lt;p&gt;below is the avro message.&lt;br/&gt;
{&quot;version&quot;: &quot;01&quot;, &quot;sequence&quot;: &quot;00001&quot;, &quot;resource&quot;: &quot;sensor-001&quot;, &quot;controller&quot;: &quot;002&quot;, &quot;controllerTimestamp&quot;: &quot;1411038710358&quot;, &quot;data&quot;: {&quot;value&quot;: [&lt;/p&gt;
{&quot;name&quot;: &quot;Temperature&quot;, &quot;value&quot;: &quot;30&quot;}
&lt;p&gt;, &lt;/p&gt;
{&quot;name&quot;: &quot;Speed&quot;, &quot;value&quot;: &quot;60&quot;}
&lt;p&gt;, &lt;/p&gt;
{&quot;name&quot;: &quot;Location&quot;, &quot;value&quot;: [&quot;+401213.1&quot;, &quot;-0750015.1&quot;]}
&lt;p&gt;, &lt;/p&gt;
{&quot;name&quot;: &quot;Timestamp&quot;, &quot;value&quot;: &quot;2014-09-09T08:15:25-05:00&quot;}
&lt;p&gt;]}}&lt;/p&gt;

&lt;p&gt;message is been successfully decoded in decoder, but throws exception for output operation.&lt;/p&gt;</comment>
                            <comment id="14138884" author="yhuai" created="Thu, 18 Sep 2014 13:03:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mohan.gadm&quot; class=&quot;user-hover&quot; rel=&quot;mohan.gadm&quot;&gt;mohan.gadm&lt;/a&gt; From the trace, seems the NPE was caused by &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;value (com.globallogic.goliath.model.Datum)
data (com.globallogic.goliath.model.ResourceMessage)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Can you check these two classes (I can not find them online)? &lt;br/&gt;
Seems the avro message was decoded and then you stored the message as a com.globallogic.goliath.model.ResourceMessage. In a ResourceMessage, an array was repreented by Datum, which caused the problem.&lt;/p&gt;</comment>
                            <comment id="14138899" author="mohan.gadm" created="Thu, 18 Sep 2014 13:12:13 +0000"  >&lt;p&gt;sorry for the mistake, those are the project specific classes. and those are the classes generated by Avro itself from an avro avdl file and available in driver jar and also worker nodes.&lt;/p&gt;</comment>
                            <comment id="14138911" author="mohan.gadm" created="Thu, 18 Sep 2014 13:21:02 +0000"  >&lt;p&gt;record KeyValueObject {&lt;br/&gt;
		union&lt;/p&gt;
{boolean, int, long, float, double, bytes, string}
&lt;p&gt; name; //can be of any one of them mentioned in union.&lt;br/&gt;
		union {boolean, int, long, float, double, bytes, string, array&amp;lt;union&lt;/p&gt;
{boolean, int, long, float, double, bytes, string, KeyValueObject}&amp;gt;, KeyValueObject} value;&lt;br/&gt;
	}&lt;br/&gt;
	record Datum {&lt;br/&gt;
		union {boolean, int, long, float, double, bytes, string, array&amp;lt;union{boolean, int, long, float, double, bytes, string, KeyValueObject}
&lt;p&gt;&amp;gt;, KeyValueObject} value;&lt;br/&gt;
	}&lt;br/&gt;
	record ResourceMessage {&lt;br/&gt;
		string version;&lt;br/&gt;
		string sequence;&lt;br/&gt;
		string resource;&lt;br/&gt;
		string controller;&lt;br/&gt;
		string controllerTimestamp;&lt;br/&gt;
		union &lt;/p&gt;
{Datum, array&amp;lt;Datum&amp;gt;}
&lt;p&gt; data;&lt;br/&gt;
	}&lt;/p&gt;</comment>
                            <comment id="14138924" author="yhuai" created="Thu, 18 Sep 2014 13:32:19 +0000"  >&lt;p&gt;Did you register your classes (please check &lt;a href=&quot;https://spark.apache.org/docs/latest/tuning.html)?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://spark.apache.org/docs/latest/tuning.html)?&lt;/a&gt; Also, if you have further question about it, please send it to our user list (user@spark.apache.org) since this issue is not related to this JIRA.&lt;/p&gt;</comment>
                            <comment id="14138999" author="mohan.gadm" created="Thu, 18 Sep 2014 14:33:35 +0000"  >&lt;p&gt;Thanks for the suggestion.&lt;br/&gt;
Yes i have registered my classes with kryo.&lt;br/&gt;
Created a topic in spark user list for the same. at the below link:&lt;br/&gt;
&lt;a href=&quot;http://apache-spark-user-list.1001560.n3.nabble.com/Kryo-fails-with-avro-having-Arrays-and-unions-but-succeeds-with-simple-avro-tc14549.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-spark-user-list.1001560.n3.nabble.com/Kryo-fails-with-avro-having-Arrays-and-unions-but-succeeds-with-simple-avro-tc14549.html&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 9 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zt9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327369">1.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>