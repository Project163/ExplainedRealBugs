<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:44:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-16017] YarnClientSchedulerBackend now registers backends as IPs instead of Hostnames which causes all tasks to run with RACK_LOCAL locality.</title>
                <link>https://issues.apache.org/jira/browse/SPARK-16017</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Since this change: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-15395&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;SPARK-15395&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;When registering new executor backends it registers them as IPs instead of hostnames. This causes a flow on effect that when the Task manager is trying to figure out what Locality tasks should run at, no tasks can be run At the NODE_LOCAL level.&lt;/p&gt;

&lt;p&gt;This specific call:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/blob/branch-2.0/core/src/main/scala/org/apache/spark/scheduler/TaskSetManager.scala#L886&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/branch-2.0/core/src/main/scala/org/apache/spark/scheduler/TaskSetManager.scala#L886&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/blob/branch-2.0/core/src/main/scala/org/apache/spark/scheduler/TaskSetManager.scala#L886&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pendingTasksForHost&lt;/a&gt;  are all hostnames pulled from the DFS locations while &lt;a href=&quot;https://github.com/apache/spark/blob/9b234b55d1b5e4a7c80e482b3e297bfb8b583a56/core/src/main/scala/org/apache/spark/scheduler/TaskSchedulerImpl.scala#L560&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;hasExecutorsAliveOnHost&lt;/a&gt;, uses &lt;a href=&quot;https://github.com/apache/spark/blob/branch-2.0/core/src/main/scala/org/apache/spark/scheduler/TaskSchedulerImpl.scala#L98&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;executorsByHost&lt;/a&gt;, which are all IP&apos;s because they are populated from the RpcAddress.&lt;/p&gt;

&lt;p&gt;As expected this causes significant performance problems, A simple count query will take 22 seconds, But if I revert the change from &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-15395&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;SPARK-15395&lt;/a&gt;, tasks will run with NODE_LOCAL locality and the same count will take 3 seconds.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12980207">SPARK-16017</key>
            <summary>YarnClientSchedulerBackend now registers backends as IPs instead of Hostnames which causes all tasks to run with RACK_LOCAL locality.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zsxwing">Shixiong Zhu</assignee>
                                    <reporter username="tleftwich">Trystan Leftwich</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Jun 2016 14:26:07 +0000</created>
                <updated>Fri, 17 Jun 2016 22:49:59 +0000</updated>
                            <resolved>Fri, 17 Jun 2016 22:49:45 +0000</resolved>
                                    <version>1.6.2</version>
                    <version>2.0.0</version>
                                    <fixVersion>1.6.2</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="15336564" author="vanzin" created="Fri, 17 Jun 2016 17:55:43 +0000"  >&lt;p&gt;This is a pretty bad performance regression. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zsxwing&quot; class=&quot;user-hover&quot; rel=&quot;zsxwing&quot;&gt;zsxwing&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Very tempted to up it to blocker.&lt;/p&gt;</comment>
                            <comment id="15336570" author="vanzin" created="Fri, 17 Jun 2016 17:57:13 +0000"  >&lt;p&gt;BTW &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-15395&quot; title=&quot;Use getHostString to create RpcAddress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-15395&quot;&gt;&lt;del&gt;SPARK-15395&lt;/del&gt;&lt;/a&gt; doesn&apos;t really explain a real use case where the old code caused a problem; given that we&apos;ve had a few releases with that code and I&apos;ve never seen any issues related to it, at this point I&apos;d suggest just reverting that patch and, if there&apos;s a real issue, fixing it properly in the next point release.&lt;/p&gt;</comment>
                            <comment id="15336584" author="vanzin" created="Fri, 17 Jun 2016 18:03:57 +0000"  >&lt;p&gt;In fact this shouldn&apos;t affect just YARN, but anything that uses HDFS or any storage system that reports hostnames when providing info about splits.&lt;/p&gt;</comment>
                            <comment id="15336610" author="zsxwing" created="Fri, 17 Jun 2016 18:14:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt; what do you think if we just send hostname from CoarseGrainedSchedulerBackend and set it in &lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/scheduler/cluster/CoarseGrainedSchedulerBackend.scala#L167&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/scheduler/cluster/CoarseGrainedSchedulerBackend.scala#L167&lt;/a&gt; ?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-15395&quot; title=&quot;Use getHostString to create RpcAddress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-15395&quot;&gt;&lt;del&gt;SPARK-15395&lt;/del&gt;&lt;/a&gt; is to improve the robustness. If there is no way to fix this one, I agree that we just revert &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-15395&quot; title=&quot;Use getHostString to create RpcAddress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-15395&quot;&gt;&lt;del&gt;SPARK-15395&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15336630" author="vanzin" created="Fri, 17 Jun 2016 18:26:39 +0000"  >&lt;p&gt;I assume you mean from &lt;tt&gt;CoarseGrainedExecutorBackend&lt;/tt&gt;? That could work. You could also resolve the executor&apos;s IP in &lt;tt&gt;CoarseGrainedSchedulerBackend&lt;/tt&gt;, although that might be slower.&lt;/p&gt;</comment>
                            <comment id="15336667" author="zsxwing" created="Fri, 17 Jun 2016 18:41:06 +0000"  >&lt;p&gt;Yes. Thanks for correcting. I will submit a PR for 2.0. In the mean time, let&apos;s revert my patch for batch 1.6 as it seems too much changes for 1.6.&lt;/p&gt;</comment>
                            <comment id="15336765" author="zsxwing" created="Fri, 17 Jun 2016 19:22:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt; Just realized one problem: If the user starts the executors using IP addresses, we will still report IPs to TaskScheduler. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt; do you know how HDFS reports hostname? Will it reports hostname even if the user starts the datanodes using IP addresses? If so, my proposal won&apos;t fix it and I think &quot;resolving the executor&apos;s IP in CoarseGrainedSchedulerBackend&quot; is better.&lt;/p&gt;</comment>
                            <comment id="15336880" author="vanzin" created="Fri, 17 Jun 2016 20:26:30 +0000"  >&lt;p&gt;The default configuration of HDFS seems to disallow the case where the DN connects just with an IP address - the hostname should be resolved. So I think it&apos;s pretty sure to assume that you&apos;ll always have hostnames.&lt;/p&gt;

&lt;p&gt;(That code is in HDFS&apos;s DatanodeManager.java, btw.)&lt;/p&gt;</comment>
                            <comment id="15336884" author="apachespark" created="Fri, 17 Jun 2016 20:30:06 +0000"  >&lt;p&gt;User &apos;zsxwing&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/13741&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13741&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15336895" author="srowen" created="Fri, 17 Jun 2016 20:37:04 +0000"  >&lt;p&gt;BTW while we&apos;re here... is this related to what &lt;a href=&quot;https://github.com/apache/spark/pull/8533&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/8533&lt;/a&gt; was talking about? I know, this is narrowly about &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-15395&quot; title=&quot;Use getHostString to create RpcAddress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-15395&quot;&gt;&lt;del&gt;SPARK-15395&lt;/del&gt;&lt;/a&gt; but wondering if it is something that is or was already resolved. &lt;/p&gt;</comment>
                            <comment id="15336902" author="zsxwing" created="Fri, 17 Jun 2016 20:40:42 +0000"  >&lt;p&gt;Just to confirm that: you agree that just sending the hostname from executors to driver. Right?&lt;/p&gt;</comment>
                            <comment id="15336906" author="vanzin" created="Fri, 17 Jun 2016 20:42:48 +0000"  >&lt;p&gt;That seems it might create a similar situation, but it was filed against a version of Spark that didn&apos;t even have the code that caused this particular regression. So my hunch is same symptom, different root cause, which may or may not have been fixed in newer Spark versions.&lt;/p&gt;</comment>
                            <comment id="15336908" author="vanzin" created="Fri, 17 Jun 2016 20:43:33 +0000"  >&lt;p&gt;Yes, given the HDFS restrictions, that should be enough.&lt;/p&gt;</comment>
                            <comment id="15336914" author="zsxwing" created="Fri, 17 Jun 2016 20:46:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tleftwich&quot; class=&quot;user-hover&quot; rel=&quot;tleftwich&quot;&gt;tleftwich&lt;/a&gt; Could help test &lt;a href=&quot;https://github.com/apache/spark/pull/13741&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13741&lt;/a&gt; in your environment, please?&lt;/p&gt;</comment>
                            <comment id="15336919" author="zsxwing" created="Fri, 17 Jun 2016 20:47:37 +0000"  >&lt;p&gt;FYI, I reverted &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-15395&quot; title=&quot;Use getHostString to create RpcAddress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-15395&quot;&gt;&lt;del&gt;SPARK-15395&lt;/del&gt;&lt;/a&gt; for branch-1.6.&lt;/p&gt;</comment>
                            <comment id="15337004" author="tleftwich" created="Fri, 17 Jun 2016 21:33:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zsxwing&quot; class=&quot;user-hover&quot; rel=&quot;zsxwing&quot;&gt;zsxwing&lt;/a&gt; I&apos;ll run the tests here shortly and get back to you.&lt;/p&gt;</comment>
                            <comment id="15337154" author="tleftwich" created="Fri, 17 Jun 2016 22:45:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zsxwing&quot; class=&quot;user-hover&quot; rel=&quot;zsxwing&quot;&gt;zsxwing&lt;/a&gt; I&apos;ve tested your fix locally and it all is working as expected. Thanks.&lt;/p&gt;</comment>
                            <comment id="15337155" author="zsxwing" created="Fri, 17 Jun 2016 22:47:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tleftwich&quot; class=&quot;user-hover&quot; rel=&quot;tleftwich&quot;&gt;tleftwich&lt;/a&gt; Thanks! I&apos;m merging it into 2.0 now!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12970968">SPARK-15395</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 22 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zmqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334910">1.6.2</customfieldvalue>
    <customfieldvalue id="12329449">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>