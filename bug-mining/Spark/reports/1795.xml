<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:27:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-6201] INSET should coerce types</title>
                <link>https://issues.apache.org/jira/browse/SPARK-6201</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Suppose we have the following table:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sqlc.jsonRDD(sc.parallelize(Seq(&lt;span class=&quot;code-quote&quot;&gt;&quot;{\&quot;&lt;/span&gt;a\&lt;span class=&quot;code-quote&quot;&gt;&quot;: \&quot;&lt;/span&gt;1\&lt;span class=&quot;code-quote&quot;&gt;&quot;}}&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;{\&quot;&lt;/span&gt;a\&lt;span class=&quot;code-quote&quot;&gt;&quot;: \&quot;&lt;/span&gt;2\&lt;span class=&quot;code-quote&quot;&gt;&quot;}}&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;{\&quot;&lt;/span&gt;a\&lt;span class=&quot;code-quote&quot;&gt;&quot;: \&quot;&lt;/span&gt;3\&lt;span class=&quot;code-quote&quot;&gt;&quot;}}&quot;&lt;/span&gt;))).registerTempTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;d&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The schema is&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;root
 |-- a: string (nullable = true)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then,&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select * from d where (d.a = 1 or d.a = 2)&quot;&lt;/span&gt;).collect
=&amp;gt;
Array([1], [2])
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where d.a and constants 1,2 will be casted to Double first and do the comparison as you can find it out in the plan:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Filter ((CAST(a#155, DoubleType) = CAST(1, DoubleType)) || (CAST(a#155, DoubleType) = CAST(2, DoubleType)))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, if I use&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select * from d where d.a in (1,2)&quot;&lt;/span&gt;).collect
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The result is empty.&lt;/p&gt;

&lt;p&gt;The physical plan shows it&apos;s using INSET:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;== Physical Plan ==
Filter a#155 INSET (1,2)
 PhysicalRDD [a#155], MappedRDD[499] at map at JsonRDD.scala:47
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;&lt;b&gt;It seems INSET implementation in SparkSQL doesn&apos;t coerce type implicitly, where Hive does. We should make SparkSQL conform to Hive&apos;s behavior, even though doing implicit coercion here is very confusing for comparing String and Int.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Jianshi&lt;/p&gt;</description>
                <environment></environment>
        <key id="12780011">SPARK-6201</key>
            <summary>INSET should coerce types</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="adrian-wang">Adrian Wang</assignee>
                                    <reporter username="huangjs">Jianshi Huang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Mar 2015 08:06:45 +0000</created>
                <updated>Wed, 6 May 2015 17:34:52 +0000</updated>
                            <resolved>Wed, 6 May 2015 17:34:52 +0000</resolved>
                                    <version>1.2.0</version>
                    <version>1.2.1</version>
                    <version>1.3.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14352608" author="apachespark" created="Mon, 9 Mar 2015 06:32:24 +0000"  >&lt;p&gt;User &apos;adrian-wang&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/4945&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/4945&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14352660" author="adrian-wang" created="Mon, 9 Mar 2015 08:04:01 +0000"  >&lt;p&gt;I have created a pull request for this.&lt;/p&gt;</comment>
                            <comment id="14353030" author="lian cheng" created="Mon, 9 Mar 2015 14:26:10 +0000"  >&lt;p&gt;Played Hive type implicit conversion a bit more and found that Hive actually converts integers to strings in your case:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;hive&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt; t1 &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;1.00&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; c1;
hive&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; * &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; t1 &lt;span class=&quot;code-keyword&quot;&gt;where&lt;/span&gt; c1 &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; (1.0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If &lt;tt&gt;c1&lt;/tt&gt; is converted to numeric, then &lt;tt&gt;1.00&lt;/tt&gt; should appear in the result. However, the result set is empty. For expression &lt;tt&gt;&quot;1.00&quot; IN (1.0)&lt;/tt&gt;, a &lt;tt&gt;GenericUDFIn&lt;/tt&gt; instance is created and called with argument list &lt;tt&gt;(&quot;1.00&quot;, 1.0)&lt;/tt&gt;. Then &lt;tt&gt;GenericUDFIn.initialize&lt;/tt&gt; tries to convert all arguments into a common data type from left to right. Since double is allowed to be translated into string, &lt;tt&gt;1.0&lt;/tt&gt; is converted into string &lt;tt&gt;&quot;1.0&quot;&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;References:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;a href=&quot;http://chapeau.freevariable.com/2014/08/existing-system-coercion.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Implicit type coercion support in existing database systems&lt;/a&gt; by William Benton&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/hive/blob/release-0.13.1/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFIn.java#L84-L100&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;GenericUDFIn.initialize&lt;/tt&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

</comment>
                            <comment id="14353112" author="lian cheng" created="Mon, 9 Mar 2015 15:31:55 +0000"  >&lt;p&gt;I&apos;m kinda not sure whether / how should we fix this issue. The &lt;tt&gt;IN&lt;/tt&gt; operator is implemented as a &lt;tt&gt;GenericUDF&lt;/tt&gt; in Hive, and is governed by the UDF argument type conversion rules, which I&apos;m not sure whether they are standard and proper to be introduced into Spark SQL.&lt;/p&gt;</comment>
                            <comment id="14353248" author="huangjs" created="Mon, 9 Mar 2015 17:39:04 +0000"  >&lt;p&gt;Implicit coercion outside the Numeric domain is quite evil. I don&apos;t think Hive&apos;s behavior makes sense here. &lt;/p&gt;

&lt;p&gt;Raising an exception is fine in this case. And if you want to make it Hive compliant, then pls think about adding an switch, say&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;spark.sql.strict_mode = true(default) / false&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Jianshi&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 37 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i26ftb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>