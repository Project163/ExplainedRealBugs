<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:06:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-28699] Cache an indeterminate RDD could lead to incorrect result while stage rerun</title>
                <link>https://issues.apache.org/jira/browse/SPARK-28699</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;It&apos;s another case for the indeterminate stage/RDD rerun while stage rerun happened.&lt;/p&gt;

&lt;p&gt;We can reproduce this by the following code,&#160;thanks to Tyson for reporting this!&lt;br/&gt;
 &#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; scala.sys.process._
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.TaskContext

&lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; res = spark.range(0, 10000 * 10000, 1).map{ x =&amp;gt; (x % 1000, x)}
&lt;span class=&quot;code-comment&quot;&gt;// kill an executor in the stage that performs repartition(239)
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; df = res.repartition(113).cache.repartition(239).map { x =&amp;gt;
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (TaskContext.get.attemptNumber == 0 &amp;amp;&amp;amp; TaskContext.get.partitionId &amp;lt; 1 &amp;amp;&amp;amp; TaskContext.get.stageAttemptNumber == 0) {
 &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Exception(&lt;span class=&quot;code-quote&quot;&gt;&quot;pkill -f -n java&quot;&lt;/span&gt;.!!)
 }
 x
}

&lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; r2 = df.distinct.count()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13250283">SPARK-28699</key>
            <summary>Cache an indeterminate RDD could lead to incorrect result while stage rerun</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="XuanYuan">Yuanjian Li</assignee>
                                    <reporter username="XuanYuan">Yuanjian Li</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Mon, 12 Aug 2019 13:16:29 +0000</created>
                <updated>Sat, 16 Nov 2019 14:48:00 +0000</updated>
                            <resolved>Wed, 21 Aug 2019 18:03:22 +0000</resolved>
                                    <version>2.3.3</version>
                    <version>2.4.3</version>
                    <version>3.0.0</version>
                                    <fixVersion>2.3.4</fixVersion>
                    <fixVersion>2.4.4</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="16905250" author="xuanyuan" created="Mon, 12 Aug 2019 14:24:51 +0000"  >&lt;p&gt;&lt;del&gt;The current &lt;a href=&quot;https://github.com/apache/spark/pull/25420&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;approach&lt;/a&gt; just a&#160;bandage fix for returning the wrong answer.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;After further investigation, we found that this bug is nothing to do with cache operation. So we focus on the sort + shuffle self and finally found the root cause is about the wrong usage for radix sort.&lt;/p&gt;

&lt;p&gt;In original logic, we open the radix sort only depends on the config, and use the radix for the binary data comparison. It&#8217;s maybe OK for the dataset only has one column which is numeric, but during this case, binary format after transform &#8220;map{ x =&amp;gt; (x%1000, x)}&#8221; operation can&#8217;t be sorted by radix sort.&lt;/p&gt;

&lt;p&gt;After the fix in &lt;a href=&quot;https://github.com/apache/spark/pull/25491&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/25491&lt;/a&gt; all tests passed with the right answer.&lt;/p&gt;

&lt;p&gt;Also, find a corner case of DAGScheduler during the test is fixed&#160;separately in &lt;a href=&quot;https://github.com/apache/spark/pull/25491&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/25491&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;After we finish the work of indeterminate stage rerunning(&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-25341&quot; title=&quot;Support rolling back a shuffle map stage and re-generate the shuffle files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-25341&quot;&gt;&lt;del&gt;SPARK-25341&lt;/del&gt;&lt;/a&gt;), we can fix this by unpersisting the original RDD and rerunning the cached indeterminate stage. Gives a preview codebase &lt;a href=&quot;https://github.com/xuanyuanking/spark/tree/SPARK-28699-RERUN&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16910795" author="dongjoon" created="Mon, 19 Aug 2019 22:23:03 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=XuanYuan&quot; class=&quot;user-hover&quot; rel=&quot;XuanYuan&quot;&gt;XuanYuan&lt;/a&gt;.&lt;br/&gt;
Could you check old Spark versions and update `Affects Version/s:` of this JIRA issue?&lt;/p&gt;</comment>
                            <comment id="16910859" author="smilegator" created="Tue, 20 Aug 2019 00:12:36 +0000"  >&lt;p&gt;Also cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kiszk&quot; class=&quot;user-hover&quot; rel=&quot;kiszk&quot;&gt;kiszk&lt;/a&gt;&#160;Let us wait for this before starting RC1 for 2.3&lt;/p&gt;</comment>
                            <comment id="16910907" author="kiszk" created="Tue, 20 Aug 2019 01:56:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smilegator&quot; class=&quot;user-hover&quot; rel=&quot;smilegator&quot;&gt;smilegator&lt;/a&gt; Thank you for cc. I wait for fixing this.&lt;/p&gt;

&lt;p&gt;I was in the middle of releasing RC1. Thus, there is already &lt;tt&gt;2.4.4-rc1&lt;/tt&gt; tag in the &lt;a href=&quot;https://github.com/apache/spark/tree/branch-2.3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;branch-2.3&lt;/a&gt;. Should I remove this tag and release rc1? Or should I leave this tag and release rc2 at first?&lt;/p&gt;</comment>
                            <comment id="16910974" author="dongjoon" created="Tue, 20 Aug 2019 03:53:56 +0000"  >&lt;p&gt;? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kiszk&quot; class=&quot;user-hover&quot; rel=&quot;kiszk&quot;&gt;kiszk&lt;/a&gt;. `2.4.4-rc1` is `branch-2.4` and mine. You should not remove that.&lt;br/&gt;
I guess you wanted to say `2.3.4-rc1` and `2.3.4-rc1` is not created yet.&lt;/p&gt;</comment>
                            <comment id="16910983" author="kiszk" created="Tue, 20 Aug 2019 04:09:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dongjoon&quot; class=&quot;user-hover&quot; rel=&quot;dongjoon&quot;&gt;dongjoon&lt;/a&gt; Thank you for pointing out my typo. You are right. I should have said &lt;/p&gt;
{2.3.4-rc1}.&lt;br/&gt;
&lt;br/&gt;
Actually, while I was doing the following, it is not reflected at the repository yet!  After fixing this, let me restart the release process for {2.3.4-rc1}
&lt;p&gt;.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Release details:
BRANCH: branch-2.3
VERSION: 2.3.4
TAG: v2.3.4-rc1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16910987" author="dongjoon" created="Tue, 20 Aug 2019 04:13:28 +0000"  >&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;BTW, I updated this to `Blocker` according to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smilegator&quot; class=&quot;user-hover&quot; rel=&quot;smilegator&quot;&gt;smilegator&lt;/a&gt;&apos;s advice.&lt;/p&gt;</comment>
                            <comment id="16910990" author="xuanyuan" created="Tue, 20 Aug 2019 04:15:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dongjoon&quot; class=&quot;user-hover&quot; rel=&quot;dongjoon&quot;&gt;dongjoon&lt;/a&gt;&#160;Sure, the affects version is spark-2.1 after 2.1.4, spark 2.2 after 2.2.3, spark 2.3 and spark 2.4, Jira field update is done.&lt;/p&gt;</comment>
                            <comment id="16910994" author="dongjoon" created="Tue, 20 Aug 2019 04:26:08 +0000"  >&lt;p&gt;Thank you for the update, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=XuanYuan&quot; class=&quot;user-hover&quot; rel=&quot;XuanYuan&quot;&gt;XuanYuan&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="16912571" author="dongjoon" created="Wed, 21 Aug 2019 18:03:22 +0000"  >&lt;p&gt;This is resolved via &lt;a href=&quot;https://github.com/apache/spark/pull/25491&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/25491&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13252252">SPARK-28845</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13133526">SPARK-23207</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13134138">SPARK-23243</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z05kog:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12344844">2.3.4</customfieldvalue>
    <customfieldvalue id="12345466">2.4.4</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>