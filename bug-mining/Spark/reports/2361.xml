<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:31:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-10122] AttributeError: &apos;RDD&apos; object has no attribute &apos;offsetRanges&apos;</title>
                <link>https://issues.apache.org/jira/browse/SPARK-10122</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-8389&quot; title=&quot;Expose KafkaRDDs offsetRange in Python&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-8389&quot;&gt;&lt;del&gt;SPARK-8389&lt;/del&gt;&lt;/a&gt; added the offsetRanges interface to Kafka direct streams. This however appears to break when chaining operations after a transform operation. Following is example code that would result in an error (stack trace below). Note that if the &apos;count()&apos; operation is taken out of the example code then this error does not occur anymore, and the Kafka data is printed.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;kafka_test.py&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from pyspark &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; SparkContext
from pyspark.streaming &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; StreamingContext
from pyspark.streaming.kafka &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; KafkaUtils

def attach_kafka_metadata(kafka_rdd):
    offset_ranges = kafka_rdd.offsetRanges()

    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; kafka_rdd


&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; __name__ == &lt;span class=&quot;code-quote&quot;&gt;&quot;__main__&quot;&lt;/span&gt;:
    sc = SparkContext(appName=&lt;span class=&quot;code-quote&quot;&gt;&apos;kafka-test&apos;&lt;/span&gt;)
    ssc = StreamingContext(sc, 10)

    kafka_stream = KafkaUtils.createDirectStream(
        ssc,
        [TOPIC],
        kafkaParams={
            &lt;span class=&quot;code-quote&quot;&gt;&apos;metadata.broker.list&apos;&lt;/span&gt;: BROKERS,
        },
    )
    kafka_stream.transform(attach_kafka_metadata).count().pprint()

    ssc.start()
    ssc.awaitTermination()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Stack trace&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/spark/spark/python/lib/pyspark.zip/pyspark/streaming/util.py&quot;&lt;/span&gt;, line 62, in call
    r = self.func(t, *rdds)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/spark/spark/python/lib/pyspark.zip/pyspark/streaming/dstream.py&quot;&lt;/span&gt;, line 616, in &amp;lt;lambda&amp;gt;
    self.func = lambda t, rdd: func(t, prev_func(t, rdd))
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/spark/spark/python/lib/pyspark.zip/pyspark/streaming/dstream.py&quot;&lt;/span&gt;, line 616, in &amp;lt;lambda&amp;gt;
    self.func = lambda t, rdd: func(t, prev_func(t, rdd))
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/spark/spark/python/lib/pyspark.zip/pyspark/streaming/dstream.py&quot;&lt;/span&gt;, line 616, in &amp;lt;lambda&amp;gt;
    self.func = lambda t, rdd: func(t, prev_func(t, rdd))
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/spark/spark/python/lib/pyspark.zip/pyspark/streaming/dstream.py&quot;&lt;/span&gt;, line 616, in &amp;lt;lambda&amp;gt;
    self.func = lambda t, rdd: func(t, prev_func(t, rdd))
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/spark/spark/python/lib/pyspark.zip/pyspark/streaming/kafka.py&quot;&lt;/span&gt;, line 332, in &amp;lt;lambda&amp;gt;
    func = lambda t, rdd: oldfunc(rdd)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/spark/ad_realtime/batch/kafka_test.py&quot;&lt;/span&gt;, line 7, in attach_kafka_metadata
    offset_ranges = kafka_rdd.offsetRanges()
AttributeError: &lt;span class=&quot;code-quote&quot;&gt;&apos;RDD&apos;&lt;/span&gt; object has no attribute &lt;span class=&quot;code-quote&quot;&gt;&apos;offsetRanges&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12857345">SPARK-10122</key>
            <summary>AttributeError: &apos;RDD&apos; object has no attribute &apos;offsetRanges&apos;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jerryshao">Saisai Shao</assignee>
                                    <reporter username="aramesh">Amit Ramesh</reporter>
                        <labels>
                            <label>kafka</label>
                    </labels>
                <created>Wed, 19 Aug 2015 22:42:41 +0000</created>
                <updated>Thu, 26 Nov 2015 00:01:16 +0000</updated>
                            <resolved>Fri, 21 Aug 2015 20:19:23 +0000</resolved>
                                                    <fixVersion>1.5.0</fixVersion>
                                    <component>DStreams</component>
                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14703870" author="aramesh" created="Wed, 19 Aug 2015 22:49:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt; any ideas on what is going on here?&lt;/p&gt;</comment>
                            <comment id="14704500" author="srowen" created="Thu, 20 Aug 2015 08:24:34 +0000"  >&lt;p&gt;I don&apos;t think this is a bug. Yes, only the initial RDD is actually a Kafka RDD. You need to operate on it if you manipulate offset ranges.&lt;/p&gt;</comment>
                            <comment id="14704674" author="aramesh" created="Thu, 20 Aug 2015 10:49:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt; as you can see in the example, offsetRanges() is being applied to the initial RDD as part of the transform operation. And the code works fine if the line &apos;kafka_stream.transform(attach_kafka_metadata).count().pprint()&apos; is changed to &apos;kafka_stream.transform(attach_kafka_metadata).pprint()&apos;.&lt;/p&gt;</comment>
                            <comment id="14704701" author="srowen" created="Thu, 20 Aug 2015 11:23:55 +0000"  >&lt;p&gt;Ah I see now, you are not operating on the transformed stream resulting from count(); it comes after and not before in the example. &lt;/p&gt;

&lt;p&gt;This should be OK in the Scala API in my experience, but it looks like Python operates a little differently. When a transformation is applied to a transformed stream, it collapses the two transformations. So the count + kafka offset function are turned into one, which is applied to the raw DStream behind the Kafka DStream and it fails. I think.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davies&quot; class=&quot;user-hover&quot; rel=&quot;davies&quot;&gt;davies&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tdas&quot; class=&quot;user-hover&quot; rel=&quot;tdas&quot;&gt;tdas&lt;/a&gt; worth a look. It may be a case for not implementing the dstream transformation this way, if this guess is right.&lt;/p&gt;</comment>
                            <comment id="14704832" author="jerryshao" created="Thu, 20 Aug 2015 13:04:12 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=amitr%40hemtech.co.za&quot; class=&quot;user-hover&quot; rel=&quot;amitr@hemtech.co.za&quot;&gt;amitr@hemtech.co.za&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt;, as I remembered it should be worked, let me take a look at this.&lt;/p&gt;</comment>
                            <comment id="14706186" author="jerryshao" created="Fri, 21 Aug 2015 03:22:02 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aramesh&quot; class=&quot;user-hover&quot; rel=&quot;aramesh&quot;&gt;aramesh&lt;/a&gt;, thanks a lot for pointing this out. This is actually a bug, sorry for not covering it in the unit test.&lt;/p&gt;

&lt;p&gt;The problem is Python will compact a series of &lt;tt&gt;TransformedDStream&lt;/tt&gt; into one:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isinstance(prev, TransformedDStream) and
                not prev.is_cached and not prev.is_checkpointed):
            prev_func = prev.func
            self.func = lambda t, rdd: func(t, prev_func(t, rdd))
            self.prev = prev.prev
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As &lt;tt&gt;KafkaTransformedDStream&lt;/tt&gt; is a subclass of &lt;tt&gt;TransformedDStream&lt;/tt&gt;, so it will be compacted to replace with its parent DStream, as the code shows &lt;tt&gt;self.prev = prev.prev&lt;/tt&gt;, which is a DStream, get offset ranges on DStream will throw an exception as you mentioned before.&lt;/p&gt;

&lt;p&gt;I will submit a PR to fix this, so you could try with the patch to see if it is fixed.&lt;/p&gt;</comment>
                            <comment id="14706202" author="apachespark" created="Fri, 21 Aug 2015 03:33:03 +0000"  >&lt;p&gt;User &apos;jerryshao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/8347&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/8347&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14706286" author="aramesh" created="Fri, 21 Aug 2015 06:20:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt; thanks for jumping onto this right away! I tried your patch with the example I have provided in this ticket, and also with the original, more involved, code that we first witnessed this issue in and they both seem to be working fine &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="14706306" author="jerryshao" created="Fri, 21 Aug 2015 06:47:36 +0000"  >&lt;p&gt;Thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12916315">SPARK-12002</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12838096">SPARK-8389</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j4jb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>