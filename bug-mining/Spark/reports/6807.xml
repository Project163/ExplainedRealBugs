<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:07:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-29029] PhysicalOperation.collectProjectsAndFilters should use AttributeMap while substituting aliases</title>
                <link>https://issues.apache.org/jira/browse/SPARK-29029</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;We have a specific use case where in we are trying insert a custom logical operator in our logical plan to avoid some of the Spark&#8217;s optimization rules. However, we remove this logical operator as part of custom optimization rule before we send this to SparkStrategies.&lt;/p&gt;

&lt;p&gt;However, we are hitting issue in the following scenario:&lt;/p&gt;

&lt;p&gt;Analyzed plan:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[1] Project [userid#0]
+- [2] SubqueryAlias tmp6
   +- [3] Project [videoid#47L, avebitrate#2, userid#0]
      +- [4] Filter NOT (videoid#47L = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(30 as bigint))
         +- [5] SubqueryAlias tmp5
            +- [6] CustomBarrier
               +- [7] Project [videoid#47L, avebitrate#2, userid#0]
                  +- [8] Filter (avebitrate#2 &amp;lt; 10)
                     +- [9] SubqueryAlias tmp3
                        +- [10] Project [avebitrate#2, factorial(videoid#1) AS videoid#47L, userid#0]
                           +- [11] SubqueryAlias tmp2
                              +- [12] Project [userid#0, videoid#1, avebitrate#2]
                                 +- [13] SubqueryAlias tmp1
                                    +- [14] Project [userid#0, videoid#1, avebitrate#2]
                                       +- [15] SubqueryAlias views
                                          +- [16] Relation[userid#0,videoid#1,avebitrate#2] 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Optimized Plan:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[1] Project [userid#0]
+- [2] Filter (isnotnull(videoid#47L) &amp;amp;&amp;amp; NOT (videoid#47L = 30))
   +- [3] Project [factorial(videoid#1) AS videoid#47L, userid#0]
      +- [4] Filter (isnotnull(avebitrate#2) &amp;amp;&amp;amp; (avebitrate#2 &amp;lt; 10))
         +- [5] Relation[userid#0,videoid#1,avebitrate#2]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
 When this plan is passed into &lt;b&gt;PhysicalOperation&lt;/b&gt;&#160;in &lt;b&gt;DataSourceStrategy&lt;/b&gt;, the collectProjectsAndFilters collects filters as List&lt;a href=&quot;#47L), AttributeReference(avebitrate#2)&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;[&lt;ins&gt;AttributeReference(&quot;videoid#47L&quot;), AttributeReference(&quot;avebitrate#2&quot;)]&lt;/ins&gt;&lt;/a&gt;. However, at this stage the base relation only has videoid#1 and hence it throws exception saying &lt;b&gt;key not found: videoid#47L.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt; On looking further, noticed that the alias map in &lt;b&gt;PhysicalOperation.substitute&lt;/b&gt;&#160;does have the entry with key &lt;b&gt;videoid#47L&lt;/b&gt;&#160;-&amp;gt; Aliases Map((videoid#47L, factorial(videoid#1))). However, the substitute alias is not substituting the expression for alias videoid#47L because they differ in qualifier parameter.&lt;br/&gt;
 Attribute key in Alias: AttributeReference(&quot;videoid&quot;, LongType, nullable = true)(ExprId(47, _), &lt;b&gt;&quot;None&quot;&lt;/b&gt;)&lt;br/&gt;
 Attribute in Filter condition: AttributeReference(&quot;videoid&quot;, LongType, nullable = true)(ExprId(47, _), &lt;b&gt;&quot;Some(tmp5)&quot;&lt;/b&gt;)&lt;/p&gt;

&lt;p&gt;Both differ only in the qualifier, however for alias map if we use AttributeMap instead of Map&lt;span class=&quot;error&quot;&gt;&amp;#91;Attribute, Expression&amp;#93;&lt;/span&gt;, we can get rid of the above issue.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13255768">SPARK-29029</key>
            <summary>PhysicalOperation.collectProjectsAndFilters should use AttributeMap while substituting aliases</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nikitakonda">Nikita Konda</assignee>
                                    <reporter username="nikitakonda">Nikita Konda</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Sep 2019 00:47:10 +0000</created>
                <updated>Wed, 20 Nov 2019 04:07:31 +0000</updated>
                            <resolved>Wed, 20 Nov 2019 04:03:07 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>Optimizer</component>
                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16978049" author="dongjoon" created="Wed, 20 Nov 2019 04:03:07 +0000"  >&lt;p&gt;Issue resolved by pull request 25761&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/25761&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/25761&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 51 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z06hiw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>