<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:16:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-2677] BasicBlockFetchIterator#next can wait forever</title>
                <link>https://issues.apache.org/jira/browse/SPARK-2677</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;In BasicBlockFetchIterator#next, it waits fetch result on result.take.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    override def next(): (BlockId, Option[Iterator[Any]]) = {
      resultsGotten += 1
      val startFetchWait = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis()
      val result = results.take()
      val stopFetchWait = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis()
      _fetchWaitTime += (stopFetchWait - startFetchWait)
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (! result.failed) bytesInFlight -= result.size
      &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!fetchRequests.isEmpty &amp;amp;&amp;amp;
        (bytesInFlight == 0 || bytesInFlight + fetchRequests.front.size &amp;lt;= maxBytesInFlight)) {
        sendRequest(fetchRequests.dequeue())
      }
      (result.blockId, &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (result.failed) None &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; Some(result.deserialize()))
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But, results is implemented as LinkedBlockingQueue so if remote executor hang up, fetching Executor waits forever.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12729591">SPARK-2677</key>
            <summary>BasicBlockFetchIterator#next can wait forever</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sarutak">Kousuke Saruta</assignee>
                                    <reporter username="sarutak">Kousuke Saruta</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Jul 2014 21:58:31 +0000</created>
                <updated>Thu, 12 May 2016 10:21:13 +0000</updated>
                            <resolved>Sat, 16 Aug 2014 21:17:22 +0000</resolved>
                                    <version>0.9.2</version>
                    <version>1.0.0</version>
                    <version>1.0.1</version>
                                    <fixVersion>1.1.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14075672" author="pwendell" created="Sun, 27 Jul 2014 18:08:12 +0000"  >&lt;p&gt;Just as an FYI - this has been observed also in several earlier versions of Spark. I think one issue is that we don&apos;t have timeouts in the conneciton manger code. If a JVM goes into GC thrashing and becomes un-responsive (but still alive), then you can get stuck here.&lt;/p&gt;</comment>
                            <comment id="14075673" author="gq" created="Sun, 27 Jul 2014 18:14:19 +0000"  >&lt;p&gt;If &lt;tt&gt;yarn.scheduler.fair.preemption&lt;/tt&gt; is set to &lt;tt&gt;true&lt;/tt&gt; in production cluster, This issue will appear frequently.&lt;/p&gt;</comment>
                            <comment id="14076033" author="gq" created="Mon, 28 Jul 2014 09:00:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pwendell&quot; class=&quot;user-hover&quot; rel=&quot;pwendell&quot;&gt;pwendell&lt;/a&gt; , &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sarutak&quot; class=&quot;user-hover&quot; rel=&quot;sarutak&quot;&gt;sarutak&lt;/a&gt; How about the following solution?&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/1619&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/1619&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14076278" author="apachespark" created="Mon, 28 Jul 2014 15:01:22 +0000"  >&lt;p&gt;User &apos;witgo&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/1619&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/1619&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14077439" author="apachespark" created="Tue, 29 Jul 2014 06:40:50 +0000"  >&lt;p&gt;User &apos;sarutak&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/1632&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/1632&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14092355" author="sarutak" created="Mon, 11 Aug 2014 02:22:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-2538&quot; title=&quot;External aggregation in Python&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-2538&quot;&gt;&lt;del&gt;SPARK-2538&lt;/del&gt;&lt;/a&gt; was resolved but there is still this issue.&lt;br/&gt;
I tried to resolve this issue in &lt;a href=&quot;https://github.com/apache/spark/pull/1632&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/1632&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14255009" author="derrickburns" created="Sun, 21 Dec 2014 02:19:32 +0000"  >&lt;p&gt;Appear to still happen in 1.1.1:&lt;/p&gt;

&lt;p&gt;2014-12-20 22:54:00,574 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;connection-manager-thread&amp;#93;&lt;/span&gt; network.ConnectionManager (Logging.scala:logInfo(59)) - Key not valid ? sun.nio.ch.SelectionKeyImpl@6045fa68&lt;br/&gt;
2014-12-20 22:54:00,574 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;handle-read-write-executor-0&amp;#93;&lt;/span&gt; network.ConnectionManager (Logging.scala:logInfo(59)) - Removing SendingConnection to ConnectionManagerId(ip-10-89-134-186.us-west-2.compute.internal,49171)&lt;br/&gt;
2014-12-20 22:54:00,574 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;handle-read-write-executor-2&amp;#93;&lt;/span&gt; network.ConnectionManager (Logging.scala:logInfo(59)) - Removing ReceivingConnection to ConnectionManagerId(ip-10-89-134-186.us-west-2.compute.internal,49171)&lt;br/&gt;
2014-12-20 22:54:00,575 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;sparkDriver-akka.actor.default-dispatcher-14&amp;#93;&lt;/span&gt; cluster.YarnClientSchedulerBackend (Logging.scala:logInfo(59)) - Executor 7 disconnected, so removing it&lt;br/&gt;
2014-12-20 22:54:00,576 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;handle-read-write-executor-2&amp;#93;&lt;/span&gt; network.ConnectionManager (Logging.scala:logError(75)) - Corresponding SendingConnection to ConnectionManagerId(ip-10-89-134-186.us-west-2.compute.internal,49171) not found&lt;br/&gt;
2014-12-20 22:54:00,576 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;sparkDriver-akka.actor.default-dispatcher-14&amp;#93;&lt;/span&gt; cluster.YarnClientClusterScheduler (Logging.scala:logError(75)) - Lost executor 7 on ip-10-89-134-186.us-west-2.compute.internal: remote Akka client disassociated&lt;br/&gt;
2014-12-20 22:54:00,576 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;connection-manager-thread&amp;#93;&lt;/span&gt; network.ConnectionManager (Logging.scala:logInfo(80)) - key already cancelled ? sun.nio.ch.SelectionKeyImpl@6045fa68&lt;br/&gt;
java.nio.channels.CancelledKeyException&lt;br/&gt;
	at org.apache.spark.network.ConnectionManager.run(ConnectionManager.scala:392)&lt;br/&gt;
	at org.apache.spark.network.ConnectionManager$$anon$4.run(ConnectionManager.scala:145)&lt;/p&gt;</comment>
                            <comment id="15281402" author="fairchildljb" created="Thu, 12 May 2016 10:21:13 +0000"  >&lt;p&gt;It seems this issue still can occur on spark 1.5.2 release version&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12729651">SPARK-2681</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12730325">SPARK-2717</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>407665</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 27 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1y5cv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>407675</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327468">1.0.3</customfieldvalue>
    <customfieldvalue id="12326686">1.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>