<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:52:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-20270] na.fill will change the values in long or integer when the default value is in double</title>
                <link>https://issues.apache.org/jira/browse/SPARK-20270</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;This bug was partially addressed in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-18555&quot; title=&quot;na.fill miss up original values in long integers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-18555&quot;&gt;&lt;del&gt;SPARK-18555&lt;/del&gt;&lt;/a&gt;, but the root cause isn&apos;t completely solved. This bug is pretty critical since it changes the member id in Long in our application if the member id can not be represented by Double losslessly when the member id is very big. &lt;/p&gt;

&lt;p&gt;Here is an example how this happens, with&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;      Seq[(java.lang.&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, java.lang.&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;)]((&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, 3.14), (9123146099426677101L, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;),
        (9123146560113991650L, 1.6), (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;).na.fill(0.2),
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the logical plan will be&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;== Analyzed Logical Plan ==
a: bigint, b: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;
Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(a#232L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(0.2 as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)) as bigint) AS a#240L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(coalesce(nanvl(b#233, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)), 0.2) as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) AS b#241]
+- Project [_1#229L AS a#232L, _2#230 AS b#233]
   +- LocalRelation [_1#229L, _2#230]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;.&lt;br/&gt;
Note that even the value is not null, Spark will cast the Long into Double first. Then if it&apos;s not null, Spark will cast it back to Long which results in losing precision. &lt;/p&gt;

&lt;p&gt;The behavior should be that the original value should not be changed if it&apos;s not null, but Spark will change the value which is wrong.&lt;/p&gt;

&lt;p&gt;With the PR, the logical plan will be &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;== Analyzed Logical Plan ==
a: bigint, b: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;
Project [coalesce(a#232L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(0.2 as bigint)) AS a#240L, coalesce(nanvl(b#233, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(0.2 as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)) AS b#241]
+- Project [_1#229L AS a#232L, _2#230 AS b#233]
   +- LocalRelation [_1#229L, _2#230]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which behaves correctly without changing the original Long values.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13062707">SPARK-20270</key>
            <summary>na.fill will change the values in long or integer when the default value is in double</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dbtsai">DB Tsai</assignee>
                                    <reporter username="dbtsai">DB Tsai</reporter>
                        <labels>
                    </labels>
                <created>Sun, 9 Apr 2017 07:57:32 +0000</created>
                <updated>Tue, 11 Apr 2017 00:16:37 +0000</updated>
                            <resolved>Mon, 10 Apr 2017 05:17:06 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>2.0.1</version>
                    <version>2.0.2</version>
                    <version>2.1.0</version>
                                    <fixVersion>2.0.3</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15962065" author="apachespark" created="Sun, 9 Apr 2017 08:05:04 +0000"  >&lt;p&gt;User &apos;dbtsai&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17577&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17577&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15962436" author="dbtsai" created="Mon, 10 Apr 2017 05:17:06 +0000"  >&lt;p&gt;Issue resolved by pull request 17577&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17577&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17577&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 32 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3dejb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>