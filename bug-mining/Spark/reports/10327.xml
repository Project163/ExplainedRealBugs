<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:49:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-53900] Thread.wait(0) unintentionally called under rare conditions in ExecuteGrpcResponseSender</title>
                <link>https://issues.apache.org/jira/browse/SPARK-53900</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;A bug in ExecuteGrpcResponseSender causes RPC streams to hang indefinitely when the configured deadline passes. The bug was introduced in &lt;a href=&quot;https://github.com/apache/spark/pull/49003/files#diff-d4629281431427e41afd6d3db6630bcfdbfdbf77ba74cf7e48a988c1b66c13f1L244-L253]&quot; title=&quot;https://github.com/apache/spark/pull/49003/files#diff-d4629281431427e41afd6d3db6630bcfdbfdbf77ba74cf7e48a988c1b66c13f1L244-L253&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;[PR&lt;/a&gt;&#160;during migration from System.currentTimeMillis() to System.nanoTime(), where an integer division error converts sub-millisecond timeout values to 0, triggering Java&apos;s wait(0) behavior (infinite wait).&lt;/p&gt;
&lt;h2&gt;&lt;a name=&quot;RootCause&quot;&gt;&lt;/a&gt;Root Cause&lt;/h2&gt;
&lt;p&gt;executionObserver.responseLock.wait(timeoutNs / NANOS_PER_MILLIS) &#160;// &#8592; BUG&lt;br/&gt;
&lt;b&gt;The Problem&lt;/b&gt;: When deadlineTimeNs &amp;lt; System.nanoTime() (deadline has passed):&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Math.max(1, negative_value) clamps to 1 nanosecond&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;Math.min(progressInterval_ns, 1) remains 1 nanosecond&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;Integer division: 1 / 1,000,000 = 0 milliseconds&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;wait(0) in Java means &lt;b&gt;wait indefinitely until notified&lt;/b&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;No notification arrives (execution already completed), thread hangs forever&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;While one the loop conditions&#160;guards against deadlineTimeNs &amp;lt; System.nanoTime(), it isn&#8217;t sufficient as the deadline can elapse while inside the loop (the time is freshly fetched in the latter timeout calculation). The probability of occurence can exacerbated by GC pauses&lt;/p&gt;
&lt;h2&gt;&lt;a name=&quot;ConditionsRequiredforBugtoTrigger&quot;&gt;&lt;/a&gt;Conditions Required for Bug to Trigger&lt;/h2&gt;

&lt;p&gt;The bug manifests when &lt;b&gt;all&lt;/b&gt; of the following conditions are met:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;b&gt;Reattachable execution enabled&lt;/b&gt; (CONNECT_EXECUTE_REATTACHABLE_ENABLED = true)&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;&lt;b&gt;Execution completes prior&lt;/b&gt; to the deadline within the inner loop&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;(all responses sent before deadline)&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;&lt;b&gt;Deadline passes&lt;/b&gt; within the inner loop&lt;/li&gt;
&lt;/ol&gt;


&lt;h2&gt;&lt;a name=&quot;Proposedfix&quot;&gt;&lt;/a&gt;Proposed fix&lt;/h2&gt;

&lt;p&gt;Have timeoutNs always contain a positive value.&lt;br/&gt;
executionObserver.responseLock.wait(Math.max(1, timeoutNs / NANOS_PER_MILLIS))&lt;/p&gt;</description>
                <environment></environment>
        <key id="13631511">SPARK-53900</key>
            <summary>Thread.wait(0) unintentionally called under rare conditions in ExecuteGrpcResponseSender</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vicennial">Venkata Sai Akhil Gudesa</assignee>
                                    <reporter username="vicennial">Venkata Sai Akhil Gudesa</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 14 Oct 2025 12:42:32 +0000</created>
                <updated>Fri, 24 Oct 2025 05:13:24 +0000</updated>
                            <resolved>Tue, 14 Oct 2025 16:05:14 +0000</resolved>
                                    <version>0.5.0</version>
                    <version>4.1.0</version>
                    <version>4.0.0</version>
                    <version>4.0.1</version>
                    <version>4.0.2</version>
                                    <fixVersion>4.1.0</fixVersion>
                    <fixVersion>4.0.2</fixVersion>
                                    <component>Connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="18029817" author="hvanhovell" created="Tue, 14 Oct 2025 16:05:14 +0000"  >&lt;p&gt;Issue resolved by pull request 52609&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/52609&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/52609&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1y4zs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>