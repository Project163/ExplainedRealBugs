<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:34:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-11555] spark on yarn spark-class --num-workers doesn&apos;t work</title>
                <link>https://issues.apache.org/jira/browse/SPARK-11555</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Using the old spark-class and --num-workers interface, --num-workers parameter is ignored and always uses default number of executors (2).&lt;/p&gt;


&lt;p&gt;bin/spark-class org.apache.spark.deploy.yarn.Client --jar lib/spark-examples-1.5.2.0-hadoop2.6.0.16.1506060127.jar --class org.apache.spark.examples.SparkPi --num-workers 4 --worker-memory 2g --master-memory 1g --worker-cores 1 --queue default&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12911061">SPARK-11555</key>
            <summary>spark on yarn spark-class --num-workers doesn&apos;t work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tgraves">Thomas Graves</assignee>
                                    <reporter username="tgraves">Thomas Graves</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Nov 2015 14:27:05 +0000</created>
                <updated>Sun, 17 May 2020 18:17:01 +0000</updated>
                            <resolved>Fri, 6 Nov 2015 23:29:39 +0000</resolved>
                                    <version>1.5.2</version>
                                    <fixVersion>1.5.3</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>Spark Core</component>
                    <component>YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14993741" author="tgraves" created="Fri, 6 Nov 2015 14:29:25 +0000"  >&lt;p&gt;Note I think this was broken with change for &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-10790&quot; title=&quot;Dynamic Allocation does not request any executors if first stage needs less than or equal to spark.dynamicAllocation.initialExecutors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-10790&quot;&gt;&lt;del&gt;SPARK-10790&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14993742" author="srowen" created="Fri, 6 Nov 2015 14:34:22 +0000"  >&lt;p&gt;num-executors? I&apos;m sure we&apos;ve just recently adjusted or fixed this. Are you sure you&apos;re on the latest?&lt;/p&gt;

&lt;p&gt;This case appears to be handled already in &lt;tt&gt;ClientArguments.scala&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (numExecutors &amp;lt; 0 || (!isDynamicAllocationEnabled &amp;amp;&amp;amp; numExecutors == 0)) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(
        s&quot;&quot;&quot;
           |&lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of executors was $numExecutors, but must be at least 1
           |(or 0 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; dynamic executor allocation is enabled).
           |${getUsageMessage()}
         &quot;&quot;&quot;.stripMargin)
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Do you have # executors configured elsewhere and it&apos;s overriding? that is, what is the actual effect? you end up with 0 executors or an error or what?&lt;/p&gt;</comment>
                            <comment id="14993750" author="tgraves" created="Fri, 6 Nov 2015 14:39:41 +0000"  >&lt;p&gt;I should probably rephrase because after looking a bit, its actually starting it with 2 executors due to changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-10790&quot; title=&quot;Dynamic Allocation does not request any executors if first stage needs less than or equal to spark.dynamicAllocation.initialExecutors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-10790&quot;&gt;&lt;del&gt;SPARK-10790&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;That changes the number of executors without taking into account the --num-workers argument so it uses DEFAULT_NUMBER_EXECUTORS.&lt;/p&gt;</comment>
                            <comment id="14993760" author="srowen" created="Fri, 6 Nov 2015 14:47:33 +0000"  >&lt;p&gt;To be clear, you are also talking about --num-executors right? --num-workers is not something you would use with YARN in general, but is an alias.&lt;/p&gt;

&lt;p&gt;Have you set &lt;tt&gt;SPARK_EXECUTOR_INSTANCES&lt;/tt&gt; and that&apos;s overriding what&apos;s on the command line? that looks like an intentional change when the two versions of this logic were combined.&lt;/p&gt;</comment>
                            <comment id="14993765" author="tgraves" created="Fri, 6 Nov 2015 14:50:35 +0000"  >&lt;p&gt;No I&apos;m talking about --num-workers, see the usage in the description above.  Its the old interface before spark-submit.&lt;/p&gt;</comment>
                            <comment id="14993775" author="tgraves" created="Fri, 6 Nov 2015 14:59:26 +0000"  >&lt;p&gt;Note that it is broken with --num-executors also when using the Client interface directly.  Both go through same logic.&lt;/p&gt;

&lt;p&gt;case (&quot;-&lt;del&gt;num-workers&quot; | &quot;&lt;/del&gt;-num-executors&quot;) :: IntParam(value) :: tail =&amp;gt;&lt;br/&gt;
          if (args(0) == &quot;--num-workers&quot;) &lt;/p&gt;
{
            println(&quot;--num-workers is deprecated. Use --num-executors instead.&quot;)
          }
&lt;p&gt;          numExecutors = value&lt;br/&gt;
          args = tail&lt;/p&gt;</comment>
                            <comment id="14993779" author="srowen" created="Fri, 6 Nov 2015 15:03:41 +0000"  >&lt;p&gt;OK, that still passes through &lt;tt&gt;ClientArguments.scala&lt;/tt&gt;, which parses num-executors and warns you if you&apos;re using the old arg but that&apos;s not important.&lt;/p&gt;

&lt;p&gt;The flow is the same so it might not even be specific to spark-class. I see that it correctly parses your flag but then overwrites unilaterally with the value of spark.executor.instances, which isn&apos;t set yet, which defaults to the default of 2. Before, it would default to the current &lt;tt&gt;numExecutors&lt;/tt&gt;. It was basically this change:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/pull/8910/files#diff-746d34aa06bfa57adb9289011e725472R84&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/8910/files#diff-746d34aa06bfa57adb9289011e725472R84&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It collapsed two similar blocks of initialization but the way it works then changed. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt; what do you think?&lt;/p&gt;</comment>
                            <comment id="14993783" author="srowen" created="Fri, 6 Nov 2015 15:05:34 +0000"  >&lt;p&gt;Oops, somehow my priority change got flicked the wrong way. I think this one is fairly important!&lt;/p&gt;</comment>
                            <comment id="14993815" author="tgraves" created="Fri, 6 Nov 2015 15:31:25 +0000"  >&lt;p&gt;To fix this we can simply pass in an optional numExecutors as a second parameter and have it default to DEFAULT_NUMBER_EXECUTORS.  I&apos;ll have a patch up shortly after testing.&lt;/p&gt;</comment>
                            <comment id="14993966" author="apachespark" created="Fri, 6 Nov 2015 16:58:05 +0000"  >&lt;p&gt;User &apos;tgravescs&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9523&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2o287:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>