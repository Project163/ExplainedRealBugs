<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:34:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-11265] YarnClient can&apos;t get tokens to talk to Hive 1.2.1 in a secure cluster</title>
                <link>https://issues.apache.org/jira/browse/SPARK-11265</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;As reported on the dev list, trying to run a YARN client which wants to talk to Hive in a Kerberized hadoop cluster fails.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Kerberized Hadoop cluster&lt;/p&gt;</environment>
        <key id="12907196">SPARK-11265</key>
            <summary>YarnClient can&apos;t get tokens to talk to Hive 1.2.1 in a secure cluster</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stevel@apache.org">Steve Loughran</assignee>
                                    <reporter username="stevel@apache.org">Steve Loughran</reporter>
                        <labels>
                            <label>backport-needed</label>
                    </labels>
                <created>Thu, 22 Oct 2015 20:07:59 +0000</created>
                <updated>Fri, 5 Feb 2016 16:23:15 +0000</updated>
                            <resolved>Wed, 4 Nov 2015 19:09:53 +0000</resolved>
                                    <version>1.5.1</version>
                                    <fixVersion>1.5.3</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14969818" author="stevel@apache.org" created="Thu, 22 Oct 2015 20:17:19 +0000"  >&lt;p&gt;Initial report from  Chester Chen&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
  This is tested against the 

   spark 1.5.1 ( branch 1.5  with label 1.5.2-SNAPSHOT with commit on Tue Oct 6, 84f510c4fa06e43bd35e2dc8e1008d0590cbe266)  

   Spark deployment mode : Spark-Cluster

   Notice that if we enable Kerberos mode, the spark yarn client fails with the following: 

Could not initialize class org.apache.hadoop.hive.ql.metadata.Hive
java.lang.NoClassDefFoundError: Could not initialize class org.apache.hadoop.hive.ql.metadata.Hive
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at org.apache.spark.deploy.yarn.Client$.org$apache$spark$deploy$yarn$Client$$obtainTokenForHiveMetastore(Client.scala:1252)
        at org.apache.spark.deploy.yarn.Client.prepareLocalResources(Client.scala:271)
        at org.apache.spark.deploy.yarn.Client.createContainerLaunchContext(Client.scala:629)
        at org.apache.spark.deploy.yarn.Client.submitApplication(Client.scala:119)
        at org.apache.spark.deploy.yarn.Client.run(Client.scala:907)


Diving in Yarn Client.scala code and tested against different dependencies and notice the followings:  if  the kerberos mode is enabled, Client.obtainTokenForHiveMetastore() will try to use scala reflection to get Hive and HiveConf and method on these method. 
 
      val hiveClass = mirror.classLoader.loadClass(&quot;org.apache.hadoop.hive.ql.metadata.Hive&quot;)
      val hive = hiveClass.getMethod(&quot;get&quot;).invoke(null)

      val hiveConf = hiveClass.getMethod(&quot;getConf&quot;).invoke(hive)
      val hiveConfClass = mirror.classLoader.loadClass(&quot;org.apache.hadoop.hive.conf.HiveConf&quot;)

      val hiveConfGet = (param: String) =&amp;gt; Option(hiveConfClass
        .getMethod(&quot;get&quot;, classOf[java.lang.String])
        .invoke(hiveConf, param))

   If the &quot;org.spark-project.hive&quot; % &quot;hive-exec&quot; % &quot;1.2.1.spark&quot; is used, then you will get above exception. But if we use the 
       &quot;org.apache.hive&quot; % &quot;hive-exec&quot; &quot;0.13.1-cdh5.2.0&quot; 
 The above method will not throw exception. 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14970930" author="stevel@apache.org" created="Fri, 23 Oct 2015 13:06:03 +0000"  >&lt;p&gt;I can trigger a failure in a unit test now, once you get pass Hive failing to load (classpath issue), the &lt;tt&gt;get()&lt;/tt&gt; operation fails&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; obtain Tokens For HiveMetastore *** FAILED ***  java.lang.IllegalArgumentException: wrong number of arguments
  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
  at java.lang.reflect.Method.invoke(Method.java:606)
  at org.apache.spark.deploy.yarn.YarnSparkHadoopUtil.obtainTokenForHiveMetastoreInner(YarnSparkHadoopUtil.scala:203)
  at org.apache.spark.deploy.yarn.YarnSparkHadoopUtilSuite$$anonfun$22.apply(YarnSparkHadoopUtilSuite.scala:254)
  at org.apache.spark.deploy.yarn.YarnSparkHadoopUtilSuite$$anonfun$22.apply(YarnSparkHadoopUtilSuite.scala:249)
  at org.scalatest.Transformer$$anonfun$apply$1.apply$mcV$sp(Transformer.scala:22)
  at org.scalatest.OutcomeOf$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;outcomeOf(OutcomeOf.scala:85)
  at org.scalatest.OutcomeOf$.outcomeOf(OutcomeOf.scala:104)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14971188" author="stevel@apache.org" created="Fri, 23 Oct 2015 15:39:51 +0000"  >&lt;p&gt;Pull request is : &lt;a href=&quot;https://github.com/apache/spark/pull/9232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9232&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14971190" author="apachespark" created="Fri, 23 Oct 2015 15:40:04 +0000"  >&lt;p&gt;User &apos;steveloughran&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9232&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14974239" author="stevel@apache.org" created="Mon, 26 Oct 2015 14:08:00 +0000"  >&lt;p&gt;What&apos;s changed?&lt;/p&gt;

&lt;p&gt;The spark code uses reflection to get the method &lt;tt&gt;(&quot;org.apache.hadoop.hive.ql.metadata.Hive#get&quot;)&lt;/tt&gt;, then invokes it with a single argument: &lt;tt&gt;hive = hiveClass.getMethod(&quot;get&quot;).invoke(null, hiveConf.asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;Object&amp;#93;&lt;/span&gt;)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Hive 0.13 has &amp;gt;1 method; it has, in order, &lt;tt&gt;get(HiveConf&lt;/tt&gt;, &lt;tt&gt;get(HiveConf, boolean)&lt;/tt&gt;, and &lt;tt&gt;get()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Hive 1.2.1 adds one new method &lt;tt&gt;get(Configuration c, Class&amp;lt;?&amp;gt; clazz)&lt;/tt&gt; &lt;b&gt;before&lt;/b&gt; the others, and now invoke is failing as the returned method doesn&apos;t take a HiveConf.&lt;/p&gt;

&lt;p&gt;What could have been happening here is that the &lt;tt&gt;Class.get()&lt;/tt&gt; method was returning the &lt;tt&gt;get(HiveConf&lt;/tt&gt; method because it was first in the file, and on 1.2.1 the new method returned the new one, which didn&apos;t take a single &lt;tt&gt;HiveConf&lt;/tt&gt;, hence the stack trace&lt;/p&gt;

&lt;p&gt;The fix, under all of it, is simply getting the method &lt;tt&gt;get(HiveConf.class)&lt;/tt&gt;, and invoking it with the configuration created by reflection. That&apos;s all: explicitly asking for a method that&apos;s always been there. The code probably worked before just because nobody was looking at it.&lt;/p&gt;</comment>
                            <comment id="14987583" author="apachespark" created="Tue, 3 Nov 2015 16:43:04 +0000"  >&lt;p&gt;User &apos;steveloughran&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9438&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9438&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14987584" author="stevel@apache.org" created="Tue, 3 Nov 2015 16:43:40 +0000"  >&lt;p&gt;re-opening for backport to branch-1.5&lt;/p&gt;</comment>
                            <comment id="14989368" author="apachespark" created="Wed, 4 Nov 2015 11:20:06 +0000"  >&lt;p&gt;User &apos;steveloughran&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9466&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9466&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12907401">HIVE-12243</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12911772">HADOOP-12563</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12920443">SPARK-12241</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12907945">SPARK-11317</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2neen:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333969">1.5.3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>