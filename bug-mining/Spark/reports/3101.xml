<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:38:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-12363] PowerIterationClustering test case failed if we deprecated KMeans.setRuns</title>
                <link>https://issues.apache.org/jira/browse/SPARK-12363</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;We plan to deprecated `runs` of KMeans, PowerIterationClustering will leverage KMeans to train model.&lt;br/&gt;
I removed `setRuns` used in PowerIterationClustering, but one of the test cases failed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12922307">SPARK-12363</key>
            <summary>PowerIterationClustering test case failed if we deprecated KMeans.setRuns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="yanboliang">Yanbo Liang</reporter>
                        <labels>
                            <label>backport-needed</label>
                    </labels>
                <created>Wed, 16 Dec 2015 09:30:16 +0000</created>
                <updated>Fri, 26 Feb 2016 05:16:52 +0000</updated>
                            <resolved>Tue, 23 Feb 2016 07:44:10 +0000</resolved>
                                    <version>1.3.1</version>
                    <version>1.4.1</version>
                    <version>1.5.2</version>
                    <version>1.6.0</version>
                    <version>2.0.0</version>
                                    <fixVersion>1.3.2</fixVersion>
                    <fixVersion>1.4.2</fixVersion>
                    <fixVersion>1.5.3</fixVersion>
                    <fixVersion>1.6.1</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>MLlib</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15059753" author="yanboliang" created="Wed, 16 Dec 2015 09:35:05 +0000"  >&lt;p&gt;This bug is very easy to reproduce. After I removed &lt;a href=&quot;https://github.com/apache/spark/blob/master/mllib/src/main/scala/org/apache/spark/mllib/clustering/PowerIterationClustering.scala#L388&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this line&lt;/a&gt;, one of the test cases failed.&lt;br/&gt;
I pasted the test cases here. It&apos;s very strange that the following two cases are based on the same dataset, but one success and the other failed.&lt;br/&gt;
Another clue is that when use `setInitializationMode(&quot;degree&quot;)` to train the PIC model, both the following two cases can pass. But if we use `setInitializationMode(&quot;random&quot;)`, the second test case will failed.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;test(&lt;span class=&quot;code-quote&quot;&gt;&quot;power iteration clustering&quot;&lt;/span&gt;) {
    /*
     We use the following graph to test PIC. All edges are assigned similarity 1.0 except 0.1 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
     edge (3, 4).
     15-14 -13 -12
     |           |
     4 . 3 - 2  11
     |   | x |   |
     5   0 - 1  10
     |           |
     6 - 7 - 8 - 9
     */

    val similarities = Seq[(&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;)]((0, 1, 1.0), (0, 2, 1.0), (0, 3, 1.0), (1, 2, 1.0),
      (1, 3, 1.0), (2, 3, 1.0), (3, 4, 0.1), &lt;span class=&quot;code-comment&quot;&gt;// (3, 4) is a weak edge
&lt;/span&gt;      (4, 5, 1.0), (4, 15, 1.0), (5, 6, 1.0), (6, 7, 1.0), (7, 8, 1.0), (8, 9, 1.0), (9, 10, 1.0),
      (10, 11, 1.0), (11, 12, 1.0), (12, 13, 1.0), (13, 14, 1.0), (14, 15, 1.0))
    val model = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PowerIterationClustering()
      .setK(2)
      .run(sc.parallelize(similarities, 2))
    val predictions = Array.fill(2)(mutable.Set.empty[&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;])
    model.assignments.collect().foreach { a =&amp;gt;
      predictions(a.cluster) += a.id
    }
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;(predictions.toSet == Set((0 to 3).toSet, (4 to 15).toSet))

    val model2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PowerIterationClustering()
      .setK(2)
      .setInitializationMode(&lt;span class=&quot;code-quote&quot;&gt;&quot;degree&quot;&lt;/span&gt;)
      .run(sc.parallelize(similarities, 2))
    val predictions2 = Array.fill(2)(mutable.Set.empty[&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;])
    model2.assignments.collect().foreach { a =&amp;gt;
      predictions2(a.cluster) += a.id
    }
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;(predictions2.toSet == Set((0 to 3).toSet, (4 to 15).toSet))
  }

  test(&lt;span class=&quot;code-quote&quot;&gt;&quot;power iteration clustering on graph&quot;&lt;/span&gt;) {
    /*
     We use the following graph to test PIC. All edges are assigned similarity 1.0 except 0.1 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
     edge (3, 4).
     15-14 -13 -12
     |           |
     4 . 3 - 2  11
     |   | x |   |
     5   0 - 1  10
     |           |
     6 - 7 - 8 - 9
     */

    val similarities = Seq[(&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;)]((0, 1, 1.0), (0, 2, 1.0), (0, 3, 1.0), (1, 2, 1.0),
      (1, 3, 1.0), (2, 3, 1.0), (3, 4, 0.1), &lt;span class=&quot;code-comment&quot;&gt;// (3, 4) is a weak edge
&lt;/span&gt;      (4, 5, 1.0), (4, 15, 1.0), (5, 6, 1.0), (6, 7, 1.0), (7, 8, 1.0), (8, 9, 1.0), (9, 10, 1.0),
      (10, 11, 1.0), (11, 12, 1.0), (12, 13, 1.0), (13, 14, 1.0), (14, 15, 1.0))

    val edges = similarities.flatMap { &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; (i, j, s) =&amp;gt;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i != j) {
        Seq(Edge(i, j, s), Edge(j, i, s))
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        None
      }
    }
    val graph = Graph.fromEdges(sc.parallelize(edges, 2), 0.0)

    val model = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PowerIterationClustering()
      .setK(2)
      .run(graph)
    val predictions = Array.fill(2)(mutable.Set.empty[&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;])
    model.assignments.collect().foreach { a =&amp;gt;
      predictions(a.cluster) += a.id
    }
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;(predictions.toSet == Set((0 to 3).toSet, (4 to 15).toSet))

    val model2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PowerIterationClustering()
      .setK(2)
      .setInitializationMode(&lt;span class=&quot;code-quote&quot;&gt;&quot;degree&quot;&lt;/span&gt;)
      .run(sc.parallelize(similarities, 2))
    val predictions2 = Array.fill(2)(mutable.Set.empty[&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;])
    model2.assignments.collect().foreach { a =&amp;gt;
      predictions2(a.cluster) += a.id
    }
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;(predictions2.toSet == Set((0 to 3).toSet, (4 to 15).toSet))
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15059763" author="yanboliang" created="Wed, 16 Dec 2015 09:44:32 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mengxr&quot; class=&quot;user-hover&quot; rel=&quot;mengxr&quot;&gt;mengxr&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=josephkb&quot; class=&quot;user-hover&quot; rel=&quot;josephkb&quot;&gt;josephkb&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt; Would you mind to take a look at this issue?&lt;/p&gt;</comment>
                            <comment id="15060862" author="josephkb" created="Wed, 16 Dec 2015 21:06:28 +0000"  >&lt;p&gt;Thanks for identifying this.  What do the predictions look like?  Does it improve if you increase the number of iterations KMeans runs for when called from PIC?&lt;/p&gt;

&lt;p&gt;It seems like an intuitively reasonable test, but I could see it failing for bad initial cluster centers or if KMeans needs to run for more iterations.&lt;/p&gt;</comment>
                            <comment id="15060865" author="josephkb" created="Wed, 16 Dec 2015 21:07:03 +0000"  >&lt;p&gt;Setting priority to Minor since we&apos;ll notice this bug when it becomes a bug.&lt;/p&gt;</comment>
                            <comment id="15061761" author="yanboliang" created="Thu, 17 Dec 2015 09:12:12 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Does it improve if you increase the number of iterations KMeans runs for when called from PIC?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;No, it converged in 1 iterations in any condition.&lt;/p&gt;

&lt;p&gt;I&apos;m confused that we have two test case:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;test(&lt;span class=&quot;code-quote&quot;&gt;&quot;power iteration clustering&quot;&lt;/span&gt;)
test(&lt;span class=&quot;code-quote&quot;&gt;&quot;power iteration clustering on graph&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;They use the same input data, but call different train API. &lt;br/&gt;
It should get same result theoretically, but the first test case succeed and the second one failed.&lt;/p&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=josephkb&quot; class=&quot;user-hover&quot; rel=&quot;josephkb&quot;&gt;josephkb&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="15146268" author="mengxr" created="Sun, 14 Feb 2016 00:02:26 +0000"  >&lt;p&gt;This bug was fixed by &lt;a href=&quot;https://github.com/apache/spark/pull/10539&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10539&lt;/a&gt; and the fix was merged into master, branch-1.6, and branch-1.5. I left the JIRA open for branch-1.4 and branch-1.3 backports.&lt;/p&gt;</comment>
                            <comment id="15146538" author="srowen" created="Sun, 14 Feb 2016 13:06:34 +0000"  >&lt;p&gt;Is it realistic to expect another 1.3 or 1.4 release? I am not even sure 1.5.3 will be formally released&lt;/p&gt;</comment>
                            <comment id="15153903" author="apachespark" created="Fri, 19 Feb 2016 08:33:05 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/11264&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/11264&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15153933" author="apachespark" created="Fri, 19 Feb 2016 08:54:03 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/11265&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/11265&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15158483" author="mengxr" created="Tue, 23 Feb 2016 07:44:10 +0000"  >&lt;p&gt;Issue resolved by pull request 11264&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/11264&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/11264&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15158488" author="mengxr" created="Tue, 23 Feb 2016 07:46:47 +0000"  >&lt;p&gt;I think it is still useful to backport the fix. People may maintain their own releases and there are definitely many Spark 1.4 users.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12937335">SPARK-13226</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12939678">SPARK-13355</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12911185">SPARK-11559</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pyu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311620" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Shepherd</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>mengxr</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329871">1.3.2</customfieldvalue>
    <customfieldvalue id="12332833">1.4.2</customfieldvalue>
    <customfieldvalue id="12333969">1.5.3</customfieldvalue>
    <customfieldvalue id="12334009">1.6.1</customfieldvalue>
    <customfieldvalue id="12329449">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>