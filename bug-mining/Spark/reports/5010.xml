<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:54:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-21376] Token is not renewed in yarn client process in cluster mode</title>
                <link>https://issues.apache.org/jira/browse/SPARK-21376</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;STR:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Set below config in spark-default.conf
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;spark.yarn.security.credentials.hbase.enabled &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
spark.hbase.connector.security.credentials.enabled &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Set below config in hdfs-site.xml
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&apos;dfs.namenode.delegation.token.max-lifetime&apos;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&apos;43200000&apos;&lt;/span&gt;
&lt;span class=&quot;code-quote&quot;&gt;&apos;dfs.namenode.delegation.token.renew-interval&apos;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&apos;28800000&apos;&lt;/span&gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Run HDFSWordcount streaming app in yarn-cluster mode  for 25 hrs.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;After 25 hours, noticing that HDFS Wordcount job is hitting HDFS_DELEGATION_TOKEN renewal issue. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;17/06/28 10:49:47 WARN Client: Exception encountered &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; connecting to the server : org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.security.token.SecretManager$InvalidToken): token (HDFS_DELEGATION_TOKEN token 230 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; hrt_qa) is expired
17/06/28 10:49:47 WARN Client: Failed to cleanup staging dir hdfs:&lt;span class=&quot;code-comment&quot;&gt;//mycluster0/user/hrt_qa/.sparkStaging/application_1498539861056_0015
&lt;/span&gt;org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.security.token.SecretManager$InvalidToken): token (HDFS_DELEGATION_TOKEN token 230 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; hrt_qa) is expired
        at org.apache.hadoop.ipc.Client.getRpcResponse(Client.java:1554)
        at org.apache.hadoop.ipc.Client.call(Client.java:1498)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13086348">SPARK-21376</key>
            <summary>Token is not renewed in yarn client process in cluster mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jerryshao">Saisai Shao</assignee>
                                    <reporter username="yeshavora">Yesha Vora</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Jul 2017 18:47:41 +0000</created>
                <updated>Sun, 17 May 2020 18:14:12 +0000</updated>
                            <resolved>Thu, 13 Jul 2017 22:26:29 +0000</resolved>
                                    <version>2.1.1</version>
                    <version>2.2.0</version>
                                    <fixVersion>2.2.1</fixVersion>
                    <fixVersion>2.3.0</fixVersion>
                                    <component>Spark Core</component>
                    <component>YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16082857" author="jerryshao" created="Tue, 11 Jul 2017 19:50:21 +0000"  >&lt;p&gt;I will work on this, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yeshavora&quot; class=&quot;user-hover&quot; rel=&quot;yeshavora&quot;&gt;yeshavora&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16084075" author="tgraves" created="Wed, 12 Jul 2017 14:40:47 +0000"  >&lt;p&gt;Can you please clarify the title and description?  What do you mean by &quot;in yarn client process in cluster mode&quot;?  I assume you were running in yarn cluster mode but what is the yarn client process?  the application master?&lt;/p&gt;</comment>
                            <comment id="16084270" author="jerryshao" created="Wed, 12 Jul 2017 16:38:23 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tgraves&quot; class=&quot;user-hover&quot; rel=&quot;tgraves&quot;&gt;tgraves&lt;/a&gt;, it is the local yarn launcher process which will launch Spark application on yarn cluster. The problem here is that local launcher process will always keep the initial token and not get renewed, so when application is killed then local launcher process will try to delete the staging files, and using this initial token will be failed in long running scenario.&lt;/p&gt;</comment>
                            <comment id="16084458" author="tgraves" created="Wed, 12 Jul 2017 18:28:05 +0000"  >&lt;p&gt;so you are referring to the org.apache.spark.launcher.SparkLauncher code that is launching a yarn cluster mode job?  or what do you mean by &quot;local yarn launcher process&quot;?&lt;/p&gt;</comment>
                            <comment id="16084460" author="jerryshao" created="Wed, 12 Jul 2017 18:31:18 +0000"  >&lt;p&gt;I&apos;m referrring to o.a.s.deploy.yarn.Client this class, it will monitor yarn application and try to delete staging files when application is finished.&lt;/p&gt;</comment>
                            <comment id="16085160" author="apachespark" created="Thu, 13 Jul 2017 04:06:03 +0000"  >&lt;p&gt;User &apos;jerryshao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18617&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18617&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 18 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hdz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>