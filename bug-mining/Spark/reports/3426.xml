<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:41:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-15059] Fine-grained class loader lock in ChildFirstURLClassLoader caused dead locks</title>
                <link>https://issues.apache.org/jira/browse/SPARK-15059</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Two threads in executors are locked by each other when loading the same class concurrently using ChildFirstURLClassLoader. This bug can be reproduced in our product environment(1.5.1). &lt;/p&gt;

&lt;p&gt;Here is our java thread dump information:&lt;/p&gt;

&lt;p&gt;Found one Java-level deadlock:&lt;br/&gt;
=============================&lt;br/&gt;
&quot;Timer-3&quot;:&lt;br/&gt;
  waiting to lock monitor 0x00007f5a0c01f598 (object 0x00000005947cead0, a org.apache.spark.util.ChildFirstURLClassLoader),&lt;br/&gt;
  which is held by &quot;pool-15-thread-7&quot;&lt;br/&gt;
&quot;pool-15-thread-7&quot;:&lt;br/&gt;
  waiting to lock monitor 0x00007f5a0c01f4e8 (&lt;font color=&quot;red&quot;&gt;object 0x000000059b5fe8d8, a java.lang.Object&lt;/font&gt;),&lt;br/&gt;
  which is held by &quot;pool-16-thread-5&quot;&lt;br/&gt;
&quot;pool-16-thread-5&quot;:&lt;br/&gt;
  waiting to lock monitor 0x00007f5a0c01f598 (&lt;font color=&quot;red&quot;&gt;object 0x00000005947cead0, a org.apache.spark.util.ChildFirstURLClassLoader&lt;/font&gt;),&lt;br/&gt;
  which is held by &quot;pool-15-thread-7&quot;&lt;/p&gt;

&lt;p&gt;Java stack information for the threads listed above:&lt;br/&gt;
===================================================&lt;br/&gt;
&quot;Timer-3&quot;:&lt;br/&gt;
        at com.mchange.v2.resourcepool.BasicResourcePool.destroyResource(BasicResourcePool.java:980)&lt;br/&gt;
        at com.mchange.v2.resourcepool.BasicResourcePool.removeResource(BasicResourcePool.java:1406)&lt;br/&gt;
        at com.mchange.v2.resourcepool.BasicResourcePool.removeResource(BasicResourcePool.java:1378)&lt;br/&gt;
        at com.mchange.v2.resourcepool.BasicResourcePool.cullExpired(BasicResourcePool.java:1462)&lt;br/&gt;
        at com.mchange.v2.resourcepool.BasicResourcePool.access$1900(BasicResourcePool.java:32)&lt;br/&gt;
        at com.mchange.v2.resourcepool.BasicResourcePool$CullTask.run(BasicResourcePool.java:1937)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;locked &amp;lt;0x000000059b5dd938&amp;gt; (a com.mchange.v2.resourcepool.BasicResourcePool)&lt;br/&gt;
        at java.util.TimerThread.mainLoop(Timer.java:555)&lt;br/&gt;
        at java.util.TimerThread.run(Timer.java:505)&lt;br/&gt;
&quot;pool-15-thread-7&quot;:&lt;br/&gt;
        at org.apache.spark.util.ChildFirstURLClassLoader.loadClass(MutableURLClassLoader.scala:71)&lt;/li&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x000000059b5fe8d8&amp;gt; (a java.lang.Object)&lt;br/&gt;
        at java.lang.ClassLoader.loadClass(ClassLoader.java:358)&lt;br/&gt;
        at java.lang.Class.forName0(Native Method)&lt;br/&gt;
        at java.lang.Class.forName(Class.java:270)&lt;br/&gt;
        at com.sun.beans.finder.ClassFinder.findClass(ClassFinder.java:67)&lt;br/&gt;
        at com.sun.beans.finder.ClassFinder.findClass(ClassFinder.java:110)&lt;br/&gt;
        at com.sun.beans.finder.InstanceFinder.instantiate(InstanceFinder.java:93)&lt;br/&gt;
        at com.sun.beans.finder.InstanceFinder.find(InstanceFinder.java:66)&lt;br/&gt;
        at java.beans.Introspector.findExplicitBeanInfo(Introspector.java:438)&lt;br/&gt;
        at java.beans.Introspector.&amp;lt;init&amp;gt;(Introspector.java:388)&lt;br/&gt;
        at java.beans.Introspector.getBeanInfo(Introspector.java:163)&lt;br/&gt;
        at java.beans.Introspector.getBeanInfo(Introspector.java:250)&lt;br/&gt;
        at java.beans.Introspector.&amp;lt;init&amp;gt;(Introspector.java:397)&lt;br/&gt;
        at java.beans.Introspector.getBeanInfo(Introspector.java:163)&lt;br/&gt;
        at org.apache.commons.beanutils.PropertyUtilsBean.getPropertyDescriptors(PropertyUtilsBean.java:971)&lt;br/&gt;
        at org.apache.commons.beanutils.PropertyUtilsBean.getPropertyDescriptors(PropertyUtilsBean.java:1075)&lt;br/&gt;
        at org.apache.commons.beanutils.PropertyUtilsBean.getPropertyDescriptor(PropertyUtilsBean.java:903)&lt;br/&gt;
        at org.apache.commons.beanutils.PropertyUtilsBean.getSimpleProperty(PropertyUtilsBean.java:1310)&lt;br/&gt;
        at org.apache.commons.beanutils.PropertyUtilsBean.getNestedProperty(PropertyUtilsBean.java:762)&lt;br/&gt;
        at org.apache.commons.beanutils.PropertyUtilsBean.getProperty(PropertyUtilsBean.java:837)&lt;br/&gt;
        at org.apache.commons.beanutils.PropertyUtils.getProperty(PropertyUtils.java:426)&lt;br/&gt;
        at com.hulu.recommendation.datastore.impl.table.Indexing.getKey(Indexing.java:255)&lt;br/&gt;
        at com.hulu.recommendation.datastore.impl.table.Indexing.indexIntoMap(Indexing.java:183)&lt;br/&gt;
        at com.hulu.recommendation.datastore.impl.table.Indexing.indexIntoMap(Indexing.java:179)&lt;br/&gt;
        at com.hulu.recommendation.datastore.impl.table.Indexing.createIndexInBatch(Indexing.java:86)&lt;br/&gt;
        at com.hulu.recommendation.datastore.impl.table.TableHolder.loadItemInBatch(TableHolder.java:268)&lt;br/&gt;
        at com.hulu.recommendation.datastore.impl.table.TableHolder.loadDataIncrementallyByFieldOrPk(TableHolder.java:214)&lt;br/&gt;
        at com.hulu.recommendation.datastore.impl.table.TableHolder.loadDataIncrementallyByFieldOrPk(TableHolder.java:153)&lt;br/&gt;
        at com.hulu.recommendation.datastore.impl.table.TableHolder.loadDataInitially(TableHolder.java:121)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x000000059b6864b8&amp;gt; (a com.hulu.recommendation.datastore.impl.table.TableHolder)&lt;br/&gt;
        at com.hulu.recommendation.datastore.impl.table.TableHolder.loadDataInitially(TableHolder.java:106)&lt;br/&gt;
        at com.hulu.recommendation.datastore.impl.table.TableHolder.loadData(TableHolder.java:369)&lt;br/&gt;
        at com.hulu.recommendation.datastore.BaseDataHolder.confirmDataLoaded(BaseDataHolder.java:25)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x000000059b6864b8&amp;gt; (a com.hulu.recommendation.datastore.impl.table.TableHolder)&lt;br/&gt;
        at com.hulu.recommendation.datastore.BaseDataHolder.initialize(BaseDataHolder.java:39)&lt;br/&gt;
        at com.hulu.recommendation.datastore.DataComponentUtils$1.call(DataComponentUtils.java:17)&lt;br/&gt;
        at com.hulu.recommendation.datastore.DataComponentUtils$1.call(DataComponentUtils.java:14)&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:262)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
&quot;pool-16-thread-5&quot;:&lt;br/&gt;
        at java.lang.ClassLoader.loadClass(ClassLoader.java:405)&lt;/li&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x00000005947cead0&amp;gt; (a org.apache.spark.util.ChildFirstURLClassLoader)&lt;br/&gt;
        at org.apache.spark.util.ChildFirstURLClassLoader.liftedTree1$1(MutableURLClassLoader.scala:72)&lt;br/&gt;
        at org.apache.spark.util.ChildFirstURLClassLoader.loadClass(MutableURLClassLoader.scala:71)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x000000059b5fe8d8&amp;gt; (a java.lang.Object)&lt;br/&gt;
        at java.lang.ClassLoader.loadClass(ClassLoader.java:412)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x00000005948408d8&amp;gt; (a org.openejb.util.MemoryClassLoader)&lt;br/&gt;
        at java.lang.ClassLoader.loadClass(ClassLoader.java:358)&lt;br/&gt;
        at java.lang.Class.forName0(Native Method)&lt;br/&gt;
        at java.lang.Class.forName(Class.java:270)&lt;br/&gt;
        at com.sun.beans.finder.ClassFinder.findClass(ClassFinder.java:103)&lt;br/&gt;
        at com.sun.beans.finder.InstanceFinder.instantiate(InstanceFinder.java:93)&lt;br/&gt;
        at com.sun.beans.finder.InstanceFinder.find(InstanceFinder.java:66)&lt;br/&gt;
        at java.beans.Introspector.findExplicitBeanInfo(Introspector.java:438)&lt;br/&gt;
        at java.beans.Introspector.&amp;lt;init&amp;gt;(Introspector.java:388)&lt;br/&gt;
        at java.beans.Introspector.getBeanInfo(Introspector.java:163)&lt;br/&gt;
        at java.beans.Introspector.getBeanInfo(Introspector.java:250)&lt;br/&gt;
        at java.beans.Introspector.&amp;lt;init&amp;gt;(Introspector.java:397)&lt;br/&gt;
        at java.beans.Introspector.getBeanInfo(Introspector.java:163)&lt;br/&gt;
        at org.apache.commons.beanutils.PropertyUtilsBean.getPropertyDescriptors(PropertyUtilsBean.java:971)&lt;br/&gt;
        at org.apache.commons.beanutils.PropertyUtilsBean.getPropertyDescriptors(PropertyUtilsBean.java:1075)&lt;br/&gt;
        at org.apache.commons.beanutils.PropertyUtilsBean.getPropertyDescriptor(PropertyUtilsBean.java:903)&lt;br/&gt;
        at org.apache.commons.beanutils.PropertyUtilsBean.getSimpleProperty(PropertyUtilsBean.java:1310)&lt;br/&gt;
        at org.apache.commons.beanutils.PropertyUtilsBean.getNestedProperty(PropertyUtilsBean.java:762)&lt;br/&gt;
        at org.apache.commons.beanutils.PropertyUtilsBean.getProperty(PropertyUtilsBean.java:837)&lt;br/&gt;
        at org.apache.commons.beanutils.PropertyUtils.getProperty(PropertyUtils.java:426)&lt;br/&gt;
......&lt;br/&gt;
        at java.util.concurrent.FutureTask.run(FutureTask.java:262)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:745)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Found 1 deadlock.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12964270">SPARK-15059</key>
            <summary>Fine-grained class loader lock in ChildFirstURLClassLoader caused dead locks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zheng.tan">Zheng Tan</assignee>
                                    <reporter username="zheng.tan">Zheng Tan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 May 2016 11:54:22 +0000</created>
                <updated>Tue, 3 May 2016 19:24:48 +0000</updated>
                            <resolved>Tue, 3 May 2016 19:23:27 +0000</resolved>
                                    <version>1.5.1</version>
                    <version>1.5.2</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15267207" author="zsxwing" created="Mon, 2 May 2016 18:27:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt; I think we can remove the locks in `ChildFirstURLClassLoader` since we have already dropped Java 6.&lt;/p&gt;</comment>
                            <comment id="15267237" author="vanzin" created="Mon, 2 May 2016 18:43:53 +0000"  >&lt;p&gt;I don&apos;t think dropping the locks will work - it might make the problem worse. The locks are implementing a per-name lock similar to what JDK7 does &lt;b&gt;when the class loader is registered as parallel-capable&lt;/b&gt;. Without that registration, there will be a single lock on the class loader object that all threads calling &lt;tt&gt;loadClass&lt;/tt&gt; will synchronize on. And that registration cannot be done easily when the class loader is written in Scala.&lt;/p&gt;</comment>
                            <comment id="15267249" author="vanzin" created="Mon, 2 May 2016 18:52:05 +0000"  >&lt;p&gt;Replying to myself... after re-reading the original conversation (&lt;a href=&quot;https://github.com/apache/spark/pull/3233&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3233&lt;/a&gt;), maybe just dropping the locks might work. With the single lock, the &quot;winning&quot; thread will just load all needed classes. Class loading may slow down a bit, but I don&apos;t think that&apos;s really a problem.&lt;/p&gt;</comment>
                            <comment id="15267752" author="zheng.tan" created="Mon, 2 May 2016 23:50:49 +0000"  >&lt;p&gt;Yes, we have removed it in our product environment, and it works fine. &lt;br/&gt;
Should I create a PR for this modification? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15267763" author="vanzin" created="Mon, 2 May 2016 23:54:39 +0000"  >&lt;p&gt;Sure.&lt;/p&gt;</comment>
                            <comment id="15267894" author="apachespark" created="Tue, 3 May 2016 01:41:03 +0000"  >&lt;p&gt;User &apos;tankkyo&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/12857&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12857&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 29 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2x1br:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>