<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:09:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-30298] bucket join cannot work for self-join with views</title>
                <link>https://issues.apache.org/jira/browse/SPARK-30298</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;This UT may fail at the last line:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
test(&lt;span class=&quot;code-quote&quot;&gt;&quot;bucket join cannot work &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; self-join with views&quot;&lt;/span&gt;) {
    withSQLConf(SQLConf.AUTO_BROADCASTJOIN_THRESHOLD.key -&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;) {
      withTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;t1&quot;&lt;/span&gt;) {
        val df = (0 until 20).map(i =&amp;gt; (i, i)).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;i&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;j&quot;&lt;/span&gt;).as(&lt;span class=&quot;code-quote&quot;&gt;&quot;df&quot;&lt;/span&gt;)
        df.write
          .format(&lt;span class=&quot;code-quote&quot;&gt;&quot;parquet&quot;&lt;/span&gt;)
          .bucketBy(8, &lt;span class=&quot;code-quote&quot;&gt;&quot;i&quot;&lt;/span&gt;)
          .saveAsTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;t1&quot;&lt;/span&gt;)

        sql(s&lt;span class=&quot;code-quote&quot;&gt;&quot;create view v1 as select * from t1&quot;&lt;/span&gt;).collect()

        val plan1 = sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT * FROM t1 a JOIN t1 b ON a.i = b.i&quot;&lt;/span&gt;).queryExecution.executedPlan
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;(plan1.collect { &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; exchange : ShuffleExchangeExec =&amp;gt; exchange }.isEmpty)

        val plan2 = sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT * FROM t1 a JOIN v1 b ON a.i = b.i&quot;&lt;/span&gt;).queryExecution.executedPlan
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;(plan2.collect { &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; exchange : ShuffleExchangeExec =&amp;gt; exchange }.isEmpty)
      }
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It&apos;s because View will add Project with Alias, then Join&apos;s requiredDistribution is based on Alias, but ProjectExec passes child&apos;s outputPartition up without Alias. Then the satisfies check cannot meet in EnsureRequirement.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13275264">SPARK-30298</key>
            <summary>bucket join cannot work for self-join with views</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="imback82">Terry Kim</assignee>
                                    <reporter username="xiaojuwu">Xiaoju Wu</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Dec 2019 13:33:52 +0000</created>
                <updated>Sat, 7 Mar 2020 05:28:19 +0000</updated>
                            <resolved>Thu, 23 Jan 2020 23:25:04 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16999636" author="ankitraj" created="Thu, 19 Dec 2019 01:03:58 +0000"  >&lt;p&gt;I will raise pr for this&lt;/p&gt;</comment>
                            <comment id="16999713" author="imback82" created="Thu, 19 Dec 2019 03:34:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Ankitraj&quot; class=&quot;user-hover&quot; rel=&quot;Ankitraj&quot;&gt;Ankitraj&lt;/a&gt;&#160;did you already start on this? I faced a similar issue a month ago, and I have a fix almost ready for PR and found this JIRA. Do you mind if I take this up? Thanks!&lt;/p&gt;</comment>
                            <comment id="16999760" author="imback82" created="Thu, 19 Dec 2019 06:07:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Ankitraj&quot; class=&quot;user-hover&quot; rel=&quot;Ankitraj&quot;&gt;Ankitraj&lt;/a&gt;&#160;I created a PR:&#160;&lt;a href=&quot;https://github.com/apache/spark/pull/26943&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/26943&lt;/a&gt;. Please chime in if you like. Thanks!&lt;/p&gt;</comment>
                            <comment id="16999959" author="ankitraj" created="Thu, 19 Dec 2019 10:55:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=imback82&quot; class=&quot;user-hover&quot; rel=&quot;imback82&quot;&gt;imback82&lt;/a&gt; ok , Thank you for raising PR.&lt;/p&gt;</comment>
                            <comment id="17022588" author="maropu" created="Thu, 23 Jan 2020 23:25:04 +0000"  >&lt;p&gt;Resolved by &lt;a href=&quot;https://github.com/apache/spark/pull/26943&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/26943&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13040510">SPARK-19468</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13056714">SPARK-19981</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13196587">SPARK-25951</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z09sy0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>