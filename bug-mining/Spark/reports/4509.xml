<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:50:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-19347] ReceiverSupervisorImpl can add block to ReceiverTracker multiple times because of askWithRetry</title>
                <link>https://issues.apache.org/jira/browse/SPARK-19347</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;b&gt;ReceiverSupervisorImpl&lt;/b&gt; on executor side reports block&apos;s meta back to &lt;b&gt;ReceiverTracker&lt;/b&gt; on driver side. In current code, &lt;b&gt;askWithRetry&lt;/b&gt; is used. However, for &lt;b&gt;AddBlock&lt;/b&gt;, &lt;b&gt;ReceiverTracker&lt;/b&gt; is not idempotent, which may result in messages are processed multiple times.&lt;/p&gt;

&lt;p&gt;To reproduce:&lt;br/&gt;
1. Check if it is the first time receiving &lt;b&gt;AddBlock&lt;/b&gt; in &lt;b&gt;ReceiverTracker&lt;/b&gt;, if so sleep long enough(say 200 seconds), thus the first RPC call will be timeout in &lt;b&gt;askWithRetry&lt;/b&gt;, then &lt;b&gt;AddBlock&lt;/b&gt; will be resent.&lt;br/&gt;
2. Rebuild Spark and run following job:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  def streamProcessing(): Unit = {
    val conf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SparkConf()
      .setAppName(&lt;span class=&quot;code-quote&quot;&gt;&quot;StreamingTest&quot;&lt;/span&gt;)
      .setMaster(masterUrl)
    val ssc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StreamingContext(conf, Seconds(200))
    val stream = ssc.socketTextStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;, 1234)
    stream.print()
    ssc.start()
    ssc.awaitTermination()
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To fix:&lt;br/&gt;
It makes sense to provide a blocking version &lt;b&gt;ask&lt;/b&gt; in &lt;b&gt;RpcEndpointRef&lt;/b&gt;, as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt; mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-18113&quot; title=&quot;Sending AskPermissionToCommitOutput failed, driver enter into task deadloop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-18113&quot;&gt;&lt;del&gt;SPARK-18113&lt;/del&gt;&lt;/a&gt; (&lt;a href=&quot;https://github.com/apache/spark/pull/16503#event-927953218&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/16503#event-927953218&lt;/a&gt;), &lt;b&gt;askWithRetry&lt;/b&gt; is a leftover from akka days. It imposes restrictions on the caller(e.g. idempotency) and other things that people generally don&apos;t pay that much attention to when using it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13037313">SPARK-19347</key>
            <summary>ReceiverSupervisorImpl can add block to ReceiverTracker multiple times because of askWithRetry</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jinxing6042@126.com">Jin Xing</assignee>
                                    <reporter username="jinxing6042@126.com">Jin Xing</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Jan 2017 09:31:53 +0000</created>
                <updated>Wed, 1 Feb 2017 21:55:06 +0000</updated>
                            <resolved>Wed, 1 Feb 2017 21:55:06 +0000</resolved>
                                                    <fixVersion>2.2.0</fixVersion>
                                    <component>DStreams</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15835913" author="apachespark" created="Tue, 24 Jan 2017 09:46:03 +0000"  >&lt;p&gt;User &apos;jinxing64&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/16690&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/16690&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 43 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i394dr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>