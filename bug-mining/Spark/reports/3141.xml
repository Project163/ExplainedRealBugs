<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:38:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-13441] NullPointerException when either HADOOP_CONF_DIR or YARN_CONF_DIR is not readable</title>
                <link>https://issues.apache.org/jira/browse/SPARK-13441</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;NPE is throw from the yarn Client.scala because &lt;tt&gt;File.listFiles()&lt;/tt&gt; can return null on directory that it doesn&apos;t have permission to list. This is the code fragment in question:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;// In org/apache/spark/deploy/yarn/Client.scala
    Seq(&quot;HADOOP_CONF_DIR&quot;, &quot;YARN_CONF_DIR&quot;).foreach { envKey =&amp;gt;
      sys.env.get(envKey).foreach { path =&amp;gt;
        val dir = new File(path)
        if (dir.isDirectory()) {
          // dir.listFiles() can return null
          dir.listFiles().foreach { file =&amp;gt;
            if (file.isFile &amp;amp;&amp;amp; !hadoopConfFiles.contains(file.getName())) {
              hadoopConfFiles(file.getName()) = file
            }
          }
        }
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To reproduce, simply do:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;sudo mkdir /tmp/conf
sudo chmod 700 /tmp/conf
export HADOOP_CONF_DIR=/etc/hadoop/conf
export YARN_CONF_DIR=/tmp/conf
spark-submit --master yarn-client SimpleApp.py
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It fails on any Spark app. Though not important, the SimpleApp.py I used looks like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;from pyspark import SparkContext

sc = SparkContext(None, &quot;Simple App&quot;)

data = [1, 2, 3, 4, 5]
distData = sc.parallelize(data)

total = distData.reduce(lambda a, b: a + b)

print(&quot;Total: %i&quot; % total)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12941243">SPARK-13441</key>
            <summary>NullPointerException when either HADOOP_CONF_DIR or YARN_CONF_DIR is not readable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chtyim">Terence Yim</assignee>
                                    <reporter username="chtyim">Terence Yim</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Feb 2016 00:37:14 +0000</created>
                <updated>Sun, 17 May 2020 18:17:11 +0000</updated>
                            <resolved>Thu, 25 Feb 2016 13:29:55 +0000</resolved>
                                    <version>1.4.1</version>
                    <version>1.5.1</version>
                    <version>1.6.0</version>
                                    <fixVersion>1.6.1</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>Spark Core</component>
                    <component>YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15158458" author="jayadevan.m" created="Tue, 23 Feb 2016 07:29:57 +0000"  >&lt;p&gt;@Terence Yim So, are you expecting any valid exception say &quot;No privilege&quot; instead of null pointer exception ?&lt;/p&gt;</comment>
                            <comment id="15158537" author="chtyim" created="Tue, 23 Feb 2016 08:28:08 +0000"  >&lt;p&gt;I think the spark submit should be handling the null. One possible handling is to just log and ignore. For example, in the sample I provided, the valid set of configurations are in $HADOOP_CONF_DIR, so failing to list files under $YARN_CONF_DIR should just be ignore. If the necessary conf files are truly missing, the submission would fail.&lt;/p&gt;

&lt;p&gt;A simple fix would be something like:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;if (dir.isDirectory()) {
  // dir.listFiles() can return null
  val files: Option[Array[File]] = Option(dir.listFiles())
  if (files.isEmpty) {
    // log warning
  } else {
    files.get.foreach { file =&amp;gt;
      if (file.isFile &amp;amp;&amp;amp; !hadoopConfFiles.contains(file.getName())) {
        hadoopConfFiles(file.getName()) = file
      }
    }
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15158645" author="jayadevan.m" created="Tue, 23 Feb 2016 09:58:09 +0000"  >&lt;p&gt;Are you planning to create PR for this ?, Otherwise I will work on this.&lt;/p&gt;</comment>
                            <comment id="15159067" author="chtyim" created="Tue, 23 Feb 2016 15:47:49 +0000"  >&lt;p&gt;Yes, I will create a PR today. Just wanna make sure the approach is alright.&lt;/p&gt;</comment>
                            <comment id="15159125" author="jayadevan.m" created="Tue, 23 Feb 2016 16:21:14 +0000"  >&lt;p&gt;I think this approach is fine&lt;/p&gt;</comment>
                            <comment id="15159954" author="apachespark" created="Wed, 24 Feb 2016 00:34:06 +0000"  >&lt;p&gt;User &apos;chtyim&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/11337&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/11337&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15167192" author="srowen" created="Thu, 25 Feb 2016 13:29:55 +0000"  >&lt;p&gt;Issue resolved by pull request 11337&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/11337&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/11337&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2t6tz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>