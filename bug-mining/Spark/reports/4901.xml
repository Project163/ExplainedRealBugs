<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:53:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-20922] Unsafe deserialization in Spark LauncherConnection</title>
                <link>https://issues.apache.org/jira/browse/SPARK-20922</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The &lt;tt&gt;run()&lt;/tt&gt; method of the class &lt;tt&gt;org.apache.spark.launcher.LauncherConnection&lt;/tt&gt; performs unsafe deserialization of data received by its socket. This makes Spark applications launched programmatically using the &lt;tt&gt;SparkLauncher&lt;/tt&gt; framework potentially vulnerable to remote code execution by an attacker with access to any user account on the local machine. Such an attacker could send a malicious serialized Java object to multiple ports on the local machine, and if this port matches the one (randomly) chosen by the Spark launcher, the malicious object will be deserialized. By making use of gadget chains in code present on the Spark application classpath, the deserialization process can lead to RCE or privilege escalation.&lt;/p&gt;

&lt;p&gt;This vulnerability is identified by the &#8220;Unsafe deserialization&#8221; rule on lgtm.com:&lt;br/&gt;
&lt;a href=&quot;https://lgtm.com/projects/g/apache/spark/snapshot/80fdc2c9d1693f5b3402a79ca4ec76f6e422ff13/files/launcher/src/main/java/org/apache/spark/launcher/LauncherConnection.java#V58&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lgtm.com/projects/g/apache/spark/snapshot/80fdc2c9d1693f5b3402a79ca4ec76f6e422ff13/files/launcher/src/main/java/org/apache/spark/launcher/LauncherConnection.java#V58&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;Attached is a proof-of-concept exploit involving a simple &lt;tt&gt;SparkLauncher&lt;/tt&gt;-based application and a known gadget chain in the Apache Commons Beanutils library referenced by Spark.&lt;br/&gt;
See the readme file for demonstration instructions.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13075797">SPARK-20922</key>
            <summary>Unsafe deserialization in Spark LauncherConnection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vanzin">Marcelo Masiero Vanzin</assignee>
                                    <reporter username="adityasharad">Aditya Sharad</reporter>
                        <labels>
                            <label>security</label>
                    </labels>
                <created>Tue, 30 May 2017 10:58:03 +0000</created>
                <updated>Mon, 14 May 2018 08:04:11 +0000</updated>
                            <resolved>Thu, 1 Jun 2017 21:46:27 +0000</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>2.0.3</fixVersion>
                    <fixVersion>2.1.2</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                    <fixVersion>2.3.0</fixVersion>
                                    <component>Spark Submit</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16029344" author="srowen" created="Tue, 30 May 2017 12:23:51 +0000"  >&lt;p&gt;This is not the same as &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-11652&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-11652&lt;/a&gt; I take it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt; can maybe comment on the mechanics here, but it also sounds like the suggestion is that this gets around the shared secret because deserializing the message itself causes something to be executed.&lt;/p&gt;

&lt;p&gt;Still, you have to be on the localhost to make the connection, right?&lt;/p&gt;</comment>
                            <comment id="16029455" author="adityasharad" created="Tue, 30 May 2017 14:09:03 +0000"  >&lt;p&gt;Yes, this is different from &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-11652&quot; title=&quot;Remote code execution with InvokerTransformer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-11652&quot;&gt;&lt;del&gt;SPARK-11652&lt;/del&gt;&lt;/a&gt;, which focused on preventing a specific known gadget chain (found in Commons Collections). This issue involves the general problem of unconditionally deserializing untrusted data, and the proof-of-concept is simply an example of a gadget chain (in Commons Beanutils, and which cannot be addressed by updating the dependency) that works against the latest Spark dependencies.&lt;/p&gt;

&lt;p&gt;I believe you are correct about the deserialization leading to code execution before the shared secret is established or checked.&lt;/p&gt;

&lt;p&gt;Indeed, due to how the socket is opened, you must have access to the local machine to connect, but not necessarily to the same user that is running the Spark master or task.&lt;/p&gt;</comment>
                            <comment id="16029693" author="vanzin" created="Tue, 30 May 2017 16:37:48 +0000"  >&lt;p&gt;Yeah, it&apos;s not as simple to exploit, but I guess we&apos;ll need custom serialization to avoid issues with 3rd-party libraries here... :-/&lt;/p&gt;</comment>
                            <comment id="16031594" author="apachespark" created="Wed, 31 May 2017 17:59:04 +0000"  >&lt;p&gt;User &apos;vanzin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18166&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18166&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16033877" author="apachespark" created="Thu, 1 Jun 2017 23:04:03 +0000"  >&lt;p&gt;User &apos;vanzin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18178&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16036543" author="adityasharad" created="Mon, 5 Jun 2017 05:25:00 +0000"  >&lt;p&gt;I appreciate your quick response to this issue. I believe it would be appropriate to register a CVE ID &amp;#8211; is that something one of you would be willing to do?&lt;/p&gt;</comment>
                            <comment id="16036628" author="srowen" created="Mon, 5 Jun 2017 07:21:34 +0000"  >&lt;p&gt;This is already publicly disclosed, which isn&apos;t a big deal because it&apos;s pretty limited in scope. Normally you&apos;d discuss a CVE and disclosure after the fix on private@&lt;/p&gt;</comment>
                            <comment id="16112600" author="adityasharad" created="Thu, 3 Aug 2017 11:41:27 +0000"  >&lt;p&gt;Apologies for the delay in getting back to you. I believe we first got in touch privately to report this, but in future we&apos;ll discuss the details and fix on private@ first if that fits better into your workflow.&lt;/p&gt;

&lt;p&gt;The scope is indeed limited to attacks from local users and the issue is now publicly disclosed. However, I would argue neither of these points disqualifies the vulnerability reported here for the purposes of getting a CVE assigned.&lt;/p&gt;

&lt;p&gt;Depending on the configuration and the intentions of an attacker, the repercussions of this vulnerability are potentially extremely severe despite the limited scope:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The worst case is obviously when Spark runs as an administrative user.&lt;/li&gt;
	&lt;li&gt;In the more common case where Spark runs under a user account that is also responsible for other services (like Hadoop, HDFS), the repercussions can be very severe. This is the case in the default Cloudera setup, for example. In that particular scenario, an attacker can cause a widespread outage by simply wiping all data that belongs to the &apos;hdfs&apos; user. The repercussions reach far beyond Spark itself.&lt;/li&gt;
	&lt;li&gt;In the &apos;best&apos; case, Spark is set up to use a dedicated user account. Here we&apos;re looking at a DoS to Spark specifically, with a severe risk for data loss. An attacker can stop the service and wipe all of Spark&apos;s data.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;We have seen significantly less severe vulnerabilities for which a CVE is assigned. The prime reasons for doing so are to advise users and to maintain a visible record of the issue that isn&apos;t project-specific, which I think would be appropriate in this case.&lt;/p&gt;

&lt;p&gt;Please let me know if there&apos;s anything I can help with. I am willing to file separately for the CVE if that is easier, but I do not wish to do so without first having your agreement and finding out if Spark has a preferred CVE route. If you&apos;d like to discuss this further off-list, please feel free to contact me on aditya@semmle.com.&lt;/p&gt;</comment>
                            <comment id="16112602" author="srowen" created="Thu, 3 Aug 2017 11:44:57 +0000"  >&lt;p&gt;If you&apos;d email a suggested CVE description to private@spark.apache.org, we can go through the motions of reporting it as one. The ASF process is: &lt;a href=&quot;https://www.apache.org/security/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/security/&lt;/a&gt; &lt;a href=&quot;https://www.apache.org/security/projects.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/security/projects.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16154075" author="srowen" created="Tue, 5 Sep 2017 18:09:44 +0000"  >&lt;p&gt;This came up again today and our security folks also suggested this should be a CVE. I can work on this but feel free to supply text as a summary.&lt;/p&gt;</comment>
                            <comment id="16389809" author="pathreesyo" created="Wed, 7 Mar 2018 17:06:30 +0000"  >&lt;p&gt;Hi Guys,&lt;/p&gt;

&lt;p&gt;I&apos;m new to this vulnerability. Can someone share step by step procedure on how to remediate this vulnerability (Unsafe deserialization in Spark LauncherConnection). I&apos;ve saw in this thread that there is an attached file (spark-deserialize-master.zip). Can someone share step by step on how to use this in our Linux machine? Btw, we&apos;re using CentOS.&lt;/p&gt;</comment>
                            <comment id="16389907" author="vanzin" created="Wed, 7 Mar 2018 18:13:26 +0000"  >&lt;p&gt;You remediate it by upgrading to a version with the fix (see &quot;Fix Versions&quot;).&lt;/p&gt;</comment>
                            <comment id="16471600" author="fialkovsky" created="Fri, 11 May 2018 07:36:24 +0000"  >&lt;p&gt;I can&apos;t update Spark to 2.2.&lt;/p&gt;

&lt;p&gt;Will you make fix for Spark 1.6 branch ?&lt;/p&gt;</comment>
                            <comment id="16472231" author="vanzin" created="Fri, 11 May 2018 16:38:03 +0000"  >&lt;p&gt;I think Spark 1.6 at this point is considered EOL by the community; there are no&#160;more planned releases for that line that I know of.&lt;/p&gt;</comment>
                            <comment id="16472393" author="vanzin" created="Fri, 11 May 2018 18:11:50 +0000"  >&lt;p&gt;You should also be able to use just the spark-launcher library from a 2.x version to launch Spark 1.6 jobs, without having to update the rest of the Spark dependencies.&lt;/p&gt;</comment>
                            <comment id="16473889" author="fialkovsky" created="Mon, 14 May 2018 08:04:11 +0000"  >&lt;p&gt;Thanks for clarification.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12870374" name="spark-deserialize-master.zip" size="677628" author="adityasharad" created="Tue, 30 May 2017 10:59:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fmmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>