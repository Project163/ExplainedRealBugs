<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:13:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-1875] NoClassDefFoundError: StringUtils when building against Hadoop 1</title>
                <link>https://issues.apache.org/jira/browse/SPARK-1875</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Maybe I missed something, but after building an assembly with Hadoop 1.2.1 and Hive enabled, if I go into it and run spark-shell, I get this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.NoClassDefFoundError: org/apache/commons/lang/StringUtils
	at org.apache.hadoop.metrics2.lib.MetricMutableStat.&amp;lt;init&amp;gt;(MetricMutableStat.java:59)
	at org.apache.hadoop.metrics2.impl.MetricsSystemImpl.&amp;lt;init&amp;gt;(MetricsSystemImpl.java:75)
	at org.apache.hadoop.metrics2.impl.MetricsSystemImpl.&amp;lt;init&amp;gt;(MetricsSystemImpl.java:120)
	at org.apache.hadoop.metrics2.lib.DefaultMetricsSystem.&amp;lt;init&amp;gt;(DefaultMetricsSystem.java:37)
	at org.apache.hadoop.metrics2.lib.DefaultMetricsSystem.&amp;lt;clinit&amp;gt;(DefaultMetricsSystem.java:34)
	at org.apache.hadoop.security.UgiInstrumentation.create(UgiInstrumentation.java:51)
	at org.apache.hadoop.security.UserGroupInformation.initialize(UserGroupInformation.java:216)
	at org.apache.hadoop.security.UserGroupInformation.ensureInitialized(UserGroupInformation.java:184)
	at org.apache.hadoop.security.UserGroupInformation.isSecurityEnabled(UserGroupInformation.java:236)
	at org.apache.hadoop.security.KerberosName.&amp;lt;clinit&amp;gt;(KerberosName.java:79)
	at org.apache.hadoop.security.UserGroupInformation.initialize(UserGroupInformation.java:209)
	at org.apache.hadoop.security.UserGroupInformation.setConfiguration(UserGroupInformation.java:226)
	at org.apache.spark.deploy.SparkHadoopUtil.&amp;lt;init&amp;gt;(SparkHadoopUtil.scala:36)
	at org.apache.spark.deploy.SparkHadoopUtil$.&amp;lt;init&amp;gt;(SparkHadoopUtil.scala:109)
	at org.apache.spark.deploy.SparkHadoopUtil$.&amp;lt;clinit&amp;gt;(SparkHadoopUtil.scala)
	at org.apache.spark.SparkContext.&amp;lt;init&amp;gt;(SparkContext.scala:228)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12715068">SPARK-1875</key>
            <summary>NoClassDefFoundError: StringUtils when building against Hadoop 1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gq">Guoqiang Li</assignee>
                                    <reporter username="matei">Matei Alexandru Zaharia</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 May 2014 00:16:16 +0000</created>
                <updated>Tue, 20 May 2014 02:41:18 +0000</updated>
                            <resolved>Tue, 20 May 2014 02:41:18 +0000</resolved>
                                                    <fixVersion>1.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14001297" author="matei" created="Mon, 19 May 2014 00:47:54 +0000"  >&lt;p&gt;This may have been broken by &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-1629&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-1629&lt;/a&gt; / &lt;a href=&quot;https://github.com/apache/spark/pull/569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/569&lt;/a&gt;, which added an explicit dependency on commons-lang, though it&apos;s not clear.&lt;/p&gt;</comment>
                            <comment id="14001298" author="matei" created="Mon, 19 May 2014 00:48:40 +0000"  >&lt;p&gt;Sorry I meant &lt;a href=&quot;https://github.com/apache/spark/pull/635&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/635&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14001300" author="matei" created="Mon, 19 May 2014 00:49:08 +0000"  >&lt;p&gt;It may also just be that security needs other JARs on Hadoop 1.&lt;/p&gt;</comment>
                            <comment id="14001312" author="matei" created="Mon, 19 May 2014 01:19:19 +0000"  >&lt;p&gt;Actually, upon a closer look, it seems to be caused by including Hive. Hive probably brings in a newer version of either hadoop-client or something that depends on, which brings in new classes here without their dependencies. I&apos;m fairly sure that Hive 0.12 can work on Hadoop 1, but if it doesn&apos;t, it means we have to relegate the Hive support to only newer versions of Hadoop.&lt;/p&gt;</comment>
                            <comment id="14001336" author="pwendell" created="Mon, 19 May 2014 02:08:55 +0000"  >&lt;p&gt;The issue was caused by this patch. I need to look further to figure out what was going on.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/pull/754&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/754&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14001338" author="gq" created="Mon, 19 May 2014 02:17:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pwendell&quot; class=&quot;user-hover&quot; rel=&quot;pwendell&quot;&gt;pwendell&lt;/a&gt;&lt;br/&gt;
This PR 754  should not associated with hadoop 1, concerned only with hadoop 2 and hive.&lt;/p&gt;</comment>
                            <comment id="14001352" author="gq" created="Mon, 19 May 2014 02:47:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matei&quot; class=&quot;user-hover&quot; rel=&quot;matei&quot;&gt;matei&lt;/a&gt;  I can not reproduce the bug.&lt;/p&gt;</comment>
                            <comment id="14001358" author="pwendell" created="Mon, 19 May 2014 03:25:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=witgo&quot; class=&quot;user-hover&quot; rel=&quot;witgo&quot;&gt;witgo&lt;/a&gt;. Here is how I reproduced it:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;./make-distribution.sh --with-hive --tgz
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then run spark-shell from the distribution. This is mostly equivalent to running&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;mvn &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; -Phive -DskipTests
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14001366" author="pwendell" created="Mon, 19 May 2014 04:08:41 +0000"  >&lt;p&gt;The issue here is that somehow the commons-lang exclusion from the hive project is being respected when building an assembly for Hadoop 1. So it&apos;s excluded from hadoop-client even though hadoop-client 1.0.4 depends on it.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;mvn -Phive install
mvn -pl assembly -Phive  dependency:tree 
[INFO] Scanning &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building Spark Project Assembly 1.0.1-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO]
[INFO] --- maven-dependency-plugin:2.8:tree (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-cli) @ spark-assembly_2.10 ---
[INFO] org.apache.spark:spark-assembly_2.10:pom:1.0.1-SNAPSHOT
[INFO] +- org.apache.spark:spark-core_2.10:jar:1.0.1-SNAPSHOT:compile
[INFO] |  +- org.apache.hadoop:hadoop-client:jar:1.0.4:compile
[INFO] |  |  \- org.apache.hadoop:hadoop-core:jar:1.0.4:compile
[INFO] |  |     +- xmlenc:xmlenc:jar:0.52:compile
[INFO] |  |     +- org.apache.commons:commons-math:jar:2.1:compile
[INFO] |  |     +- commons-el:commons-el:jar:1.0:compile
[INFO] |  |     +- hsqldb:hsqldb:jar:1.8.0.10:compile
[INFO] |  |     \- oro:oro:jar:2.0.8:compile
[INFO] |  +- net.java.dev.jets3t:jets3t:jar:0.7.1:runtime
[INFO] |  |  +- commons-codec:commons-codec:jar:1.3:compile
[INFO] |  |  \- commons-httpclient:commons-httpclient:jar:3.1:runtime
[INFO] |  +- org.apache.curator:curator-recipes:jar:2.4.0:compile
[INFO] |  |  +- org.apache.curator:curator-framework:jar:2.4.0:compile
[INFO] |  |  |  \- org.apache.curator:curator-client:jar:2.4.0:compile
[INFO] |  |  \- org.apache.zookeeper:zookeeper:jar:3.4.5:compile
[INFO] |  +- org.eclipse.jetty:jetty-plus:jar:8.1.14.v20131031:compile
[INFO] |  |  +- org.eclipse.jetty.orbit:javax.transaction:jar:1.1.1.v201105210645:compile
[INFO] |  |  +- org.eclipse.jetty:jetty-webapp:jar:8.1.14.v20131031:compile
[INFO] |  |  |  +- org.eclipse.jetty:jetty-xml:jar:8.1.14.v20131031:compile
[INFO] |  |  |  \- org.eclipse.jetty:jetty-servlet:jar:8.1.14.v20131031:compile
[INFO] |  |  \- org.eclipse.jetty:jetty-jndi:jar:8.1.14.v20131031:compile
[INFO] |  |     \- org.eclipse.jetty.orbit:javax.mail.glassfish:jar:1.4.1.v201005082020:compile
[INFO] |  |        \- org.eclipse.jetty.orbit:javax.activation:jar:1.1.0.v201105071233:compile
[INFO] |  +- org.eclipse.jetty:jetty-security:jar:8.1.14.v20131031:compile
[INFO] |  +- org.eclipse.jetty:jetty-util:jar:8.1.14.v20131031:compile
[INFO] |  +- org.eclipse.jetty:jetty-server:jar:8.1.14.v20131031:compile
[INFO] |  |  +- org.eclipse.jetty.orbit:javax.servlet:jar:3.0.0.v201112011016:compile
[INFO] |  |  +- org.eclipse.jetty:jetty-continuation:jar:8.1.14.v20131031:compile
[INFO] |  |  \- org.eclipse.jetty:jetty-http:jar:8.1.14.v20131031:compile
[INFO] |  |     \- org.eclipse.jetty:jetty-io:jar:8.1.14.v20131031:compile
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you run&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;mvn -pl assembly dependency:tree 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;it includes commons-lang correctly.&lt;/p&gt;</comment>
                            <comment id="14001379" author="gq" created="Mon, 19 May 2014 04:23:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pwendell&quot; class=&quot;user-hover&quot; rel=&quot;pwendell&quot;&gt;pwendell&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matei&quot; class=&quot;user-hover&quot; rel=&quot;matei&quot;&gt;matei&lt;/a&gt;&lt;br/&gt;
Do you have time to review the code?&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/820&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/820&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14001418" author="srowen" created="Mon, 19 May 2014 06:36:02 +0000"  >&lt;p&gt;Here&apos;s my recap of what I understand:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;All the original changes about `commons-lang` were to ensure that Spark itself uses `commons-lang3` and declares the dependency. That&apos;s OK and not related.&lt;/li&gt;
	&lt;li&gt;The PR &lt;a href=&quot;https://github.com/apache/spark/pull/754&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/754&lt;/a&gt; was intended to mirror my changes in &lt;a href=&quot;https://github.com/apache/spark/pull/746/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/746/files&lt;/a&gt; for SBT, but I didn&apos;t look closely enough: it actually also excludes `commons-lang`&lt;/li&gt;
	&lt;li&gt;I don&apos;t know of a reason we need to deal with `commons-lang` directly. It &lt;b&gt;should&lt;/b&gt; exist in the built assembly since dependencies need it. The version resolution among various versions of 2.x is all fine AFAICT, so we don&apos;t need (or do) any manual version setting.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In short I do not see why `commons-lang` is excluded? I think this exclusion should simply be reverted.&lt;/p&gt;</comment>
                            <comment id="14001420" author="matei" created="Mon, 19 May 2014 06:41:26 +0000"  >&lt;p&gt;I see, it might be fine to just remove the exclusion then. I agree it doesn&apos;t seem necessary to add it. In particular I believe lang3 and lang actually use different package names.&lt;/p&gt;</comment>
                            <comment id="14001424" author="srowen" created="Mon, 19 May 2014 06:43:24 +0000"  >&lt;p&gt;(That&apos;s correct that commons-lang and commons-lang3 use separate packages.)&lt;/p&gt;</comment>
                            <comment id="14001425" author="matei" created="Mon, 19 May 2014 06:44:40 +0000"  >&lt;p&gt;BTW feel free to just try it and send a pull request. The important things to test are:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;make-distribution.sh with the settings above works, either with or without hive (specifically check that the build lets you actually launch spark-shell)&lt;/li&gt;
	&lt;li&gt;apps built against spark-core_2.10 1.0.0-SNAPSHOT work&lt;/li&gt;
	&lt;li&gt;apps built against spark-core_2.10 1.0.0-SNAPSHOT plus spark-hive_2.10 also work&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ll take a closer look at it tomorrow but this is a fair number of things to test. In the future we can automate some of this testing. I&apos;ve usually just built some apps manually against the new version.&lt;/p&gt;</comment>
                            <comment id="14001450" author="gq" created="Mon, 19 May 2014 07:24:59 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;hadoop or hive &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;commons-lang&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;hive 0.12     &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 2.4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;hadoop-core 1.x&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 2.4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;hadoop-common 0.23,2.2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 2.5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;hadoop-common 2.3,2.4 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 2.6&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


</comment>
                            <comment id="14001458" author="srowen" created="Mon, 19 May 2014 07:31:20 +0000"  >&lt;p&gt;Yeah, my experience &quot;in the trenches&quot; suggests that commons-lang 2.x is well-behaved with respect to minor versions. It will be OK for dependency resolution to pick 2.6, for example, and have it work with components that want 2.4. &lt;/p&gt;</comment>
                            <comment id="14001469" author="gq" created="Mon, 19 May 2014 07:46:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt; &lt;br/&gt;
How about &lt;a href=&quot;https://github.com/apache/spark/pull/824&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the PR 824 &lt;/a&gt; ?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>393354</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1vqgf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>393516</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>