<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:59:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-23291] SparkR : substr : In SparkR dataframe , starting and ending position arguments in &quot;substr&quot; is giving wrong result  when the position is greater than 1</title>
                <link>https://issues.apache.org/jira/browse/SPARK-23291</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Defect Description :&lt;/p&gt;

&lt;p&gt;-----------------------------&lt;/p&gt;

&lt;p&gt;For example ,an input string &quot;2017-12-01&quot; is read into a SparkR dataframe &quot;df&quot; with column name &quot;col1&quot;.&lt;br/&gt;
 The target is to create a a new column named &quot;col2&quot; with the value &quot;12&quot; which is inside the string .&quot;12&quot; can be extracted with &quot;starting position&quot; as &quot;6&quot; and &quot;Ending position&quot; as &quot;7&quot;&lt;br/&gt;
 (the starting position of the first character is considered as &quot;1&quot; )&lt;/p&gt;

&lt;p&gt;But,the current code that needs to be written is :&lt;/p&gt;

&lt;p&gt; df &amp;lt;- withColumn(df,&quot;col2&quot;,substr(df$col1,7,8)))&lt;/p&gt;

&lt;p&gt;Observe that the first argument in the &quot;substr&quot; API , which indicates the &apos;starting position&apos;, is mentioned as &quot;7&quot; &lt;br/&gt;
 Also, observe that the second argument in the &quot;substr&quot; API , which indicates the &apos;ending position&apos;, is mentioned as &quot;8&quot;&lt;/p&gt;

&lt;p&gt;i.e the number that should be mentioned to indicate the position should be the &quot;actual position + 1&quot;&lt;/p&gt;

&lt;p&gt;Expected behavior :&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;The code that needs to be written is :&lt;/p&gt;

&lt;p&gt; df &amp;lt;- withColumn(df,&quot;col2&quot;,substr(df$col1,6,7)))&lt;/p&gt;


&lt;p&gt;Note :&lt;/p&gt;

&lt;p&gt;-----------&lt;br/&gt;
 This defect is observed with only when the starting position is greater than 1.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13135274">SPARK-23291</key>
            <summary>SparkR : substr : In SparkR dataframe , starting and ending position arguments in &quot;substr&quot; is giving wrong result  when the position is greater than 1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="narendra_k">Narendra</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Feb 2018 01:17:44 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:10 +0000</updated>
                            <resolved>Wed, 7 Mar 2018 17:38:46 +0000</resolved>
                                    <version>2.1.2</version>
                    <version>2.2.0</version>
                    <version>2.2.1</version>
                    <version>2.3.0</version>
                                    <fixVersion>2.3.1</fixVersion>
                    <fixVersion>2.4.0</fixVersion>
                                    <component>SparkR</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16347967" author="apachespark" created="Thu, 1 Feb 2018 03:42:04 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/20464&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20464&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16416763" author="cloud_fan" created="Wed, 28 Mar 2018 03:43:10 +0000"  >&lt;p&gt;shall we backport this bug fix to 2.3?&lt;/p&gt;</comment>
                            <comment id="16418599" author="viirya" created="Thu, 29 Mar 2018 08:26:44 +0000"  >&lt;p&gt;Because it is related to behavior change, I&apos;m hesitant to make a backport to 2.3 right now.&lt;/p&gt;</comment>
                            <comment id="16463280" author="gurwls223" created="Fri, 4 May 2018 01:56:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt;, you feel like we should backport this? I was looking through PRs for backporting thing and seems we better backport it with a note in migration guide.&lt;br/&gt;
I think it was just a bad design mistake. It doesn&apos;t even match to R&apos;s one. Workaround should relatively easy if users are aware of this change.&lt;br/&gt;
If you feel about backporting it too, I would rather like to backport this.&lt;/p&gt;</comment>
                            <comment id="16463369" author="cloud_fan" created="Fri, 4 May 2018 05:05:39 +0000"  >&lt;p&gt;Yea I think we should backport it.&lt;/p&gt;</comment>
                            <comment id="16463391" author="gurwls223" created="Fri, 4 May 2018 05:44:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=felixcheung&quot; class=&quot;user-hover&quot; rel=&quot;felixcheung&quot;&gt;felixcheung&lt;/a&gt; WDYT?&lt;/p&gt;</comment>
                            <comment id="16464391" author="yanboliang" created="Fri, 4 May 2018 21:02:28 +0000"  >&lt;p&gt;This should be backported to Spark 2.3, as this is a bug fix and we can&apos;t wait several months for the next release. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt; Do you like to send a PR? Thanks.&lt;/p&gt;</comment>
                            <comment id="16465015" author="gurwls223" created="Sun, 6 May 2018 08:20:40 +0000"  >&lt;p&gt;Sure, will do.&lt;/p&gt;</comment>
                            <comment id="16465028" author="apachespark" created="Sun, 6 May 2018 08:59:05 +0000"  >&lt;p&gt;User &apos;HyukjinKwon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/21249&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21249&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16465030" author="apachespark" created="Sun, 6 May 2018 09:04:05 +0000"  >&lt;p&gt;User &apos;HyukjinKwon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/21250&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21250&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16465307" author="felixcheung" created="Sun, 6 May 2018 22:34:00 +0000"  >&lt;p&gt;actually, I&apos;m not sure we should backport this to a x.x.1 release.&lt;/p&gt;

&lt;p&gt;yes, the behavior &quot;was unexpected&quot; but it&#160;has been&#160;around for the last 3 years, if I recall, since the very beginning. and it is not a regression per se.&lt;/p&gt;

&lt;p&gt;either users don&apos;t care since it has never been reported, or (most likely) users have adopted to the behavior in which case we will break existing jobs in a patch release.&lt;/p&gt;

&lt;p&gt;anyway, it&apos;s just my 2c.&lt;/p&gt;</comment>
                            <comment id="16465356" author="gurwls223" created="Mon, 7 May 2018 02:01:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=felixcheung&quot; class=&quot;user-hover&quot; rel=&quot;felixcheung&quot;&gt;felixcheung&lt;/a&gt;, sure, I agree with that in general. However, we could probably think about this way too for this case specifically:&lt;/p&gt;

&lt;p&gt;in other words, it has been wrong for 3 years, it requires weird codes for R specifically comparing to other languages APIs. IMHO, It&apos;s a bit subtlety and users might be adopted to this bugs rather than bothering to report this out (of course I guess with some nuisance). Think about this expr(&quot;substr(...)&quot;) and substr work differently. I am also seeing &lt;a href=&quot;https://stackoverflow.com/questions/37413122/use-of-substr-on-dataframe-column-in-sparkr?rq=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;expr(&quot;substr(...)&quot;) is suggested as an alternative of substr&lt;/a&gt;  If it&apos;s clearly documented in the migration guide, I thought it can be fine.&lt;/p&gt;

&lt;p&gt;Also, this substr case is pretty well understood and isolated.&lt;/p&gt;

&lt;p&gt;As a reference, I recall a case - &lt;a href=&quot;https://github.com/apache/spark/pull/20499#issuecomment-363863660&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20499#issuecomment-363863660&lt;/a&gt;. It sounds pretty a similar case with that. I was hesitant at that time too but after thinking for a while, I ended up with kind of agreeing that the backport is okay. It wasn&apos;t a regression at that time too.&lt;/p&gt;</comment>
                            <comment id="16465433" author="felixcheung" created="Mon, 7 May 2018 05:02:06 +0000"  >&lt;p&gt;I don&apos;t disagree the behavior issue. (ah, so someone did run into it in 2016)&lt;/p&gt;

&lt;p&gt;If I recall, a&#160;few folks have brought up recently &lt;a href=&quot;https://semver.org/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://semver.org/&lt;/a&gt;&#160;I think it might be worthwhile whether we are following the principles of semantic versioning... or not.&lt;/p&gt;

&lt;p&gt;I don&apos;t feel strongly about this so I&apos;ll leave others to comment.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 28 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3pmmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311620" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Shepherd</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>felixcheung</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12342432">2.3.1</customfieldvalue>
    <customfieldvalue id="12342385">2.4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>