<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:52:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-20214] pyspark linalg _convert_to_vector should check for sorted indices</title>
                <link>https://issues.apache.org/jira/browse/SPARK-20214</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I&apos;ve seen a few failures of this line: &lt;a href=&quot;https://github.com/apache/spark/blame/402bf2a50ddd4039ff9f376b641bd18fffa54171/python/pyspark/mllib/tests.py#L847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blame/402bf2a50ddd4039ff9f376b641bd18fffa54171/python/pyspark/mllib/tests.py#L847&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It converts a scipy.sparse.lil_matrix to a dok_matrix and then to a pyspark.mllib.linalg.Vector.  The failure happens in the conversion to a vector and indicates that the dok_matrix is not returning its values in sorted order. (Actually, the failure is in _convert_to_vector, which converts the dok_matrix to a csc_matrix and then passes the CSC data to the MLlib Vector constructor.) Here&apos;s the stack trace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/python/pyspark/mllib/tests.py&quot;&lt;/span&gt;, line 847, in test_serialize
    self.assertEqual(sv, _convert_to_vector(lil.todok()))
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/python/pyspark/mllib/linalg/__init__.py&quot;&lt;/span&gt;, line 78, in _convert_to_vector
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; SparseVector(l.shape[0], csc.indices, csc.data)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/python/pyspark/mllib/linalg/__init__.py&quot;&lt;/span&gt;, line 556, in __init__
    % (self.indices[i], self.indices[i + 1]))
TypeError: Indices 3 and 1 are not strictly increasing
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This seems like a bug in _convert_to_vector, where we really should check &lt;tt&gt;csc_matrix.has_sorted_indices&lt;/tt&gt; first.&lt;/p&gt;

&lt;p&gt;I haven&apos;t seen this bug in pyspark.ml.linalg, but it probably exists there too.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13061551">SPARK-20214</key>
            <summary>pyspark linalg _convert_to_vector should check for sorted indices</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="josephkb">Joseph K. Bradley</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Apr 2017 22:03:05 +0000</created>
                <updated>Thu, 6 Apr 2017 00:59:25 +0000</updated>
                            <resolved>Thu, 6 Apr 2017 00:51:08 +0000</resolved>
                                    <version>1.5.2</version>
                    <version>1.6.3</version>
                    <version>2.0.2</version>
                    <version>2.1.1</version>
                    <version>2.2.0</version>
                                    <fixVersion>2.0.3</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>ML</component>
                    <component>MLlib</component>
                    <component>PySpark</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15956237" author="viirya" created="Wed, 5 Apr 2017 03:23:55 +0000"  >&lt;p&gt;Confirmed that dok_matrix.tocsc() won&apos;t guarantee sorted indices:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt;&amp;gt;&amp;gt; from scipy.sparse &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; lil_matrix
&amp;gt;&amp;gt;&amp;gt; lil = lil_matrix((4, 1))
&amp;gt;&amp;gt;&amp;gt; lil[1, 0] = 1
&amp;gt;&amp;gt;&amp;gt; lil[3, 0] = 2
&amp;gt;&amp;gt;&amp;gt; dok = lil.todok()
&amp;gt;&amp;gt;&amp;gt; csc = dok.tocsc()
&amp;gt;&amp;gt;&amp;gt; csc.has_sorted_indices
0
&amp;gt;&amp;gt;&amp;gt; csc.indices
array([3, 1], dtype=int32)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I checked the source codes of scipy. The only way to guarantee it is &lt;tt&gt;csc_matrix.tocsr()&lt;/tt&gt; and &lt;tt&gt;csr_matrix.tocsc()&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15956242" author="apachespark" created="Wed, 5 Apr 2017 03:31:02 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17532&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17532&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15958116" author="josephkb" created="Thu, 6 Apr 2017 00:51:08 +0000"  >&lt;p&gt;Issue resolved by pull request 17532&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17532&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17532&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3d7en:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311620" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Shepherd</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>josephkb</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12338608">2.0.3</customfieldvalue>
    <customfieldvalue id="12340295">2.1.2</customfieldvalue>
    <customfieldvalue id="12338275">2.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>