<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:03:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-26549] PySpark worker reuse take no effect for parallelize xrange</title>
                <link>https://issues.apache.org/jira/browse/SPARK-26549</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;During &lt;a href=&quot;https://github.com/apache/spark/pull/23435#issuecomment-451079886&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the follow-up work&lt;/a&gt; for PySpark worker reuse scenario, we found that the worker reuse takes no effect for `sc.parallelize(xrange(...))`.&lt;br/&gt;
It happened because of the specialize rdd.parallelize for xrange(&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-4398&quot; title=&quot;Specialize rdd.parallelize for xrange&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-4398&quot;&gt;&lt;del&gt;SPARK-4398&lt;/del&gt;&lt;/a&gt;) generated data by xrange, which don&apos;t need to use the passed-in iterator. But this will break the end of stream checking in python worker and finally cause worker reuse takes no effect.&lt;/p&gt;


&lt;p&gt;Relative code block and more details listing below:&lt;br/&gt;
Current specialize logic of xrange don&apos;t need the passed-in iterator, context.py:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; isinstance(c, xrange):
    ...
    def f(split, iterator):
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; xrange(getStart(split), getStart(split + 1), step)
    ...
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self.parallelize([], numSlices).mapPartitionsWithIndex(f)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We got an unexpected value -1 which refers to END_OF_DATA_SECTION while check end of stream. See the code in worker.py:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# check end of stream
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; read_int(infile) == SpecialLengths.END_OF_STREAM:
    write_int(SpecialLengths.END_OF_STREAM, outfile)
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;:
    # write a different value to tell JVM to not reuse &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; worker
    write_int(SpecialLengths.END_OF_DATA_SECTION, outfile)
    sys.exit(-1)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The code works well for parallelize(range) because the END_OF_DATA_SECTION has been handled during load iterator from the socket stream, see the code in FramedSerializer:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def load_stream(self, stream):
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; True:
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;:
            yield self._read_with_length(stream)
        except EOFError:
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;
...
def _read_with_length(self, stream):
    length = read_int(stream)
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; length == SpecialLengths.END_OF_DATA_SECTION:
        raise EOFError #END_OF_DATA_SECTION raised EOF here and catched in load_stream
    elif length == SpecialLengths.NULL:
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; None
    obj = stream.read(length)
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; len(obj) &amp;lt; length:
        raise EOFError
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self.loads(obj)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13207842">SPARK-26549</key>
            <summary>PySpark worker reuse take no effect for parallelize xrange</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="XuanYuan">Yuanjian Li</assignee>
                                    <reporter username="XuanYuan">Yuanjian Li</reporter>
                        <labels>
                    </labels>
                <created>Sat, 5 Jan 2019 18:48:28 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:55 +0000</updated>
                            <resolved>Wed, 9 Jan 2019 03:58:59 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16737820" author="gurwls223" created="Wed, 9 Jan 2019 03:58:59 +0000"  >&lt;p&gt;Issue resolved by pull request 23470&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/23470&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23470&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13208374">SPARK-26573</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 44 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u00jpc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>