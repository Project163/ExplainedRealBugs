<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:49:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-18667] input_file_name function does not work with UDF</title>
                <link>https://issues.apache.org/jira/browse/SPARK-18667</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;tt&gt;input_file_name()&lt;/tt&gt; does not return the file name but empty string instead when it is used as input for UDF in PySpark as below: &lt;/p&gt;

&lt;p&gt;with the data as below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;: 1}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;with the codes below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from pyspark.sql.functions &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; *
from pyspark.sql.types &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; *

def filename(path):
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; path

sourceFile = udf(filename, StringType())
spark.read.json(&lt;span class=&quot;code-quote&quot;&gt;&quot;tmp.json&quot;&lt;/span&gt;).select(sourceFile(input_file_name())).show()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;prints as below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+---------------------------+
|filename(input_file_name())|
+---------------------------+
|                           |
+---------------------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but the codes below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;spark.read.json(&lt;span class=&quot;code-quote&quot;&gt;&quot;tmp.json&quot;&lt;/span&gt;).select(input_file_name()).show()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;prints correctly as below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+--------------------+
|   input_file_name()|
+--------------------+
|file:&lt;span class=&quot;code-comment&quot;&gt;///Users/hyu...|
&lt;/span&gt;+--------------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This seems PySpark specific issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13024686">SPARK-18667</key>
            <summary>input_file_name function does not work with UDF</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="gurwls223">Hyukjin Kwon</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Dec 2016 07:00:36 +0000</created>
                <updated>Mon, 12 Dec 2022 17:51:26 +0000</updated>
                            <resolved>Thu, 8 Dec 2016 15:49:20 +0000</resolved>
                                                    <fixVersion>2.1.0</fixVersion>
                                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15714200" author="apachespark" created="Fri, 2 Dec 2016 06:08:04 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/16115&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/16115&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15821073" author="someonehere15" created="Thu, 12 Jan 2017 14:09:08 +0000"  >&lt;p&gt;I still have the same problem on pySpark 2.1.0 and Python 3.5.2 with the exact same steps as described in the issue.&lt;/p&gt;

&lt;p&gt;Additionally I also have the following problem:&lt;br/&gt;
I have two dataframes, one where I read files and consequently has input_file_name() containing the source path for each row, and another with other stuff and a column FILEPATH already containing the same file paths as a static value. Basically I want to join these tables on the filepath columns. So I do the following:&lt;/p&gt;

&lt;p&gt;Add a proper filepath column to the first dataframe, based on input_file_name():&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;dataFrame = dataFrame.withColumn(&apos;FILEPATH&apos;,input_file_name())
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;or the same happens with&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;dataFrame = dataFrame.select(&apos;*&apos;, input_file_name().alias(&apos;FILEPATH&apos;))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and then I join the two tables on the FILEPATH column:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;dataFrame = dataFrame.join(df2, &apos;FILEPATH&apos;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so until here everything works, and I don&apos;t get an empty FILEPATH column.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+--------------+-------+-------+
|      FILEPATH|ColumnA|ColumnB|
+--------------+-------+-------+
|file:/C:/a.xml| StuffA| StuffX|
|file:/C:/b.xml| StuffB| StuffY|
+--------------+-------+-------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But then, on the resulting dataframe, if I want to apply an UDF on any column, I get a completely empty result:&lt;br/&gt;
e.g. I have the following UDF:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;def f(text):
  return text
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and I do:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;dataFrame.selectExpr(&apos;FILEPATH AS PATH&apos;,&apos;f(ColumnA) AS A&apos;,&apos;ColumnB AS B&apos;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I get:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+--------------+-------+-------+
|          PATH|      A|      B|
+--------------+-------+-------+
+--------------+-------+-------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Am I missing something or is a bug still present?&lt;/p&gt;

&lt;p&gt;UPDATE:&lt;br/&gt;
I also just tried with:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;dataFrame.select(&apos;FILEPATH&apos;,sup(&apos;FILEPATH&apos;))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and both columns come up empty&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+--------+-----------+
|FILEPATH|f(FILEPATH)|
+--------+-----------+
|        |           |
|        |           |
|        |           |
|        |           |
|        |           |
+--------+-----------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;although here apparently the dataframe is not empty, just these columns, since I do get empty rows, whereas above there are no rows at all and the dataframe was empty.&lt;/p&gt;</comment>
                            <comment id="15821135" author="viirya" created="Thu, 12 Jan 2017 14:39:10 +0000"  >&lt;p&gt;Hi Ben,&lt;/p&gt;

&lt;p&gt;I&apos;ve just tried the example codes in current master as described above like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from pyspark.sql.functions &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; *
from pyspark.sql.types &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; *

def filename(path):
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; path

sourceFile = udf(filename, StringType())
spark.read.json(&lt;span class=&quot;code-quote&quot;&gt;&quot;tmp.json&quot;&lt;/span&gt;).select(sourceFile(input_file_name())).show()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It works. Can you make sure the version you are using is 2.1 or above?&lt;/p&gt;
</comment>
                            <comment id="15821188" author="someonehere15" created="Thu, 12 Jan 2017 15:00:31 +0000"  >&lt;p&gt;OK, I just tried it with a json and it worked.&lt;/p&gt;

&lt;p&gt;To be honest I was trying it with an XML file, and I didn&apos;t think that would matter, but apparently yes.&lt;br/&gt;
So, the exact same code, but with an XML file through the spark-xml library is not working.&lt;/p&gt;

&lt;p&gt;Can you confirm this?&lt;/p&gt;

&lt;p&gt;Would this be a spark-xml issue then, or still a pyspark issue?&lt;/p&gt;</comment>
                            <comment id="15821506" author="someonehere15" created="Fri, 13 Jan 2017 09:43:04 +0000"  >&lt;p&gt;So, I created a new example now, and here is the code for everything:&lt;/p&gt;

&lt;p&gt;a.xml:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;root&amp;gt;
  &amp;lt;x&amp;gt;TEXT&amp;lt;/x&amp;gt;
  &amp;lt;y&amp;gt;TEXT2&amp;lt;/y&amp;gt;
&amp;lt;/root&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;b.xml:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;root&amp;gt;
  &amp;lt;file&amp;gt;file:/C:/Users/SSS/a.xml&amp;lt;/file&amp;gt;
  &amp;lt;other&amp;gt;AAA&amp;lt;/other&amp;gt;
&amp;lt;/root&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;code:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;from pyspark.sql.functions import udf,input_file_name
from pyspark.sql.types import StringType
from pyspark.sql import SparkSession

def filename(path):
    return path

session = SparkSession.builder.appName(&apos;APP&apos;).getOrCreate()

session.udf.register(&apos;sameText&apos;,filename)
sameText = udf(filename, StringType())

df = session.read.format(&apos;xml&apos;).load(&apos;../../res/Other/a.xml&apos;, rowTag=&apos;root&apos;).select(&apos;*&apos;,input_file_name().alias(&apos;file&apos;))
df.select(&apos;file&apos;).show()
df.select(sameText(df[&apos;file&apos;])).show()

df2 = session.read.format(&apos;xml&apos;).load(&apos;../../res/Other/b.xml&apos;, rowTag=&apos;root&apos;)
df3 = df.join(df2, &apos;file&apos;)

df.show()
df2.show()
df3.show()
df3.selectExpr(&apos;file as FILE&apos;,&apos;x AS COL1&apos;,&apos;sameText(y) AS COL2&apos;).show()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and this is the console output:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+--------------------+
|                file|
+--------------------+
|file:/C:/Users/SS...|
+--------------------+

+--------------+
|filename(file)|
+--------------+
|              |
+--------------+

+----+-----+--------------------+
|   x|    y|                file|
+----+-----+--------------------+
|TEXT|TEXT2|file:/C:/Users/SS...|
+----+-----+--------------------+

+--------------------+-----+
|                file|other|
+--------------------+-----+
|file:/C:/Users/SS...|  AAA|
+--------------------+-----+

+--------------------+----+-----+-----+
|                file|   x|    y|other|
+--------------------+----+-----+-----+
|file:/C:/Users/SS...|TEXT|TEXT2|  AAA|
+--------------------+----+-----+-----+


[Stage 26:&amp;gt;                                                         (0 + 4) / 4]
                                                                                

[Stage 29:&amp;gt;                                                        (0 + 8) / 20]
[Stage 29:=================&amp;gt;                                       (6 + 8) / 20]
[Stage 29:===================&amp;gt;                                     (7 + 8) / 20]
[Stage 29:======================&amp;gt;                                  (8 + 8) / 20]
[Stage 29:============================&amp;gt;                           (10 + 8) / 20]
[Stage 29:====================================&amp;gt;                   (13 + 7) / 20]
[Stage 29:=======================================&amp;gt;                (14 + 6) / 20]
[Stage 29:==========================================&amp;gt;             (15 + 5) / 20]
                                                                                

[Stage 32:&amp;gt;                                                       (0 + 8) / 100]
[Stage 32:===&amp;gt;                                                    (7 + 8) / 100]
[Stage 32:====&amp;gt;                                                   (8 + 8) / 100]
[Stage 32:=======&amp;gt;                                               (13 + 8) / 100]
[Stage 32:========&amp;gt;                                              (15 + 8) / 100]
[Stage 32:===========&amp;gt;                                           (20 + 8) / 100]
[Stage 32:============&amp;gt;                                          (22 + 8) / 100]
[Stage 32:==============&amp;gt;                                        (27 + 8) / 100]
[Stage 32:===============&amp;gt;                                       (29 + 8) / 100]
[Stage 32:==================&amp;gt;                                    (34 + 8) / 100]
[Stage 32:===================&amp;gt;                                   (36 + 8) / 100]
[Stage 32:======================&amp;gt;                                (41 + 8) / 100]
[Stage 32:=======================&amp;gt;                               (42 + 8) / 100]
[Stage 32:=========================&amp;gt;                             (46 + 8) / 100]
[Stage 32:==========================&amp;gt;                            (48 + 8) / 100]
[Stage 32:==========================&amp;gt;                            (49 + 8) / 100]
[Stage 32:===========================&amp;gt;                           (50 + 8) / 100]
[Stage 32:=============================&amp;gt;                         (53 + 8) / 100]
[Stage 32:==============================&amp;gt;                        (55 + 8) / 100]
[Stage 32:==============================&amp;gt;                        (56 + 8) / 100]
[Stage 32:===============================&amp;gt;                       (57 + 8) / 100]
[Stage 32:=================================&amp;gt;                     (60 + 8) / 100]
[Stage 32:==================================&amp;gt;                    (62 + 8) / 100]
[Stage 32:==================================&amp;gt;                    (63 + 8) / 100]
[Stage 32:===================================&amp;gt;                   (65 + 8) / 100]
[Stage 32:====================================&amp;gt;                  (67 + 8) / 100]
[Stage 32:=====================================&amp;gt;                 (69 + 8) / 100]
[Stage 32:======================================&amp;gt;                (70 + 8) / 100]
[Stage 32:=======================================&amp;gt;               (72 + 8) / 100]
[Stage 32:========================================&amp;gt;              (74 + 8) / 100]
[Stage 32:=========================================&amp;gt;             (76 + 8) / 100]
[Stage 32:==========================================&amp;gt;            (77 + 8) / 100]
[Stage 32:===========================================&amp;gt;           (79 + 8) / 100]
[Stage 32:============================================&amp;gt;          (81 + 8) / 100]
[Stage 32:=============================================&amp;gt;         (83 + 8) / 100]
[Stage 32:==============================================&amp;gt;        (84 + 8) / 100]
[Stage 32:===============================================&amp;gt;       (86 + 8) / 100]
[Stage 32:================================================&amp;gt;      (88 + 8) / 100]
[Stage 32:=================================================&amp;gt;     (90 + 8) / 100]
[Stage 32:==================================================&amp;gt;    (91 + 8) / 100]
[Stage 32:===================================================&amp;gt;   (93 + 7) / 100]
[Stage 32:====================================================&amp;gt;  (95 + 5) / 100]
[Stage 32:=====================================================&amp;gt; (97 + 3) / 100]
                                                                                

[Stage 35:&amp;gt;                                                        (0 + 8) / 75]
[Stage 35:==&amp;gt;                                                     (4 + 11) / 75]
[Stage 35:=====&amp;gt;                                                   (7 + 8) / 75]
[Stage 35:======&amp;gt;                                                  (8 + 8) / 75]
[Stage 35:=========&amp;gt;                                              (13 + 8) / 75]
[Stage 35:==========&amp;gt;                                             (14 + 8) / 75]
[Stage 35:===========&amp;gt;                                            (15 + 8) / 75]
[Stage 35:===========&amp;gt;                                            (16 + 8) / 75]
[Stage 35:==============&amp;gt;                                         (20 + 8) / 75]
[Stage 35:===============&amp;gt;                                        (21 + 8) / 75]
[Stage 35:================&amp;gt;                                       (22 + 8) / 75]
[Stage 35:=================&amp;gt;                                      (23 + 8) / 75]
[Stage 35:====================&amp;gt;                                   (27 + 8) / 75]
[Stage 35:====================&amp;gt;                                   (28 + 8) / 75]
[Stage 35:=====================&amp;gt;                                  (29 + 8) / 75]
[Stage 35:======================&amp;gt;                                 (30 + 8) / 75]
[Stage 35:=========================&amp;gt;                              (34 + 8) / 75]
[Stage 35:==========================&amp;gt;                             (35 + 8) / 75]
[Stage 35:==========================&amp;gt;                             (36 + 8) / 75]
[Stage 35:===========================&amp;gt;                            (37 + 8) / 75]
[Stage 35:==============================&amp;gt;                         (41 + 8) / 75]
[Stage 35:===============================&amp;gt;                        (42 + 8) / 75]
[Stage 35:================================&amp;gt;                       (43 + 8) / 75]
[Stage 35:================================&amp;gt;                       (44 + 8) / 75]
[Stage 35:===================================&amp;gt;                    (48 + 8) / 75]
[Stage 35:====================================&amp;gt;                   (49 + 8) / 75]
[Stage 35:=====================================&amp;gt;                  (50 + 8) / 75]
[Stage 35:======================================&amp;gt;                 (51 + 8) / 75]
[Stage 35:=========================================&amp;gt;              (55 + 8) / 75]
[Stage 35:=========================================&amp;gt;              (56 + 8) / 75]
[Stage 35:==========================================&amp;gt;             (57 + 8) / 75]
[Stage 35:===========================================&amp;gt;            (58 + 8) / 75]
[Stage 35:==============================================&amp;gt;         (62 + 8) / 75]
[Stage 35:===============================================&amp;gt;        (63 + 8) / 75]
[Stage 35:================================================&amp;gt;       (65 + 8) / 75]
[Stage 35:===================================================&amp;gt;    (69 + 6) / 75]
[Stage 35:=====================================================&amp;gt;  (72 + 3) / 75]
+--------------------+----+-----+
|                FILE|COL1| COL2|
+--------------------+----+-----+
|file:/C:/Users/SS...|TEXT|TEXT2|
+--------------------+----+-----+

SUCCESS: The process with PID 11916 (child process of PID 3592) has been terminated.
SUCCESS: The process with PID 3592 (child process of PID 9904) has been terminated.
SUCCESS: The process with PID 9904 (child process of PID 5468) has been terminated.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see, After I add the &quot;file&quot; column, and show it, it&apos;s working. But then if I apply an UDF on it, it returns empty.&lt;br/&gt;
Then I proceed with the join, and show each dataframe again. Everything is OK until the last row, where it takes a very long time considering the amount of data and the speed of the previous processes. And this worries me becauses I don&apos;t think it is supposed to take such a long time.&lt;br/&gt;
Additionally, although in this example it works in the end, in my actual code it is not working. So as I already wrote on the previous post, if I join two dataframes, everything is OK, until I do a select where I apply a UDF, and then the whole query returns empty. The UDF works well if I don&apos;t join.&lt;br/&gt;
The other thing is, that if I do a count on the dataframe after the select just mentioned, it returns the correct number of rows, and not 0, but if I try to show or write the rows, the dataframe comes up empty. I&apos;m not sure why this is happening so I would appreciate any help, and to at least know whether it&apos;s a bug or not.&lt;/p&gt;</comment>
                            <comment id="15821852" author="viirya" created="Fri, 13 Jan 2017 14:22:28 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=someonehere15&quot; class=&quot;user-hover&quot; rel=&quot;someonehere15&quot;&gt;someonehere15&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Thanks for providing the info. I can reproduce the issue on spark-xml package when applying UDF on the column of input_file_name, the result will be empty.&lt;/p&gt;

&lt;p&gt;I will take a look into this issue.&lt;/p&gt;
</comment>
                            <comment id="15821929" author="someonehere15" created="Fri, 13 Jan 2017 15:58:46 +0000"  >&lt;p&gt;Happy to help.&lt;br/&gt;
Were you also able to reproduce the second issue, regarding the join and UDF?&lt;br/&gt;
As I said, in my script, the count shows a correct number, but returns an empty table. Whereas in the example I provided seems to work, but very slowly, which is also suspicious for 1 single small row.&lt;br/&gt;
Would this also be caused by the same bug causing the UDF on input_file_name issue or is it unrelated?&lt;/p&gt;</comment>
                            <comment id="15822631" author="viirya" created="Sat, 14 Jan 2017 02:00:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=someonehere15&quot; class=&quot;user-hover&quot; rel=&quot;someonehere15&quot;&gt;someonehere15&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Yeah, I can reproduce that the last line &lt;tt&gt;df3.selectExpr(&apos;file as FILE&apos;,&apos;x AS COL1&apos;,&apos;sameText( y ) AS COL2&apos;).show()&lt;/tt&gt; costs more time to run. At the first look, I think they are different problems. I will take a look too. Thank you.&lt;/p&gt;</comment>
                            <comment id="15901403" author="someonehere15" created="Wed, 8 Mar 2017 15:14:20 +0000"  >&lt;p&gt;Any news on this? &lt;br/&gt;
The issue is still there, at least wil spark-xml, so I think this issue should be reopened.&lt;/p&gt;</comment>
                            <comment id="15901426" author="viirya" created="Wed, 8 Mar 2017 15:28:47 +0000"  >&lt;p&gt;I already created another JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-19223&quot; title=&quot;InputFileBlockHolder doesn&amp;#39;t work with Python UDF for datasource other than FileFormat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-19223&quot;&gt;&lt;del&gt;SPARK-19223&lt;/del&gt;&lt;/a&gt; for the issue of spark-xml.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 36 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i370a7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>