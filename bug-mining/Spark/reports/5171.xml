<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:55:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-22052] Incorrect Metric assigned in MetricsReporter.scala</title>
                <link>https://issues.apache.org/jira/browse/SPARK-22052</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The wrong metric is being sent in MetricsReporter.scala&lt;/p&gt;

&lt;p&gt;The current implementation for processingRate-total is assigned the wrong metric:&lt;br/&gt;
Look at the first and second registerGauge. The second one mistakenly uses inputRowsPerSecond instead of processedRowsPerSecond.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MetricsReporter(
    stream: StreamExecution,
    override val sourceName: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; CodahaleSource with Logging {

  override val metricRegistry: MetricRegistry = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MetricRegistry

  &lt;span class=&quot;code-comment&quot;&gt;// Metric names should not have . in them, so that all the metrics of a query are identified
&lt;/span&gt;  &lt;span class=&quot;code-comment&quot;&gt;// together in Ganglia as a single metric group
&lt;/span&gt;  registerGauge(&lt;span class=&quot;code-quote&quot;&gt;&quot;inputRate-total&quot;&lt;/span&gt;, () =&amp;gt; stream.lastProgress.inputRowsPerSecond)
  registerGauge(&lt;span class=&quot;code-quote&quot;&gt;&quot;processingRate-total&quot;&lt;/span&gt;, () =&amp;gt; stream.lastProgress.inputRowsPerSecond)
  registerGauge(&lt;span class=&quot;code-quote&quot;&gt;&quot;latency&quot;&lt;/span&gt;, () =&amp;gt; stream.lastProgress.durationMs.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;triggerExecution&quot;&lt;/span&gt;).longValue())

  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; def registerGauge[T](name: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, f: () =&amp;gt; T)(implicit num: Numeric[T]): Unit = {
    &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; {
      metricRegistry.register(name, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Gauge[T] {
        override def getValue: T = f()
      })
    }
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/blob/master/sql/core/src/main/scala/org/apache/spark/sql/execution/streaming/MetricsReporter.scala&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/sql/core/src/main/scala/org/apache/spark/sql/execution/streaming/MetricsReporter.scala&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;After adjusting the line and rebuilding from source I tested the change by checking the csv files produced via the metrics properties file. Previously inputRate-total and processingRate-total were identical due to the same metric being used. After the change the processingRate-total file held the right value. &lt;/p&gt;

&lt;p&gt;Please check the attached file &quot;Processed Rows Per Second&quot;.&lt;br/&gt;
After altering the code the correct values are displayed in column B. &lt;br/&gt;
They match the data from the INFO StreamExecution displayed during streaming&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Spark 2.2 &lt;br/&gt;
MetricsReporter.scala&lt;/p&gt;</environment>
        <key id="13103008">SPARK-22052</key>
            <summary>Incorrect Metric assigned in MetricsReporter.scala</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Taaffy">Jason Taaffe</assignee>
                                    <reporter username="Taaffy">Jason Taaffe</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Sep 2017 17:29:49 +0000</created>
                <updated>Tue, 19 Sep 2017 09:21:35 +0000</updated>
                            <resolved>Tue, 19 Sep 2017 09:20:47 +0000</resolved>
                                    <version>2.2.0</version>
                    <version>2.3.0</version>
                                    <fixVersion>2.1.2</fixVersion>
                    <fixVersion>2.2.1</fixVersion>
                    <fixVersion>2.3.0</fixVersion>
                                    <component>Input/Output</component>
                    <component>Structured Streaming</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16170399" author="apachespark" created="Mon, 18 Sep 2017 17:59:03 +0000"  >&lt;p&gt;User &apos;Taaffy&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19268&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19268&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16171389" author="srowen" created="Tue, 19 Sep 2017 09:20:47 +0000"  >&lt;p&gt;Issue resolved by pull request 19268&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19268&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19268&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12887702" name="Processed Rows Per Second.png" size="78497" author="Taaffy" created="Mon, 18 Sep 2017 17:30:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://github.com/apache/spark/pull/19268]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 9 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3k733:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>