<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:01:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-25005] Structured streaming doesn&apos;t support kafka transaction (creating empty offset with abort &amp; markers)</title>
                <link>https://issues.apache.org/jira/browse/SPARK-25005</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Structured streaming can&apos;t consume kafka transaction. &lt;br/&gt;
We could try to apply&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-24720&quot; title=&quot;kafka transaction creates Non-consecutive Offsets (due to transaction offset) making streaming fail when failOnDataLoss=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-24720&quot;&gt;&lt;del&gt;SPARK-24720&lt;/del&gt;&lt;/a&gt;&#160;(DStream) logic to Structured Streaming source&lt;/p&gt;</description>
                <environment></environment>
        <key id="13176565">SPARK-25005</key>
            <summary>Structured streaming doesn&apos;t support kafka transaction (creating empty offset with abort &amp; markers)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zsxwing">Shixiong Zhu</assignee>
                                    <reporter username="qambard">Quentin Ambard</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Aug 2018 20:47:55 +0000</created>
                <updated>Wed, 3 Oct 2018 22:26:48 +0000</updated>
                            <resolved>Tue, 28 Aug 2018 15:38:36 +0000</resolved>
                                    <version>2.3.1</version>
                                    <fixVersion>2.4.0</fixVersion>
                                    <component>Structured Streaming</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16573585" author="apachespark" created="Wed, 8 Aug 2018 17:52:07 +0000"  >&lt;p&gt;User &apos;zsxwing&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22042&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22042&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16637532" author="qambard" created="Wed, 3 Oct 2018 21:37:14 +0000"  >&lt;p&gt;How do you make difference between data loss or data missing when .pool()&#160;doesn&apos;t return any value &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zsxwing&quot; class=&quot;user-hover&quot; rel=&quot;zsxwing&quot;&gt;zsxwing&lt;/a&gt; ? Correct me if I&apos;m wrong but you could lose data in this situation&#160;no ?&lt;/p&gt;

&lt;p&gt;I think there is a third case here &lt;a href=&quot;https://github.com/zsxwing/spark/blob/ea804cfe840196519cc9444be9bedf03d10aa11a/external/kafka-0-10-sql/src/main/scala/org/apache/spark/sql/kafka010/KafkaDataConsumer.scala#L474&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/zsxwing/spark/blob/ea804cfe840196519cc9444be9bedf03d10aa11a/external/kafka-0-10-sql/src/main/scala/org/apache/spark/sql/kafka010/KafkaDataConsumer.scala#L474&lt;/a&gt;&#160;which is : something went wrong,&#160;data is available in kafka but I failed to get it.&lt;br/&gt;
I&apos;ve seen it happening when the max.pool size is big with big messages and the heap is getting full. Message exist but the jvm lags&#160;and&#160;the consumer&#160;timeout before getting the messages&lt;/p&gt;</comment>
                            <comment id="16637541" author="zsxwing" created="Wed, 3 Oct 2018 21:47:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qambard&quot; class=&quot;user-hover&quot; rel=&quot;qambard&quot;&gt;qambard&lt;/a&gt; If `poll` returns and offset gets changed, it means Kafka consumer fetches something but all of messages are invisible so consumer return empty.&lt;/p&gt;

&lt;p&gt;If `poll` returns but offset doesn&apos;t change, it means Kafka fetches nothing before timeout. In this case, we just throw &quot;TimeoutException&quot;. Spark will retry the task or just fail the job. Large GC pause can cause timeout and the user should tune the configs to avoid this happening. We cannot do much in Spark.&lt;/p&gt;</comment>
                            <comment id="16637560" author="qambard" created="Wed, 3 Oct 2018 22:16:46 +0000"  >&lt;p&gt;ok I see, great&#160;idea, and the consumer ensure us&#160;that the position won&apos;t be updated if pool returns an empty list for any reason?&lt;/p&gt;

&lt;p&gt;Also if a partition is full with&#160;invisible messages due to transaction abort, we&apos;ll have to wait for the pool timeout everytime&#160;(at least that&apos;s what I see in my tests)&#160;It could hurt&#160;throughput, especially if we have to wait for each partition. Not sure how we could solve that...&lt;/p&gt;</comment>
                            <comment id="16637564" author="zsxwing" created="Wed, 3 Oct 2018 22:26:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qambard&quot; class=&quot;user-hover&quot; rel=&quot;qambard&quot;&gt;qambard&lt;/a&gt; Not sure about your question. If Kafka consumers fetch nothing, it will not update the position.&lt;/p&gt;

&lt;p&gt;And yes, if a partition is full with invisible messages, we have to wait for timeout. I don&apos;t see any API to avoid this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3wmzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>