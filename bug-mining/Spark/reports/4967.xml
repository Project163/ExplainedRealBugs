<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:54:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-14657] RFormula output wrong features when formula w/o intercept</title>
                <link>https://issues.apache.org/jira/browse/SPARK-14657</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;SparkR::glm output different features compared with R glm when fit w/o intercept and having string/category features. Take the following example, SparkR output three features compared with four features for native R.&lt;br/&gt;
SparkR::glm&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;training &amp;lt;- suppressWarnings(createDataFrame(sqlContext, iris))&lt;br/&gt;
model &amp;lt;- glm(Sepal_Width ~ Sepal_Length + Species - 1, data = training)&lt;br/&gt;
summary(model)&lt;/p&gt;

&lt;p&gt;Coefficients:&lt;br/&gt;
                    Estimate  Std. Error  t value  Pr(&amp;gt;|t|)&lt;br/&gt;
Sepal_Length        0.67468   0.0093013   72.536   0&lt;br/&gt;
Species_versicolor  -1.2349   0.07269     -16.989  0&lt;br/&gt;
Species_virginica   -1.4708   0.077397    -19.003  0&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;stats::glm&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;summary(glm(Sepal.Width ~ Sepal.Length + Species - 1, data = iris))&lt;/p&gt;

&lt;p&gt;Coefficients:&lt;br/&gt;
                  Estimate Std. Error t value Pr(&amp;gt;|t|)    &lt;br/&gt;
Sepal.Length        0.3499     0.0463   7.557 4.19e-12 ***&lt;br/&gt;
Speciessetosa       1.6765     0.2354   7.123 4.46e-11 ***&lt;br/&gt;
Speciesversicolor   0.6931     0.2779   2.494   0.0137 *  &lt;br/&gt;
Speciesvirginica    0.6690     0.3078   2.174   0.0313 *  &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The encoder for string/category feature is different. R did not drop any category but SparkR drop the last one.&lt;br/&gt;
I searched online and test some other cases, found when we fit R glm model(or other models powered by R formula) w/o intercept on a dataset including string/category features, one of the categories in the first category feature is being used as reference category, we will not drop any category for that feature.&lt;/p&gt;

&lt;p&gt;I think we should keep consistent semantics between Spark RFormula and R formula.&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mengxr&quot; class=&quot;user-hover&quot; rel=&quot;mengxr&quot;&gt;mengxr&lt;/a&gt; &lt;/p&gt;</description>
                <environment></environment>
        <key id="12959114">SPARK-14657</key>
            <summary>RFormula output wrong features when formula w/o intercept</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yanboliang">Yanbo Liang</assignee>
                                    <reporter username="yanboliang">Yanbo Liang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 15 Apr 2016 09:21:17 +0000</created>
                <updated>Thu, 29 Jun 2017 02:35:35 +0000</updated>
                            <resolved>Thu, 29 Jun 2017 02:35:35 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>ML</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15242701" author="yanboliang" created="Fri, 15 Apr 2016 09:38:39 +0000"  >&lt;p&gt;More cases in R:&lt;/p&gt;

&lt;p&gt;df=data.frame(income=c(5,5,3,3,6,5),won=c(0,0,1,1,1,0),age=c(18,18,23,50,19,39),home=c(0,0,1,0,0,1))&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;#1 w/ intercept:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;model &amp;lt;- glm(factor(won) ~ factor(income) + factor(age) + factor(home), data=df, family=binomial(link=&quot;logit&quot;))&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Coefficients: (3 not defined because of singularities)&lt;br/&gt;
                  Estimate Std. Error z value Pr(&amp;gt;|z|)&lt;br/&gt;
(Intercept)      2.457e+01  1.310e+05       0        1&lt;br/&gt;
factor(income)5 -4.913e+01  1.605e+05       0        1&lt;br/&gt;
factor(income)6 -2.573e-30  1.853e+05       0        1&lt;br/&gt;
factor(age)19           NA         NA      NA       NA&lt;br/&gt;
factor(age)23   -1.383e-30  1.853e+05       0        1&lt;br/&gt;
factor(age)39   -3.479e-14  1.605e+05       0        1&lt;br/&gt;
factor(age)50           NA         NA      NA       NA&lt;br/&gt;
factor(home)1           NA         NA      NA       NA&lt;/p&gt;&lt;/blockquote&gt;
&lt;ul&gt;
	&lt;li&gt;#2 w/o intercept:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;model2 &amp;lt;- glm(factor(won) ~ factor(income) + factor(age) + factor(home) - 1, data=df, family=binomial(link=&quot;logit&quot;))&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Coefficients: (3 not defined because of singularities)&lt;br/&gt;
                  Estimate Std. Error z value Pr(&amp;gt;|z|)&lt;br/&gt;
factor(income)3  2.457e+01  1.310e+05       0        1&lt;br/&gt;
factor(income)5 -2.457e+01  9.264e+04       0        1&lt;br/&gt;
factor(income)6  2.457e+01  1.310e+05       0        1&lt;br/&gt;
factor(age)19           NA         NA      NA       NA&lt;br/&gt;
factor(age)23    1.103e-06  1.853e+05       0        1&lt;br/&gt;
factor(age)39    1.468e-14  1.605e+05       0        1&lt;br/&gt;
factor(age)50           NA         NA      NA       NA&lt;br/&gt;
factor(home)1           NA         NA      NA       NA&lt;/p&gt;&lt;/blockquote&gt;

&lt;ul&gt;
	&lt;li&gt;#3 w/o intercept:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;model3 &amp;lt;- glm(factor(won) ~ factor(age) + factor(income) + factor(home) - 1, data=df, family=binomial(link=&quot;logit&quot;))&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Coefficients: (3 not defined because of singularities)&lt;br/&gt;
                 Estimate Std. Error z value Pr(&amp;gt;|z|)&lt;br/&gt;
factor(age)18      -24.57   92638.55       0        1&lt;br/&gt;
factor(age)19       24.57  131010.78       0        1&lt;br/&gt;
factor(age)23       24.57  131010.78       0        1&lt;br/&gt;
factor(age)39      -24.57  131010.70       0        1&lt;br/&gt;
factor(age)50       24.57  131010.78       0        1&lt;br/&gt;
factor(income)5        NA         NA      NA       NA&lt;br/&gt;
factor(income)6        NA         NA      NA       NA&lt;br/&gt;
factor(home)1          NA         NA      NA       NA&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="15242709" author="yanboliang" created="Fri, 15 Apr 2016 09:46:46 +0000"  >&lt;p&gt;From the above cases, we can learn that only the first category feature should keep all categories and other ones still drop last.&lt;/p&gt;</comment>
                            <comment id="15242746" author="apachespark" created="Fri, 15 Apr 2016 10:13:03 +0000"  >&lt;p&gt;User &apos;yanboliang&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/12414&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12414&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15264920" author="josephkb" created="Fri, 29 Apr 2016 23:01:31 +0000"  >&lt;p&gt;I had hoped to get this into 2.0, but I think it will need to slip.  Testing some of your examples on my own, it looks like we may need more work to make R and SparkR match exactly.&lt;/p&gt;</comment>
                            <comment id="15948142" author="josephkb" created="Thu, 30 Mar 2017 00:17:39 +0000"  >&lt;p&gt;I&apos;m going to remove the target version, but please retarget if we can reactivate this.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                                                <inwardlinks description="Is contained by">
                                        <issuelink>
            <issuekey id="12972894">SPARK-15540</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12959123">SPARK-14659</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 33 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2w63z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12339551">2.3.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>