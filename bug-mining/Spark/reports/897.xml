<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:19:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-3995] [PYSPARK] PySpark&apos;s sample methods do not work with NumPy 1.9</title>
                <link>https://issues.apache.org/jira/browse/SPARK-3995</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;There is a breaking bug in PySpark&apos;s sampling methods when run with NumPy v1.9. This is the version of NumPy included with the current Anaconda distribution (v2.1); this is a popular distribution, and is likely to affect many users.&lt;/p&gt;

&lt;p&gt;Steps to reproduce are:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;foo = sc.parallelize(&lt;span class=&quot;code-object&quot;&gt;range&lt;/span&gt;(1000),5)
foo.takeSample(&lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;False&lt;/span&gt;&lt;/span&gt;, 10)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Returns:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;PythonException: Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/freemanj11/code/spark-1.1.0-bin-hadoop1/python/pyspark/worker.py&quot;&lt;/span&gt;, line 79, in main
    serializer.dump_stream(func(split_index, iterator), outfile)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/freemanj11/code/spark-1.1.0-bin-hadoop1/python/pyspark/serializers.py&quot;&lt;/span&gt;, line 196, in dump_stream
    self.serializer.dump_stream(self._batched(iterator), stream)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/freemanj11/code/spark-1.1.0-bin-hadoop1/python/pyspark/serializers.py&quot;&lt;/span&gt;, line 127, in dump_stream
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; obj in iterator:
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/freemanj11/code/spark-1.1.0-bin-hadoop1/python/pyspark/serializers.py&quot;&lt;/span&gt;, line 185, in _batched
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; item in iterator:
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/freemanj11/code/spark-1.1.0-bin-hadoop1/python/pyspark/rddsampler.py&quot;&lt;/span&gt;, line 116, in func
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; self.getUniformSample(split) &amp;lt;= self._fraction:
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/freemanj11/code/spark-1.1.0-bin-hadoop1/python/pyspark/rddsampler.py&quot;&lt;/span&gt;, line 58, in getUniformSample
    self.initRandomGenerator(split)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/freemanj11/code/spark-1.1.0-bin-hadoop1/python/pyspark/rddsampler.py&quot;&lt;/span&gt;, line 44, in initRandomGenerator
    self._random = numpy.random.RandomState(self._seed)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;mtrand.pyx&quot;&lt;/span&gt;, line 610, in mtrand.RandomState.__init__ (numpy/random/mtrand/mtrand.c:7397)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;mtrand.pyx&quot;&lt;/span&gt;, line 646, in mtrand.RandomState.seed (numpy/random/mtrand/mtrand.c:7697)
ValueError: Seed must be between 0 and 4294967295
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In PySpark&apos;s &lt;tt&gt;RDDSamplerBase&lt;/tt&gt; class from &lt;tt&gt;pyspark.rddsampler&lt;/tt&gt; we use:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;self&lt;/span&gt;._seed = seed &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; seed &lt;span class=&quot;code-keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;None&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; random.randint(0, sys.maxint)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In previous versions of NumPy a random seed larger than 2 ** 32 would silently get truncated to 2 ** 32. This was fixed in a recent patch (&lt;a href=&quot;https://github.com/numpy/numpy/commit/6b1a1205eac6fe5d162f16155d500765e8bca53c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/numpy/numpy/commit/6b1a1205eac6fe5d162f16155d500765e8bca53c&lt;/a&gt;). But sampling &lt;tt&gt;(0, sys.maxint)&lt;/tt&gt; often yields ints larger than 2 ** 32, which effectively breaks sampling operations in PySpark (unless the seed is set manually).&lt;/p&gt;

&lt;p&gt;I am putting a PR together now (the fix is very simple!).&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12748990">SPARK-3995</key>
            <summary>[PYSPARK] PySpark&apos;s sample methods do not work with NumPy 1.9</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="freeman-lab">Jeremy Freeman</assignee>
                                    <reporter username="freeman-lab">Jeremy Freeman</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Oct 2014 22:02:11 +0000</created>
                <updated>Thu, 27 Nov 2014 05:11:03 +0000</updated>
                            <resolved>Wed, 22 Oct 2014 16:33:34 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>PySpark</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14176637" author="mengxr" created="Mon, 20 Oct 2014 06:30:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=freeman-lab&quot; class=&quot;user-hover&quot; rel=&quot;freeman-lab&quot;&gt;freeman-lab&lt;/a&gt; Thanks for catching the bug! Please create a PR and ping me.&lt;/p&gt;</comment>
                            <comment id="14179657" author="apachespark" created="Wed, 22 Oct 2014 06:55:47 +0000"  >&lt;p&gt;User &apos;freeman-lab&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2889&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2889&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14180138" author="mengxr" created="Wed, 22 Oct 2014 16:33:34 +0000"  >&lt;p&gt;Issue resolved by pull request 2889&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2889&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2889&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14225636" author="andrewor14" created="Wed, 26 Nov 2014 03:02:14 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mengxr&quot; class=&quot;user-hover&quot; rel=&quot;mengxr&quot;&gt;mengxr&lt;/a&gt; do we want this in branch-1.1? If so we should re-open it.&lt;/p&gt;</comment>
                            <comment id="14225886" author="mengxr" created="Wed, 26 Nov 2014 08:11:50 +0000"  >&lt;p&gt;I think we can backport &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-4477&quot; title=&quot;remove numpy from RDDSampler of PySpark&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-4477&quot;&gt;&lt;del&gt;SPARK-4477&lt;/del&gt;&lt;/a&gt;, which removes numpy from sampling.&lt;/p&gt;</comment>
                            <comment id="14227266" author="freeman-lab" created="Thu, 27 Nov 2014 05:11:03 +0000"  >&lt;p&gt;Agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mengxr&quot; class=&quot;user-hover&quot; rel=&quot;mengxr&quot;&gt;mengxr&lt;/a&gt;, that&apos;s a better strategy.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 51 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21b9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327368">1.1.1</customfieldvalue>
    <customfieldvalue id="12327369">1.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>