<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:22:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-33398] AnalysisException when loading a PipelineModel with Spark 3</title>
                <link>https://issues.apache.org/jira/browse/SPARK-33398</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I am upgrading my Spark version from 2.4.5 to 3.0.1 and I cannot load anymore the PipelineModel objects that use a &quot;DecisionTreeClassifier&quot; stage.&lt;/p&gt;

&lt;p&gt;In my code I load several PipelineModel, all the PipelineModel with stages [&quot;CountVectorizer_&lt;span class=&quot;error&quot;&gt;&amp;#91;uid&amp;#93;&lt;/span&gt;&quot;, &quot;LinearSVC_&lt;span class=&quot;error&quot;&gt;&amp;#91;uid&amp;#93;&lt;/span&gt;&quot;] are loading fine whereas the models with stages &lt;br/&gt;
 [&quot;CountVectorizer_&lt;span class=&quot;error&quot;&gt;&amp;#91;uid&amp;#93;&lt;/span&gt;&quot;,&quot;DecisionTreeClassifier_&lt;span class=&quot;error&quot;&gt;&amp;#91;uid&amp;#93;&lt;/span&gt;&quot;] are throwing the following exception:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;AnalysisException: cannot resolve &apos;`rawCount`&apos; given input columns: [gain, id, impurity, impurityStats, leftChild, prediction, rightChild, split];&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is the code I am using and the full stacktrace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; pyspark.ml.pipeline &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; PipelineModel
PipelineModel.load(&lt;span class=&quot;code-quote&quot;&gt;&quot;/path/to/model&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;AnalysisException                         Traceback (most recent call last)
&amp;lt;command-1278858167154148&amp;gt; in &amp;lt;module&amp;gt;
----&amp;gt; 1 RalentModel = PipelineModel.load(MODELES_ATTRIBUTS + &quot;RalentModel_DT&quot;)/databricks/spark/python/pyspark/ml/util.py in load(cls, path)
    368     def load(cls, path):
    369         &quot;&quot;&quot;Reads an ML instance from the input path, a shortcut of `read().load(path)`.&quot;&quot;&quot;
--&amp;gt; 370         return cls.read().load(path)
    371 
    372 /databricks/spark/python/pyspark/ml/pipeline.py in load(self, path)
    289         metadata = DefaultParamsReader.loadMetadata(path, self.sc)
    290         if &apos;language&apos; not in metadata[&apos;paramMap&apos;] or metadata[&apos;paramMap&apos;][&apos;language&apos;] != &apos;Python&apos;:
--&amp;gt; 291             return JavaMLReader(self.cls).load(path)
    292         else:
    293             uid, stages = PipelineSharedReadWrite.load(metadata, self.sc, path)/databricks/spark/python/pyspark/ml/util.py in load(self, path)
    318         if not isinstance(path, basestring):
    319             raise TypeError(&quot;path should be a basestring, got type %s&quot; % type(path))
--&amp;gt; 320         java_obj = self._jread.load(path)
    321         if not hasattr(self._clazz, &quot;_from_java&quot;):
    322             raise NotImplementedError(&quot;This Java ML type cannot be loaded into Python currently: %r&quot;/databricks/spark/python/lib/py4j-0.10.9-src.zip/py4j/java_gateway.py in __call__(self, *args)
   1303         answer = self.gateway_client.send_command(command)
   1304         return_value = get_return_value(
-&amp;gt; 1305             answer, self.gateway_client, self.target_id, self.name)
   1306 
   1307         for temp_arg in temp_args:/databricks/spark/python/pyspark/sql/utils.py in deco(*a, **kw)
    131                 # Hide where the exception came from that shows a non-Pythonic
    132                 # JVM exception message.
--&amp;gt; 133                 raise_from(converted)
    134             else:
    135                 raise/databricks/spark/python/pyspark/sql/utils.py in raise_from(e)
AnalysisException: cannot resolve &apos;`rawCount`&apos; given input columns: [gain, id, impurity, impurityStats, leftChild, prediction, rightChild, split];
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;These pipeline models where saved using Spark 2.4.3, I can load them fine using Spark 2.4.5.&lt;/p&gt;

&lt;p&gt;I tried to investigate further and load each stage separately. Loading the CountVectorizerModel with&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; pyspark.ml.feature &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; CountVectorizerModel
CountVectorizerModel.read().load(&lt;span class=&quot;code-quote&quot;&gt;&quot;/path/to/model/stages/0_CountVectorizer_efce893314a9&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;yields a CountVectorizerModel, but my code fails when trying to load the DecisionTreeClassificationModel:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
DecisionTreeClassificationModel.read().load(&lt;span class=&quot;code-quote&quot;&gt;&quot;/path/to/model/stages/1_DecisionTreeClassifier_4d2a76c565b0&quot;&lt;/span&gt;)
AnalysisException: cannot resolve &lt;span class=&quot;code-quote&quot;&gt;&apos;`rawCount`&apos;&lt;/span&gt; given &lt;span class=&quot;code-object&quot;&gt;input&lt;/span&gt; columns: [gain, &lt;span class=&quot;code-object&quot;&gt;id&lt;/span&gt;, impurity, impurityStats, leftChild, prediction, rightChild, split];
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And here is the content of the &quot;data&quot; of my Decision Tree Classifier:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
spark.read.parquet(&lt;span class=&quot;code-quote&quot;&gt;&quot;/path/to/model/stages/1_DecisionTreeClassifier_4d2a76c565b0/data&quot;&lt;/span&gt;).show()

+---+----------+--------------------+-------------+--------------------+---------+----------+----------------+
| &lt;span class=&quot;code-object&quot;&gt;id&lt;/span&gt;|prediction|            impurity|impurityStats|                gain|leftChild|rightChild|           split|
+---+----------+--------------------+-------------+--------------------+---------+----------+----------------+
|  0|       0.0|  0.3926234384295062| [90.0, 33.0]| 0.16011830963990054|        1|        16|[190, [0.5], -1]|
|  1|       0.0|  0.2672722508516028| [90.0, 17.0]| 0.11434106988303855|        2|        15|[512, [0.5], -1]|
|  2|       0.0|  0.1652892561983472|  [90.0, 9.0]| 0.06959547629404085|        3|        14|[583, [0.5], -1]|
|  3|       0.0| 0.09972299168975082|  [90.0, 5.0]|0.026984966852376356|        4|        11|[480, [0.5], -1]|
|  4|       0.0|0.043933846736523306|  [87.0, 2.0]|0.021717299239076976|        5|        10|[555, [1.5], -1]|
|  5|       0.0|0.022469008264462766|  [87.0, 1.0]|0.011105371900826402|        6|         7|[833, [0.5], -1]|
|  6|       0.0|                 0.0|  [86.0, 0.0]|                -1.0|       -1|        -1|    [-1, [], -1]|
|  7|       0.0|                 0.5|   [1.0, 1.0]|                 0.5|        8|         9|  [0, [0.5], -1]|
|  8|       0.0|                 0.0|   [1.0, 0.0]|                -1.0|       -1|        -1|    [-1, [], -1]|
|  9|       1.0|                 0.0|   [0.0, 1.0]|                -1.0|       -1|        -1|    [-1, [], -1]|
| 10|       1.0|                 0.0|   [0.0, 1.0]|                -1.0|       -1|        -1|    [-1, [], -1]|
| 11|       0.0|                 0.5|   [3.0, 3.0]|                 0.5|       12|        13| [14, [1.5], -1]|
| 12|       0.0|                 0.0|   [3.0, 0.0]|                -1.0|       -1|        -1|    [-1, [], -1]|
| 13|       1.0|                 0.0|   [0.0, 3.0]|                -1.0|       -1|        -1|    [-1, [], -1]|
| 14|       1.0|                 0.0|   [0.0, 4.0]|                -1.0|       -1|        -1|    [-1, [], -1]|
| 15|       1.0|                 0.0|   [0.0, 8.0]|                -1.0|       -1|        -1|    [-1, [], -1]|
| 16|       1.0|                 0.0|  [0.0, 16.0]|                -1.0|       -1|        -1|    [-1, [], -1]|
+---+----------+--------------------+-------------+--------------------+---------+----------+----------------+

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Databricks runtime 7.3 ML&lt;/li&gt;
	&lt;li&gt;Spark 3.0.1&lt;/li&gt;
	&lt;li&gt;Python 3.7&lt;/li&gt;
&lt;/ul&gt;
</environment>
        <key id="13339536">SPARK-33398</key>
            <summary>AnalysisException when loading a PipelineModel with Spark 3</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="podongfeng">Ruifeng Zheng</assignee>
                                    <reporter username="LoicH">LoicH</reporter>
                        <labels>
                            <label>V3</label>
                            <label>decisiontree</label>
                            <label>pyspark</label>
                    </labels>
                <created>Mon, 9 Nov 2020 14:25:10 +0000</created>
                <updated>Thu, 7 Jan 2021 20:19:33 +0000</updated>
                            <resolved>Sun, 3 Jan 2021 17:53:39 +0000</resolved>
                                    <version>3.0.1</version>
                                    <fixVersion>3.0.2</fixVersion>
                    <fixVersion>3.1.0</fixVersion>
                                    <component>MLlib</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17252831" author="nmarcott" created="Mon, 21 Dec 2020 12:39:37 +0000"  >&lt;p&gt;It appears rawCount is a new field added by &lt;a href=&quot;https://github.com/apache/spark/pull/21632/files#diff-0fdae8a6782091746ed20ea43f77b639f9c6a5f072dd2f600fcf9a7b37db4f47&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this PR&lt;/a&gt;&#160;, but there doesn&apos;t seem to be logic to handle the missing column/old data.&lt;/p&gt;

&lt;p&gt;&#160;&lt;ins&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=imatiach&quot; class=&quot;user-hover&quot; rel=&quot;imatiach&quot;&gt;imatiach&lt;/a&gt;&lt;/ins&gt;&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=podongfeng&quot; class=&quot;user-hover&quot; rel=&quot;podongfeng&quot;&gt;podongfeng&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Is there some type of default value or missing column handling that should be added here?&lt;/p&gt;

&lt;p&gt;I do not see a mention of this in the &lt;a href=&quot;https://spark.apache.org/docs/latest/ml-migration-guide.html#upgrading-from-mllib-24-to-30&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ml lib migration guide.&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;I was also able to reproduce this with the following code, saving using v2.4.7 and loading using v3.0.1&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from pyspark.ml &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; Pipeline
from pyspark.ml.classification &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; DecisionTreeClassifier, DecisionTreeClassificationModel
from pyspark.ml.evaluation &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; BinaryClassificationEvaluator
from pyspark.ml.feature &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; HashingTF, Tokenizer
from pyspark.ml.tuning &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; CrossValidator, ParamGridBuilder, TrainValidationSplit
# Prepare training documents from a list of (id, text, label) tuples.
df = spark.createDataFrame([
    (0, &lt;span class=&quot;code-quote&quot;&gt;&quot;a b c d e spark&quot;&lt;/span&gt;, 1.0),
    (1, &lt;span class=&quot;code-quote&quot;&gt;&quot;b d&quot;&lt;/span&gt;, 0.0),
    (2, &lt;span class=&quot;code-quote&quot;&gt;&quot;spark f g h&quot;&lt;/span&gt;, 1.0),
    (3, &lt;span class=&quot;code-quote&quot;&gt;&quot;hadoop mapreduce&quot;&lt;/span&gt;, 0.0)
], [&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;text&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;label&quot;&lt;/span&gt;])
tokenizer = Tokenizer(inputCol=&lt;span class=&quot;code-quote&quot;&gt;&quot;text&quot;&lt;/span&gt;, outputCol=&lt;span class=&quot;code-quote&quot;&gt;&quot;words&quot;&lt;/span&gt;)
hashingTF = HashingTF(inputCol=tokenizer.getOutputCol(), outputCol=&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;, numFeatures=1000)
treeClassifier = DecisionTreeClassifier()
pipeline = Pipeline(stages=[tokenizer, hashingTF])
features = pipeline.fit(df).transform(df)
model = treeClassifier.fit(features)
model.write().overwrite().save(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/dc&quot;&lt;/span&gt;)

#loading code
from pyspark.ml.classification &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; DecisionTreeClassificationModel
DecisionTreeClassificationModel.read().load(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/dc&quot;&lt;/span&gt;)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17253293" author="podongfeng" created="Tue, 22 Dec 2020 05:58:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nmarcott&quot; class=&quot;user-hover&quot; rel=&quot;nmarcott&quot;&gt;nmarcott&lt;/a&gt;&#160; I can reproduce this failure, and will look into it.&lt;/p&gt;</comment>
                            <comment id="17253435" author="podongfeng" created="Tue, 22 Dec 2020 11:47:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nmarcott&quot; class=&quot;user-hover&quot; rel=&quot;nmarcott&quot;&gt;nmarcott&lt;/a&gt;&#160; This issue also exists in RF/GBT, I have just send a [bugfix pr|&lt;a href=&quot;https://github.com/apache/spark/pull/30889&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/30889&lt;/a&gt;]&#160; for this.&#160;&lt;/p&gt;</comment>
                            <comment id="17253441" author="apachespark" created="Tue, 22 Dec 2020 11:54:15 +0000"  >&lt;p&gt;User &apos;zhengruifeng&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/30889&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/30889&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17257827" author="srowen" created="Sun, 3 Jan 2021 17:53:39 +0000"  >&lt;p&gt;Issue resolved by pull request 30889&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/30889&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/30889&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13344267">SPARK-33661</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 45 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0kejs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>