<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:43:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-49836] The outer query is broken when the subquery uses window function which receives time window as parameter</title>
                <link>https://issues.apache.org/jira/browse/SPARK-49836</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;NOTE: The ticket is describing the actual issue after RCA of tests the reporter reported, but I want to still assign the reporter to&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=azera&quot; class=&quot;user-hover&quot; rel=&quot;azera&quot;&gt;azera&lt;/a&gt;, to give the proper credit. Tests are directly pointing to the edge cases and I could easily spot on the root cause based on the simple reproducers. Thanks&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=azera&quot; class=&quot;user-hover&quot; rel=&quot;azera&quot;&gt;azera&lt;/a&gt;&#160;!&lt;/p&gt;

&lt;p&gt;This issue is from Spark 3.4.0+. Culprit issue link: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-40821&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-40821&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is a silly bug and I&apos;m not sure how return works in Scala after figuring out what happened, but here&apos;s my observation.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/blob/c54c017e93090a5fb2edf1b5ef029561b6387a3f/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/analysis/ResolveTimeWindows.scala#L90-L94&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/c54c017e93090a5fb2edf1b5ef029561b6387a3f/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/analysis/ResolveTimeWindows.scala#L90-L94&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This lambda is a partial function - I can&apos;t find the exact behavior definition of calling &quot;return&quot; in the partial function. Looks like calling return does not only complete the execution of current context (here it was Aggregate), but somehow complete the execution in broader context and the above operator is&#160; &quot;lost&quot;.&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=azera&quot; class=&quot;user-hover&quot; rel=&quot;azera&quot;&gt;azera&lt;/a&gt; for the report of the broken test!&lt;/p&gt;

&lt;p&gt;EDIT: It does not look like happening for every case - we have relevant tests in MultiStatefulOperatorsSuite and they have been passing for a while.&lt;/p&gt;

&lt;p&gt;Looks like the issue is coupled with subquery. I don&apos;t understand how the breakage is happening selectively, but that&apos;s what I observed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13593733">SPARK-49836</key>
            <summary>The outer query is broken when the subquery uses window function which receives time window as parameter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kabhwan">Jungtaek Lim</assignee>
                                    <reporter username="azera">Andrzej Zera</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Mon, 30 Sep 2024 12:58:11 +0000</created>
                <updated>Sat, 5 Oct 2024 01:43:32 +0000</updated>
                            <resolved>Sat, 5 Oct 2024 01:43:32 +0000</resolved>
                                    <version>3.4.2</version>
                    <version>3.4.0</version>
                    <version>3.4.1</version>
                    <version>3.5.0</version>
                    <version>3.5.1</version>
                    <version>3.5.2</version>
                    <version>3.4.3</version>
                    <version>3.5.3</version>
                    <version>4.0.0</version>
                                    <fixVersion>3.4.4</fixVersion>
                    <fixVersion>3.5.4</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>SQL</component>
                    <component>Structured Streaming</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17885903" author="kabhwan" created="Mon, 30 Sep 2024 13:37:51 +0000"  >&lt;p&gt;I have a fix but I&apos;m still yet to figure out how breakage is happening selectively. Need to debug further to understand what happens, but if we are OK without the further RCA and just happy with having broken test which is going to be fixed, that&apos;s great.&lt;/p&gt;</comment>
                            <comment id="17887063" author="kabhwan" created="Sat, 5 Oct 2024 01:43:32 +0000"  >&lt;p&gt;Issue resolved via &lt;a href=&quot;https://github.com/apache/spark/pull/48309&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/48309&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 5 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1rp40:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>