<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:07:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-25694] URL.setURLStreamHandlerFactory causing incompatible HttpURLConnection issue</title>
                <link>https://issues.apache.org/jira/browse/SPARK-25694</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;URL.setURLStreamHandlerFactory() in&#160;SharedState causes URL.openConnection() returns&#160;FsUrlConnection object, which is not compatible with&#160;HttpURLConnection. This will cause exception when using some third party http library (e.g. scalaj.http).&lt;/p&gt;

&lt;p&gt;The following code in Spark 2.3.0 introduced the issue: sql/core/src/main/scala/org/apache/spark/sql/internal/SharedState.scala:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
object SharedState &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Logging  { &#160; ... &#160; 
  URL.setURLStreamHandlerFactory(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FsUrlStreamHandlerFactory()) &#160; ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is the example&#160;exception when using scalaj.http in Spark:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 StackTrace: scala.MatchError: org.apache.hadoop.fs.FsUrlConnection:[http:&lt;span class=&quot;code-comment&quot;&gt;//wwww.example.com|http://wwww.example.com/] (of &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.hadoop.fs.FsUrlConnection)
&lt;/span&gt; at scalaj.http.HttpRequest.scalaj$http$HttpRequest$$doConnection(Http.scala:343)
 at scalaj.http.HttpRequest.exec(Http.scala:335)
 at scalaj.http.HttpRequest.asString(Http.scala:455)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; &#160;&lt;br/&gt;
One option to fix the issue is to return null in URLStreamHandlerFactory.createURLStreamHandler when the protocol is http/https, so it will use the default behavior and be compatible with scalaj.http. Following is the code example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SparkUrlStreamHandlerFactory &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; URLStreamHandlerFactory with Logging {

  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; val fsUrlStreamHandlerFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FsUrlStreamHandlerFactory()

  override def createURLStreamHandler(protocol: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;): URLStreamHandler = {
    val handler = fsUrlStreamHandlerFactory.createURLStreamHandler(protocol)
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (handler == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (protocol != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp;
      (protocol.equalsIgnoreCase(&lt;span class=&quot;code-quote&quot;&gt;&quot;http&quot;&lt;/span&gt;)
      || protocol.equalsIgnoreCase(&lt;span class=&quot;code-quote&quot;&gt;&quot;https&quot;&lt;/span&gt;))) {
      &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; to use system &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; URLStreamHandler
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      handler
    }
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I would like to get some discussion here before submitting a pull request.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13190500">SPARK-25694</key>
            <summary>URL.setURLStreamHandlerFactory causing incompatible HttpURLConnection issue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ZhouJIANG">Zhou Jiang</assignee>
                                    <reporter username="boyangwa">Bo Yang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Oct 2018 22:20:15 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:33 +0000</updated>
                            <resolved>Mon, 18 Nov 2019 05:46:21 +0000</resolved>
                                    <version>2.3.0</version>
                    <version>2.3.1</version>
                    <version>2.3.2</version>
                    <version>2.4.4</version>
                    <version>3.0.0</version>
                                    <fixVersion>2.4.6</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>Spark Core</component>
                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16647281" author="gurwls223" created="Fri, 12 Oct 2018 01:42:09 +0000"  >&lt;p&gt;Please avoid to set target versions which are usually reserved for committers.&lt;/p&gt;</comment>
                            <comment id="16648432" author="boyangwa" created="Fri, 12 Oct 2018 20:51:03 +0000"  >&lt;p&gt;Got it, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt; for the suggestion!&lt;/p&gt;</comment>
                            <comment id="16721656" author="howardatwork" created="Fri, 14 Dec 2018 18:14:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=boyangwa&quot; class=&quot;user-hover&quot; rel=&quot;boyangwa&quot;&gt;boyangwa&lt;/a&gt;, do you know of a workaround for this? I&apos;m facing the same issue.&lt;/p&gt;</comment>
                            <comment id="16792230" author="toyboxman" created="Thu, 14 Mar 2019 01:16:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=howardatwork&quot; class=&quot;user-hover&quot; rel=&quot;howardatwork&quot;&gt;howardatwork&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I have hit this problem as well, seems no workaround without change in httpclient.&#160; I ever used scalaj.http, but replaced it httpcomponent&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16965036" author="dongjoon" created="Fri, 1 Nov 2019 19:13:16 +0000"  >&lt;p&gt;Although &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-12868&quot; title=&quot;ADD JAR via sparkSQL JDBC will fail when using a HDFS URL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-12868&quot;&gt;&lt;del&gt;SPARK-12868&lt;/del&gt;&lt;/a&gt; adds `setURLStreamHandlerFactory` for `ADD JARS` commands, this method can be called at most once in a given Java Virtual Machine. So, there is another issue with this.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/net/URL.html#setURLStreamHandlerFactory(java.net.URLStreamHandlerFactory&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/net/URL.html#setURLStreamHandlerFactory(java.net.URLStreamHandlerFactory&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16976298" author="dbtsai" created="Mon, 18 Nov 2019 05:46:21 +0000"  >&lt;p&gt;Issue resolved by pull request 26530&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/26530&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/26530&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17048754" author="holmes.infra" created="Mon, 2 Mar 2020 03:20:29 +0000"  >&lt;p&gt;i have a question than why&#160;FsUrlStreamHandlerFactory will deal with the http schema url. from the code , when protocal is http,method createURLStreamHandler in FsUrlStreamHandlerFactory will return null.&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13082920">HADOOP-14598</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12931808">SPARK-12868</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 37 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3z0h3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311620" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Shepherd</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>felixcheung</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>