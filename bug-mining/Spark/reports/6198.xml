<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:03:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-26315] auto cast threshold from Integer to Float in approxSimilarityJoin of BucketedRandomProjectionLSHModel</title>
                <link>https://issues.apache.org/jira/browse/SPARK-26315</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;when I was using&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// code placeholder
&lt;/span&gt;BucketedRandomProjectionLSHModel.approxSimilarityJoin(dt_features, dt_features, distCol=&lt;span class=&quot;code-quote&quot;&gt;&quot;EuclideanDistance&quot;&lt;/span&gt;, threshold=20.)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I was confused then that this method reported an exception some java method (dataset, dataset, integer, string) fingerprint can not be found.... I think if I give an integer, and the python method of pyspark should be auto-cast this to float if needed.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13203361">SPARK-26315</key>
            <summary>auto cast threshold from Integer to Float in approxSimilarityJoin of BucketedRandomProjectionLSHModel</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cinqsong">Song Ci</assignee>
                                    <reporter username="cinqsong">Song Ci</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Dec 2018 06:02:24 +0000</created>
                <updated>Mon, 17 Dec 2018 07:33:46 +0000</updated>
                            <resolved>Sat, 15 Dec 2018 14:43:46 +0000</resolved>
                                    <version>2.3.2</version>
                                    <fixVersion>2.3.3</fixVersion>
                    <fixVersion>2.4.1</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>MLlib</component>
                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16717873" author="bryanc" created="Tue, 11 Dec 2018 19:45:15 +0000"  >&lt;p&gt;I believe &lt;tt&gt;def approxSimilarityJoin(...)&lt;/tt&gt; in LSHModelf in feature.py, should have &lt;tt&gt;threshold = TypeConverters.toFloat(threshold)&lt;/tt&gt; before the call to &lt;tt&gt;_call_java(...)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;I can help guide if anyone would like to submit a PR for the fix.&lt;/p&gt;</comment>
                            <comment id="16719777" author="jinghe" created="Thu, 13 Dec 2018 05:46:23 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanc&quot; class=&quot;user-hover&quot; rel=&quot;bryanc&quot;&gt;bryanc&lt;/a&gt;&#160; I will try to provide a PR. Thanks!&lt;/p&gt;</comment>
                            <comment id="16720369" author="githubbot" created="Thu, 13 Dec 2018 16:32:46 +0000"  >&lt;p&gt;jerryjch opened a new pull request #23313: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26315&quot; title=&quot;auto cast threshold from Integer to Float in approxSimilarityJoin of BucketedRandomProjectionLSHModel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26315&quot;&gt;&lt;del&gt;SPARK-26315&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;PYSPARk&amp;#93;&lt;/span&gt; auto cast threshold from Integer to Float in approxSimilarityJoin of BucketedRandomProjectionLSHModel&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23313&lt;/a&gt;&lt;/p&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What changes were proposed in this pull request?&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   If the input parameter &apos;threshold&apos; to the function approxSimilarityJoin is not a float, we would get an exception.  The fix is to convert the &apos;threshold&apos; into a float before calling the java implementation method.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;How was this patch tested?&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   Added a new test case.  Without this fix, the test will throw an exception as reported in the JIRA. With the fix, the test passes.&lt;/p&gt;

&lt;p&gt;   Please review &lt;a href=&quot;http://spark.apache.org/contributing.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://spark.apache.org/contributing.html&lt;/a&gt; before opening a pull request.&lt;/p&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16722179" author="srowen" created="Sat, 15 Dec 2018 14:43:46 +0000"  >&lt;p&gt;Issue resolved by pull request 23313&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/23313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23313&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16722180" author="githubbot" created="Sat, 15 Dec 2018 14:44:46 +0000"  >&lt;p&gt;srowen closed pull request #23313: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26315&quot; title=&quot;auto cast threshold from Integer to Float in approxSimilarityJoin of BucketedRandomProjectionLSHModel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26315&quot;&gt;&lt;del&gt;SPARK-26315&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;PYSPARk&amp;#93;&lt;/span&gt; auto cast threshold from Integer to Float in approxSimilarityJoin of BucketedRandomProjectionLSHModel&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23313&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/python/pyspark/ml/feature.py b/python/pyspark/ml/feature.py&lt;br/&gt;
index c9507c20918e3..08ae58246adb6 100755&lt;br/&gt;
&amp;#8212; a/python/pyspark/ml/feature.py&lt;br/&gt;
+++ b/python/pyspark/ml/feature.py&lt;br/&gt;
@@ -192,6 +192,7 @@ def approxSimilarityJoin(self, datasetA, datasetB, threshold, distCol=&quot;distCol&quot;)&lt;br/&gt;
                  &quot;datasetA&quot; and &quot;datasetB&quot;, and a column &quot;distCol&quot; is added to show the distance&lt;br/&gt;
                  between each pair.&lt;br/&gt;
         &quot;&quot;&quot;&lt;br/&gt;
+        threshold = TypeConverters.toFloat(threshold)&lt;br/&gt;
         return self._call_java(&quot;approxSimilarityJoin&quot;, datasetA, datasetB, threshold, distCol)&lt;/p&gt;


&lt;p&gt;@@ -239,6 +240,16 @@ class BucketedRandomProjectionLSH(JavaEstimator, LSHParams, HasInputCol, HasOutp&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  3&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  6&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 2.23606797749979&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;     &lt;ins&gt;--&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-&lt;del&gt;&lt;ins&gt;&lt;/del&gt;----------------&lt;/ins&gt;&lt;br/&gt;
     ...&lt;br/&gt;
+    &amp;gt;&amp;gt;&amp;gt; model.approxSimilarityJoin(df, df2, 3, distCol=&quot;EuclideanDistance&quot;).select(&lt;br/&gt;
+    ...     col(&quot;datasetA.id&quot;).alias(&quot;idA&quot;),&lt;br/&gt;
+    ...     col(&quot;datasetB.id&quot;).alias(&quot;idB&quot;),&lt;br/&gt;
+    ...     col(&quot;EuclideanDistance&quot;)).show()&lt;br/&gt;
+    &lt;ins&gt;--&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-&lt;del&gt;&lt;ins&gt;&lt;/del&gt;----------------&lt;/ins&gt;&lt;br/&gt;
+    |idA|idB|EuclideanDistance|&lt;br/&gt;
+    &lt;ins&gt;--&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-&lt;del&gt;&lt;ins&gt;&lt;/del&gt;----------------&lt;/ins&gt;&lt;br/&gt;
+    |  3|  6| 2.23606797749979|&lt;br/&gt;
+    &lt;ins&gt;--&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-&lt;del&gt;&lt;ins&gt;&lt;/del&gt;----------------&lt;/ins&gt;&lt;br/&gt;
+    ...&lt;br/&gt;
     &amp;gt;&amp;gt;&amp;gt; brpPath = temp_path + &quot;/brp&quot;&lt;br/&gt;
     &amp;gt;&amp;gt;&amp;gt; brp.save(brpPath)&lt;br/&gt;
     &amp;gt;&amp;gt;&amp;gt; brp2 = BucketedRandomProjectionLSH.load(brpPath)&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 48 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s01c5c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>