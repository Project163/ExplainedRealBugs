<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:33:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-11066] Flaky test o.a.scheduler.DAGSchedulerSuite.misbehavedResultHandler occasionally fails due to j.l.UnsupportedOperationException concerning a finished JobWaiter</title>
                <link>https://issues.apache.org/jira/browse/SPARK-11066</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The DAGSchedulerSuite test for the &quot;misbehaved ResultHandler&quot; has an inherent problem: it creates a job for the DAGScheduler comprising multiple (2) tasks, but whilst the job will fail and a SparkDriverExecutionException will be returned, a race condition exists as to whether the first task&apos;s (deliberately) thrown exception causes the job to fail - and having its causing exception set to the DAGSchedulerSuiteDummyException that was thrown as the setup of the misbehaving test - or second (and subsequent) tasks who equally end, but have instead the DAGScheduler&apos;s legitimate UnsupportedOperationException (a subclass of RuntimeException) returned instead as their causing exception.  This race condition is likely associated with the vagaries of processing quanta, and expense of throwing two exceptions (under interpreter execution) per thread of control; this race is usually &apos;won&apos; by the first task throwing the DAGSchedulerDummyException, as desired (and expected)... but not always.&lt;/p&gt;

&lt;p&gt;The problem for the testcase is that the first assertion is largely concerning the test setup, and doesn&apos;t (can&apos;t? Sorry, still not a ScalaTest expert) capture all the causes of SparkDriverExecutionException that can legitimately arise from a correctly working (not crashed) DAGScheduler.  Arguably, this assertion might test something of the DAGScheduler... but not all the possible outcomes for a working DAGScheduler.  Nevertheless, this test - when comprising a multiple task job - will report as a failure when in fact the DAGScheduler is working-as-designed (and not crashed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.  Furthermore, the test is already failed before it actually tries to use the SparkContext a second time (for an arbitrary processing task), which I think is the real subject of the test?&lt;/p&gt;

&lt;p&gt;The solution, I submit, is to ensure that the job is composed of just one task, and that single task will result in the call to the compromised ResultHandler causing the test&apos;s deliberate exception to be thrown and exercising the relevant (DAGScheduler) code paths.  Given tasks are scoped by the number of partitions of an RDD, this could be achieved with a single partitioned RDD (indeed, doing so seems to exercise/would test some default parallelism support of the TaskScheduler?); the pull request offered, however, is based on the minimal change of just using a single partition of the 2 (or more) partition parallelized RDD.  This will result in scheduling a job of just one task, one successful task calling the user-supplied compromised ResultHandler function, which results in failing the job and unambiguously wrapping our DAGSchedulerSuiteException inside a SparkDriverExecutionException; there are no other tasks that on running successfully will find the job failed causing the &apos;undesired&apos; UnsupportedOperationException to be thrown instead.  This, then, satisfies the test&apos;s setup assertion.&lt;/p&gt;

&lt;p&gt;I have tested this hypothesis having parametised the number of partitions, N, used by the &quot;misbehaved ResultHandler&quot; job and have observed the 1 x DAGSchedulerSuiteException first, followed by the legitimate N-1 x UnsupportedOperationExceptions ... what propagates back from the job seems to simply become the result of the race between task threads and the intermittent failures observed.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Multiple OS and platform types.&lt;br/&gt;
(Also observed by others, e.g. see External URL)&lt;/p&gt;</environment>
        <key id="12904216">SPARK-11066</key>
            <summary>Flaky test o.a.scheduler.DAGSchedulerSuite.misbehavedResultHandler occasionally fails due to j.l.UnsupportedOperationException concerning a finished JobWaiter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shellberg">Dr Stephen A Hellberg</assignee>
                                    <reporter username="shellberg">Dr Stephen A Hellberg</reporter>
                        <labels>
                    </labels>
                <created>Mon, 12 Oct 2015 15:39:04 +0000</created>
                <updated>Thu, 15 Oct 2015 17:08:28 +0000</updated>
                            <resolved>Thu, 15 Oct 2015 17:07:33 +0000</resolved>
                                    <version>1.4.0</version>
                    <version>1.4.1</version>
                    <version>1.5.0</version>
                    <version>1.5.1</version>
                                    <fixVersion>1.5.2</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>Scheduler</component>
                    <component>Spark Core</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14953241" author="apachespark" created="Mon, 12 Oct 2015 16:00:02 +0000"  >&lt;p&gt;User &apos;shellberg&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9076&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9076&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14953347" author="srowen" created="Mon, 12 Oct 2015 16:51:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shellberg&quot; class=&quot;user-hover&quot; rel=&quot;shellberg&quot;&gt;shellberg&lt;/a&gt; don&apos;t set Fix Version (it&apos;s not fixed); Target version is for committers as well.&lt;/p&gt;</comment>
                            <comment id="14954736" author="shellberg" created="Tue, 13 Oct 2015 10:02:23 +0000"  >&lt;p&gt;Sean : apologies, re: Fix Version and Target Version.  I was led astray in interpreting their purpose given they were present on the Create issue template.&lt;br/&gt;
Fix Version makes complete sense: until the fix is integrated its not fixed; Target version... I&apos;d interpreted that as where I&apos;d hope to see the fix released/is suitable for being applied.  I know this issue arises in the 1.4.x release (and probably before) but I&apos;m mostly interested in seeing this addressed in current/future releases; my fix is likely sufficient in prior releases equally, so what criteria is used to suggest how far back a committer would backport into prior releases (given only Affects Versions)?&lt;/p&gt;</comment>
                            <comment id="14954757" author="srowen" created="Tue, 13 Oct 2015 10:17:54 +0000"  >&lt;p&gt;Yes, the problem is anyone who submits a JIRA presumably wants to see it addressed and soon. Few are actually actionable, valid, and something that the submitter follows through on. Hence Target Version ought to be set only by someone who is willing and able to drive to a resolution. Then the view of JIRAs targeted at a release is a somewhat reliable picture of what could happen in that release. It&apos;s still used unevenly but that&apos;s the reason.&lt;/p&gt;

&lt;p&gt;If it&apos;s likely to be resolved rapidly like this one I usually don&apos;t even bother, but, it&apos;d be valid to target at 1.6 / 1.5.2 after seeing it&apos;s probably a fine change that passes tests, etc (still some style failures)&lt;/p&gt;</comment>
                            <comment id="14955085" author="shellberg" created="Tue, 13 Oct 2015 15:03:32 +0000"  >&lt;p&gt;Thanks for the clarification Sean.  And, I&apos;ve given my patches&apos; comments a bit of a haircut... Sorry, I probably err on verbosity.&lt;br/&gt;
(Ahem, some would likely consider that a stylistic failure &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ).&lt;/p&gt;

&lt;p&gt;I&apos;ve also had a go at getting to grips with  the dev/lint-scala tool applied to the codebase with my proposed (revised) patch, which passes now.&lt;/p&gt;</comment>
                            <comment id="14955337" author="shellberg" created="Tue, 13 Oct 2015 17:41:31 +0000"  >&lt;p&gt;Added some indentation to those comments for alignment... hopefully in-line with SPARK practice!&lt;/p&gt;</comment>
                            <comment id="14959235" author="srowen" created="Thu, 15 Oct 2015 17:07:33 +0000"  >&lt;p&gt;Issue resolved by pull request 9076&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9076&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9076&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="12903039">SPARK-10976</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311024" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>External issue ID</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/spark-dev/201508.mbox/%3CCAMAsSdJbkQE+&quot;&gt;http://mail-archives.apache.org/mod_mbox/spark-dev/201508.mbox/%3CCAMAsSdJbkQE+&lt;/a&gt;&lt;a href=&apos;mailto:g6HEAM_1J2j2DCPWNXBucUVPRBVZnJj2n1gg6Q@mail.gmail.com&apos;&gt;g6HEAM_1J2j2DCPWNXBucUVPRBVZnJj2n1gg6Q@mail.gmail.com&lt;/a&gt;%3E</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mw6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>