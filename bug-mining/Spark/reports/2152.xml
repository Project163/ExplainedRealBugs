<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:29:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-8636] CaseKeyWhen has incorrect NULL handling</title>
                <link>https://issues.apache.org/jira/browse/SPARK-8636</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;CaseKeyWhen implementation in Spark uses the following equals implementation:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; def equalNullSafe(l: Any, r: Any) = {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (l == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; r == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (l == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || r == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      l == r
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which is not correct, since in SQL, NULL is never equal to NULL (actually, it is not unequal either). In this case, a NULL value in a CASE WHEN expression should never match.&lt;/p&gt;

&lt;p&gt;For example, you can execute this in MySQL:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SELECT CASE NULL WHEN NULL THEN &lt;span class=&quot;code-quote&quot;&gt;&quot;NULL MATCHES&quot;&lt;/span&gt; ELSE &lt;span class=&quot;code-quote&quot;&gt;&quot;NULL DOES NOT MATCH&quot;&lt;/span&gt; END FROM DUAL;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the result will be &quot;NULL DOES NOT MATCH&quot;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12840582">SPARK-8636</key>
            <summary>CaseKeyWhen has incorrect NULL handling</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vinodkc">Vinod KC</assignee>
                                    <reporter username="smolav">Santiago M. Mola</reporter>
                        <labels>
                            <label>starter</label>
                    </labels>
                <created>Thu, 25 Jun 2015 16:09:51 +0000</created>
                <updated>Mon, 13 Jul 2015 19:52:16 +0000</updated>
                            <resolved>Mon, 13 Jul 2015 19:52:16 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14602411" author="animeshbaranawal" created="Fri, 26 Jun 2015 05:13:00 +0000"  >&lt;p&gt;So the condition should be :&lt;br/&gt;
if (l == null || r == null) false&lt;br/&gt;
else l == r ?&lt;/p&gt;</comment>
                            <comment id="14602520" author="smolav" created="Fri, 26 Jun 2015 07:40:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=animeshbaranawal&quot; class=&quot;user-hover&quot; rel=&quot;animeshbaranawal&quot;&gt;animeshbaranawal&lt;/a&gt; Yes, I think so.&lt;/p&gt;</comment>
                            <comment id="14602715" author="apachespark" created="Fri, 26 Jun 2015 11:20:21 +0000"  >&lt;p&gt;User &apos;vinodkc&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7040&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7040&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14602767" author="apachespark" created="Fri, 26 Jun 2015 12:01:04 +0000"  >&lt;p&gt;User &apos;animeshbaranawal&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7044&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7044&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14604724" author="davies" created="Sun, 28 Jun 2015 15:19:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=animeshbaranawal&quot; class=&quot;user-hover&quot; rel=&quot;animeshbaranawal&quot;&gt;animeshbaranawal&lt;/a&gt; What happen if there is null in the grouping key? Does a row with null equal to another row with null?&lt;/p&gt;</comment>
                            <comment id="14605112" author="animeshbaranawal" created="Mon, 29 Jun 2015 04:49:13 +0000"  >&lt;p&gt;No a row with null will not be equal to another row with null if we follow the modification. What do you say &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smolav&quot; class=&quot;user-hover&quot; rel=&quot;smolav&quot;&gt;smolav&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="14605557" author="smolav" created="Mon, 29 Jun 2015 12:48:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davies&quot; class=&quot;user-hover&quot; rel=&quot;davies&quot;&gt;davies&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=animeshbaranawal&quot; class=&quot;user-hover&quot; rel=&quot;animeshbaranawal&quot;&gt;animeshbaranawal&lt;/a&gt; In SQL, NULL is never equal to NULL. Any comparison to NULL is UNKNOWN. Most SQL implementations represent UNKNOWN as NULL, too.&lt;/p&gt;</comment>
                            <comment id="14613492" author="apachespark" created="Fri, 3 Jul 2015 22:43:04 +0000"  >&lt;p&gt;User &apos;animeshbaranawal&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7044&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7044&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14614080" author="davies" created="Sat, 4 Jul 2015 22:40:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smolav&quot; class=&quot;user-hover&quot; rel=&quot;smolav&quot;&gt;smolav&lt;/a&gt; I&apos;m just curious that how can we sort of group by a row with NULL in it, If we can not compare NULL with NULL?&lt;/p&gt;</comment>
                            <comment id="14614627" author="smolav" created="Mon, 6 Jul 2015 07:00:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davies&quot; class=&quot;user-hover&quot; rel=&quot;davies&quot;&gt;davies&lt;/a&gt; NULL values are grouped together when using a GROUP BY clause.&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://en.wikipedia.org/wiki/Null_%28SQL%29#When_two_nulls_are_equal:_grouping.2C_sorting.2C_and_some_set_operations&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://en.wikipedia.org/wiki/Null_%28SQL%29#When_two_nulls_are_equal:_grouping.2C_sorting.2C_and_some_set_operations&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Because SQL:2003 defines all Null markers as being unequal to one another, a special definition was required in order to group Nulls together when performing certain operations. SQL defines &quot;any two values that are equal to one another, or any two Nulls&quot;, as &quot;not distinct&quot;. This definition of not distinct allows SQL to group and sort Nulls when the GROUP BY clause (and other keywords that perform grouping) are used.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="14625225" author="marmbrus" created="Mon, 13 Jul 2015 19:52:16 +0000"  >&lt;p&gt;Issue resolved by pull request 7040&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7040&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7040&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12746117">SPARK-3813</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 19 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ghyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311620" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Shepherd</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marmbrus</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332078">1.5.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>