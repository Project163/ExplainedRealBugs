<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:49:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-18510] Partition schema inference corrupts data</title>
                <link>https://issues.apache.org/jira/browse/SPARK-18510</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Not sure if this is a regression from 2.0 to 2.1. I was investigating this for Structured Streaming, but it seems it affects batch data as well.&lt;/p&gt;

&lt;p&gt;Here&apos;s the issue:&lt;br/&gt;
If I specify my schema when doing&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;spark.read
  .schema(someSchemaWherePartitionColumnsAreStrings)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but if the partition inference can infer it as IntegerType or I assume LongType or DoubleType (basically fixed size types), then once UnsafeRows are generated, your data will be corrupted.&lt;/p&gt;

&lt;p&gt;Reproduction:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;val createArray = udf { (length: &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;) =&amp;gt;
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (i &amp;lt;- 1 to length.toInt) yield i.toString
}
spark.range(10).select(createArray(&lt;span class=&quot;code-quote&quot;&gt;&apos;id + 1) as &apos;&lt;/span&gt;ex, &lt;span class=&quot;code-quote&quot;&gt;&apos;id, &apos;&lt;/span&gt;id % 4 as &apos;part).coalesce(1).write
        .partitionBy(&lt;span class=&quot;code-quote&quot;&gt;&quot;part&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;)
        .mode(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;)
        .parquet(src.toString)
val schema = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StructType()
        .add(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;, StringType)
        .add(&lt;span class=&quot;code-quote&quot;&gt;&quot;part&quot;&lt;/span&gt;, IntegerType)
        .add(&lt;span class=&quot;code-quote&quot;&gt;&quot;ex&quot;&lt;/span&gt;, ArrayType(StringType))
spark.read
      .schema(schema)
      .format(&lt;span class=&quot;code-quote&quot;&gt;&quot;parquet&quot;&lt;/span&gt;)
      .load(src.toString)
      .show()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The UDF is useful for creating a row long enough so that you don&apos;t hit other weird NullPointerExceptions caused for the same reason I believe.&lt;br/&gt;
Output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+---------+----+--------------------+
|       id|part|                  ex|
+---------+----+--------------------+
|&#65533;|   1|[1, 2, 3, 4, 5, 6...|
| |   0|[1, 2, 3, 4, 5, 6...|
|  |   3|[1, 2, 3, 4, 5, 6...|
|   |   2|[1, 2, 3, 4, 5, 6...|
|    |   1|  [1, 2, 3, 4, 5, 6]|
|     |   0|     [1, 2, 3, 4, 5]|
|      |   3|        [1, 2, 3, 4]|
|       |   2|           [1, 2, 3]|
|        |   1|              [1, 2]|
|         |   0|                 [1]|
+---------+----+--------------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I was hoping to fix the issue as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-18407&quot; title=&quot;Inferred partition columns cause assertion error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-18407&quot;&gt;&lt;del&gt;SPARK-18407&lt;/del&gt;&lt;/a&gt; but it seems it&apos;s not only applicable to StructuredStreaming and deserves it&apos;s own JIRA.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13021974">SPARK-18510</key>
            <summary>Partition schema inference corrupts data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brkyvz">Burak Yavuz</assignee>
                                    <reporter username="brkyvz">Burak Yavuz</reporter>
                        <labels>
                    </labels>
                <created>Sun, 20 Nov 2016 03:12:45 +0000</created>
                <updated>Mon, 28 Nov 2016 10:09:51 +0000</updated>
                            <resolved>Wed, 23 Nov 2016 19:51:33 +0000</resolved>
                                    <version>2.1.0</version>
                                    <fixVersion>2.1.0</fixVersion>
                                    <component>SQL</component>
                    <component>Structured Streaming</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15680328" author="brkyvz" created="Sun, 20 Nov 2016 03:15:16 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rxin%40databricks.com&quot; class=&quot;user-hover&quot; rel=&quot;rxin@databricks.com&quot;&gt;rxin@databricks.com&lt;/a&gt; I marked this as a blocker as it is pretty nasty. Feel free to downgrade if you don&apos;t think so, or feel like the semantics of what I&apos;m doing is wrong.&lt;/p&gt;</comment>
                            <comment id="15680487" author="rxin" created="Sun, 20 Nov 2016 05:40:34 +0000"  >&lt;p&gt;Does your pull request for &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-18407&quot; title=&quot;Inferred partition columns cause assertion error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-18407&quot;&gt;&lt;del&gt;SPARK-18407&lt;/del&gt;&lt;/a&gt; fix this one as well?&lt;/p&gt;</comment>
                            <comment id="15681677" author="brkyvz" created="Sun, 20 Nov 2016 19:10:35 +0000"  >&lt;p&gt;No. Working on a separate fix&lt;/p&gt;</comment>
                            <comment id="15681953" author="apachespark" created="Sun, 20 Nov 2016 22:36:05 +0000"  >&lt;p&gt;User &apos;brkyvz&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15951&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15951&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15691458" author="apachespark" created="Wed, 23 Nov 2016 21:54:05 +0000"  >&lt;p&gt;User &apos;zsxwing&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15997&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15997&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="13019954">SPARK-18407</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 51 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36jjj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12335644">2.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>