<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:01:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-25144] distinct on Dataset leads to exception due to Managed memory leak detected  </title>
                <link>https://issues.apache.org/jira/browse/SPARK-25144</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The following code example:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo(bar: Option[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;])
val ds = List(Foo(Some(&lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;))).toDS
val result = ds.flatMap(_.bar).distinct
result.rdd.isEmpty
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Produces the following stacktrace&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[info]   org.apache.spark.SparkException: Job aborted due to stage failure: Task 42 in stage 7.0 failed 1 times, most recent failure: Lost task 42.0 in stage 7.0 (TID 125, localhost, executor driver): org.apache.spark.SparkException: Managed memory leak detected; size = 16777216 bytes, TID = 125
[info] 	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:358)
[info] 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
[info] 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
[info] 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
[info] 
[info] Driver stacktrace:
[info]   at org.apache.spark.scheduler.DAGScheduler.org$apache$spark$scheduler$DAGScheduler$$failJobAndIndependentStages(DAGScheduler.scala:1602)
[info]   at org.apache.spark.scheduler.DAGScheduler$$anonfun$abortStage$1.apply(DAGScheduler.scala:1590)
[info]   at org.apache.spark.scheduler.DAGScheduler$$anonfun$abortStage$1.apply(DAGScheduler.scala:1589)
[info]   at scala.collection.mutable.ResizableArray$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(ResizableArray.scala:59)
[info]   at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:48)
[info]   at org.apache.spark.scheduler.DAGScheduler.abortStage(DAGScheduler.scala:1589)
[info]   at org.apache.spark.scheduler.DAGScheduler$$anonfun$handleTaskSetFailed$1.apply(DAGScheduler.scala:831)
[info]   at org.apache.spark.scheduler.DAGScheduler$$anonfun$handleTaskSetFailed$1.apply(DAGScheduler.scala:831)
[info]   at scala.Option.foreach(Option.scala:257)
[info]   at org.apache.spark.scheduler.DAGScheduler.handleTaskSetFailed(DAGScheduler.scala:831)
[info]   at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.doOnReceive(DAGScheduler.scala:1823)
[info]   at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:1772)
[info]   at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:1761)
[info]   at org.apache.spark.util.EventLoop$$anon$1.run(EventLoop.scala:48)
[info]   at org.apache.spark.scheduler.DAGScheduler.runJob(DAGScheduler.scala:642)
[info]   at org.apache.spark.SparkContext.runJob(SparkContext.scala:2034)
[info]   at org.apache.spark.SparkContext.runJob(SparkContext.scala:2055)
[info]   at org.apache.spark.SparkContext.runJob(SparkContext.scala:2074)
[info]   at org.apache.spark.rdd.RDD$$anonfun$take$1.apply(RDD.scala:1358)
[info]   at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:151)
[info]   at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:112)
[info]   at org.apache.spark.rdd.RDD.withScope(RDD.scala:363)
[info]   at org.apache.spark.rdd.RDD.take(RDD.scala:1331)
[info]   at org.apache.spark.rdd.RDD$$anonfun$isEmpty$1.apply$mcZ$sp(RDD.scala:1466)
[info]   at org.apache.spark.rdd.RDD$$anonfun$isEmpty$1.apply(RDD.scala:1466)
[info]   at org.apache.spark.rdd.RDD$$anonfun$isEmpty$1.apply(RDD.scala:1466)
[info]   at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:151)
[info]   at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:112)
[info]   at org.apache.spark.rdd.RDD.withScope(RDD.scala:363)
[info]   at org.apache.spark.rdd.RDD.isEmpty(RDD.scala:1465)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The code example doesn&apos;t produce any error when `distinct` function is not called.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13179576">SPARK-25144</key>
            <summary>distinct on Dataset leads to exception due to Managed memory leak detected  </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dongjoon">Dongjoon Hyun</assignee>
                                    <reporter username="Ayoub">Ayoub Benali</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Aug 2018 12:47:53 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:42 +0000</updated>
                            <resolved>Tue, 21 Aug 2018 01:09:13 +0000</resolved>
                                    <version>2.0.2</version>
                    <version>2.1.3</version>
                    <version>2.2.2</version>
                    <version>2.3.1</version>
                    <version>2.3.2</version>
                                    <fixVersion>2.2.3</fixVersion>
                    <fixVersion>2.3.2</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16583966" author="viirya" created="Fri, 17 Aug 2018 14:00:34 +0000"  >&lt;p&gt;Hmm, can&apos;t reproduce this on master branch, so it is specific to 2.3.1?&lt;/p&gt;</comment>
                            <comment id="16583990" author="ayoub" created="Fri, 17 Aug 2018 14:17:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt; the same happens with spark 2.2.1 I assume that it was there since some time.&lt;br/&gt;
Maybe you have&#160;&quot;spark.unsafe.exceptionOnMemoryLeak&quot; set to false which produces a warning instead of throwing an exception&#160;&lt;/p&gt;</comment>
                            <comment id="16584021" author="ayoub" created="Fri, 17 Aug 2018 14:46:29 +0000"  >&lt;p&gt;Somehow adding cache before calling &quot;isEmpty&quot; avoids the problem :/&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo(bar: Option[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;])
val ds = List(Foo(Some(&lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;))).toDS
val result = ds.flatMap(_.bar).distinct
result.cache
result.rdd.isEmpty

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16584037" author="viirya" created="Fri, 17 Aug 2018 14:55:39 +0000"  >&lt;p&gt;Have you tried on master branch? Tried with &lt;tt&gt;spark.unsafe.exceptionOnMemoryLeak&lt;/tt&gt; as true, but can&apos;t reproduce it. I guess it is fixed in master branch?&lt;/p&gt;</comment>
                            <comment id="16584042" author="ayoub" created="Fri, 17 Aug 2018 14:58:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt; I haven&apos;t tried on master branch, is there any snapshot jar somewhere ?&lt;/p&gt;</comment>
                            <comment id="16584075" author="viirya" created="Fri, 17 Aug 2018 15:31:20 +0000"  >&lt;p&gt;I&apos;m not sure if there is, can you build it?&lt;/p&gt;</comment>
                            <comment id="16585373" author="gurwls223" created="Mon, 20 Aug 2018 03:13:31 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo(bar: Option[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;])
defined &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo

scala&amp;gt; val ds = List(Foo(Some(&lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;))).toDS
ds: org.apache.spark.sql.Dataset[Foo] = [bar: string]

scala&amp;gt; val result = ds.flatMap(_.bar).distinct
result: org.apache.spark.sql.Dataset[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;] = [value: string]

scala&amp;gt; result.rdd.isEmpty
res0: &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt; = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I tried in the master. i am unable to reproduce this. Resolving this. It would be nicer if we identify and see if we can backport. Please link this to the duplicate if it&apos;s identified.&lt;/p&gt;</comment>
                            <comment id="16585468" author="dongjoon" created="Mon, 20 Aug 2018 06:15:41 +0000"  >&lt;p&gt;I&apos;ll reopen this since I can reproduce this in 2.1.3, 2.2.2, 2.3.2-RC5. I found the difference in master. I&apos;ll make a PR soon.&lt;/p&gt;</comment>
                            <comment id="16585472" author="apachespark" created="Mon, 20 Aug 2018 06:26:05 +0000"  >&lt;p&gt;User &apos;dongjoon-hyun&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22150&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22150&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16585481" author="dongjoon" created="Mon, 20 Aug 2018 06:38:43 +0000"  >&lt;p&gt;Ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt; since you are a release engineer.&lt;/p&gt;</comment>
                            <comment id="16585482" author="jerryshao" created="Mon, 20 Aug 2018 06:41:18 +0000"  >&lt;p&gt;Does this exist in master branch?&lt;/p&gt;</comment>
                            <comment id="16585554" author="ayoub" created="Mon, 20 Aug 2018 07:43:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt; according the comments&#160;above&#160;this bug doesn&apos;t happen in Master but I haven&apos;t tried my self&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;thanks for the PR &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dongjoon&quot; class=&quot;user-hover&quot; rel=&quot;dongjoon&quot;&gt;dongjoon&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16586138" author="apachespark" created="Mon, 20 Aug 2018 15:59:05 +0000"  >&lt;p&gt;User &apos;dongjoon-hyun&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22155&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22155&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16586168" author="apachespark" created="Mon, 20 Aug 2018 16:20:05 +0000"  >&lt;p&gt;User &apos;dongjoon-hyun&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22156&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3x5kf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12343560">2.2.3</customfieldvalue>
    <customfieldvalue id="12343289">2.3.2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>