<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:33:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-43298] predict_batch_udf with scalar input fails when batch size consists of a single value</title>
                <link>https://issues.apache.org/jira/browse/SPARK-43298</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;This is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-42250&quot; title=&quot;predict_batch_udf with float fails when the batch size consists of single value&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-42250&quot;&gt;&lt;del&gt;SPARK-42250&lt;/del&gt;&lt;/a&gt;.&#160; For scalar inputs, the predict_batch_udf will fail if the batch size is 1:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; numpy as np
from pyspark.ml.functions &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; predict_batch_udf
from pyspark.sql.types &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; DoubleType

df = spark.createDataFrame([[1.0],[2.0]], schema=[&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;])

def make_predict_fn():
&#160; &#160; def predict(inputs):
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; inputs
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; predict

identity = predict_batch_udf(make_predict_fn, return_type=DoubleType(), batch_size=1)
preds = df.withColumn(&lt;span class=&quot;code-quote&quot;&gt;&quot;preds&quot;&lt;/span&gt;, identity(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;)).collect()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;fails with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/.../spark/python/pyspark/worker.py&quot;&lt;/span&gt;, line 869, in main
    process()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/.../spark/python/pyspark/worker.py&quot;&lt;/span&gt;, line 861, in process
    serializer.dump_stream(out_iter, outfile)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/.../spark/python/pyspark/sql/pandas/serializers.py&quot;&lt;/span&gt;, line 354, in dump_stream
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ArrowStreamSerializer.dump_stream(self, init_stream_yield_batches(), stream)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/.../spark/python/pyspark/sql/pandas/serializers.py&quot;&lt;/span&gt;, line 86, in dump_stream
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; batch in iterator:
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/.../spark/python/pyspark/sql/pandas/serializers.py&quot;&lt;/span&gt;, line 347, in init_stream_yield_batches
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; series in iterator:
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/.../spark/python/pyspark/worker.py&quot;&lt;/span&gt;, line 555, in func
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; result_batch, result_type in result_iter:
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/.../spark/python/pyspark/ml/functions.py&quot;&lt;/span&gt;, line 818, in predict
    yield _validate_and_transform_prediction_result(
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/.../spark/python/pyspark/ml/functions.py&quot;&lt;/span&gt;, line 339, in _validate_and_transform_prediction_result
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; len(preds_array) != num_input_rows:
TypeError: len() of unsized object
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13534218">SPARK-43298</key>
            <summary>predict_batch_udf with scalar input fails when batch size consists of a single value</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="leewyang">Lee Yang</assignee>
                                    <reporter username="leewyang">Lee Yang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Apr 2023 20:31:31 +0000</created>
                <updated>Thu, 27 Apr 2023 18:51:23 +0000</updated>
                            <resolved>Thu, 27 Apr 2023 18:51:23 +0000</resolved>
                                    <version>3.4.0</version>
                                    <fixVersion>3.5.0</fixVersion>
                                    <component>ML</component>
                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17716962" author="snoot" created="Thu, 27 Apr 2023 03:31:58 +0000"  >&lt;p&gt;User &apos;leewyang&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/40967&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/40967&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17717343" author="gurwls223" created="Thu, 27 Apr 2023 18:51:23 +0000"  >&lt;p&gt;Issue resolved by pull request 40967&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/40967&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/40967&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 28 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1hk48:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>