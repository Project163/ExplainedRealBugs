<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:04:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-26865] DataSourceV2Strategy should push normalized filters</title>
                <link>https://issues.apache.org/jira/browse/SPARK-26865</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Although we designed `SupportsPushDownFilters` in the same way by using `Filter`. DSv1 and DSv2 passes different filters.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  /**
   * Pushes down filters, and returns filters that need to be evaluated after scanning.
   */
  Filter[] pushFilters(Filter[] filters);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Specifically, DSv2 doesn&apos;t guarantee that filter expressions match the underlying schema in terms of case-sensitivity.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
buildReaderWithPartitionValues(..., filters: Seq[Filter], ...)
- IsNotNull(ID)

DataSourceV2Strategy.pushFilters
- IsNotNull(id)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;steps to reproduce:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
spark.range(10).write.orc(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/o1&quot;&lt;/span&gt;)
spark.read.schema(&lt;span class=&quot;code-quote&quot;&gt;&quot;ID &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;&quot;&lt;/span&gt;).orc(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/o1&quot;&lt;/span&gt;).filter(&lt;span class=&quot;code-quote&quot;&gt;&quot;id &amp;gt; 5&quot;&lt;/span&gt;).show

java.util.NoSuchElementException: key not found: id
  at scala.collection.immutable.Map$Map1.apply(Map.scala:114)
  at org.apache.spark.sql.execution.datasources.orc.OrcFilters$.createBuilder(OrcFilters.scala:263)
  at org.apache.spark.sql.execution.datasources.orc.OrcFilters$.buildSearchArgument(OrcFilters.scala:153)
  at org.apache.spark.sql.execution.datasources.orc.OrcFilters$.$anonfun$convertibleFilters$1(OrcFilters.scala:99)
  at scala.collection.TraversableLike.$anonfun$flatMap$1(TraversableLike.scala:244)
  at scala.collection.IndexedSeqOptimized.foreach(IndexedSeqOptimized.scala:36)
  at scala.collection.IndexedSeqOptimized.foreach$(IndexedSeqOptimized.scala:33)
  at scala.collection.mutable.WrappedArray.foreach(WrappedArray.scala:39)
  at scala.collection.TraversableLike.flatMap(TraversableLike.scala:244)
  at scala.collection.TraversableLike.flatMap$(TraversableLike.scala:241)
  at scala.collection.AbstractTraversable.flatMap(Traversable.scala:108)
  at org.apache.spark.sql.execution.datasources.orc.OrcFilters$.convertibleFilters(OrcFilters.scala:98)
  at org.apache.spark.sql.execution.datasources.orc.OrcFilters$.createFilter(OrcFilters.scala:87)
  at org.apache.spark.sql.execution.datasources.v2.orc.OrcScanBuilder.pushFilters(OrcScanBuilder.scala:50)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13215381">SPARK-26865</key>
            <summary>DataSourceV2Strategy should push normalized filters</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dongjoon">Dongjoon Hyun</assignee>
                                    <reporter username="cloud_fan">Wenchen Fan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Feb 2019 03:03:46 +0000</created>
                <updated>Thu, 14 Feb 2019 00:08:06 +0000</updated>
                            <resolved>Thu, 14 Feb 2019 00:06:25 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16766717" author="cloud_fan" created="Wed, 13 Feb 2019 03:04:33 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dongjoon&quot; class=&quot;user-hover&quot; rel=&quot;dongjoon&quot;&gt;dongjoon&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Gengliang.Wang&quot; class=&quot;user-hover&quot; rel=&quot;Gengliang.Wang&quot;&gt;Gengliang.Wang&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=LI%2CXiao&quot; class=&quot;user-hover&quot; rel=&quot;LI,Xiao&quot;&gt;LI,Xiao&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16766779" author="dongjoon" created="Wed, 13 Feb 2019 05:06:55 +0000"  >&lt;p&gt;Thank you for pinging me. I&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="16766781" author="dongjoon" created="Wed, 13 Feb 2019 05:10:05 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt;. The following is the result from the Apache Spark 2.4.0 and 2.3.2. Did you use additional configuration?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; spark.range(10).write.orc(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/o1&quot;&lt;/span&gt;)

scala&amp;gt; spark.read.schema(&lt;span class=&quot;code-quote&quot;&gt;&quot;ID &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;&quot;&lt;/span&gt;).orc(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/o1&quot;&lt;/span&gt;).filter(&lt;span class=&quot;code-quote&quot;&gt;&quot;id &amp;gt; 5&quot;&lt;/span&gt;).show
+---+
| ID|
+---+
|  8|
|  7|
|  6|
|  9|
+---+

scala&amp;gt; sc.version
res2: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = 2.4.0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; spark.range(10).write.mode(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).orc(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/o1&quot;&lt;/span&gt;)

scala&amp;gt; spark.read.schema(&lt;span class=&quot;code-quote&quot;&gt;&quot;ID &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;&quot;&lt;/span&gt;).orc(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/o1&quot;&lt;/span&gt;).filter(&lt;span class=&quot;code-quote&quot;&gt;&quot;id &amp;gt; 5&quot;&lt;/span&gt;).show
+---+
| ID|
+---+
|  6|
|  9|
|  8|
|  7|
+---+


scala&amp;gt; sc.version
res3: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = 2.3.2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16766785" author="dongjoon" created="Wed, 13 Feb 2019 05:19:44 +0000"  >&lt;p&gt;Oh, it&apos;s on master branch. I&apos;m investigating it.&lt;/p&gt;</comment>
                            <comment id="16766787" author="dongjoon" created="Wed, 13 Feb 2019 05:33:06 +0000"  >&lt;p&gt;This happens in DSv2 and is caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-23817&quot; title=&quot;Create file source V2 framework and migrate ORC read path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-23817&quot;&gt;&lt;del&gt;SPARK-23817&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16766802" author="dongjoon" created="Wed, 13 Feb 2019 05:53:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt;. I updated the issue description. The root cause seems to be the difference between DSv1 and DSv2. For me, DSv2 had better work in the same way in terms of filters. That would be a general solution. I didn&apos;t check the other data sources, but if we can fix this in ORCFilters, other data sources may hit this issue again. Shall I try to make a fix for DSv2 instead of ORC?&lt;/p&gt;</comment>
                            <comment id="16766819" author="dongjoon" created="Wed, 13 Feb 2019 06:08:09 +0000"  >&lt;p&gt;I&apos;ll make a PR for this.&lt;/p&gt;</comment>
                            <comment id="16767723" author="dongjoon" created="Thu, 14 Feb 2019 00:06:25 +0000"  >&lt;p&gt;This is resolved via &lt;a href=&quot;https://github.com/apache/spark/pull/23770&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23770&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13148816">SPARK-23817</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 39 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0x6g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>