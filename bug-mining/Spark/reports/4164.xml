<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:48:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-18027] .sparkStaging not clean on RM ApplicationNotFoundException</title>
                <link>https://issues.apache.org/jira/browse/SPARK-18027</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;It seems that &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-7705&quot; title=&quot;Cleanup of .sparkStaging directory fails if application is killed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-7705&quot;&gt;&lt;del&gt;SPARK-7705&lt;/del&gt;&lt;/a&gt; didn&apos;t fix all issues with .sparkStaging folder cleanup.&lt;/p&gt;

&lt;p&gt;in Client.scala:monitorApplication &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; val report: ApplicationReport =
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
          getApplicationReport(appId)
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; {
          &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; e: ApplicationNotFoundException =&amp;gt;
            logError(s&lt;span class=&quot;code-quote&quot;&gt;&quot;Application $appId not found.&quot;&lt;/span&gt;)
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (YarnApplicationState.KILLED, FinalApplicationStatus.KILLED)
          &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; NonFatal(e) =&amp;gt;
            logError(s&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to contact YARN &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; application $appId.&quot;&lt;/span&gt;, e)
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (YarnApplicationState.FAILED, FinalApplicationStatus.FAILED)
        }
....
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (state == YarnApplicationState.FINISHED ||
        state == YarnApplicationState.FAILED ||
        state == YarnApplicationState.KILLED) {
        cleanupStagingDir(appId)
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (state, report.getFinalApplicationStatus)
 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In case of ApplicationNotFoundException, we don&apos;t cleanup the sparkStaging folder.&lt;/p&gt;

&lt;p&gt;I believe we should call cleanupStagingDir(appId) on the catch clause above.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13013822">SPARK-18027</key>
            <summary>.sparkStaging not clean on RM ApplicationNotFoundException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean R. Owen</assignee>
                                    <reporter username="davidshar">David Shar</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Oct 2016 11:05:23 +0000</created>
                <updated>Sun, 17 May 2020 18:13:02 +0000</updated>
                            <resolved>Wed, 26 Oct 2016 12:23:27 +0000</resolved>
                                    <version>1.6.0</version>
                                    <fixVersion>2.1.0</fixVersion>
                                    <component>Spark Core</component>
                    <component>YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15591709" author="srowen" created="Thu, 20 Oct 2016 12:37:36 +0000"  >&lt;p&gt;Yes, likely both catch clauses.&lt;/p&gt;</comment>
                            <comment id="15597470" author="apachespark" created="Sat, 22 Oct 2016 08:54:05 +0000"  >&lt;p&gt;User &apos;srowen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15598&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15598281" author="davidshar" created="Sat, 22 Oct 2016 18:35:14 +0000"  >&lt;p&gt;I believe it there is a major difference between the 2 exceptions above.&lt;br/&gt;
1. ApplicationNotFoundException means there is no such running app according to Yarn and it is safe to cleanup.&lt;br/&gt;
2. NonFatal, fail to connect to Yarn, we can&apos;t be sure that the app is running or not, so we cannot be safe cleaning up.&lt;/p&gt;

&lt;p&gt;Therefore, just add cleanup for the first exception.&lt;/p&gt;</comment>
                            <comment id="15599551" author="srowen" created="Sun, 23 Oct 2016 11:30:48 +0000"  >&lt;p&gt;OK, though Spark will consider the app failed in this case no matter what. Is it consistent to not clean it up? it won&apos;t recover on the Spark side regardless.&lt;/p&gt;</comment>
                            <comment id="15601231" author="davidshar" created="Mon, 24 Oct 2016 07:29:39 +0000"  >&lt;p&gt;Yes, I believe it is safer, we cannot be sure what Yarn is doing on connection failure.&lt;/p&gt;</comment>
                            <comment id="15601381" author="srowen" created="Mon, 24 Oct 2016 08:49:41 +0000"  >&lt;p&gt;EDIT: OK I buy into this. &lt;a href=&quot;https://github.com/apache/spark/pull/15598#discussion_r84643826&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15598#discussion_r84643826&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15608292" author="srowen" created="Wed, 26 Oct 2016 12:23:28 +0000"  >&lt;p&gt;Issue resolved by pull request 15598&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15598&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13029947">SPARK-18968</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 3 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35593:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>