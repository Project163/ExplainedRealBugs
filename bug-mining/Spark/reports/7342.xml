<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:18:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-32003] Shuffle files for lost executor are not unregistered if fetch failure occurs after executor is lost</title>
                <link>https://issues.apache.org/jira/browse/SPARK-32003</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;A&#160;customer&apos;s cluster has a node that goes down while a Spark application is running. (They are running Spark on YARN with the external shuffle service enabled.) An executor is lost (apparently the only one running on the node). This executor lost event is handled in the DAGScheduler, which removes the executor from its BlockManagerMaster. At this point, there is no unregistering of shuffle files for the executor or the node. Soon after, tasks trying to fetch shuffle files output by that executor fail with FetchFailed (because the node is down, there is no NodeManager available to serve shuffle files). By right, such fetch failures should cause the shuffle files for the executor to be unregistered, but they do not.&lt;/p&gt;

&lt;p&gt;Due to task failure, the stage is re-attempted. Tasks continue to fail due to fetch failure form the lost executor&apos;s shuffle output. This time, since the failed epoch for the executor is higher, the executor is removed again (this doesn&apos;t really do anything, the executor was already removed when it was lost) and this time the shuffle output is unregistered.&lt;/p&gt;

&lt;p&gt;So it takes two stage attempts instead of one to clear the shuffle output. We get 4 attempts by default. The customer was unlucky and two nodes went down during the stage, i.e., the same problem happened twice. So they used up 4 stage attempts and the stage failed and thus the job.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13311756">SPARK-32003</key>
            <summary>Shuffle files for lost executor are not unregistered if fetch failure occurs after executor is lost</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="wypoon">Wing Yew Poon</assignee>
                                    <reporter username="wypoon">Wing Yew Poon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Jun 2020 15:56:03 +0000</created>
                <updated>Tue, 4 Aug 2020 19:38:36 +0000</updated>
                            <resolved>Wed, 22 Jul 2020 14:57:35 +0000</resolved>
                                    <version>2.4.6</version>
                    <version>3.0.0</version>
                                    <fixVersion>2.4.7</fixVersion>
                    <fixVersion>3.0.1</fixVersion>
                    <fixVersion>3.1.0</fixVersion>
                                    <component>Scheduler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17136792" author="wypoon" created="Tue, 16 Jun 2020 16:31:25 +0000"  >&lt;p&gt;I will open a PR soon with a solution.&lt;/p&gt;</comment>
                            <comment id="17138099" author="apachespark" created="Wed, 17 Jun 2020 04:56:33 +0000"  >&lt;p&gt;User &apos;wypoon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28848&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28848&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17138100" author="apachespark" created="Wed, 17 Jun 2020 04:57:21 +0000"  >&lt;p&gt;User &apos;wypoon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28848&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28848&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17162479" author="apachespark" created="Wed, 22 Jul 2020 05:14:03 +0000"  >&lt;p&gt;User &apos;wypoon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29182&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29182&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17162865" author="irashid" created="Wed, 22 Jul 2020 14:57:35 +0000"  >&lt;p&gt;Fixed in master for 3.1 by &lt;a href=&quot;https://github.com/apache/spark/pull/28848&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28848&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17163009" author="apachespark" created="Wed, 22 Jul 2020 18:53:21 +0000"  >&lt;p&gt;User &apos;wypoon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29193&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29193&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17163010" author="apachespark" created="Wed, 22 Jul 2020 18:54:16 +0000"  >&lt;p&gt;User &apos;wypoon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29193&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29193&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17170945" author="irashid" created="Tue, 4 Aug 2020 16:38:04 +0000"  >&lt;p&gt;Fixed in 3.0.1 by &lt;a href=&quot;https://github.com/apache/spark/pull/29193&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29193&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17171083" author="irashid" created="Tue, 4 Aug 2020 19:38:36 +0000"  >&lt;p&gt;Fixed in 2.4.7 by &lt;a href=&quot;https://github.com/apache/spark/pull/29182&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29182&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 14 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0fwk8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>