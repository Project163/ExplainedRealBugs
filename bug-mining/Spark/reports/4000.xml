<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:47:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-16785] dapply doesn&apos;t return array or raw columns</title>
                <link>https://issues.apache.org/jira/browse/SPARK-16785</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Calling SparkR::dapplyCollect with R functions that return dataframes produces an error. This comes up when returning columns of binary data- ie. serialized fitted models. Also happens when functions return columns containing vectors.&lt;/p&gt;

&lt;p&gt;The error message:&lt;/p&gt;

&lt;p&gt;R computation failed with&lt;br/&gt;
 Error in (function (..., deparse.level = 1, make.row.names = TRUE, stringsAsFactors = default.stringsAsFactors())  :&lt;br/&gt;
  invalid list argument: all variables should have the same length&lt;/p&gt;

&lt;p&gt;Reproducible example: &lt;a href=&quot;https://github.com/clarkfitzg/phd_research/blob/master/ddR/spark/sparkR_dapplyCollect7.R&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/clarkfitzg/phd_research/blob/master/ddR/spark/sparkR_dapplyCollect7.R&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Relates to &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-16611&quot; title=&quot;Expose several hidden DataFrame/RDD functions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-16611&quot;&gt;&lt;del&gt;SPARK-16611&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Mac OS X&lt;/p&gt;</environment>
        <key id="12993377">SPARK-16785</key>
            <summary>dapply doesn&apos;t return array or raw columns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="clarkfitzg">Clark Fitzgerald</assignee>
                                    <reporter username="clarkfitzg">Clark Fitzgerald</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Jul 2016 22:10:26 +0000</created>
                <updated>Wed, 7 Sep 2016 06:44:09 +0000</updated>
                            <resolved>Wed, 7 Sep 2016 06:43:02 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.1</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>SparkR</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15398312" author="clarkfitzg" created="Thu, 28 Jul 2016 22:18:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shivaram&quot; class=&quot;user-hover&quot; rel=&quot;shivaram&quot;&gt;shivaram&lt;/a&gt; and I have had some email correspondence on this: &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;parallelizing data containing binary values: To create a SparkDataFrame from a local R data frame we first convert it to a list of rows and then partition the rows. This happens on the driver 1. The rows are then reconstructed back into a data.frame on the workers 2. The rbind.data.frame fails for the the binary example. I&apos;ve created a small reproducible example at &lt;a href=&quot;https://gist.github.com/shivaram/2f07208a8ebc0832098328fa0a3fac9d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/shivaram/2f07208a8ebc0832098328fa0a3fac9d&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;1 &lt;a href=&quot;https://github.com/apache/spark/blob/0869b3a5f028b64c2da511e70b02ab42f65fc949/R/pkg/R/SQLContext.R#L209&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/0869b3a5f028b64c2da511e70b02ab42f65fc949/R/pkg/R/SQLContext.R#L209&lt;/a&gt;&lt;br/&gt;
2 &lt;a href=&quot;https://github.com/apache/spark/blob/0869b3a5f028b64c2da511e70b02ab42f65fc949/R/pkg/inst/worker/worker.R#L39&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/0869b3a5f028b64c2da511e70b02ab42f65fc949/R/pkg/inst/worker/worker.R#L39&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15398369" author="clarkfitzg" created="Thu, 28 Jul 2016 22:51:22 +0000"  >&lt;p&gt;To fix this I propose to treat the rows as a list of dataframes instead of as a list of lists:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;rowlist = split(df, 1:nrow(df))&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;df2 = do.call(rbind, rowlist)&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="15399637" author="shivaram" created="Fri, 29 Jul 2016 16:35:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=clarkfitzg&quot; class=&quot;user-hover&quot; rel=&quot;clarkfitzg&quot;&gt;clarkfitzg&lt;/a&gt; Could you create a PR with this patch and a corresponding unit test ? I think this sounds fine to me as an approach but I am not sure if there are other parts of the code which rely on it being list of lists.  Also I just found that the PR we added mapply in (&lt;a href=&quot;https://github.com/apache/spark/pull/9099&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9099&lt;/a&gt;) had some benchmark results  &amp;#8211; Would be great to see how the benchmarks look with this proposal&lt;/p&gt;</comment>
                            <comment id="15400083" author="clarkfitzg" created="Fri, 29 Jul 2016 22:03:16 +0000"  >&lt;p&gt;Yes I can do a PR for this. It may take me a little while though.&lt;/p&gt;</comment>
                            <comment id="15425679" author="clarkfitzg" created="Thu, 18 Aug 2016 00:51:22 +0000"  >&lt;p&gt;Starting on this now.&lt;/p&gt;</comment>
                            <comment id="15427785" author="clarkfitzg" created="Fri, 19 Aug 2016 07:55:29 +0000"  >&lt;p&gt;Making some slow progress digging into this. Here&apos;s the failing test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  df_listcols &amp;lt;- data.frame(key = 1:3)
  df_listcols$bytes &amp;lt;- lapply(df_listcols$key, serialize, connection = NULL)
  df_listcols_spark &amp;lt;- createDataFrame(df_listcols)
  result1 &amp;lt;- collect(df_listcols_spark)
  expect_identical(df_listcols, result1)
  result2 &amp;lt;- dapplyCollect(df_listcols_spark, function(x) x)   # FAILS HERE
  expect_equal(df_listcols, result2)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the error message:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;# R computation failed with
# Error in (function (..., row.names = NULL, check.rows = FALSE, check.names = TRUE,  :
#  arguments imply differing number of rows: 3, 26
#        at org.apache.spark.api.r.RRunner.compute(RRunner.scala:108)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A separate but related issue with array columns that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shivaram&quot; class=&quot;user-hover&quot; rel=&quot;shivaram&quot;&gt;shivaram&lt;/a&gt; has mentioned is that the dataframe can&apos;t be collected if this column is added:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  df_listcols$arr &amp;lt;- lapply(df_listcols$key,
                            function(x) seq(0, 1, length.out=15))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Will continue looking at this on Monday.&lt;/p&gt;</comment>
                            <comment id="15427788" author="clarkfitzg" created="Fri, 19 Aug 2016 07:57:18 +0000"  >&lt;p&gt;Also my proposal above:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;to treat the rows as a list of dataframes instead of as a list of lists&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;did not work. Although I do think that approach has advantages- ie. do.call(rbind, list_of_rows) would always work correctly.&lt;/p&gt;</comment>
                            <comment id="15434253" author="apachespark" created="Wed, 24 Aug 2016 06:22:07 +0000"  >&lt;p&gt;User &apos;clarkfitzg&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/14783&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14783&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15469754" author="shivaram" created="Wed, 7 Sep 2016 06:43:03 +0000"  >&lt;p&gt;Issue resolved by pull request 14783&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/14783&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14783&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31nc7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311620" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Shepherd</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>shivaram</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>