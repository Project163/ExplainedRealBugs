<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:02:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-25538] incorrect row counts after distinct()</title>
                <link>https://issues.apache.org/jira/browse/SPARK-25538</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;It appears that&#160;&lt;tt&gt;df.distinct.count&lt;/tt&gt;&#160;can return incorrect values after &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-23713&quot; title=&quot;Clean-up UnsafeWriter classes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-23713&quot;&gt;&lt;del&gt;SPARK-23713&lt;/del&gt;&lt;/a&gt;. It&apos;s possible that other operations are affected as well; &lt;tt&gt;distinct&lt;/tt&gt; just&#160;happens to be the one that we noticed. I believe that&#160;this issue was introduced by&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-23713&quot; title=&quot;Clean-up UnsafeWriter classes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-23713&quot;&gt;&lt;del&gt;SPARK-23713&lt;/del&gt;&lt;/a&gt; because I can&apos;t reproduce it until that commit, and I&apos;ve been able to reproduce it after that commit as well as with &lt;tt&gt;tags/v2.4.0-rc1&lt;/tt&gt;.&#160;&lt;/p&gt;

&lt;p&gt;Below are example spark-shell sessions to illustrate the problem. Unfortunately the data used in these examples can&apos;t be uploaded to this Jira ticket. I&apos;ll try to create test data which also reproduces the issue, and will upload that if I&apos;m able to do so.&lt;/p&gt;

&lt;p&gt;Example from Spark 2.3.1, which behaves correctly:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; val df = spark.read.parquet(&lt;span class=&quot;code-quote&quot;&gt;&quot;hdfs:&lt;span class=&quot;code-comment&quot;&gt;///data&quot;&lt;/span&gt;)
&lt;/span&gt;df: org.apache.spark.sql.DataFrame = [&amp;lt;redacted&amp;gt;]

scala&amp;gt; df.count
res0: &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; = 123

scala&amp;gt; df.distinct.count
res1: &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; = 115
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Example from Spark 2.4.0-rc1, which returns different output:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; val df = spark.read.parquet(&lt;span class=&quot;code-quote&quot;&gt;&quot;hdfs:&lt;span class=&quot;code-comment&quot;&gt;///data&quot;&lt;/span&gt;)
&lt;/span&gt;df: org.apache.spark.sql.DataFrame = [&amp;lt;redacted&amp;gt;]

scala&amp;gt; df.count
res0: &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; = 123

scala&amp;gt; df.distinct.count
res1: &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; = 116

scala&amp;gt; df.sort(&lt;span class=&quot;code-quote&quot;&gt;&quot;col_0&quot;&lt;/span&gt;).distinct.count
res2: &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; = 123

scala&amp;gt; df.withColumnRenamed(&lt;span class=&quot;code-quote&quot;&gt;&quot;col_0&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;newName&quot;&lt;/span&gt;).distinct.count
res3: &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; = 115
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Reproduced on a Centos7 VM and from source in Intellij on OS X.&lt;/p&gt;</environment>
        <key id="13187505">SPARK-25538</key>
            <summary>incorrect row counts after distinct()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgaido">Marco Gaido</assignee>
                                    <reporter username="Steven Rand">Steven Rand</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Wed, 26 Sep 2018 05:53:26 +0000</created>
                <updated>Thu, 20 Aug 2020 15:39:47 +0000</updated>
                            <resolved>Wed, 3 Oct 2018 14:29:38 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>2.4.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="16628369" author="mgaido" created="Wed, 26 Sep 2018 07:44:10 +0000"  >&lt;p&gt;Please do not use Blocker and Critical when reporting issues as they are reserved for committer. Though, I agree this should be a blocker for 2.4.0 as it is a correctness issue. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16628388" author="cloud_fan" created="Wed, 26 Sep 2018 08:06:50 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Steven+Rand&quot; class=&quot;user-hover&quot; rel=&quot;Steven Rand&quot;&gt;Steven Rand&lt;/a&gt;, is it possible to upload the data file? We need to be able to reproduce it in order to debug it, thanks! I&apos;ll set it as a blocker once I confirm this is a correctness issue.&lt;/p&gt;</comment>
                            <comment id="16628449" author="steven rand" created="Wed, 26 Sep 2018 08:58:37 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt;, I&apos;m still trying to create a scrubbed version of the file. It&apos;s proving&#160;to be&#160;difficult since mutating the original DataFrame often prevents the issue from reproducing (e.g., the example in the description where calling &lt;tt&gt;withColumnRenamed&lt;/tt&gt;&#160;before &lt;tt&gt;distinct.count&lt;/tt&gt;&#160;leads to the correct result being printed).&lt;/p&gt;</comment>
                            <comment id="16628744" author="cloud_fan" created="Wed, 26 Sep 2018 13:12:47 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kiszk&quot; class=&quot;user-hover&quot; rel=&quot;kiszk&quot;&gt;kiszk&lt;/a&gt; as well&lt;/p&gt;</comment>
                            <comment id="16629281" author="kiszk" created="Wed, 26 Sep 2018 19:04:56 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Steven+Rand&quot; class=&quot;user-hover&quot; rel=&quot;Steven Rand&quot;&gt;Steven Rand&lt;/a&gt;, would it be possible to share the schema of this DataFrame?&lt;/p&gt;</comment>
                            <comment id="16629561" author="steven rand" created="Thu, 27 Sep 2018 00:17:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kiszk&quot; class=&quot;user-hover&quot; rel=&quot;kiszk&quot;&gt;kiszk&lt;/a&gt;, yes, the schema is:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; spark.read.parquet(&lt;span class=&quot;code-quote&quot;&gt;&quot;hdfs:&lt;span class=&quot;code-comment&quot;&gt;///data&quot;&lt;/span&gt;).printSchema
&lt;/span&gt;root
 |-- col_0: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_1: timestamp (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_2: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_3: timestamp (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_4: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_5: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: string (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_6: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_7: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: decimal(38,18) (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_8: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: string (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_9: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: decimal(38,18) (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_10: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_11: timestamp (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_12: integer (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_13: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_14: decimal(38,18) (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_15: &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_16: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_17: integer (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_18: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: string (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_19: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_20: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_21: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: string (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_22: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_23: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: timestamp (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_24: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_25: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_26: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_27: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: string (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_28: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: string (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_29: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: string (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_30: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: string (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_31: decimal(38,18) (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_32: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: string (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_33: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_34: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: decimal(38,18) (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_35: decimal(38,18) (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_36: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: string (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_37: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: decimal(38,18) (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_38: decimal(38,18) (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_39: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: string (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_40: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_41: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_42: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_43: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: string (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_44: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: string (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_45: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_46: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: string (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_47: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: decimal(38,18) (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_48: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_49: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: string (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_50: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: decimal(38,18) (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_51: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: string (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_52: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: decimal(38,18) (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_53: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_54: decimal(38,18) (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_55: decimal(38,18) (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_56: decimal(38,18) (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- col_57: array (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- element: decimal(38,18) (containsNull = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16631605" author="kiszk" created="Fri, 28 Sep 2018 09:29:06 +0000"  >&lt;p&gt;Thank for upload a schema. While I looked at the schema, I am still not sure about the reason of this problem.&lt;br/&gt;
I would appreciate it if you could find a good input data that can reproduce a problem.&lt;/p&gt;</comment>
                            <comment id="16632729" author="steven rand" created="Sat, 29 Sep 2018 02:26:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kiszk&quot; class=&quot;user-hover&quot; rel=&quot;kiszk&quot;&gt;kiszk&lt;/a&gt; that makes sense, I&apos;ll try to do so. The issue I&apos;ve been having so far is that when I run the UDF I&apos;ve written to&#160;change&#160;the data (while preserving number of duplicate rows), the resulting DataFrame doesn&apos;t reproduce the issue.&lt;/p&gt;</comment>
                            <comment id="16633254" author="steven rand" created="Sun, 30 Sep 2018 05:56:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kiszk&quot; class=&quot;user-hover&quot; rel=&quot;kiszk&quot;&gt;kiszk&lt;/a&gt; I&apos;ve uploaded a tarball containing parquet files that reproduce the issue but don&apos;t contain any of the values in the original dataset. Specifically, some columns have been dropped, all strings have been changed to &quot;test_string&quot;, all values in col_50 have been changed to&#160;0.0043, and the values in col_14 have all been mapped from their original values to values between&#160;0.001 and&#160;0.0044.&lt;/p&gt;

&lt;p&gt;This new DataFrame still reproduces issues similar to those in the description:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; df.distinct.count
res3: &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; = 64

scala&amp;gt; df.sort(&lt;span class=&quot;code-quote&quot;&gt;&quot;col_0&quot;&lt;/span&gt;).distinct.count
res4: &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; = 73

scala&amp;gt; df.withColumnRenamed(&lt;span class=&quot;code-quote&quot;&gt;&quot;col_0&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;&quot;&lt;/span&gt;).distinct.count
res5: &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; = 63
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I get those inconsistent/wrong results on &lt;tt&gt;2.4.0-rc2&lt;/tt&gt;&#160;and if I check out commit &lt;tt&gt;a7c19d9c21d59fd0109a7078c80b33d3da03fafd&lt;/tt&gt;, which is &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-23713&quot; title=&quot;Clean-up UnsafeWriter classes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-23713&quot;&gt;&lt;del&gt;SPARK-23713&lt;/del&gt;&lt;/a&gt;. If I check out the commit immediately before, which is &lt;tt&gt;fe2b7a4568d65a62da6e6eb00fff05f248b4332c&lt;/tt&gt;, then all three commands return 63.&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt; &#8211; IMO this should block the 2.4.0 release.&lt;/p&gt;</comment>
                            <comment id="16633568" author="kiszk" created="Mon, 1 Oct 2018 01:52:36 +0000"  >&lt;p&gt;Thank you. I will check it tonight in Japan.&lt;/p&gt;</comment>
                            <comment id="16634106" author="mgaido" created="Mon, 1 Oct 2018 14:41:47 +0000"  >&lt;p&gt;I was able to reproduce also using limit instead of sort:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; df.limit(80).distinct.count
res83: &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; = 72

scala&amp;gt; df.distinct.count
res84: &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; = 64

scala&amp;gt; df.limit(20).distinct.count
res88: &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; = 20

scala&amp;gt; df.limit(20).distinct.collect.distinct.length
res89: Int = 17
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16634344" author="kiszk" created="Mon, 1 Oct 2018 17:13:44 +0000"  >&lt;p&gt;This test case does not print &lt;tt&gt;63&lt;/tt&gt; using master branch.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  test(&lt;span class=&quot;code-quote&quot;&gt;&quot;test2&quot;&lt;/span&gt;) {
    val df = spark.read.parquet(&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///SPARK-25538-repro&quot;&lt;/span&gt;)
&lt;/span&gt;    val c1 = df.distinct.count
    val c2 = df.sort(&lt;span class=&quot;code-quote&quot;&gt;&quot;col_0&quot;&lt;/span&gt;).distinct.count
    val c3 = df.withColumnRenamed(&lt;span class=&quot;code-quote&quot;&gt;&quot;col_0&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;&quot;&lt;/span&gt;).distinct.count
    val c0 = df.count
    print(s&lt;span class=&quot;code-quote&quot;&gt;&quot;c1=$c1, c2=$c2, c3=$c3, c0=$c0\n&quot;&lt;/span&gt;)
  }

c1=64, c2=73, c3=64, c0=123
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16634430" author="dongjoon" created="Mon, 1 Oct 2018 18:18:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgaido&quot; class=&quot;user-hover&quot; rel=&quot;mgaido&quot;&gt;mgaido&lt;/a&gt;&apos;s PR, &lt;a href=&quot;https://github.com/apache/spark/pull/22602&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22602&lt;/a&gt;, fixes the decimal issue and looks reasonable.&lt;/p&gt;</comment>
                            <comment id="16634532" author="apachespark" created="Mon, 1 Oct 2018 19:45:09 +0000"  >&lt;p&gt;User &apos;mgaido91&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22602&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22602&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16634534" author="apachespark" created="Mon, 1 Oct 2018 19:46:03 +0000"  >&lt;p&gt;User &apos;mgaido91&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22602&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22602&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16637032" author="dongjoon" created="Wed, 3 Oct 2018 14:29:38 +0000"  >&lt;p&gt;Issue resolved by pull request 22602&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22602&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22602&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16637630" author="steven rand" created="Wed, 3 Oct 2018 23:47:15 +0000"  >&lt;p&gt;Thanks all!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="13145804">SPARK-23713</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12941861" name="SPARK-25538-repro.tgz" size="3677" author="Steven Rand" created="Sun, 30 Sep 2018 05:17:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3yi3r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>