<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:06:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-23519] Create View Commands Fails with  The view output (col1,col1) contains duplicate column name</title>
                <link>https://issues.apache.org/jira/browse/SPARK-23519</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;1- create and populate a hive table&#160; . I did this in a hive cli session .[ not that this matters ]&lt;/p&gt;

&lt;p&gt;create table&#160; atable (col1 int) ;&lt;/p&gt;

&lt;p&gt;insert&#160; into atable values (10 ) , (100)&#160; ;&lt;/p&gt;

&lt;p&gt;2. create a view from the table.&#160;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;These actions were performed from a spark shell&#160;&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;spark.sql(&quot;create view&#160; default.aview&#160; (int1 , int2 ) as select&#160; col1 , col1 from atable &quot;)&lt;br/&gt;
 java.lang.AssertionError: assertion failed: The view output (col1,col1) contains duplicate column name.&lt;br/&gt;
 at scala.Predef$.assert(Predef.scala:170)&lt;br/&gt;
 at org.apache.spark.sql.execution.command.ViewHelper$.generateViewProperties(views.scala:361)&lt;br/&gt;
 at org.apache.spark.sql.execution.command.CreateViewCommand.prepareTable(views.scala:236)&lt;br/&gt;
 at org.apache.spark.sql.execution.command.CreateViewCommand.run(views.scala:174)&lt;br/&gt;
 at org.apache.spark.sql.execution.command.ExecutedCommandExec.sideEffectResult$lzycompute(commands.scala:58)&lt;br/&gt;
 at org.apache.spark.sql.execution.command.ExecutedCommandExec.sideEffectResult(commands.scala:56)&lt;br/&gt;
 at org.apache.spark.sql.execution.command.ExecutedCommandExec.executeCollect(commands.scala:67)&lt;br/&gt;
 at org.apache.spark.sql.Dataset.&amp;lt;init&amp;gt;(Dataset.scala:183)&lt;br/&gt;
 at org.apache.spark.sql.Dataset$.ofRows(Dataset.scala:68)&lt;br/&gt;
 at org.apache.spark.sql.SparkSession.sql(SparkSession.scala:632)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13141079">SPARK-23519</key>
            <summary>Create View Commands Fails with  The view output (col1,col1) contains duplicate column name</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hem1891">hemanth meka</assignee>
                                    <reporter username="tafranky@gmail.com">Franck Tago</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Feb 2018 00:06:55 +0000</created>
                <updated>Fri, 8 Nov 2019 06:41:40 +0000</updated>
                            <resolved>Wed, 28 Aug 2019 04:11:55 +0000</resolved>
                                    <version>2.2.1</version>
                                    <fixVersion>2.4.5</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="16389150" author="tafranky@gmail.com" created="Wed, 7 Mar 2018 07:08:27 +0000"  >&lt;p&gt;Any updates on this ?&lt;/p&gt;

&lt;p&gt;Could someone assist with this?&lt;/p&gt;</comment>
                            <comment id="16421985" author="shahid" created="Mon, 2 Apr 2018 07:08:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tafranky%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;tafranky@gmail.com&quot;&gt;tafranky@gmail.com&lt;/a&gt; You can try,&lt;/p&gt;

&lt;p&gt;&#160;spark.sql(&quot;create view&#160; default.aview&#160; (int1 , int2 ) as select&#160; col1 as a, col1 as b from atable &quot;)&lt;/p&gt;</comment>
                            <comment id="16443154" author="tafranky@gmail.com" created="Wed, 18 Apr 2018 20:35:42 +0000"  >&lt;p&gt;thanks for the suggestion &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shahid&quot; class=&quot;user-hover&quot; rel=&quot;shahid&quot;&gt;shahid&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The issue with your suggestion is that I dynamically generate the create view statement&#160; ;Moreover&#160; &#160;the select statement is kind of Opaque to me because it is provided by the customer.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;It would be nice is spark could fix such a simple&#160; case.&lt;/p&gt;</comment>
                            <comment id="16449948" author="emaynard1121" created="Tue, 24 Apr 2018 14:24:31 +0000"  >&lt;p&gt;Why is the fact that you dynamically generate the statement mean that you can&apos;t alias the columns in your select statement? You can generate aliases as well. This seems like a non-issue.&lt;/p&gt;</comment>
                            <comment id="16469984" author="maropu" created="Thu, 10 May 2018 06:37:46 +0000"  >&lt;p&gt;I think typical databases can&apos;t use duplicate column names in views, e.g.,&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

postgres=# create table r(c1 &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
postgres=# create temporary view v as select c1, c1 from r;
ERROR: column &lt;span class=&quot;code-quote&quot;&gt;&quot;c1&quot;&lt;/span&gt; specified more than once

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16470843" author="tafranky@gmail.com" created="Thu, 10 May 2018 17:49:46 +0000"  >&lt;p&gt;I do not agree with the &apos;typical database&apos; claim .&#160;&lt;/p&gt;

&lt;p&gt;mysql , oracle&#160; , hive support this&#160; syntax.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;example&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12922880/12922880_image-2018-05-10-10-48-57-259.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16907641" author="tafranky@gmail.com" created="Wed, 14 Aug 2019 21:38:04 +0000"  >&lt;p&gt;Ok Spark Community&#160;&lt;/p&gt;

&lt;p&gt;I am sorry for being a pest about this , but I re-opening this Jira because I really believe that this should be addressed .&#160;&lt;/p&gt;

&lt;p&gt;Right now I do not have any way satisfying my&#160; customer&apos;s requirement .&#160;&lt;/p&gt;

&lt;p&gt;My current use case is the following .&#160;&lt;/p&gt;

&lt;p&gt;My customer can provide any customer&#160; Hive query . I am oblivious to the actually content of the query and parsing the query is not an option .&lt;/p&gt;

&lt;p&gt;All I know if the number of fields projected from the customer query and the type of those fields .&#160;&lt;/p&gt;

&lt;p&gt;I do not know the name of the fields projected from the custom query.&lt;/p&gt;

&lt;p&gt;What is currently&#160; do with spark sql is run a&#160; query of the form .&#160;&lt;/p&gt;

&lt;p&gt;Create view view_name&#160;&lt;/p&gt;</comment>
                            <comment id="16912684" author="hem1891" created="Wed, 21 Aug 2019 21:13:02 +0000"  >&lt;p&gt;View creation currently uses analyzed plan which is built using only the select part of command and it doesn&apos;t use aliases provided in query. I checked and found that before &lt;a href=&quot;https://github.com/apache/spark/pull/16613/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR-16613&lt;/a&gt; this used to be handled by aliasing and using aliasedPlan instead of analyzedPlan.&lt;/p&gt;

&lt;p&gt;I tried applying those changes but now, CheckAnalysis fails because of some other fix. I am working on this.&lt;/p&gt;

&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jiangxb&quot; class=&quot;user-hover&quot; rel=&quot;jiangxb&quot;&gt;jiangxb&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt;&#160;any thoughts on why it was removed in PR-16613?&lt;/p&gt;</comment>
                            <comment id="16913855" author="cloud_fan" created="Fri, 23 Aug 2019 02:06:03 +0000"  >&lt;p&gt;I think this is a bug and should be fixed. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt; do you have any clues about this bug?&lt;/p&gt;</comment>
                            <comment id="16913915" author="viirya" created="Fri, 23 Aug 2019 04:34:47 +0000"  >&lt;p&gt;Thanks for pinging me.&lt;/p&gt;

&lt;p&gt;I am going on a flight soon. If this is not urgent, I can look into it after today.&lt;/p&gt;</comment>
                            <comment id="16913965" author="hem1891" created="Fri, 23 Aug 2019 06:11:09 +0000"  >&lt;p&gt;I have a fix for this.&#160;checkColumnNameDuplication is checking analyzed schema(id, id) whereas it should be checking aliased schema(int1, int2). I got it to work. I will run tests and submit a PR.&lt;/p&gt;</comment>
                            <comment id="16914660" author="hem1891" created="Fri, 23 Aug 2019 21:49:55 +0000"  >&lt;p&gt;PR raised &lt;a href=&quot;https://github.com/apache/spark/pull/25570&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/25570&lt;/a&gt;&#160;Someone please review.&lt;/p&gt;</comment>
                            <comment id="16915809" author="viirya" created="Mon, 26 Aug 2019 14:07:11 +0000"  >&lt;p&gt;I test with Hive 2.1. It doesn&apos;t support duplicate column names:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hive&amp;gt; create view test_view (c1, c2) as select c1, c1 from test;
FAILED: SemanticException [Error 10036]: Duplicate column name: c1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tafranky%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;tafranky@gmail.com&quot;&gt;tafranky@gmail.com&lt;/a&gt; you said Hive supports it, is newer versions of Hive supporting this?&lt;/p&gt;</comment>
                            <comment id="16916334" author="tafranky@gmail.com" created="Tue, 27 Aug 2019 04:09:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;My mistake , i tested it with Oracle and MySql . I then assume that hive would honor the same .&#160;&lt;/p&gt;

&lt;p&gt;You are correct.&#160; Hive does not appear to support this after all .&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I need to test this on newer versions of Hive.&#160;&lt;/p&gt;</comment>
                            <comment id="16917392" author="cloud_fan" created="Wed, 28 Aug 2019 04:11:55 +0000"  >&lt;p&gt;Issue resolved by pull request 25570&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/25570&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/25570&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16920302" author="viirya" created="Sun, 1 Sep 2019 05:56:41 +0000"  >&lt;p&gt;This was closed and then reopened and fixed. The label &lt;a href=&quot;https://issues.apache.org/jira/issues/?jql=labels+%3D+bulk-closed&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;bulk-closed&lt;/a&gt; looks not correct. I remove it. Feel free to add it back if I misunderstand it.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12922880" name="image-2018-05-10-10-48-57-259.png" size="21859" author="tafranky@gmail.com" created="Thu, 10 May 2018 17:48:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 11 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3qmdz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>