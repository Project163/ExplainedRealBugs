<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:02:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-25959] Difference in featureImportances results on computed vs saved models</title>
                <link>https://issues.apache.org/jira/browse/SPARK-25959</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I tried to implement GBT and found that the feature Importance computed while the model was fit is different when the same model was saved into a storage and loaded back.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I also found that once the persistent model is loaded and saved back again and loaded, the feature importance remains the same.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Not sure if its bug while storing and reading the model first time or am missing some parameter that need to be set before saving the model (thus model is picking some defaults - causing feature importance to change)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Below is the test code:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;val testDF = Seq(&lt;br/&gt;
(1, 3, 2, 1, 1),&lt;br/&gt;
(3, 2, 1, 2, 0),&lt;br/&gt;
(2, 2, 1, 1, 0),&lt;br/&gt;
(3, 4, 2, 2, 0),&lt;br/&gt;
(2, 2, 1, 3, 1)&lt;br/&gt;
).toDF(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;)&lt;/p&gt;


&lt;p&gt;val featureColumns = testDF.columns.filter(_ != &quot;e&quot;)&lt;br/&gt;
// Assemble the features into a vector&lt;br/&gt;
val assembler = new VectorAssembler().setInputCols(featureColumns).setOutputCol(&quot;features&quot;)&lt;br/&gt;
// Transform the data to get the feature data set&lt;br/&gt;
val featureDF = assembler.transform(testDF)&lt;/p&gt;

&lt;p&gt;// Train a GBT model.&lt;br/&gt;
val gbt = new GBTClassifier()&lt;br/&gt;
.setLabelCol(&quot;e&quot;)&lt;br/&gt;
.setFeaturesCol(&quot;features&quot;)&lt;br/&gt;
.setMaxDepth(2)&lt;br/&gt;
.setMaxBins(5)&lt;br/&gt;
.setMaxIter(10)&lt;br/&gt;
.setSeed(10)&lt;br/&gt;
.fit(featureDF)&lt;/p&gt;

&lt;p&gt;gbt.transform(featureDF).show(false)&lt;/p&gt;

&lt;p&gt;// Write out the model&lt;/p&gt;

&lt;p&gt;featureColumns.zip(gbt.featureImportances.toArray).sortBy(-_._2).take(20).foreach(println)&lt;br/&gt;
/* Prints&lt;/p&gt;

&lt;p&gt;(d,0.5931875075767403)&lt;br/&gt;
(a,0.3747184548362353)&lt;br/&gt;
(b,0.03209403758702444)&lt;br/&gt;
(c,0.0)&lt;/p&gt;

&lt;p&gt;*/&lt;br/&gt;
gbt.write.overwrite().save(&quot;file:///tmp/test123&quot;)&lt;/p&gt;

&lt;p&gt;println(&quot;Reading model again&quot;)&lt;br/&gt;
val gbtload = GBTClassificationModel.load(&quot;file:///tmp/test123&quot;)&lt;/p&gt;

&lt;p&gt;featureColumns.zip(gbtload.featureImportances.toArray).sortBy(-_._2).take(20).foreach(println)&lt;/p&gt;

&lt;p&gt;/*&lt;/p&gt;

&lt;p&gt;Prints&lt;/p&gt;

&lt;p&gt;(d,0.6455841215290767)&lt;br/&gt;
(a,0.3316126797964181)&lt;br/&gt;
(b,0.022803198674505094)&lt;br/&gt;
(c,0.0)&lt;/p&gt;

&lt;p&gt;*/&lt;/p&gt;


&lt;p&gt;gbtload.write.overwrite().save(&quot;file:///tmp/test123_rewrite&quot;)&lt;/p&gt;

&lt;p&gt;val gbtload2 = GBTClassificationModel.load(&quot;file:///tmp/test123_rewrite&quot;)&lt;/p&gt;

&lt;p&gt;featureColumns.zip(gbtload2.featureImportances.toArray).sortBy(-_._2).take(20).foreach(println)&lt;/p&gt;

&lt;p&gt;/* prints&lt;br/&gt;
(d,0.6455841215290767)&lt;br/&gt;
(a,0.3316126797964181)&lt;br/&gt;
(b,0.022803198674505094)&lt;br/&gt;
(c,0.0)&lt;/p&gt;

&lt;p&gt;*/&lt;/p&gt;</description>
                <environment></environment>
        <key id="13196729">SPARK-25959</key>
            <summary>Difference in featureImportances results on computed vs saved models</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgaido">Marco Gaido</assignee>
                                    <reporter username="snayakm">Suraj Nayak</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Nov 2018 02:58:00 +0000</created>
                <updated>Tue, 20 Nov 2018 14:47:02 +0000</updated>
                            <resolved>Sat, 17 Nov 2018 15:47:07 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>ML</component>
                    <component>MLlib</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16679911" author="apachespark" created="Thu, 8 Nov 2018 15:31:28 +0000"  >&lt;p&gt;User &apos;mgaido91&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22986&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22986&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16679913" author="apachespark" created="Thu, 8 Nov 2018 15:32:14 +0000"  >&lt;p&gt;User &apos;mgaido91&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22986&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22986&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16690612" author="srowen" created="Sat, 17 Nov 2018 15:47:07 +0000"  >&lt;p&gt;Issue resolved by pull request 22986&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22986&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22986&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16692567" author="functicons" created="Tue, 20 Nov 2018 02:37:50 +0000"  >&lt;p&gt;Can we backport the&#160;fix &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-25959&quot; title=&quot;Difference in featureImportances results on computed vs saved models&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-25959&quot;&gt;&lt;del&gt;SPARK-25959&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ML&amp;#93;&lt;/span&gt; GBTClassifier picks wrong impurity stats on loading&quot; (e00cac9) to Spark 2.2+?&#160;I tried to cherry-pick it to 2.2, but there are 2 conflicts I don&apos;t know how to resolve correctly:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;both modified: mllib/src/main/scala/org/apache/spark/ml/classification/GBTClassifier.scala&lt;br/&gt;
 both modified: project/MimaExcludes.scala&lt;/p&gt;</comment>
                            <comment id="16692861" author="mgaido" created="Tue, 20 Nov 2018 08:45:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt; what do you think about backporting this? Maybe 2.2 is a bit too old, I don&apos;t know if we are planning any new 2.2 release, but 2.4  - 2.3 branches may be ok. What do you think?&lt;/p&gt;</comment>
                            <comment id="16693326" author="srowen" created="Tue, 20 Nov 2018 14:47:02 +0000"  >&lt;p&gt;Yes 2.2 is all but EOL. I am worried about the binary incompatibility issue, and that&apos;s why I didn&apos;t back-port. Even if the incompatibility isn&apos;t in the apparent user-visible API, I wonder if it will cause problems at link time nonetheless. I didn&apos;t test it. Is it possible to submit a job compiled from master against an older cluster and just check that it doesn&apos;t fail?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s007i8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>