<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:09:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-30417] SPARK-29976 calculation of slots wrong for Standalone Mode</title>
                <link>https://issues.apache.org/jira/browse/SPARK-30417</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-29976&quot; title=&quot;Allow speculation even if there is only one task&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-29976&quot;&gt;&lt;del&gt;SPARK-29976&lt;/del&gt;&lt;/a&gt; we added a config to determine if we should allow speculation when the number of tasks is less then the number of slots on a single executor.&#160; The problem is that for standalone mode (and&#160; mesos coarse grained) the EXECUTOR_CORES config is not set properly by default. In those modes the number of executor cores is all the cores of the Worker.&#160;&#160;&#160; The default of EXECUTOR_CORES is 1.&lt;/p&gt;

&lt;p&gt;The calculation:&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#000080&quot;&gt;val &lt;/font&gt;&lt;font color=&quot;#660e7a&quot;&gt;speculationTasksLessEqToSlots &lt;/font&gt;= &lt;font color=&quot;#660e7a&quot;&gt;numTasks &lt;/font&gt;&amp;lt;= (&lt;font color=&quot;#660e7a&quot;&gt;conf&lt;/font&gt;.get(&lt;font color=&quot;#660e7a&quot;&gt;EXECUTOR_CORES&lt;/font&gt;) / sched.&lt;font color=&quot;#660e7a&quot;&gt;CPUS_PER_TASK&lt;/font&gt;)&lt;/p&gt;

&lt;p&gt;If someone set the cpus per task &amp;gt; 1 then this would end up being false even if 1 task.&#160; Note that the default case where cpus per task is 1 and executor cores is 1 it works out ok but is only applied if 1 task vs number of slots on the executor.&lt;/p&gt;

&lt;p&gt;Here we really don&apos;t know the number of executor cores for standalone mode or mesos so I think a decent solution is to just use 1 in those cases and document the difference.&lt;/p&gt;

&lt;p&gt;Something like max(&lt;font color=&quot;#660e7a&quot;&gt;conf&lt;/font&gt;.get(&lt;font color=&quot;#660e7a&quot;&gt;EXECUTOR_CORES&lt;/font&gt;) / sched.&lt;font color=&quot;#660e7a&quot;&gt;CPUS_PER_TASK&lt;/font&gt;, 1)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13277413">SPARK-30417</key>
            <summary>SPARK-29976 calculation of slots wrong for Standalone Mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yuchen.huo">Yuchen Huo</assignee>
                                    <reporter username="tgraves">Thomas Graves</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Jan 2020 18:49:02 +0000</created>
                <updated>Wed, 8 Jan 2020 19:36:52 +0000</updated>
                            <resolved>Wed, 8 Jan 2020 19:31:41 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17007694" author="tgraves" created="Fri, 3 Jan 2020 18:50:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuchen.huo&quot; class=&quot;user-hover&quot; rel=&quot;yuchen.huo&quot;&gt;yuchen.huo&lt;/a&gt; is this something you could work on?&lt;/p&gt;</comment>
                            <comment id="17010142" author="yuchen.huo" created="Tue, 7 Jan 2020 22:32:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tgraves&quot; class=&quot;user-hover&quot; rel=&quot;tgraves&quot;&gt;tgraves&lt;/a&gt;&#160;Sure. Is there a more stable way to get the number of cores the executor is using instead of checking the value of&#160;EXECUTOR_CORES which might not be set?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jiangxb1987&quot; class=&quot;user-hover&quot; rel=&quot;jiangxb1987&quot;&gt;jiangxb1987&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17010146" author="tgraves" created="Tue, 7 Jan 2020 22:49:16 +0000"  >&lt;p&gt;The only way for standalone mode would be to look at what each executor registers with. Theoretically different executors could have different number of cores.&#160; There are actually other issues (&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-30299&quot; title=&quot;Dynamic allocation with Standalone mode calculates to many executors needed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-30299&quot;&gt;SPARK-30299&lt;/a&gt; for instance) with this in the code as well that I think we need a global solution for.&#160; So perhaps for this Jira we do the easy thing like I suggested and then we have have a separate Jira to look at handling this better in the future.&lt;/p&gt;</comment>
                            <comment id="17010156" author="jiangxb1987" created="Tue, 7 Jan 2020 23:06:39 +0000"  >&lt;p&gt;Good catch! `max(conf.get(EXECUTOR_CORES) / sched.CPUS_PER_TASK, 1)` seems good enough for me. Thanks!&lt;/p&gt;</comment>
                            <comment id="17010959" author="jiangxb1987" created="Wed, 8 Jan 2020 19:31:41 +0000"  >&lt;p&gt;Resolved by &lt;a href=&quot;https://github.com/apache/spark/pull/27126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/27126&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13269671">SPARK-29976</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 44 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0a674:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>