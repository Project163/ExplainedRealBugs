<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:56:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-21101] Error running Hive temporary UDTF on latest Spark 2.2</title>
                <link>https://issues.apache.org/jira/browse/SPARK-21101</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I&apos;m using temporary UDTFs on Spark 2.2, e.g.&lt;/p&gt;

&lt;p&gt;CREATE TEMPORARY FUNCTION myudtf AS &apos;com.foo.MyUdtf&apos; USING JAR &apos;hdfs:///path/to/udf.jar&apos;; &lt;/p&gt;

&lt;p&gt;But when I try to invoke it, I get the following error:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;17/06/14 19:43:50 ERROR SparkExecuteStatementOperation: Error running hive query:
org.apache.hive.service.cli.HiveSQLException: org.apache.spark.sql.AnalysisException: No handler for Hive UDF &apos;com.foo.MyUdtf&apos;: java.lang.NullPointerException; line 1 pos 7
        at org.apache.spark.sql.hive.thriftserver.SparkExecuteStatementOperation.org$apache$spark$sql$hive$thriftserver$SparkExecuteStatementOperation$$execute(SparkExecuteStatementOperation.scala:266)
        at org.apache.spark.sql.hive.thriftserver.SparkExecuteStatementOperation$$anon$1$$anon$2.run(SparkExecuteStatementOperation.scala:174)
        at org.apache.spark.sql.hive.thriftserver.SparkExecuteStatementOperation$$anon$1$$anon$2.run(SparkExecuteStatementOperation.scala:171)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAs(Subject.java:422)
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1698)
        at org.apache.spark.sql.hive.thriftserver.SparkExecuteStatementOperation$$anon$1.run(SparkExecuteStatementOperation.scala:184)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
        at java.util.concurrent.FutureTask.run(FutureTask.java:266)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
        at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Any help appreciated, thanks.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13079933">SPARK-21101</key>
            <summary>Error running Hive temporary UDTF on latest Spark 2.2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yumwang">Yuming Wang</assignee>
                                    <reporter username="dyzhou">Dayou Zhou</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Jun 2017 00:00:35 +0000</created>
                <updated>Wed, 25 Oct 2017 06:00:55 +0000</updated>
                            <resolved>Wed, 25 Oct 2017 06:00:55 +0000</resolved>
                                    <version>2.2.1</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16049883" author="maropu" created="Thu, 15 Jun 2017 01:17:15 +0000"  >&lt;p&gt;You just don&apos;t pass your uber-jar into spark? Or, you mean the query above worked well on previous spark?&lt;/p&gt;</comment>
                            <comment id="16049891" author="dyzhou" created="Thu, 15 Jun 2017 01:27:53 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maropu&quot; class=&quot;user-hover&quot; rel=&quot;maropu&quot;&gt;maropu&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;You just don&apos;t pass your uber-jar into spark? &lt;br/&gt;
Sorry not sure what you meant &amp;#8211; could you clarify your question?&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;Or, you mean the query above worked well on previous spark?&lt;br/&gt;
I did not try it with earlier versions, but likely the same behavior I think.&lt;/p&gt;</comment>
                            <comment id="16049892" author="maropu" created="Thu, 15 Jun 2017 01:30:00 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://www.mail-archive.com/user@spark.apache.org/msg61009.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.mail-archive.com/user@spark.apache.org/msg61009.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16049915" author="dyzhou" created="Thu, 15 Jun 2017 02:03:15 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maropu&quot; class=&quot;user-hover&quot; rel=&quot;maropu&quot;&gt;maropu&lt;/a&gt;, yes I saw this one, but in my case, I&apos;m using JDBC Thrift server to invoke the UDTF, not using Spark-shell.  So is there a way to pass my JAR to the Thrift server?&lt;/p&gt;</comment>
                            <comment id="16049977" author="maropu" created="Thu, 15 Jun 2017 04:14:19 +0000"  >&lt;p&gt;Since JIRA is not a place for questions, you better ask in spark-user. I&apos;ll close this because this does not seem to be a bug. If you find this is a bug, feel free to reopen this. Thanks.&lt;/p&gt;</comment>
                            <comment id="16050031" author="dyzhou" created="Thu, 15 Jun 2017 05:53:38 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maropu&quot; class=&quot;user-hover&quot; rel=&quot;maropu&quot;&gt;maropu&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; I&apos;ll close this because this seems to be a bug.&lt;/p&gt;

&lt;p&gt;This sounds bizarre, maybe you meant it wasn&apos;t a bug, but anyway, I did not start by asking a question, I started by reporting an error which is probably a bug.  What is your justification that it is NOT a bug and what is your justification of closing it as &apos;not a problem&apos; when you don&apos;t even seem to understand it?&lt;/p&gt;</comment>
                            <comment id="16050041" author="srowen" created="Thu, 15 Jun 2017 06:12:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dyzhou&quot; class=&quot;user-hover&quot; rel=&quot;dyzhou&quot;&gt;dyzhou&lt;/a&gt; did you read the link he posted?&lt;br/&gt;
This does not seem like a bug if you&apos;re not even passing your jar to the app. I would also close it.&lt;/p&gt;</comment>
                            <comment id="16050048" author="dyzhou" created="Thu, 15 Jun 2017 06:16:55 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sowen&quot; class=&quot;user-hover&quot; rel=&quot;sowen&quot;&gt;sowen&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; did you read the link he posted?&lt;/p&gt;

&lt;p&gt;Yes I did, but did you read my response?  &lt;/p&gt;

&lt;p&gt;I&apos;m not using spark shell, I&apos;m using spark thrift server, with USING JAR syntax:&lt;/p&gt;

&lt;p&gt;CREATE TEMPORARY FUNCTION myudtf AS &apos;com.foo.MyUdtf&apos; USING JAR &apos;hdfs:///path/to/udf.jar&apos;;&lt;/p&gt;</comment>
                            <comment id="16050111" author="zzr1000" created="Thu, 15 Jun 2017 07:47:05 +0000"  >&lt;p&gt;Hi  Dayou Zhou ,  Jira is a place to post an almost certain bug , not a place to ask question . From now ,the question you ask cannot be see as a bug . . .&lt;/p&gt;</comment>
                            <comment id="16050762" author="dyzhou" created="Thu, 15 Jun 2017 16:53:29 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhangzr1026&quot; class=&quot;user-hover&quot; rel=&quot;zhangzr1026&quot;&gt;zhangzr1026&lt;/a&gt;, I&apos;m still waiting for someone (anyone) to explain to me why this is not a bug, but whatever.  If this is how you treat people who love Spark, use Spark, and are trying to help make it better, than fine.&lt;/p&gt;</comment>
                            <comment id="16050774" author="srowen" created="Thu, 15 Jun 2017 17:01:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dyzhou&quot; class=&quot;user-hover&quot; rel=&quot;dyzhou&quot;&gt;dyzhou&lt;/a&gt; I see your reply. The thrift server should just be another job that is spark-submit-ted. So I think you can in fact use &lt;tt&gt;--jars&lt;/tt&gt; to add JARs to its classpath. That is what the guidance is getting at here. It is a bit more of a question therefore than JIRA issue, but I see why you&apos;re not convinced of that, but the way forward is to give the idea in that link a try next. &lt;/p&gt;

&lt;p&gt;Generally: I would only treat comments from committers or regular contributors as authoritative.&lt;/p&gt;</comment>
                            <comment id="16051017" author="dyzhou" created="Thu, 15 Jun 2017 20:26:53 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt;, thanks for the helpful and constructive comment.  So yes I have also tried starting STS using --jars option, i.e.&lt;/p&gt;

&lt;p&gt;./start-thriftserver.sh --jars /path/to/udf.jar&lt;/p&gt;

&lt;p&gt;and have also verified that by doing this, I no longer need to specify USING JAR when creating my udf, i.e.&lt;/p&gt;

&lt;p&gt;CREATE TEMPORARY FUNCTION myudtf AS &apos;com.foo.MyUdtf&apos;&lt;/p&gt;

&lt;p&gt;However, the bad news is that when I invoke the udf, I get exactly the same error as before, i.e.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; No handler for Hive UDF &apos;com.foo.MyUdtf&apos;: java.lang.NullPointerException; line 1 pos 7&lt;/p&gt;

&lt;p&gt;So I have reported what I wanted to report and I will leave the authorities to decide whether this is a bug or a &apos;question&apos; (even though I do have an opinion on which).  Thanks for your help.&lt;/p&gt;</comment>
                            <comment id="16053145" author="q79969786" created="Sun, 18 Jun 2017 09:48:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dyzhou&quot; class=&quot;user-hover&quot; rel=&quot;dyzhou&quot;&gt;dyzhou&lt;/a&gt;, Can you try to override &lt;a href=&quot;https://github.com/apache/hive/blob/release-2.0.0/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDTF.java#L70&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/release-2.0.0/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDTF.java#L70&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It works for me:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;add&lt;/span&gt; jar hdfs://nameservice1/tmp/wym/hive-&lt;span class=&quot;code-keyword&quot;&gt;exec&lt;/span&gt;-1.1.0-cdh5.4.3.jar;
&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TEMPORARY&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;FUNCTION&lt;/span&gt; spark_21101 &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.hadoop.hive.ql.udf.generic.GenericUDTFStack&apos;&lt;/span&gt;;
&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; spark_21101(2,&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;A&lt;/span&gt;&apos;&lt;/span&gt;,10,&lt;span class=&quot;code-keyword&quot;&gt;date&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;2015-01-01&apos;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&apos;B&apos;&lt;/span&gt;,20,&lt;span class=&quot;code-keyword&quot;&gt;date&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;2016-01-01&apos;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Ref: &lt;a href=&quot;https://github.com/apache/hive/blob/release-2.0.0/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDTFStack.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hive/blob/release-2.0.0/ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDTFStack.java&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16053501" author="dyzhou" created="Mon, 19 Jun 2017 05:54:08 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=q79969786&quot; class=&quot;user-hover&quot; rel=&quot;q79969786&quot;&gt;q79969786&lt;/a&gt;, thank you kindly for your response.  I was not aware of this &apos;other&apos; version of initialize() method, and will try your suggestion tomorrow.&lt;/p&gt;</comment>
                            <comment id="16053647" author="viirya" created="Mon, 19 Jun 2017 08:53:59 +0000"  >&lt;p&gt;&lt;del&gt;May I ask what Hive version your UDTF is based on?&lt;/del&gt; Nvm, might not very related.&lt;/p&gt;</comment>
                            <comment id="16073653" author="apachespark" created="Tue, 4 Jul 2017 13:16:05 +0000"  >&lt;p&gt;User &apos;wangyum&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18527&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18527&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12911966">HIVE-12377</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 20 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3gaif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>