<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:01:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-25454] Division between operands with negative scale can cause precision loss</title>
                <link>https://issues.apache.org/jira/browse/SPARK-25454</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The issue was originally reported by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bersprockets&quot; class=&quot;user-hover&quot; rel=&quot;bersprockets&quot;&gt;bersprockets&lt;/a&gt; here: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-22036?focusedCommentId=16618104&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-16618104&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-22036?focusedCommentId=16618104&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-16618104&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The problem consist in a precision loss when the second operand of the division is a decimal with a negative scale. It was present also before 2.3 but it was harder to reproduce: you had to do something like &lt;tt&gt;lit(BigDecimal(100e6))&lt;/tt&gt;, while now this can happen more frequently with SQL constants.&lt;/p&gt;

&lt;p&gt;The problem is that our logic is taken from Hive and SQLServer where decimals with negative scales are not allowed. We might also consider enforcing this too in 3.0 eventually. Meanwhile we can fix the logic for computing the result type for a division.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13185809">SPARK-25454</key>
            <summary>Division between operands with negative scale can cause precision loss</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="4">Incomplete</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mgaido">Marco Gaido</reporter>
                        <labels>
                            <label>bulk-closed</label>
                    </labels>
                <created>Tue, 18 Sep 2018 13:44:36 +0000</created>
                <updated>Tue, 25 May 2021 01:51:44 +0000</updated>
                            <resolved>Tue, 25 May 2021 01:38:43 +0000</resolved>
                                    <version>2.3.0</version>
                    <version>2.3.1</version>
                                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16619911" author="bersprockets" created="Wed, 19 Sep 2018 00:12:25 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgaido&quot; class=&quot;user-hover&quot; rel=&quot;mgaido&quot;&gt;mgaido&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;OK, so the way I understand it&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;negative scales are the problem&lt;/li&gt;
	&lt;li&gt;they were also a problem in 2.2, but it was more difficult to reproduce. For my example case (in the referenced Jira), the change to the promotion of literal 1000 in 2.3 exposed an existing issue with the handling of 1e6.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This bears out, in that when I replace 1e6 with 1000000, the issue goes away (at least for my example case):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;scala&amp;gt; sql(&quot;select 26393499451/(1000000 * 1000) as c1&quot;).show
+------------+
|          c1|
+------------+
|26.393499451|
+------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16620192" author="mgaido" created="Wed, 19 Sep 2018 06:45:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bersprockets&quot; class=&quot;user-hover&quot; rel=&quot;bersprockets&quot;&gt;bersprockets&lt;/a&gt; you&apos;re right, the only &quot;wrong&quot; thing of your statements is that the problem is not about 1000 but about 1e6, which in 2.2 was considered a decimal(10, 0) and now it is parsed as a decimal(1, -6). You could reproduce the same issue using &lt;tt&gt;lit(BigDecimal(1e6))&lt;/tt&gt; in 2.2. So the problem is that we are not handling properly decimals with negative scale, but we are not forbidding their existence either, hence the issue. Making more common the presence of negative scale numbers made the issue more evident. Hope this is clear. Thanks.&lt;/p&gt;</comment>
                            <comment id="16623192" author="apachespark" created="Fri, 21 Sep 2018 07:28:26 +0000"  >&lt;p&gt;User &apos;mgaido91&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22450&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22450&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16623194" author="apachespark" created="Fri, 21 Sep 2018 07:29:01 +0000"  >&lt;p&gt;User &apos;mgaido91&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22450&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22450&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16623710" author="apachespark" created="Fri, 21 Sep 2018 14:35:00 +0000"  >&lt;p&gt;User &apos;cloud-fan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22494&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22494&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16629593" author="cloud_fan" created="Thu, 27 Sep 2018 01:02:04 +0000"  >&lt;p&gt;I&apos;m reopening it, since the bug is not fully fixed. But we do have a workaround now: setting &lt;tt&gt;spark.sql.legacy.literal.pickMinimumPrecision&lt;/tt&gt; to false.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3y7on:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>