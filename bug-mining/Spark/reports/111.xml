<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:12:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-1203] spark-shell on yarn-client race in properly getting hdfs delegation tokens</title>
                <link>https://issues.apache.org/jira/browse/SPARK-1203</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;There seems to be a race when using the spark-shell on yarn (yarn-client mode) as to when it gets the hdfs delegation tokens.  &lt;/p&gt;

&lt;p&gt;It appears to be that if  you do an action that causes it to get a delegation token before the workers are launched things work fine, if you want until after the workers launch you get an error about not having a delegation token.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12704809">SPARK-1203</key>
            <summary>spark-shell on yarn-client race in properly getting hdfs delegation tokens</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tgraves">Thomas Graves</assignee>
                                    <reporter username="tgraves">Thomas Graves</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Mar 2014 11:31:02 +0000</created>
                <updated>Thu, 9 Apr 2015 12:05:50 +0000</updated>
                            <resolved>Wed, 19 Mar 2014 08:07:28 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>0.9.1</fixVersion>
                    <fixVersion>1.0.0</fixVersion>
                                    <component>YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13954003" author="tgraves" created="Fri, 7 Mar 2014 11:57:33 +0000"  >&lt;p&gt;So this appears to have been something environment related.  Or perhaps the KDC was having issues.  I can&apos;t reproduce it now.&lt;/p&gt;</comment>
                            <comment id="13954073" author="bcwalrus" created="Fri, 14 Mar 2014 18:20:12 +0000"  >&lt;p&gt;I just hit something like this, an intermittent failure with HdfsTest in yarn-client mode. Tom, does your error look like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;14/03/14 17:57:15 INFO cluster.YarnClientSchedulerBackend: Application report from ASM:
         appMasterRpcPort: 0
         appStartTime: 1394845025101
         yarnAppState: RUNNING

14/03/14 17:57:17 INFO cluster.YarnClientClusterScheduler: YarnClientClusterScheduler.postStartHook done
14/03/14 17:57:17 INFO storage.MemoryStore: ensureFreeSpace(215427) called with curMem=0, maxMem=1383491174
14/03/14 17:57:17 INFO storage.MemoryStore: Block broadcast_0 stored as values to memory (estimated size 210.4 KB, free 1319.2 MB)
Exception in thread &quot;main&quot; org.apache.hadoop.ipc.RemoteException(java.io.IOException): Delegation Token can be issued only with kerberos or web authentication
        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getDelegationToken(FSNamesystem.java:6211)
        at org.apache.hadoop.hdfs.server.namenode.NameNodeRpcServer.getDelegationToken(NameNodeRpcServer.java:461)
        ...
        at org.apache.hadoop.hdfs.DFSClient.getDelegationToken(DFSClient.java:920)
        at org.apache.hadoop.hdfs.DistributedFileSystem.getDelegationToken(DistributedFileSystem.java:1336)
        at org.apache.hadoop.fs.FileSystem.collectDelegationTokens(FileSystem.java:527)
        at org.apache.hadoop.fs.FileSystem.addDelegationTokens(FileSystem.java:505)
        at org.apache.hadoop.mapreduce.security.TokenCache.obtainTokensForNamenodesInternal(TokenCache.java:121)
        at org.apache.hadoop.mapreduce.security.TokenCache.obtainTokensForNamenodesInternal(TokenCache.java:100)
        at org.apache.hadoop.mapreduce.security.TokenCache.obtainTokensForNamenodes(TokenCache.java:80)
        at org.apache.hadoop.mapred.FileInputFormat.listStatus(FileInputFormat.java:202)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13954101" author="tgraves" created="Mon, 17 Mar 2014 06:12:21 +0000"  >&lt;p&gt;I&apos;ll give it a try again today to see if I can reproduce also.&lt;/p&gt;</comment>
                            <comment id="13954120" author="tgraves" created="Tue, 18 Mar 2014 08:17:29 +0000"  >&lt;p&gt;Ok I&apos;m able to reproduce it again.  Debbugging it.&lt;/p&gt;</comment>
                            <comment id="13954059" author="tgraves" created="Tue, 18 Mar 2014 12:03:36 +0000"  >&lt;p&gt;So I was able to reproduce this issue when doing a saveAsTextFile on the client.  If you wait for a while before doing anything I was hitting this.  If you do operations immediately it doesn&apos;t happen.    It looks like we aren&apos;t propogating the credentials properly. &lt;/p&gt;

&lt;p&gt;I have not been able to reproduce it running HdfsTest.  That is a different case since your reading the file.  That should be propogating the credentials in SparkContext.hadoopRDD.  if you have more details please let me know.   You are sure you were kinit&apos;d?&lt;/p&gt;</comment>
                            <comment id="13954127" author="tgraves" created="Tue, 18 Mar 2014 12:41:21 +0000"  >&lt;p&gt;Note the reason this works if you do it quickly is because the original connection to the namenode is up and it reuses it.&lt;/p&gt;</comment>
                            <comment id="13954076" author="tgraves" created="Tue, 18 Mar 2014 12:44:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/pull/173&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/173&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13954085" author="bcwalrus" created="Wed, 19 Mar 2014 13:38:07 +0000"  >&lt;p&gt;I found out why I was having problem with HdfsTest. I was integrating on 0.9 and missed the changes that set YARN_CLIENT_MODE in a couple of places. I got that working. And I also verified the fix for this bug. Thanks a lot, Tom!&lt;/p&gt;</comment>
                            <comment id="14487262" author="gu chi" created="Thu, 9 Apr 2015 12:05:50 +0000"  >&lt;p&gt;Seems I meet with the similar issue using saveAsNewAPIHadoopDataset&lt;br/&gt;
I tried to reproduce with create SC and then sleep for 10mins, then do saveAsNewAPIHadoopDataset, still not able to reproduce, can u give some advice on how to reproduce, thx&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>382962</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tz73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>383230</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>