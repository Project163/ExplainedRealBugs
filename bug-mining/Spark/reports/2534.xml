<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:33:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-10987] yarn-client mode misbehaving with netty-based RPC backend</title>
                <link>https://issues.apache.org/jira/browse/SPARK-10987</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;YARN running in cluster deploy mode seems to be having issues with the new RPC backend; if you look at unit test runs, tests that run in cluster mode are taking several minutes to run, instead of the more usual 20-30 seconds.&lt;/p&gt;

&lt;p&gt;For example, &lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/43349/consoleFull:&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/43349/consoleFull:&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[info] YarnClusterSuite:
[info] - run Spark in yarn-client mode (13 seconds, 953 milliseconds)
[info] - run Spark in yarn-cluster mode (6 minutes, 50 seconds)
[info] - run Spark in yarn-cluster mode unsuccessfully (1 minute, 53 seconds)
[info] - run Python application in yarn-client mode (21 seconds, 842 milliseconds)
[info] - run Python application in yarn-cluster mode (7 minutes, 0 seconds)
[info] - user class path first in client mode (1 minute, 58 seconds)
[info] - user class path first in cluster mode (4 minutes, 49 seconds)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12903158">SPARK-10987</key>
            <summary>yarn-client mode misbehaving with netty-based RPC backend</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vanzin">Marcelo Masiero Vanzin</assignee>
                                    <reporter username="vanzin">Marcelo Masiero Vanzin</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Oct 2015 22:33:04 +0000</created>
                <updated>Thu, 8 Oct 2015 16:48:36 +0000</updated>
                            <resolved>Thu, 8 Oct 2015 16:48:36 +0000</resolved>
                                    <version>1.6.0</version>
                                    <fixVersion>1.6.0</fixVersion>
                                    <component>Spark Core</component>
                    <component>YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14947738" author="vanzin" created="Wed, 7 Oct 2015 22:46:22 +0000"  >&lt;p&gt;It may not be cluster mode per se; I ran the tests locally and the cluster mode test seems to not be running at all, because there&apos;s still a container from the previous test running, stuck at this place:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;main&quot; prio=10 tid=0x00007f1554017800 nid=0x3d2d waiting on condition [0x00007f155d326000]
   java.lang.Thread.State: TIMED_WAITING (parking)
        at sun.misc.Unsafe.park(Native Method)
        - parking to wait for  &amp;lt;0x00000000f9893fd0&amp;gt; (a scala.concurrent.impl.Promise$CompletionLatch)
        at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:226)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedNanos(AbstractQueuedSynchronizer.java:1033)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.tryAcquireSharedNanos(AbstractQueuedSynchronizer.java:1326)
        at scala.concurrent.impl.Promise$DefaultPromise.tryAwait(Promise.scala:208)
        at scala.concurrent.impl.Promise$DefaultPromise.ready(Promise.scala:218)
        at scala.concurrent.impl.Promise$DefaultPromise.result(Promise.scala:223)
        at scala.concurrent.Await$$anonfun$result$1.apply(package.scala:107)
        at scala.concurrent.BlockContext$DefaultBlockContext$.blockOn(BlockContext.scala:53)
        at scala.concurrent.Await$.result(package.scala:107)
        at org.apache.spark.rpc.RpcTimeout.awaitResult(RpcEnv.scala:242)
        at org.apache.spark.rpc.RpcEnv.setupEndpointRefByURI(RpcEnv.scala:99)
        at org.apache.spark.executor.CoarseGrainedExecutorBackend$$anonfun$run$1.apply$mcV$sp(CoarseGrainedExecutorBackend.scala:162)
        at org.apache.spark.deploy.SparkHadoopUtil$$anon$1.run(SparkHadoopUtil.scala:69)
        at org.apache.spark.deploy.SparkHadoopUtil$$anon$1.run(SparkHadoopUtil.scala:68)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAs(Subject.java:415)
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1614)
        at org.apache.spark.deploy.SparkHadoopUtil.runAsSparkUser(SparkHadoopUtil.scala:68)
        at org.apache.spark.executor.CoarseGrainedExecutorBackend$.run(CoarseGrainedExecutorBackend.scala:149)
        at org.apache.spark.executor.CoarseGrainedExecutorBackend$.main(CoarseGrainedExecutorBackend.scala:250)
        at org.apache.spark.executor.CoarseGrainedExecutorBackend.main(CoarseGrainedExecutorBackend.scala)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14947743" author="vanzin" created="Wed, 7 Oct 2015 22:49:17 +0000"  >&lt;p&gt;The &lt;tt&gt;ExecutorRunnable&lt;/tt&gt; process (client-mode AM) was also running at the time, although I didn&apos;t notice anything interesting in the stack trace.&lt;/p&gt;</comment>
                            <comment id="14947788" author="vanzin" created="Wed, 7 Oct 2015 23:16:38 +0000"  >&lt;p&gt;Hmm. I think I know what&apos;s going on, just not how. In client mode, the AM relies on the driver disconnect event (ApplicationMaster.scala, &lt;tt&gt;AMEndpoint::onDisconnected&lt;/tt&gt;) to shut itself down. But that event does not seem to be arriving for some reason, so the AM sticks around and doesn&apos;t die until many executors are launched, fail to connect to the driver, and finally the maximum number of executor failures is reached.&lt;/p&gt;

&lt;p&gt;So just need to figure out why &lt;tt&gt;onDisconnected&lt;/tt&gt; is not being called here.&lt;/p&gt;</comment>
                            <comment id="14947893" author="vanzin" created="Thu, 8 Oct 2015 00:56:13 +0000"  >&lt;p&gt;Anyway, here&apos;s what I found so far.&lt;/p&gt;

&lt;p&gt;Driver launches AM; AM connects back to driver and sends stuff. But driver never sends any messages to AM. That means that in &lt;tt&gt;NettyRpcHandler::connectionTerminated&lt;/tt&gt;, the &lt;tt&gt;Disassociated&lt;/tt&gt; message is not sent, because since no message was sent &lt;b&gt;to&lt;/b&gt; to the AM, the code in &lt;tt&gt;NettyRpcHandler::receive&lt;/tt&gt; was never run, so the driver connection was never recorded.&lt;/p&gt;

&lt;p&gt;So there must be a way for &lt;tt&gt;NettyRpcHandler&lt;/tt&gt; to know when outgoing connections are killed, not just incoming ones.&lt;/p&gt;

&lt;p&gt;In a way this is caused by the code trying to mimic what akka does, but failing at it; since the AM is purely a client, it shouldn&apos;t need to listen for connections and rely on incoming connections for anything - it should be able to register itself and do everything using the client socket it opened. That&apos;s probably going to be tricky to fix, though.&lt;/p&gt;</comment>
                            <comment id="14947994" author="apachespark" created="Thu, 8 Oct 2015 02:54:02 +0000"  >&lt;p&gt;User &apos;vanzin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9021&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9021&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mpuf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>