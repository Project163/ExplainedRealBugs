<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:29:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-2645] Spark driver calls System.exit(50) after calling SparkContext.stop() the second time </title>
                <link>https://issues.apache.org/jira/browse/SPARK-2645</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;In some cases my application calls SparkContext.stop() after it has already stopped and this leads to stopping JVM that runs spark driver.&lt;br/&gt;
E.g&lt;br/&gt;
This program should run forever&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;JavaSparkContext context = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JavaSparkContext(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark:&lt;span class=&quot;code-comment&quot;&gt;//12.34.21.44:7077&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;DummyApp&quot;&lt;/span&gt;);
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            JavaRDD&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; rdd = context.parallelize(Arrays.asList(1, 2, 3));
            rdd.count();
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {
            e.printStackTrace();
        }
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            context.cancelAllJobs();
            context.stop();
            &lt;span class=&quot;code-comment&quot;&gt;//call stop second time
&lt;/span&gt;            context.stop();
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {
            e.printStackTrace();
        }
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().join();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but it finishes with exit code 50 after calling SparkContext.stop() the second time.&lt;br/&gt;
Also it throws an exception like this&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.spark.ServerStateException: Server is already stopped
	at org.apache.spark.HttpServer.stop(HttpServer.scala:122) ~[spark-core_2.10-1.0.0.jar:1.0.0]
	at org.apache.spark.HttpFileServer.stop(HttpFileServer.scala:48) ~[spark-core_2.10-1.0.0.jar:1.0.0]
	at org.apache.spark.SparkEnv.stop(SparkEnv.scala:81) ~[spark-core_2.10-1.0.0.jar:1.0.0]
	at org.apache.spark.SparkContext.stop(SparkContext.scala:984) ~[spark-core_2.10-1.0.0.jar:1.0.0]
	at org.apache.spark.scheduler.cluster.SparkDeploySchedulerBackend.dead(SparkDeploySchedulerBackend.scala:92) ~[spark-core_2.10-1.0.0.jar:1.0.0]
	at org.apache.spark.deploy.client.AppClient$ClientActor.markDead(AppClient.scala:178) ~[spark-core_2.10-1.0.0.jar:1.0.0]
	at org.apache.spark.deploy.client.AppClient$ClientActor$$anonfun$registerWithMaster$1$$anonfun$apply$mcV$sp$1.apply$mcV$sp(AppClient.scala:96) ~[spark-core_2.10-1.0.0.jar:1.0.0]
	at org.apache.spark.util.Utils$.tryOrExit(Utils.scala:790) ~[spark-core_2.10-1.0.0.jar:1.0.0]
	at org.apache.spark.deploy.client.AppClient$ClientActor$$anonfun$registerWithMaster$1.apply$mcV$sp(AppClient.scala:91) [spark-core_2.10-1.0.0.jar:1.0.0]
	at akka.actor.Scheduler$$anon$9.run(Scheduler.scala:80) [akka-actor_2.10-2.2.3-shaded-protobuf.jar:na]
	at akka.actor.LightArrayRevolverScheduler$$anon$3$$anon$2.run(Scheduler.scala:241) [akka-actor_2.10-2.2.3-shaded-protobuf.jar:na]
	at akka.dispatch.TaskInvocation.run(AbstractDispatcher.scala:42) [akka-actor_2.10-2.2.3-shaded-protobuf.jar:na]
	at akka.dispatch.ForkJoinExecutorConfigurator$AkkaForkJoinTask.exec(AbstractDispatcher.scala:386) [akka-actor_2.10-2.2.3-shaded-protobuf.jar:na]
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260) [scala-library-2.10.4.jar:na]
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339) [scala-library-2.10.4.jar:na]
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979) [scala-library-2.10.4.jar:na]
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107) [scala-library-2.10.4.jar:na]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;One remark is that this behavior is only reproducible when I call SparkContext.cancellAllJobs() before calling SparkContext.stop()&lt;/p&gt;</description>
                <environment></environment>
        <key id="12729142">SPARK-2645</key>
            <summary>Spark driver calls System.exit(50) after calling SparkContext.stop() the second time </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rekhajoshm">Rekha Joshi</assignee>
                                    <reporter username="vokom">Vlad Komarov</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Jul 2014 10:58:36 +0000</created>
                <updated>Tue, 30 Jun 2015 21:00:13 +0000</updated>
                            <resolved>Tue, 30 Jun 2015 21:00:00 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14289654" author="srowen" created="Fri, 23 Jan 2015 18:19:08 +0000"  >&lt;p&gt;Is this still an issue? I do not see any call to &lt;tt&gt;System.exit(50)&lt;/tt&gt; anymore.&lt;/p&gt;</comment>
                            <comment id="14291046" author="vokom" created="Sun, 25 Jan 2015 11:19:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sowen&quot; class=&quot;user-hover&quot; rel=&quot;sowen&quot;&gt;sowen&lt;/a&gt;, are you using the same spark master url that is mentioned in the code snippet (&quot;spark://12.34.21.44:7077&quot; or just spark://invalid.host:7077) ? &lt;br/&gt;
Now it exits with exit code 1. &lt;/p&gt;</comment>
                            <comment id="14291072" author="srowen" created="Sun, 25 Jan 2015 12:17:18 +0000"  >&lt;p&gt;Just checking if you believe this is still an issue, since I don&apos;t see any code that exits with status 50 as mentioned in the description. I have not tested this at all myself. If it&apos;s still a problem, is the fix simply to handle multiple calls to &lt;tt&gt;stop()&lt;/tt&gt; better?&lt;/p&gt;</comment>
                            <comment id="14598859" author="apachespark" created="Wed, 24 Jun 2015 04:44:04 +0000"  >&lt;p&gt;User &apos;rekhajoshm&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/6973&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/6973&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14598862" author="rekhajoshm" created="Wed, 24 Jun 2015 04:47:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sowen&quot; class=&quot;user-hover&quot; rel=&quot;sowen&quot;&gt;sowen&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vokom&quot; class=&quot;user-hover&quot; rel=&quot;vokom&quot;&gt;vokom&lt;/a&gt; Hi. On a quick look, with my setup latest 1.5.0-SNAPSHOT., I believe this can still happen.&lt;br/&gt;
If Executor hits on an unhandled exception, the system will exit with code 50 (SparkExitCode.UNCAUGHT_EXCEPTION)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;//SparkUncaughtExceptionHandler//
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!Utils.inShutdown()) {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (exception.isInstanceOf[OutOfMemoryError]) {
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.exit(SparkExitCode.OOM)
  } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.exit(SparkExitCode.UNCAUGHT_EXCEPTION)
  }
}
.. . 
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt;[spark] object SparkExitCode {
  &lt;span class=&quot;code-comment&quot;&gt;/** The &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; uncaught exception handler was reached. */&lt;/span&gt;
  val UNCAUGHT_EXCEPTION = 50
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Git patch is to defensively avoid a stop if already done and/or handling exception at SparkEnv.Please review.Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>407216</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 21 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1y2nr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>407232</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332078">1.5.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>