<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:38:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-7483] [MLLib] Using Kryo with FPGrowth fails with an exception</title>
                <link>https://issues.apache.org/jira/browse/SPARK-7483</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When using FPGrowth algorithm with KryoSerializer - Spark fails with&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Job aborted due to stage failure: Task 0 in stage 9.0 failed 1 times, most recent failure: Lost task 0.0 in stage 9.0 (TID 16, localhost): com.esotericsoftware.kryo.KryoException: java.lang.IllegalArgumentException: Can not set &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; scala.collection.mutable.ListBuffer field org.apache.spark.mllib.fpm.FPTree$Summary.nodes to scala.collection.mutable.ArrayBuffer
Serialization trace:
nodes (org.apache.spark.mllib.fpm.FPTree$Summary)
org$apache$spark$mllib$fpm$FPTree$$summaries (org.apache.spark.mllib.fpm.FPTree)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This can be easily reproduced in spark codebase by setting &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;conf.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark.serializer&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.spark.serializer.KryoSerializer&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; and running FPGrowthSuite.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12828334">SPARK-7483</key>
            <summary>[MLLib] Using Kryo with FPGrowth fails with an exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mark_yang">Mark Yang</assignee>
                                    <reporter username="kretes">Tomasz Bartczak</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 May 2015 11:53:23 +0000</created>
                <updated>Fri, 19 Jan 2018 20:36:28 +0000</updated>
                            <resolved>Sat, 27 Feb 2016 13:51:22 +0000</resolved>
                                    <version>1.3.1</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>MLlib</component>
                        <due></due>
                            <votes>4</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="14535562" author="josephkb" created="Fri, 8 May 2015 21:21:23 +0000"  >&lt;p&gt;(Updated) Maybe this is a bug...will look into it.&lt;/p&gt;</comment>
                            <comment id="14535577" author="josephkb" created="Fri, 8 May 2015 21:25:52 +0000"  >&lt;p&gt;Does it fix anything if you give Kryo more info, such as explicit registration of relevant classes?&lt;/p&gt;</comment>
                            <comment id="14537762" author="kretes" created="Mon, 11 May 2015 09:30:44 +0000"  >&lt;p&gt;hmm, class org.apache.spark.mllib.fpm.FPTree is private and in spark-mllib. Spark is registering classes in spark-core in org.apache.spark.serializer.KryoSerializer#toRegister so it is not straightforward how to do that easily.&lt;/p&gt;

&lt;p&gt;And I do not think this is the case of registering, looking at spark serialization doc &quot;Finally, if you don&#8217;t register your custom classes, Kryo will still work, but it will have to store the full class name with each object, which is wasteful.&quot;&lt;/p&gt;</comment>
                            <comment id="14538288" author="josephkb" created="Mon, 11 May 2015 17:56:29 +0000"  >&lt;p&gt;I agree; it should work, but I&apos;m not sure why it&apos;s failing.  I&apos;m not that familiar with Kryo, but I&apos;ll ask around.  Thanks for reporting this!&lt;/p&gt;</comment>
                            <comment id="14611347" author="kralph" created="Thu, 2 Jul 2015 02:27:03 +0000"  >&lt;p&gt;I encountered the same bug.&lt;br/&gt;
Adding &lt;br/&gt;
sparkConf.registerKryoClasses(Array(classOf[ArrayBuffer&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;], classOf[ListBuffer&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;]))&lt;br/&gt;
seems to fix the problem.&lt;/p&gt;</comment>
                            <comment id="14612060" author="kretes" created="Thu, 2 Jul 2015 15:13:10 +0000"  >&lt;p&gt;this solves the problem for me as well.&lt;/p&gt;

&lt;p&gt;maybe those classes should be registered in kryo from spark when user code is using kryo serialization?&lt;/p&gt;</comment>
                            <comment id="14612673" author="kralph" created="Thu, 2 Jul 2015 23:24:16 +0000"  >&lt;p&gt;This does NOT work.&lt;/p&gt;

&lt;p&gt;Registering the classes stops it from crashing, but produces a bug in the FP-Growth algorithm.&lt;/p&gt;

&lt;p&gt;Specifically, the frequency counts for itemsets are wrong.&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14612929" author="kretes" created="Fri, 3 Jul 2015 07:12:22 +0000"  >&lt;p&gt;hmm that&apos;s right - adding it in FPGrowthSuite in spark fails first spec.&lt;/p&gt;</comment>
                            <comment id="14614421" author="sunrenxu" created="Sun, 5 Jul 2015 22:14:35 +0000"  >&lt;p&gt;I&apos;ve tried to change the nodes property of Summay class inside object FPTree from ListBuffer to ArrayBuffer. And it seems to fix the exception problem as well as producing the right item counts so far. Suspect the problem with KryoSerializer dealing with ListBuffer class, but haven&apos;t looked into details.  The code looks like:&lt;/p&gt;

&lt;p&gt;private&lt;span class=&quot;error&quot;&gt;&amp;#91;fpm&amp;#93;&lt;/span&gt; object FPTree {&lt;/p&gt;

&lt;p&gt;  /** Representing a node in an FP-Tree. */&lt;br/&gt;
  class Node&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;(val parent: Node&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;) extends Serializable &lt;/p&gt;
{
    var item: T = _
    var count: Long = 0L
    val children: mutable.Map[T, Node[T]] = mutable.Map.empty

    def isRoot: Boolean = parent == null
  }

&lt;p&gt;  /** Summary of a item in an FP-Tree. */&lt;br/&gt;
  private class Summary&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt; extends Serializable &lt;/p&gt;
{
    var count: Long = 0L
    val nodes: mutable.ArrayBuffer[Node[T]] = mutable.ArrayBuffer.empty
  }
&lt;p&gt;}&lt;/p&gt;
</comment>
                            <comment id="14906222" author="simonlou" created="Thu, 24 Sep 2015 11:32:29 +0000"  >&lt;p&gt;kyro not support ListBuffer because ListBuffer don&apos;t have any &quot;zero argument constructor&quot;.&lt;br/&gt;
refer to : &lt;a href=&quot;https://github.com/EsotericSoftware/kryo#using-standard-java-serialization&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/EsotericSoftware/kryo#using-standard-java-serialization&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&quot;By default, if a class has a zero argument constructor then it is invoked via ReflectASM or reflection, otherwise an exception is thrown. &quot;&lt;/p&gt;

&lt;p&gt;Is that the reason?&lt;/p&gt;

&lt;p&gt;When using kyro , use ArrayBuffer instead of ListBuffer&lt;/p&gt;</comment>
                            <comment id="15129631" author="apachespark" created="Wed, 3 Feb 2016 02:20:03 +0000"  >&lt;p&gt;User &apos;mark800&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/11041&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/11041&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15129636" author="kaiyuan yang" created="Wed, 3 Feb 2016 02:24:05 +0000"  >&lt;p&gt;Upgrade Chill to 0.7.2, then everything is fine.&lt;/p&gt;

&lt;p&gt;New version registers more Scala classes, including ListBuffer to support Kryo with FPGrowth.&lt;/p&gt;</comment>
                            <comment id="15170594" author="srowen" created="Sat, 27 Feb 2016 13:51:22 +0000"  >&lt;p&gt;Issue resolved by pull request 11041&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/11041&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/11041&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 38 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2eh4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>