<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:24:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-5949] Driver program has to register roaring bitmap classes used by spark with Kryo when number of partitions is greater than 2000</title>
                <link>https://issues.apache.org/jira/browse/SPARK-5949</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When more than 2000 partitions are being used with Kryo, the following classes need to be registered by driver program:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;org.apache.spark.scheduler.HighlyCompressedMapStatus&lt;/li&gt;
	&lt;li&gt;org.roaringbitmap.RoaringBitmap&lt;/li&gt;
	&lt;li&gt;org.roaringbitmap.RoaringArray&lt;/li&gt;
	&lt;li&gt;org.roaringbitmap.ArrayContainer&lt;/li&gt;
	&lt;li&gt;org.roaringbitmap.RoaringArray$Element&lt;/li&gt;
	&lt;li&gt;org.roaringbitmap.RoaringArray$Element[]&lt;/li&gt;
	&lt;li&gt;short[]&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Our project doesn&apos;t have dependency on roaring bitmap and HighlyCompressedMapStatus is intended for internal spark usage. Spark should take care of this registration when Kryo is used.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12776848">SPARK-5949</key>
            <summary>Driver program has to register roaring bitmap classes used by spark with Kryo when number of partitions is greater than 2000</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="irashid">Imran Rashid</assignee>
                                    <reporter username="ptorok">Peter Torok</reporter>
                        <labels>
                            <label>kryo</label>
                            <label>partitioning</label>
                            <label>serialization</label>
                    </labels>
                <created>Mon, 23 Feb 2015 14:35:58 +0000</created>
                <updated>Fri, 9 Oct 2015 03:11:24 +0000</updated>
                            <resolved>Tue, 3 Mar 2015 23:33:42 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14345259" author="apachespark" created="Tue, 3 Mar 2015 16:14:24 +0000"  >&lt;p&gt;User &apos;squito&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/4877&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/4877&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14345379" author="ptorok" created="Tue, 3 Mar 2015 17:33:49 +0000"  >&lt;p&gt;Actually, there were two more classes discovered to be registered when running massive jobs:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;long[]&lt;/li&gt;
	&lt;li&gt;org.roaringbitmap.BitmapContainer&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Could you please add these two classes in order to avoid further issues?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;</comment>
                            <comment id="14345696" author="irashid" created="Tue, 3 Mar 2015 20:38:09 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ptorok&quot; class=&quot;user-hover&quot; rel=&quot;ptorok&quot;&gt;ptorok&lt;/a&gt;.  I&apos;ve updated the PR.  Can you take a quick look?  I came up with a better test case that covered both types of containers.&lt;/p&gt;

&lt;p&gt;Also, would you mind posting a bit of the error you get here as well?  it might help other users discover this issue and see the fix.&lt;/p&gt;</comment>
                            <comment id="14346694" author="ptorok" created="Wed, 4 Mar 2015 10:26:14 +0000"  >&lt;p&gt;Hi Imran,&lt;/p&gt;

&lt;p&gt;I&apos;m getting the following error if a class is not registered with kryo:&lt;/p&gt;

&lt;p&gt;java.lang.IllegalArgumentException: Class is not registered: org.apache.spark.scheduler.HighlyCompressedMapStatus&lt;br/&gt;
Note: To register this class use: kryo.register(org.apache.spark.scheduler.HighlyCompressedMapStatus.class);&lt;br/&gt;
	at com.esotericsoftware.kryo.Kryo.getRegistration(Kryo.java:442)&lt;br/&gt;
	at com.esotericsoftware.kryo.util.DefaultClassResolver.writeClass(DefaultClassResolver.java:79)&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;In this case, the registrator class needs to be extended by registering the mentioned class. If more classes are involved this need to be done iteratively while getting the exception.&lt;/p&gt;

&lt;p&gt;Regarding to the PR, I don&apos;t see the Array&lt;span class=&quot;error&quot;&gt;&amp;#91;Long&amp;#93;&lt;/span&gt; is registered. If it&apos;s registered elsewhere, it&apos;s fine. If not, it should be added.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Peter&lt;/p&gt;</comment>
                            <comment id="14346825" author="irashid" created="Wed, 4 Mar 2015 12:20:36 +0000"  >&lt;p&gt;Thanks Peter.  &lt;tt&gt;Array[Long]&lt;/tt&gt; is there, don&apos;t worry: &lt;a href=&quot;https://github.com/apache/spark/pull/4877/files#diff-1f81c62dad0e2dfc387a974bb08c497cR216&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/4877/files#diff-1f81c62dad0e2dfc387a974bb08c497cR216&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14949518" author="drcrallen" created="Thu, 8 Oct 2015 22:26:06 +0000"  >&lt;p&gt;This breaks when using more recent versions of Roaring where org.roaringbitmap.RoaringArray$Element is no longer present. The following stack trace appears:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;A needed &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;was not found. This could be due to an error in your runpath. Missing class: org/roaringbitmap/RoaringArray$Element
java.lang.NoClassDefFoundError: org/roaringbitmap/RoaringArray$Element
	at org.apache.spark.serializer.KryoSerializer$.&amp;lt;init&amp;gt;(KryoSerializer.scala:338)
	at org.apache.spark.serializer.KryoSerializer$.&amp;lt;clinit&amp;gt;(KryoSerializer.scala)
	at org.apache.spark.serializer.KryoSerializer.newKryo(KryoSerializer.scala:93)
	at org.apache.spark.serializer.KryoSerializerInstance.borrowKryo(KryoSerializer.scala:237)
	at org.apache.spark.serializer.KryoSerializerInstance.&amp;lt;init&amp;gt;(KryoSerializer.scala:222)
	at org.apache.spark.serializer.KryoSerializer.newInstance(KryoSerializer.scala:138)
	at org.apache.spark.broadcast.TorrentBroadcast$.blockifyObject(TorrentBroadcast.scala:201)
	at org.apache.spark.broadcast.TorrentBroadcast.writeBlocks(TorrentBroadcast.scala:102)
	at org.apache.spark.broadcast.TorrentBroadcast.&amp;lt;init&amp;gt;(TorrentBroadcast.scala:85)
	at org.apache.spark.broadcast.TorrentBroadcastFactory.newBroadcast(TorrentBroadcastFactory.scala:34)
	at org.apache.spark.broadcast.BroadcastManager.newBroadcast(BroadcastManager.scala:63)
	at org.apache.spark.SparkContext.broadcast(SparkContext.scala:1318)
	at org.apache.spark.SparkContext$$anonfun$hadoopFile$1.apply(SparkContext.scala:1006)
	at org.apache.spark.SparkContext$$anonfun$hadoopFile$1.apply(SparkContext.scala:1003)
	at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:147)
	at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:108)
	at org.apache.spark.SparkContext.withScope(SparkContext.scala:700)
	at org.apache.spark.SparkContext.hadoopFile(SparkContext.scala:1003)
	at org.apache.spark.SparkContext$$anonfun$textFile$1.apply(SparkContext.scala:818)
	at org.apache.spark.SparkContext$$anonfun$textFile$1.apply(SparkContext.scala:816)
	at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:147)
	at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:108)
	at org.apache.spark.SparkContext.withScope(SparkContext.scala:700)
	at org.apache.spark.SparkContext.textFile(SparkContext.scala:816)
	at io.druid.indexer.spark.SparkDruidIndexer$$anonfun$2.apply(SparkDruidIndexer.scala:84)
	at io.druid.indexer.spark.SparkDruidIndexer$$anonfun$2.apply(SparkDruidIndexer.scala:84)
	at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:244)
	at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:244)
	at scala.collection.immutable.List.foreach(List.scala:318)
	at scala.collection.TraversableLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;map(TraversableLike.scala:244)
	at scala.collection.AbstractTraversable.map(Traversable.scala:105)
	at io.druid.indexer.spark.SparkDruidIndexer$.loadData(SparkDruidIndexer.scala:84)
	at io.druid.indexer.spark.TestSparkDruidIndexer$$anonfun$1.apply$mcV$sp(TestSparkDruidIndexer.scala:131)
	at io.druid.indexer.spark.TestSparkDruidIndexer$$anonfun$1.apply(TestSparkDruidIndexer.scala:40)
	at io.druid.indexer.spark.TestSparkDruidIndexer$$anonfun$1.apply(TestSparkDruidIndexer.scala:40)
	at org.scalatest.Transformer$$anonfun$apply$1.apply$mcV$sp(Transformer.scala:22)
	at org.scalatest.OutcomeOf$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;outcomeOf(OutcomeOf.scala:85)
	at org.scalatest.OutcomeOf$.outcomeOf(OutcomeOf.scala:104)
	at org.scalatest.Transformer.apply(Transformer.scala:22)
	at org.scalatest.Transformer.apply(Transformer.scala:20)
	at org.scalatest.FlatSpecLike$$anon$1.apply(FlatSpecLike.scala:1647)
	at org.scalatest.Suite$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;withFixture(Suite.scala:1122)
	at org.scalatest.FlatSpec.withFixture(FlatSpec.scala:1683)
	at org.scalatest.FlatSpecLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;invokeWithFixture$1(FlatSpecLike.scala:1644)
	at org.scalatest.FlatSpecLike$$anonfun$runTest$1.apply(FlatSpecLike.scala:1656)
	at org.scalatest.FlatSpecLike$$anonfun$runTest$1.apply(FlatSpecLike.scala:1656)
	at org.scalatest.SuperEngine.runTestImpl(Engine.scala:306)
	at org.scalatest.FlatSpecLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;runTest(FlatSpecLike.scala:1656)
	at org.scalatest.FlatSpec.runTest(FlatSpec.scala:1683)
	at org.scalatest.FlatSpecLike$$anonfun$runTests$1.apply(FlatSpecLike.scala:1714)
	at org.scalatest.FlatSpecLike$$anonfun$runTests$1.apply(FlatSpecLike.scala:1714)
	at org.scalatest.SuperEngine$$anonfun$traverseSubNodes$1$1.apply(Engine.scala:413)
	at org.scalatest.SuperEngine$$anonfun$traverseSubNodes$1$1.apply(Engine.scala:401)
	at scala.collection.immutable.List.foreach(List.scala:318)
	at org.scalatest.SuperEngine.traverseSubNodes$1(Engine.scala:401)
	at org.scalatest.SuperEngine.org$scalatest$SuperEngine$$runTestsInBranch(Engine.scala:390)
	at org.scalatest.SuperEngine$$anonfun$traverseSubNodes$1$1.apply(Engine.scala:427)
	at org.scalatest.SuperEngine$$anonfun$traverseSubNodes$1$1.apply(Engine.scala:401)
	at scala.collection.immutable.List.foreach(List.scala:318)
	at org.scalatest.SuperEngine.traverseSubNodes$1(Engine.scala:401)
	at org.scalatest.SuperEngine.org$scalatest$SuperEngine$$runTestsInBranch(Engine.scala:396)
	at org.scalatest.SuperEngine.runTestsImpl(Engine.scala:483)
	at org.scalatest.FlatSpecLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;runTests(FlatSpecLike.scala:1714)
	at org.scalatest.FlatSpec.runTests(FlatSpec.scala:1683)
	at org.scalatest.Suite$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;run(Suite.scala:1424)
	at org.scalatest.FlatSpec.org$scalatest$FlatSpecLike$$&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$run(FlatSpec.scala:1683)
	at org.scalatest.FlatSpecLike$$anonfun$run$1.apply(FlatSpecLike.scala:1760)
	at org.scalatest.FlatSpecLike$$anonfun$run$1.apply(FlatSpecLike.scala:1760)
	at org.scalatest.SuperEngine.runImpl(Engine.scala:545)
	at org.scalatest.FlatSpecLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;run(FlatSpecLike.scala:1760)
	at org.scalatest.FlatSpec.run(FlatSpec.scala:1683)
	at org.scalatest.tools.SuiteRunner.run(SuiteRunner.scala:55)
	at org.scalatest.tools.Runner$$anonfun$doRunRunRunDaDoRunRun$3.apply(Runner.scala:2563)
	at org.scalatest.tools.Runner$$anonfun$doRunRunRunDaDoRunRun$3.apply(Runner.scala:2557)
	at scala.collection.immutable.List.foreach(List.scala:318)
	at org.scalatest.tools.Runner$.doRunRunRunDaDoRunRun(Runner.scala:2557)
	at org.scalatest.tools.Runner$$anonfun$runOptionallyWithPassFailReporter$2.apply(Runner.scala:1044)
	at org.scalatest.tools.Runner$$anonfun$runOptionallyWithPassFailReporter$2.apply(Runner.scala:1043)
	at org.scalatest.tools.Runner$.withClassLoaderAndDispatchReporter(Runner.scala:2722)
	at org.scalatest.tools.Runner$.runOptionallyWithPassFailReporter(Runner.scala:1043)
	at org.scalatest.tools.Runner$.run(Runner.scala:883)
	at org.scalatest.tools.Runner.run(Runner.scala)
	at org.jetbrains.plugins.scala.testingSupport.scalaTest.ScalaTestRunner.runScalaTest2(ScalaTestRunner.java:138)
	at org.jetbrains.plugins.scala.testingSupport.scalaTest.ScalaTestRunner.main(ScalaTestRunner.java:28)
Caused by: java.lang.ClassNotFoundException: org.roaringbitmap.RoaringArray$Element
	at java.net.URLClassLoader.findClass(URLClassLoader.java:381)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:424)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:357)
	... 84 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14949525" author="drcrallen" created="Thu, 8 Oct 2015 22:30:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lemire&quot; class=&quot;user-hover&quot; rel=&quot;lemire&quot;&gt;lemire&lt;/a&gt; pinging to see if you have any suggestions on how to handle situations like this.&lt;/p&gt;</comment>
                            <comment id="14949819" author="lemire" created="Fri, 9 Oct 2015 03:11:24 +0000"  >&lt;p&gt;@drcallen Thanks for pinging me.&lt;/p&gt;

&lt;p&gt;We will be glad to help address any issue you have.&lt;/p&gt;

&lt;p&gt;The Element class was removed entirely with the release of Roaring version 0.5.0 as a way to save memory (each Element instance used 24 bytes). &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/lemire/RoaringBitmap/issues/31&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/lemire/RoaringBitmap/issues/31&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This change did not affect the public API. (Element as &quot;protected&quot;.) For obvious reasons, I recommend against introducing dependencies against non-public classes or function classes.&lt;/p&gt;


&lt;p&gt;The recommended way to persist a RoaringBitmap (or a MutableRoaringBitmap) is in this manner:&lt;/p&gt;

&lt;p&gt;        // r is my bitmap&lt;br/&gt;
        r.runOptimize(); //if needed, to improve compression (new with version 0.5.x)&lt;br/&gt;
        r.serialize(DataOutput ... );&lt;/p&gt;

&lt;p&gt;Then one can deserialize it, or just map it (using the ImmutableRoaringBitmap class). We are committed to preserving the data format produced by &quot;serialize&quot; across versions. &lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25xcf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>