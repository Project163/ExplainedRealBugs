<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:45:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-16228] &quot;Percentile&quot; needs explicit cast to double</title>
                <link>https://issues.apache.org/jira/browse/SPARK-16228</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;blockquote&gt;
&lt;p&gt; select percentile(cast(id as bigint), cast(0.5 as double)) from temp.bla&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Works.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt; select percentile(cast(id as bigint), 0.5 ) from temp.bla&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Throws&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Error in query: No handler for Hive UDF &apos;org.apache.hadoop.hive.ql.udf.UDAFPercentile&apos;: org.apache.hadoop.hive.ql.exec.NoMatchingMethodException: No matching method for class org.apache.hadoop.hive.ql.udf.UDAFPercentile with (bigint, decimal(38,18)). Possible choices: &lt;em&gt;FUNC&lt;/em&gt;(bigint, array&amp;lt;double&amp;gt;)  &lt;em&gt;FUNC&lt;/em&gt;(bigint, double)  ; line 1 pos 7&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12983879">SPARK-16228</key>
            <summary>&quot;Percentile&quot; needs explicit cast to double</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dongjoon">Dongjoon Hyun</assignee>
                                    <reporter username="epahomov">Egor Pahomov</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Jun 2016 18:08:09 +0000</created>
                <updated>Thu, 17 Nov 2016 14:30:47 +0000</updated>
                            <resolved>Wed, 29 Jun 2016 23:09:52 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15351596" author="srowen" created="Mon, 27 Jun 2016 18:49:52 +0000"  >&lt;p&gt;OK, not sure at this stage this is a Blocker though.&lt;/p&gt;</comment>
                            <comment id="15351697" author="epahomov" created="Mon, 27 Jun 2016 19:58:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt; &quot;blocker&quot; is questionable, I agree. I just believe, that everything which prevent you from moving from 1.6.1 to 2.0 without major code changes is &quot;blocker&quot;. It&apos;s just if I move and such bug would be there a lot of my analysts notebook would be invalid. &lt;/p&gt;</comment>
                            <comment id="15351708" author="dongjoon" created="Mon, 27 Jun 2016 20:04:16 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epahomov&quot; class=&quot;user-hover&quot; rel=&quot;epahomov&quot;&gt;epahomov&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt;.&lt;br/&gt;
The root cause is that Spark 2.0 uses `Decimal` as a default type for literal &apos;0.5&apos;.&lt;br/&gt;
This happens for `percentile_approx`, too. I guess it will happen for all double-type-only external functions.&lt;br/&gt;
I&apos;ll make a PR for this soon.&lt;/p&gt;</comment>
                            <comment id="15351727" author="apachespark" created="Mon, 27 Jun 2016 20:13:05 +0000"  >&lt;p&gt;User &apos;dongjoon-hyun&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/13930&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13930&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15673869" author="fabboe" created="Thu, 17 Nov 2016 14:30:47 +0000"  >&lt;p&gt;Shouldn&apos;t this also have resolved the below error we see when porting from 1.6 to 2.0.1?&lt;/p&gt;

&lt;p&gt;See reproducible snippet below.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;/usr/local/tl/spark-2.0.1-bin-hadoop2.7/bin/spark-shell&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Record(key: &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, value: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)
defined &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Record

scala&amp;gt; val recordsDF = spark.createDataFrame((1 to 100).map(i =&amp;gt; Record(i.toLong, s&lt;span class=&quot;code-quote&quot;&gt;&quot;val_$i&quot;&lt;/span&gt;)))
recordsDF: org.apache.spark.sql.DataFrame = [key: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, value: string]

scala&amp;gt; recordsDF.createOrReplaceTempView(&lt;span class=&quot;code-quote&quot;&gt;&quot;records&quot;&lt;/span&gt;)
scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT percentile(key, Array(0.95, 0.9, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.1)) AS test FROM records&quot;&lt;/span&gt;)
org.apache.spark.sql.AnalysisException: No handler &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Hive UDF &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.hadoop.hive.ql.udf.UDAFPercentile&apos;&lt;/span&gt;: org.apache.hadoop.hive.ql.exec.NoMatchingMethodException: No matching method &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.had
oop.hive.ql.udf.UDAFPercentile with (bigint, array&amp;lt;decimal(38,18)&amp;gt;). Possible choices: _FUNC_(bigint, array&amp;lt;&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;&amp;gt;)  _FUNC_(bigint, &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)  ; line 1 pos 7
  at org.apache.hadoop.hive.ql.exec.FunctionRegistry.getMethodInternal(FunctionRegistry.java:1164)
  at org.apache.hadoop.hive.ql.exec.DefaultUDAFEvaluatorResolver.getEvaluatorClass(DefaultUDAFEvaluatorResolver.java:83)
  at org.apache.hadoop.hive.ql.udf.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericUDAFBridge.getEvaluator(GenericUDAFBridge.java:56)
  at org.apache.hadoop.hive.ql.udf.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.AbstractGenericUDAFResolver.getEvaluator(AbstractGenericUDAFResolver.java:47)
  at org.apache.spark.sql.hive.HiveUDAFFunction.functionAndInspector$lzycompute(hiveUDFs.scala:286)
  at org.apache.spark.sql.hive.HiveUDAFFunction.functionAndInspector(hiveUDFs.scala:284)
  at org.apache.spark.sql.hive.HiveUDAFFunction.returnInspector$lzycompute(hiveUDFs.scala:294)
  at org.apache.spark.sql.hive.HiveUDAFFunction.returnInspector(hiveUDFs.scala:294)
  at org.apache.spark.sql.hive.HiveUDAFFunction.dataType$lzycompute(hiveUDFs.scala:342)
  at org.apache.spark.sql.hive.HiveUDAFFunction.dataType(hiveUDFs.scala:342)
  at org.apache.spark.sql.hive.HiveSessionCatalog$$anonfun$makeFunctionBuilder$1.apply(HiveSessionCatalog.scala:142)
  at org.apache.spark.sql.hive.HiveSessionCatalog$$anonfun$makeFunctionBuilder$1.apply(HiveSessionCatalog.scala:122)
  at org.apache.spark.sql.catalyst.analysis.SimpleFunctionRegistry.lookupFunction(FunctionRegistry.scala:87)
  at org.apache.spark.sql.catalyst.catalog.SessionCatalog.lookupFunction(SessionCatalog.scala:848)
  at org.apache.spark.sql.hive.HiveSessionCatalog.org$apache$spark$sql$hive$HiveSessionCatalog$$&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$lookupFunction(HiveSessionCatalog.scala:186)
  at org.apache.spark.sql.hive.HiveSessionCatalog$$anonfun$4.apply(HiveSessionCatalog.scala:186)
  at org.apache.spark.sql.hive.HiveSessionCatalog$$anonfun$4.apply(HiveSessionCatalog.scala:186)
  at scala.util.Try$.apply(Try.scala:192)
  at org.apache.spark.sql.hive.HiveSessionCatalog.lookupFunction0(HiveSessionCatalog.scala:186)
  at org.apache.spark.sql.hive.HiveSessionCatalog.lookupFunction(HiveSessionCatalog.scala:172)
  at org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveFunctions$$anonfun$apply$13$$anonfun$applyOrElse$6$$anonfun$applyOrElse$39.apply(Analyzer.scala:886)
  at org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveFunctions$$anonfun$apply$13$$anonfun$applyOrElse$6$$anonfun$applyOrElse$39.apply(Analyzer.scala:886)
  at org.apache.spark.sql.catalyst.analysis.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;$.withPosition(&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;.scala:48)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i307an:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>