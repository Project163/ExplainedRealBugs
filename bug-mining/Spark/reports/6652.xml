<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:06:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-28916] Generated SpecificSafeProjection.apply method grows beyond 64 KB when use  SparkSQL</title>
                <link>https://issues.apache.org/jira/browse/SPARK-28916</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Can be reproduced by the following steps&#65306;&lt;/p&gt;

&lt;p&gt;1.&#160;Create a table with 5000 fields&lt;/p&gt;

&lt;p&gt;2.&#160;val data=spark.sql(&quot;select * from spark64kb limit 10&quot;);&lt;/p&gt;

&lt;p&gt;3. data.describe()&lt;/p&gt;

&lt;p&gt;Then&#65292;The following error occurred&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
WARN scheduler.TaskSetManager: Lost task 0.0 in stage 1.0 (TID 0, localhost, executor 1): org.codehaus.janino.InternalCompilerException: failed to compile: org.codehaus.janino.InternalCompilerException: Compiling &lt;span class=&quot;code-quote&quot;&gt;&quot;GeneratedClass&quot;&lt;/span&gt;: Code of method &lt;span class=&quot;code-quote&quot;&gt;&quot;apply(Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;)Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;&quot;&lt;/span&gt; of class &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.spark.sql.catalyst.expressions.GeneratedClass$SpecificMutableProjection&quot;&lt;/span&gt; grows beyond 64 KB
  at org.apache.spark.sql.catalyst.expressions.codegen.CodeGenerator$.org$apache$spark$sql$catalyst$expressions$codegen$CodeGenerator$$doCompile(CodeGenerator.scala:1298)
  at org.apache.spark.sql.catalyst.expressions.codegen.CodeGenerator$$anon$1.load(CodeGenerator.scala:1376)
  at org.apache.spark.sql.catalyst.expressions.codegen.CodeGenerator$$anon$1.load(CodeGenerator.scala:1373)
  at org.spark_project.guava.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3599)
  at org.spark_project.guava.cache.LocalCache$Segment.loadSync(LocalCache.java:2379)
  at org.spark_project.guava.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2342)
  at org.spark_project.guava.cache.LocalCache$Segment.get(LocalCache.java:2257)
  at org.spark_project.guava.cache.LocalCache.get(LocalCache.java:4000)
  at org.spark_project.guava.cache.LocalCache.getOrLoad(LocalCache.java:4004)
  at org.spark_project.guava.cache.LocalCache$LocalLoadingCache.get(LocalCache.java:4874)
  at org.apache.spark.sql.catalyst.expressions.codegen.CodeGenerator$.compile(CodeGenerator.scala:1238)
  at org.apache.spark.sql.catalyst.expressions.codegen.GenerateMutableProjection$.create(GenerateMutableProjection.scala:143)
  at org.apache.spark.sql.catalyst.expressions.codegen.GenerateMutableProjection$.generate(GenerateMutableProjection.scala:44)
  at org.apache.spark.sql.execution.SparkPlan.newMutableProjection(SparkPlan.scala:385)
  at org.apache.spark.sql.execution.aggregate.SortAggregateExec$$anonfun$doExecute$1$$anonfun$3$$anonfun$4.apply(SortAggregateExec.scala:96)
  at org.apache.spark.sql.execution.aggregate.SortAggregateExec$$anonfun$doExecute$1$$anonfun$3$$anonfun$4.apply(SortAggregateExec.scala:95)
  at org.apache.spark.sql.execution.aggregate.AggregationIterator.generateProcessRow(AggregationIterator.scala:180)
  at org.apache.spark.sql.execution.aggregate.AggregationIterator.&amp;lt;init&amp;gt;(AggregationIterator.scala:199)
  at org.apache.spark.sql.execution.aggregate.SortBasedAggregationIterator.&amp;lt;init&amp;gt;(SortBasedAggregationIterator.scala:40)
  at org.apache.spark.sql.execution.aggregate.SortAggregateExec$$anonfun$doExecute$1$$anonfun$3.apply(SortAggregateExec.scala:86)
  at org.apache.spark.sql.execution.aggregate.SortAggregateExec$$anonfun$doExecute$1$$anonfun$3.apply(SortAggregateExec.scala:77)
  at org.apache.spark.rdd.RDD$$anonfun$mapPartitionsWithIndexInternal$1$$anonfun$12.apply(RDD.scala:823)
  at org.apache.spark.rdd.RDD$$anonfun$mapPartitionsWithIndexInternal$1$$anonfun$12.apply(RDD.scala:823)
  at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)
  at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)
  at org.apache.spark.rdd.RDD.iterator(RDD.scala:288)
  at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)
  at org.apache.spark.scheduler.Task.run(Task.scala:121)
  at org.apache.spark.executor.Executor$TaskRunner$$anonfun$10.apply(Executor.scala:408)
  at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1360)
  at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:414)
  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
Caused by: org.codehaus.janino.InternalCompilerException: Compiling &lt;span class=&quot;code-quote&quot;&gt;&quot;GeneratedClass&quot;&lt;/span&gt;: Code of method &lt;span class=&quot;code-quote&quot;&gt;&quot;apply(Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;)Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;&quot;&lt;/span&gt; of class &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.spark.sql.catalyst.expressions.GeneratedClass$SpecificMutableProjection&quot;&lt;/span&gt; grows beyond 64 KB
  at org.codehaus.janino.UnitCompiler.compileUnit(UnitCompiler.java:382)
  at org.codehaus.janino.SimpleCompiler.cook(SimpleCompiler.java:237)
  at org.codehaus.janino.SimpleCompiler.compileToClassLoader(SimpleCompiler.java:465)
  at org.codehaus.janino.ClassBodyEvaluator.compileToClass(ClassBodyEvaluator.java:313)
  at org.codehaus.janino.ClassBodyEvaluator.cook(ClassBodyEvaluator.java:235)
  at org.codehaus.janino.SimpleCompiler.cook(SimpleCompiler.java:207)
  at org.codehaus.commons.compiler.Cookable.cook(Cookable.java:80)
  at org.apache.spark.sql.catalyst.expressions.codegen.CodeGenerator$.org$apache$spark$sql$catalyst$expressions$codegen$CodeGenerator$$&lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13253744">SPARK-28916</key>
            <summary>Generated SpecificSafeProjection.apply method grows beyond 64 KB when use  SparkSQL</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgaido">Marco Gaido</assignee>
                                    <reporter username="MOBIN">MOBIN</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Aug 2019 15:44:26 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:58 +0000</updated>
                            <resolved>Mon, 9 Sep 2019 05:31:56 +0000</resolved>
                                    <version>2.3.1</version>
                    <version>2.4.3</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16919188" author="gurwls223" created="Fri, 30 Aug 2019 04:27:34 +0000"  >&lt;p&gt;Reproducer:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val df = spark.range(100).selectExpr((0 to 5000).map(i =&amp;gt; s&lt;span class=&quot;code-quote&quot;&gt;&quot;id as field_$i&quot;&lt;/span&gt;): _*)
df.createOrReplaceTempView(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark64kb&quot;&lt;/span&gt;)
val data = spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select * from spark64kb limit 10&quot;&lt;/span&gt;)
data.describe()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16920074" author="mgaido" created="Sat, 31 Aug 2019 09:29:56 +0000"  >&lt;p&gt;Thanks for reporting this. I am checking it.&lt;/p&gt;</comment>
                            <comment id="16920153" author="mgaido" created="Sat, 31 Aug 2019 15:46:00 +0000"  >&lt;p&gt;I think the problem is related to subexpression elimination. I&apos;ve not been able to confirm since for some reasons I am not able to disable it, even though I set the config to false, it is performed anyway. Maybe I am missing something there. Anyway, you may try and set &lt;tt&gt;spark.sql.subexpressionElimination.enabled&lt;/tt&gt; to &lt;tt&gt;false&lt;/tt&gt;. Meanwhile I am working on a fix. Thanks.&lt;/p&gt;</comment>
                            <comment id="16920577" author="mobin" created="Mon, 2 Sep 2019 02:45:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgaido&quot; class=&quot;user-hover&quot; rel=&quot;mgaido&quot;&gt;mgaido&lt;/a&gt;thinks,&#160;spark.sql.subexpressionElimination.enabled&#160;parameter solved my problem&lt;/p&gt;</comment>
                            <comment id="16920692" author="cloud_fan" created="Mon, 2 Sep 2019 08:30:01 +0000"  >&lt;p&gt;to double-check, this is just error message not actual exception, right?&lt;/p&gt;</comment>
                            <comment id="16925369" author="cloud_fan" created="Mon, 9 Sep 2019 05:31:56 +0000"  >&lt;p&gt;Issue resolved by pull request 25642&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/25642&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/25642&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 10 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z065wg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>