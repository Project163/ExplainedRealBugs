<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:33:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-32559] Fix the trim logic in UTF8String.toInt/toLong did&apos;t handle Chinese characters correctly</title>
                <link>https://issues.apache.org/jira/browse/SPARK-32559</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The trim logic in Cast expression introduced in&#160;&lt;a href=&quot;https://github.com/apache/spark/pull/26622&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/26622&lt;/a&gt;&#160;will trim chinese characters unexpectly.&lt;/p&gt;

&lt;p&gt;For example,&#160; sql&#160; select cast(&quot;1&#20013;&#25991;&quot; as float) gives 1 instead of null&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13321267">SPARK-32559</key>
            <summary>Fix the trim logic in UTF8String.toInt/toLong did&apos;t handle Chinese characters correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="EdisonWang">EdisonWang</assignee>
                                    <reporter username="EdisonWang">EdisonWang</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Thu, 6 Aug 2020 09:02:01 +0000</created>
                <updated>Wed, 12 Jul 2023 09:47:51 +0000</updated>
                            <resolved>Sun, 9 Aug 2020 19:13:02 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.0.1</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17172153" author="apachespark" created="Thu, 6 Aug 2020 09:07:00 +0000"  >&lt;p&gt;User &apos;WangGuangxin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29375&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29375&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17173723" author="apachespark" created="Sun, 9 Aug 2020 02:00:56 +0000"  >&lt;p&gt;User &apos;WangGuangxin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29393&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29393&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17730869" author="kwafor" created="Fri, 9 Jun 2023 08:40:34 +0000"  >&lt;p&gt;The expressions `getByte(s) &amp;lt;= &apos; &apos;` and `Character.isWhitespace(getByte(s))` are different, which causes the `trimAll()` function to fail to remove characters other than spaces, deviating from the original intention of the `trimAll` function (to be consistent with Java&apos;s String trim).&lt;/p&gt;

&lt;p&gt;This will cause the `date()` function to fail, for example: executing `select date(&quot;today\u0003&quot;);` would result in an error instead of returning null.&lt;/p&gt;

&lt;p&gt;```java&lt;br/&gt;
/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Trims whitespaces ({@literal &amp;lt;=} ASCII 32) from both ends of this string.&lt;br/&gt;
*&lt;/li&gt;
	&lt;li&gt;Note that, this method is the same as java&apos;s {@link String#trim}, and different from&lt;/li&gt;
	&lt;li&gt;{@link UTF8String#trim()} which remove only spaces(= ASCII 32) from both ends.&lt;br/&gt;
*&lt;/li&gt;
	&lt;li&gt;@return A UTF8String whose value is this UTF8String, with any leading and trailing white&lt;/li&gt;
	&lt;li&gt;space removed, or this UTF8String if it has no leading or trailing whitespace.&lt;br/&gt;
*&lt;br/&gt;
*/&lt;br/&gt;
public UTF8String trimAll() {&lt;br/&gt;
int s = 0;&lt;br/&gt;
// skip all of the whitespaces (&amp;lt;=0x20) in the left side&lt;br/&gt;
while (s &amp;lt; this.numBytes &amp;amp;&amp;amp; Character.isWhitespace(getByte(s))) s++;&lt;br/&gt;
if (s == this.numBytes) 
{
// Everything trimmed
return EMPTY_UTF8;
}
&lt;p&gt;// skip all of the whitespaces (&amp;lt;=0x20) in the right side&lt;br/&gt;
int e = this.numBytes - 1;&lt;br/&gt;
while (e &amp;gt; s &amp;amp;&amp;amp; Character.isWhitespace(getByte(e))) e--;&lt;br/&gt;
if (s == 0 &amp;amp;&amp;amp; e == numBytes - 1) &lt;/p&gt;
{
// Nothing trimmed
return this;
}
&lt;p&gt;return copyUTF8String(s, e);&lt;br/&gt;
}&lt;br/&gt;
```&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17730870" author="kwafor" created="Fri, 9 Jun 2023 08:42:31 +0000"  >&lt;p&gt;This is the detailed error log.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13058886/13058886_error.log&quot; title=&quot;error.log attached to SPARK-32559&quot;&gt;error.log&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17731425" author="snoot" created="Mon, 12 Jun 2023 03:41:22 +0000"  >&lt;p&gt;User &apos;Kwafoor&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/41535&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/41535&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13238987">SPARK-28023</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13543244">SPARK-44383</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13058886" name="error.log" size="8413" author="kwafor" created="Fri, 9 Jun 2023 08:42:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 22 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hixc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>