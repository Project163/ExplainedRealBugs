<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:24:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-3885] Provide mechanism to remove accumulators once they are no longer used</title>
                <link>https://issues.apache.org/jira/browse/SPARK-3885</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Spark does not currently provide any mechanism to delete accumulators after they are no longer used.  This can lead to OOMs for long-lived SparkContexts that create many large accumulators.&lt;/p&gt;

&lt;p&gt;Part of the problem is that accumulators are registered in a global &lt;tt&gt;Accumulators&lt;/tt&gt; registry.  Maybe the fix would be as simple as using weak references in the Accumulators registry so that accumulators can be GC&apos;d once they can no longer be used.&lt;/p&gt;

&lt;p&gt;In the meantime, here&apos;s a workaround that users can try:&lt;/p&gt;

&lt;p&gt;Accumulators have a public setValue() method that can be called (only by the driver) to change an accumulator&#8217;s value.  You might be able to use this to reset accumulators&#8217; values to smaller objects (e.g. the &#8220;zero&#8221; object of whatever your accumulator type is, or &#8216;null&#8217; if you&#8217;re sure that the accumulator will never be accessed again).&lt;/p&gt;

&lt;p&gt;This issue was originally reported by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkronenfeld&quot; class=&quot;user-hover&quot; rel=&quot;nkronenfeld&quot;&gt;nkronenfeld&lt;/a&gt; on the dev mailing list: &lt;a href=&quot;http://apache-spark-developers-list.1001551.n3.nabble.com/Fwd-Accumulator-question-td8709.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-spark-developers-list.1001551.n3.nabble.com/Fwd-Accumulator-question-td8709.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12747130">SPARK-3885</key>
            <summary>Provide mechanism to remove accumulators once they are no longer used</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ilganeli">Ilya Ganelin</assignee>
                                    <reporter username="joshrosen">Josh Rosen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Oct 2014 21:26:17 +0000</created>
                <updated>Sat, 28 Feb 2015 19:54:52 +0000</updated>
                            <resolved>Mon, 23 Feb 2015 06:58:06 +0000</resolved>
                                    <version>1.0.2</version>
                    <version>1.1.0</version>
                    <version>1.2.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14173407" author="nkronenfeld" created="Thu, 16 Oct 2014 05:53:39 +0000"  >&lt;p&gt;I tried reusing accumulators and clearing them, but I&apos;m still running out of memory.&lt;/p&gt;

&lt;p&gt;According to the profiler, there is a lot still held by Accumulators$.localAccums.&lt;/p&gt;

&lt;p&gt;If I read things right, this is where the workers hold on to their versions of the accumulator?&lt;/p&gt;

&lt;p&gt;It looks like there is a clear call, but it looks to me like it&apos;s only run at the beginning of a task (which means it should be keeping these around at the end of a job, until another task is run on that thread - which makes it a bit tough to profile.&lt;/p&gt;

&lt;p&gt;Am I reading all this correctly? If so, I can see why it isn&apos;t cleared out at the end of a job - there&apos;s probably no way of doing that safely, since the workers don&apos;t know when the end is.&lt;/p&gt;

&lt;p&gt;Ideally, I&apos;d love a call whereby I can explicitly release an accumulator.  It seems to me that would require a parallel map in Accumulators$ that kept track of the threads on which each accumulator was stored, so it could clear them.&lt;/p&gt;

&lt;p&gt;Am I understanding this all correctly?  If so, I think I could put together the fix I describe pretty easily.&lt;/p&gt;</comment>
                            <comment id="14268079" author="ilganeli" created="Wed, 7 Jan 2015 19:32:47 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joshrosen&quot; class=&quot;user-hover&quot; rel=&quot;joshrosen&quot;&gt;joshrosen&lt;/a&gt;, I can knock this one out - could you please assign it to me. One minor question, both here and in the code there is a TODO recommending using soft references. However, a soft reference will not be released by default, only when the garbage collector explicitly needs more memory. Is there any reason it can&apos;t be made a weak reference instead?&lt;/p&gt;</comment>
                            <comment id="14275607" author="apachespark" created="Tue, 13 Jan 2015 17:54:38 +0000"  >&lt;p&gt;User &apos;ilganeli&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/4021&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/4021&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14333055" author="joshrosen" created="Mon, 23 Feb 2015 06:58:06 +0000"  >&lt;p&gt;Issue resolved by pull request 4021&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/4021&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/4021&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14341753" author="joshrosen" created="Sat, 28 Feb 2015 19:54:52 +0000"  >&lt;p&gt;I found a correctness issue in this patch, which I&apos;ll fix shortly: see &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-6075&quot; title=&quot;After SPARK-3885, some tasks&amp;#39; accumulator updates may be lost&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-6075&quot;&gt;&lt;del&gt;SPARK-6075&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12749433">SPARK-4030</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 38 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21073:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>