<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:30:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-6319] Should throw analysis exception when using binary type in groupby/join</title>
                <link>https://issues.apache.org/jira/browse/SPARK-6319</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Spark shell session for reproduction:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;scala&amp;gt; import sqlContext.implicits._
scala&amp;gt; import org.apache.spark.sql.types._
scala&amp;gt; Seq(1, 1, 2, 2).map(i =&amp;gt; Tuple1(i.toString)).toDF(&quot;c&quot;).select($&quot;c&quot; cast BinaryType).distinct.show()
...
CAST(c, BinaryType)
[B@43f13160
[B@5018b648
[B@3be22500
[B@476fc8a1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Spark SQL uses plain byte arrays to represent binary values. However, arrays are compared by reference rather than by value. On the other hand, the DISTINCT operator uses a &lt;tt&gt;HashSet&lt;/tt&gt; and its &lt;tt&gt;.contains&lt;/tt&gt; method to check for duplicated values. These two facts together cause the problem.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12781780">SPARK-6319</key>
            <summary>Should throw analysis exception when using binary type in groupby/join</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="lian cheng">Cheng Lian</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Mar 2015 12:10:11 +0000</created>
                <updated>Mon, 1 Feb 2016 18:03:20 +0000</updated>
                            <resolved>Fri, 31 Jul 2015 00:24:34 +0000</resolved>
                                    <version>1.0.2</version>
                    <version>1.1.1</version>
                    <version>1.2.1</version>
                    <version>1.3.0</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="14362614" author="yhuai" created="Sun, 15 Mar 2015 23:56:35 +0000"  >&lt;p&gt;I believe that our aggregation and join will also be affected. I am changing the Priority to Blocker.&lt;/p&gt;</comment>
                            <comment id="14363011" author="lian cheng" created="Mon, 16 Mar 2015 10:06:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-5553&quot; title=&quot;Reimplement SQL binary type with more efficient data structure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-5553&quot;&gt;&lt;del&gt;SPARK-5553&lt;/del&gt;&lt;/a&gt; is somewhat related to this one. By reimplement the binary type with some more efficient representation with a proper &lt;tt&gt;equalsTo&lt;/tt&gt; method can fix this issue in a clean way. Though we might not try to resolve &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-5553&quot; title=&quot;Reimplement SQL binary type with more efficient data structure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-5553&quot;&gt;&lt;del&gt;SPARK-5553&lt;/del&gt;&lt;/a&gt; right away.&lt;/p&gt;</comment>
                            <comment id="14364202" author="yhuai" created="Mon, 16 Mar 2015 23:26:38 +0000"  >&lt;p&gt;Had a discussion with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marmbrus&quot; class=&quot;user-hover&quot; rel=&quot;marmbrus&quot;&gt;marmbrus&lt;/a&gt; on it. We agree that the right way to address it is to have a wrapper on the byte array.&lt;/p&gt;</comment>
                            <comment id="14364209" author="marmbrus" created="Mon, 16 Mar 2015 23:29:56 +0000"  >&lt;p&gt;I&apos;m going to bump this to 1.4.0.  I don&apos;t think most systems will actually let you do this, and its a pretty weird use case that no real user has complained about before.&lt;/p&gt;</comment>
                            <comment id="14625045" author="joshrosen" created="Mon, 13 Jul 2015 17:59:46 +0000"  >&lt;p&gt;I think that we should revisit this issue.  It seems that we currently return wrong answers for groupBy queries involving binary typed columns.  If we&apos;re not going to support this properly, then I think we should fail-fast with an analysis error rather than returning an incorrect answer.&lt;/p&gt;</comment>
                            <comment id="14625082" author="marmbrus" created="Mon, 13 Jul 2015 18:15:04 +0000"  >&lt;p&gt;+1 to throwing an &lt;tt&gt;AnalysisException&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="14645588" author="joshrosen" created="Wed, 29 Jul 2015 07:05:09 +0000"  >&lt;p&gt;I think it would be nice to add this AnalysisException + a test before 1.5.0.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt;, given your recent patch for fixing the SortMergeJoin analysis, this might be really quick for you to implement. If you&apos;re not interested, I&apos;ll try to do it myself this week.&lt;/p&gt;</comment>
                            <comment id="14645628" author="viirya" created="Wed, 29 Jul 2015 07:35:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joshrosen&quot; class=&quot;user-hover&quot; rel=&quot;joshrosen&quot;&gt;joshrosen&lt;/a&gt; I will do it later. Thanks.&lt;/p&gt;</comment>
                            <comment id="14647289" author="apachespark" created="Thu, 30 Jul 2015 07:19:13 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7787&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7787&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15125710" author="chinwei" created="Mon, 1 Feb 2016 04:10:00 +0000"  >&lt;p&gt;Hi guys,&lt;/p&gt;

&lt;p&gt;Any resolution for group by binary column using Spark.&lt;/p&gt;</comment>
                            <comment id="15126668" author="lian cheng" created="Mon, 1 Feb 2016 18:03:20 +0000"  >&lt;p&gt;One possible but not necessarily the best workaround is to have a UDF that maps your binary field to some other data type, which can be used in GROUP BY/JOIN.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12771966">SPARK-5553</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 42 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i26qhj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332078">1.5.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>