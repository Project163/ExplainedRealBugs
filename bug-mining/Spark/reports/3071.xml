<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:37:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-12330] Mesos coarse executor does not cleanup blockmgr properly on termination if data is stored on disk</title>
                <link>https://issues.apache.org/jira/browse/SPARK-12330</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;A simple line count example can be launched as similar to &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SPARK_HOME=/mnt/tmp/spark MASTER=mesos:&lt;span class=&quot;code-comment&quot;&gt;//zk://zk.metamx-prod.com:2181/mesos-druid/metrics ./bin/spark-shell --conf spark.mesos.coarse=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; --conf spark.cores.max=7 --conf spark.mesos.executor.memoryOverhead=2048 --conf spark.mesos.executor.home=/mnt/tmp/spark --conf spark.executor.extraJavaOptions=&lt;span class=&quot;code-quote&quot;&gt;&apos;-Duser.timezone=UTC -Dfile.encoding=UTF-8 -XX:+UseParallelGC -XX:+UseParallelOldGC -XX:ParallelGCThreads=8 -XX:+PrintGCApplicationStoppedTime -XX:+PrintTenuringDistribution -XX:+PrintFlagsFinal -XX:+PrintAdaptiveSizePolicy -XX:+PrintReferenceGC -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:MaxDirectMemorySize=1024m -verbose:gc -XX:+PrintFlagsFinal -Djava.io.tmpdir=/mnt/tmp/scratch&apos;&lt;/span&gt; --conf spark.hadoop.fs.s3n.awsAccessKeyId=&lt;span class=&quot;code-quote&quot;&gt;&apos;REDACTED&apos;&lt;/span&gt; --conf spark.hadoop.fs.s3n.awsSecretAccessKey=&lt;span class=&quot;code-quote&quot;&gt;&apos;REDACTED&apos;&lt;/span&gt; --conf spark.executor.memory=7g --conf spark.executorEnv.GLOG_v=9 --conf spark.storage.memoryFraction=0.0 --conf spark.shuffle.memoryFraction=0.0&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the shell the following lines can be executed:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;val text_file = sc.textFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;s3n:&lt;span class=&quot;code-comment&quot;&gt;//REDACTED/charlesallen/tpch/lineitem.tbl&quot;&lt;/span&gt;).persist(org.apache.spark.storage.StorageLevel.DISK_ONLY)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;text_file.map(l =&amp;gt; 1).sum
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which will result in&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;res0: &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt; = 6001215.0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;for the TPCH 1GB dataset&lt;/p&gt;

&lt;p&gt;Unfortunately the blockmgr directory remains on the executor node after termination of the spark context.&lt;/p&gt;

&lt;p&gt;The log on the executor looks like this near the termination:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;I1215 02:12:31.190878 130732 process.cpp:566] Parsed message name &lt;span class=&quot;code-quote&quot;&gt;&apos;mesos.internal.ShutdownExecutorMessage&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; executor(1)@172.19.67.30:58604 from slave(1)@172.19.67.30:5051
I1215 02:12:31.190928 130732 process.cpp:2382] Spawned process __http__(4)@172.19.67.30:58604
I1215 02:12:31.190932 130721 process.cpp:2392] Resuming executor(1)@172.19.67.30:58604 at 2015-12-15 02:12:31.190924800+00:00
I1215 02:12:31.190958 130702 process.cpp:2392] Resuming __http__(4)@172.19.67.30:58604 at 2015-12-15 02:12:31.190951936+00:00
I1215 02:12:31.190976 130721 exec.cpp:381] Executor asked to shutdown
I1215 02:12:31.190943 130727 process.cpp:2392] Resuming __gc__@172.19.67.30:58604 at 2015-12-15 02:12:31.190937088+00:00
I1215 02:12:31.190991 130702 process.cpp:2497] Cleaning up __http__(4)@172.19.67.30:58604
I1215 02:12:31.191032 130721 process.cpp:2382] Spawned process (2)@172.19.67.30:58604
I1215 02:12:31.191040 130702 process.cpp:2392] Resuming (2)@172.19.67.30:58604 at 2015-12-15 02:12:31.191037952+00:00
I1215 02:12:31.191054 130702 exec.cpp:80] Scheduling shutdown of the executor
I1215 02:12:31.191069 130721 exec.cpp:396] Executor::shutdown took 21572ns
I1215 02:12:31.191073 130702 clock.cpp:260] Created a timer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (2)@172.19.67.30:58604 in 5secs in the &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; (2015-12-15 02:12:36.191062016+00:00)
I1215 02:12:31.191066 130720 process.cpp:2392] Resuming (1)@172.19.67.30:58604 at 2015-12-15 02:12:31.191059200+00:00
15/12/15 02:12:31 INFO CoarseGrainedExecutorBackend: Driver commanded a shutdown
I1215 02:12:31.240103 130732 clock.cpp:151] Handling timers up to 2015-12-15 02:12:31.240091136+00:00
I1215 02:12:31.240123 130732 clock.cpp:158] Have timeout(s) at 2015-12-15 02:12:31.240036096+00:00
I1215 02:12:31.240183 130730 process.cpp:2392] Resuming reaper(1)@172.19.67.30:58604 at 2015-12-15 02:12:31.240178176+00:00
I1215 02:12:31.240226 130730 clock.cpp:260] Created a timer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; reaper(1)@172.19.67.30:58604 in 100ms in the &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; (2015-12-15 02:12:31.340212992+00:00)
I1215 02:12:31.247019 130720 clock.cpp:260] Created a timer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (1)@172.19.67.30:58604 in 3secs in the &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; (2015-12-15 02:12:34.247005952+00:00)
15/12/15 02:12:31 ERROR CoarseGrainedExecutorBackend: RECEIVED SIGNAL 15: SIGTERM
15/12/15 02:12:31 INFO ShutdownHookManager: Shutdown hook called

....no more java logs
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the shuffle fraction is NOT set to 0.0, and the data is allowed to stay in memory, then the following log can be seen at termination instead:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;I1215 01:19:16.247705 120052 process.cpp:566] Parsed message name &lt;span class=&quot;code-quote&quot;&gt;&apos;mesos.internal.ShutdownExecutorMessage&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; executor(1)@172.19.67.24:60016 from slave(1)@172.19.67.24:5051
I1215 01:19:16.247745 120052 process.cpp:2382] Spawned process __http__(4)@172.19.67.24:60016
I1215 01:19:16.247747 120034 process.cpp:2392] Resuming executor(1)@172.19.67.24:60016 at 2015-12-15 01:19:16.247741952+00:00
I1215 01:19:16.247758 120030 process.cpp:2392] Resuming __gc__@172.19.67.24:60016 at 2015-12-15 01:19:16.247755008+00:00
I1215 01:19:16.247772 120034 exec.cpp:381] Executor asked to shutdown
I1215 01:19:16.247772 120038 process.cpp:2392] Resuming __http__(4)@172.19.67.24:60016 at 2015-12-15 01:19:16.247767808+00:00
I1215 01:19:16.247791 120038 process.cpp:2497] Cleaning up __http__(4)@172.19.67.24:60016
I1215 01:19:16.247814 120034 process.cpp:2382] Spawned process (2)@172.19.67.24:60016
I1215 01:19:16.247823 120038 process.cpp:2392] Resuming (2)@172.19.67.24:60016 at 2015-12-15 01:19:16.247822080+00:00
I1215 01:19:16.247836 120038 exec.cpp:80] Scheduling shutdown of the executor
I1215 01:19:16.247820 120039 process.cpp:2392] Resuming __gc__@172.19.67.24:60016 at 2015-12-15 01:19:16.247816960+00:00
I1215 01:19:16.247843 120034 exec.cpp:396] Executor::shutdown took 17355ns
I1215 01:19:16.247849 120038 clock.cpp:260] Created a timer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (2)@172.19.67.24:60016 in 5secs in the &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; (2015-12-15 01:19:21.247843072+00:00)
I1215 01:19:16.247855 120049 process.cpp:2392] Resuming (1)@172.19.67.24:60016 at 2015-12-15 01:19:16.247849984+00:00
15/12/15 01:19:16 INFO CoarseGrainedExecutorBackend: Driver commanded a shutdown
15/12/15 01:19:16 INFO MemoryStore: MemoryStore cleared
15/12/15 01:19:16 INFO BlockManager: BlockManager stopped
15/12/15 01:19:16 INFO RemoteActorRefProvider$RemotingTerminator: Shutting down remote daemon.
15/12/15 01:19:16 INFO RemoteActorRefProvider$RemotingTerminator: Remote daemon shut down; proceeding with flushing remote transports.
15/12/15 01:19:16 INFO RemoteActorRefProvider$RemotingTerminator: Remoting shut down.
15/12/15 01:19:16 INFO ShutdownHookManager: Shutdown hook called

.... no more java logs
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice in the former case with dirty directories left over, there is a SIGTERM intercepted by the executor, and there are no log messages indicating disk cleaning occurred. In the later case, the shutdown hooks for memory and block managers are seen.&lt;/p&gt;

&lt;p&gt;This is using Mesos 0.25.0&lt;/p&gt;</description>
                <environment></environment>
        <key id="12921855">SPARK-12330</key>
            <summary>Mesos coarse executor does not cleanup blockmgr properly on termination if data is stored on disk</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="apachespark">Apache Spark</assignee>
                                    <reporter username="drcrallen">Charles R Allen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Dec 2015 02:28:45 +0000</created>
                <updated>Sun, 17 May 2020 18:21:25 +0000</updated>
                            <resolved>Thu, 4 Feb 2016 18:28:08 +0000</resolved>
                                    <version>1.5.1</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Block Manager</component>
                    <component>Mesos</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15058729" author="drcrallen" created="Tue, 15 Dec 2015 20:25:29 +0000"  >&lt;p&gt;This is because the CoarseMesosSchedulerBackend does not wait for the environment to report tasks finished before shutting down the mesos driver. I have a fix that seems to be working against 1.5.1. will see if I can cherry-pick it to master&lt;/p&gt;</comment>
                            <comment id="15058819" author="drcrallen" created="Tue, 15 Dec 2015 21:09:08 +0000"  >&lt;p&gt;Looks like the mesos coarse scheduler underwent a lot of changes in 1.6 vs 1.5. In the 1.6 branch I&apos;m getting errors on the terminating of the coarse tasks and reporting of failed tasks.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/metamx/spark/commit/338f511e3f6ef03f457555d838ed3a694a77dece&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/metamx/spark/commit/338f511e3f6ef03f457555d838ed3a694a77dece&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;That same stuff against 1.5.1 has a nice and clean shutdown of the executors on mesos, reporting FINISHED instead of FAILED or KILLED.&lt;/p&gt;</comment>
                            <comment id="15059169" author="apachespark" created="Wed, 16 Dec 2015 00:17:03 +0000"  >&lt;p&gt;User &apos;drcrallen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10319&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10319&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15527698" author="apachespark" created="Tue, 27 Sep 2016 22:58:13 +0000"  >&lt;p&gt;User &apos;vanzin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15270&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15270&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12714932">SPARK-1865</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12781266">SPARK-6287</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12923131">SPARK-12430</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="13032711">SPARK-19111</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 7 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pw1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329449">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>