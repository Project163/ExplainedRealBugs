<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:18:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-30462] Structured Streaming _spark_metadata fills up Spark Driver memory when having lots of objects</title>
                <link>https://issues.apache.org/jira/browse/SPARK-30462</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;With the current implementation of the Spark Structured Streaming it does not seem to be possible to have a constantly running stream, writing millions of files, without increasing the spark driver&apos;s memory to dozens of GB&apos;s.&lt;/p&gt;

&lt;p&gt;In our scenario we are using Spark structured streaming to consume messages from a Kafka cluster, transform them, and write them as compressed Parquet files in an S3 Objectstore Service.&lt;br/&gt;
Each 30 seconds a new batch of the spark-streaming is writing hundreds of objects, which respectively results within time to millions of objects in S3.&lt;br/&gt;
As all written objects are recorded in the _spark_metadata, the size of the compact files there grows to GB&apos;s that eventually fill up the Spark Driver&apos;s memory and lead to OOM errors.&lt;/p&gt;

&lt;p&gt;We need the functionality to configure the spark structured streaming to run without loading all the historically accumulated metadata in its memory. &lt;br/&gt;
Regularly resetting the _spark_metadata and the checkpoint folders is not an option in our use-case, as we are using the information from the _spark_metadata to have a register of the objects for faster querying and search of the written objects.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13278181">SPARK-30462</key>
            <summary>Structured Streaming _spark_metadata fills up Spark Driver memory when having lots of objects</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kabhwan">Jungtaek Lim</assignee>
                                    <reporter username="Vladimir Yankov">Vladimir Yankov</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Jan 2020 14:57:22 +0000</created>
                <updated>Thu, 20 Aug 2020 09:31:58 +0000</updated>
                            <resolved>Thu, 20 Aug 2020 09:31:58 +0000</resolved>
                                    <version>2.4.3</version>
                    <version>2.4.4</version>
                    <version>3.0.0</version>
                                    <fixVersion>3.1.0</fixVersion>
                                    <component>Structured Streaming</component>
                        <due></due>
                            <votes>4</votes>
                                    <watches>13</watches>
                                                                                                                <comments>
                            <comment id="17011325" author="kabhwan" created="Thu, 9 Jan 2020 02:31:33 +0000"  >&lt;p&gt;I&apos;m seeing many requests to fix up Spark metadata for streaming file sink, which I feel we may need to consider this as critical.&lt;/p&gt;

&lt;p&gt;Not exactly same symptoms (so the necessary fix might be different) but you can find similar issues from &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-24295&quot; title=&quot;Purge Structured streaming FileStreamSinkLog metadata compact file data.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-24295&quot;&gt;SPARK-24295&lt;/a&gt;,&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-29995&quot; title=&quot;Structured Streaming file-sink log grow indefinitely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-29995&quot;&gt;&lt;del&gt;SPARK-29995&lt;/del&gt;&lt;/a&gt; as well. Same reason. I&apos;ll link these three issues.&lt;/p&gt;</comment>
                            <comment id="17017782" author="sparksiva" created="Fri, 17 Jan 2020 08:00:25 +0000"  >&lt;p&gt;Hi All,&lt;/p&gt;

&lt;p&gt;I have two structured streaming jobs which should write data to the same base directory.&lt;/p&gt;

&lt;p&gt;As _&lt;em&gt;spark&lt;/em&gt;_&lt;em&gt;metadata directory will be created by default for one job, second job cannot use the same directory as base path as already _spark&lt;/em&gt;_metadata directory is created by other job, It is throwing exception.&lt;/p&gt;

&lt;p&gt;Is there any workaround for this, other than creating separate base path&apos;s for both the jobs.&lt;/p&gt;

&lt;p&gt;Is it possible to create the _&lt;em&gt;spark&lt;/em&gt;_metadata directory else where or disable without any data loss.&lt;/p&gt;

&lt;p&gt;If I had to change the base path for both the jobs, then my whole framework will get impacted, So i don&apos;t want to do that.&lt;/p&gt;

&lt;p&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-30542&quot; title=&quot;Two Spark structured streaming jobs cannot write to same base path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-30542&quot;&gt;&lt;del&gt;SPARK-30542&lt;/del&gt;&lt;/a&gt;) - I have created a separate ticket for this.&lt;/p&gt;</comment>
                            <comment id="17142714" author="apachespark" created="Tue, 23 Jun 2020 08:13:31 +0000"  >&lt;p&gt;User &apos;HeartSaVioR&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28904&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28904&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17142715" author="apachespark" created="Tue, 23 Jun 2020 08:14:21 +0000"  >&lt;p&gt;User &apos;HeartSaVioR&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28904&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28904&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17181064" author="dongjoon" created="Thu, 20 Aug 2020 09:31:58 +0000"  >&lt;p&gt;Issue resolved by pull request 28904&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28904&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28904&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13159693">SPARK-24295</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13269997">SPARK-29995</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13222269">SPARK-27188</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0aaxk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>