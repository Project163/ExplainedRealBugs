<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:55:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-21255] NPE when creating encoder for enum</title>
                <link>https://issues.apache.org/jira/browse/SPARK-21255</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When you try to create an encoder for Enum type (or bean with enum property) via Encoders.bean(...), it fails with NullPointerException at TypeToken:495.&lt;br/&gt;
I did a little research and it turns out, that in JavaTypeInference:126 following code &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;val beanInfo = Introspector.getBeanInfo(typeToken.getRawType)
val properties = beanInfo.getPropertyDescriptors.filterNot(_.getName == &lt;span class=&quot;code-quote&quot;&gt;&quot;class&quot;&lt;/span&gt;)
val fields = properties.map { property =&amp;gt;
          val returnType = typeToken.method(property.getReadMethod).getReturnType
          val (dataType, nullable) = inferDataType(returnType)
          &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StructField(property.getName, dataType, nullable)
        }
(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StructType(fields), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;filters out properties named &quot;class&quot;, because we wouldn&apos;t want to serialize that. But enum types have another property of type Class named &quot;declaringClass&quot;, which we are trying to inspect recursively. Eventually we try to inspect ClassLoader class, which has property &quot;defaultAssertionStatus&quot; with no read method, which leads to NPE at TypeToken:495.&lt;/p&gt;

&lt;p&gt;I think adding property name &quot;declaringClass&quot; to filtering will resolve this.&lt;/p&gt;</description>
                <environment>&lt;p&gt;org.apache.spark:spark-core_2.10:2.1.0&lt;br/&gt;
org.apache.spark:spark-sql_2.10:2.1.0&lt;/p&gt;</environment>
        <key id="13083492">SPARK-21255</key>
            <summary>NPE when creating encoder for enum</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mike0sv">Mike</assignee>
                                    <reporter username="mike0sv">Mike</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Jun 2017 15:27:31 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:05 +0000</updated>
                            <resolved>Fri, 25 Aug 2017 06:23:03 +0000</resolved>
                                    <version>2.1.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>Java API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16068520" author="srowen" created="Thu, 29 Jun 2017 15:55:30 +0000"  >&lt;p&gt;Is the change to omit declaringClass too?&lt;/p&gt;</comment>
                            <comment id="16069146" author="mike0sv" created="Thu, 29 Jun 2017 22:49:19 +0000"  >&lt;p&gt;Yes, but there may be other problems (at least I cannot guarantee there won&apos;t be), since it seems like enums were never used before.&lt;/p&gt;</comment>
                            <comment id="16069668" author="srowen" created="Fri, 30 Jun 2017 08:07:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mike0sv&quot; class=&quot;user-hover&quot; rel=&quot;mike0sv&quot;&gt;mike0sv&lt;/a&gt; OK, feel free to open a PR to exclude it and ideally a test case to exercise this path. That may be all there is to it.&lt;br/&gt;
Also CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt; on this one as I think you may have touched this code last.&lt;/p&gt;</comment>
                            <comment id="16069754" author="gurwls223" created="Fri, 30 Jun 2017 09:09:55 +0000"  >&lt;p&gt;Thanks for cc&apos;ing me. It looks this was introduced long time ago in the first place.&lt;br/&gt;
I double checked &lt;tt&gt;declaringClass&lt;/tt&gt; and &lt;a href=&quot;https://docs.oracle.com/javase/8/docs/api/java/lang/Enum.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/8/docs/api/java/lang/Enum.html&lt;/a&gt; and it works if we filter out. It sounds good to me too.&lt;/p&gt;

&lt;p&gt;The reproducer I used is as below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt; A {
    B(&lt;span class=&quot;code-quote&quot;&gt;&quot;www.google.com&quot;&lt;/span&gt;);

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; url;

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; A(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; url) {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.url = url;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getUrl() {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; url;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setUrl(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; url) {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.url = url;
    }
  }

  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testEnum() {
    List&amp;lt;A&amp;gt; data = Arrays.asList(A.B);
    spark.createDataFrame(data, A.class).show();
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After the change:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+--------------+
|           url|
+--------------+
|www.google.com|
+--------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16070120" author="apachespark" created="Fri, 30 Jun 2017 13:48:03 +0000"  >&lt;p&gt;User &apos;mike0sv&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18488&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18488&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16141254" author="srowen" created="Fri, 25 Aug 2017 06:23:03 +0000"  >&lt;p&gt;Issue resolved by pull request 18488&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18488&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18488&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16143426" author="apachespark" created="Mon, 28 Aug 2017 06:37:27 +0000"  >&lt;p&gt;User &apos;cloud-fan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19066&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19066&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16143428" author="apachespark" created="Mon, 28 Aug 2017 06:38:10 +0000"  >&lt;p&gt;User &apos;cloud-fan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19066&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19066&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16425832" author="shengzhixia" created="Wed, 4 Apr 2018 16:44:48 +0000"  >&lt;p&gt;created a follow up issue to add the java enum support in scala api:&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-23862&quot; title=&quot;Spark ExpressionEncoder should support java enum type in scala&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-23862&quot;&gt;&lt;del&gt;SPARK-23862&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13149895">SPARK-23862</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 32 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3gwfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>