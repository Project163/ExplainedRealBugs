<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:15:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-31186] toPandas fails on simple query (collect() works)</title>
                <link>https://issues.apache.org/jira/browse/SPARK-31186</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;My pandas is 0.25.1.&lt;/p&gt;

&lt;p&gt;I ran the following simple code (cross joins are enabled):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
spark.sql(&apos;&apos;&apos;
select t1.*, t2.* &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; (
  select explode(sequence(1, 3)) v
) t1 left join (
  select explode(sequence(1, 3)) v
) t2
&apos;&apos;&apos;).toPandas()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and got a ValueError from pandas:&lt;/p&gt;

&lt;p&gt;&amp;gt; ValueError: The truth value of a Series is ambiguous. Use a.empty, a.bool(), a.item(), a.any() or a.all().&lt;/p&gt;

&lt;p&gt;Collect works fine:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
spark.sql(&apos;&apos;&apos;
select * &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; (
  select explode(sequence(1, 3)) v
) t1 left join (
  select explode(sequence(1, 3)) v
) t2
&apos;&apos;&apos;).collect()
&lt;span class=&quot;code-comment&quot;&gt;# [Row(v=1, v=1),
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;#  Row(v=1, v=2),
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;#  Row(v=1, v=3),
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;#  Row(v=2, v=1),
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;#  Row(v=2, v=2),
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;#  Row(v=2, v=3),
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;#  Row(v=3, v=1),
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;#  Row(v=3, v=2),
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;#  Row(v=3, v=3)]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I imagine it&apos;s related to the duplicate column names, but this doesn&apos;t fail:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select 1 v, 1 v&quot;&lt;/span&gt;).toPandas()
&lt;span class=&quot;code-comment&quot;&gt;# v	v
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;# 0	1	1&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also no issue for multiple rows:&lt;/p&gt;

&lt;p&gt;spark.sql(&quot;select 1 v, 1 v union all select 1 v, 2 v&quot;).toPandas()&lt;/p&gt;

&lt;p&gt;It also works when not using a cross join but a janky programatically-generated union all query:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
cond = []
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ii &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;range&lt;/span&gt;(3):
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; jj &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;range&lt;/span&gt;(3):
        cond.append(f&lt;span class=&quot;code-quote&quot;&gt;&apos;select {ii+1} v, {jj+1} v&apos;&lt;/span&gt;)
spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&apos; union &lt;span class=&quot;code-object&quot;&gt;all&lt;/span&gt; &apos;&lt;/span&gt;.join(cond)).toPandas()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As near as I can tell, the output is identical to the explode output, making this issue all the more peculiar, as I thought toPandas() is applied to the output of collect(), so if collect() gives the same output, how can toPandas() fail in one case and not the other? Further, the lazy DataFrame is the same: DataFrame&lt;span class=&quot;error&quot;&gt;&amp;#91;v: int, v: int&amp;#93;&lt;/span&gt; in both cases. I must be missing something.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13292620">SPARK-31186</key>
            <summary>toPandas fails on simple query (collect() works)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="michaelchirico">Michael Chirico</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Mar 2020 05:02:38 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:03 +0000</updated>
                            <resolved>Fri, 27 Mar 2020 03:12:47 +0000</resolved>
                                    <version>2.4.4</version>
                                    <fixVersion>2.4.6</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17068236" author="gurwls223" created="Fri, 27 Mar 2020 03:12:47 +0000"  >&lt;p&gt;Issue resolved by pull request 28025&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28025&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28025&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 33 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0copc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>