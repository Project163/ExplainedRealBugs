<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:30:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-35542] Bucketizer created for multiple columns with parameters splitsArray,&#160; inputCols and outputCols can not be loaded after saving it.</title>
                <link>https://issues.apache.org/jira/browse/SPARK-35542</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Bucketizer created for multiple columns with parameters&#160;&lt;b&gt;splitsArray&lt;/b&gt;,&#160; &lt;b&gt;inputCols&lt;/b&gt; and &lt;b&gt;outputCols&lt;/b&gt;&#160;can not be loaded after saving it.&lt;/p&gt;

&lt;p&gt;The problem is not seen for Bucketizer created for single column.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Code to reproduce&lt;/b&gt;&#160;&lt;/p&gt;

&lt;p&gt;###################################&lt;/p&gt;

&lt;p&gt;from pyspark.ml.feature import Bucketizer&lt;br/&gt;
df = spark.createDataFrame(&lt;span class=&quot;error&quot;&gt;&amp;#91;(0.1,), (0.4,), (1.2,), (1.5,)&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;values&amp;quot;&amp;#93;&lt;/span&gt;)&lt;br/&gt;
bucketizer = Bucketizer(&lt;b&gt;splitsArray&lt;/b&gt;= [&lt;span class=&quot;error&quot;&gt;&amp;#91;-float(&amp;quot;inf&amp;quot;), 0.5, 1.4, float(&amp;quot;inf&amp;quot;)&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;-float(&amp;quot;inf&amp;quot;), 0.1, 1.2, float(&amp;quot;inf&amp;quot;)&amp;#93;&lt;/span&gt;], &lt;b&gt;inputCols&lt;/b&gt;=&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;values&amp;quot;, &amp;quot;values&amp;quot;&amp;#93;&lt;/span&gt;, &lt;b&gt;outputCols&lt;/b&gt;=&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;b1&amp;quot;, &amp;quot;b2&amp;quot;&amp;#93;&lt;/span&gt;)&lt;br/&gt;
bucketed = bucketizer.transform(df).collect()&lt;br/&gt;
dfb = bucketizer.transform(df)&lt;br/&gt;
print(dfb.show())&lt;br/&gt;
bucketizerPath = &quot;dbfs:/mnt/S3-Bucket/&quot; + &quot;Bucketizer&quot;&lt;br/&gt;
bucketizer.write().overwrite().save(bucketizerPath)&lt;br/&gt;
loadedBucketizer = &lt;font color=&quot;#FF0000&quot;&gt;Bucketizer.load(bucketizerPath)&#160; &#160; #### Failing here&lt;/font&gt;&lt;br/&gt;
loadedBucketizer.getSplits() == bucketizer.getSplits()&lt;/p&gt;

&lt;p&gt;############################################################&lt;/p&gt;

&lt;p&gt;The error message is&#160;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#FF0000&quot;&gt;&lt;b&gt;TypeError: array() argument 1 must be a unicode character, not bytes&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;BackTrace:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
--------------------------------------------------------------------------&lt;br/&gt;
TypeError Traceback (most recent call last) &amp;lt;command-3999490&amp;gt; in &amp;lt;module&amp;gt; 15 16 bucketizer.write().overwrite().save(bucketizerPath)&lt;br/&gt;
---&amp;gt; 17 loadedBucketizer = Bucketizer.load(bucketizerPath)&lt;br/&gt;
18 loadedBucketizer.getSplits() == bucketizer.getSplits()&lt;br/&gt;
&#160;&lt;br/&gt;
/databricks/spark/python/pyspark/ml/util.py in load(cls, path)&lt;br/&gt;
376 def load(cls, path):&lt;br/&gt;
377 &quot;&quot;&quot;Reads an ML instance from the input path, a shortcut of `read().load(path)`.&quot;&quot;&quot;&lt;br/&gt;
--&amp;gt; 378 return cls.read().load(path)&lt;br/&gt;
379&lt;br/&gt;
380&lt;br/&gt;
&#160;&lt;br/&gt;
/databricks/spark/python/pyspark/ml/util.py in load(self, path)&lt;br/&gt;
330 raise NotImplementedError(&quot;This Java ML type cannot be loaded into Python currently: %r&quot;&lt;br/&gt;
331 % self._clazz)&lt;br/&gt;
--&amp;gt; 332 return self._clazz._from_java(java_obj)&lt;br/&gt;
333&lt;br/&gt;
334&lt;br/&gt;
&#160;&lt;br/&gt;
def session(self, sparkSession): /databricks/spark/python/pyspark/ml/wrapper.py in _from_java(java_stage)&lt;br/&gt;
258&lt;br/&gt;
259 py_stage._resetUid(java_stage.uid())&lt;br/&gt;
--&amp;gt; 260 py_stage._transfer_params_from_java()&lt;br/&gt;
261 elif hasattr(py_type, &quot;_from_java&quot;):&lt;br/&gt;
262 py_stage = py_type._from_java(java_stage)&lt;br/&gt;
&#160;&lt;br/&gt;
/databricks/spark/python/pyspark/ml/wrapper.py in _transfer_params_from_java(self)&lt;br/&gt;
186 # &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-14931&quot; title=&quot;Mismatched default Param values between pipelines in Spark and PySpark&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-14931&quot;&gt;&lt;del&gt;SPARK-14931&lt;/del&gt;&lt;/a&gt;: Only check set params back to avoid default params mismatch.&lt;br/&gt;
187 if self._java_obj.isSet(java_param): --&amp;gt; &lt;br/&gt;
188 value = _java2py(sc, self._java_obj.getOrDefault(java_param))&lt;br/&gt;
189 self._set(**&lt;/p&gt;
{param.name: value}
&lt;p&gt;)&lt;br/&gt;
190 # &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-10931&quot; title=&quot;PySpark ML Models should contain Param values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-10931&quot;&gt;&lt;del&gt;SPARK-10931&lt;/del&gt;&lt;/a&gt;: Temporary fix for params that have a default in Java&lt;br/&gt;
&#160;&lt;br/&gt;
/databricks/spark/python/pyspark/ml/common.py in _java2py(sc, r, encoding)&lt;br/&gt;
107&lt;br/&gt;
108 if isinstance(r, (bytearray, bytes)):&lt;br/&gt;
--&amp;gt; 109 r = PickleSerializer().loads(bytes(r), encoding=encoding)&lt;br/&gt;
110&#160; return r&lt;br/&gt;
111&lt;br/&gt;
&#160;&lt;br/&gt;
/databricks/spark/python/pyspark/serializers.py in loads(self, obj, encoding)&lt;br/&gt;
467&lt;br/&gt;
468 def loads(self, obj, encoding=&quot;bytes&quot;):&lt;br/&gt;
--&amp;gt; 469 return pickle.loads(obj, encoding=encoding)&lt;br/&gt;
470&lt;br/&gt;
471&lt;br/&gt;
&#160;&lt;br/&gt;
TypeError: array() argument 1 must be a unicode character, not bytes&lt;br/&gt;
&#160;&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;&lt;font color=&quot;#172b4d&quot;&gt;DataBricks Spark 3.1.1&lt;/font&gt;&lt;/p&gt;</environment>
        <key id="13380721">SPARK-35542</key>
            <summary>Bucketizer created for multiple columns with parameters splitsArray,&#160; inputCols and outputCols can not be loaded after saving it.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="weichenxu123">Weichen Xu</assignee>
                                    <reporter username="srikanthpusarla">Srikanth Pusarla</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 May 2021 10:11:08 +0000</created>
                <updated>Fri, 19 Aug 2022 04:28:54 +0000</updated>
                            <resolved>Fri, 19 Aug 2022 04:28:54 +0000</resolved>
                                    <version>3.1.1</version>
                                    <fixVersion>3.1.4</fixVersion>
                    <fixVersion>3.3.1</fixVersion>
                    <fixVersion>3.2.3</fixVersion>
                    <fixVersion>3.4.0</fixVersion>
                                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17367810" author="srowen" created="Wed, 23 Jun 2021 02:25:11 +0000"  >&lt;p&gt;Huh, yeah I see that too. Weird, as I&apos;d think this would have turned up elsewhere as Bucketizer shares code about inputCols with other classes.&lt;br/&gt;
This looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-7379&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-7379&lt;/a&gt; which was never resolved. I don&apos;t suppose you have an idea about a fix? I am not sure how to address it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt; I don&apos;t suppose you have any ideas? I think you touched the pickle code here last, but it may not be a problem with that part.&lt;/p&gt;</comment>
                            <comment id="17367829" author="viirya" created="Wed, 23 Jun 2021 02:51:41 +0000"  >&lt;p&gt;So this is PySpark only issue and Scala Bucketizer is fine? Which pickle code you mean? cloudpickle.py? Or &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-24058&quot; title=&quot;Default Params in ML should be saved separately: Python API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-24058&quot;&gt;&lt;del&gt;SPARK-24058&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17581272" author="apachespark" created="Thu, 18 Aug 2022 10:24:45 +0000"  >&lt;p&gt;User &apos;WeichenXu123&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/37568&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/37568&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17581644" author="weichenxu123" created="Fri, 19 Aug 2022 04:28:54 +0000"  >&lt;p&gt;Issue resolved by pull request 37568&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/37568&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/37568&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13026037" name="Code-error.PNG" size="50582" author="srikanthpusarla" created="Thu, 27 May 2021 10:19:15 +0000"/>
                            <attachment id="13026038" name="traceback.png" size="102579" author="srikanthpusarla" created="Thu, 27 May 2021 10:19:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0rf6w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>