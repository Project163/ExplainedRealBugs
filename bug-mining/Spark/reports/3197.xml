<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 02:12:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92">
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-13328] Possible poor read performance for broadcast variables with dynamic resource allocation</title>
                <link>https://issues.apache.org/jira/browse/SPARK-13328</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When dynamic resource allocation is enabled fetching broadcast variables from removed executors were causing job failures and &lt;a href="https://issues.apache.org/jira/browse/SPARK-9591" title="Job failed for exception during getting Broadcast variable" class="issue-link" data-issue-key="SPARK-9591"&gt;&lt;del&gt;SPARK-9591&lt;/del&gt;&lt;/a&gt; fixed this problem by trying all locations of a block before giving up. However, the locations of a block is retrieved only once from the driver in this process and the locations in this list can be stale due to dynamic resource allocation. This situation gets worse when running on a large cluster as the size of this location list can be in the order of several hundreds out of which there may be tens of stale entries. What we have observed is with the default settings of 3 max retries and 5s between retries (that's 15s per location) the time it takes to read a broadcast variable can be as high as ~17m (below log shows the failed 70th block fetch attempt where each attempt takes 15s)&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;...
16/02/13 01:02:27 WARN storage.BlockManager: Failed to fetch remote block broadcast_18_piece0 from BlockManagerId(8, ip-10-178-77-38.ec2.internal, 60675) (failed attempt 70)
...
16/02/13 01:02:27 INFO broadcast.TorrentBroadcast: Reading broadcast variable 18 took 1051049 ms
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment/>
        <key id="12939378">SPARK-13328</key>
            <summary>Possible poor read performance for broadcast variables with dynamic resource allocation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nezihyigitbasi">Nezih Yigitbasi</assignee>
                                    <reporter username="nezihyigitbasi">Nezih Yigitbasi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Feb 2016 23:24:34 +0000</created>
                <updated>Fri, 11 Mar 2016 19:39:00 +0000</updated>
                            <resolved>Fri, 11 Mar 2016 19:39:00 +0000</resolved>
                                    <version>1.5.2</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Spark Core</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15147896" author="nezihyigitbasi" created="Mon, 15 Feb 2016 23:30:21 +0000">&lt;p&gt;Although this long time can be reduced by decreasing the values of the &lt;tt&gt;spark.shuffle.io.maxRetries&lt;/tt&gt; and &lt;tt&gt;spark.shuffle.io.retryWait&lt;/tt&gt; parameters it may not be desirable to reduce # of retries globally and also reducing retry wait may increase the load on the serving block manager. &lt;/p&gt;

&lt;p&gt;I already have a fix where I added a new config parameter &lt;tt&gt;spark.block.failures.beforeLocationRefresh&lt;/tt&gt; that determines when to refresh the list of block locations from the driver while going through all these locations. In my fix this parameter is honored only when dynamic allocation is enabled and I set its default value to Int.MaxValue so that it doesn't change the behavior even if dynamic alloc. is enabled (as refreshing the location may not be necessary in small clusters).&lt;/p&gt;

&lt;p&gt;If you think such a fix is valuable I will be happy to create a PR.&lt;/p&gt;</comment>
                            <comment id="15150863" author="apachespark" created="Wed, 17 Feb 2016 17:48:03 +0000">&lt;p&gt;User 'nezihyigitbasi' has created a pull request for this issue:&lt;br/&gt;
&lt;a href="https://github.com/apache/spark/pull/11241" class="external-link" target="_blank" rel="nofollow noopener"&gt;https://github.com/apache/spark/pull/11241&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2svc7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329449">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>