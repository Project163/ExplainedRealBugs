<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:01:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-22357] SparkContext.binaryFiles ignore minPartitions parameter</title>
                <link>https://issues.apache.org/jira/browse/SPARK-22357</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;this is a bug in binaryFiles - even though we give it the partitions, binaryFiles ignores it.&lt;br/&gt;
This is a bug introduced in spark 2.1 from spark 2.0, in file PortableDataStream.scala the argument &#8220;minPartitions&#8221; is no longer used (with the push to master on 11/7/6):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
Allow minPartitions set by end-user in order to keep compatibility with old Hadoop API
which is set through setMaxSplitSize
*/
def setMinPartitions(sc: SparkContext, context: JobContext, minPartitions: Int) {
    val defaultMaxSplitBytes = sc.getConf.get(config.FILES_MAX_PARTITION_BYTES)
    val openCostInBytes = sc.getConf.get(config.FILES_OPEN_COST_IN_BYTES)
    val defaultParallelism = sc.defaultParallelism
    val files = listStatus(context).asScala
    val totalBytes = files.filterNot(.isDirectory).map(.getLen + openCostInBytes).sum
    val bytesPerCore = totalBytes / defaultParallelism
    val maxSplitSize = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.min(defaultMaxSplitBytes, &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(openCostInBytes, bytesPerCore))
    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.setMaxSplitSize(maxSplitSize)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The code previously, in version 2.0, was:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def setMinPartitions(context: JobContext, minPartitions: Int) {
    val totalLen = listStatus(context).asScala.filterNot(.isDirectory).map(.getLen).sum
    val maxSplitSize = math.ceil(totalLen / math.max(minPartitions, 1.0)).toLong
    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.setMaxSplitSize(maxSplitSize)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The new code is very smart, but it ignores what the user passes in and uses the data size, which is kind of a breaking change in some sense&lt;br/&gt;
In our specific case this was a problem, because we initially read in just the files names and only after that the dataframe becomes very large, when reading in the images themselves &#8211; and in this case the new code does not handle the partitioning very well.&lt;br/&gt;
I&#8217;m not sure if it can be easily fixed because I don&#8217;t understand the full context of the change in spark (but at the very least the unused parameter should be removed to avoid confusion).&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13112210">SPARK-22357</key>
            <summary>SparkContext.binaryFiles ignore minPartitions parameter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bomeng">Bo Meng</assignee>
                                    <reporter username="weichenxu123">Weichen Xu</reporter>
                        <labels>
                            <label>behavior-changes</label>
                    </labels>
                <created>Thu, 26 Oct 2017 08:25:18 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:42 +0000</updated>
                            <resolved>Wed, 29 Aug 2018 00:39:54 +0000</resolved>
                                    <version>2.1.2</version>
                    <version>2.2.0</version>
                                    <fixVersion>2.4.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="16220147" author="weichenxu123" created="Thu, 26 Oct 2017 08:27:11 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=imatiach&quot; class=&quot;user-hover&quot; rel=&quot;imatiach&quot;&gt;imatiach&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=liancheng&quot; class=&quot;user-hover&quot; rel=&quot;liancheng&quot;&gt;liancheng&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16220152" author="weichenxu123" created="Thu, 26 Oct 2017 08:29:31 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16220160" author="jerryshao" created="Thu, 26 Oct 2017 08:34:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=WeichenXu123&quot; class=&quot;user-hover&quot; rel=&quot;weichenxu123&quot;&gt;WeichenXu123&lt;/a&gt; would you please format the code in JIRA description to make it easy to read &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="16220169" author="weichenxu123" created="Thu, 26 Oct 2017 08:42:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt; code formatted. This bug is reported from here &lt;a href=&quot;https://github.com/apache/spark/pull/19439&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19439&lt;/a&gt;&lt;br/&gt;
You can ask &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=imatiach&quot; class=&quot;user-hover&quot; rel=&quot;imatiach&quot;&gt;imatiach&lt;/a&gt; for more context.&lt;/p&gt;</comment>
                            <comment id="16220395" author="jerryshao" created="Thu, 26 Oct 2017 12:58:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;In our specific case this was a problem, because we initially read in just the files names and only after that the dataframe becomes very large, when reading in the images themselves &#8211; and in this case the new code does not handle the partitioning very well.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Would you please explain more about this?&lt;/p&gt;</comment>
                            <comment id="16220417" author="weichenxu123" created="Thu, 26 Oct 2017 13:21:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt; I checked the code, it ignore the `minPartitions` parameter indeed. About these text, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=imatiach&quot; class=&quot;user-hover&quot; rel=&quot;imatiach&quot;&gt;imatiach&lt;/a&gt; Can you help explain more ? &lt;/p&gt;</comment>
                            <comment id="16220431" author="jerryshao" created="Thu, 26 Oct 2017 13:32:07 +0000"  >&lt;p&gt;Yes, I know this parameter is ignored, but I&apos;m not sure is it intended or not. If it breaks your case I think we should fix it anyway.&lt;/p&gt;</comment>
                            <comment id="16221078" author="bomeng" created="Thu, 26 Oct 2017 19:30:59 +0000"  >&lt;p&gt;a quick fix could be as follows, correct me if i am wrong.&lt;br/&gt;
val defaultParallelism = Math.max(sc.defaultParallelism, minPartitions)&lt;/p&gt;</comment>
                            <comment id="16221388" author="imatiach" created="Thu, 26 Oct 2017 22:51:48 +0000"  >&lt;p&gt;binaryFiles ignores the number of partitions I want to have, even if I specify the value.  I have to repartition the returned DataFrame.  In my specific case, the number of partitions was very small, which caused performance issues.  I needed to increase the number of partitions by repartitioning the DataFrame after it was constructed, but this can be expensive - it would be better to create the DataFrame with the user-specified number of partitions.&lt;/p&gt;</comment>
                            <comment id="16510507" author="jbrock" created="Wed, 13 Jun 2018 01:41:06 +0000"  >&lt;p&gt;What are people&apos;s opinions of&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bomeng&quot; class=&quot;user-hover&quot; rel=&quot;bomeng&quot;&gt;bomeng&lt;/a&gt;&apos;s fix? This bug just bit me,&#160;so I&apos;d like to&#160;see this fixed.&lt;/p&gt;</comment>
                            <comment id="16520002" author="gurwls223" created="Fri, 22 Jun 2018 04:27:17 +0000"  >&lt;p&gt;Please open a PR and go ahead if you think it&apos;s right. I can take a look &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bomeng&quot; class=&quot;user-hover&quot; rel=&quot;bomeng&quot;&gt;bomeng&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16522754" author="apachespark" created="Mon, 25 Jun 2018 20:09:05 +0000"  >&lt;p&gt;User &apos;bomeng&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/21638&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21638&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16595791" author="srowen" created="Wed, 29 Aug 2018 00:39:54 +0000"  >&lt;p&gt;Issue resolved by pull request 21638&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/21638&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21638&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16606207" author="apachespark" created="Thu, 6 Sep 2018 18:22:29 +0000"  >&lt;p&gt;User &apos;srowen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22356&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22356&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16606210" author="apachespark" created="Thu, 6 Sep 2018 18:23:38 +0000"  >&lt;p&gt;User &apos;srowen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22356&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22356&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 10 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3lq73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>