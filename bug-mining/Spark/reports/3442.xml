<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:41:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-14139] Dataset loses nullability in operations with RowEncoder</title>
                <link>https://issues.apache.org/jira/browse/SPARK-14139</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When i do&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;val df1 = sc.makeRDD(1 to 3).toDF
val df2 = df1.map(row =&amp;gt; Row(row(0).asInstanceOf[Int] + 1))(RowEncoder(df1.schema))
println(s&quot;schema before ${df1.schema} and after ${df2.schema}&quot;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I get:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;schema before StructType(StructField(value,IntegerType,false)) and after StructType(StructField(value,IntegerType,true))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The change in field nullable is unexpected and i consider it a bug.&lt;br/&gt;
This bug was introduced in:&lt;br/&gt;
 &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-13244&quot; title=&quot;Unify DataFrame and Dataset API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-13244&quot;&gt;&lt;del&gt;SPARK-13244&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Migrates DataFrame to Dataset&lt;/p&gt;</description>
                <environment></environment>
        <key id="12953430">SPARK-14139</key>
            <summary>Dataset loses nullability in operations with RowEncoder</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cloud_fan">Wenchen Fan</assignee>
                                    <reporter username="koert">koert kuipers</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Mar 2016 22:39:23 +0000</created>
                <updated>Thu, 5 May 2016 17:09:45 +0000</updated>
                            <resolved>Thu, 5 May 2016 17:09:23 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15211381" author="koert" created="Fri, 25 Mar 2016 03:47:17 +0000"  >&lt;p&gt;i believe the difference is in the definition of schema in Dataset.&lt;br/&gt;
before it was:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; override def schema: StructType = resolvedTEncoder.schema
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;now it is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  def schema: StructType = queryExecution.analyzed.schema
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but queryExecution.analyzed (which is a LogicalPlan) does not alwas respect nullability. In this particular case the issue is in RowEncoder.extractorsFor, where for a StructType&apos;s fields nullable is ignored. &lt;/p&gt;</comment>
                            <comment id="15212743" author="koert" created="Sat, 26 Mar 2016 02:23:11 +0000"  >&lt;p&gt;it is not clear to me if the goal should remain to derive the schema from the logical plan, or revert back to a schema from the encoder. i am going to assume a schema from logical plan, and will try to fix nullable for the logical plan. &lt;/p&gt;</comment>
                            <comment id="15213196" author="apachespark" created="Sat, 26 Mar 2016 20:54:04 +0000"  >&lt;p&gt;User &apos;koertkuipers&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/11980&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/11980&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15239613" author="apachespark" created="Wed, 13 Apr 2016 17:06:03 +0000"  >&lt;p&gt;User &apos;cloud-fan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/12364&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12364&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15272074" author="lian cheng" created="Thu, 5 May 2016 08:42:02 +0000"  >&lt;p&gt;As discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-15112&quot; title=&quot;Dataset filter returns garbage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-15112&quot;&gt;&lt;del&gt;SPARK-15112&lt;/del&gt;&lt;/a&gt;. I think we should revert to use encoder schema as Dataset schema. But it involves a little bit more work than just changing the schema to get everything right. I&apos;m looking into these related issues. Thanks for reporting and your initial investigation!&lt;/p&gt;</comment>
                            <comment id="15272650" author="lian cheng" created="Thu, 5 May 2016 17:09:23 +0000"  >&lt;p&gt;Issue resolved by pull request 12364&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/12364&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12364&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 28 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2v72n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329449">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>