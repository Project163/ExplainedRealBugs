<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:59:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-23852] Parquet MR bug can lead to incorrect SQL results</title>
                <link>https://issues.apache.org/jira/browse/SPARK-23852</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Parquet MR 1.9.0 and 1.8.2 both have a bug, &lt;a href=&quot;https://issues.apache.org/jira/browse/PARQUET-1217&quot; title=&quot;Incorrect handling of missing values in Statistics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PARQUET-1217&quot;&gt;&lt;del&gt;PARQUET-1217&lt;/del&gt;&lt;/a&gt;, that means that pushing certain predicates to Parquet scanners can return fewer results than they should.&lt;/p&gt;

&lt;p&gt;The bug triggers in Spark when:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The Parquet file being scanner has stats for the null count, but not the max or min on the column with the predicate (Apache Impala writes files like this).&lt;/li&gt;
	&lt;li&gt;The vectorized Parquet reader path is not taken, and the parquet-mr reader is used.&lt;/li&gt;
	&lt;li&gt;A suitable &amp;lt;, &amp;lt;=, &amp;gt; or &amp;gt;= predicate is pushed down to Parquet.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The bug is that the parquet-mr interprets the max and min of a row-group&apos;s column as 0 in the absence of stats. So &lt;tt&gt;col &amp;gt; 0&lt;/tt&gt; will filter all results, even if some are &amp;gt; 0.&lt;/p&gt;

&lt;p&gt;There is no upstream release of Parquet that contains the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/PARQUET-1217&quot; title=&quot;Incorrect handling of missing values in Statistics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PARQUET-1217&quot;&gt;&lt;del&gt;PARQUET-1217&lt;/del&gt;&lt;/a&gt;, although a 1.10 release is planned.&lt;/p&gt;

&lt;p&gt;The least impactful workaround is to set the Parquet configuration &lt;tt&gt;parquet.filter.stats.enabled&lt;/tt&gt; to &lt;tt&gt;false&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13149576">SPARK-23852</key>
            <summary>Parquet MR bug can lead to incorrect SQL results</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rdblue">Ryan Blue</assignee>
                                    <reporter username="henryr">Henry Robinson</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Mon, 2 Apr 2018 20:41:06 +0000</created>
                <updated>Thu, 20 Sep 2018 17:51:17 +0000</updated>
                            <resolved>Thu, 10 May 2018 02:56:58 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>2.3.1</fixVersion>
                    <fixVersion>2.4.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16423479" author="rxin" created="Tue, 3 Apr 2018 05:10:56 +0000"  >&lt;p&gt;Does turning the flag&#160;parquet.filter.stats.enabled off also turning off row group level skipping?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16423491" author="henryr" created="Tue, 3 Apr 2018 05:27:47 +0000"  >&lt;p&gt;Partly, but not completely. If the column is dictionary encoded, the filters are applied to the dictionary as well at the row-group level. See &lt;a href=&quot;https://github.com/apache/parquet-mr/blob/master/parquet-hadoop/src/main/java/org/apache/parquet/filter2/compat/RowGroupFilter.java#L92&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;RowGroupFilter&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16436292" author="henryr" created="Thu, 12 Apr 2018 20:53:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/henryr/spark/tree/spark-23852&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Here&apos;s a branch&lt;/a&gt; with a test that fails if &lt;a href=&quot;https://issues.apache.org/jira/browse/PARQUET-1217&quot; title=&quot;Incorrect handling of missing values in Statistics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PARQUET-1217&quot;&gt;&lt;del&gt;PARQUET-1217&lt;/del&gt;&lt;/a&gt; is not fixed.&lt;/p&gt;</comment>
                            <comment id="16450018" author="emaynard1121" created="Tue, 24 Apr 2018 15:01:52 +0000"  >&lt;p&gt;&lt;font color=&quot;#333333&quot;&gt;&amp;gt;There is no upstream release of Parquet that contains the fix for &lt;/font&gt;PARQUET-1217&lt;font color=&quot;#333333&quot;&gt;, although a 1.10 release is planned.&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PARQUET-1217&quot; title=&quot;Incorrect handling of missing values in Statistics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PARQUET-1217&quot;&gt;&lt;del&gt;PARQUET-1217&lt;/del&gt;&lt;/a&gt;&#160;seems to have been merged into Parquet 1.8.3 today.&lt;/p&gt;</comment>
                            <comment id="16451263" author="henryr" created="Tue, 24 Apr 2018 21:42:12 +0000"  >&lt;p&gt;Yes it has - the Parquet community are going to do a 1.8.3 release, mostly just for us for this issue. Parquet 1.10 has already been released, and includes this fix. Upgrading Spark trunk to that version is the subject of &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-23972&quot; title=&quot;Upgrade to Parquet 1.10&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-23972&quot;&gt;&lt;del&gt;SPARK-23972&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16469330" author="apachespark" created="Wed, 9 May 2018 19:10:06 +0000"  >&lt;p&gt;User &apos;henryr&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/21284&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21284&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16472494" author="apachespark" created="Fri, 11 May 2018 19:06:04 +0000"  >&lt;p&gt;User &apos;henryr&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/21302&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21302&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16474819" author="apachespark" created="Mon, 14 May 2018 21:25:05 +0000"  >&lt;p&gt;User &apos;henryr&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/21323&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21323&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13138788">PARQUET-1217</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 27 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3s2a7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>