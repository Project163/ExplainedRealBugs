<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:07:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-29232] RandomForestRegressionModel does not update the parameter maps of the DecisionTreeRegressionModels underneath</title>
                <link>https://issues.apache.org/jira/browse/SPARK-29232</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;We trained a RandomForestRegressionModel, and tried to access the trees. Even though the DecisionTreeRegressionModel is correctly built with the proper parameters from random forest, the parameter map is not updated, and still contains only the default value.&#160;&lt;/p&gt;

&lt;p&gt;For example, if a RandomForestRegressor was trained with maxDepth of 12, then accessing the tree information, extractParamMap still returns the default values, with maxDepth=5. Calling the depth itself of&#160;DecisionTreeRegressionModel returns the correct value of 12 though.&lt;/p&gt;

&lt;p&gt;This creates issues when we want to access each individual tree and build the trees back up for the random forest estimator.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13258623">SPARK-29232</key>
            <summary>RandomForestRegressionModel does not update the parameter maps of the DecisionTreeRegressionModels underneath</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="huaxingao">Huaxin Gao</assignee>
                                    <reporter username="jiaqig">Jiaqi Guo</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Sep 2019 18:41:09 +0000</created>
                <updated>Tue, 22 Oct 2019 14:48:27 +0000</updated>
                            <resolved>Tue, 22 Oct 2019 09:52:45 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>ML</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16937694" author="aman_omer" created="Wed, 25 Sep 2019 12:44:21 +0000"  >&lt;p&gt;I would like to analyse this.&#160;&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jiaqig&quot; class=&quot;user-hover&quot; rel=&quot;jiaqig&quot;&gt;jiaqig&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16939293" author="aman_omer" created="Fri, 27 Sep 2019 10:09:14 +0000"  >&lt;p&gt;I used some examples for RF regression but can&apos;t use model.extractParamMap(). I am stuck here.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jiaqig&quot; class=&quot;user-hover&quot; rel=&quot;jiaqig&quot;&gt;jiaqig&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shahid&quot; class=&quot;user-hover&quot; rel=&quot;shahid&quot;&gt;shahid&lt;/a&gt;&#160;any lead to reproduce this bug will be helpful.&#160;&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="16939712" author="jiaqig" created="Fri, 27 Sep 2019 19:20:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aman_omer&quot; class=&quot;user-hover&quot; rel=&quot;aman_omer&quot;&gt;aman_omer&lt;/a&gt;, here is &lt;a href=&quot;#random-forest-regression]&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;an example from the Spark documentation&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.ml.Pipeline
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.ml.evaluation.RegressionEvaluator
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.ml.feature.VectorIndexer
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.ml.regression.{RandomForestRegressionModel, RandomForestRegressor}

&lt;span class=&quot;code-comment&quot;&gt;// Load and parse the data file, converting it to a DataFrame.
&lt;/span&gt;val data = spark.read.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;libsvm&quot;&lt;/span&gt;).load(&lt;span class=&quot;code-quote&quot;&gt;&quot;data/mllib/sample_libsvm_data.txt&quot;&lt;/span&gt;)

&lt;span class=&quot;code-comment&quot;&gt;// Set maxCategories so features with &amp;gt; 4 distinct values are treated as continuous.
&lt;/span&gt;val featureIndexer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; VectorIndexer()
  .setInputCol(&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;)
  .setOutputCol(&lt;span class=&quot;code-quote&quot;&gt;&quot;indexedFeatures&quot;&lt;/span&gt;)
  .setMaxCategories(4)
  .fit(data)

&lt;span class=&quot;code-comment&quot;&gt;// Split the data into training and test sets (30% held out &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; testing).
&lt;/span&gt;val Array(trainingData, testData) = data.randomSplit(Array(0.7, 0.3))

&lt;span class=&quot;code-comment&quot;&gt;// Train a RandomForest model.
&lt;/span&gt;val rf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RandomForestRegressor()
  .setNumTrees(5)
  .setMaxDepth(10)
  .setLabelCol(&lt;span class=&quot;code-quote&quot;&gt;&quot;label&quot;&lt;/span&gt;)
  .setFeaturesCol(&lt;span class=&quot;code-quote&quot;&gt;&quot;indexedFeatures&quot;&lt;/span&gt;)

&lt;span class=&quot;code-comment&quot;&gt;// Chain indexer and forest in a Pipeline.
&lt;/span&gt;val pipeline = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Pipeline()
  .setStages(Array(featureIndexer, rf))

&lt;span class=&quot;code-comment&quot;&gt;// Train model. This also runs the indexer.
&lt;/span&gt;val model = pipeline.fit(trainingData)

&lt;span class=&quot;code-comment&quot;&gt;// Make predictions.
&lt;/span&gt;val predictions = model.transform(testData)

&lt;span class=&quot;code-comment&quot;&gt;// Select example rows to display.
&lt;/span&gt;predictions.select(&lt;span class=&quot;code-quote&quot;&gt;&quot;prediction&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;label&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;).show(5)

&lt;span class=&quot;code-comment&quot;&gt;// Select (prediction, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; label) and compute test error.
&lt;/span&gt;val evaluator = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RegressionEvaluator()
  .setLabelCol(&lt;span class=&quot;code-quote&quot;&gt;&quot;label&quot;&lt;/span&gt;)
  .setPredictionCol(&lt;span class=&quot;code-quote&quot;&gt;&quot;prediction&quot;&lt;/span&gt;)
  .setMetricName(&lt;span class=&quot;code-quote&quot;&gt;&quot;rmse&quot;&lt;/span&gt;)
val rmse = evaluator.evaluate(predictions)
println(s&lt;span class=&quot;code-quote&quot;&gt;&quot;Root Mean Squared Error (RMSE) on test data = $rmse&quot;&lt;/span&gt;)
val rfModel = model.stages(1).asInstanceOf[RandomForestRegressionModel]
println(s&lt;span class=&quot;code-quote&quot;&gt;&quot;Learned regression forest model:\n ${rfModel.toDebugString}&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This gives you a random forest model called rfModel. I modified the max depth to 10 for the trees.&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
rfModel.extractParamMap()
&lt;span class=&quot;code-comment&quot;&gt;// Printout
&lt;/span&gt;res23: org.apache.spark.ml.param.ParamMap = { rfr_8197914ca605-cacheNodeIds: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, rfr_8197914ca605-checkpointInterval: 10, rfr_8197914ca605-featureSubsetStrategy: auto, rfr_8197914ca605-featuresCol: indexedFeatures, rfr_8197914ca605-impurity: variance, rfr_8197914ca605-labelCol: label, rfr_8197914ca605-maxBins: 32, rfr_8197914ca605-maxDepth: 10, rfr_8197914ca605-maxMemoryInMB: 256, rfr_8197914ca605-minInfoGain: 0.0, rfr_8197914ca605-minInstancesPerNode: 1, rfr_8197914ca605-numTrees: 5, rfr_8197914ca605-predictionCol: prediction, rfr_8197914ca605-seed: 235498149, rfr_8197914ca605-subsamplingRate: 1.0 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As you can see the maxDepth here is correct. However, if we were to check the parameter map of the trees.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
rfModel.trees(0).extractParamMap()
&lt;span class=&quot;code-comment&quot;&gt;// Printout
&lt;/span&gt;res22: org.apache.spark.ml.param.ParamMap = { dtr_bfcfc13f1334-cacheNodeIds: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, dtr_bfcfc13f1334-checkpointInterval: 10, dtr_bfcfc13f1334-featuresCol: features, dtr_bfcfc13f1334-impurity: variance, dtr_bfcfc13f1334-labelCol: label, dtr_bfcfc13f1334-maxBins: 32, dtr_bfcfc13f1334-maxDepth: 5, dtr_bfcfc13f1334-maxMemoryInMB: 256, dtr_bfcfc13f1334-minInfoGain: 0.0, dtr_bfcfc13f1334-minInstancesPerNode: 1, dtr_bfcfc13f1334-predictionCol: prediction, dtr_bfcfc13f1334-seed: 1366634793 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The max depth stays at the default value 5. In fact, parameter maps of individual trees will only give the default decision tree values.&lt;/p&gt;</comment>
                            <comment id="16940919" author="aman_omer" created="Mon, 30 Sep 2019 12:14:50 +0000"  >&lt;p&gt;Thnaks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jiaqig&quot; class=&quot;user-hover&quot; rel=&quot;jiaqig&quot;&gt;jiaqig&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16956880" author="podongfeng" created="Tue, 22 Oct 2019 09:52:45 +0000"  >&lt;p&gt;Issue resolved by pull request 26154&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/26154&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/26154&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z06z48:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>