<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:59:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-23271] Parquet output contains only &quot;_SUCCESS&quot; file after empty DataFrame saving </title>
                <link>https://issues.apache.org/jira/browse/SPARK-23271</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Sophisticated case, reproduced only if read empty CSV file without header with assigned schema.&lt;/p&gt;

&lt;p&gt;Steps for reproduce (Scala):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val anySchema = StructType(StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;anyName&quot;&lt;/span&gt;, StringType, nullable = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;) :: Nil)

val inputDF = spark.read.schema(anySchema).csv(inputFolderWithEmptyCSVFile)
inputDF.write.parquet(outputFolderName)

&lt;span class=&quot;code-comment&quot;&gt;// Exception: org.apache.spark.sql.AnalysisException: Unable to infer schema &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Parquet. It must be specified manually.;
&lt;/span&gt;val actualDF = spark.read.parquet(outputFolderName)
&#160;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Actual:&lt;/b&gt;&#160;Only &quot;_SUCCESS&quot; file in&#160;output directory&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Expected&lt;/b&gt;: at least one Parquet file with schema.&lt;/p&gt;

&lt;p&gt;Project for reproduce is attached.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13134725">SPARK-23271</key>
            <summary>Parquet output contains only &quot;_SUCCESS&quot; file after empty DataFrame saving </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkbiswal">Dilip Biswal</assignee>
                                    <reporter username="pmz0178">Pavlo Z.</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Jan 2018 11:30:16 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:00 +0000</updated>
                            <resolved>Thu, 8 Mar 2018 22:59:08 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.4.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16345181" author="srowen" created="Tue, 30 Jan 2018 15:04:00 +0000"  >&lt;p&gt;That might be &apos;by design&apos; but by symmetry you might well expect writing an empty file produces something you can read. Then again, there&apos;s nothing to write, and reading nothing should be an error.&lt;/p&gt;</comment>
                            <comment id="16345228" author="pmz0178" created="Tue, 30 Jan 2018 15:31:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt;&lt;br/&gt;
In example&#160;schema is provided, and this schema have to be written to output, with no&#160;data.&lt;/p&gt;

&lt;p&gt;if use such&#160;empty dataframe instead of CSV:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val inputDF = List.empty[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;].toDF()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;in output directory present &quot;parquet&quot; file, and output&#160;is read without errors; for me it looks correct.&lt;/p&gt;

&lt;p&gt;Behaviour for CSV file is&#160;different.&lt;/p&gt;

&lt;p&gt;Looks like it is bug - empty DataFrame cannot be written differently, depending on source.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16346828" author="gurwls223" created="Wed, 31 Jan 2018 13:31:53 +0000"  >&lt;p&gt;To be clear, it&apos;s orthogonal with &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-15393&quot; title=&quot;Writing empty Dataframes doesn&amp;#39;t save any _metadata files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-15393&quot;&gt;&lt;del&gt;SPARK-15393&lt;/del&gt;&lt;/a&gt; if I understood correctly, by the way.&lt;/p&gt;</comment>
                            <comment id="16348217" author="pmz0178" created="Thu, 1 Feb 2018 08:45:10 +0000"  >&lt;p&gt;Yes, &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-15393&quot; title=&quot;Writing empty Dataframes doesn&amp;#39;t save any _metadata files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-15393&quot;&gt;&lt;del&gt;SPARK-15393&lt;/del&gt;&lt;/a&gt; is similar, linked in JIRA to this issue.&lt;br/&gt;
Such code can be used as workaround:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (originalDF.rdd.isEmpty) {
      originalDF.sparkSession.createDataFrame(List.empty[Row].asJava, originalDF.schema)
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      originalDF
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16349649" author="dkbiswal" created="Fri, 2 Feb 2018 01:58:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt;&lt;br/&gt;
 I took a look at this. To the best of my knowledge, the difference in the behaviour between these two cases is because of the following :&lt;br/&gt;
 case 1&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; List.empty[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;].toDF().rdd.partitions.length
res18: Int = 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Case 2&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; val anySchema = StructType(StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;anyName&quot;&lt;/span&gt;, StringType, nullable = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;) :: Nil)
anySchema: org.apache.spark.sql.types.StructType = StructType(StructField(anyName,StringType,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;))
scala&amp;gt; spark.read.schema(anySchema).csv(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/empty_folder&quot;&lt;/span&gt;).rdd.partitions.length
res22: Int = 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For the 2nd case, since number of partitions = 0, we don&apos;t call the write task (the task has logic to create the empty parquet file).&lt;br/&gt;
 I tried to repartition the input RDD after&#160;&lt;a href=&quot;https://github.com/apache/spark/blob/master/sql/core/src/main/scala/org/apache/spark/sql/execution/datasources/FileFormatWriter.scala#L180&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; if input number of partitions = 0, before setting up the write job and things seem to work well.&lt;/p&gt;

&lt;p&gt;Would this be a reasonable way to fix this ? Appreciate your feedback.&lt;/p&gt;</comment>
                            <comment id="16353517" author="smilegator" created="Tue, 6 Feb 2018 07:46:13 +0000"  >&lt;p&gt;For this behavior, I remember &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zsxwing&quot; class=&quot;user-hover&quot; rel=&quot;zsxwing&quot;&gt;zsxwing&lt;/a&gt; and I had a discussion a few months ago. However, I forgot the conclusion we made. : )&lt;/p&gt;</comment>
                            <comment id="16353998" author="smilegator" created="Tue, 6 Feb 2018 15:21:40 +0000"  >&lt;p&gt;After a discussion with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt;, we think the behavior should be consistent regardless the number of RDD partitions. Thanks!&lt;/p&gt;</comment>
                            <comment id="16354384" author="dkbiswal" created="Tue, 6 Feb 2018 19:09:56 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smilegator&quot; class=&quot;user-hover&quot; rel=&quot;smilegator&quot;&gt;smilegator&lt;/a&gt;. I will try to create a PR to fix this by trying to repartition the RDD before setting up the write job. &lt;br/&gt;
We can discuss whether its the right approach to fix this issue in the PR.&lt;/p&gt;</comment>
                            <comment id="16355097" author="apachespark" created="Wed, 7 Feb 2018 07:54:04 +0000"  >&lt;p&gt;User &apos;dilipbiswal&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/20525&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20525&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16357399" author="apachespark" created="Thu, 8 Feb 2018 18:50:05 +0000"  >&lt;p&gt;User &apos;dilipbiswal&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/20551&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20551&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16392072" author="cloud_fan" created="Thu, 8 Mar 2018 22:59:08 +0000"  >&lt;p&gt;Issue resolved by pull request 20525&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/20525&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20525&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12970923">SPARK-15393</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12908319" name="parquet-empty-output.zip" size="3537" author="pmz0178" created="Tue, 30 Jan 2018 11:30:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3pj93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>