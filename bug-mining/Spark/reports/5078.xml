<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:55:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-21176] Master UI hangs with spark.ui.reverseProxy=true if the master node has many CPUs</title>
                <link>https://issues.apache.org/jira/browse/SPARK-21176</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;In reverse proxy mode, Sparks exhausts the Jetty thread pool if the master node has too many cpus or the cluster has too many executers:&lt;/p&gt;

&lt;p&gt;For each ProxyServlet, Jetty creates Selector threads: minimum 4, maximum half the number of available CPUs:&lt;br/&gt;
&lt;tt&gt;this(Math.max(1, Runtime.getRuntime().availableProcessors() / 2));&lt;/tt&gt;&lt;br/&gt;
(see &lt;a href=&quot;https://github.com/eclipse/jetty.project/blob/0c8273f2ca1f9bf2064cd9c4c939d2546443f759/jetty-client/src/main/java/org/eclipse/jetty/client/http/HttpClientTransportOverHTTP.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse/jetty.project/blob/0c8273f2ca1f9bf2064cd9c4c939d2546443f759/jetty-client/src/main/java/org/eclipse/jetty/client/http/HttpClientTransportOverHTTP.java&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;In reverse proxy mode, a proxy servlet is set up for each executor.&lt;br/&gt;
I have a system with 7 executors and 88 CPUs on the master node. Jetty tries to instantiate 7*44 = 309 selector threads just for the reverse proxy servlets, but since the QueuedThreadPool is initialized with 200 threads by default, the UI gets stuck.&lt;/p&gt;

&lt;p&gt;I have patched JettyUtils.scala to extend the thread pool ( &lt;tt&gt;val pool = new QueuedThreadPool(400)&lt;/tt&gt;). With this hack, the UI works.&lt;/p&gt;

&lt;p&gt;Obviously, the Jetty defaults are meant for a real web server. If that has 88 CPUs, you do certainly expect a lot of traffic.&lt;br/&gt;
For the Spark admin UI however, there will rarely be concurrent accesses for the same application or the same executor.&lt;br/&gt;
I therefore propose to dramatically reduce the number of selector threads that get instantiated - at least by default.&lt;/p&gt;

&lt;p&gt;I will propose a fix in a pull request.&lt;/p&gt;</description>
                <environment>&lt;p&gt;ppc64le GNU/Linux, POWER8, only master node is reachable externally other nodes are in an internal network&lt;/p&gt;</environment>
        <key id="13081695">SPARK-21176</key>
            <summary>Master UI hangs with spark.ui.reverseProxy=true if the master node has many CPUs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="IngoSchuster">Ingo Schuster</assignee>
                                    <reporter username="IngoSchuster">Ingo Schuster</reporter>
                        <labels>
                            <label>network</label>
                            <label>web-ui</label>
                    </labels>
                <created>Thu, 22 Jun 2017 08:27:42 +0000</created>
                <updated>Sat, 1 Jul 2017 10:43:03 +0000</updated>
                            <resolved>Fri, 30 Jun 2017 03:17:14 +0000</resolved>
                                    <version>2.1.0</version>
                    <version>2.1.1</version>
                    <version>2.2.0</version>
                    <version>2.2.1</version>
                                    <fixVersion>2.1.2</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>Web UI</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16060553" author="ingoschuster" created="Fri, 23 Jun 2017 08:12:03 +0000"  >&lt;p&gt;Best way I can see to control the number of selectors, is to overwrite the newHttpClient() method of ProxyServlet in our JettyUtils.scala.&lt;br/&gt;
It&apos;s a pitty that the constructor of ProxyServlet does not allow to overwrite the selector default.&lt;br/&gt;
Maybe something to clean up the code in future, I have opened an respective request  for Jetty: &lt;a href=&quot;https://github.com/eclipse/jetty.project/issues/1643&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse/jetty.project/issues/1643&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16064747" author="apachespark" created="Tue, 27 Jun 2017 12:25:03 +0000"  >&lt;p&gt;User &apos;IngoSchuster&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18437&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18437&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16069407" author="cloud_fan" created="Fri, 30 Jun 2017 03:17:15 +0000"  >&lt;p&gt;Issue resolved by pull request 18437&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18437&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18437&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16071176" author="apachespark" created="Sat, 1 Jul 2017 10:43:03 +0000"  >&lt;p&gt;User &apos;aosagie&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18499&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18499&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                            <outwardlinks description="is a clone of">
                                        <issuelink>
            <issuekey id="13074144">SPARK-20853</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 20 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3glcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>