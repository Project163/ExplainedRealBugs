<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:51:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-19796] taskScheduler fails serializing long statements received by thrift server</title>
                <link>https://issues.apache.org/jira/browse/SPARK-19796</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;This problem was observed after the changes made for &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-17931&quot; title=&quot;taskScheduler has some unneeded serialization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-17931&quot;&gt;&lt;del&gt;SPARK-17931&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In my use-case I&apos;m sending very long insert statements to Spark thrift server and they are failing at TaskDescription.scala:89 because writeUTF fails if requested to write strings longer than 64Kb (see &lt;a href=&quot;https://www.drillio.com/en/2009/java-encoded-string-too-long-64kb-limit/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.drillio.com/en/2009/java-encoded-string-too-long-64kb-limit/&lt;/a&gt; for a description of the issue).&lt;/p&gt;

&lt;p&gt;As suggested by Imran Rashid I tracked down the offending key: it is &quot;spark.job.description&quot; and it contains the complete SQL statement.&lt;/p&gt;

&lt;p&gt;The problem can be reproduced by creating a table like:&lt;br/&gt;
create table test (a int) using parquet&lt;/p&gt;

&lt;p&gt;and by sending an insert statement like:&lt;br/&gt;
scala&amp;gt; val r = 1 to 128000&lt;br/&gt;
scala&amp;gt; println(&quot;insert into table test values (&quot; + r.mkString(&quot;),(&quot;) + &quot;)&quot;)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13047640">SPARK-19796</key>
            <summary>taskScheduler fails serializing long statements received by thrift server</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="irashid">Imran Rashid</assignee>
                                    <reporter username="gbloisi">Giambattista</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Mar 2017 10:25:40 +0000</created>
                <updated>Mon, 6 Mar 2017 20:18:26 +0000</updated>
                            <resolved>Mon, 6 Mar 2017 20:06:34 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.2.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15892390" author="irashid" created="Thu, 2 Mar 2017 15:16:03 +0000"  >&lt;p&gt;Since its a regression, I&apos;m making this a blocker for 2.2.0  (or else we revert &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-17931&quot; title=&quot;taskScheduler has some unneeded serialization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-17931&quot;&gt;&lt;del&gt;SPARK-17931&lt;/del&gt;&lt;/a&gt;, but the fix should be simple).&lt;/p&gt;</comment>
                            <comment id="15892482" author="apachespark" created="Thu, 2 Mar 2017 16:12:03 +0000"  >&lt;p&gt;User &apos;squito&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17140&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17140&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15892547" author="irashid" created="Thu, 2 Mar 2017 16:32:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kayousterhout&quot; class=&quot;user-hover&quot; rel=&quot;kayousterhout&quot;&gt;kayousterhout&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shivaram&quot; class=&quot;user-hover&quot; rel=&quot;shivaram&quot;&gt;shivaram&lt;/a&gt; here&apos;s another example of serializing lots of pointless data in each task &amp;#8211; in this case, &lt;tt&gt;TaskDescription.properties&lt;/tt&gt; contains lots of data which the executors don&apos;t care about.  and this gets serialized once per task.&lt;/p&gt;

&lt;p&gt;For this jira, I&apos;ll just do a small fix, but I thought you might be interested in this.&lt;/p&gt;</comment>
                            <comment id="15893376" author="kayousterhout" created="Fri, 3 Mar 2017 00:28:26 +0000"  >&lt;p&gt;Do you think we should (separately) fix the underlying problem?  Specifically, we could:&lt;/p&gt;

&lt;p&gt;(a) not send the SPARK_JOB_DESCRIPTION property to the workers, since it&apos;s only used on the master for the UI (and while users &lt;b&gt;could&lt;/b&gt; access it, the variable name SPARK_JOB_DESCRIPTION is spark-private, which suggests that it shouldn&apos;t be used by users).  Perhaps this is too risky because users could be using it?&lt;/p&gt;

&lt;p&gt;(b) Truncate SPARK_JOB_DESCRIPTION to something reasonable (100 characters?) before sending it to the workers.  This is more backwards compatible if users are actually reading the property, but maybe a useless intermediate approach?&lt;/p&gt;

&lt;p&gt;(c) (Possibly in addition to one of the above) Log a warning if any of the properties is longer than 100 characters (or some threshold).&lt;/p&gt;

&lt;p&gt;Thoughts?  I can file a JIRA if you think any of these is worthwhile.&lt;/p&gt;</comment>
                            <comment id="15893584" author="mridulm80" created="Fri, 3 Mar 2017 02:12:11 +0000"  >
&lt;p&gt;I would not prefer (b) - if we are worried that users are depending on a private property, sending a truncated version of it is to aggravate it ! I would rather fail-fast with missing value.&lt;/p&gt;

&lt;p&gt;Having said that, while we should limit our internal usage of properties, since this is also used to propagate user specified key value pairs; adding limits or log messages might not be optimal. Worst case, if we start detecting that the properties Map is growing really large, we could broadcast it (ugh ?).&lt;/p&gt;</comment>
                            <comment id="15893736" author="shivaram" created="Fri, 3 Mar 2017 04:42:17 +0000"  >&lt;p&gt;I think (a) is worth exploring in a new JIRA &amp;#8211; We should try to avoid sending data that we dont need on the executors during task execution.&lt;/p&gt;</comment>
                            <comment id="15897959" author="irashid" created="Mon, 6 Mar 2017 20:06:34 +0000"  >&lt;p&gt;Issue resolved by pull request 17140&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17140&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17140&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15897997" author="irashid" created="Mon, 6 Mar 2017 20:18:26 +0000"  >&lt;p&gt;I&apos;m opposed to (b) as well.&lt;/p&gt;

&lt;p&gt;It feels wrong to only do a one-off just for JOB_DESCRIPTION, but maybe its a large enough savings that its worth doing.  I was thinking of something larger, along the lines of &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-19108&quot; title=&quot;Broadcast all shared parts of tasks (to reduce task serialization time)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-19108&quot;&gt;&lt;del&gt;SPARK-19108&lt;/del&gt;&lt;/a&gt;.  Another option would be to add new apis, eg., jobs would take `driverProperties` and `executorProperties`, but maybe that is overkill.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13012239">SPARK-17931</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3auhb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>