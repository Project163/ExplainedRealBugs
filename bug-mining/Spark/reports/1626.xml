<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:25:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-6571] MatrixFactorizationModel created by load fails on predictAll</title>
                <link>https://issues.apache.org/jira/browse/SPARK-6571</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;This code, adapted from the documentation, fails when using a loaded model.&lt;br/&gt;
from pyspark.mllib.recommendation import ALS, Rating, MatrixFactorizationModel&lt;/p&gt;

&lt;p&gt;r1 = (1, 1, 1.0)&lt;br/&gt;
r2 = (1, 2, 2.0)&lt;br/&gt;
r3 = (2, 1, 2.0)&lt;br/&gt;
ratings = sc.parallelize(&lt;span class=&quot;error&quot;&gt;&amp;#91;r1, r2, r3&amp;#93;&lt;/span&gt;)&lt;br/&gt;
model = ALS.trainImplicit(ratings, 1, seed=10)&lt;br/&gt;
print &apos;(2, 2)&apos;, model.predict(2, 2)&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;0.43...&lt;br/&gt;
testset = sc.parallelize(&lt;span class=&quot;error&quot;&gt;&amp;#91;(1, 2), (1, 1)&amp;#93;&lt;/span&gt;)&lt;br/&gt;
print &apos;all&apos;, model.predictAll(testset).collect()&lt;/li&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Rating(user=1, product=1, rating=1.0...), Rating(user=1, product=2, rating=1.9...)&amp;#93;&lt;/span&gt;&lt;br/&gt;
import os, tempfile&lt;br/&gt;
path = tempfile.mkdtemp()&lt;br/&gt;
model.save(sc, path)&lt;br/&gt;
sameModel = MatrixFactorizationModel.load(sc, path)&lt;br/&gt;
print &apos;(2, 2)&apos;, sameModel.predict(2,2)&lt;br/&gt;
sameModel.predictAll(testset).collect()&lt;/li&gt;
&lt;/ol&gt;



&lt;p&gt;This gives&lt;br/&gt;
(2, 2) 0.443547642944&lt;br/&gt;
all &lt;span class=&quot;error&quot;&gt;&amp;#91;Rating(user=1, product=1, rating=1.1538351103381217), Rating(user=1, product=2, rating=0.7153473708381739)&amp;#93;&lt;/span&gt;&lt;br/&gt;
(2, 2) 0.443547642944&lt;br/&gt;
---------------------------------------------------------------------------&lt;br/&gt;
Py4JError                                 Traceback (most recent call last)&lt;br/&gt;
&amp;lt;ipython-input-18-af6612bed9d0&amp;gt; in &amp;lt;module&amp;gt;()&lt;br/&gt;
     19 sameModel = MatrixFactorizationModel.load(sc, path)&lt;br/&gt;
     20 print &apos;(2, 2)&apos;, sameModel.predict(2,2)&lt;br/&gt;
---&amp;gt; 21 sameModel.predictAll(testset).collect()&lt;br/&gt;
     22 &lt;/p&gt;

&lt;p&gt;/home/ubuntu/spark/python/pyspark/mllib/recommendation.pyc in predictAll(self, user_product)&lt;br/&gt;
    104         assert len(first) == 2, &quot;user_product should be RDD of (user, product)&quot;&lt;br/&gt;
    105         user_product = user_product.map(lambda (u, p): (int(u), int(p)))&lt;br/&gt;
--&amp;gt; 106         return self.call(&quot;predict&quot;, user_product)&lt;br/&gt;
    107 &lt;br/&gt;
    108     def userFeatures(self):&lt;/p&gt;

&lt;p&gt;/home/ubuntu/spark/python/pyspark/mllib/common.pyc in call(self, name, *a)&lt;br/&gt;
    134     def call(self, name, *a):&lt;br/&gt;
    135         &quot;&quot;&quot;Call method of java_model&quot;&quot;&quot;&lt;br/&gt;
--&amp;gt; 136         return callJavaFunc(self._sc, getattr(self._java_model, name), *a)&lt;br/&gt;
    137 &lt;br/&gt;
    138 &lt;/p&gt;

&lt;p&gt;/home/ubuntu/spark/python/pyspark/mllib/common.pyc in callJavaFunc(sc, func, *args)&lt;br/&gt;
    111     &quot;&quot;&quot; Call Java Function &quot;&quot;&quot;&lt;br/&gt;
    112     args = &lt;span class=&quot;error&quot;&gt;&amp;#91;_py2java(sc, a) for a in args&amp;#93;&lt;/span&gt;&lt;br/&gt;
--&amp;gt; 113     return _java2py(sc, func(*args))&lt;br/&gt;
    114 &lt;br/&gt;
    115 &lt;/p&gt;

&lt;p&gt;/home/ubuntu/spark/python/lib/py4j-0.8.2.1-src.zip/py4j/java_gateway.py in _&lt;em&gt;call&lt;/em&gt;_(self, *args)&lt;br/&gt;
    536         answer = self.gateway_client.send_command(command)&lt;br/&gt;
    537         return_value = get_return_value(answer, self.gateway_client,&lt;br/&gt;
--&amp;gt; 538                 self.target_id, self.name)&lt;br/&gt;
    539 &lt;br/&gt;
    540         for temp_arg in temp_args:&lt;/p&gt;

&lt;p&gt;/home/ubuntu/spark/python/lib/py4j-0.8.2.1-src.zip/py4j/protocol.py in get_return_value(answer, gateway_client, target_id, name)&lt;br/&gt;
    302                 raise Py4JError(&lt;br/&gt;
    303                     &apos;An error occurred while calling &lt;/p&gt;
{0}
{1}
{2}
&lt;p&gt;. Trace:\n&lt;/p&gt;
{3}
&lt;p&gt;\n&apos;.&lt;br/&gt;
--&amp;gt; 304                     format(target_id, &apos;.&apos;, name, value))&lt;br/&gt;
    305         else:&lt;br/&gt;
    306             raise Py4JError(&lt;/p&gt;

&lt;p&gt;Py4JError: An error occurred while calling o450.predict. Trace:&lt;br/&gt;
py4j.Py4JException: Method predict(&lt;span class=&quot;error&quot;&gt;&amp;#91;class org.apache.spark.api.java.JavaRDD&amp;#93;&lt;/span&gt;) does not exist&lt;br/&gt;
	at py4j.reflection.ReflectionEngine.getMethod(ReflectionEngine.java:333)&lt;br/&gt;
	at py4j.reflection.ReflectionEngine.getMethod(ReflectionEngine.java:342)&lt;br/&gt;
	at py4j.Gateway.invoke(Gateway.java:252)&lt;br/&gt;
	at py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:133)&lt;br/&gt;
	at py4j.commands.CallCommand.execute(CallCommand.java:79)&lt;br/&gt;
	at py4j.GatewayConnection.run(GatewayConnection.java:207)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:744)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12786201">SPARK-6571</key>
            <summary>MatrixFactorizationModel created by load fails on predictAll</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mengxr">Xiangrui Meng</assignee>
                                    <reporter username="cchayden">Charles Hayden</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Mar 2015 13:38:06 +0000</created>
                <updated>Mon, 30 Mar 2015 21:28:50 +0000</updated>
                            <resolved>Mon, 30 Mar 2015 21:28:50 +0000</resolved>
                                    <version>1.3.0</version>
                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                    <component>MLlib</component>
                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14384491" author="josephkb" created="Fri, 27 Mar 2015 19:48:55 +0000"  >&lt;p&gt;Thanks for the detailed report!  I was able to reproduce the bug too.  Looking into it...&lt;/p&gt;</comment>
                            <comment id="14385414" author="apachespark" created="Sat, 28 Mar 2015 17:02:42 +0000"  >&lt;p&gt;User &apos;mengxr&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/5243&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/5243&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 34 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i27g9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329486">1.3.1</customfieldvalue>
    <customfieldvalue id="12329359">1.4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>