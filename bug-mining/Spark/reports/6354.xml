<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:04:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-26927] Race condition may cause dynamic allocation not working</title>
                <link>https://issues.apache.org/jira/browse/SPARK-26927</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Recently, we catch a bug that caused our production spark thriftserver hangs:&lt;/p&gt;

&lt;p&gt;There is a race condition in the ExecutorAllocationManager that the `SparkListenerExecutorRemoved` event is posted before the `SparkListenerTaskStart` event, which will cause the incorrect result of `executorIds`, then when some executor idles, the real executors will be removed even executor number is equal to `minNumExecutors` due to the incorrect computation of `newExecutorTotal`(may greater than the `minNumExecutors`), thus may finally causing zero available executors but a wrong number of executorIds was kept in memory.&lt;/p&gt;

&lt;p&gt;What&apos;s more, even the `SparkListenerTaskEnd` event can not make the fake `executorIds` released, because later idle event for the fake executors can not cause the real removal of these executors, as they are already removed and they are not exist in the `executorDataMap`&#160; of `CoaseGrainedSchedulerBackend`.&lt;/p&gt;

&lt;p&gt;Logs:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12959215/12959215_Selection_042.jpg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12959216/12959216_Selection_043.jpg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12959217/12959217_Selection_044.jpg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12959218/12959218_Selection_045.jpg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12959219/12959219_Selection_046.jpg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &#160;&lt;/p&gt;

&lt;p&gt;EventLogs(DisOrder of events):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{&lt;span class=&quot;code-quote&quot;&gt;&quot;Event&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;SparkListenerExecutorRemoved&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Timestamp&quot;&lt;/span&gt;:1549936077543,&lt;span class=&quot;code-quote&quot;&gt;&quot;Executor ID&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;131&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Removed Reason&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Container container_e28_1547530852233_236191_02_000180 exited from explicit termination request.&quot;&lt;/span&gt;}

{&lt;span class=&quot;code-quote&quot;&gt;&quot;Event&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;SparkListenerTaskStart&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Stage ID&quot;&lt;/span&gt;:136689,&lt;span class=&quot;code-quote&quot;&gt;&quot;Stage Attempt ID&quot;&lt;/span&gt;:0,&lt;span class=&quot;code-quote&quot;&gt;&quot;Task Info&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;Task ID&quot;&lt;/span&gt;:448048,&lt;span class=&quot;code-quote&quot;&gt;&quot;Index&quot;&lt;/span&gt;:2,&lt;span class=&quot;code-quote&quot;&gt;&quot;Attempt&quot;&lt;/span&gt;:0,&lt;span class=&quot;code-quote&quot;&gt;&quot;Launch Time&quot;&lt;/span&gt;:1549936032872,&lt;span class=&quot;code-quote&quot;&gt;&quot;Executor ID&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;131&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Host&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;mb2-hadoop-prc-st474.awsind&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Locality&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;RACK_LOCAL&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Speculative&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Getting Result Time&quot;&lt;/span&gt;:0,&lt;span class=&quot;code-quote&quot;&gt;&quot;Finish Time&quot;&lt;/span&gt;:1549936032906,&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Killed&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Accumulables&quot;&lt;/span&gt;:[{&lt;span class=&quot;code-quote&quot;&gt;&quot;ID&quot;&lt;/span&gt;:12923945,&lt;span class=&quot;code-quote&quot;&gt;&quot;Name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;internal.metrics.executorDeserializeTime&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Update&quot;&lt;/span&gt;:10,&lt;span class=&quot;code-quote&quot;&gt;&quot;Value&quot;&lt;/span&gt;:13,&lt;span class=&quot;code-quote&quot;&gt;&quot;Internal&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Count Faile d Values&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;},{&lt;span class=&quot;code-quote&quot;&gt;&quot;ID&quot;&lt;/span&gt;:12923946,&lt;span class=&quot;code-quote&quot;&gt;&quot;Name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;internal.metrics.executorDeserializeCpuTime&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Update&quot;&lt;/span&gt;:2244016,&lt;span class=&quot;code-quote&quot;&gt;&quot;Value&quot;&lt;/span&gt;:4286494,&lt;span class=&quot;code-quote&quot;&gt;&quot;Internal&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Count Failed Values&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;},{&lt;span class=&quot;code-quote&quot;&gt;&quot;ID&quot;&lt;/span&gt;:12923947,&lt;span class=&quot;code-quote&quot;&gt;&quot;Name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;internal.metrics.executorRunTime&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Update&quot;&lt;/span&gt;:20,&lt;span class=&quot;code-quote&quot;&gt;&quot;Val ue&quot;&lt;/span&gt;:39,&lt;span class=&quot;code-quote&quot;&gt;&quot;Internal&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Count Failed Values&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;},{&lt;span class=&quot;code-quote&quot;&gt;&quot;ID&quot;&lt;/span&gt;:12923948,&lt;span class=&quot;code-quote&quot;&gt;&quot;Name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;internal.metrics.executorCpuTime&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Update&quot;&lt;/span&gt;:13412614,&lt;span class=&quot;code-quote&quot;&gt;&quot;Value&quot;&lt;/span&gt;:26759061,&lt;span class=&quot;code-quote&quot;&gt;&quot;Internal&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Count Failed Values&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;},{&lt;span class=&quot;code-quote&quot;&gt;&quot;ID&quot;&lt;/span&gt;:12923949,&lt;span class=&quot;code-quote&quot;&gt;&quot;Name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;internal.metrics.resultS ize&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Update&quot;&lt;/span&gt;:3578,&lt;span class=&quot;code-quote&quot;&gt;&quot;Value&quot;&lt;/span&gt;:7156,&lt;span class=&quot;code-quote&quot;&gt;&quot;Internal&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Count Failed Values&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;},{&lt;span class=&quot;code-quote&quot;&gt;&quot;ID&quot;&lt;/span&gt;:12923954,&lt;span class=&quot;code-quote&quot;&gt;&quot;Name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;internal.metrics.peakExecutionMemory&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Update&quot;&lt;/span&gt;:33816576,&lt;span class=&quot;code-quote&quot;&gt;&quot;Value&quot;&lt;/span&gt;:67633152,&lt;span class=&quot;code-quote&quot;&gt;&quot;Internal&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Count Failed Values&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;},{&lt;span class=&quot;code-quote&quot;&gt;&quot;ID&quot;&lt;/span&gt;:12923962,&lt;span class=&quot;code-quote&quot;&gt;&quot;Na me&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;internal.metrics.shuffle.write.bytesWritten&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Update&quot;&lt;/span&gt;:1367,&lt;span class=&quot;code-quote&quot;&gt;&quot;Value&quot;&lt;/span&gt;:2774,&lt;span class=&quot;code-quote&quot;&gt;&quot;Internal&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Count Failed Values&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;},{&lt;span class=&quot;code-quote&quot;&gt;&quot;ID&quot;&lt;/span&gt;:12923963,&lt;span class=&quot;code-quote&quot;&gt;&quot;Name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;internal.metrics.shuffle.write.recordsWritten&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Update&quot;&lt;/span&gt;:23,&lt;span class=&quot;code-quote&quot;&gt;&quot;Value&quot;&lt;/span&gt;:45,&lt;span class=&quot;code-quote&quot;&gt;&quot;Internal&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Cou nt Failed Values&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;},{&lt;span class=&quot;code-quote&quot;&gt;&quot;ID&quot;&lt;/span&gt;:12923964,&lt;span class=&quot;code-quote&quot;&gt;&quot;Name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;internal.metrics.shuffle.write.writeTime&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Update&quot;&lt;/span&gt;:3259051,&lt;span class=&quot;code-quote&quot;&gt;&quot;Value&quot;&lt;/span&gt;:6858121,&lt;span class=&quot;code-quote&quot;&gt;&quot;Internal&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Count Failed Values&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;},{&lt;span class=&quot;code-quote&quot;&gt;&quot;ID&quot;&lt;/span&gt;:12921550,&lt;span class=&quot;code-quote&quot;&gt;&quot;Name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;number of output rows&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Update&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;158&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Value&quot;&lt;/span&gt; :&lt;span class=&quot;code-quote&quot;&gt;&quot;289&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Internal&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Count Failed Values&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Metadata&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;sql&quot;&lt;/span&gt;},{&lt;span class=&quot;code-quote&quot;&gt;&quot;ID&quot;&lt;/span&gt;:12921546,&lt;span class=&quot;code-quote&quot;&gt;&quot;Name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;number of output rows&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Update&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;23&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Value&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;45&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Internal&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Count Failed Values&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Metadata&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;sql&quot;&lt;/span&gt;},{&lt;span class=&quot;code-quote&quot;&gt;&quot;ID&quot;&lt;/span&gt;:12921547,&lt;span class=&quot;code-quote&quot;&gt;&quot;Name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;peak memo ry total (min, med, max)&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Update&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;33816575&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Value&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;67633149&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Internal&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Count Failed Values&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Metadata&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;sql&quot;&lt;/span&gt;},{&lt;span class=&quot;code-quote&quot;&gt;&quot;ID&quot;&lt;/span&gt;:12921541,&lt;span class=&quot;code-quote&quot;&gt;&quot;Name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;data size total (min, med, max)&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Update&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;551&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Value&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;1077&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Internal&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Count Failed Values&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Metadata&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;sql&quot;&lt;/span&gt;}]}}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13216559">SPARK-26927</key>
            <summary>Race condition may cause dynamic allocation not working</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="liupengcheng">liupengcheng</assignee>
                                    <reporter username="liupengcheng">liupengcheng</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Feb 2019 09:00:08 +0000</created>
                <updated>Sat, 23 Mar 2019 17:42:30 +0000</updated>
                            <resolved>Tue, 12 Mar 2019 21:27:41 +0000</resolved>
                                    <version>2.1.0</version>
                    <version>2.4.0</version>
                                    <fixVersion>2.3.4</fixVersion>
                    <fixVersion>2.4.1</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16776309" author="ngone51" created="Sun, 24 Feb 2019 16:17:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=liupengcheng&quot; class=&quot;user-hover&quot; rel=&quot;liupengcheng&quot;&gt;liupengcheng&lt;/a&gt; I can not understand the issue clearly by your desc. Can you&#160;elaborate it with&#160;a more simple and&#160;concrete example ?&lt;/p&gt;</comment>
                            <comment id="16777836" author="liupengcheng" created="Tue, 26 Feb 2019 11:36:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Ngone51&quot; class=&quot;user-hover&quot; rel=&quot;Ngone51&quot;&gt;Ngone51&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Let&apos;s say we got the following dynamic allocation settings:&#160;&lt;/p&gt;

&lt;p&gt;min: 20 initial: 20 max 50&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;we finished 50 tasks on 50 executors, and no more task to execute, thus 50 executors will idle, then allocationManager will try to remove the 50 idle executors, if everything goes well, with the min number of executors guards(20), allocationManager will keep 20 executors not killed.&lt;/li&gt;
	&lt;li&gt;However, imagine such a case: when the `SparkListenerExecutorRemoved` comes before the `SparkListenerTaskStart`. &#8211; It&apos;s possible because the `SparkListenerTaskStart` event is posted by `DAGSchedulerEventLoop` thread, but the `SparkListenerExecutorRemoved` event is posted by `Netty` threads.&#160;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160; &#160; &#160; &#160; &#160; In this case,&#160;we might get a wrong number of `executorIds` due to the following logic: &lt;a href=&quot;https://github.com/apache/spark/blob/bc03c8b3faacd23edf40b8e75ffd9abb5881c50c/core/src/main/scala/org/apache/spark/ExecutorAllocationManager.scala#L718&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/bc03c8b3faacd23edf40b8e75ffd9abb5881c50c/core/src/main/scala/org/apache/spark/ExecutorAllocationManager.scala#L718&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; &#160;Explain:&#160; allocationManager.executorIds does not contains executorId because it&apos;s removed in the onExecutorRemoved callback. so the removed executorId will be readded to the allocationManager.executorIds.&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160;3. Then, allocationManager&#160;now may think it has already got 21 or more executors, then we submit 20 tasks on 20 executors, then finish and idle. At this time, the allocationManager will not keep 20 min number of executors not removed, it remove 1 or more executors.&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160;4. so forth and back. .....&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160;5. Finally, there might be no alive executors, but allocationManager still think it has kept more than min number of executors. An extrame case is the wrong number is greater than the max number of executors, so allocationManager will never schedule more executors and the application will hangs forever.&lt;/p&gt;</comment>
                            <comment id="16778048" author="ngone51" created="Tue, 26 Feb 2019 15:22:11 +0000"  >&lt;p&gt;I got it, thank you.&lt;/p&gt;</comment>
                            <comment id="16791029" author="vanzin" created="Tue, 12 Mar 2019 21:27:41 +0000"  >&lt;p&gt;Issue resolved by pull request 23842&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/23842&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23842&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12959215" name="Selection_042.jpg" size="78890" author="liupengcheng" created="Tue, 19 Feb 2019 09:00:52 +0000"/>
                            <attachment id="12959216" name="Selection_043.jpg" size="21077" author="liupengcheng" created="Tue, 19 Feb 2019 09:01:09 +0000"/>
                            <attachment id="12959217" name="Selection_044.jpg" size="5518" author="liupengcheng" created="Tue, 19 Feb 2019 09:01:24 +0000"/>
                            <attachment id="12959218" name="Selection_045.jpg" size="31643" author="liupengcheng" created="Tue, 19 Feb 2019 09:01:46 +0000"/>
                            <attachment id="12959219" name="Selection_046.jpg" size="56923" author="liupengcheng" created="Tue, 19 Feb 2019 09:02:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 35 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi14ds:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>