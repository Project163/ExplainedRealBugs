<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:20:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-33419] Unexpected behavior when using SET commands before a query in SparkSession.sql</title>
                <link>https://issues.apache.org/jira/browse/SPARK-33419</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;SparkSession.sql converts a string value to a DataFrame, and the string value should be one single SQL statement ending up w/ or w/o one or more semicolons. e.g.&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
scala&amp;gt; spark.&lt;span class=&quot;code-keyword&quot;&gt;sql&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; 2&quot;&lt;/span&gt;).&lt;span class=&quot;code-keyword&quot;&gt;show&lt;/span&gt;
+&lt;span class=&quot;code-comment&quot;&gt;---+
&lt;/span&gt;|  2|
+&lt;span class=&quot;code-comment&quot;&gt;---+
&lt;/span&gt;|  2|
+&lt;span class=&quot;code-comment&quot;&gt;---+
&lt;/span&gt;

scala&amp;gt; spark.&lt;span class=&quot;code-keyword&quot;&gt;sql&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; 2;&quot;&lt;/span&gt;).&lt;span class=&quot;code-keyword&quot;&gt;show&lt;/span&gt;
+&lt;span class=&quot;code-comment&quot;&gt;---+
&lt;/span&gt;|  2|
+&lt;span class=&quot;code-comment&quot;&gt;---+
&lt;/span&gt;|  2|
+&lt;span class=&quot;code-comment&quot;&gt;---+
&lt;/span&gt;
scala&amp;gt; spark.&lt;span class=&quot;code-keyword&quot;&gt;sql&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; 2;;;;&quot;&lt;/span&gt;).&lt;span class=&quot;code-keyword&quot;&gt;show&lt;/span&gt;
+&lt;span class=&quot;code-comment&quot;&gt;---+
&lt;/span&gt;|  2|
+&lt;span class=&quot;code-comment&quot;&gt;---+
&lt;/span&gt;|  2|
+&lt;span class=&quot;code-comment&quot;&gt;---+&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;If you put 2 or more statements in, it fails in the parser e.g.  &lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot; select 2; select 1;&quot;&lt;/span&gt;).show
org.apache.spark.sql.catalyst.parser.ParseException:
extraneous input &lt;span class=&quot;code-quote&quot;&gt;&apos;select&apos;&lt;/span&gt; expecting {&amp;lt;EOF&amp;gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;;&apos;&lt;/span&gt;}(line 1, pos 11)

== SQL ==
 select 2; select 1;
-----------^^^

  at org.apache.spark.sql.catalyst.parser.ParseException.withCommand(ParseDriver.scala:263)
  at org.apache.spark.sql.catalyst.parser.AbstractSqlParser.parse(ParseDriver.scala:130)
  at org.apache.spark.sql.execution.SparkSqlParser.parse(SparkSqlParser.scala:51)
  at org.apache.spark.sql.catalyst.parser.AbstractSqlParser.parsePlan(ParseDriver.scala:81)
  at org.apache.spark.sql.SparkSession.$anonfun$sql$2(SparkSession.scala:610)
  at org.apache.spark.sql.catalyst.QueryPlanningTracker.measurePhase(QueryPlanningTracker.scala:111)
  at org.apache.spark.sql.SparkSession.$anonfun$sql$1(SparkSession.scala:610)
  at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:769)
  at org.apache.spark.sql.SparkSession.sql(SparkSession.scala:607)
  ... 47 elided

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As a very generic user scenario,  they want to change some settings before they execute&lt;br/&gt;
the queries. They may pass a string value like `set spark.sql.abc=2; select 1;` into this API, which creates a confusing gap between the actual effect and the user&apos;s expectations.&lt;/p&gt;

&lt;p&gt;The user may want the query to be executed with spark.sql.abc=2, but Spark actually treats the whole part of `2; select 1;` as the value of the property &apos;spark.sql.abc&apos;,&lt;br/&gt;
 e.g.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;set spark.sql.abc=2; select 1;&quot;&lt;/span&gt;).show
+-------------+------------+
|          key|       value|
+-------------+------------+
|spark.sql.abc|2; select 1;|
+-------------+------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13339915">SPARK-33419</key>
            <summary>Unexpected behavior when using SET commands before a query in SparkSession.sql</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Qin Yao">Kent Yao 2</assignee>
                                    <reporter username="Qin Yao">Kent Yao 2</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Nov 2020 08:27:25 +0000</created>
                <updated>Fri, 13 Nov 2020 06:58:39 +0000</updated>
                            <resolved>Fri, 13 Nov 2020 06:58:39 +0000</resolved>
                                    <version>2.4.7</version>
                    <version>3.0.2</version>
                    <version>3.1.0</version>
                                    <fixVersion>3.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17229829" author="qin yao" created="Wed, 11 Nov 2020 08:28:26 +0000"  >&lt;p&gt;I&apos;d like to fix this&lt;/p&gt;</comment>
                            <comment id="17229892" author="apachespark" created="Wed, 11 Nov 2020 10:32:53 +0000"  >&lt;p&gt;User &apos;yaooqinn&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/30332&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/30332&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17231207" author="cloud_fan" created="Fri, 13 Nov 2020 06:58:39 +0000"  >&lt;p&gt;Issue resolved by pull request 30332&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/30332&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/30332&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0kgw0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>