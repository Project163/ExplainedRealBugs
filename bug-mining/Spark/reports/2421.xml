<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:32:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-9672] Drivers run in cluster mode on mesos may not have spark-env variables available</title>
                <link>https://issues.apache.org/jira/browse/SPARK-9672</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;This issue definitely affects Mesos mode, but may effect complex standalone topologies as well.&lt;/p&gt;

&lt;p&gt;When running spark-submit with &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;--deploy-mode cluster&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; environment variables set in &lt;tt&gt;spark-env.sh&lt;/tt&gt; that are not prefixed with &lt;tt&gt;SPARK_&lt;/tt&gt; are not available in the driver process. The behavior I expect is that any variables set in &lt;tt&gt;spark-env.sh&lt;/tt&gt; are available on the driver and all executors.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;spark-env.sh&lt;/tt&gt; is executed by &lt;tt&gt;load-spark-env.sh&lt;/tt&gt; which uses an environment variable &lt;tt&gt;SPARK_ENV_LOADED&lt;/tt&gt; &lt;a href=&quot;https://github.com/apache/spark/blob/master/bin/load-spark-env.sh#L25]&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;[code&lt;/a&gt; to ensure that it is only run once. When using the &lt;tt&gt;RestSubmissionClient&lt;/tt&gt;, spark submit propagates all environment variables that are prefixed with &lt;tt&gt;SPARK_&lt;/tt&gt; &lt;a href=&quot;https://github.com/apache/spark/blob/3c0156899dc1ec1f7dfe6d7c8af47fa6dc7d00bf/core/src/main/scala/org/apache/spark/deploy/rest/RestSubmissionClient.scala#L400]&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;[code&lt;/a&gt; to the &lt;tt&gt;MesosRestServer&lt;/tt&gt; where they are used to initialize the driver &lt;a href=&quot;https://github.com/apache/spark/blob/3c0156899dc1ec1f7dfe6d7c8af47fa6dc7d00bf/core/src/main/scala/org/apache/spark/deploy/rest/StandaloneRestServer.scala#L155]&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;[code&lt;/a&gt;. During this process, &lt;tt&gt;SPARK_ENV_LOADED&lt;/tt&gt; is propagated to the new driver process (since running spark submit has caused &lt;tt&gt;load-spark-env.sh&lt;/tt&gt; to be run on the submitter&apos;s machine) &lt;a href=&quot;https://github.com/apache/spark/blob/d86bbb4e286f16f77ba125452b07827684eafeed/core/src/main/scala/org/apache/spark/scheduler/cluster/mesos/MesosClusterScheduler.scala#L371]&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;[code&lt;/a&gt;. Now when &lt;tt&gt;load-spark-env.sh&lt;/tt&gt; is called by &lt;tt&gt;MesosClusterScheduler&lt;/tt&gt; &lt;tt&gt;SPARK_ENV_LOADED&lt;/tt&gt; is set and &lt;tt&gt;spark-env.sh&lt;/tt&gt; is never sourced.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://gist.github.com/pashields/9fe662d6ec5c079bdf70&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;This gist&lt;/a&gt; shows the testing setup I used while investigating this issue. An example invocation looked like &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;spark-1.5.0-SNAPSHOT-bin-custom-spark/bin/spark-submit --deploy-mode cluster --master mesos://172.31.34.154:7077 --class Test spark-env-var-test_2.10-0.1-SNAPSHOT.jar&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Ubuntu 14.04&lt;br/&gt;
Mesos 0.23 (compiled from source following instructions on mesos site)&lt;br/&gt;
Spark 1.4 prebuilt for hadoop 2.6&lt;/p&gt;

&lt;p&gt;Test setup was a two node mesos cluster. One dedicated master and one dedicated slave. Spark submissions occurred on the master and were directed at a mesos dispatcher running on the master.&lt;/p&gt;</environment>
        <key id="12852435">SPARK-9672</key>
            <summary>Drivers run in cluster mode on mesos may not have spark-env variables available</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pashields">Patrick Shields</assignee>
                                    <reporter username="pashields">Patrick Shields</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Aug 2015 00:18:20 +0000</created>
                <updated>Thu, 3 Sep 2015 20:58:36 +0000</updated>
                            <resolved>Thu, 3 Sep 2015 20:53:48 +0000</resolved>
                                    <version>1.4.1</version>
                                    <fixVersion>1.6.0</fixVersion>
                                    <component>Mesos</component>
                    <component>Spark Submit</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14659257" author="apachespark" created="Thu, 6 Aug 2015 00:30:04 +0000"  >&lt;p&gt;User &apos;pashields&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7979&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7979&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 15 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2iea7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333083">1.6.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>