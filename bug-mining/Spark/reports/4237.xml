<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:49:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-17982] SQLBuilder should wrap the generated SQL with parenthesis for LIMIT</title>
                <link>https://issues.apache.org/jira/browse/SPARK-17982</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The following statement fails in the spark shell . &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;scala&amp;gt; spark.sql(&quot;CREATE VIEW DEFAULT.sparkshell_2_VIEW__hive_quoted_with_where (WHERE_ID , WHERE_NAME ) AS SELECT `where`.id,`where`.name FROM DEFAULT.`where` limit 2&quot;)

scala&amp;gt; spark.sql(&quot;CREATE VIEW DEFAULT.sparkshell_2_VIEW__hive_quoted_with_where (WHERE_ID , WHERE_NAME ) AS SELECT `where`.id,`where`.name FROM DEFAULT.`where` limit 2&quot;)
java.lang.RuntimeException: Failed to analyze the canonicalized SQL: SELECT `gen_attr_0` AS `WHERE_ID`, `gen_attr_2` AS `WHERE_NAME` FROM (SELECT `gen_attr_1` AS `gen_attr_0`, `gen_attr_3` AS `gen_attr_2` FROM SELECT `gen_attr_1`, `gen_attr_3` FROM (SELECT `id` AS `gen_attr_1`, `name` AS `gen_attr_3` FROM `default`.`where`) AS gen_subquery_0 LIMIT 2) AS gen_subquery_1
  at org.apache.spark.sql.execution.command.CreateViewCommand.prepareTable(views.scala:192)
  at org.apache.spark.sql.execution.command.CreateViewCommand.run(views.scala:122)
  at org.apache.spark.sql.execution.command.ExecutedCommandExec.sideEffectResult$lzycompute(commands.scala:60)
  at org.apache.spark.sql.execution.command.ExecutedCommandExec.sideEffectResult(commands.scala:58)
  at org.apache.spark.sql.execution.command.ExecutedCommandExec.doExecute(commands.scala:74)
  at org.apache.spark.sql.execution.SparkPlan$$anonfun$execute$1.apply(SparkPlan.scala:115)
  at org.apache.spark.sql.execution.SparkPlan$$anonfun$execute$1.apply(SparkPlan.scala:115)
  at org.apache.spark.sql.execution.SparkPlan$$anonfun$executeQuery$1.apply(SparkPlan.scala:136)
  at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:151)
  at org.apache.spark.sql.execution.SparkPlan.executeQuery(SparkPlan.scala:133)
  at org.apache.spark.sql.execution.SparkPlan.execute(SparkPlan.scala:114)
  at org.apache.spark.sql.execution.QueryExecution.toRdd$lzycompute(QueryExecution.scala:86)
  at org.apache.spark.sql.execution.QueryExecution.toRdd(QueryExecution.scala:86)
  at org.apache.spark.sql.Dataset.&amp;lt;init&amp;gt;(Dataset.scala:186)
  at org.apache.spark.sql.Dataset.&amp;lt;init&amp;gt;(Dataset.scala:167)
  at org.apache.spark.sql.Dataset$.ofRows(Dataset.scala:65)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This appears to be a limitation of the create view statement .&lt;/p&gt;</description>
                <environment>&lt;p&gt;spark 2.0.0&lt;/p&gt;</environment>
        <key id="13013056">SPARK-17982</key>
            <summary>SQLBuilder should wrap the generated SQL with parenthesis for LIMIT</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dongjoon">Dongjoon Hyun</assignee>
                                    <reporter username="tafranky@gmail.com">Franck Tago</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Oct 2016 01:49:00 +0000</created>
                <updated>Sat, 12 Nov 2016 01:39:49 +0000</updated>
                            <resolved>Fri, 11 Nov 2016 21:29:25 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>2.0.1</version>
                                    <fixVersion>2.0.3</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15584178" author="tafranky@gmail.com" created="Tue, 18 Oct 2016 02:22:02 +0000"  >&lt;p&gt;== SQL ==&lt;br/&gt;
SELECT `gen_attr_0` AS `WHERE_ID`, `gen_attr_2` AS `WHERE_NAME` FROM (SELECT `gen_attr_1` AS `gen_attr_0`, `gen_attr_3` AS `gen_attr_2` FROM SELECT `gen_attr_1`, `gen_attr_3` FROM (SELECT `id` AS `gen_attr_1`, `name` AS `gen_attr_3` FROM `default`.`where`) AS gen_subquery_0 LIMIT 2) AS gen_subquery_1&lt;br/&gt;
----------------------------------------------------------------^^^&lt;/p&gt;

&lt;p&gt;  at org.apache.spark.sql.catalyst.parser.ParseException.withCommand(ParseDriver.scala:197)&lt;br/&gt;
  at org.apache.spark.sql.catalyst.parser.AbstractSqlParser.parse(ParseDriver.scala:99)&lt;br/&gt;
  at org.apache.spark.sql.execution.SparkSqlParser.parse(SparkSqlParser.scala:45)&lt;br/&gt;
  at org.apache.spark.sql.catalyst.parser.AbstractSqlParser.parsePlan(ParseDriver.scala:53)&lt;br/&gt;
  at org.apache.spark.sql.SparkSession.sql(SparkSession.scala:582)&lt;br/&gt;
  at org.apache.spark.sql.execution.command.CreateViewCommand.prepareTable(views.scala:189)&lt;br/&gt;
  ... 64 more&lt;/p&gt;</comment>
                            <comment id="15585061" author="jiangxb1987" created="Tue, 18 Oct 2016 09:58:51 +0000"  >&lt;p&gt;Hi, Seems we don&apos;t support specify column list inside CreateView statement, perhaps you may try&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE VIEW DEFAULT.sparkshell_2_VIEW__hive_quoted_with_where AS SELECT `where`.id,`where`.name FROM DEFAULT.`where` limit 2&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Greetings!&lt;/p&gt;</comment>
                            <comment id="15586309" author="tafranky@gmail.com" created="Tue, 18 Oct 2016 18:49:45 +0000"  >&lt;p&gt;Hi , &lt;br/&gt;
couple of things that I want to point out here. &lt;/p&gt;

&lt;p&gt;First ,&lt;br/&gt;
your workaround will not be acceptable for me because I need to control the name of the view columns . This is due to the fact that I programatically generate the scala code for the spark application . There are some invariants that are required in my framework . &lt;/p&gt;


&lt;p&gt;Second ,&lt;br/&gt;
you claim that spark does not support column names in create view statements at all ? &lt;/p&gt;

&lt;p&gt;How come it does work in some cases ?&lt;/p&gt;

&lt;p&gt;Is that a limitation that is documented somewhere?&lt;/p&gt;
</comment>
                            <comment id="15586829" author="dongjoon" created="Tue, 18 Oct 2016 22:12:22 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tafranky%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;tafranky@gmail.com&quot;&gt;tafranky@gmail.com&lt;/a&gt;.&lt;br/&gt;
Could you update your JIRA title?&lt;br/&gt;
As you see in &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jiangxb&quot; class=&quot;user-hover&quot; rel=&quot;jiangxb&quot;&gt;jiangxb&lt;/a&gt;&apos;s example, `limit` is not a problem.&lt;/p&gt;</comment>
                            <comment id="15586918" author="tafranky@gmail.com" created="Tue, 18 Oct 2016 22:47:17 +0000"  >&lt;p&gt;Updated the  Title of the  Jira . &lt;/p&gt;

&lt;p&gt;I looked at the views.scala file and I want to know if setting the flag  spark.sql.nativeView.canonical to false is an acceptable  workaround.  &lt;/p&gt;

&lt;p&gt;I tested it and it works  but the question is that an acceptable workaround.&lt;/p&gt;</comment>
                            <comment id="15587124" author="dongjoon" created="Wed, 19 Oct 2016 00:11:44 +0000"  >&lt;p&gt;I&apos;ll investigate it for you, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tafranky%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;tafranky@gmail.com&quot;&gt;tafranky@gmail.com&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15587222" author="dongjoon" created="Wed, 19 Oct 2016 00:53:15 +0000"  >&lt;p&gt;Sorry, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tafranky%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;tafranky@gmail.com&quot;&gt;tafranky@gmail.com&lt;/a&gt;. Now, I understand what you meant by `limit`.&lt;br/&gt;
The following is the simplified version of your case, isn&apos;t it?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; spark.version
res0: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = 2.1.0-SNAPSHOT

scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE tbl(id INT)&quot;&lt;/span&gt;)
res1: org.apache.spark.sql.DataFrame = []

scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE VIEW v1(id2) AS SELECT id FROM tbl&quot;&lt;/span&gt;)
res2: org.apache.spark.sql.DataFrame = []

scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE VIEW v2 AS SELECT id FROM tbl limit 2&quot;&lt;/span&gt;)
res3: org.apache.spark.sql.DataFrame = []

scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE VIEW v3(id2) AS SELECT id FROM tbl limit 2&quot;&lt;/span&gt;)
java.lang.RuntimeException: Failed to analyze the canonicalized SQL: ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15587239" author="dongjoon" created="Wed, 19 Oct 2016 00:59:09 +0000"  >&lt;p&gt;I&apos;ll make a PR for this today.&lt;/p&gt;</comment>
                            <comment id="15587420" author="jiangxb1987" created="Wed, 19 Oct 2016 02:20:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dongjoon&quot; class=&quot;user-hover&quot; rel=&quot;dongjoon&quot;&gt;dongjoon&lt;/a&gt; In your examples there is a misleading part:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE VIEW v1(id2) AS SELECT id FROM tbl&quot;&lt;/span&gt;)
res2: org.apache.spark.sql.DataFrame = []
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above &quot;(id2)&quot; in &quot;v1(id2)&quot; is in fact an identifierCommentList instead of colTypeList, so it is not actually creating columns accord.&lt;/p&gt;

&lt;p&gt;Perhaps we should listen to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hvanhovell&quot; class=&quot;user-hover&quot; rel=&quot;hvanhovell&quot;&gt;hvanhovell&lt;/a&gt; whether we should support specify columns in CreateView? &lt;/p&gt;</comment>
                            <comment id="15587433" author="jiangxb1987" created="Wed, 19 Oct 2016 02:27:18 +0000"  >&lt;p&gt;Would you please give a example that it works? Thanks!&lt;/p&gt;</comment>
                            <comment id="15587573" author="apachespark" created="Wed, 19 Oct 2016 03:47:08 +0000"  >&lt;p&gt;User &apos;dongjoon-hyun&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15546&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15546&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15587579" author="dongjoon" created="Wed, 19 Oct 2016 03:50:54 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jiangxb&quot; class=&quot;user-hover&quot; rel=&quot;jiangxb&quot;&gt;jiangxb&lt;/a&gt;.&lt;br/&gt;
I think Spark supports that like MySQL &lt;a href=&quot;http://dev.mysql.com/doc/refman/5.7/en/create-view.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://dev.mysql.com/doc/refman/5.7/en/create-view.html&lt;/a&gt; .&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT id2 FROM v1&quot;&lt;/span&gt;)
res0: org.apache.spark.sql.DataFrame = [id2: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="15587583" author="dongjoon" created="Wed, 19 Oct 2016 03:54:19 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tafranky%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;tafranky@gmail.com&quot;&gt;tafranky@gmail.com&lt;/a&gt;.&lt;br/&gt;
I made a PR for you. It handles your case, too.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;create table `where`(id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, name &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)&quot;&lt;/span&gt;)
res1: org.apache.spark.sql.DataFrame = []

scala&amp;gt; spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE VIEW DEFAULT.sparkshell_2_VIEW__hive_quoted_with_where (WHERE_ID , WHERE_NAME ) AS SELECT `where`.id,`where`.name FROM DEFAULT.`where` limit 2&quot;&lt;/span&gt;)
res2: org.apache.spark.sql.DataFrame = []
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I just simplify your case because it contains multiple test cases.&lt;/p&gt;</comment>
                            <comment id="15587659" author="jiangxb1987" created="Wed, 19 Oct 2016 04:39:41 +0000"  >&lt;p&gt;You are right, just made a mistake. Sorry for that!&lt;/p&gt;</comment>
                            <comment id="15588225" author="dongjoon" created="Wed, 19 Oct 2016 09:47:18 +0000"  >&lt;p&gt;Never mind!&lt;/p&gt;</comment>
                            <comment id="15627406" author="tafranky@gmail.com" created="Wed, 2 Nov 2016 02:21:22 +0000"  >&lt;p&gt;Wanted to mention that I was able to successfully  verify my cases with the changes made under this request.&lt;/p&gt;</comment>
                            <comment id="15654987" author="dongjoon" created="Thu, 10 Nov 2016 20:02:41 +0000"  >&lt;p&gt;Thank you for confirming, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tafranky%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;tafranky@gmail.com&quot;&gt;tafranky@gmail.com&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15658466" author="apachespark" created="Fri, 11 Nov 2016 23:13:05 +0000"  >&lt;p&gt;User &apos;dongjoon-hyun&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15856&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15856&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13017010">SPARK-18209</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 1 week, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i350jj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12335644">2.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>