<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:16:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-31584] NullPointerException when parsing event log with InMemoryStore</title>
                <link>https://issues.apache.org/jira/browse/SPARK-31584</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I compiled with the current branch-3.0 source and tested it in mac os.&#160;A java.lang.NullPointerException will be thrown when below conditions are met:&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Using InMemoryStore as kvstore when parsing the event log file (e.g., when spark.history.store.path is unset).&#160;&lt;/li&gt;
	&lt;li&gt;At least one stage in this event log has task number greater than spark.ui.retainedTasks (by default is 100000). In this case, kvstore needs to delete extra task records.&lt;/li&gt;
	&lt;li&gt;The job has more than one stage, so&#160;parentToChildrenMap in InMemoryStore.java will have more than one key.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The java.lang.NullPointerException is thrown in InMemoryStore.java :296. In the method deleteParentIndex().&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void deleteParentIndex(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; key) {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hasNaturalParentIndex) {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (NaturalKeys v : parentToChildrenMap.values()) {
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (v.remove(asKey(key))) {
            &lt;span class=&quot;code-comment&quot;&gt;// `v` can be empty after removing the natural key and we can remove it from
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// `parentToChildrenMap`. However, `parentToChildrenMap` is a ConcurrentMap and such
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// checking and deleting can be slow.
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// This method is to delete one object with certain key, let&apos;s make it simple here.
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
          }
        }
      }
    }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In &#8220;if (v.remove(asKey(key)))&#8221;, if the key is not contained in v,&#160; &quot;v.remove(asKey(key))&quot; will return null, and java will throw a NullPointerException when executing &quot;if (null)&quot;.&lt;/p&gt;

&lt;p&gt;An exception stack trace is attached.&lt;/p&gt;

&lt;p&gt;This issue can be fixed by updating if statement to&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (v.remove(asKey(key)) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13301415">SPARK-31584</key>
            <summary>NullPointerException when parsing event log with InMemoryStore</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Baohe Zhang">Baohe Zhang</assignee>
                                    <reporter username="Baohe Zhang">Baohe Zhang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Apr 2020 00:16:57 +0000</created>
                <updated>Tue, 23 Jun 2020 05:16:50 +0000</updated>
                            <resolved>Wed, 29 Apr 2020 00:30:24 +0000</resolved>
                                    <version>3.0.1</version>
                                    <fixVersion>3.0.1</fixVersion>
                    <fixVersion>3.1.0</fixVersion>
                                    <component>Web UI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17094951" author="gengliang.wang" created="Wed, 29 Apr 2020 00:30:24 +0000"  >&lt;p&gt;The issue is resolved in &lt;a href=&quot;https://github.com/apache/spark/pull/28378&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28378&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13001385" name="errorstack.txt" size="7904" author="Baohe Zhang" created="Tue, 28 Apr 2020 00:17:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 28 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0e56o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12339177">3.0.0</customfieldvalue>
    <customfieldvalue id="12347862">3.0.1</customfieldvalue>
    <customfieldvalue id="12346518">3.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>