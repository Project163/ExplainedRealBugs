<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:59:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-17916] CSV data source treats empty string as null no matter what nullValue option is</title>
                <link>https://issues.apache.org/jira/browse/SPARK-17916</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When user configures &lt;tt&gt;nullValue&lt;/tt&gt; in CSV data source, in addition to those values, all empty string values are also converted to null.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;data:
col1,col2
1,&lt;span class=&quot;code-quote&quot;&gt;&quot;-&quot;&lt;/span&gt;
2,&quot;&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;spark.read.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;csv&quot;&lt;/span&gt;).option(&lt;span class=&quot;code-quote&quot;&gt;&quot;nullValue&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;-&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We will find a null in both rows.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13012096">SPARK-17916</key>
            <summary>CSV data source treats empty string as null no matter what nullValue option is</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="maxgekk">Max Gekk</assignee>
                                    <reporter username="falaki">Hossein Falaki</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Oct 2016 18:17:45 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:01 +0000</updated>
                            <resolved>Mon, 14 May 2018 02:02:25 +0000</resolved>
                                    <version>2.0.1</version>
                                    <fixVersion>2.4.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>12</watches>
                                                                                                                <comments>
                            <comment id="15573668" author="gurwls223" created="Fri, 14 Oct 2016 00:34:18 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=falaki&quot; class=&quot;user-hover&quot; rel=&quot;falaki&quot;&gt;falaki&lt;/a&gt;, this JIRA rings a bell to me. Do you mind if I ask to take a look &lt;a href=&quot;https://github.com/apache/spark/pull/12904&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12904&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-15125&quot; title=&quot;CSV data source recognizes empty quoted strings in the input as null. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-15125&quot;&gt;&lt;del&gt;SPARK-15125&lt;/del&gt;&lt;/a&gt;. Could you confirm that it is a duplicate maybe?&lt;/p&gt;</comment>
                            <comment id="15573692" author="falaki" created="Fri, 14 Oct 2016 00:44:15 +0000"  >&lt;p&gt;Thanks for linking it. Yes they are very much same issues. However, I slightly disagree with the proposed solution. I will comment on the PR.&lt;/p&gt;</comment>
                            <comment id="15591408" author="gurwls223" created="Thu, 20 Oct 2016 10:06:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=falaki&quot; class=&quot;user-hover&quot; rel=&quot;falaki&quot;&gt;falaki&lt;/a&gt; I just have thought about this more but I started to feel we might not need this.&lt;br/&gt;
I tested &lt;tt&gt;read.csv()&lt;/tt&gt; in R as well after setting the equalvalent default values in Spark CSV options.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt; d &amp;lt;- &quot;col1,col2
+ 1,\&lt;span class=&quot;code-quote&quot;&gt;&quot;-\&quot;&lt;/span&gt;
+ 2,\&lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;&quot;
&amp;gt; df &amp;lt;- read.csv(text=d, quote=&lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, na.strings=c(&quot;&lt;/span&gt;-&quot;))
&amp;gt; df
  col1 col2
1    1   NA
2    2   NA
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems &lt;tt&gt;read.csv()&lt;/tt&gt; in R seems not having this option&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; and handles equalvalently with the current behaviour of Spark CSV dataource.&lt;br/&gt;
Shouldn&apos;t we maybe do this as below?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt; df &amp;lt;- read.csv(text=d, quote=&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;, na.strings=c(&quot;&lt;/span&gt;\&lt;span class=&quot;code-quote&quot;&gt;&quot;-\&quot;&lt;/span&gt;&quot;))
&amp;gt; df
  col1 col2
1    1 &amp;lt;NA&amp;gt;
2    2   &quot;&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am not saying we should exactly match &lt;tt&gt;read.csv()&lt;/tt&gt; in R to &lt;tt&gt;read.csv()&lt;/tt&gt; in Spark but maybe I guess it&apos;d be nicer if the behaviour is matched up in general.&lt;br/&gt;
I guess we could add this option (as you pointed out) but I am worried if this brings some confusions between &lt;tt&gt;nullValue&lt;/tt&gt; and &lt;tt&gt;emptyValue&lt;/tt&gt; as pointed out in the PR.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;https://stat.ethz.ch/R-manual/R-devel/library/utils/html/read.table.html&lt;/p&gt;</comment>
                            <comment id="15591417" author="gurwls223" created="Thu, 20 Oct 2016 10:11:20 +0000"  >&lt;p&gt;FWIW, the codes I ran in Spark (equalvalent with the last example in R) is as blow.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;spark.read.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;csv&quot;&lt;/span&gt;)
  .option(&lt;span class=&quot;code-quote&quot;&gt;&quot;nullValue&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;-\&quot;&quot;)
  .option(&lt;span class=&quot;code-quote&quot;&gt;&quot;quote&quot;&lt;/span&gt;, &quot;&quot;)
  .option(&lt;span class=&quot;code-quote&quot;&gt;&quot;header&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;)
  .load(&lt;span class=&quot;code-quote&quot;&gt;&quot;path&quot;&lt;/span&gt;)
  .show()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+----+----+
|col1|col2|
+----+----+
|   1|&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;|
|   2|  &quot;&quot;|
+----+----+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15593119" author="tsuresh" created="Thu, 20 Oct 2016 21:44:01 +0000"  >&lt;p&gt;Thank you for trying out the different scenarios. I think output you are getting after setting he quote to empty is not what is expected in the case. You want &quot;&quot; to be recognized as empty string, not actual quotes in the output.&lt;/p&gt;

&lt;p&gt;Example (Before my changes on 2.0.1 branch):&lt;/p&gt;

&lt;p&gt;input:&lt;br/&gt;
col1,col2&lt;br/&gt;
1,&quot;-&quot;&lt;br/&gt;
2,&quot;&quot;&lt;br/&gt;
3,&lt;br/&gt;
4,&quot;A,B&quot;&lt;/p&gt;

&lt;p&gt;val df = spark.read.format(&quot;csv&quot;).option(&quot;nullValue&quot;, &quot;\&quot;-\&quot;&quot;).option(&quot;quote&quot;, &quot;&quot;).option(&quot;header&quot;, true).load(&quot;/Users/suresht/sparktests/emptystring.csv&quot;)&lt;br/&gt;
df: org.apache.spark.sql.DataFrame = &lt;span class=&quot;error&quot;&gt;&amp;#91;col1: string, col2: string&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;scala&amp;gt; df.selectExpr(&quot;length(col2)&quot;).show&lt;br/&gt;
&lt;ins&gt;------------&lt;/ins&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;length(col2)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;------------&lt;/ins&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;        null&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;           2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;        null&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;           2&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;------------&lt;/ins&gt;&lt;/p&gt;


&lt;p&gt;scala&amp;gt; df.show&lt;br/&gt;
&lt;ins&gt;---&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;---+&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;col1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;col2&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;---&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;---+&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;null&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  &quot;&quot;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   3&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;null&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  &quot;A&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;---&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;---+&lt;/p&gt;


</comment>
                            <comment id="15593271" author="gurwls223" created="Thu, 20 Oct 2016 22:49:21 +0000"  >&lt;p&gt;Oh, yes sure. I just thought the root problem is to differentiate &lt;tt&gt;&quot;&quot;&lt;/tt&gt;. Once we can distinguish it, we can easily transform it. Also, another point I want to make was.. we already have a great reference in R but it seems not handling this case.&lt;/p&gt;</comment>
                            <comment id="15593300" author="gurwls223" created="Thu, 20 Oct 2016 23:03:45 +0000"  >&lt;p&gt;Could I please ask what you think? cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=felixcheung&quot; class=&quot;user-hover&quot; rel=&quot;felixcheung&quot;&gt;felixcheung&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15594046" author="felixcheung" created="Fri, 21 Oct 2016 04:56:52 +0000"  >&lt;p&gt;So here&apos;s what happen.&lt;/p&gt;

&lt;p&gt;First, R read.csv has clearly documented that it treats empty/blank string the same as NA in the following condition: &quot;Blank fields are also considered to be missing values in logical, integer, numeric and complex fields.&quot;&lt;/p&gt;

&lt;p&gt;Second, in this example in R, the 2nd column is turned into &quot;logical&quot;, instead of &quot;character&quot; (ie. string) as expected:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt; d &amp;lt;- &quot;col1,col2
+ 1,\&lt;span class=&quot;code-quote&quot;&gt;&quot;-\&quot;&lt;/span&gt;
+ 2,\&lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;&quot;
&amp;gt; df &amp;lt;- read.csv(text=d, quote=&lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, na.strings=c(&quot;&lt;/span&gt;-&quot;))
&amp;gt; df
  col1 col2
1    1   NA
2    2   NA
&amp;gt; str(df)
&lt;span class=&quot;code-quote&quot;&gt;&apos;data.frame&apos;&lt;/span&gt;:	2 obs. of  2 variables:
 $ col1: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;  1 2
 $ col2: logi  NA NA
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And that is why the blank string is turned into NA.&lt;/p&gt;

&lt;p&gt;Whereas if the data.frame has character/factor column instead, the blank field is retained as blank:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt; d &amp;lt;- &quot;col1,col2
+ 1,\&lt;span class=&quot;code-quote&quot;&gt;&quot;###\&quot;&lt;/span&gt;
+ 2,\&lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;
+ 3,\&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is a string\&quot;&lt;/span&gt;&quot;
&amp;gt; df &amp;lt;- read.csv(text=d, quote=&lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, na.strings=c(&quot;&lt;/span&gt;###&quot;))
&amp;gt; df
  col1             col2
1    1             &amp;lt;NA&amp;gt;
2    2
3    3 &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is a string
&amp;gt; str(df)
&lt;span class=&quot;code-quote&quot;&gt;&apos;data.frame&apos;&lt;/span&gt;:	3 obs. of  2 variables:
 $ col1: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;  1 2 3
 $ col2: Factor w/ 2 levels &lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;,&quot;&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is a string&quot;: NA 1 2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;IMO this behavior makes sense.&lt;/p&gt;</comment>
                            <comment id="15649039" author="ekhliang" created="Tue, 8 Nov 2016 22:46:42 +0000"  >&lt;p&gt;We&apos;re hitting this as a regression from 2.0 as well.&lt;/p&gt;

&lt;p&gt;Ideally, we don&apos;t want the empty string to be treated specially in any scenario. The only logic that converts it to nulls should be due to the nullValue option.&lt;/p&gt;</comment>
                            <comment id="15651172" author="tsuresh" created="Wed, 9 Nov 2016 15:02:34 +0000"  >&lt;p&gt;@Eric Liang   If it is possible , can you please share the data, and expected output with the options &lt;/p&gt;

&lt;p&gt;I am trying to fix this issue in PR ; &lt;a href=&quot;https://github.com/apache/spark/pull/12904&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12904&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="15652414" author="ekhliang" created="Wed, 9 Nov 2016 23:49:22 +0000"  >&lt;p&gt;In our case, a user wants the empty string (whether actually missing, e.g. ,, or quoted ,&quot;&quot;), to resolve as the empty string. It should only turn into null if nullValue is set to &quot;&quot;. There doesn&apos;t currently appear to be some option combination that allows this.&lt;/p&gt;</comment>
                            <comment id="15704736" author="jzijlstra" created="Tue, 29 Nov 2016 09:03:55 +0000"  >&lt;p&gt;I also have the same issue in 2.0.1. This code seems to be the problem:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; def rowToString(row: InternalRow): Seq[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;] = {
    &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; i = 0
    val values = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Array[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;](row.numFields)
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (i &amp;lt; row.numFields) {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!row.isNullAt(i)) {
        values(i) = valueConverters(i).apply(row, i)
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        values(i) = params.nullValue
      }
      i += 1
    }
    values
  }

def castTo(
      datum: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;,
      castType: DataType,
      nullable: &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt; = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,
      options: CSVOptions = CSVOptions()): Any = {

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nullable &amp;amp;&amp;amp; datum == options.nullValue) {
      &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {

}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;So first the missing value in the data in transformed into the nullValue. Then in the castTo the value is checked against the nullValue, which is always true for a missing value, and casted to null&lt;/p&gt;</comment>
                            <comment id="16302594" author="apachespark" created="Sat, 23 Dec 2017 21:36:08 +0000"  >&lt;p&gt;User &apos;aa8y&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/20068&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20068&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16467998" author="apachespark" created="Tue, 8 May 2018 21:41:05 +0000"  >&lt;p&gt;User &apos;MaxGekk&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/21273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21273&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16473690" author="gurwls223" created="Mon, 14 May 2018 02:02:25 +0000"  >&lt;p&gt;Issue resolved by pull request 21273&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/21273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21273&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16584324" author="koert" created="Fri, 17 Aug 2018 19:53:12 +0000"  >&lt;p&gt;the default behavior in 2.3.x for csv format is that when i write out null value, it comes back in as null. when i write out empty string, it also comes back in as null.&lt;/p&gt;

&lt;p&gt;now my nulls are coming back in as empty strings, which would be a very big behavior change. please advice what settings i need to get behavior of 2.3 back, so empty strings read back in as nulls.&lt;/p&gt;

&lt;p&gt;to give some background, most csv files have empty values. we have hundreds of spark scripts/programs that read existing csv files and assume empty values are read in as null values, and these programs act/analyze accordingly. i don&apos;t think we are alone in this respect. for all these programs this would be a big breaking change, unless i am missing something.&lt;/p&gt;</comment>
                            <comment id="16584357" author="maxgekk" created="Fri, 17 Aug 2018 20:36:29 +0000"  >&lt;p&gt;&amp;gt;&#160;he default behavior in 2.3.x for csv format is that when i write out null value, it comes back in as null. when i write out empty string, it also comes back in as null.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=koert&quot; class=&quot;user-hover&quot; rel=&quot;koert&quot;&gt;koert&lt;/a&gt; Please, have a look at the added test: &lt;a href=&quot;https://github.com/apache/spark/pull/21273/files#diff-219ac8201e443435499123f96e94d29fR1355&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21273/files#diff-219ac8201e443435499123f96e94d29fR1355&lt;/a&gt;&#160;. It checks exactly what you described. If you have something different, please, leave the code here.&lt;/p&gt;</comment>
                            <comment id="16584374" author="koert" created="Fri, 17 Aug 2018 21:01:40 +0000"  >&lt;p&gt;hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxgekk&quot; class=&quot;user-hover&quot; rel=&quot;maxgekk&quot;&gt;maxgekk&lt;/a&gt;&lt;br/&gt;
i saw your unit test for the old behavior. let me try to find out what is not working for us.&lt;/p&gt;</comment>
                            <comment id="16584378" author="koert" created="Fri, 17 Aug 2018 21:02:55 +0000"  >&lt;p&gt;my first observation is that if i do this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; litNull: String = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; df = Seq(
  (1, &lt;span class=&quot;code-quote&quot;&gt;&quot;John Doe&quot;&lt;/span&gt;),
  (2, &quot;&quot;),
  (3, &lt;span class=&quot;code-quote&quot;&gt;&quot;-&quot;&lt;/span&gt;),
  (4, litNull)
).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;)

df
  .write
  .csv(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/abc1&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and inspect in bash&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
cat /tmp/abc1/part-0000*.csv
1,John Doe
2,&quot;&quot;
3,-
4,&quot;&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;notice how for the null value it wrote the empty quoted string. that is emptyValue, not nullValue, which seems incorrect to me.&lt;/p&gt;

&lt;p&gt;if i do the same exercise in spark 2.3 i get:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
cat /tmp/abc1/part-0000*.csv
1,John Doe
2,
3,-
4,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so my actual csv data has changed upon writing. that makes me nervous about compatibility with other systems that read data we produce.&lt;/p&gt;</comment>
                            <comment id="16584381" author="koert" created="Fri, 17 Aug 2018 21:06:41 +0000"  >&lt;p&gt;we also use csv format to write files like for example bsv (bar delimited, interpreted by systems that do not support quoting at all). having an output that used to be:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
1|John Doe
2|
3|-
4|
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;become:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
1|John Doe
2|&quot;&quot;
3|-
4|&quot;&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;will no go down well.&lt;/p&gt;</comment>
                            <comment id="16584393" author="koert" created="Fri, 17 Aug 2018 21:13:14 +0000"  >&lt;p&gt;now the particular unit test that broke for us, where nulls come back in as quoted strings, is this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; litNull: String = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; df = Seq(
        (1, &lt;span class=&quot;code-quote&quot;&gt;&quot;John Doe&quot;&lt;/span&gt;),
        (2, &quot;&quot;),
        (3, &lt;span class=&quot;code-quote&quot;&gt;&quot;-&quot;&lt;/span&gt;),
        (4, litNull)
      ).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;)

      df
        .write
        .format(&lt;span class=&quot;code-quote&quot;&gt;&quot;csv&quot;&lt;/span&gt;)
        .option(&lt;span class=&quot;code-quote&quot;&gt;&quot;header&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
        .option(&lt;span class=&quot;code-quote&quot;&gt;&quot;delimiter&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;|&quot;&lt;/span&gt;)
        .option(&lt;span class=&quot;code-quote&quot;&gt;&quot;quote&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&#9731;&quot;&lt;/span&gt;)
        .save(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/abc&quot;&lt;/span&gt;)

      &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; df1 = spark
        .read
        .format(&lt;span class=&quot;code-quote&quot;&gt;&quot;csv&quot;&lt;/span&gt;)
        .option(&lt;span class=&quot;code-quote&quot;&gt;&quot;header&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
        .option(&lt;span class=&quot;code-quote&quot;&gt;&quot;delimiter&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;|&quot;&lt;/span&gt;)
        .option(&lt;span class=&quot;code-quote&quot;&gt;&quot;quote&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&#9731;&quot;&lt;/span&gt;)
        .load(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/abc&quot;&lt;/span&gt;)
      df1.show

+---+--------+
| id|    name|
+---+--------+
|  1|John Doe|
|  2|      &quot;&quot;|
|  4|      &quot;&quot;|
|  3|       -|
+---+--------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so here we are writing out with bar as delimiter, and quoting is not supported at all (so i set it to a silly character, i cannot think of better option).&lt;br/&gt;
i am not sure i understand yet why the nulls come back in as strings, but it has to do something with setting the quote character, because if i dont do that the test passes.&lt;/p&gt;</comment>
                            <comment id="16599717" author="apachespark" created="Sat, 1 Sep 2018 19:43:04 +0000"  >&lt;p&gt;User &apos;koertkuipers&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22312&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22312&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16608215" author="apachespark" created="Sat, 8 Sep 2018 21:24:09 +0000"  >&lt;p&gt;User &apos;MaxGekk&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22367&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22367&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16608217" author="apachespark" created="Sat, 8 Sep 2018 21:25:29 +0000"  >&lt;p&gt;User &apos;MaxGekk&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22367&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22367&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16610164" author="apachespark" created="Tue, 11 Sep 2018 06:46:49 +0000"  >&lt;p&gt;User &apos;MaxGekk&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22389&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22389&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13095443">SPARK-21768</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34upr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12342385">2.4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>