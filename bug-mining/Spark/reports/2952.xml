<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:36:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-12526] `ifelse`, `when`, `otherwise` unable to take Column as value</title>
                <link>https://issues.apache.org/jira/browse/SPARK-12526</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When passing a Column to &lt;tt&gt;ifelse&lt;/tt&gt;, &lt;tt&gt;when&lt;/tt&gt;, &lt;tt&gt;otherwise&lt;/tt&gt;, it will error out with&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;attempt to replicate an object of type &lt;span class=&quot;code-quote&quot;&gt;&apos;environment&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problems lies in the use of base R &lt;tt&gt;ifelse&lt;/tt&gt; function, which is vectorized version of &lt;tt&gt;if ... else ...&lt;/tt&gt; idiom, but it is unable to replicate a Column&apos;s job id as it is an environment.&lt;/p&gt;

&lt;p&gt;Considering &lt;tt&gt;callJMethod&lt;/tt&gt; was never designed to be vectorized, the safe option is to replace &lt;tt&gt;ifelse&lt;/tt&gt; with &lt;tt&gt;if ... else ...&lt;/tt&gt; instead. However technically this is inconsistent to base R&apos;s ifelse, which is meant to be vectorized.&lt;/p&gt;

&lt;p&gt;I can send a PR for review first and discuss further if there is scenario at all when `ifelse`, `when`, `otherwise` would be used vectorizedly.&lt;/p&gt;

&lt;p&gt;A dummy example is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ifelse(lit(1) == lit(1), lit(2), lit(3))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;A concrete example might be:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ifelse(df$mpg &amp;gt; 0, df$mpg, 0)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12924340">SPARK-12526</key>
            <summary>`ifelse`, `when`, `otherwise` unable to take Column as value</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="saurfang">Sen Fang</assignee>
                                    <reporter username="saurfang">Sen Fang</reporter>
                        <labels>
                    </labels>
                <created>Sat, 26 Dec 2015 05:12:58 +0000</created>
                <updated>Fri, 29 Jan 2016 00:45:32 +0000</updated>
                            <resolved>Tue, 29 Dec 2015 07:18:47 +0000</resolved>
                                    <version>1.5.2</version>
                    <version>1.6.0</version>
                                    <fixVersion>1.6.1</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>SparkR</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15071816" author="apachespark" created="Sat, 26 Dec 2015 06:01:03 +0000"  >&lt;p&gt;User &apos;saurfang&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10481&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10481&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15073580" author="shivaram" created="Tue, 29 Dec 2015 07:18:47 +0000"  >&lt;p&gt;Issue resolved by pull request 10481&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10481&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10481&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15122611" author="dsiegel" created="Fri, 29 Jan 2016 00:30:56 +0000"  >&lt;p&gt;I&apos;m trying to use ifelse (or when and otherwise) to replace some of the values in a column (or create a new column which uses the old column for some of its values). I believe this falls into the case of wanting to do the above example&lt;br/&gt;
&amp;gt;ifelse(df$mpg &amp;gt; 0, df$mpg, 0)&lt;/p&gt;

&lt;p&gt;Here&apos;s my example:&lt;br/&gt;
aq$mynewcolumn &amp;lt;- ifelse(aq$Ozone != &quot;NA&quot;, aq$Ozone, &quot;&amp;lt;NA&amp;gt;&quot;)&lt;br/&gt;
or&lt;br/&gt;
aq$mynewcolumn &amp;lt;- otherwise(when(aq$Ozone == &quot;NA&quot;, &quot;&amp;lt;NA&amp;gt;&quot;), aq$Ozone)&lt;/p&gt;

&lt;p&gt;Is it correct that this still won&apos;t work in 1.6.0 with: &lt;br/&gt;
Error in rep(yes, length.out = length(ans)) : &lt;br/&gt;
  attempt to replicate an object of type &apos;environment&apos;&lt;/p&gt;</comment>
                            <comment id="15122631" author="shivaram" created="Fri, 29 Jan 2016 00:45:32 +0000"  >&lt;p&gt;Yeah this fix was checked in after 1.6.0 was cut &amp;#8211; so its a known bug in 1.6.0. I think we might have a 1.6.1 soon and this should be a part of that.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qbb3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>