<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:00:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-24699] Watermark / Append mode should work with Trigger.Once</title>
                <link>https://issues.apache.org/jira/browse/SPARK-24699</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I have a use case where I would like to trigger a structured streaming job&#160;from an external scheduler (once every 15 minutes or so) and have it write window aggregates to Kafka.&lt;/p&gt;

&lt;p&gt;I am able to get my code to work when running with `Trigger.ProcessingTime` but when I switch to `Trigger.Once` the watermarking feature of structured streams does not persist to (or is not recollected from) the checkpoint state.&lt;/p&gt;

&lt;p&gt;This causes the stream to never generate output because the watermark is perpetually stuck at `1970-01-01T00:00:00Z`.&lt;/p&gt;

&lt;p&gt;I have created a&#160;failing test case in the `EventTimeWatermarkSuite`, I will create a &lt;span class=&quot;error&quot;&gt;&amp;#91;WIP&amp;#93;&lt;/span&gt; pull request on github and link it here.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;It seems that even if it generated the watermark, and given the current streaming behavior, I would have to trigger the job twice to&#160;generate any output.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The microbatcher only calculates the watermark off of the previous batch&apos;s input and emits new aggs based off of that timestamp.&lt;/p&gt;

&lt;p&gt;This state is not available to a newly started&#160;`MicroBatchExecution` stream.&lt;/p&gt;

&lt;p&gt;Would it be an appropriate strategy to create a new checkpoint file with the most up to watermark or watermark and query stats?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13169278">SPARK-24699</key>
            <summary>Watermark / Append mode should work with Trigger.Once</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tdas">Tathagata Das</assignee>
                                    <reporter username="chorn">Chris Horn</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Jun 2018 22:36:09 +0000</created>
                <updated>Sat, 31 Aug 2019 19:46:28 +0000</updated>
                            <resolved>Mon, 23 Jul 2018 20:04:45 +0000</resolved>
                                    <version>2.3.1</version>
                                    <fixVersion>2.4.0</fixVersion>
                                    <component>Structured Streaming</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16528355" author="apachespark" created="Fri, 29 Jun 2018 23:06:06 +0000"  >&lt;p&gt;User &apos;c-horn&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/21676&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21676&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16528356" author="chorn" created="Fri, 29 Jun 2018 23:07:52 +0000"  >&lt;p&gt;I have attached two scala repl scripts for reproducing this behavior. The &quot;once&quot; variant fails to produce output or updated watermarks, the &quot;stream&quot; variant behaves mostly as expected.&lt;/p&gt;</comment>
                            <comment id="16539784" author="apachespark" created="Wed, 11 Jul 2018 09:29:05 +0000"  >&lt;p&gt;User &apos;tdas&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/21746&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21746&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16553337" author="tdas" created="Mon, 23 Jul 2018 20:04:45 +0000"  >&lt;p&gt;Issue resolved by pull request 21746&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/21746&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21746&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12929787" name="watermark-once.scala" size="1838" author="chorn" created="Fri, 29 Jun 2018 23:06:52 +0000"/>
                            <attachment id="12929788" name="watermark-stream.scala" size="1794" author="chorn" created="Fri, 29 Jun 2018 23:06:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 17 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3venb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>