<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:44:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-50118] Spark removes working directory while Python UDF runs</title>
                <link>https://issues.apache.org/jira/browse/SPARK-50118</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;With Spark Connect + PySpark, we can stage files using `spark.addArtifacts`. When a Python UDF is executed, the working directory is set to a folder with the corresponding artifacts available.&lt;/p&gt;

&lt;p&gt;I have observed on large scale jobs with long running tasks (&amp;gt;45 mins) that Spark sometimes removes that working directory, even though UDF tasks are still running. This can be seen by periodically running `os.getcwd()` in the UDF, which raises `FileNotFoundError`.&lt;/p&gt;

&lt;p&gt;This seems to coincide with log records indicating &apos;Session evicted: &amp;lt;uuid&amp;gt;`, from &lt;a href=&quot;#L212&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;`isolatedSessionCache`.&lt;/a&gt;&#160;There is a 30 minute timeout here that might be to blame.&lt;/p&gt;

&lt;p&gt;I have not yet been able to write a simple program to reproduce. I suspect that there might be a conjunction of multiple events, such as when a task is scheduled on an executor 30 mins after the last task started. &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-44290&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-44290&lt;/a&gt; might be relevant.&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gurwls223&quot; class=&quot;user-hover&quot; rel=&quot;gurwls223&quot;&gt;gurwls223&lt;/a&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13596730">SPARK-50118</key>
            <summary>Spark removes working directory while Python UDF runs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="gurwls223">Hyukjin Kwon</assignee>
                                    <reporter username="peay2">Peter Andrew</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 25 Oct 2024 13:17:50 +0000</created>
                <updated>Thu, 23 Jan 2025 21:55:40 +0000</updated>
                                            <version>3.5.2</version>
                                                    <component>Connect</component>
                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17893026" author="gurwls223" created="Sat, 26 Oct 2024 05:42:11 +0000"  >&lt;p&gt;Yeah, I get the problem now. When the session isn&apos;t used, it will remove the directory and session out.&lt;/p&gt;</comment>
                            <comment id="17893027" author="gurwls223" created="Sat, 26 Oct 2024 05:43:29 +0000"  >&lt;p&gt;I think we should at least provide an option to either increase the timeout and cache size, or avoid removing the directory for now.&lt;/p&gt;</comment>
                            <comment id="17897297" author="gurwls223" created="Mon, 11 Nov 2024 23:33:10 +0000"  >&lt;p&gt;Issue resolved by pull request 48665&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/48665&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/48665&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17916229" author="gurwls223" created="Thu, 23 Jan 2025 00:07:34 +0000"  >&lt;p&gt;Reverted at &lt;a href=&quot;https://github.com/apache/spark/commit/3bbb12cbd5e67f725b8a31057370e332bdf19d8d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/3bbb12cbd5e67f725b8a31057370e332bdf19d8d&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/spark/commit/5db193b884e37f30132ceddae02ae0df7c112498&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/5db193b884e37f30132ceddae02ae0df7c112498&lt;/a&gt; due to flakiness in tests. Should investgiate more&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            41 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1s7ko:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>