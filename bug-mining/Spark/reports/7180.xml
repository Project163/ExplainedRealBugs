<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:16:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-31671] Wrong error message in VectorAssembler  when column lengths can not be inferred</title>
                <link>https://issues.apache.org/jira/browse/SPARK-31671</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;In VectorAssembler when input column lengths can not be inferred and handleInvalid = &quot;keep&quot;, it will throw a runtime exception with message like below&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Can not infer column lengths with handleInvalid = &quot;keep&quot;. &lt;b&gt;Consider using VectorSizeHint&lt;/b&gt;&lt;/em&gt;&lt;br/&gt;
 &lt;b&gt;&lt;em&gt;|to add metadata for columns: &lt;span class=&quot;error&quot;&gt;&amp;#91;column1, column2&amp;#93;&lt;/span&gt;&lt;/em&gt;&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;However, even if you set vector size hint for&#160;&lt;b&gt;column1&lt;/b&gt;, the message remains, and will not change to&#160; &lt;b&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;column2&amp;#93;&lt;/span&gt;&lt;/b&gt; only. This is not consistent with the description in the error message.&lt;/p&gt;

&lt;p&gt;This introduce difficulties when I try to resolve this exception, for I do not know which column required vectorSizeHint. This is especially troublesome when you have a large number of columns to deal with.&lt;/p&gt;

&lt;p&gt;Here is a simple example:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// create a df without vector size
&lt;/span&gt;val df = Seq(
  (Vectors.dense(1.0), Vectors.dense(2.0))
).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;n1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;n2&quot;&lt;/span&gt;)

&lt;span class=&quot;code-comment&quot;&gt;// only set vector size hint &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; n1 column
&lt;/span&gt;val hintedDf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; VectorSizeHint()
  .setInputCol(&lt;span class=&quot;code-quote&quot;&gt;&quot;n1&quot;&lt;/span&gt;)
  .setSize(1)
  .transform(df)

&lt;span class=&quot;code-comment&quot;&gt;// assemble n1, n2
&lt;/span&gt;val output = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; VectorAssembler()
  .setInputCols(Array(&lt;span class=&quot;code-quote&quot;&gt;&quot;n1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;n2&quot;&lt;/span&gt;))
  .setOutputCol(&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;)
  .setHandleInvalid(&lt;span class=&quot;code-quote&quot;&gt;&quot;keep&quot;&lt;/span&gt;)
  .transform(hintedDf)

&lt;span class=&quot;code-comment&quot;&gt;// because only n1 has vector size, the error message should tell us to set vector size &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; n2 too
&lt;/span&gt;output.show()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Expected error message:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Can not infer column lengths with handleInvalid = &lt;span class=&quot;code-quote&quot;&gt;&quot;keep&quot;&lt;/span&gt;. Consider using VectorSizeHint to add metadata &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; columns: [n2].
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Actual error message:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Can not infer column lengths with handleInvalid = &lt;span class=&quot;code-quote&quot;&gt;&quot;keep&quot;&lt;/span&gt;. Consider using VectorSizeHint to add metadata &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; columns: [n1, n2].
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I change one line in VectorAssembler.scala, so that it can work properly as expected.&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Mac OS&#160; catalina&lt;/p&gt;</environment>
        <key id="13303862">SPARK-31671</key>
            <summary>Wrong error message in VectorAssembler  when column lengths can not be inferred</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fan31415">YijieFan</assignee>
                                    <reporter username="fan31415">YijieFan</reporter>
                        <labels>
                    </labels>
                <created>Sat, 9 May 2020 17:33:53 +0000</created>
                <updated>Sat, 16 May 2020 02:01:56 +0000</updated>
                            <resolved>Mon, 11 May 2020 23:24:57 +0000</resolved>
                                    <version>2.4.4</version>
                                    <fixVersion>2.4.6</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>ML</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="259200">72h</timeoriginalestimate>
                            <timeestimate seconds="259200">72h</timeestimate>
                                        <comments>
                            <comment id="17103445" author="fan31415" created="Sat, 9 May 2020 19:36:49 +0000"  >&lt;p&gt;The pull request to fix this issue&#160;&lt;a href=&quot;https://github.com/apache/spark/pull/28487&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28487&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17103446" author="apachespark" created="Sat, 9 May 2020 19:37:26 +0000"  >&lt;p&gt;User &apos;fan31415&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28487&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28487&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17103447" author="apachespark" created="Sat, 9 May 2020 19:37:57 +0000"  >&lt;p&gt;User &apos;fan31415&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28487&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28487&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17104970" author="srowen" created="Mon, 11 May 2020 23:24:57 +0000"  >&lt;p&gt;Resolved by &lt;a href=&quot;https://github.com/apache/spark/pull/28487&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28487&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 27 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ejyo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>