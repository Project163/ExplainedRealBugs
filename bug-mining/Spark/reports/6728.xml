<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:07:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-10614] SystemClock uses non-monotonic time in its wait logic</title>
                <link>https://issues.apache.org/jira/browse/SPARK-10614</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The consolidated (&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-4682&quot; title=&quot;Consolidate various &amp;#39;Clock&amp;#39; classes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-4682&quot;&gt;&lt;del&gt;SPARK-4682&lt;/del&gt;&lt;/a&gt;) clock uses &lt;tt&gt;System.currentTimeMillis()&lt;/tt&gt; for measuring time, which means its &lt;tt&gt;waitTillTime()&lt;/tt&gt; routine is brittle against systems (VMs in particular) whose time can go backwards as well as forward.&lt;/p&gt;

&lt;p&gt;For the &lt;tt&gt;ExecutorAllocationManager&lt;/tt&gt; this appears to be a regression.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12864179">SPARK-10614</key>
            <summary>SystemClock uses non-monotonic time in its wait logic</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vanzin">Marcelo Masiero Vanzin</assignee>
                                    <reporter username="stevel@apache.org">Steve Loughran</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Sep 2015 08:45:20 +0000</created>
                <updated>Tue, 15 Oct 2019 02:38:31 +0000</updated>
                            <resolved>Tue, 15 Oct 2019 02:38:31 +0000</resolved>
                                    <version>1.3.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14745068" author="stevel@apache.org" created="Tue, 15 Sep 2015 08:48:26 +0000"  >&lt;p&gt;Fix options?&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;switch &lt;tt&gt;SystemClock&lt;/tt&gt; to use nanotime/1e6. Guarantees monotonicity; does not guarantee a time value relevant to humans.&lt;/li&gt;
	&lt;li&gt;modify &lt;tt&gt;SystemClock.waitTillTime&lt;/tt&gt; to use &lt;tt&gt;SystemClock.getTimeMillis()&lt;/tt&gt;, provide subclass MonotonicClock whose time is off nano time, and use it where needed.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I&apos;d consider #2 the better strategy &#8212;if people agree I&apos;ll submit a patch&lt;/p&gt;</comment>
                            <comment id="14745239" author="apachespark" created="Tue, 15 Sep 2015 10:53:03 +0000"  >&lt;p&gt;User &apos;steveloughran&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/8766&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/8766&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14768900" author="stevel@apache.org" created="Wed, 16 Sep 2015 13:02:48 +0000"  >&lt;p&gt;Having done a little more detailed research on the current state of this clock, I&apos;m now having doubts about this.&lt;/p&gt;

&lt;p&gt;On x86, its generally assumed that the &lt;tt&gt;System.nanoTime()&lt;/tt&gt; uses the &lt;tt&gt;TSC&lt;/tt&gt; counter to get the timestamp &#8212;which is fast and only goes forwards (albeit at a rate which depends on CPU power states). But it turns out that on manycore CPUs, because that could lead to different answers on different cores, the OS may use alternative mechanisms to return a counter: which may be neither monotonic nor fast.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;&lt;a href=&quot;https://blogs.oracle.com/dholmes/entry/inside_the_hotspot_vm_clocks&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Inside the Hotspot VM: Clocks, Timers and Scheduling Events - Part I - Windows&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://bugs.java.com/view_bug.do?bug_id=6440250&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JDK-6440250 : On Windows System.nanoTime() may be 25x slower than System.currentTimeMillis()&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://bugs.java.com/bugdatabase/view_bug.do?bug_id=6458294&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JDK-6458294 : nanoTime affected by system clock change on Linux (RH9) or in general lacks monotonicity&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_MRG/2/html/Realtime_Reference_Guide/chap-Realtime_Reference_Guide-Timestamping.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Redhat on timestamps in Linux&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://www.vmware.com/files/pdf/Timekeeping-In-VirtualMachines.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Timekeeping in VMware Virtual Machines&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;These docs imply that nanotime may be fast-but-unreliable-on multiple socket systems (the latest many core parts share one counter) &#8212;and may downgrade to something slower than calls to getTimeMillis()., or even something that isn&apos;t guaranteed to be monotonic. &lt;/p&gt;

&lt;p&gt;It&apos;s not clear that on deployments of physical many-core systems moving to nanotime actually offers much. I don&apos;t know about EC2 or other cloud infrastructures though.&lt;/p&gt;

&lt;p&gt;maybe its just best to WONTFIX this as it won&apos;t raise unrealistic expectations about nanoTime working&lt;/p&gt;</comment>
                            <comment id="15379801" author="apachespark" created="Fri, 15 Jul 2016 18:00:05 +0000"  >&lt;p&gt;User &apos;markgrover&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/14223&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14223&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16951501" author="dongjoon" created="Tue, 15 Oct 2019 02:38:31 +0000"  >&lt;p&gt;Issue resolved by pull request 26058&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/26058&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/26058&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12758766">SPARK-4682</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2k6sn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>