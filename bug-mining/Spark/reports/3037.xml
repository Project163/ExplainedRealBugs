<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:37:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-12755] Spark may attempt to rebuild application UI before finishing writing the event logs in possible race condition</title>
                <link>https://issues.apache.org/jira/browse/SPARK-12755</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;As reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-6950&quot; title=&quot;Spark master UI believes some applications are in progress when they are actually completed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-6950&quot;&gt;&lt;del&gt;SPARK-6950&lt;/del&gt;&lt;/a&gt;, it appears that sometimes the standalone master attempts to build an application&apos;s historical UI before closing the app&apos;s event log. This is still an issue for us in 1.5.2+, and I believe I&apos;ve found the underlying cause.&lt;/p&gt;

&lt;p&gt;When stopping a &lt;tt&gt;SparkContext&lt;/tt&gt;, the &lt;tt&gt;stop&lt;/tt&gt; method stops the DAG scheduler:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/blob/a76cf51ed91d99c88f301ec85f3cda1288bcf346/core/src/main/scala/org/apache/spark/SparkContext.scala#L1722-L1727&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/a76cf51ed91d99c88f301ec85f3cda1288bcf346/core/src/main/scala/org/apache/spark/SparkContext.scala#L1722-L1727&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and then stops the event logger:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/blob/a76cf51ed91d99c88f301ec85f3cda1288bcf346/core/src/main/scala/org/apache/spark/SparkContext.scala#L1722-L1727&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/a76cf51ed91d99c88f301ec85f3cda1288bcf346/core/src/main/scala/org/apache/spark/SparkContext.scala#L1722-L1727&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Though it is difficult to follow the chain of events, one of the sequelae of stopping the DAG scheduler is that the master&apos;s &lt;tt&gt;rebuildSparkUI&lt;/tt&gt; method is called. This method looks for the application&apos;s event logs, and its behavior varies based on the existence of an &lt;tt&gt;.inprogress&lt;/tt&gt; file suffix. In particular, a warning is logged if this suffix exists:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/blob/a76cf51ed91d99c88f301ec85f3cda1288bcf346/core/src/main/scala/org/apache/spark/deploy/master/Master.scala#L935&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/a76cf51ed91d99c88f301ec85f3cda1288bcf346/core/src/main/scala/org/apache/spark/deploy/master/Master.scala#L935&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;After calling the &lt;tt&gt;stop&lt;/tt&gt; method on the DAG scheduler, the &lt;tt&gt;SparkContext&lt;/tt&gt; stops the event logger:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/blob/a76cf51ed91d99c88f301ec85f3cda1288bcf346/core/src/main/scala/org/apache/spark/SparkContext.scala#L1734-L1736&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/a76cf51ed91d99c88f301ec85f3cda1288bcf346/core/src/main/scala/org/apache/spark/SparkContext.scala#L1734-L1736&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This renames the event log, dropping the &lt;tt&gt;.inprogress&lt;/tt&gt; file sequence.&lt;/p&gt;

&lt;p&gt;As such, a race condition exists where the master may attempt to process the application log file before finalizing it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12929254">SPARK-12755</key>
            <summary>Spark may attempt to rebuild application UI before finishing writing the event logs in possible race condition</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="michael">Michael MacFadden</assignee>
                                    <reporter username="michael">Michael MacFadden</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jan 2016 18:59:34 +0000</created>
                <updated>Fri, 13 May 2016 06:08:42 +0000</updated>
                            <resolved>Mon, 25 Jan 2016 09:52:18 +0000</resolved>
                                    <version>1.5.2</version>
                                    <fixVersion>1.5.3</fixVersion>
                    <fixVersion>1.6.1</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15092489" author="michael" created="Mon, 11 Jan 2016 19:01:30 +0000"  >&lt;p&gt;I&apos;m going to put together a PR that simply reorders the call to stop the event logger so that it comes before the call to stop the DAG scheduler.&lt;/p&gt;</comment>
                            <comment id="15092620" author="srowen" created="Mon, 11 Jan 2016 20:26:18 +0000"  >&lt;p&gt;Is this the same as &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-6950&quot; title=&quot;Spark master UI believes some applications are in progress when they are actually completed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-6950&quot;&gt;&lt;del&gt;SPARK-6950&lt;/del&gt;&lt;/a&gt;? if you have more detail here you should reopen it rather than make a new JIRA.&lt;/p&gt;</comment>
                            <comment id="15092644" author="michael" created="Mon, 11 Jan 2016 20:36:50 +0000"  >&lt;p&gt;I think they have the same root cause. If I reopen &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-6950&quot; title=&quot;Spark master UI believes some applications are in progress when they are actually completed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-6950&quot;&gt;&lt;del&gt;SPARK-6950&lt;/del&gt;&lt;/a&gt;, where should I put what I put in this ticket&apos;s description?&lt;/p&gt;</comment>
                            <comment id="15092645" author="apachespark" created="Mon, 11 Jan 2016 20:38:04 +0000"  >&lt;p&gt;User &apos;mallman&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10700&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10700&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15114978" author="srowen" created="Mon, 25 Jan 2016 09:52:18 +0000"  >&lt;p&gt;Issue resolved by pull request 10700&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10700&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10700&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15282452" author="meethumathew" created="Fri, 13 May 2016 06:08:42 +0000"  >&lt;p&gt;Hi, &lt;br/&gt;
I am facing similar issues again in 1.6.1 standalone. &lt;br/&gt;
1. My completed applications are listed under in the incompleted applications list. My application was completed using sc.stop() and the log directory contains app folders without .inprogress suffix. No permission issues is there for the log directory.&lt;br/&gt;
2 From the incompleted list, I can view the UI of only those apps ,which has a .inprogress suffix in the folder name in log directory. For other apps it&apos;s showing error &quot;Application app-2015xxxxx not found&quot;.&lt;br/&gt;
 Please help me.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12821343">SPARK-6950</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 27 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r57r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>