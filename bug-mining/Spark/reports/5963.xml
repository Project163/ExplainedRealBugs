<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:01:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-25317] MemoryBlock performance regression</title>
                <link>https://issues.apache.org/jira/browse/SPARK-25317</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;eThere is a performance regression when calculating hash code for UTF8String:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  test(&lt;span class=&quot;code-quote&quot;&gt;&quot;hashing&quot;&lt;/span&gt;) {
    &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.unsafe.hash.Murmur3_x86_32
    &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.unsafe.types.UTF8String
    val hasher = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Murmur3_x86_32(0)
    val str = UTF8String.fromString(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt; * 10001)
    val numIter = 100000
    val start = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.nanoTime
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (i &amp;lt;- 0 until numIter) {
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
      Murmur3_x86_32.hashUTF8String(str, 0)
    }
    val duration = (&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.nanoTime() - start) / 1000 / numIter
    println(s&lt;span class=&quot;code-quote&quot;&gt;&quot;duration $duration us&quot;&lt;/span&gt;)
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;To run this test in 2.3, we need to add&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; hashUTF8String(UTF8String str, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; seed) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; hashUnsafeBytes(str.getBaseObject(), str.getBaseOffset(), str.numBytes(), seed);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to `Murmur3_x86_32`&lt;/p&gt;

&lt;p&gt;In my laptop, the result for master vs 2.3 is: 120 us vs 40 us&lt;/p&gt;</description>
                <environment></environment>
        <key id="13182699">SPARK-25317</key>
            <summary>MemoryBlock performance regression</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgaido">Marco Gaido</assignee>
                                    <reporter username="cloud_fan">Wenchen Fan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Sep 2018 00:23:05 +0000</created>
                <updated>Fri, 7 Sep 2018 19:15:06 +0000</updated>
                            <resolved>Thu, 6 Sep 2018 07:29:27 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>2.4.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="16602503" author="cloud_fan" created="Tue, 4 Sep 2018 00:23:43 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kiszk&quot; class=&quot;user-hover&quot; rel=&quot;kiszk&quot;&gt;kiszk&lt;/a&gt;  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rednaxelafx&quot; class=&quot;user-hover&quot; rel=&quot;rednaxelafx&quot;&gt;rednaxelafx&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16602506" author="kiszk" created="Tue, 4 Sep 2018 00:38:42 +0000"  >&lt;p&gt;Let me run this on 2.3 and master.&lt;br/&gt;
One question. This benchmark does not have an warm up loop. In other words, this benchmark may include execution time on an interpreter, too. Is this behavior intentional?&lt;/p&gt;</comment>
                            <comment id="16602512" author="kabhwan" created="Tue, 4 Sep 2018 01:05:53 +0000"  >&lt;p&gt;Why not running test with JMH, applying warmup and iteration? Not sure it can be applied to scala test, but the Java test code should be simple if these Spark classes are aware of interop.&lt;/p&gt;</comment>
                            <comment id="16602567" author="kiszk" created="Tue, 4 Sep 2018 03:10:41 +0000"  >&lt;p&gt;I confirmed this performance difference even after adding warmup. Let me investigate furthermore.&lt;/p&gt;</comment>
                            <comment id="16603174" author="mgaido" created="Tue, 4 Sep 2018 15:10:44 +0000"  >&lt;p&gt;I think I have a fix for this. I can submit a PR if you want, but I am still not sure about the root cause of the regression. My best guess is that there are more than one reason and the perf improvement happens iff all the reasons are fixed, which is rather strange to me.&lt;/p&gt;</comment>
                            <comment id="16604120" author="kiszk" created="Wed, 5 Sep 2018 08:33:42 +0000"  >&lt;p&gt;When I have been investigating this issue, I realized that # of Javabyte code size in a method can change performance. I guess that this issue is related to method inlining. However, I have not found the root cause yet.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgaido&quot; class=&quot;user-hover&quot; rel=&quot;mgaido&quot;&gt;mgaido&lt;/a&gt; Would it be possible to submit a PR to fix this issue if possible?&lt;/p&gt;</comment>
                            <comment id="16604133" author="mgaido" created="Wed, 5 Sep 2018 08:45:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kiszk&quot; class=&quot;user-hover&quot; rel=&quot;kiszk&quot;&gt;kiszk&lt;/a&gt; sure, we can investigate further in the PR the root cause. Thanks.&lt;/p&gt;</comment>
                            <comment id="16604145" author="apachespark" created="Wed, 5 Sep 2018 08:56:44 +0000"  >&lt;p&gt;User &apos;mgaido91&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22338&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22338&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16604146" author="apachespark" created="Wed, 5 Sep 2018 08:57:22 +0000"  >&lt;p&gt;User &apos;mgaido91&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22338&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22338&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16605402" author="cloud_fan" created="Thu, 6 Sep 2018 07:29:27 +0000"  >&lt;p&gt;Issue resolved by pull request 22338&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22338&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22338&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16607543" author="apachespark" created="Fri, 7 Sep 2018 19:15:06 +0000"  >&lt;p&gt;User &apos;gatorsmile&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22361&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22361&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 10 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3xorj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12342385">2.4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>