<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:43:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-15531] spark-class tries to use too much memory when running Launcher</title>
                <link>https://issues.apache.org/jira/browse/SPARK-15531</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When running Java on a server with a lot of memory but a rather small virtual memory ulimit, Java will try to allocate a large memory pool and fail:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;# &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt; has 128GB of Ram but ulimit set to 7.5G
$ ulimit -v
7812500
$ java -client
Error occurred during initialization of VM
Could not reserve enough space &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; object heap
Error: Could not create the Java Virtual Machine.
Error: A fatal exception has occurred. Program will exit.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is a known issue with Java, but unlikely to get fixed.&lt;/p&gt;

&lt;p&gt;As a result, when starting various Spark process (spark-submit, master or workers), they fail when &lt;tt&gt;spark-class&lt;/tt&gt; tries to run &lt;tt&gt;org.apache.spark.launcher.Main&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;To fix this, add &lt;tt&gt;-Xmx128m&lt;/tt&gt; to this line&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;$RUNNER&quot;&lt;/span&gt; -Xmx128m -cp &lt;span class=&quot;code-quote&quot;&gt;&quot;$LAUNCH_CLASSPATH&quot;&lt;/span&gt; org.apache.spark.launcher.Main &lt;span class=&quot;code-quote&quot;&gt;&quot;$\@&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(&lt;a href=&quot;https://github.com/apache/spark/blob/master/bin/spark-class#L71&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/bin/spark-class#L71&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;We&apos;ve been using 128m and that works in our setup. Considering all the launcher does is analyze the arguments and env var and spit out some command, it should be plenty. All other calls to Java seem to include some value for -Xmx, so it is not an issue elsewhere.&lt;/p&gt;

&lt;p&gt;I don&apos;t mind submitting a PR, but I&apos;m sure somebody has opinions on the 128m (bigger, smaller, configurable, ...), so I&apos;d rather it would be discussed first.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux running in Univa or Sun Grid Engine&lt;/p&gt;</environment>
        <key id="12972800">SPARK-15531</key>
            <summary>spark-class tries to use too much memory when running Launcher</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean R. Owen</assignee>
                                    <reporter username="mathieulongtin">mathieu longtin</reporter>
                        <labels>
                            <label>launcher</label>
                    </labels>
                <created>Wed, 25 May 2016 18:19:12 +0000</created>
                <updated>Mon, 13 Feb 2017 13:05:04 +0000</updated>
                            <resolved>Fri, 27 May 2016 18:29:57 +0000</resolved>
                                    <version>1.6.1</version>
                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Deploy</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15300623" author="vanzin" created="Wed, 25 May 2016 18:40:29 +0000"  >&lt;p&gt;I&apos;m a little confused: how can the VM launched afterwards, which is generally much larger, run?&lt;/p&gt;</comment>
                            <comment id="15300666" author="mathieulongtin" created="Wed, 25 May 2016 19:03:23 +0000"  >&lt;p&gt;The VM that spark-class launches afterwards has an -Xmx argument. It comes from --executor-memory or --driver-memory or some place else.&lt;/p&gt;

&lt;p&gt;This is only a problem when letting Java decide what -Xmx should be. By default, it&apos;s a quarter of the physical memory, and it tries to reserve it right away, regardless of actual need.&lt;/p&gt;</comment>
                            <comment id="15300860" author="srowen" created="Wed, 25 May 2016 21:12:37 +0000"  >&lt;p&gt;The problem is really that ulimit; it is going to make any java process without -Xmx fail right?&lt;br/&gt;
Still I wonder if it&apos;s just as well to put some liberal max heap size limit on the launcher... or do I misunderstand and the launcher process is not merely kicking off other processes?&lt;/p&gt;</comment>
                            <comment id="15300950" author="vanzin" created="Wed, 25 May 2016 21:58:59 +0000"  >&lt;p&gt;No, Mathieu described the launcher correctly. Adding the -Xmx should be fine, I just find it super weird that java is failing without it, since it&apos;s not like the ulimit is low (7.5G according to the description).&lt;/p&gt;</comment>
                            <comment id="15300986" author="mathieulongtin" created="Wed, 25 May 2016 22:21:24 +0000"  >&lt;p&gt;Correct, on a 128G server, just running &lt;tt&gt;java&lt;/tt&gt; with no argument will try to allocate 32G, regardless of ulimit. It&apos;s &quot;expected behavior&quot; according to Oracle.&lt;/p&gt;</comment>
                            <comment id="15304054" author="apachespark" created="Fri, 27 May 2016 13:21:05 +0000"  >&lt;p&gt;User &apos;srowen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/13360&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13360&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15863628" author="apachespark" created="Mon, 13 Feb 2017 13:05:04 +0000"  >&lt;p&gt;User &apos;Pashugan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/16913&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/16913&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 40 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2yhtr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>