<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:34:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-11016] Spark fails when running with a task that requires a more recent version of RoaringBitmaps</title>
                <link>https://issues.apache.org/jira/browse/SPARK-11016</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The following error appears during Kryo init whenever a more recent version (&amp;gt;0.5.0) of Roaring bitmaps is required by a job. org/roaringbitmap/RoaringArray$Element was removed in 0.5.0&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;A needed &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;was not found. This could be due to an error in your runpath. Missing class: org/roaringbitmap/RoaringArray$Element
java.lang.NoClassDefFoundError: org/roaringbitmap/RoaringArray$Element
	at org.apache.spark.serializer.KryoSerializer$.&amp;lt;init&amp;gt;(KryoSerializer.scala:338)
	at org.apache.spark.serializer.KryoSerializer$.&amp;lt;clinit&amp;gt;(KryoSerializer.scala)
	at org.apache.spark.serializer.KryoSerializer.newKryo(KryoSerializer.scala:93)
	at org.apache.spark.serializer.KryoSerializerInstance.borrowKryo(KryoSerializer.scala:237)
	at org.apache.spark.serializer.KryoSerializerInstance.&amp;lt;init&amp;gt;(KryoSerializer.scala:222)
	at org.apache.spark.serializer.KryoSerializer.newInstance(KryoSerializer.scala:138)
	at org.apache.spark.broadcast.TorrentBroadcast$.blockifyObject(TorrentBroadcast.scala:201)
	at org.apache.spark.broadcast.TorrentBroadcast.writeBlocks(TorrentBroadcast.scala:102)
	at org.apache.spark.broadcast.TorrentBroadcast.&amp;lt;init&amp;gt;(TorrentBroadcast.scala:85)
	at org.apache.spark.broadcast.TorrentBroadcastFactory.newBroadcast(TorrentBroadcastFactory.scala:34)
	at org.apache.spark.broadcast.BroadcastManager.newBroadcast(BroadcastManager.scala:63)
	at org.apache.spark.SparkContext.broadcast(SparkContext.scala:1318)
	at org.apache.spark.SparkContext$$anonfun$hadoopFile$1.apply(SparkContext.scala:1006)
	at org.apache.spark.SparkContext$$anonfun$hadoopFile$1.apply(SparkContext.scala:1003)
	at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:147)
	at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:108)
	at org.apache.spark.SparkContext.withScope(SparkContext.scala:700)
	at org.apache.spark.SparkContext.hadoopFile(SparkContext.scala:1003)
	at org.apache.spark.SparkContext$$anonfun$textFile$1.apply(SparkContext.scala:818)
	at org.apache.spark.SparkContext$$anonfun$textFile$1.apply(SparkContext.scala:816)
	at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:147)
	at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:108)
	at org.apache.spark.SparkContext.withScope(SparkContext.scala:700)
	at org.apache.spark.SparkContext.textFile(SparkContext.scala:816)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-5949&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-5949&lt;/a&gt; for related info&lt;/p&gt;</description>
                <environment></environment>
        <key id="12903539">SPARK-11016</key>
            <summary>Spark fails when running with a task that requires a more recent version of RoaringBitmaps</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="drcrallen">Charles R Allen</assignee>
                                    <reporter username="drcrallen">Charles R Allen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Oct 2015 22:43:19 +0000</created>
                <updated>Thu, 19 Nov 2015 18:19:40 +0000</updated>
                            <resolved>Wed, 18 Nov 2015 03:39:59 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.6.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14950152" author="srowen" created="Fri, 9 Oct 2015 09:55:49 +0000"  >&lt;p&gt;This is my ignorance, but is a proper serializer registered for roaringbitmaps classes in your app (or somehow by kryo by default)? Otherwise, relying on the default serialization may not work, indeed. This isn&apos;t a spark problem though.&lt;/p&gt;</comment>
                            <comment id="14950651" author="drcrallen" created="Fri, 9 Oct 2015 16:28:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt; As mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-5949?focusedCommentId=14949819&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14949819&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-5949?focusedCommentId=14949819&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14949819&lt;/a&gt; spark is relying on native Kryo serde for RoaringBitmap stuff in KryoSerializer: &lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/serializer/KryoSerializer.scala#L368&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/serializer/KryoSerializer.scala#L368&lt;/a&gt; including the protected Element class: &lt;a href=&quot;https://github.com/lemire/RoaringBitmap/blob/RoaringBitmap-0.4.5/src/main/java/org/roaringbitmap/RoaringArray.java#L361&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/lemire/RoaringBitmap/blob/RoaringBitmap-0.4.5/src/main/java/org/roaringbitmap/RoaringArray.java#L361&lt;/a&gt; which was removed in 0.5.0 and later (Spark is on 0.4.5 currently)&lt;/p&gt;

&lt;p&gt;The SerDe method sanctioned by the RoaringBitmap library is to use the serialize and deserialize methods provided by the RoaringBitmap or RoaringArray object. Access to a protected class causes conflicts if a 0.5.0 or later version of the RoaringBitmap library is used because Spark will unavoidably fail when it tries to register everything in org.apache.spark.serializer.KryoSerializer#toRegister , including the no-longer-existing protected inner static class&lt;/p&gt;

&lt;p&gt;I did a quick jab at a patch locally by registering RoaringBitmap and RoaringArray with a com.esotericsoftware.kryo.Serializer, but it is not clear how close KryoInput and KryoOutput are to DataInput / DataOutput, which means a bridging approach might violate the contract of one or the other.&lt;/p&gt;</comment>
                            <comment id="14951772" author="srowen" created="Sat, 10 Oct 2015 10:34:01 +0000"  >&lt;p&gt;Yes, I get that roaringbitmap has a particular serialization mechanism that Kryo has to be taught to use. I think the answer to my dumb question was: yes Spark still uses roaringbitmap so it has to ensure Kryo knows how to serialize it, including registering serializers. Yes you&apos;re doing the right thing then.&lt;/p&gt;

&lt;p&gt;These classes implement Externalizable but not Serializable; I think the KryoJavaSerializer could be registered to delegate serialization to the correct, custom Java serialization these classes define. But they&apos;re not Serializable. I wonder if we can build a KryoJavaExternalizableSerializer to do something similar automatically? that&apos;s tidy. Then it just needs to register roaringbitmaps classes to use this.&lt;/p&gt;

&lt;p&gt;Otherwise, if it has to be bridged by hand, then since DataOutputStream is a DataOutput that can wrap an OutputStream, and you can get an OutputStream from KryoOutput, it seems possible.&lt;/p&gt;</comment>
                            <comment id="14964043" author="drcrallen" created="Mon, 19 Oct 2015 21:00:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt; I confirmed locally that &lt;a href=&quot;https://github.com/metamx/spark/pull/1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/metamx/spark/pull/1&lt;/a&gt; prevents this error, but as per your prior comment a &quot;more correct&quot; implementation would probably provide a Kryo Externalizable bridge of some kind. &lt;/p&gt;</comment>
                            <comment id="14964762" author="srowen" created="Tue, 20 Oct 2015 08:02:55 +0000"  >&lt;p&gt;Yeah that&apos;s a good start. It&apos;s bridging Kryo with the particular serialization methods exposed by this class, though I think so far you are only supporting &lt;tt&gt;RoaringBitmap&lt;/tt&gt;? because these methods aren&apos;t defined by an interface I think you&apos;d have to write a glue class like you have here for each one.&lt;/p&gt;

&lt;p&gt;However because they implement &lt;tt&gt;Externalizable&lt;/tt&gt; which just delegates to these custom methods, it seems like you could do something quite similar with &lt;tt&gt;ObjectInput&lt;/tt&gt; and &lt;tt&gt;ObjectOutput&lt;/tt&gt; to support any &lt;tt&gt;Externalizable&lt;/tt&gt; object and trivially support the other RoaringBitmap classes, which will be necessary anyway. How about going that way? I&apos;d support that.&lt;/p&gt;</comment>
                            <comment id="14970783" author="srowen" created="Fri, 23 Oct 2015 10:30:41 +0000"  >&lt;p&gt;NB: the resolution here may be to simply remove usage of roaringbitmaps: &lt;a href=&quot;https://github.com/apache/spark/pull/9243&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9243&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14971027" author="apachespark" created="Fri, 23 Oct 2015 14:02:07 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9243&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9243&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14984895" author="srowen" created="Mon, 2 Nov 2015 08:53:36 +0000"  >&lt;p&gt;Issue resolved by pull request 9243&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9243&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9243&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14984897" author="srowen" created="Mon, 2 Nov 2015 08:54:16 +0000"  >&lt;p&gt;This was resolved by removing use of roaringbitmaps, in the end&lt;/p&gt;</comment>
                            <comment id="15007560" author="davies" created="Mon, 16 Nov 2015 22:52:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/pull/9243&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9243&lt;/a&gt; is reverted&lt;/p&gt;</comment>
                            <comment id="15007565" author="davies" created="Mon, 16 Nov 2015 22:53:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=charles.allen%40acxiom.com&quot; class=&quot;user-hover&quot; rel=&quot;charles.allen@acxiom.com&quot;&gt;charles.allen@acxiom.com&lt;/a&gt; Could you send your patch to github.com/apache/spark ?&lt;/p&gt;</comment>
                            <comment id="15007620" author="apachespark" created="Mon, 16 Nov 2015 23:29:04 +0000"  >&lt;p&gt;User &apos;davies&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9748&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9748&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15007640" author="drcrallen" created="Mon, 16 Nov 2015 23:43:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davies&quot; class=&quot;user-hover&quot; rel=&quot;davies&quot;&gt;davies&lt;/a&gt; Was in a meeting, looks like you got it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15010150" author="davies" created="Wed, 18 Nov 2015 03:39:59 +0000"  >&lt;p&gt;Issue resolved by pull request 9748&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9748&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9748&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15014055" author="davies" created="Thu, 19 Nov 2015 18:09:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sowen&quot; class=&quot;user-hover&quot; rel=&quot;sowen&quot;&gt;sowen&lt;/a&gt; I tried to assigned this to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=drcrallen&quot; class=&quot;user-hover&quot; rel=&quot;drcrallen&quot;&gt;drcrallen&lt;/a&gt; (who did the job), but it always tell me that the user does not exists, does my account not have the permission to access some profiles?&lt;/p&gt;</comment>
                            <comment id="15014056" author="srowen" created="Thu, 19 Nov 2015 18:11:51 +0000"  >&lt;p&gt;No it&apos;s just that people have to be in the Contributors role to be assigned. Long story. It&apos;s done now.&lt;/p&gt;</comment>
                            <comment id="15014078" author="davies" created="Thu, 19 Nov 2015 18:19:40 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ms73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>