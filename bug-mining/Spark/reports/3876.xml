<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:46:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-16625] Oracle JDBC table creation fails with ORA-00902: invalid datatype</title>
                <link>https://issues.apache.org/jira/browse/SPARK-16625</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Unfortunately I know very little about databases, but I figure this is a bug.&lt;/p&gt;

&lt;p&gt;I have a DataFrame with the following schema: &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;StructType(StructField(dst,StringType,true), StructField(id,LongType,true), StructField(src,StringType,true))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am trying to write it to an Oracle database like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; url = &lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:oracle:thin:root/rootroot@&amp;lt;ip address&amp;gt;:1521:db&quot;&lt;/span&gt;;
java.util.Properties p = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; java.util.Properties();
p.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;driver&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;oracle.jdbc.OracleDriver&quot;&lt;/span&gt;);
df.write().mode(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).jdbc(url, &lt;span class=&quot;code-quote&quot;&gt;&quot;my_table&quot;&lt;/span&gt;, p);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And I get:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception in thread &quot;main&quot; java.sql.SQLSyntaxErrorException: ORA-00902: invalid datatype

	at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:461)
	at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:402)
	at oracle.jdbc.driver.T4C8Oall.processError(T4C8Oall.java:1108)
	at oracle.jdbc.driver.T4CTTIfun.receive(T4CTTIfun.java:541)
	at oracle.jdbc.driver.T4CTTIfun.doRPC(T4CTTIfun.java:264)
	at oracle.jdbc.driver.T4C8Oall.doOALL(T4C8Oall.java:598)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:213)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:26)
	at oracle.jdbc.driver.T4CStatement.executeForRows(T4CStatement.java:1241)
	at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1558)
	at oracle.jdbc.driver.OracleStatement.executeUpdateInternal(OracleStatement.java:2498)
	at oracle.jdbc.driver.OracleStatement.executeUpdate(OracleStatement.java:2431)
	at oracle.jdbc.driver.OracleStatementWrapper.executeUpdate(OracleStatementWrapper.java:975)
	at org.apache.spark.sql.DataFrameWriter.jdbc(DataFrameWriter.scala:302)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The Oracle server I am running against is the one I get on Amazon RDS for engine type &lt;tt&gt;oracle-se&lt;/tt&gt;. The same code (with the right driver) against the RDS instance with engine type &lt;tt&gt;MySQL&lt;/tt&gt; works.&lt;/p&gt;

&lt;p&gt;The error message is the same as in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-12941&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-12941&lt;/a&gt;. Could it be that &lt;tt&gt;Long&lt;/tt&gt; is also translated into the wrong data type? Thanks.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12990762">SPARK-16625</key>
            <summary>Oracle JDBC table creation fails with ORA-00902: invalid datatype</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yumwang">Yuming Wang</assignee>
                                    <reporter username="darabos">Daniel Darabos</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Jul 2016 13:20:26 +0000</created>
                <updated>Fri, 22 Sep 2017 14:47:46 +0000</updated>
                            <resolved>Fri, 5 Aug 2016 15:12:14 +0000</resolved>
                                    <version>1.6.2</version>
                                    <fixVersion>2.1.0</fixVersion>
                    <fixVersion>2.1.2</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15395307" author="q79969786" created="Wed, 27 Jul 2016 09:32:24 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    val jdbcUrl = &lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:oracle:thin:@localhost:1521/orcl&quot;&lt;/span&gt;
    val props = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties()
    props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;driver&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;oracle.jdbc.driver.OracleDriver&quot;&lt;/span&gt;)
    props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;oracle.jdbc.mapDateToTimestamp&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;)

    val schema = StructType(Seq(
      StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;boolean_type&quot;&lt;/span&gt;, BooleanType, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;),
      StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;integer_type&quot;&lt;/span&gt;, IntegerType, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;),
      StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;long_type&quot;&lt;/span&gt;, LongType, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;),
      StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;float_Type&quot;&lt;/span&gt;, FloatType, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;),
      StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;double_type&quot;&lt;/span&gt;, DoubleType, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;),
      StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;byte_type&quot;&lt;/span&gt;, ByteType, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;),
      StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;short_type&quot;&lt;/span&gt;, ShortType, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;),
      StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;string_type&quot;&lt;/span&gt;, StringType, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;),
      StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;binary_type&quot;&lt;/span&gt;, BinaryType, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;),
      StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;date_type&quot;&lt;/span&gt;, DateType, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;),
      StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp_type&quot;&lt;/span&gt;, TimestampType, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
    ))

    val tableName = &lt;span class=&quot;code-quote&quot;&gt;&quot;test_oracle_general_types&quot;&lt;/span&gt;
    val booleanVal = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
    val integerVal = 1
    val longVal = 2L
    val floatVal = 3.0f
    val doubleVal = 4.0
    val byteVal = 2.toByte
    val shortVal = 5.toShort
    val stringVal = &lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt;
    val binaryVal = Array[&lt;span class=&quot;code-object&quot;&gt;Byte&lt;/span&gt;](6, 7, 8)
    val dateVal = Date.valueOf(&lt;span class=&quot;code-quote&quot;&gt;&quot;2016-07-26&quot;&lt;/span&gt;)
    val timestampVal = Timestamp.valueOf(&lt;span class=&quot;code-quote&quot;&gt;&quot;2016-07-26 11:49:45&quot;&lt;/span&gt;)

    val data = spark.sparkContext.parallelize(Seq(
      Row(
        booleanVal, integerVal, longVal, floatVal, doubleVal, byteVal, shortVal, stringVal,
        binaryVal, dateVal, timestampVal
      )))

    val dfWrite = spark.createDataFrame(data, schema)
    dfWrite.write.jdbc(jdbcUrl, tableName, props)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For DataFrame dfWrite,  the generated create table statement:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; test_oracle_general_types (
&lt;span class=&quot;code-quote&quot;&gt;&quot;boolean_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BIT&lt;/span&gt;(1), 
&lt;span class=&quot;code-quote&quot;&gt;&quot;integer_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;INTEGER&lt;/span&gt;, 
&lt;span class=&quot;code-quote&quot;&gt;&quot;long_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BIGINT&lt;/span&gt;, 
&lt;span class=&quot;code-quote&quot;&gt;&quot;float_Type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;REAL&lt;/span&gt;, 
&lt;span class=&quot;code-quote&quot;&gt;&quot;double_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;DOUBLE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;PRECISION&lt;/span&gt;, 
&lt;span class=&quot;code-quote&quot;&gt;&quot;byte_type&quot;&lt;/span&gt; BYTE, 
&lt;span class=&quot;code-quote&quot;&gt;&quot;short_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;INTEGER&lt;/span&gt;, 
&lt;span class=&quot;code-quote&quot;&gt;&quot;string_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;VARCHAR2&lt;/span&gt;(255), 
&lt;span class=&quot;code-quote&quot;&gt;&quot;binary_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BLOB&lt;/span&gt;, 
&lt;span class=&quot;code-quote&quot;&gt;&quot;date_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;DATE&lt;/span&gt;, 
&lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TIMESTAMP&lt;/span&gt; )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Obviously, the statement is incorrect for Oracle,  I will submit a PR and then the generated create table statement:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; test_oracle_general_types (
&lt;span class=&quot;code-quote&quot;&gt;&quot;boolean_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;NUMBER&lt;/span&gt;(1), 
&lt;span class=&quot;code-quote&quot;&gt;&quot;integer_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;NUMBER&lt;/span&gt;(10), 
&lt;span class=&quot;code-quote&quot;&gt;&quot;long_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;NUMBER&lt;/span&gt;(19), 
&lt;span class=&quot;code-quote&quot;&gt;&quot;float_Type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;NUMBER&lt;/span&gt;(19, 4), 
&lt;span class=&quot;code-quote&quot;&gt;&quot;double_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;NUMBER&lt;/span&gt;(19, 4), 
&lt;span class=&quot;code-quote&quot;&gt;&quot;byte_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;NUMBER&lt;/span&gt;(3), 
&lt;span class=&quot;code-quote&quot;&gt;&quot;short_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;NUMBER&lt;/span&gt;(5), 
&lt;span class=&quot;code-quote&quot;&gt;&quot;string_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;VARCHAR2&lt;/span&gt;(255), 
&lt;span class=&quot;code-quote&quot;&gt;&quot;binary_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BLOB&lt;/span&gt;, 
&lt;span class=&quot;code-quote&quot;&gt;&quot;date_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;DATE&lt;/span&gt;, 
&lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp_type&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TIMESTAMP&lt;/span&gt; )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15395311" author="apachespark" created="Wed, 27 Jul 2016 09:36:07 +0000"  >&lt;p&gt;User &apos;wangyum&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/14377&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14377&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15409565" author="srowen" created="Fri, 5 Aug 2016 15:12:15 +0000"  >&lt;p&gt;Issue resolved by pull request 14377&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/14377&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14377&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15878604" author="srowen" created="Wed, 22 Feb 2017 16:17:01 +0000"  >&lt;p&gt;Does anyone have a view on whether this is OK to back-port to 2.0.x or 1.6.x? &lt;/p&gt;</comment>
                            <comment id="16169232" author="apachespark" created="Sun, 17 Sep 2017 08:29:12 +0000"  >&lt;p&gt;User &apos;wangyum&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19259&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19259&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 9 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3177b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>