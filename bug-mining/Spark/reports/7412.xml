<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:18:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-32614] Support for treating the line as valid record if it starts with \u0000 or null character, or starts with any character mentioned as comment</title>
                <link>https://issues.apache.org/jira/browse/SPARK-32614</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;In most of the data ware housing scenarios files does not have comment records and every line needs to be treated as a valid record even though it starts with default comment character as \u0000 or null character.Though user can set any comment character other than \u0000, but there is a chance the actual record can start with those characters.&lt;/p&gt;

&lt;p&gt;Currently&#160;for the below piece of code and the given testdata where first row starts with null \u0000&lt;br/&gt;
character it will throw the below error.&lt;/p&gt;

&lt;p&gt;*eg:&#160;val df = spark.read.option(&quot;delimiter&quot;,&quot;,&quot;).csv(&quot;file:/E:/Data/Testdata.dat&quot;);&lt;br/&gt;
      df.show(false);*&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&lt;ins&gt;TestData&lt;/ins&gt;&lt;/b&gt;&lt;br/&gt;
&#160;&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13009827/13009827_screenshot-1.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;Internal state when error was thrown: line=1, column=0, record=0, charIndex=7&lt;br/&gt;
	at com.univocity.parsers.common.AbstractParser.handleException(AbstractParser.java:339)&lt;br/&gt;
	at com.univocity.parsers.common.AbstractParser.parseLine(AbstractParser.java:552)&lt;br/&gt;
	at org.apache.spark.sql.execution.datasources.csv.TextInputCSVDataSource$.inferFromDataset(CSVDataSource.scala:160)&lt;br/&gt;
	at org.apache.spark.sql.execution.datasources.csv.TextInputCSVDataSource$.infer(CSVDataSource.scala:148)&lt;br/&gt;
	at org.apache.spark.sql.execution.datasources.csv.CSVDataSource.inferSchema(CSVDataSource.scala:62)&lt;br/&gt;
	at org.apache.spark.sql.execution.datasources.csv.CSVFileFormat.inferSchema(CSVFileFormat.scala:57)&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Note:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Though its the limitation of the univocity parser and the workaround is to provide any other comment character by mentioning .option(&quot;comment&quot;,&quot;#&quot;), but if my actual data starts with this character then the particular row will be discarded.&lt;/p&gt;

&lt;p&gt;Currently I pushed the code in univocity parser to handle this scenario as part of the below PR&lt;br/&gt;
&lt;a href=&quot;https://github.com/uniVocity/univocity-parsers/pull/412&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/uniVocity/univocity-parsers/pull/412&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;please accept the jira so that we can enable this feature in spark-csv by adding a parameter in spark csvoptions.&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13322662">SPARK-32614</key>
            <summary>Support for treating the line as valid record if it starts with \u0000 or null character, or starts with any character mentioned as comment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean R. Owen</assignee>
                                    <reporter username="Chanduhawk">Chandan Ray</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Fri, 14 Aug 2020 04:42:46 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:05 +0000</updated>
                            <resolved>Tue, 25 Aug 2020 15:29:24 +0000</resolved>
                                    <version>2.2.3</version>
                    <version>2.4.5</version>
                    <version>3.0.0</version>
                                    <fixVersion>3.0.1</fixVersion>
                    <fixVersion>3.1.0</fixVersion>
                                    <component>Spark Core</component>
                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17178537" author="srowen" created="Sun, 16 Aug 2020 17:03:42 +0000"  >&lt;p&gt;I dont&apos; really understand this. Are you just saying you need to treat the null byte as a comment character? so set that as the comment char? what is the Spark issue here.&lt;/p&gt;</comment>
                            <comment id="17178560" author="chanduhawk" created="Sun, 16 Aug 2020 17:35:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;currently  spark cannt process the row that starts with null character.&lt;/b&gt;&lt;br/&gt;
If one of the rows the data file(CSV) starts with null or \u0000 character like below(PFA screenshot)&lt;br/&gt;
like below&lt;br/&gt;
&lt;b&gt;null&lt;/b&gt;,abc,test&lt;/p&gt;

&lt;p&gt;then spark will throw the error as mentioned in the description. i.e spark cannt process any row that starts with null character. It can only process the row if we set the options like below&lt;/p&gt;

&lt;p&gt;option(&quot;comment&quot;,&quot;a character&quot;)&lt;/p&gt;

&lt;p&gt;&lt;b&gt;comment&lt;/b&gt; - it will take a character that needs to be treated as comment character so spark wont process the row that starts with this character&lt;/p&gt;

&lt;p&gt;The above is a work around to process the row that starts with null. But this process is also flawed and subject to skip a valid row of data that may start with the comment character.&lt;br/&gt;
In data ware house most of the time we dont have comment charaters concept and all the rows needs to be processed.&lt;/p&gt;

&lt;p&gt;So there should be an option in spark which will disable the processing of comment characters like below&lt;/p&gt;

&lt;p&gt;option(&quot;enableProcessingComments&quot;, false)&lt;/p&gt;

&lt;p&gt;this option will disable checking for any comment character processing and can also process the rows that starts with the null or \u0000 character&lt;/p&gt;


</comment>
                            <comment id="17179064" author="srowen" created="Mon, 17 Aug 2020 15:29:08 +0000"  >&lt;p&gt;I see, you&apos;re not saying that nulls are comment characters in your data.&lt;br/&gt;
Are you just saying we need to update univocity?&lt;/p&gt;</comment>
                            <comment id="17179097" author="chanduhawk" created="Mon, 17 Aug 2020 16:23:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;yes the row that starts with null character is not a comment character in actual data warehouse projects. We have to process all rows irrespective of any startign chars.&lt;/p&gt;

&lt;p&gt;Univocity parser i already raised PR and its merged successfully which will enable the option whether to process comment characters or not.&lt;br/&gt;
&lt;a href=&quot;https://github.com/uniVocity/univocity-parsers/pull/412&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/uniVocity/univocity-parsers/pull/412&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;in spark we need to add the respective option in CSVoptions class and csvutils class&lt;/p&gt;

&lt;p&gt;&lt;b&gt;proposed changes in spark&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;val df = spark.read.option(&quot;delimiter&quot;,&quot;,&quot;).option(&quot;&lt;b&gt;processComments&lt;/b&gt;&quot;,&quot;false&quot;).csv(&quot;file:/E:/Data/Testdata.dat&quot;);&lt;/p&gt;

&lt;p&gt;this *processComments *option when set to false spark should not check for any comment characters and will process all rows even if it started with null or any other comment character.&lt;/p&gt;

&lt;p&gt;Please let me know if I can raise a PR on this, once this enhancement is accepted&lt;/p&gt;

</comment>
                            <comment id="17179148" author="srowen" created="Mon, 17 Aug 2020 17:44:03 +0000"  >&lt;p&gt;Why a new option then? how about you don&apos;t process comments if the comment char is not set?&lt;br/&gt;
I&apos;m still not quite clear on why this depends on processing comments or not?&lt;/p&gt;</comment>
                            <comment id="17179150" author="chanduhawk" created="Mon, 17 Aug 2020 17:50:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In spark if the comment option is not set then it will take \u0000 as default comment character. So in our case the data file, few rows starts with \u0000 character, so it will ignore those rows.&lt;/p&gt;

&lt;p&gt;so currently in spark csv options there is no option present to disable processing the comment characters at all so that it will treat all rows as valid rows. &lt;/p&gt;

&lt;p&gt;You can recreate this issue by using the data file screen shot that i attached in the jira.&lt;/p&gt;

&lt;p&gt;please try to process the csv file and keep any row that starts with \u0000&lt;/p&gt;</comment>
                            <comment id="17182528" author="srowen" created="Sat, 22 Aug 2020 21:29:31 +0000"  >&lt;p&gt;Sort of; Spark uses &apos;\u0000&apos; to mean &quot;no comment processing&quot;, but then does not apply that consistently. In your case I think it sets this as the comment char to Univocity even when &quot;not set&quot;, and defaulting to &quot;\u0000&quot;. I think that&apos;s the issue here because the univocity will try to ignore lines starting that way. &lt;br/&gt;
What I don&apos;t think we want to do is add a new flag for this, just deal with no setting of comment differently.&lt;br/&gt;
I wonder why the univocity change doesn&apos;t work that way?&lt;/p&gt;</comment>
                            <comment id="17182536" author="apachespark" created="Sat, 22 Aug 2020 22:09:13 +0000"  >&lt;p&gt;User &apos;srowen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29516&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29516&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17182537" author="apachespark" created="Sat, 22 Aug 2020 22:10:12 +0000"  >&lt;p&gt;User &apos;srowen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29516&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29516&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17182586" author="chanduhawk" created="Sun, 23 Aug 2020 05:11:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Univocity parser always takes default comment character as #. It seems spark updates the comment settings to \u0000 character. Please see the &lt;a href=&quot;https://github.com/uniVocity/univocity-parsers/pull/412&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/uniVocity/univocity-parsers/pull/412&lt;/a&gt; that raised which involves adding one new option which enable/disable the comment processing. Currently as per the PR still I think there should be an option which enable or disable the comment processing in spark CVS so that the parameter Boolean value can be passed to univocity parser&lt;/p&gt;

&lt;p&gt;As per PR If we will change that way then it might impact existing users for which \u0000 is a comment character by default. So I would say a separate optional config is a better solution. What I am saying here is that we need to wait for univocity 3.0.0 to be available where the new changes will be available then we can add spark changes in a proper manner.&lt;/p&gt;</comment>
                            <comment id="17184130" author="gurwls223" created="Tue, 25 Aug 2020 15:29:24 +0000"  >&lt;p&gt;Issue resolved by pull request 29516&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29516&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29516&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13009827" name="screenshot-1.png" size="2130" author="Chanduhawk" created="Fri, 14 Aug 2020 04:56:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 12 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hrhk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>