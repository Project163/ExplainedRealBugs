<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:26:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-35321] Spark 3.x can&apos;t talk to HMS 1.2.x and lower due to get_all_functions Thrift API missing</title>
                <link>https://issues.apache.org/jira/browse/SPARK-35321</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-10319&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-10319&lt;/a&gt; introduced a new API &lt;tt&gt;get_all_functions&lt;/tt&gt; which is only supported in Hive 1.3.0/2.0.0 and up. This is called when creating a new &lt;tt&gt;Hive&lt;/tt&gt; object:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Hive(HiveConf c, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; doRegisterAllFns) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; HiveException {
    conf = c;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (doRegisterAllFns) {
      registerAllFunctionsOnce();
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;tt&gt;registerAllFunctionsOnce&lt;/tt&gt; will reload all the permanent functions by calling the &lt;tt&gt;get_all_functions&lt;/tt&gt; API from the megastore. In Spark, we always pass &lt;tt&gt;doRegisterAllFns&lt;/tt&gt; as true, and this will cause failure:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: org.apache.hadoop.hive.ql.metadata.HiveException: org.apache.thrift.TApplicationException: Invalid method name: &lt;span class=&quot;code-quote&quot;&gt;&apos;get_all_functions&apos;&lt;/span&gt;
	at org.apache.hadoop.hive.ql.metadata.Hive.getAllFunctions(Hive.java:3897)
	at org.apache.hadoop.hive.ql.metadata.Hive.reloadFunctions(Hive.java:248)
	at org.apache.hadoop.hive.ql.metadata.Hive.registerAllFunctionsOnce(Hive.java:231)
	... 96 more
Caused by: org.apache.thrift.TApplicationException: Invalid method name: &lt;span class=&quot;code-quote&quot;&gt;&apos;get_all_functions&apos;&lt;/span&gt;
	at org.apache.thrift.TServiceClient.receiveBase(TServiceClient.java:79)
	at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$Client.recv_get_all_functions(ThriftHiveMetastore.java:3845)
	at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$Client.get_all_functions(ThriftHiveMetastore.java:3833)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It looks like Spark doesn&apos;t really need to call &lt;tt&gt;registerAllFunctionsOnce&lt;/tt&gt; since it loads the Hive permanent function directly from HMS API. The Hive &lt;tt&gt;FunctionRegistry&lt;/tt&gt; is only used for loading Hive built-in functions.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13376874">SPARK-35321</key>
            <summary>Spark 3.x can&apos;t talk to HMS 1.2.x and lower due to get_all_functions Thrift API missing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="csun">Chao Sun</assignee>
                                    <reporter username="csun">Chao Sun</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 May 2021 21:20:08 +0000</created>
                <updated>Wed, 20 Oct 2021 08:15:12 +0000</updated>
                            <resolved>Sat, 12 Jun 2021 02:33:25 +0000</resolved>
                                    <version>3.0.2</version>
                    <version>3.1.1</version>
                    <version>3.2.0</version>
                                    <fixVersion>3.2.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17339904" author="xkrogen" created="Wed, 5 May 2021 21:38:01 +0000"  >&lt;p&gt;Isn&apos;t this what the &lt;tt&gt;IsolatedClientLoader&lt;/tt&gt; is for? You should use e.g. &lt;tt&gt;spark.sql.hive.metastore.version=1.1&lt;/tt&gt; and this issue will go away IIUC.&lt;/p&gt;</comment>
                            <comment id="17339906" author="csun" created="Wed, 5 May 2021 21:44:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xkrogen&quot; class=&quot;user-hover&quot; rel=&quot;xkrogen&quot;&gt;xkrogen&lt;/a&gt;&#160;yes that can help to solve the issue, but users need to specify both &lt;tt&gt;spark.sql.hive.metastore.version&lt;/tt&gt; and &lt;tt&gt;spark.sql.hive.metastore.jars&lt;/tt&gt;. The latter is not so easy to setup: the &lt;tt&gt;maven&lt;/tt&gt; option usually takes a very long time to download all the jars, while the &lt;tt&gt;path&lt;/tt&gt; option require users to download all the relevant Hive jars with the specific version and it&apos;s tedious.&#160;&lt;/p&gt;

&lt;p&gt;I think this specific issue is worth fixing in Spark itself regardless since it doesn&apos;t really need to load all the permanent functions when starting up Hive client from what I can see. The process could also be pretty expensive if there are many UDFs registered in HMS.&lt;/p&gt;</comment>
                            <comment id="17339911" author="xkrogen" created="Wed, 5 May 2021 21:51:25 +0000"  >&lt;p&gt;Gotcha. Yeah, agreed that if it&apos;s unnecessary we may as well improve the cross-version compatibility.&lt;/p&gt;</comment>
                            <comment id="17339944" author="q79969786" created="Thu, 6 May 2021 00:19:06 +0000"  >&lt;p&gt;Could we add a parameter to disable registerAllFunctionsOnce? &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-21563&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-21563&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17339946" author="csun" created="Thu, 6 May 2021 00:33:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yumwang&quot; class=&quot;user-hover&quot; rel=&quot;yumwang&quot;&gt;yumwang&lt;/a&gt;&#160;I&apos;m thinking of using&#160;&lt;a href=&quot;https://github.com/apache/hive/blob/master/ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java#L389&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Hive#getWithFastCheck&lt;/a&gt; for this purpose, which allows us to set the flag to false. The fast check flag also offers a way to compare &lt;tt&gt;HiveConf&lt;/tt&gt; faster when the conf rarely changes.&lt;/p&gt;</comment>
                            <comment id="17339947" author="apachespark" created="Thu, 6 May 2021 00:39:10 +0000"  >&lt;p&gt;User &apos;sunchao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/32446&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/32446&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17339948" author="apachespark" created="Thu, 6 May 2021 00:40:24 +0000"  >&lt;p&gt;User &apos;sunchao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/32446&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/32446&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17341050" author="dongjoon" created="Fri, 7 May 2021 22:10:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/pull/32446&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/32446&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17341053" author="apachespark" created="Fri, 7 May 2021 22:19:00 +0000"  >&lt;p&gt;User &apos;sunchao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/32471&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/32471&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17341056" author="apachespark" created="Fri, 7 May 2021 22:20:01 +0000"  >&lt;p&gt;User &apos;sunchao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/32472&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/32472&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17341396" author="dongjoon" created="Sat, 8 May 2021 20:03:43 +0000"  >&lt;p&gt;This is reverted due to &lt;a href=&quot;https://github.com/apache/spark/pull/32446#issuecomment-835419237&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/32446#issuecomment-835419237&lt;/a&gt; .&lt;/p&gt;</comment>
                            <comment id="17362047" author="apachespark" created="Fri, 11 Jun 2021 21:10:38 +0000"  >&lt;p&gt;User &apos;sunchao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/32887&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/32887&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17362048" author="apachespark" created="Fri, 11 Jun 2021 21:11:27 +0000"  >&lt;p&gt;User &apos;sunchao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/32887&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/32887&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17362218" author="q79969786" created="Sat, 12 Jun 2021 02:33:25 +0000"  >&lt;p&gt;Issue resolved by pull request 32887&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/32887&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/32887&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13407455">SPARK-37069</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13225422">HIVE-21563</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 22 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0qrhc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>