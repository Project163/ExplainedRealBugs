<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:41:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-14962] spark.sql.orc.filterPushdown=true breaks DataFrame where functionality</title>
                <link>https://issues.apache.org/jira/browse/SPARK-14962</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When running spark-shell with the configuration &quot;spark.sql.orc.filterPushdown=true&quot;, the DataFrame function where and filter have an error. In particular, &quot;column is not null&quot; fails.&lt;/p&gt;

&lt;p&gt;Example Code:&lt;/p&gt;

&lt;p&gt;import sqlContext.implicits._&lt;br/&gt;
case class MyData(string_field: String, array_field: Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;)&lt;/p&gt;

&lt;p&gt;val myDataArray = Array(&lt;br/&gt;
    MyData(&quot;foo&quot;, Seq(&quot;bar&quot;)),&lt;br/&gt;
    MyData(&quot;foobar&quot;, null)&lt;br/&gt;
)&lt;/p&gt;

&lt;p&gt;val myDataDF = sc.parallelize(myDataArray).toDF&lt;br/&gt;
myDataDF.count // 2&lt;br/&gt;
myDataDF.where(&quot;array_field is null&quot;).count // 1&lt;br/&gt;
myDataDF.where(&quot;array_field is not null&quot;).count // 1&lt;/p&gt;

&lt;p&gt;myDataDF.write.format(&quot;orc&quot;).save(&quot;/tmp/mydata.orc&quot;)&lt;/p&gt;

&lt;p&gt;val myLoadedDataDF = sqlContext.read.format(&quot;orc&quot;).load(&quot;/tmp/mydata.orc&quot;)&lt;br/&gt;
myLoadedDataDF.count // 2&lt;br/&gt;
myLoadedDataDF.where(&quot;array_field is not null&quot;).count // 0 incorrect&lt;/p&gt;</description>
                <environment></environment>
        <key id="12963224">SPARK-14962</key>
            <summary>spark.sql.orc.filterPushdown=true breaks DataFrame where functionality</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gurwls223">Hyukjin Kwon</assignee>
                                    <reporter username="jdfinsf">Justin Foster</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Apr 2016 17:52:05 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:57 +0000</updated>
                            <resolved>Fri, 6 May 2016 17:59:36 +0000</resolved>
                                    <version>1.5.2</version>
                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15263560" author="gurwls223" created="Fri, 29 Apr 2016 05:19:17 +0000"  >&lt;p&gt;&lt;del&gt;FWIW, I could not reproduce this in master branch. Let me try to find the related JIRA.&lt;/del&gt; I forgot to enable predicate pushdown. I can reproduce in the master. Let me look into this.&lt;/p&gt;</comment>
                            <comment id="15263759" author="gurwls223" created="Fri, 29 Apr 2016 09:05:27 +0000"  >&lt;p&gt;I see. This was because ORC tries to apply a filter on the column which has the type ORC does not supprot (&lt;tt&gt;ArrayType&lt;/tt&gt;).&lt;/p&gt;

&lt;p&gt;ORC supports &lt;tt&gt;String&lt;/tt&gt;, &lt;tt&gt;Long&lt;/tt&gt;, &lt;tt&gt;Double&lt;/tt&gt;, &lt;tt&gt;Byte&lt;/tt&gt;, &lt;tt&gt;Short&lt;/tt&gt;, &lt;tt&gt;Integer&lt;/tt&gt;, &lt;tt&gt;Float&lt;/tt&gt;, &lt;tt&gt;DateWritable&lt;/tt&gt;, &lt;tt&gt;HiveDecimal&lt;/tt&gt;, &lt;tt&gt;HiveChar&lt;/tt&gt; and &lt;tt&gt;HiveVarchar&lt;/tt&gt;. This is apparently OK because it does not take a type as an argument (Hive 1.2.x) during building filters (&lt;tt&gt;SearchArgument&lt;/tt&gt;) but this became problematic when tries to evaluate.&lt;/p&gt;

&lt;p&gt;Currently &lt;tt&gt;IsNull&lt;/tt&gt; and &lt;tt&gt;IsNotNull&lt;/tt&gt; can be built for ORC on all types in Spark-side but it does not filter correctly because stored statistics always produces &lt;tt&gt;null&lt;/tt&gt; for not supported types, eg &lt;tt&gt;ArrayType&lt;/tt&gt; in ORC-side. So, it is always &lt;tt&gt;true&lt;/tt&gt; for &lt;tt&gt;IsNull&lt;/tt&gt; which ends up always &lt;tt&gt;false&lt;/tt&gt; for &lt;tt&gt;IsNotNull&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;This was prevented in Hive 1.3.x by forcing to give a type when building a filter (&lt;tt&gt;SearchArgument&lt;/tt&gt; but Hive 1.2.x is not doing this. &lt;/p&gt;

&lt;p&gt;Let me submit a PR with a more clear description.&lt;/p&gt;</comment>
                            <comment id="15263948" author="apachespark" created="Fri, 29 Apr 2016 11:51:03 +0000"  >&lt;p&gt;User &apos;HyukjinKwon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/12777&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12777&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15274465" author="lian cheng" created="Fri, 6 May 2016 17:59:36 +0000"  >&lt;p&gt;Issue resolved by pull request 12777&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/12777&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12777&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2wuvj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>