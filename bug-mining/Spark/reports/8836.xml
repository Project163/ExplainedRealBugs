<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:32:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-41982] When the inserted partition type is of string type, similar `dt=01` will be converted to `dt=1`</title>
                <link>https://issues.apache.org/jira/browse/SPARK-41982</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;At present, during the process of upgrading Spark2.4 to Spark3.2, we carefully read the migration documentwe and found a kind of situation not involved:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
create table &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not exists test_90(a string, b string) partitioned by (dt string);
desc formatted test_90;
&lt;span class=&quot;code-comment&quot;&gt;// case1
&lt;/span&gt;insert into table test_90 partition (dt=05) values(&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;);
&lt;span class=&quot;code-comment&quot;&gt;// case2
&lt;/span&gt;insert into table test_90 partition (dt=&lt;span class=&quot;code-quote&quot;&gt;&apos;05&apos;&lt;/span&gt;) values(&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;);
drop table test_90;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;in spark2.4.3, it will generate such a path:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// the path
&lt;/span&gt;hdfs:&lt;span class=&quot;code-comment&quot;&gt;//test5/user/hive/db1/test_90/dt=05 
&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;//result
&lt;/span&gt;spark-sql&amp;gt; select * from test_90;
1 &#160; &#160; &#160; 2 &#160; &#160; &#160; 05
1 &#160; &#160;   2 &#160; &#160;   05
Time taken: 1.316 seconds, Fetched 2 row(s)

spark-sql&amp;gt; show partitions test_90; 
dt=05 
Time taken: 0.201 seconds, Fetched 1 row(s)

spark-sql&amp;gt; select * from test_90 where dt=&lt;span class=&quot;code-quote&quot;&gt;&apos;05&apos;&lt;/span&gt;;
1 &#160; &#160;   2 &#160; &#160;   05
1 &#160;    &#160;2 &#160; &#160;   05
Time taken: 0.212 seconds, Fetched 2 row(s)

spark-sql&amp;gt; explain insert into table test_90 partition (dt=05) values(&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;);
== Physical Plan ==
Execute InsertIntoHiveTable InsertIntoHiveTable `db1`.`test_90`, org.apache.hadoop.hive.ql.io.orc.OrcSerde, Map(dt -&amp;gt; Some(05)), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, [a, b]
+- LocalTableScan [a#116, b#117]
Time taken: 1.145 seconds, Fetched 1 row(s)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;in spark3.2.0, it will generate two path:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// the path
&lt;/span&gt;hdfs:&lt;span class=&quot;code-comment&quot;&gt;//test5/user/hive/db1/test_90/dt=05 
&lt;/span&gt;hdfs:&lt;span class=&quot;code-comment&quot;&gt;//test5/user/hive/db1/test_90/dt=5 
&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;// result
&lt;/span&gt;spark-sql&amp;gt; select * from test_90;
1 &#160; &#160; &#160; 2 &#160; &#160; &#160; 05
1 &#160; &#160;   2 &#160; &#160;   5
Time taken: 2.119 seconds, Fetched 2 row(s)

spark-sql&amp;gt; show partitions test_90;
dt=05
dt=5
Time taken: 0.161 seconds, Fetched 2 row(s)

spark-sql&amp;gt; select * from test_90 where dt=&lt;span class=&quot;code-quote&quot;&gt;&apos;05&apos;&lt;/span&gt;;
1 &#160; &#160;   2 &#160; &#160;   05
Time taken: 0.252 seconds, Fetched 1 row(s)

spark-sql&amp;gt; explain insert into table test_90 partition (dt=05) values(&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;);
plan
== Physical Plan ==
Execute InsertIntoHiveTable `db1`.`test_90`, org.apache.hadoop.hive.ql.io.orc.OrcSerde, [dt=Some(5)], &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, [a, b]
+- LocalTableScan [a#109, b#110]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This will cause problems in reading data after the user switches to spark3. The root cause is that in the process of partition field resolution, Spark3 has a process of strongly converting this string type, which will cause partition `05` to lose the previous `0`&lt;/p&gt;

&lt;p&gt;So I think we have two solutions:&lt;/p&gt;

&lt;p&gt;one is to record the risk clearly in the migration document, and the other is to repair this case, because we internally keep the partition of string type as string type, regardless of whether single or double quotation marks are added.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13517574">SPARK-41982</key>
            <summary>When the inserted partition type is of string type, similar `dt=01` will be converted to `dt=1`</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zhongjingxiong">jingxiong zhong</assignee>
                                    <reporter username="zhongjingxiong">jingxiong zhong</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Jan 2023 09:12:43 +0000</created>
                <updated>Tue, 17 Jan 2023 04:47:59 +0000</updated>
                            <resolved>Tue, 17 Jan 2023 04:47:16 +0000</resolved>
                                    <version>3.4.0</version>
                                    <fixVersion>3.4.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17672320" author="JIRAUSER281124" created="Wed, 11 Jan 2023 11:16:57 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gurwls223&quot; class=&quot;user-hover&quot; rel=&quot;gurwls223&quot;&gt;gurwls223&lt;/a&gt; I want to know your opinion.&lt;/p&gt;</comment>
                            <comment id="17676734" author="apachespark" created="Fri, 13 Jan 2023 19:11:18 +0000"  >&lt;p&gt;User &apos;smallzhongfeng&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/39558&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/39558&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17676737" author="apachespark" created="Fri, 13 Jan 2023 19:12:20 +0000"  >&lt;p&gt;User &apos;smallzhongfeng&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/39558&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/39558&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17677600" author="cloud_fan" created="Tue, 17 Jan 2023 04:47:16 +0000"  >&lt;p&gt;Issue resolved by pull request 39558&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/39558&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/39558&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 43 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1eprs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>