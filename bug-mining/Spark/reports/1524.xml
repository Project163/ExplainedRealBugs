<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:24:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-6048] SparkConf.translateConfKey should not translate on set</title>
                <link>https://issues.apache.org/jira/browse/SPARK-6048</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;There are several issues with translating on set.&lt;/p&gt;

&lt;p&gt;(1) The most serious one is that if the user has both the deprecated and the latest version of the same config set, then the value picked up by SparkConf will be arbitrary. Why? Because during initialization of the conf we call `conf.set` on each property in `sys.props` in an order arbitrarily defined by Java. As a result, the value of the more recent config may be overridden by that of the deprecated one. Instead, we should always use the value of the most recent config.&lt;/p&gt;

&lt;p&gt;(2) If we translate on set, then we must keep translating everywhere else. In fact, the current code does not translate on remove, which means the following won&apos;t work if X is deprecated:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;conf.set(X, Y)
conf.remove(X) &lt;span class=&quot;code-comment&quot;&gt;// X is not in the conf&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This requires us to also translate in remove and other places, as we already do for contains, leading to more duplicate code.&lt;/p&gt;

&lt;p&gt;(3) Since we call `conf.set` on all configs when initializing the conf, we print all deprecation warnings in the beginning. Elsewhere in Spark, however, we warn the user when the deprecated config / option / env var is actually being used.&lt;br/&gt;
We should keep this consistent so the user won&apos;t expect to find all deprecation messages in the beginning of his logs.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12778087">SPARK-6048</key>
            <summary>SparkConf.translateConfKey should not translate on set</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="andrewor14">Andrew Or</assignee>
                                    <reporter username="andrewor14">Andrew Or</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Feb 2015 00:55:06 +0000</created>
                <updated>Thu, 9 Apr 2015 21:52:02 +0000</updated>
                            <resolved>Tue, 3 Mar 2015 00:37:07 +0000</resolved>
                                    <version>1.3.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14339498" author="apachespark" created="Fri, 27 Feb 2015 01:00:35 +0000"  >&lt;p&gt;User &apos;andrewor14&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/4799&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/4799&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14339519" author="vanzin" created="Fri, 27 Feb 2015 01:12:19 +0000"  >&lt;p&gt;I sort of agree with (1). But I think it&apos;s both unlikely (users will probably use the old option or the new one, but not both), and probably sort of fixable (but not optimally). Basically, don&apos;t override a value that&apos;s already set when using the deprecated key.&lt;/p&gt;

&lt;p&gt;I disagree with (2). Just fix remove().&lt;/p&gt;

&lt;p&gt;I also disagree with (3), and it&apos;s not even the correct interpretation of what happens. Warning &lt;b&gt;only&lt;/b&gt; happen when the configuration keys are set, never when reading. And I think it&apos;s actually a good thing that all (or most) of the warnings show up when creating the conf object, which generally happens early in the app&apos;s life. It means it&apos;s easier to see them.&lt;/p&gt;</comment>
                            <comment id="14339544" author="andrewor14" created="Fri, 27 Feb 2015 01:31:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Note that (3) is orthogonal to this change. We can still do all the warnings at the beginning rather than later. However I still don&apos;t see why warnings should necessarily be tied to when keys are set, though that is a separate discussion.&lt;/p&gt;

&lt;p&gt;For (2), yes we can just fix remove(), but doing so means duplicating the translation and keeping track of one more place where the translation takes place. In the future if we add more methods to SparkConf, we&apos;ll have to remember to do the translation otherwise it won&apos;t work correctly. I personally find limiting the scope of translation much cleaner.&lt;/p&gt;

&lt;p&gt;(1) Maybe it&apos;s unlikely, but it breaks existing user behavior in a confounding way nevertheless. When it fails it will be extremely difficult to debug which value is used without doing some querying of the conf itself.&lt;/p&gt;</comment>
                            <comment id="14339591" author="vanzin" created="Fri, 27 Feb 2015 02:04:08 +0000"  >&lt;p&gt;What do you mean by &quot;duplicates the translation&quot; (regarding 2)? It&apos;s just a call to &quot;translateKey()&quot;.&lt;/p&gt;

&lt;p&gt;Regarding 1, that problem exists regardless of my change. You need to specify some precedence order. See the case in FsHistoryProvider, where there are 2 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/warning.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; deprecated keys for the same config. What if the user sets those two deprecated keys in the conf? What&apos;s the expectation? Perhaps you need to enforce some sort of ordering for the deprecated keys in SparkConf, but I don&apos;t see why that means translating on get and not on set.&lt;/p&gt;

&lt;p&gt;Note the goal of the deprecated configs was to make the Spark code only have to care about the most recent key name. Your proposal goes against that, and would require the deprecated names to live both in SparkConf and in the code that needs to read them.&lt;/p&gt;</comment>
                            <comment id="14339624" author="andrewor14" created="Fri, 27 Feb 2015 02:30:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;What do you mean by &quot;duplicates the translation&quot; (regarding 2)? It&apos;s just a call to &quot;translateKey()&quot;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s not about the number of lines that are being duplicated. It&apos;s about the translation logic. Right now it&apos;s not correct to translate in set but not in all interfaces exposed by SparkConf. As we have seen with the case of `remove` it&apos;s easy to miss one or two of these interfaces. If we only translate in `get` then we don&apos;t have to worry about this.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Regarding 1, that problem exists regardless of my change.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s actually not true. Before your change, if we specify both the deprecated config and the most recent one, the behavior will be determined by the place where these values are used. Even if we called `set` on the deprecated config over the more recent one, the value of the latter is still preserved because we didn&apos;t translate on `set`. To answer your question, the expected behavior is for the value of the more recent config to &lt;b&gt;always&lt;/b&gt; take precedence.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Note the goal of the deprecated configs was to make the Spark code only have to care about the most recent key name. Your proposal goes against that, and would require the deprecated names to live both in SparkConf and in the code that needs to read them.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, unfortunately, and I agree it&apos;s something we need to fix in the future. My eventual goal is to do hide all the deprecation logic throughout the Spark code, and this is why I filed &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-5933&quot; title=&quot;Centralize deprecated configs in SparkConf&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-5933&quot;&gt;&lt;del&gt;SPARK-5933&lt;/del&gt;&lt;/a&gt; before. Currently, however, this is a correctness issue that is blocking the 1.3 release, so my personal opinion is that we should first fix this broken behavior and worry about the code style later.&lt;/p&gt;</comment>
                            <comment id="14339629" author="pwendell" created="Fri, 27 Feb 2015 02:33:22 +0000"  >&lt;p&gt;Hey All,&lt;/p&gt;

&lt;p&gt;No opinions on which design we chose to implement internally. However, I do feel strongly that the user-facing precedence should not change between versions. It&apos;s not reasonable to assume that no user has both the old and new names for a config value. Configuration files can be very long, or there can be multiple sources of configuration, such as a user using both flags and a file. So changing the semantics randomly in a release constitutes a breaking change of behavior.&lt;/p&gt;

&lt;p&gt;In terms of the nicest possible way to achieve these semantics, that&apos;s up to you guys since you&apos;re much more familiar with this code. The current patch seems to just rewind the behavior that was introduced earlier. Marcello, unless you see some correctness problem with that patch, I&apos;d like to merge it to unblock the release. If you guys think it&apos;s way better to do translation on writes than reads, it&apos;s fine to propose that in a new patch.&lt;/p&gt;</comment>
                            <comment id="14340398" author="vanzin" created="Fri, 27 Feb 2015 17:19:58 +0000"  >&lt;p&gt;But the current patch has a precedence problem and that&apos;s what I&apos;m trying to say. Let me illustrate. Let&apos;s say some Spark deployment has this spark-defaults.conf:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;spark.files.userClassPathFirst=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Some user app is broken and the user does this in his code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;val conf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SparkConf().set(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark.files.userClassPathFirst&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now the admin upgrades to Spark 1.3, goes through the docs, and changes spark-defaults.conf to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;spark.executor.userClassPathFirst=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With the change, you&apos;ve broken that application. SparkConf does&apos;t haven enough information to know that the user is trying to override the new config using the old name, because it doesn&apos;t keep track of where configs are set from.&lt;/p&gt;

&lt;p&gt;Ignoring Andrew&apos;s point #1 for a second, doing the translation on set solves that problem.&lt;/p&gt;

&lt;p&gt;Now, Andrew has a point about #1, and it&apos;s because SparkSubmit mixes things up by using system properties to merge default and user settings (plus Spark allowing the use of system properties for config in general). But that should be easily solvable in SparkSubmit by doing something like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Utils.getSystemProperties.foreach { &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; (k, v) =&amp;gt;
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (k.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark.&quot;&lt;/span&gt;)) {
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.clearProperty(k)
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(SparkConf.translateKey(k), v)
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For better or worse, I like to think of config names as a public API. In that light, Andrew&apos;s change breaks binary compatibility, because it breaks the application above. If you need further proof, look at the unit test that Andrew&apos;s first version of the patch broke. It illustrates exactly the above situation.&lt;/p&gt;</comment>
                            <comment id="14340740" author="pwendell" created="Fri, 27 Feb 2015 20:10:22 +0000"  >&lt;p&gt;Okay I just talked to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt; offline. Basically the crux of this issue is the following precedence question: If we have both the deprecated and new version of a configuration key (let&apos;s say c and c&apos;) present, how does Spark handle the precedence order with respect to the normal precedence order in Spark for configs?&lt;/p&gt;

&lt;p&gt;There are two different possibilities:&lt;br/&gt;
1. Using the newer config always gives you highest precedence over any instance of an older config.&lt;br/&gt;
2. The newer and older config are treated as identical (basically, aliases) and only the normal precedence order applies.&lt;/p&gt;

&lt;p&gt;We never publicly documented either approach, however Spark always has done (1) in the past because we&apos;ve used simple fallbacks on the read side.&lt;/p&gt;

&lt;p&gt;Personally my feeling is that we should clearly document some approach, have it be backwards compatible, and have the same approach for all deprecated configs. In the short term, the only way I see that happening is to roll back the existing translation on &quot;set&quot; (this is in some sense lossy, making it hard to support (1)) and stick to translation on &quot;get&quot;. In the longer term, maybe we can come up with alternative ways to support these semantics.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12776558">SPARK-5933</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 38 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i264lr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327642">1.3.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>