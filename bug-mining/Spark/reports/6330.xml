<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:04:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-26146] CSV wouln&apos;t be ingested in Spark 2.4.0 with Scala 2.12</title>
                <link>https://issues.apache.org/jira/browse/SPARK-26146</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Ingestion of a CSV file seems to fail with Spark v2.4.0 and Scala v2.12, where it works ok with Scala v2.11.&lt;/p&gt;

&lt;p&gt;When running a simple CSV ingestion like:&lt;tt&gt;&#160;&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// Creates a session on a local master
&lt;/span&gt;&#160; &#160; SparkSession spark = SparkSession.builder()
&#160; &#160; &#160; &#160; .appName(&lt;span class=&quot;code-quote&quot;&gt;&quot;CSV to Dataset&quot;&lt;/span&gt;)
&#160; &#160; &#160; &#160; .master(&lt;span class=&quot;code-quote&quot;&gt;&quot;local&quot;&lt;/span&gt;)
&#160; &#160; &#160; &#160; .getOrCreate();
&#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// Reads a CSV file with header, called books.csv, stores it in a dataframe
&lt;/span&gt;&#160; &#160; Dataset&amp;lt;Row&amp;gt; df = spark.read().format(&lt;span class=&quot;code-quote&quot;&gt;&quot;csv&quot;&lt;/span&gt;)
&#160; &#160; &#160; &#160; .option(&lt;span class=&quot;code-quote&quot;&gt;&quot;header&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;)
&#160; &#160; &#160; &#160; .load(&lt;span class=&quot;code-quote&quot;&gt;&quot;data/books.csv&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&#160;With Scala 2.12, I get:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.ArrayIndexOutOfBoundsException: 10582
at com.thoughtworks.paranamer.BytecodeReadingParanamer$ClassReader.accept(BytecodeReadingParanamer.java:563)
at com.thoughtworks.paranamer.BytecodeReadingParanamer$ClassReader.access$200(BytecodeReadingParanamer.java:338)
at com.thoughtworks.paranamer.BytecodeReadingParanamer.lookupParameterNames(BytecodeReadingParanamer.java:103)
at com.thoughtworks.paranamer.CachingParanamer.lookupParameterNames(CachingParanamer.java:90)
at com.fasterxml.jackson.module.scala.introspect.BeanIntrospector$.getCtorParams(BeanIntrospector.scala:44)
at com.fasterxml.jackson.module.scala.introspect.BeanIntrospector$.$anonfun$apply$1(BeanIntrospector.scala:58)
at com.fasterxml.jackson.module.scala.introspect.BeanIntrospector$.$anonfun$apply$1$adapted(BeanIntrospector.scala:58)
at scala.collection.TraversableLike.$anonfun$flatMap$1(TraversableLike.scala:240)
...
at net.jgp.books.sparkWithJava.ch01.CsvToDataframeApp.start(CsvToDataframeApp.java:37)
at net.jgp.books.sparkWithJava.ch01.CsvToDataframeApp.main(CsvToDataframeApp.java:21)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Where it works pretty smoothly if I switch back to 2.11.&lt;/p&gt;

&lt;p&gt;Full example available at &lt;a href=&quot;https://github.com/jgperrin/net.jgp.books.sparkWithJava.ch01.&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jgperrin/net.jgp.books.sparkWithJava.ch01.&lt;/a&gt;&#160;You can modify pom.xml to change easily the Scala version in the property section:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;properties&amp;gt;
 &amp;lt;project.build.sourceEncoding&amp;gt;UTF-8&amp;lt;/project.build.sourceEncoding&amp;gt;
 &amp;lt;java.version&amp;gt;1.8&amp;lt;/java.version&amp;gt;
 &amp;lt;scala.version&amp;gt;2.11&amp;lt;/scala.version&amp;gt;
 &amp;lt;spark.version&amp;gt;2.4.0&amp;lt;/spark.version&amp;gt;
&amp;lt;/properties&amp;gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;(ps. It&apos;s my first bug submission, so I hope I did not mess too much, be tolerant if I did)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13200075">SPARK-26146</key>
            <summary>CSV wouln&apos;t be ingested in Spark 2.4.0 with Scala 2.12</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jgp">Jean Georges Perrin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Nov 2018 13:11:16 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:40 +0000</updated>
                            <resolved>Sat, 2 Mar 2019 20:09:31 +0000</resolved>
                                    <version>2.4.0</version>
                                                    <component>Input/Output</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16697533" author="anders5737" created="Fri, 23 Nov 2018 22:08:17 +0000"  >&lt;p&gt;I also run into this bug. I&#160;too could avoid it by reverting from Scala version 2.12 to 2.11.&lt;/p&gt;</comment>
                            <comment id="16699238" author="gurwls223" created="Mon, 26 Nov 2018 16:30:39 +0000"  >&lt;p&gt;Would you mind if I ask to make a reproducer with spark-shell if possible? should be easier to reproduce and many people could try and investigate.&lt;/p&gt;</comment>
                            <comment id="16772054" author="heuermh" created="Tue, 19 Feb 2019 16:02:44 +0000"  >&lt;p&gt;Another possible reproducing case&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/disq-bio/disq/pull/88&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/disq-bio/disq/pull/88&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16782506" author="srowen" created="Sat, 2 Mar 2019 20:09:31 +0000"  >&lt;p&gt;Is that code from Spark? it doesn&apos;t quite look like it from the stack trace. It&apos;s a paranamer problem with Java 8 that I think is triggered by Scala 2.12, which uses lambdas for closures. This was updated in Spark 2.4 though in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-22128&quot; title=&quot;Update paranamer to 2.8 to avoid BytecodeReadingParanamer ArrayIndexOutOfBoundsException with Scala 2.12 + Java 8 lambda&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-22128&quot;&gt;&lt;del&gt;SPARK-22128&lt;/del&gt;&lt;/a&gt; for this reason. I&apos;m wondering if you are using a different paranamer dependency in your app, either in the non-Spark or Spark code. Update to 2.8.&lt;/p&gt;

&lt;p&gt;In any event, at least, the CSV tests are fine in Java 8 + Scala 2.12 + Spark 2.4.&lt;/p&gt;</comment>
                            <comment id="16782519" author="heuermh" created="Sat, 2 Mar 2019 20:46:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt; Hey, wait a minute, the full example from the original submitter appears to be in github here&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/jgperrin/net.jgp.books.spark.ch01&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jgperrin/net.jgp.books.spark.ch01&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This example has no explicit dependency on paranamer, and neither does Disq for that matter &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/disq-bio/disq/blob/5760a80b3322c537226a876e0df4f7710188f7b2/pom.xml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/disq-bio/disq/blob/5760a80b3322c537226a876e0df4f7710188f7b2/pom.xml&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is not the first instance I&apos;ve seen (and reported) where Spark itself has dependencies that conflict or otherwise are not compatible with each other, and those do not manifest themselves at test scope in Spark CI, only when an external project has a compile scope dependency on Spark jars.&lt;/p&gt;</comment>
                            <comment id="16782522" author="heuermh" created="Sat, 2 Mar 2019 20:52:39 +0000"  >&lt;p&gt;It appears that this is a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26583&quot; title=&quot;Add `paranamer` dependency to `core` module&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26583&quot;&gt;&lt;del&gt;SPARK-26583&lt;/del&gt;&lt;/a&gt; and will be resolved in 2.4.1.&lt;/p&gt;</comment>
                            <comment id="16782526" author="srowen" created="Sat, 2 Mar 2019 21:03:20 +0000"  >&lt;p&gt;It&apos;s possible, even likely, that the dependency is transitive. In this case:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[INFO] net.jgp.books:spark-chapter01:jar:1.0.0-SNAPSHOT
[INFO] +- org.apache.spark:spark-core_2.11:jar:2.4.0:compile
[INFO] |  +- org.apache.avro:avro:jar:1.8.2:compile
[INFO] |  |  +- org.codehaus.jackson:jackson-core-asl:jar:1.9.13:compile
[INFO] |  |  +- org.codehaus.jackson:jackson-mapper-asl:jar:1.9.13:compile
[INFO] |  |  +- com.thoughtworks.paranamer:paranamer:jar:2.7:compile
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here&apos;s what I&apos;m confused about: Spark has depended on paranamer 2.8 since 2.3.0:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/blob/v2.4.0/pom.xml#L185&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/v2.4.0/pom.xml#L185&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[INFO] +- org.apache.spark:spark-core_2.12:jar:3.0.0-SNAPSHOT:compile
[INFO] |  +- com.thoughtworks.paranamer:paranamer:jar:2.8:runtime
[INFO] |  +- org.apache.avro:avro:jar:1.8.2:compile
[INFO] |  |  +- org.codehaus.jackson:jackson-core-asl:jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;My only guess right now is that this is due to the arcance scoping rules for transitive dependencies in Maven. paranamer is a runtime dependency. Here, Spark is given as a compile-time dependency. It should be &apos;provided&apos;. That doesn&apos;t change what Maven reports (weird still) but might solve the problem. Spark itself really does have 2.8. You can see it in &lt;a href=&quot;https://search.maven.org/artifact/org.apache.spark/spark-parent_2.12/2.4.0/pom&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://search.maven.org/artifact/org.apache.spark/spark-parent_2.12/2.4.0/pom&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I think this is still probably a weird issue between the code here and Maven.&lt;/p&gt;</comment>
                            <comment id="16782759" author="srowen" created="Sun, 3 Mar 2019 15:37:33 +0000"  >&lt;p&gt;Wait a sec, here&apos;s the explanation: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26583&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-26583&lt;/a&gt;&lt;br/&gt;
This is why the dependency graph is different; it was fixed after 2.4.0.&lt;br/&gt;
Making Spark a provided dependency is the right practice anyway (going to add docs about that) and might also work around this. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 37 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s00s0o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>