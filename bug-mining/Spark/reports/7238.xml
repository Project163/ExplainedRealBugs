<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:17:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-31903] toPandas with Arrow enabled doesn&apos;t show metrics in Query UI.</title>
                <link>https://issues.apache.org/jira/browse/SPARK-31903</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When calling &lt;tt&gt;toPandas&lt;/tt&gt;,&#160;usually Query UI shows each plan node&apos;s metric and corresponding Stage ID and Task ID:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;gt;&amp;gt;&amp;gt; df = spark.createDataFrame([(1, 10, &lt;span class=&quot;code-quote&quot;&gt;&apos;abc&apos;&lt;/span&gt;), (2, 20, &lt;span class=&quot;code-quote&quot;&gt;&apos;def&apos;&lt;/span&gt;)], schema=[&lt;span class=&quot;code-quote&quot;&gt;&apos;x&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;y&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;z&apos;&lt;/span&gt;])
&amp;gt;&amp;gt;&amp;gt; df.toPandas()
   x   y    z
0  1  10  abc
1  2  20  def
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13004762/13004762_Screen+Shot+2020-06-03+at+4.47.07+PM.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;but if Arrow execution is enabled, it shows only plan nodes and the duration is not correct:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;gt;&amp;gt;&amp;gt; spark.conf.set(&lt;span class=&quot;code-quote&quot;&gt;&apos;spark.sql.execution.arrow.pyspark.enabled&apos;&lt;/span&gt;, True)
&amp;gt;&amp;gt;&amp;gt; df.toPandas()
   x   y    z
0  1  10  abc
1  2  20  def&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13004763/13004763_Screen+Shot+2020-06-03+at+4.47.27+PM.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13309293">SPARK-31903</key>
            <summary>toPandas with Arrow enabled doesn&apos;t show metrics in Query UI.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ueshin">Takuya Ueshin</assignee>
                                    <reporter username="ueshin">Takuya Ueshin</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Jun 2020 23:46:48 +0000</created>
                <updated>Sat, 6 Jun 2020 07:51:20 +0000</updated>
                            <resolved>Fri, 5 Jun 2020 04:00:49 +0000</resolved>
                                    <version>2.4.5</version>
                    <version>3.0.0</version>
                                    <fixVersion>2.4.7</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>PySpark</component>
                    <component>R</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17126192" author="gengliang.wang" created="Thu, 4 Jun 2020 21:21:15 +0000"  >&lt;p&gt;I tried investigating the issue, I think the SparkListenerSQLExecutionEnd event is sent too early if arrow enabled.&lt;br/&gt;
Here is what normal events looks like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SparkListenerSQLExecutionStart
SparkListenerJobStart
SparkListenerTaskStart
...
SparkListenerTaskEnd
SparkListenerJobEnd
SparkListenerSQLExecutionEnd
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, with arrow enabled, the events looks like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SparkListenerSQLExecutionStart
SparkListenerSQLExecutionEnd
SparkListenerJobStart
SparkListenerTaskStart
...
SparkListenerTaskEnd
SparkListenerJobEnd
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The metrics are aggregated on receiving the event &quot;SparkListenerSQLExecutionEnd&quot;, which is why there are no metrics in UI.&lt;/p&gt;</comment>
                            <comment id="17126233" author="apachespark" created="Thu, 4 Jun 2020 22:29:13 +0000"  >&lt;p&gt;User &apos;ueshin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28730&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28730&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17126234" author="apachespark" created="Thu, 4 Jun 2020 22:30:51 +0000"  >&lt;p&gt;User &apos;ueshin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28730&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28730&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17127027" author="apachespark" created="Fri, 5 Jun 2020 19:16:46 +0000"  >&lt;p&gt;User &apos;ueshin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28740&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17127028" author="apachespark" created="Fri, 5 Jun 2020 19:16:48 +0000"  >&lt;p&gt;User &apos;ueshin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28740&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13004762" name="Screen Shot 2020-06-03 at 4.47.07 PM.png" size="44951" author="ueshin" created="Wed, 3 Jun 2020 23:47:38 +0000"/>
                            <attachment id="13004763" name="Screen Shot 2020-06-03 at 4.47.27 PM.png" size="36912" author="ueshin" created="Wed, 3 Jun 2020 23:47:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 23 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0fheg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>