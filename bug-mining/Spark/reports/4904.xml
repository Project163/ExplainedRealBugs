<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:53:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-20945] NoSuchElementException key not found in TaskSchedulerImpl</title>
                <link>https://issues.apache.org/jira/browse/SPARK-20945</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;We started spark ThriftServer, however when a job fails it caused the thriftserver also shutted down.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;2017-05-27,10:34:27,272 INFO org.apache.spark.scheduler.cluster.YarnScheduler: Cancelling stage 21&lt;br/&gt;
2017-05-27,10:34:27,274 ERROR org.apache.spark.scheduler.DAGSchedulerEventProcessLoop: DAGSchedulerEventProcessLoop failed; shutting down SparkContext&lt;br/&gt;
java.util.NoSuchElementException: key not found: 14100&lt;br/&gt;
at scala.collection.MapLike$class.default(MapLike.scala:228)&lt;br/&gt;
at scala.collection.AbstractMap.default(Map.scala:59)&lt;br/&gt;
at scala.collection.mutable.HashMap.apply(HashMap.scala:65)&lt;br/&gt;
at org.apache.spark.scheduler.TaskSchedulerImpl$$anonfun$cancelTasks$2$$anonfun$apply$3$$anonfun$apply$1.apply$mcVJ$sp(TaskSchedulerImpl.scala:226)&lt;br/&gt;
at org.apache.spark.scheduler.TaskSchedulerImpl$$anonfun$cancelTasks$2$$anonfun$apply$3$$anonfun$apply$1.apply(TaskSchedulerImpl.scala:225)&lt;br/&gt;
at org.apache.spark.scheduler.TaskSchedulerImpl$$anonfun$cancelTasks$2$$anonfun$apply$3$$anonfun$apply$1.apply(TaskSchedulerImpl.scala:225)&lt;br/&gt;
at scala.collection.mutable.HashSet.foreach(HashSet.scala:78)&lt;br/&gt;
at org.apache.spark.scheduler.TaskSchedulerImpl$$anonfun$cancelTasks$2$$anonfun$apply$3.apply(TaskSchedulerImpl.scala:225)&lt;br/&gt;
at org.apache.spark.scheduler.TaskSchedulerImpl$$anonfun$cancelTasks$2$$anonfun$apply$3.apply(TaskSchedulerImpl.scala:218)&lt;br/&gt;
at scala.collection.mutable.HashMap$$anonfun$foreach$1.apply(HashMap.scala:99)&lt;br/&gt;
at scala.collection.mutable.HashMap$$anonfun$foreach$1.apply(HashMap.scala:99)&lt;br/&gt;
at scala.collection.mutable.HashTable$class.foreachEntry(HashTable.scala:230)&lt;br/&gt;
at scala.collection.mutable.HashMap.foreachEntry(HashMap.scala:40)&lt;br/&gt;
at scala.collection.mutable.HashMap.foreach(HashMap.scala:99)&lt;br/&gt;
at org.apache.spark.scheduler.TaskSchedulerImpl$$anonfun$cancelTasks$2.apply(TaskSchedulerImpl.scala:218)&lt;br/&gt;
at org.apache.spark.scheduler.TaskSchedulerImpl$$anonfun$cancelTasks$2.apply(TaskSchedulerImpl.scala:217)&lt;br/&gt;
at scala.Option.foreach(Option.scala:257)&lt;br/&gt;
at org.apache.spark.scheduler.TaskSchedulerImpl.cancelTasks(TaskSchedulerImpl.scala:217)&lt;br/&gt;
at org.apache.spark.scheduler.DAGScheduler$$anonfun$org$apache$spark$scheduler$DAGScheduler$$failJobAndIndependentStages$1.apply$mcVI$sp(DAGScheduler.scala:1461)&lt;br/&gt;
at org.apache.spark.scheduler.DAGScheduler$$anonfun$org$apache$spark$scheduler$DAGScheduler$$failJobAndIndependentStages$1.apply(DAGScheduler.scala:1447)&lt;br/&gt;
at org.apache.spark.scheduler.DAGScheduler$$anonfun$org$apache$spark$scheduler$DAGScheduler$$failJobAndIndependentStages$1.apply(DAGScheduler.scala:1447)&lt;br/&gt;
at scala.collection.mutable.HashSet.foreach(HashSet.scala:78)&lt;br/&gt;
at org.apache.spark.scheduler.DAGScheduler.org$apache$spark$scheduler$DAGScheduler$$failJobAndIndependentStages(DAGScheduler.scala:1447)&lt;br/&gt;
at org.apache.spark.scheduler.DAGScheduler$$anonfun$abortStage$1.apply(DAGScheduler.scala:1423)&lt;br/&gt;
at org.apache.spark.scheduler.DAGScheduler$$anonfun$abortStage$1.apply(DAGScheduler.scala:1422)&lt;br/&gt;
at scala.collection.mutable.ResizableArray$class.foreach(ResizableArray.scala:59)&lt;br/&gt;
at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:48)&lt;br/&gt;
at org.apache.spark.scheduler.DAGScheduler.abortStage(DAGScheduler.scala:1422)&lt;br/&gt;
at org.apache.spark.scheduler.DAGScheduler$$anonfun$handleTaskSetFailed$1.apply(DAGScheduler.scala:802)&lt;br/&gt;
at org.apache.spark.scheduler.DAGScheduler$$anonfun$handleTaskSetFailed$1.apply(DAGScheduler.scala:802)&lt;br/&gt;
at scala.Option.foreach(Option.scala:257)&lt;br/&gt;
at org.apache.spark.scheduler.DAGScheduler.handleTaskSetFailed(DAGScheduler.scala:802)&lt;br/&gt;
at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.doOnReceive(DAGScheduler.scala:1650)&lt;br/&gt;
at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:1605)&lt;br/&gt;
at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:1594)&lt;br/&gt;
at org.apache.spark.util.EventLoop$$anon$1.run(EventLoop.scala:48)&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="13076382">SPARK-20945</key>
            <summary>NoSuchElementException key not found in TaskSchedulerImpl</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="liupengcheng">liupengcheng</assignee>
                                    <reporter username="liupengcheng">liupengcheng</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Jun 2017 03:31:18 +0000</created>
                <updated>Sun, 17 May 2020 17:46:58 +0000</updated>
                            <resolved>Mon, 5 Jun 2017 09:23:15 +0000</resolved>
                                    <version>2.1.0</version>
                    <version>2.1.1</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>Scheduler</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16032392" author="liupengcheng" created="Thu, 1 Jun 2017 03:46:13 +0000"  >&lt;p&gt;I finally find out this bug may caused by some inconsistency in TaskSchedulerImpl. Code related is as following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  override def cancelTasks(stageId: Int, interruptThread: &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;): Unit = &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; {
    logInfo(&lt;span class=&quot;code-quote&quot;&gt;&quot;Cancelling stage &quot;&lt;/span&gt; + stageId)
    taskSetsByStageIdAndAttempt.get(stageId).foreach { attempts =&amp;gt;
      attempts.foreach { &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; (_, tsm) =&amp;gt;
        &lt;span class=&quot;code-comment&quot;&gt;// There are two possible cases here:
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// 1. The task set manager has been created and some tasks have been scheduled.
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//    In &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;, send a kill signal to the executors to kill the task and then abort
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//    the stage.
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// 2. The task set manager has been created but no tasks has been scheduled. In &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;,
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//    simply abort the stage.
&lt;/span&gt;        
          tsm.runningTasksSet.foreach{ tid =&amp;gt;
          val execId = taskIdToExecutorId(tid)
          backend.killTask(tid, execId, interruptThread)
         }
        tsm.abort(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stage %s cancelled&quot;&lt;/span&gt;.format(stageId))
        logInfo(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stage %d was cancelled&quot;&lt;/span&gt;.format(stageId))
      }
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When Starting a new task, tid is inserted into tsm.runningTasksSet and taskIdToExecutorId, &lt;br/&gt;
but when ExecutorLost happens, tid on the executor is cleaned up in taskIdToExecutorId &lt;br/&gt;
with tid in tsm.runningTasksSet not cleaned until PendingLossReason got.&lt;br/&gt;
In this case, if another task fails 4 times and causes scheduler canceling stage, &lt;br/&gt;
The above function cancelTasks may be triggered, and the exception is threw out.&lt;/p&gt;</comment>
                            <comment id="16032400" author="liupengcheng" created="Thu, 1 Jun 2017 03:51:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/pull/18171&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18171&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16032437" author="apachespark" created="Thu, 1 Jun 2017 04:44:03 +0000"  >&lt;p&gt;User &apos;liupc&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18171&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18171&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16036710" author="srowen" created="Mon, 5 Jun 2017 09:23:15 +0000"  >&lt;p&gt;Issue resolved by pull request 18171&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18171&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18171&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 24 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fq8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>