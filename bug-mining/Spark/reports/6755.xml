<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:07:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-21287] Cannot use Int.MIN_VALUE as Spark SQL fetchsize</title>
                <link>https://issues.apache.org/jira/browse/SPARK-21287</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;MySQL JDBC driver gives possibility to not store ResultSet in memory.&lt;br/&gt;
We can do this by setting fetchSize to Int.MIN_VALUE.&lt;br/&gt;
Unfortunately this configuration isn&apos;t correct in Spark.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.IllegalArgumentException: requirement failed: Invalid value `-2147483648` &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; parameter `fetchsize`. The minimum value is 0. When the value is 0, the JDBC driver ignores the value and does the estimates.
	at scala.Predef$.require(Predef.scala:224)
	at org.apache.spark.sql.execution.datasources.jdbc.JDBCOptions.&amp;lt;init&amp;gt;(JDBCOptions.scala:105)
	at org.apache.spark.sql.execution.datasources.jdbc.JDBCOptions.&amp;lt;init&amp;gt;(JDBCOptions.scala:34)
	at org.apache.spark.sql.execution.datasources.jdbc.JdbcRelationProvider.createRelation(JdbcRelationProvider.scala:32)
	at org.apache.spark.sql.execution.datasources.DataSource.resolveRelation(DataSource.scala:330)
	at org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:152)
	at org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:125)
	at org.apache.spark.sql.DataFrameReader.jdbc(DataFrameReader.scala:166)
	at org.apache.spark.sql.DataFrameReader.jdbc(DataFrameReader.scala:206)
	at sun.reflect.GeneratedMethodAccessor46.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)
	at py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)
	at py4j.Gateway.invoke(Gateway.java:280)
	at py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)
	at py4j.commands.CallCommand.execute(CallCommand.java:79)
	at py4j.GatewayConnection.run(GatewayConnection.java:214)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-reference-implementation-notes.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-reference-implementation-notes.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13084233">SPARK-21287</key>
            <summary>Cannot use Int.MIN_VALUE as Spark SQL fetchsize</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="wwg28103">Hu Fuwang</assignee>
                                    <reporter username="maver1ck">Maciej Bry&#324;ski</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Jul 2017 12:33:16 +0000</created>
                <updated>Fri, 25 Oct 2019 00:11:41 +0000</updated>
                            <resolved>Thu, 24 Oct 2019 19:36:24 +0000</resolved>
                                    <version>2.1.1</version>
                    <version>2.2.3</version>
                    <version>2.3.4</version>
                    <version>2.4.4</version>
                    <version>3.0.0</version>
                                    <fixVersion>2.4.5</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16072385" author="apachespark" created="Mon, 3 Jul 2017 12:51:03 +0000"  >&lt;p&gt;User &apos;maver1ck&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18515&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18515&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16072388" author="srowen" created="Mon, 3 Jul 2017 12:54:10 +0000"  >&lt;p&gt;Yeah, I&apos;m familiar with this special value.&lt;/p&gt;

&lt;p&gt;Is it not equivalent to setting fetch size to 1? or 0? I don&apos;t think so, but I don&apos;t recall why. Would it work in your situation and therefore be the right way to do this for, likely, most callers?&lt;/p&gt;

&lt;p&gt;I can see an argument for removing this assertion, but, the JDBC API says that negative values aren&apos;t allowed. This is really nonstandard MySQL behavior, and it&apos;d be good to find a better way to recommend to users.&lt;/p&gt;</comment>
                            <comment id="16072404" author="maver1ck" created="Mon, 3 Jul 2017 13:04:47 +0000"  >&lt;p&gt;No.  It&apos;s not the same like setting 0 or 1.&lt;br/&gt;
Every other value makes MySQL JDBC driver to store whole ResultSet in memory.&lt;/p&gt;

&lt;p&gt;Maybe we can just remove this assertion ?&lt;br/&gt;
I think this is not so super popular configuration option.&lt;/p&gt;</comment>
                            <comment id="16072414" author="srowen" created="Mon, 3 Jul 2017 13:10:29 +0000"  >&lt;p&gt;It&apos;s not supposed to do that right &amp;#8211; you&apos;re saying the MySQL driver doesn&apos;t quite use the value as intended?&lt;br/&gt;
Hm, so any MySQL user would have the whole resultset pulled back into memory every time? that seems like a problem, yeah, but surely MySQL has fixed this?&lt;br/&gt;
If not, I could see this being a big enough deal that it has to be allowed as a value even if it is wrong.&lt;/p&gt;</comment>
                            <comment id="16072474" author="maver1ck" created="Mon, 3 Jul 2017 13:59:15 +0000"  >&lt;p&gt;Quote&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;By default, ResultSets are completely retrieved and stored in memory. In most cases this is the most efficient way to operate and, due to the design of the MySQL network protocol, is easier to implement. If you are working with ResultSets that have a large number of rows or large values and cannot allocate heap space in your JVM for the memory required, you can tell the driver to stream the results back one row at a time.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-reference-implementation-notes.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-reference-implementation-notes.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16072506" author="srowen" created="Mon, 3 Jul 2017 14:14:49 +0000"  >&lt;p&gt;I know, but this is what fetch size is supposed to control of course. It need not be all or nothing. I am not sure why they didn&apos;t just let a fetch size of 1 select this behavior. Does any nonpositive value actually get this behavior? That would be nice.&lt;/p&gt;</comment>
                            <comment id="16072700" author="smilegator" created="Mon, 3 Jul 2017 16:46:13 +0000"  >&lt;p&gt;This value is very specific to MySQL. Since we are supporting different dialects, we could introduce a dialect-specific checking logics.&lt;/p&gt;</comment>
                            <comment id="16072752" author="srowen" created="Mon, 3 Jul 2017 17:30:22 +0000"  >&lt;p&gt;Yeah, maybe a method to validate or even set the fetch size that is overridden by the MySQL dialect. That could be used where &lt;tt&gt;stmt.setFetchSize(options.fetchSize)&lt;/tt&gt; is called in JDBCRDD. And then remove the validation in JDBCOptions.&lt;/p&gt;</comment>
                            <comment id="16754316" author="bestcastor" created="Mon, 28 Jan 2019 19:57:11 +0000"  >&lt;p&gt;Do we have any following up for this issue? MySQL is a tier-one database.&#160;&lt;/p&gt;</comment>
                            <comment id="16754318" author="smilegator" created="Mon, 28 Jan 2019 19:59:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bestcastor&quot; class=&quot;user-hover&quot; rel=&quot;bestcastor&quot;&gt;bestcastor&lt;/a&gt; Feel free to submit a PR &lt;/p&gt;</comment>
                            <comment id="16754319" author="bestcastor" created="Mon, 28 Jan 2019 20:01:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smilegator&quot; class=&quot;user-hover&quot; rel=&quot;smilegator&quot;&gt;smilegator&lt;/a&gt; Ok. Anything we should follow up to submit the PR?&#160;&lt;/p&gt;</comment>
                            <comment id="16957939" author="wwg28103" created="Wed, 23 Oct 2019 15:02:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smilegator&quot; class=&quot;user-hover&quot; rel=&quot;smilegator&quot;&gt;smilegator&lt;/a&gt;&#160; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt; Just submitted a PR for this :&#160;&lt;a href=&quot;https://github.com/apache/spark/pull/26230&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/26230&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please help review.&lt;/p&gt;</comment>
                            <comment id="16959171" author="dongjoon" created="Thu, 24 Oct 2019 19:36:24 +0000"  >&lt;p&gt;Issue resolved by pull request 26244&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/26244&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/26244&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 3 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3h0zj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>