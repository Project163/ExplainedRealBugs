<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:28:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-6917] Broken data returned to PySpark dataframe if any large numbers used in Scala land</title>
                <link>https://issues.apache.org/jira/browse/SPARK-6917</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When trying to access data stored in a Parquet file with an INT96 column (read: TimestampType() encoded for Impala), if the INT96 column is included in the fetched data, other, smaller numeric types come back broken.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;In [1]: sql.parquetFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/hornairs/Downloads/part-r-00001.parquet&quot;&lt;/span&gt;).select(&lt;span class=&quot;code-quote&quot;&gt;&apos;int_col&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;long_col&apos;&lt;/span&gt;).first()
Out[1]: Row(int_col=Decimal(&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;), long_col=Decimal(&lt;span class=&quot;code-quote&quot;&gt;&apos;10&apos;&lt;/span&gt;))

In [2]: sql.parquetFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/hornairs/Downloads/part-r-00001.parquet&quot;&lt;/span&gt;).first()
Out[2]: Row(long_col={u&lt;span class=&quot;code-quote&quot;&gt;&apos;__class__&apos;&lt;/span&gt;: u&lt;span class=&quot;code-quote&quot;&gt;&apos;scala.runtime.BoxedUnit&apos;&lt;/span&gt;}, str_col=u&lt;span class=&quot;code-quote&quot;&gt;&apos;Hello!&apos;&lt;/span&gt;, int_col={u&lt;span class=&quot;code-quote&quot;&gt;&apos;__class__&apos;&lt;/span&gt;: u&lt;span class=&quot;code-quote&quot;&gt;&apos;scala.runtime.BoxedUnit&apos;&lt;/span&gt;}, date_col=datetime.datetime(1, 12, 31, 19, 0, tzinfo=&amp;lt;DstTzInfo &lt;span class=&quot;code-quote&quot;&gt;&apos;America/Toronto&apos;&lt;/span&gt; EDT-1 day, 19:00:00 DST&amp;gt;))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note the {&lt;tt&gt;u&apos;_&lt;em&gt;class&lt;/em&gt;_&apos;: u&apos;scala.runtime.BoxedUnit&apos;&lt;/tt&gt;} values being returned for the &lt;tt&gt;int_col&lt;/tt&gt; and &lt;tt&gt;long_col&lt;/tt&gt; columns in the second loop above. This only happens if I select the &lt;tt&gt;date_col&lt;/tt&gt; which is stored as &lt;tt&gt;INT96&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;I don&apos;t know much about Scala boxing, but I assume that somehow by including numeric columns that are bigger than a machine word I trigger some different, slower execution path somewhere that boxes stuff and causes this problem.&lt;/p&gt;

&lt;p&gt;If anyone could give me any pointers on where to get started fixing this I&apos;d be happy to dive in!&lt;/p&gt;</description>
                <environment>&lt;p&gt;Spark 1.3, Python 2.7.6, Scala 2.10&lt;/p&gt;</environment>
        <key id="12821008">SPARK-6917</key>
            <summary>Broken data returned to PySpark dataframe if any large numbers used in Scala land</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davies">Davies Liu</assignee>
                                    <reporter username="airhorns">Harry Brundage</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Apr 2015 23:25:56 +0000</created>
                <updated>Tue, 2 Jun 2015 06:12:44 +0000</updated>
                            <resolved>Tue, 2 Jun 2015 06:12:44 +0000</resolved>
                                    <version>1.3.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>PySpark</component>
                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14495140" author="airhorns" created="Tue, 14 Apr 2015 23:26:49 +0000"  >&lt;p&gt;Attached is the parquet file I used. &lt;/p&gt;</comment>
                            <comment id="14503915" author="airhorns" created="Mon, 20 Apr 2015 23:17:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davies&quot; class=&quot;user-hover&quot; rel=&quot;davies&quot;&gt;davies&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joshrosen&quot; class=&quot;user-hover&quot; rel=&quot;joshrosen&quot;&gt;joshrosen&lt;/a&gt; any idea why this might be happening? I can dig in if you give me some pointers but I don&apos;t really know where to start! &lt;/p&gt;</comment>
                            <comment id="14527186" author="airhorns" created="Mon, 4 May 2015 20:10:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pwendell&quot; class=&quot;user-hover&quot; rel=&quot;pwendell&quot;&gt;pwendell&lt;/a&gt; just checking, would you consider this a blocker for 1.4? It does mean that dataframes are pretty broken for anyone using dates, decimals, or big ints from Python. &lt;/p&gt;</comment>
                            <comment id="14546160" author="davies" created="Fri, 15 May 2015 20:57:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;yhuai&lt;/a&gt; It&apos;s a bug in SQL or Parquet library:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; sqlContext.parquetFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/davies/Downloads/part-r-00001.parquet&quot;&lt;/span&gt;)
res1: org.apache.spark.sql.DataFrame = [long_col: decimal(18,0), str_col: string, int_col: decimal(18,0), date_col: timestamp]

scala&amp;gt; sqlContext.parquetFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/davies/Downloads/part-r-00001.parquet&quot;&lt;/span&gt;).first()
res2: org.apache.spark.sql.Row = [(),Hello!,(),0001-12-31 16:00:00.0]

scala&amp;gt; sqlContext.parquetFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/davies/Downloads/part-r-00001.parquet&quot;&lt;/span&gt;).select(&lt;span class=&quot;code-quote&quot;&gt;&quot;long_col&quot;&lt;/span&gt;).first()
res3: org.apache.spark.sql.Row = [10]

scala&amp;gt; sqlContext.parquetFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/davies/Downloads/part-r-00001.parquet&quot;&lt;/span&gt;).select(&lt;span class=&quot;code-quote&quot;&gt;&quot;long_col&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;date_col&quot;&lt;/span&gt;).first()
res4: org.apache.spark.sql.Row = [(),0001-12-31 16:00:00.0]

scala&amp;gt; sqlContext.parquetFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/davies/Downloads/part-r-00001.parquet&quot;&lt;/span&gt;).select(&lt;span class=&quot;code-quote&quot;&gt;&quot;date_col&quot;&lt;/span&gt;).first()
res5: org.apache.spark.sql.Row = [0001-12-31 16:00:00.0]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14546201" author="yhuai" created="Fri, 15 May 2015 21:29:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adrian-wang&quot; class=&quot;user-hover&quot; rel=&quot;adrian-wang&quot;&gt;adrian-wang&lt;/a&gt; Can you take a look?&lt;/p&gt;</comment>
                            <comment id="14567943" author="apachespark" created="Mon, 1 Jun 2015 20:31:06 +0000"  >&lt;p&gt;User &apos;davies&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/6558&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/6558&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12826659">SPARK-7314</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12725421" name="part-r-00001.parquet" size="1135" author="airhorns" created="Tue, 14 Apr 2015 23:26:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 25 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2d9an:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>