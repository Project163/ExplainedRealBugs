<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:56:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-22062] BlockManager does not account for memory consumed by remote fetches</title>
                <link>https://issues.apache.org/jira/browse/SPARK-22062</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;We use Spark exclusively with &lt;tt&gt;StorageLevel.DiskOnly&lt;/tt&gt; as our workloads are very sensitive to memory usage. Recently, we&apos;ve spotted that the jobs sometimes OOM leaving lots of byte[] arrays on the heap. Upon further investigation, we&apos;ve found that the arrays come from &lt;tt&gt;BlockManager.getRemoteBytes&lt;/tt&gt;, which &lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/storage/BlockManager.scala#L638&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;calls&lt;/a&gt; &lt;tt&gt;BlockTransferService.fetchBlockSync&lt;/tt&gt;, which in its turn would &lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/network/BlockTransferService.scala#L99&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;allocate&lt;/a&gt; an on-heap &lt;tt&gt;ByteBuffer&lt;/tt&gt; of the same size as the block (e.g. full partition), if the block was successfully retrieved over the network.&lt;/p&gt;

&lt;p&gt;This memory is not accounted towards Spark storage/execution memory and could potentially lead to OOM if &lt;tt&gt;BlockManager&lt;/tt&gt; fetches too many partitions in parallel. I wonder if this is intentional behaviour, or in fact a bug?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13103266">SPARK-22062</key>
            <summary>BlockManager does not account for memory consumed by remote fetches</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jerryshao">Saisai Shao</assignee>
                                    <reporter username="lebedev">Sergei Lebedev</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Sep 2017 15:21:16 +0000</created>
                <updated>Sun, 17 May 2020 18:21:29 +0000</updated>
                            <resolved>Tue, 17 Oct 2017 14:55:19 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>Block Manager</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="16201305" author="jerryshao" created="Thu, 12 Oct 2017 01:20:48 +0000"  >&lt;p&gt;Yes, there potentially has OOM problem, but I think this kind of temporarily allocated &lt;tt&gt;ByteBuffer&lt;/tt&gt; is difficult to be defined as whether it should be accounted into storage memory or execution memory. Furthermore, how to deal with remote fetching if memory is not enough, shall we fail the task or can we stream the remote fetches?&lt;/p&gt;

&lt;p&gt;What I can think of is to leverage the current implementation of shuffle to spill the large blocks to local disk during fetching, and tasks can read the data from local temporary files, this could avoid OOM.&lt;/p&gt;</comment>
                            <comment id="16201334" author="apachespark" created="Thu, 12 Oct 2017 02:09:03 +0000"  >&lt;p&gt;User &apos;jerryshao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19476&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16207743" author="cloud_fan" created="Tue, 17 Oct 2017 14:55:19 +0000"  >&lt;p&gt;Issue resolved by pull request 19476&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19476&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12780659">SPARK-6235</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3k8nz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>