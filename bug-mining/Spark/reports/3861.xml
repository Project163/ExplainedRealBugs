<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:46:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-15541] SparkContext.stop throws error</title>
                <link>https://issues.apache.org/jira/browse/SPARK-15541</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When running unit-tests or examples from command line or Intellij, SparkContext throws errors.&lt;br/&gt;
For example:&lt;br/&gt;
./bin/run-example ml.JavaNaiveBayesExample&lt;br/&gt;
Exception in thread &quot;main&quot; 16/05/25 15:17:55 INFO OutputCommitCoordinator$OutputCommitCoordinatorEndpoint: OutputCommitCoordinator stopped!&lt;br/&gt;
java.lang.NoSuchMethodError: java.util.concurrent.ConcurrentHashMap.keySet()Ljava/util/concurrent/ConcurrentHashMap$KeySetView;&lt;br/&gt;
	at org.apache.spark.rpc.netty.Dispatcher.stop(Dispatcher.scala:176)&lt;br/&gt;
	at org.apache.spark.rpc.netty.NettyRpcEnv.cleanup(NettyRpcEnv.scala:291)&lt;br/&gt;
	at org.apache.spark.rpc.netty.NettyRpcEnv.shutdown(NettyRpcEnv.scala:269)&lt;br/&gt;
	at org.apache.spark.SparkEnv.stop(SparkEnv.scala:91)&lt;br/&gt;
	at org.apache.spark.SparkContext$$anonfun$stop$11.apply$mcV$sp(SparkContext.scala:1796)&lt;br/&gt;
	at org.apache.spark.util.Utils$.tryLogNonFatalError(Utils.scala:1219)&lt;br/&gt;
	at org.apache.spark.SparkContext.stop(SparkContext.scala:1795)&lt;br/&gt;
	at org.apache.spark.sql.SparkSession.stop(SparkSession.scala:577)&lt;br/&gt;
	at org.apache.spark.examples.ml.JavaNaiveBayesExample.main(JavaNaiveBayesExample.java:61)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:606)&lt;br/&gt;
	at org.apache.spark.deploy.SparkSubmit$.org$apache$spark$deploy$SparkSubmit$$runMain(SparkSubmit.scala:724)&lt;br/&gt;
	at org.apache.spark.deploy.SparkSubmit$.doRunMain$1(SparkSubmit.scala:180)&lt;br/&gt;
	at org.apache.spark.deploy.SparkSubmit$.submit(SparkSubmit.scala:205)&lt;br/&gt;
	at org.apache.spark.deploy.SparkSubmit$.main(SparkSubmit.scala:119)&lt;br/&gt;
	at org.apache.spark.deploy.SparkSubmit.main(SparkSubmit.scala)&lt;br/&gt;
16/05/25 15:17:55 INFO ShutdownHookManager: Shutdown hook called&lt;/p&gt;</description>
                <environment></environment>
        <key id="12972895">SPARK-15541</key>
            <summary>SparkContext.stop throws error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10003">Resolved</resolution>
                                        <assignee username="maver1ck">Maciej Bry&#324;ski</assignee>
                                    <reporter username="wm624">Miao Wang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 May 2016 22:19:00 +0000</created>
                <updated>Tue, 2 Aug 2016 23:40:11 +0000</updated>
                            <resolved>Tue, 2 Aug 2016 15:47:42 +0000</resolved>
                                                    <fixVersion>1.6.3</fixVersion>
                    <fixVersion>2.0.1</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15301352" author="jerryshao" created="Thu, 26 May 2016 02:53:09 +0000"  >&lt;p&gt;This method which returns &lt;tt&gt;KeySetView&lt;/tt&gt; only exists in jdk 1.8, did you use another version of jdk?&lt;/p&gt;

&lt;p&gt;Also if this is a problem, then all the examples should be failed, since every SparkContext will have netty rpc layer, did you run into this problem occasionally or in every example?&lt;/p&gt;</comment>
                            <comment id="15301457" author="srowen" created="Thu, 26 May 2016 03:21:16 +0000"  >&lt;p&gt;Yes, this is a subtle Java version issue. It means this was compiled with Java 8, but run on Java 7, which is almost always entirely fine if the source code itself is targeted at Java 7 and works with Java 7. But in this case the compiled version differs when compiled with Java 8 in a way that&apos;s not backwards compatible. I think you have to compile with Java 7, but, best to fix this by steering clear of it, perhaps following &lt;a href=&quot;http://stackoverflow.com/questions/25705259/undefined-reference-concurrenthashmap-keyset-when-building-in-java-8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/25705259/undefined-reference-concurrenthashmap-keyset-when-building-in-java-8&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15301607" author="wm624" created="Thu, 26 May 2016 06:21:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt;Thanks for your explanation! My computer just upgraded to Java 8, but I believe JAVA_HOME is pointed to Java 7. I will close this issue. &lt;/p&gt;</comment>
                            <comment id="15302030" author="srowen" created="Thu, 26 May 2016 12:55:10 +0000"  >&lt;p&gt;Although I&apos;m closing as &quot;Not A Problem&quot;, it is a subtle and real problem for cross-building to Java 7 from Java 8. The actual Spark artifacts are built with Java 7 and soon Java 8 will be required anyway, so this will go away soon and is sort of a subset of &quot;require Java 8&quot; as the fix. It&apos;s possible to rewrite code to manually construct key sets to work around this, but I am not sure it&apos;s worth it.&lt;/p&gt;</comment>
                            <comment id="15395815" author="maver1ck" created="Wed, 27 Jul 2016 15:07:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt;&lt;br/&gt;
I have patch that resolve this issue. &lt;br/&gt;
Do you think it&apos;s good idea to make PR ?&lt;/p&gt;</comment>
                            <comment id="15396651" author="srowen" created="Wed, 27 Jul 2016 23:29:31 +0000"  >&lt;p&gt;What&apos;s your fix &amp;#8211; avoiding directly calling this method?&lt;/p&gt;</comment>
                            <comment id="15397179" author="maver1ck" created="Thu, 28 Jul 2016 07:34:36 +0000"  >&lt;p&gt;Casting ConcurrentHashMap to ConcurrentMap. &lt;br/&gt;
(We can&apos;t cast to java.util.Map, because we&apos;re using putIfAbsent method.)&lt;/p&gt;

&lt;p&gt;Fix is only for 1.6 branch.&lt;/p&gt;</comment>
                            <comment id="15397208" author="apachespark" created="Thu, 28 Jul 2016 07:52:05 +0000"  >&lt;p&gt;User &apos;maver1ck&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/14390&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14390&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15403794" author="apachespark" created="Tue, 2 Aug 2016 11:30:05 +0000"  >&lt;p&gt;User &apos;maver1ck&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/14459&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14459&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15404229" author="srowen" created="Tue, 2 Aug 2016 15:47:42 +0000"  >&lt;p&gt;Resolved by &lt;a href=&quot;https://github.com/apache/spark/pull/14459&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14459&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2yiev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>