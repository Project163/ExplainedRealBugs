<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:19:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-3736] Workers should reconnect to Master if disconnected</title>
                <link>https://issues.apache.org/jira/browse/SPARK-3736</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;In standalone mode, when a worker gets disconnected from the master for some reason it never attempts to reconnect.  In this situation you have to bounce the worker before it will reconnect to the master.&lt;/p&gt;

&lt;p&gt;The preferred alternative is to follow what Hadoop does &amp;#8211; when there&apos;s a disconnect, attempt to reconnect at a particular interval until successful (I think it repeats indefinitely every 10sec).&lt;/p&gt;

&lt;p&gt;This has been observed by:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pkolaczk&quot; class=&quot;user-hover&quot; rel=&quot;pkolaczk&quot;&gt;pkolaczk&lt;/a&gt; in &lt;a href=&quot;http://apache-spark-user-list.1001560.n3.nabble.com/Workers-disconnected-from-master-sometimes-and-never-reconnect-back-td6240.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-spark-user-list.1001560.n3.nabble.com/Workers-disconnected-from-master-sometimes-and-never-reconnect-back-td6240.html&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romi-totango&quot; class=&quot;user-hover&quot; rel=&quot;romi-totango&quot;&gt;romi-totango&lt;/a&gt; in &lt;a href=&quot;http://apache-spark-user-list.1001560.n3.nabble.com/Re-Workers-disconnected-from-master-sometimes-and-never-reconnect-back-td15335.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-spark-user-list.1001560.n3.nabble.com/Re-Workers-disconnected-from-master-sometimes-and-never-reconnect-back-td15335.html&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aash&quot; class=&quot;user-hover&quot; rel=&quot;aash&quot;&gt;aash&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12744828">SPARK-3736</key>
            <summary>Workers should reconnect to Master if disconnected</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mccheah">Matthew Cheah</assignee>
                                    <reporter username="aash">Andrew Ash</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Sep 2014 00:16:26 +0000</created>
                <updated>Fri, 14 Nov 2014 10:44:08 +0000</updated>
                            <resolved>Mon, 20 Oct 2014 18:35:43 +0000</resolved>
                                    <version>1.0.2</version>
                    <version>1.1.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14152594" author="aash" created="Tue, 30 Sep 2014 00:23:56 +0000"  >&lt;p&gt;I can&apos;t tell for sure but this is possibly related to &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-704&quot; title=&quot;ConnectionManager sometimes cannot detect loss of sending connections&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-704&quot;&gt;&lt;del&gt;SPARK-704&lt;/del&gt;&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-1771&quot; title=&quot;CoarseGrainedSchedulerBackend is not resilient to Akka restarts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-1771&quot;&gt;&lt;del&gt;SPARK-1771&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14164578" author="pwendell" created="Thu, 9 Oct 2014 01:58:12 +0000"  >&lt;p&gt;I spoke a bit offline with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ilikerps&quot; class=&quot;user-hover&quot; rel=&quot;ilikerps&quot;&gt;ilikerps&lt;/a&gt; about this. I think the solution here is pretty simple - if the worker disconnects it should just try to re-initialize the connection to all drivers. It might need some slight refactoring so that on re-connect it will do this for an infinite number of attempts and checking to make sure there aren&apos;t races.&lt;/p&gt;

&lt;p&gt;A good first step would be to get a grasp of how the general fault tolerance code works here around connections (there is a bit of complexity here around having failover between masters). Checkout the documentation on the Spark website about standalone fault tolerance. Right now the worker will simply hang out and do nothing when it loses the connection to the master, because it&apos;s expecting another master to re-connect to it. But this won&apos;t occur during the case where there is master failure.&lt;/p&gt;</comment>
                            <comment id="14165513" author="mcheah" created="Thu, 9 Oct 2014 18:42:02 +0000"  >&lt;p&gt;Are the two linked cases above different though?&lt;/p&gt;

&lt;p&gt;(1) If the worker itself gets locked up, the master sends a heartbeat but the worker doesn&apos;t respond, and the master drops the connection with the worker. However the master doesn&apos;t send a message to the worker indicating this disconnection, so the worker can&apos;t know to reconnect. To repro this I set a breakpoint in the Worker&apos;s heartbeat reception code and let the worker time out, and after the worker times out it never receives a DissassociatedEvent, nor is Worker.masterDisconnected() ever called.&lt;/p&gt;

&lt;p&gt;(2) If the master crashes, the Worker receives a DissassociatedEvent and sits idly. We can fix this with making the Worker actively attempt to reconnect.&lt;/p&gt;

&lt;p&gt;Clearly we can address the second case with the Worker actively trying to reconnect itself. But how can we address the first case?&lt;/p&gt;</comment>
                            <comment id="14171331" author="mcheah" created="Tue, 14 Oct 2014 18:29:38 +0000"  >&lt;p&gt;I was curious if anyone had any feedback on my above comment?&lt;/p&gt;</comment>
                            <comment id="14171358" author="codingcat" created="Tue, 14 Oct 2014 18:49:15 +0000"  >&lt;p&gt;if the worker itself timeout, the Master will remove the worker from idToWorker, &lt;/p&gt;

&lt;p&gt;when the worker is resumed later and sends heartbeat to Master again, Master detect this by attempting to find worker in idToWorker (search &quot;logWarning(&quot;Got heartbeat from unregistered worker &quot; + workerId)&quot; in Master.scala)&lt;/p&gt;

&lt;p&gt;you can simply replace logWarning with the logic of sending a message to worker to ask it to re-register&lt;/p&gt;</comment>
                            <comment id="14171360" author="codingcat" created="Tue, 14 Oct 2014 18:52:18 +0000"  >&lt;p&gt;BTW, master will not send heartbeat to Worker proactively &lt;/p&gt;</comment>
                            <comment id="14174049" author="apachespark" created="Thu, 16 Oct 2014 18:20:37 +0000"  >&lt;p&gt;User &apos;mccheah&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2828&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2828&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14174753" author="aash" created="Fri, 17 Oct 2014 06:00:57 +0000"  >&lt;p&gt;The configuration for Hadoop&apos;s retry policy was added in &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-3504&quot; title=&quot;Configurable retry in DFSClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-3504&quot;&gt;&lt;del&gt;HDFS-3504&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;+   * Return the default retry policy used in RPC.&lt;br/&gt;
+   * &lt;br/&gt;
+   * If dfs.client.retry.policy.enabled == false, use TRY_ONCE_THEN_FAIL.&lt;br/&gt;
+   * &lt;br/&gt;
+   * Otherwise, first unwrap ServiceException if possible, and then &lt;br/&gt;
+   * (1) use multipleLinearRandomRetry for&lt;br/&gt;
+   *     - SafeModeException, or&lt;br/&gt;
+   *     - IOException other than RemoteException, or&lt;br/&gt;
+   *     - ServiceException; and&lt;br/&gt;
+   * (2) use TRY_ONCE_THEN_FAIL for&lt;br/&gt;
+   *     - non-SafeMode RemoteException, or&lt;br/&gt;
+   *     - non-IOException.&lt;br/&gt;
+   *     &lt;br/&gt;
+   * Note that dfs.client.retry.max &amp;lt; 0 is not allowed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;From &lt;a href=&quot;https://github.com/apache/hadoop/commit/45fafc2b8fc1aab0a082600b0d50ad693491ea70#diff-36b19e9d8816002ed9dff8580055d3fbR44&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/commit/45fafc2b8fc1aab0a082600b0d50ad693491ea70#diff-36b19e9d8816002ed9dff8580055d3fbR44&lt;/a&gt; it looks like the default policy is to retry every 10 seconds for 6 attempts, and then every 60 seconds for 10 attempts.&lt;/p&gt;</comment>
                            <comment id="14177269" author="joshrosen" created="Mon, 20 Oct 2014 18:35:43 +0000"  >&lt;p&gt;Issue resolved by pull request 2828&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2828&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2828&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12704460">SPARK-1231</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20m3r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327369">1.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>