<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:43:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-47307] Spark 3.3 produces invalid base64</title>
                <link>https://issues.apache.org/jira/browse/SPARK-47307</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-37820&quot; title=&quot;Replace ApacheCommonBase64 with JavaBase64 for string fucntions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-37820&quot;&gt;&lt;del&gt;SPARK-37820&lt;/del&gt;&lt;/a&gt; was introduced in Spark 3.3 and breaks behavior of &lt;tt&gt;base64&lt;/tt&gt; (which is fine but shouldn&apos;t happen between minor version).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Spark 3.2&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;gt;&amp;gt;&amp;gt; spark.sql(f&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;&quot;SELECT base64(&lt;span class=&quot;code-quote&quot;&gt;&apos;{&apos;&lt;/span&gt;a&lt;span class=&quot;code-quote&quot;&gt;&apos; * 58}&apos;&lt;/span&gt;) AS base64&quot;&lt;/span&gt;&quot;&quot;).collect()[0][0]
&lt;span class=&quot;code-quote&quot;&gt;&apos;YWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYQ==&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note the different output in Spark 3.3 (the addition of &lt;tt&gt;\r\n&lt;/tt&gt; newlines).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Spark 3.3&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;gt;&amp;gt;&amp;gt; spark.sql(f&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;&quot;SELECT base64(&lt;span class=&quot;code-quote&quot;&gt;&apos;{&apos;&lt;/span&gt;a&lt;span class=&quot;code-quote&quot;&gt;&apos; * 58}&apos;&lt;/span&gt;) AS base64&quot;&lt;/span&gt;&quot;&quot;).collect()[0][0]
&lt;span class=&quot;code-quote&quot;&gt;&apos;YWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFh\r\nYQ==&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The former decodes fine with the &lt;tt&gt;base64&lt;/tt&gt; on my machine but the latter does not:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ pbpaste | base64 --decode
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa%

$ pbpaste | base64 --decode
base64: stdin: (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;): error decoding base64 input stream
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13571037">SPARK-47307</key>
            <summary>Spark 3.3 produces invalid base64</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="wforget">Zhen Wang</assignee>
                                    <reporter username="rshkv">Willi Raschkowski</reporter>
                        <labels>
                            <label>correctness</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 6 Mar 2024 17:23:16 +0000</created>
                <updated>Mon, 2 Sep 2024 08:03:13 +0000</updated>
                            <resolved>Sat, 13 Jul 2024 13:33:07 +0000</resolved>
                                    <version>3.3.0</version>
                    <version>3.5.2</version>
                    <version>3.4.4</version>
                    <version>4.0.0</version>
                                    <fixVersion>3.5.2</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17824115" author="raschkowski" created="Wed, 6 Mar 2024 18:11:52 +0000"  >&lt;p&gt;The behavior change is as follows:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Spark 3.2, &lt;a href=&quot;https://github.com/apache/spark/blob/e428fe902bb1f12cea973de7fe4b885ae69fd6ca/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/expressions/stringExpressions.scala#L2206&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, was using Apache&apos;s encoder like this: &lt;tt&gt;CommonsBase64.encodeBase64(bytes.asInstanceOf[Array&lt;span class=&quot;error&quot;&gt;&amp;#91;Byte&amp;#93;&lt;/span&gt;])&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;That &lt;tt&gt;encodeBase64&lt;/tt&gt; call does &lt;em&gt;not&lt;/em&gt; chunk &lt;a href=&quot;https://commons.apache.org/proper/commons-codec/apidocs/org/apache/commons/codec/binary/Base64.html#encodeBase64(byte%5B%5D,boolean,boolean,int)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;its output&lt;/a&gt;.&lt;/li&gt;
	&lt;li&gt;Falsely assuming that Apache&apos;s encoder would follow the RC2045 / MIME spec, Spark 3.3 started using &lt;a href=&quot;https://github.com/apache/spark/blob/f74867bddfbcdd4d08076db36851e88b15e66556/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/expressions/stringExpressions.scala#L2431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Java&apos;s MIME encoder&lt;/a&gt;. The MIME encoder &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc2045#section-6.8:~:text=76%0A%20%20%20%20%20%20%20%20%20%20characters%20long.&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;follows the RFC2045 spec and &lt;em&gt;does chunk&lt;/em&gt;&lt;/a&gt;.&lt;/li&gt;
	&lt;li&gt;That chunking is what introduced those &lt;tt&gt;\r\n&lt;/tt&gt; separators.&lt;br/&gt;
&#160;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 35 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ntow:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>