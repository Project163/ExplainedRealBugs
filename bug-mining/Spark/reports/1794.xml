<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:27:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-5456] Decimal Type comparison issue</title>
                <link>https://issues.apache.org/jira/browse/SPARK-5456</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Not quite able to figure this out but here is a junit test to reproduce this, in JavaAPISuite.java&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;DecimalBug.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void decimalQueryTest() {
    List&amp;lt;Row&amp;gt; decimalTable = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;Row&amp;gt;();
    decimalTable.add(RowFactory.create(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;)));
    decimalTable.add(RowFactory.create(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;code-quote&quot;&gt;&quot;3&quot;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;code-quote&quot;&gt;&quot;4&quot;&lt;/span&gt;)));
    JavaRDD&amp;lt;Row&amp;gt; rows = sc.parallelize(decimalTable);
    List&amp;lt;StructField&amp;gt; fields = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;StructField&amp;gt;(7);
    fields.add(DataTypes.createStructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, DataTypes.createDecimalType(), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;));
    fields.add(DataTypes.createStructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;, DataTypes.createDecimalType(), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;));
    sqlContext.applySchema(rows.rdd(), DataTypes.createStructType(fields)).registerTempTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;);
    Assert.assertEquals(sqlContext.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select * from foo where a &amp;gt; 0&quot;&lt;/span&gt;).collectAsList(), decimalTable);

  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Fails with&lt;br/&gt;
java.lang.ClassCastException: java.math.BigDecimal cannot be cast to org.apache.spark.sql.types.Decimal&lt;/p&gt;</description>
                <environment></environment>
        <key id="12770699">SPARK-5456</key>
            <summary>Decimal Type comparison issue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="adrian-wang">Adrian Wang</assignee>
                                    <reporter username="kul">Kuldeep</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Jan 2015 15:55:52 +0000</created>
                <updated>Thu, 18 Aug 2016 12:27:30 +0000</updated>
                            <resolved>Wed, 6 May 2015 17:05:58 +0000</resolved>
                                    <version>1.2.0</version>
                    <version>1.3.0</version>
                                    <fixVersion>1.3.2</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>11</watches>
                                                                                                                                                            <comments>
                            <comment id="14383392" author="karthikg01" created="Fri, 27 Mar 2015 06:15:07 +0000"  >&lt;p&gt;This is a blocker when using Spark with Databases which have Decimal / Big Decimal columns. Is there a workaround?&lt;/p&gt;</comment>
                            <comment id="14386628" author="karthikg01" created="Mon, 30 Mar 2015 12:31:09 +0000"  >&lt;p&gt;One workaround we followed is to convert all Decimal Datatype columns to integer (truncated).&lt;br/&gt;
But, this is not possible when the application needs to connect to third-party databases were the datatype is obviously not under our control. &lt;/p&gt;

&lt;p&gt;So, this is a serious bug, IMHO, which prohibits using Spark in cases, unless there is a workaround?&lt;/p&gt;</comment>
                            <comment id="14387904" author="kul" created="Tue, 31 Mar 2015 03:29:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=karthikg01&quot; class=&quot;user-hover&quot; rel=&quot;karthikg01&quot;&gt;karthikg01&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;1) Switch to hive context, I am not trying to deride the plain sql context, but the hive context is just better tested and has a well defined syntax borrowed from hive.&lt;br/&gt;
2) Even in hive context i have faced problems with bigdecimals, so like your workaround i also convert bigdecimals to a double (not int). And for all practical purposes it is more than enough. I have not seem many datasources with those types. rdbms maps `NUMERIC` type to bigdecimal in jdbc but you can always workaround this by have a simple map transformation before you register it to sql context.&lt;/p&gt;

&lt;p&gt;2 cents.&lt;/p&gt;</comment>
                            <comment id="14516195" author="zhangyi" created="Tue, 28 Apr 2015 02:12:51 +0000"  >&lt;p&gt;I got same issue. When I access Postgresql based on Spark SQL, and the code is as below:&lt;br/&gt;
dataFrame.registerTempTable(&quot;Employees&quot;)&lt;br/&gt;
val emps = sqlContext.sql(&quot;select name, sum(salary) from Employees group by name&quot;)&lt;br/&gt;
monitor {&lt;br/&gt;
emps.take(10)&lt;br/&gt;
.map(row =&amp;gt; (row.getString(0), row.getDecimal(1)))&lt;br/&gt;
.foreach(println)&lt;br/&gt;
}&lt;br/&gt;
The type of salary column in data table of Postgresql is numeric(10, 2).&lt;/p&gt;

&lt;p&gt;Running it, then it throws the following exception:&lt;br/&gt;
Exception in thread &quot;main&quot; org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 0.0 failed 1 times, most recent failure: Lost task 0.0 in stage 0.0 (TID 0, localhost): java.lang.ClassCastException: java.math.BigDecimal cannot be cast to org.apache.spark.sql.types.Decimal&lt;/p&gt;</comment>
                            <comment id="14520917" author="adrian-wang" created="Thu, 30 Apr 2015 05:59:29 +0000"  >&lt;p&gt;Hi, I just tried the code in the description of this issue with latest master, and got not errors.&lt;br/&gt;
Can you guys confirm that?&lt;/p&gt;</comment>
                            <comment id="14521100" author="apachespark" created="Thu, 30 Apr 2015 08:08:09 +0000"  >&lt;p&gt;User &apos;adrian-wang&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/5803&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/5803&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14521109" author="adrian-wang" created="Thu, 30 Apr 2015 08:16:07 +0000"  >&lt;p&gt;I created a pull request for &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhangyi&quot; class=&quot;user-hover&quot; rel=&quot;zhangyi&quot;&gt;zhangyi&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14533039" author="yhuai" created="Thu, 7 May 2015 17:22:00 +0000"  >&lt;p&gt;Seems it is not in 1.2 branch. So I am removing the fix version &quot;1.2.3&quot;. &lt;/p&gt;</comment>
                            <comment id="14711690" author="blbradley" created="Tue, 25 Aug 2015 18:02:40 +0000"  >&lt;p&gt;I&apos;m still experiencing this in 1.4.0 and 1.4.1. I believe the fix for it should be in 1.4.1.&lt;/p&gt;</comment>
                            <comment id="15426351" author="abdealijk" created="Thu, 18 Aug 2016 12:27:30 +0000"  >&lt;p&gt;For the record, I get this error in 1.4.1 too.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                                                <inwardlinks description="Is contained by">
                                        <issuelink>
            <issuekey id="12819472">SPARK-6784</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12824004">SPARK-7144</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24whz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329359">1.4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>