<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:35:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-40820] Creating StructType from Json</title>
                <link>https://issues.apache.org/jira/browse/SPARK-40820</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When create a StructType from a Python dictionary you use &lt;a href=&quot;https://github.com/apache/spark/blob/master/python/pyspark/sql/types.py#L792&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;StructType.fromJson&lt;/a&gt; or in scala &lt;a href=&quot;https://github.com/apache/spark/blob/master/sql/api/src/main/scala/org/apache/spark/sql/types/DataType.scala#L158C7-L158C15&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;DataType.fromJson&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To create a schema can be created as follows from the code below, but it requires to put inside the json: Nullable and Metadata, this is inconsistent because within the DataType class this by default.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
schema = {
     &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;type&lt;/span&gt;&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; 
}

StructField.fromJson(schema)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Python Error:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; pyspark.sql.types &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; StructField

schema = {
     &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;c1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;type&lt;/span&gt;&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt; 
}

StructField.fromJson(schema)

&amp;gt;&amp;gt;
Traceback (most recent call last):
File &lt;span class=&quot;code-quote&quot;&gt;&quot;code.py&quot;&lt;/span&gt;, line 90, &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; runcode
exec(code, &lt;span class=&quot;code-keyword&quot;&gt;self&lt;/span&gt;.&lt;span class=&quot;code-object&quot;&gt;locals&lt;/span&gt;)
File &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;&lt;span class=&quot;code-object&quot;&gt;input&lt;/span&gt;&amp;gt;&quot;&lt;/span&gt;, line 1, &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; &amp;lt;module&amp;gt;
File &lt;span class=&quot;code-quote&quot;&gt;&quot;pyspark/sql/types.py&quot;&lt;/span&gt;, line 583, &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; fromJson
json[&lt;span class=&quot;code-quote&quot;&gt;&quot;nullable&quot;&lt;/span&gt;],
&lt;span class=&quot;code-object&quot;&gt;KeyError&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;nullable&apos;&lt;/span&gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Scala Error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; schema = &quot;&quot;&quot;
        |{
        |    &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;type&lt;/span&gt;&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;struct&quot;&lt;/span&gt;,
        |    &lt;span class=&quot;code-quote&quot;&gt;&quot;fields&quot;&lt;/span&gt;: [
        |        {
        |            &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;c1&quot;&lt;/span&gt;,
        |            &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;type&lt;/span&gt;&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt;,
        |            &lt;span class=&quot;code-quote&quot;&gt;&quot;nullable&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
        |        }
        |    ]
        |}
        |&quot;&quot;&quot;.stripMargin

DataType.fromJson(schema)

&amp;gt;&amp;gt;
Failed to convert the JSON string &apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;c1&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;type&lt;/span&gt;&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt;}&apos; to a field.
java.lang.IllegalArgumentException: Failed to convert the JSON string &apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;c1&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;type&lt;/span&gt;&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt;}&apos; to a field.
at org.apache.spark.sql.types.DataType$.parseStructField(DataType.scala:268)
at org.apache.spark.sql.types.DataType$.$anonfun$parseDataType$1(DataType.scala:225)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13486634">SPARK-40820</key>
            <summary>Creating StructType from Json</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="awainerc">Anthony Wainer Cachay Guivin</assignee>
                                    <reporter username="awainerc">Anthony Wainer Cachay Guivin</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 17 Oct 2022 13:52:28 +0000</created>
                <updated>Fri, 27 Oct 2023 07:34:27 +0000</updated>
                            <resolved>Fri, 27 Oct 2023 07:34:27 +0000</resolved>
                                    <version>3.5.0</version>
                                    <fixVersion>4.0.0</fixVersion>
                                    <component>PySpark</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17618974" author="apachespark" created="Mon, 17 Oct 2022 15:50:39 +0000"  >&lt;p&gt;User &apos;anthonywainer&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/38285&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/38285&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17618976" author="apachespark" created="Mon, 17 Oct 2022 15:51:34 +0000"  >&lt;p&gt;User &apos;anthonywainer&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/38285&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/38285&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17620099" author="JIRAUSER297020" created="Wed, 19 Oct 2022 08:34:53 +0000"  >&lt;p&gt;Here an example, many dataframes are being created from a schema, this schema is created from a Json.&lt;br/&gt;
The input parameters to create a schema is StructType.fromJson(json), this internally uses StructField.fromJson().&lt;/p&gt;

&lt;p&gt;The issue is when the StructField parses the Json, which forces to define the nullable and metadata attributes inside.&lt;/p&gt;

&lt;p&gt;!&lt;span class=&quot;error&quot;&gt;&amp;#91;image&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://user-images.githubusercontent.com/7476964/196637396-d437278c-f462-41dd-8323-3d613c05214b.png&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://user-images.githubusercontent.com/7476964/196637396-d437278c-f462-41dd-8323-3d613c05214b.png&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;it is understandable that name and type are mandatory, but the others should be optional.&lt;/p&gt;

&lt;p&gt;The current parsing does not allow this. If more than 1000 fields are defined, this would be a headache and unnecessary metadata.&lt;/p&gt;</comment>
                            <comment id="17780214" author="gurwls223" created="Fri, 27 Oct 2023 07:34:27 +0000"  >&lt;p&gt;Issue resolved by pull request 43474&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/43474&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/43474&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>Python</label>
            <label>Scala</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z19fco:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>