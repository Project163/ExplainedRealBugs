<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:16:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-31761] Sql Div operator can result in incorrect output for int_min</title>
                <link>https://issues.apache.org/jira/browse/SPARK-31761</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Input  in csv : -2147483648,-1  --&amp;gt; (_c0, _c1)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val res = df.selectExpr(&lt;span class=&quot;code-quote&quot;&gt;&quot;_c0 div _c1&quot;&lt;/span&gt;)
res.collect
res1: Array[org.apache.spark.sql.Row] = Array([-2147483648])
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The result should be 2147483648 instead.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13305920">SPARK-31761</key>
            <summary>Sql Div operator can result in incorrect output for int_min</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sandeep.katta2007">Sandeep Katta</assignee>
                                    <reporter username="kshukla">Kuhu Shukla</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 May 2020 12:42:10 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:55 +0000</updated>
                            <resolved>Sun, 24 May 2020 05:52:48 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="17111294" author="sandeep.katta2007" created="Tue, 19 May 2020 15:53:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kshukla&quot; class=&quot;user-hover&quot; rel=&quot;kshukla&quot;&gt;kshukla&lt;/a&gt;&#160;thanks for raising this, I cross checked this in 2.4.4 it seems to work fine.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I will analyse&#160; w.r.t 3.0.0 and raise PR soon .&lt;/p&gt;</comment>
                            <comment id="17111304" author="kshukla" created="Tue, 19 May 2020 16:08:12 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sandeep.katta2007&quot; class=&quot;user-hover&quot; rel=&quot;sandeep.katta2007&quot;&gt;sandeep.katta2007&lt;/a&gt; for the quick response. The commit I was on is 06e1c0d788407af6101bf66d28cd44ca943d7a42 and also that this is reproducible when reading from csv and not when values are passed as literals.&lt;/p&gt;</comment>
                            <comment id="17112368" author="sandeep.katta2007" created="Wed, 20 May 2020 15:43:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sowen&quot; class=&quot;user-hover&quot; rel=&quot;sowen&quot;&gt;sowen&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt;&#160; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dongjoon&quot; class=&quot;user-hover&quot; rel=&quot;dongjoon&quot;&gt;dongjoon&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I have executed the same query in spark-2.4.4 it works as per expectation.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;As you can see from&#160;2.4.4 plan, columns are casted to double,&#160; so there won&apos;t be &lt;b&gt;Integer overflow.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;== Parsed Logical Plan ==&lt;br/&gt;
 &apos;Project &lt;a href=&quot;#4&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;cast((&apos;col0 / &apos;col1) as bigint) AS CAST((col0 / col1) AS BIGINT)#4&lt;/a&gt;&lt;br/&gt;
 +- Relation&lt;a href=&quot;#0,col1#1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;col0#0,col1#1&lt;/a&gt; csv&lt;/p&gt;

&lt;p&gt;== Analyzed Logical Plan ==&lt;br/&gt;
 CAST((col0 / col1) AS BIGINT): bigint&lt;br/&gt;
 Project &lt;a href=&quot;#0 as double) / cast(col1#1 as double)) as bigint) AS CAST((col0 / col1) AS BIGINT)#4L&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;cast((cast(col0#0 as double) / cast(col1#1 as double)) as bigint) AS CAST((col0 / col1) AS BIGINT)#4L&lt;/a&gt;&lt;br/&gt;
 +- Relation&lt;a href=&quot;#0,col1#1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;col0#0,col1#1&lt;/a&gt; csv&lt;/p&gt;

&lt;p&gt;== Optimized Logical Plan ==&lt;br/&gt;
 Project &lt;a href=&quot;#0 as double) / cast(col1#1 as double)) as bigint) AS CAST((col0 / col1) AS BIGINT)#4L&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;cast((cast(col0#0 as double) / cast(col1#1 as double)) as bigint) AS CAST((col0 / col1) AS BIGINT)#4L&lt;/a&gt;&lt;br/&gt;
 +- Relation&lt;a href=&quot;#0,col1#1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;col0#0,col1#1&lt;/a&gt; csv&lt;/p&gt;

&lt;p&gt;== Physical Plan ==&lt;br/&gt;
 *(1) Project &lt;a href=&quot;#0 as double) / cast(col1#1 as double)) as bigint) AS CAST((col0 / col1) AS BIGINT)#4L&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;cast((cast(col0#0 as double) / cast(col1#1 as double)) as bigint) AS CAST((col0 / col1) AS BIGINT)#4L&lt;/a&gt;&lt;br/&gt;
 +- *(1) FileScan csv &lt;a href=&quot;#0,col1#1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;col0#0,col1#1&lt;/a&gt; Batched: false, Format: CSV, Location: InMemoryFileIndex&lt;a href=&quot;file:///opt/fordebug/divTest.csv&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/opt/fordebug/divTest.csv&lt;/a&gt;, PartitionFilters: [], PushedFilters: [], ReadSchema: struct&amp;lt;col0:int,col1:int&amp;gt;&lt;br/&gt;
 *(1) Project &lt;a href=&quot;#0 as double) / cast(col1#1 as double)) as bigint) AS CAST((col0 / col1) AS BIGINT)#4L&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;cast((cast(col0#0 as double) / cast(col1#1 as double)) as bigint) AS CAST((col0 / col1) AS BIGINT)#4L&lt;/a&gt;&lt;br/&gt;
 +- *(1) FileScan csv &lt;a href=&quot;#0,col1#1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;col0#0,col1#1&lt;/a&gt; Batched: false, Format: CSV, Location: InMemoryFileIndex&lt;a href=&quot;file:///opt/fordebug/divTest.csv&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/opt/fordebug/divTest.csv&lt;/a&gt;, PartitionFilters: [], PushedFilters: [], ReadSchema: struct&amp;lt;col0:int,col1:int&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Spark-3.0 Plan&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;== Parsed Logical Plan ==&lt;br/&gt;
 &apos;Project &lt;a href=&quot;#4&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;(&apos;col0 div &apos;col1) AS (col0 div col1)#4&lt;/a&gt;&lt;br/&gt;
 +- RelationV2&lt;a href=&quot;#0, col1#1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;col0#0, col1#1&lt;/a&gt; csv &lt;a href=&quot;file:///opt/fordebug/divTest.csv&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/opt/fordebug/divTest.csv&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;== Analyzed Logical Plan ==&lt;br/&gt;
 (col0 div col1): int&lt;br/&gt;
 Project &lt;a href=&quot;#0 div col1#1) AS (col0 div col1)#4&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;(col0#0 div col1#1) AS (col0 div col1)#4&lt;/a&gt;&lt;br/&gt;
 +- RelationV2&lt;a href=&quot;#0, col1#1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;col0#0, col1#1&lt;/a&gt; csv &lt;a href=&quot;file:///opt/fordebug/divTest.csv&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/opt/fordebug/divTest.csv&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;== Optimized Logical Plan ==&lt;br/&gt;
 Project &lt;a href=&quot;#0 div col1#1) AS (col0 div col1)#4&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;(col0#0 div col1#1) AS (col0 div col1)#4&lt;/a&gt;&lt;br/&gt;
 +- RelationV2&lt;a href=&quot;#0, col1#1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;col0#0, col1#1&lt;/a&gt; csv &lt;a href=&quot;file:///opt/fordebug/divTest.csv&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/opt/fordebug/divTest.csv&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;== Physical Plan ==&lt;br/&gt;
 *(1) Project &lt;a href=&quot;#0 div col1#1) AS (col0 div col1)#4&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;(col0#0 div col1#1) AS (col0 div col1)#4&lt;/a&gt;&lt;br/&gt;
 +- BatchScan&lt;a href=&quot;#0, col1#1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;col0#0, col1#1&lt;/a&gt; CSVScan Location: InMemoryFileIndex&lt;a href=&quot;file:///opt/fordebug/divTest.csv&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/opt/fordebug/divTest.csv&lt;/a&gt;, ReadSchema: struct&amp;lt;col0:int,col1:int&amp;gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In Spark3 do I need to cast the columns as in spark-2.4,&#160; or user should manually add cast to their query as per below example&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;val schema = &quot;col0 int,col1 int&quot;;&lt;br/&gt;
 val df = spark.read.schema(schema).csv(&quot;file:/opt/fordebug/divTest.csv&quot;);&lt;br/&gt;
 val res = df.selectExpr(&quot;col0 div col1&quot;)&lt;br/&gt;
 val res = df.selectExpr(&quot;Cast(col0 as Decimal) div col1 &quot;)&lt;br/&gt;
 res.collect&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;please let us know your opinion&#160;&lt;/p&gt;</comment>
                            <comment id="17112918" author="gurwls223" created="Thu, 21 May 2020 08:21:29 +0000"  >&lt;p&gt;If it overflows, looks like it just should be guided by &lt;tt&gt;spark.sql.ansi.enabled&lt;/tt&gt; and throws an exception on the overflow.&lt;/p&gt;</comment>
                            <comment id="17112924" author="gurwls223" created="Thu, 21 May 2020 08:23:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sandeep.katta2007&quot; class=&quot;user-hover&quot; rel=&quot;sandeep.katta2007&quot;&gt;sandeep.katta2007&lt;/a&gt; feel free to open a followup PR against &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-16323&quot; title=&quot;Avoid unnecessary cast when doing integral divide&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-16323&quot;&gt;&lt;del&gt;SPARK-16323&lt;/del&gt;&lt;/a&gt; in order to document the overflow in the migration guide. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgaido&quot; class=&quot;user-hover&quot; rel=&quot;mgaido&quot;&gt;mgaido&lt;/a&gt; fyi&lt;/p&gt;</comment>
                            <comment id="17113308" author="cloud_fan" created="Thu, 21 May 2020 15:53:28 +0000"  >&lt;p&gt;I think this is a breaking change and we should fix it.&lt;/p&gt;

&lt;p&gt;The `div` operator always returns long type, so this should not overflow. The `IntegralDivide` should cast input to long and divide.&lt;/p&gt;</comment>
                            <comment id="17113309" author="cloud_fan" created="Thu, 21 May 2020 15:54:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sandeep.katta2007&quot; class=&quot;user-hover&quot; rel=&quot;sandeep.katta2007&quot;&gt;sandeep.katta2007&lt;/a&gt; are you interested at fixing it?&lt;/p&gt;</comment>
                            <comment id="17113337" author="sandeep.katta2007" created="Thu, 21 May 2020 16:25:21 +0000"  >&lt;p&gt;I can fix this, I will raise PR&lt;/p&gt;</comment>
                            <comment id="17113344" author="sandeep.katta2007" created="Thu, 21 May 2020 16:32:48 +0000"  >&lt;p&gt;but to fix this do we need to revert&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-16323&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-16323&lt;/a&gt;&#160;or we just cast input to long and divide ?&lt;/p&gt;</comment>
                            <comment id="17113451" author="dongjoon" created="Thu, 21 May 2020 18:31:02 +0000"  >&lt;p&gt;If possible, could you try to find a way not to revert the existing commit, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sandeep.katta2007&quot; class=&quot;user-hover&quot; rel=&quot;sandeep.katta2007&quot;&gt;sandeep.katta2007&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17113453" author="sandeep.katta2007" created="Thu, 21 May 2020 18:33:46 +0000"  >&lt;p&gt;okay I will try to fix it&#160;&lt;/p&gt;</comment>
                            <comment id="17113523" author="apachespark" created="Thu, 21 May 2020 20:35:21 +0000"  >&lt;p&gt;User &apos;sandeep-katta&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28600&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28600&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17113524" author="apachespark" created="Thu, 21 May 2020 20:35:55 +0000"  >&lt;p&gt;User &apos;sandeep-katta&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28600&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28600&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17113525" author="sandeep.katta2007" created="Thu, 21 May 2020 20:36:00 +0000"  >&lt;p&gt;I have raised the Pull request&#160;&lt;a href=&quot;https://github.com/apache/spark/pull/28600&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28600&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17113706" author="kabhwan" created="Fri, 22 May 2020 02:57:58 +0000"  >&lt;p&gt;Let&apos;s make sure priority is marked properly so that RC3 cannot be initiated without this - sounds like it&apos;s a blocker because it&apos;s a regression and correctness issue.&lt;/p&gt;</comment>
                            <comment id="17113728" author="cloud_fan" created="Fri, 22 May 2020 03:54:25 +0000"  >&lt;p&gt;I&apos;ve set it as blocker.&lt;/p&gt;</comment>
                            <comment id="17115033" author="gurwls223" created="Sun, 24 May 2020 05:52:48 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;https://github.com/apache/spark/pull/28600&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28600&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17115037" author="apachespark" created="Sun, 24 May 2020 06:12:02 +0000"  >&lt;p&gt;User &apos;sandeep-katta&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28628&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28628&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 25 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ewo0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>