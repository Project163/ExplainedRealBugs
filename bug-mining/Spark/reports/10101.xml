<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:46:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-51586] Kafka continuous stream may go into infinite loop of reconfiguring</title>
                <link>https://issues.apache.org/jira/browse/SPARK-51586</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-45080&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;&lt;del&gt;SPARK-45080&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/spark/pull/42823&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;del&gt;PR 42823&lt;/del&gt;&lt;/a&gt; Kafka continuous stream may go into infinite loop of reconfiguring. As &lt;tt&gt;KafkaScan&lt;/tt&gt; columnar support mode is hardcoded to &lt;tt&gt;UNSUPPORTED&lt;/tt&gt; &lt;tt&gt;ContinuousScanExec&lt;/tt&gt; does not initialize &lt;tt&gt;inputPartitions&lt;/tt&gt; in &lt;tt&gt;supportsColumnar&lt;/tt&gt; as it did prior to the above PR. So, there is no call to &lt;tt&gt;KafkaContinuousStream.planInputPartitions&lt;/tt&gt; during query planning. It leaves &lt;tt&gt;KafkaContinuousStream.knownPartitions&lt;/tt&gt; uninitialized, so call to &lt;tt&gt;needsReconfiguration&lt;/tt&gt; returns true. Now &lt;tt&gt;epochUpdateThread&lt;/tt&gt; in &lt;tt&gt;ContinuousExecution&lt;/tt&gt; requests interruption of &lt;tt&gt;queryExecutionThread&lt;/tt&gt;, so that thread also can&apos;t initialize &lt;tt&gt;knownPartitions&lt;/tt&gt; as it checks for interrupts in &lt;tt&gt;KafkaOffsetReaderAdmin.withRetries&lt;/tt&gt; and exits before &lt;tt&gt;knownPartitions&lt;/tt&gt;  is assigned.&lt;/p&gt;

&lt;p&gt;The problem can be identified in the logs by the following repeating pattern:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;25/03/21 09:38:09.709 stream execution thread for [id = 085613ee-b0b0-4864-8ac9-2bbd7c885e13, runId = 03a5bef3-f5e1-4d23-991d-a19873db9192] INFO CommitLog: BatchIds found from listing: 
25/03/21 09:38:09.709 stream execution thread for [id = 085613ee-b0b0-4864-8ac9-2bbd7c885e13, runId = 03a5bef3-f5e1-4d23-991d-a19873db9192] INFO ContinuousExecution: Starting new streaming query.
25/03/21 09:38:09.710 stream execution thread for [id = 085613ee-b0b0-4864-8ac9-2bbd7c885e13, runId = 03a5bef3-f5e1-4d23-991d-a19873db9192] INFO KafkaContinuousStream: Initial offsets: {&quot;topic-0&quot;:{&quot;0&quot;:1,&quot;1&quot;:1,&quot;2&quot;:1,&quot;3&quot;:1,&quot;4&quot;:1}}
25/03/21 09:38:09.710 stream execution thread for [id = 085613ee-b0b0-4864-8ac9-2bbd7c885e13, runId = 03a5bef3-f5e1-4d23-991d-a19873db9192] INFO BaseSessionStateBuilder$$anon$2: Optimization rule &apos;org.apache.spark.sql.catalyst.optimizer.ConvertToLocalRelation&apos; is excluded from the optimizer.
25/03/21 09:38:09.710 stream execution thread for [id = 085613ee-b0b0-4864-8ac9-2bbd7c885e13, runId = 03a5bef3-f5e1-4d23-991d-a19873db9192] INFO BaseSessionStateBuilder$$anon$2: Optimization rule &apos;org.apache.spark.sql.catalyst.optimizer.ConvertToLocalRelation&apos; is excluded from the optimizer.
25/03/21 09:38:09.711 stream execution thread for [id = 085613ee-b0b0-4864-8ac9-2bbd7c885e13, runId = 03a5bef3-f5e1-4d23-991d-a19873db9192] INFO EpochCoordinatorRef: Registered EpochCoordinator endpoint
25/03/21 09:38:09.711 stream execution thread for [id = 085613ee-b0b0-4864-8ac9-2bbd7c885e13, runId = 03a5bef3-f5e1-4d23-991d-a19873db9192] INFO BaseSessionStateBuilder$$anon$2: Optimization rule &apos;org.apache.spark.sql.catalyst.optimizer.ConvertToLocalRelation&apos; is excluded from the optimizer.
25/03/21 09:38:09.711 stream execution thread for [id = 085613ee-b0b0-4864-8ac9-2bbd7c885e13, runId = 03a5bef3-f5e1-4d23-991d-a19873db9192] INFO BaseSessionStateBuilder$$anon$2: Optimization rule &apos;org.apache.spark.sql.catalyst.optimizer.ConvertToLocalRelation&apos; is excluded from the optimizer.
25/03/21 09:38:09.713 stream execution thread for [id = 085613ee-b0b0-4864-8ac9-2bbd7c885e13, runId = 03a5bef3-f5e1-4d23-991d-a19873db9192] INFO ContinuousExecution: Query 085613ee-b0b0-4864-8ac9-2bbd7c885e13 ignoring exception from reconfiguring: java.lang.InterruptedException
25/03/21 09:38:09.713 stream execution thread for [id = 085613ee-b0b0-4864-8ac9-2bbd7c885e13, runId = 03a5bef3-f5e1-4d23-991d-a19873db9192] INFO DAGScheduler: Asked to cancel job group 03a5bef3-f5e1-4d23-991d-a19873db9192 with cancelFutureJobs=false
25/03/21 09:38:09.713 dag-scheduler-event-loop WARN DAGScheduler: Failed to cancel job group 03a5bef3-f5e1-4d23-991d-a19873db9192. Cannot find active jobs for it.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;



</description>
                <environment></environment>
        <key id="13612681">SPARK-51586</key>
            <summary>Kafka continuous stream may go into infinite loop of reconfiguring</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vrozov">Vlad Rozov</assignee>
                                    <reporter username="vrozov">Vlad Rozov</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 21 Mar 2025 16:44:55 +0000</created>
                <updated>Tue, 25 Mar 2025 03:01:17 +0000</updated>
                            <resolved>Tue, 25 Mar 2025 01:35:52 +0000</resolved>
                                    <version>4.1.0</version>
                    <version>4.0.0</version>
                                    <fixVersion>4.0.0</fixVersion>
                                    <component>Structured Streaming</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17938076" author="kabhwan" created="Tue, 25 Mar 2025 01:35:52 +0000"  >&lt;p&gt;Issue resolved by pull request 50348&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/50348&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/50348&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            33 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ux68:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>