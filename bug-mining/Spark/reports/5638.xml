<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:59:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-23549] Spark SQL unexpected behavior when comparing timestamp to date</title>
                <link>https://issues.apache.org/jira/browse/SPARK-23549</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; spark.version

res1: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = 2.2.1

scala&amp;gt; spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&apos;2017-03-01 00:00:00&apos;&lt;/span&gt; as timestamp) between &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&apos;2017-02-28&apos;&lt;/span&gt; as date) and &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&apos;2017-03-01&apos;&lt;/span&gt; as date)&quot;&lt;/span&gt;).show


+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

|((CAST(CAST(2017-03-01 00:00:00 AS TIMESTAMP) AS STRING) &amp;gt;= CAST(CAST(2017-02-28 AS DATE) AS STRING)) AND (CAST(CAST(2017-03-01 00:00:00 AS TIMESTAMP) AS STRING) &amp;lt;= CAST(CAST(2017-03-01 AS DATE) AS STRING)))|

+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

|&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;|

+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As shown above, when a timestamp is compared to date in SparkSQL, both timestamp and date are downcast to string, and leading to unexpected result. If run the same SQL in presto/Athena, I got the expected result&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&apos;2017-03-01 00:00:00&apos;&lt;/span&gt; as timestamp) between &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&apos;2017-02-28&apos;&lt;/span&gt; as date) and &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&apos;2017-03-01&apos;&lt;/span&gt; as date)
&#160;	_col0
1	&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is this a bug for Spark or a feature?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13141815">SPARK-23549</key>
            <summary>Spark SQL unexpected behavior when comparing timestamp to date</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kiszk">Kazuaki Ishizaki</assignee>
                                    <reporter username="djiangxu">Dong Jiang</reporter>
                        <labels>
                            <label>release_notes</label>
                    </labels>
                <created>Thu, 1 Mar 2018 14:53:17 +0000</created>
                <updated>Fri, 2 Nov 2018 02:52:44 +0000</updated>
                            <resolved>Sun, 25 Mar 2018 23:40:27 +0000</resolved>
                                    <version>1.6.3</version>
                    <version>2.0.2</version>
                    <version>2.1.2</version>
                    <version>2.2.1</version>
                    <version>2.3.0</version>
                                    <fixVersion>2.4.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="16384226" author="djiangxu" created="Fri, 2 Mar 2018 22:12:47 +0000"  >&lt;p&gt;Tested in spark 2.3.0, same thing&lt;/p&gt;</comment>
                            <comment id="16391282" author="cane" created="Thu, 8 Mar 2018 14:06:21 +0000"  >&lt;p&gt;I think this is a bug.Which may caused by rule below:(I have not run any test,just guessing)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; p @ BinaryComparison(left, right)
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; findCommonTypeForBinaryComparison(left.dataType, right.dataType).isDefined =&amp;gt;
        val commonType = findCommonTypeForBinaryComparison(left.dataType, right.dataType).get
        p.makeCopy(Array(castExpr(left, commonType), castExpr(right, commonType)))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;findCommonTypeForBinaryComparison will return StringType:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; (DateType, TimestampType) =&amp;gt; Some(StringType)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;May be we can add a new rule for this case?&lt;/p&gt;


</comment>
                            <comment id="16391344" author="kiszk" created="Thu, 8 Mar 2018 14:46:47 +0000"  >&lt;p&gt;I think that this is a problem in Spark.&lt;br/&gt;
My question is what should be the result for the following query?&lt;br/&gt;
select cast(&apos;2017-03-01 23:59:59&apos; as timestamp) between cast(&apos;2017-02-28&apos; as date) and cast(&apos;2017-03-01&apos; as date)&lt;/p&gt;</comment>
                            <comment id="16391351" author="djiangxu" created="Thu, 8 Mar 2018 14:53:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kiszk&quot; class=&quot;user-hover&quot; rel=&quot;kiszk&quot;&gt;kiszk&lt;/a&gt;, I expect your query to return false, as presto/Athena does.&lt;br/&gt;
A date in SQL is typically thought of equivalent to timestamp at 00:00:00&lt;/p&gt;</comment>
                            <comment id="16391386" author="kiszk" created="Thu, 8 Mar 2018 15:26:37 +0000"  >&lt;p&gt;I see. Make sense. It would be good to cast `TimestampType` when we compare `DateType` with `TimestampType`.&lt;br/&gt;
 I will submit a PR.&lt;/p&gt;</comment>
                            <comment id="16391686" author="apachespark" created="Thu, 8 Mar 2018 18:27:04 +0000"  >&lt;p&gt;User &apos;kiszk&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/20774&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20774&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16391877" author="dongjoon" created="Thu, 8 Mar 2018 20:24:09 +0000"  >&lt;p&gt;Thank you for reporting and making a patch for this, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djiangxu&quot; class=&quot;user-hover&quot; rel=&quot;djiangxu&quot;&gt;djiangxu&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kiszk&quot; class=&quot;user-hover&quot; rel=&quot;kiszk&quot;&gt;kiszk&lt;/a&gt;.&lt;br/&gt;
I checked Hive and saw that Hive 1.2~2.1 also had this issue and it&apos;s fixed at Hive 2.0.0.&lt;/p&gt;</comment>
                            <comment id="16458511" author="emlyn" created="Mon, 30 Apr 2018 12:08:16 +0000"  >&lt;p&gt;Will this be&#160;included in Spark 2.3.1? It only says 2.4.0&lt;/p&gt;</comment>
                            <comment id="16459136" author="dongjoon" created="Mon, 30 Apr 2018 21:57:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emlyn&quot; class=&quot;user-hover&quot; rel=&quot;emlyn&quot;&gt;emlyn&lt;/a&gt;. This issue changes the behavior and introduces new conf `spark.sql.hive.compareDateTimestampInTimestamp`. I don&apos;t think this will be included in Spark 2.3.1.&lt;/p&gt;</comment>
                            <comment id="16622958" author="apachespark" created="Fri, 21 Sep 2018 02:03:51 +0000"  >&lt;p&gt;User &apos;rxin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22508&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22508&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3qqwv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>