<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:51:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-16440] Undeleted broadcast variables in Word2Vec causing OoM for long runs </title>
                <link>https://issues.apache.org/jira/browse/SPARK-16440</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Three broadcast variables created at the beginning of &lt;tt&gt;Word2Vec.fit()&lt;/tt&gt; are never deleted nor unpersisted. This seems to cause excessive memory consumption on the driver for a job running hundreds of successive training.&lt;/p&gt;

&lt;p&gt;They are &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    val expTable = sc.broadcast(createExpTable())
    val bcVocab = sc.broadcast(vocab)
    val bcVocabHash = sc.broadcast(vocabHash)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="12987775">SPARK-16440</key>
            <summary>Undeleted broadcast variables in Word2Vec causing OoM for long runs </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anthony-truchet">Anthony Truchet</assignee>
                                    <reporter username="anthony-truchet">Anthony Truchet</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Jul 2016 12:45:43 +0000</created>
                <updated>Tue, 28 Feb 2017 10:18:03 +0000</updated>
                            <resolved>Wed, 13 Jul 2016 10:40:04 +0000</resolved>
                                    <version>1.6.0</version>
                    <version>1.6.1</version>
                    <version>1.6.2</version>
                    <version>2.0.0</version>
                                    <fixVersion>1.6.3</fixVersion>
                    <fixVersion>2.0.1</fixVersion>
                                    <component>MLlib</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="14400">4h</timeoriginalestimate>
                            <timeestimate seconds="14400">4h</timeestimate>
                                        <comments>
                            <comment id="15367615" author="anthony-truchet" created="Fri, 8 Jul 2016 12:48:08 +0000"  >&lt;p&gt;Hello Spark developers,&lt;/p&gt;

&lt;p&gt;I&apos;m preparing a patch for this issue. This will be my first contribution to Spark. I&apos;ll strive to follow the contribution guidelines, but please do not hesitate to tell me how to do it better if required &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="15367616" author="srowen" created="Fri, 8 Jul 2016 12:50:06 +0000"  >&lt;p&gt;Yeah it would be fine to unpersist these at the end of the method. &lt;br/&gt;
I suppose I&apos;m surprised that the Broadcast vars don&apos;t unpersist themselves when they&apos;re out of scope and garbage collected via finalize?&lt;/p&gt;</comment>
                            <comment id="15372781" author="apachespark" created="Tue, 12 Jul 2016 12:09:06 +0000"  >&lt;p&gt;User &apos;srowen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/14153&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14153&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15374819" author="srowen" created="Wed, 13 Jul 2016 10:40:04 +0000"  >&lt;p&gt;Issue resolved by pull request 14153&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/14153&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14153&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15383967" author="anthony-truchet" created="Tue, 19 Jul 2016 11:19:40 +0000"  >&lt;p&gt;Thanks for such a quick fix &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt; : I was off-line for the past week that&apos;s why I couldn&apos;t submit the patch quickly enough.&lt;/p&gt;

&lt;p&gt;I would have &lt;tt&gt;destroyed&lt;/tt&gt; the variable instead of &lt;tt&gt;unpersisting&lt;/tt&gt; them though as the issues was memory consumption on the &lt;b&gt;driver&lt;/b&gt; side: what am I missing which made you choose the later over the former ?&lt;/p&gt;</comment>
                            <comment id="15383971" author="srowen" created="Tue, 19 Jul 2016 11:22:30 +0000"  >&lt;p&gt;Oh, may be better still indeed. Feel free to submit a follow up associated to this same JIRA. &lt;/p&gt;</comment>
                            <comment id="15384118" author="anthony-truchet" created="Tue, 19 Jul 2016 13:07:21 +0000"  >&lt;p&gt;I will, as well as putting this is a try finally to ensure proper deletion even in case of errors.&lt;/p&gt;</comment>
                            <comment id="15384131" author="srowen" created="Tue, 19 Jul 2016 13:21:37 +0000"  >&lt;p&gt;Yeah it seems good to destroy even in case of errors, but in practice, an error here means lots of things are wrong. Actually using try-finally to destroy every RDD/variable would make the code a mess. I think many cases where it plausibly won&apos;t matter, we don&apos;t. If there&apos;s a decent argument that errors here are common for some reason, OK, but not sure that&apos;s true.&lt;/p&gt;</comment>
                            <comment id="15384608" author="apachespark" created="Tue, 19 Jul 2016 18:04:06 +0000"  >&lt;p&gt;User &apos;AnthonyTruchet&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/14268&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14268&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15387342" author="anthony-truchet" created="Thu, 21 Jul 2016 08:12:33 +0000"  >&lt;p&gt;Regarding the try finally: we are computing numerous learning from within a same spark context and some with vocabulary so large that they fail (yes we do try to filter out too big ones, but too big is difficult to define).&lt;/p&gt;

&lt;p&gt;So we are in a context where we do care about resource cleaning in case of error in order to enable thousands of successive learnings some of with expected to fail.&lt;/p&gt;

&lt;p&gt;As for core readability we can try to refactor the function to reduce the nesting or find a &quot;nice&quot; scala solution: I&apos;ll propose a patch and I&apos;ll welcome any feedback on it.&lt;/p&gt;</comment>
                            <comment id="15887730" author="apachespark" created="Tue, 28 Feb 2017 10:18:03 +0000"  >&lt;p&gt;User &apos;AnthonyTruchet&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/14299&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14299&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12915062">SPARK-11898</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 38 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30p9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>