<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:38:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-13478] Fetching delegation tokens for Hive fails when using proxy users</title>
                <link>https://issues.apache.org/jira/browse/SPARK-13478</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;If you use spark-submit&apos;s proxy user support, the code that fetches delegation tokens for the Hive Metastore fails. It seems like the Hive library tries to connect to the Metastore as the proxy user, and it doesn&apos;t have a Kerberos TGT for that user, so it fails.&lt;/p&gt;

&lt;p&gt;I don&apos;t know whether the same issue exists in the HBase code, but I&apos;ll make a similar change so that both behave similarly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12944324">SPARK-13478</key>
            <summary>Fetching delegation tokens for Hive fails when using proxy users</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vanzin">Marcelo Masiero Vanzin</assignee>
                                    <reporter username="vanzin">Marcelo Masiero Vanzin</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Feb 2016 23:29:48 +0000</created>
                <updated>Sun, 17 May 2020 18:17:09 +0000</updated>
                            <resolved>Sun, 22 Jan 2017 00:23:49 +0000</resolved>
                                    <version>1.6.0</version>
                    <version>2.0.0</version>
                                    <fixVersion>1.6.4</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>Spark Core</component>
                    <component>YARN</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>13</watches>
                                                                                                                <comments>
                            <comment id="15166544" author="vanzin" created="Thu, 25 Feb 2016 01:53:02 +0000"  >&lt;p&gt;Actually d&apos;oh, I had secure HBase for the testing anyway, so I just checked and HBase doesn&apos;t have the same problem.&lt;/p&gt;</comment>
                            <comment id="15166570" author="vanzin" created="Thu, 25 Feb 2016 02:07:59 +0000"  >&lt;p&gt;For the record, here&apos;s the exception you get:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;16/02/24 18:06:48 ERROR transport.TSaslTransport: SASL negotiation failure
javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Failed to find any Kerberos tgt)]
        at com.sun.security.sasl.gsskerb.GssKrb5Client.evaluateChallenge(GssKrb5Client.java:212)
        at org.apache.thrift.transport.TSaslClientTransport.handleSaslStartMessage(TSaslClientTransport.java:94)
        at org.apache.thrift.transport.TSaslTransport.open(TSaslTransport.java:271)
        at org.apache.thrift.transport.TSaslClientTransport.open(TSaslClientTransport.java:37)
[...plus lots of other stuff]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15166586" author="apachespark" created="Thu, 25 Feb 2016 02:16:04 +0000"  >&lt;p&gt;User &apos;vanzin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/11358&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/11358&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15830514" author="blue666man" created="Thu, 19 Jan 2017 20:05:45 +0000"  >&lt;p&gt;Can we get this patch applied to 1.6.x as well?&lt;/p&gt;</comment>
                            <comment id="15832617" author="apachespark" created="Fri, 20 Jan 2017 23:43:03 +0000"  >&lt;p&gt;User &apos;vanzin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/16665&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/16665&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16650302" author="sunayansaikia" created="Mon, 15 Oct 2018 14:37:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt; As we know &apos;spark-submit&apos; command by itself doesn&apos;t officially allow the &apos;&amp;#45;&amp;#45;proxy&amp;#45;user&apos; and &apos;&amp;#45;&amp;#45;principal/&amp;#45;ketab&apos; options to be used together. So, how this patch working?&lt;/p&gt;</comment>
                            <comment id="16650451" author="vanzin" created="Mon, 15 Oct 2018 16:33:21 +0000"  >&lt;p&gt;You don&apos;t need a keytab to log in to kerberos...&lt;/p&gt;</comment>
                            <comment id="16656320" author="sunayansaikia" created="Fri, 19 Oct 2018 06:15:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt;: If I want to &apos;spark-submit&apos; with keytab plus principal and still use a proxy user, how will I accomplish this in deploy mode &apos;cluster&apos;. For, &apos;client&apos; deploy mode things would probably work if I do a &apos;kinit&apos; first in the shell and then execute &apos;spark-submit&apos;. So, will the same method work for &apos;cluster&apos; deploy mode?&lt;/p&gt;</comment>
                            <comment id="16657029" author="vanzin" created="Fri, 19 Oct 2018 16:27:26 +0000"  >&lt;p&gt;If you have a principal and a keytab you don&apos;t need a proxy user. Just use the principal and the keytab.&lt;/p&gt;

&lt;p&gt;If the principal you&apos;re using is not the principal you want the app to run as, then you can&apos;t give the app the principal&apos;s keytab. Otherwise the other user will have access to it, and that&apos;s a security problem.&lt;/p&gt;</comment>
                            <comment id="16657743" author="sunayansaikia" created="Sat, 20 Oct 2018 05:43:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt;: My use case&apos;s a&#160;bit&#160;different. Imagine, I&apos;m kind of like a power user say, &apos;poweruser&apos;. I can login as &apos;poweruser&apos; and I have&#160;its&#160;keytab and principal. And, I have a normal user say, &apos;user1&apos;. &apos;user1&apos; doesn&apos;t have access to poweruser&apos;s keytab or principal. But, being&#160; &apos;poweruser&apos;, I&apos;d want to impersonate &apos;user1&apos; and run &apos;spark-submit&apos; in a shell. Also, please consider I can&apos;t login into user1 shell but poweruser&apos;s&lt;/p&gt;

&lt;p&gt;Is this use case valid or you see a potential security concern?&lt;/p&gt;</comment>
                            <comment id="16658025" author="vanzin" created="Sat, 20 Oct 2018 23:17:17 +0000"  >&lt;p&gt;If you run as user1 with the poweruser&apos;s keytab, it means the code running as user1 will have access to poweruser&apos;s keytab. That may be a security concern depending on your environment.&lt;/p&gt;

&lt;p&gt;But the REALLY safe way is to deploy the app with user1&apos;s keytab. If you can impersonate user1, there&apos;s no reason why you wouldn&apos;t instead get its keytab, so just do that instead. It&apos;s safer since it keeps the poweruser&apos;s keytab more protected.&lt;/p&gt;

&lt;p&gt;So, to repeat this again: always use the keytab of the least privileged user. Or just give up on token renewal and restart the app as needed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13035372">SPARK-19250</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 4 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tpun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329449">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>