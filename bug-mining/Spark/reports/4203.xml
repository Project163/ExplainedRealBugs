<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:48:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-14393] values generated by non-deterministic functions shouldn&apos;t change after coalesce or union</title>
                <link>https://issues.apache.org/jira/browse/SPARK-14393</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When utilising monotonicallyIncreasingId with a coalesce, it appears that every partition uses the same offset (0) leading to non-monotonically increasing IDs.&lt;/p&gt;

&lt;p&gt;See examples below&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt;&amp;gt;&amp;gt; sqlContext.range(10).select(monotonicallyIncreasingId()).show()
+---------------------------+
|monotonicallyincreasingid()|
+---------------------------+
|                25769803776|
|                51539607552|
|                77309411328|
|               103079215104|
|               128849018880|
|               163208757248|
|               188978561024|
|               214748364800|
|               240518168576|
|               266287972352|
+---------------------------+

&amp;gt;&amp;gt;&amp;gt; sqlContext.range(10).select(monotonicallyIncreasingId()).coalesce(1).show()
+---------------------------+
|monotonicallyincreasingid()|
+---------------------------+
|                          0|
|                          0|
|                          0|
|                          0|
|                          0|
|                          0|
|                          0|
|                          0|
|                          0|
|                          0|
+---------------------------+

&amp;gt;&amp;gt;&amp;gt; sqlContext.range(10).repartition(5).select(monotonicallyIncreasingId()).coalesce(1).show()
+---------------------------+
|monotonicallyincreasingid()|
+---------------------------+
|                          0|
|                          1|
|                          0|
|                          0|
|                          1|
|                          2|
|                          3|
|                          0|
|                          1|
|                          2|
+---------------------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12956001">SPARK-14393</key>
            <summary>values generated by non-deterministic functions shouldn&apos;t change after coalesce or union</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mengxr">Xiangrui Meng</assignee>
                                    <reporter username="jpiper">Jason Piper</reporter>
                        <labels>
                            <label>correctness</label>
                            <label>releasenotes</label>
                    </labels>
                <created>Tue, 5 Apr 2016 01:04:15 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:03 +0000</updated>
                            <resolved>Wed, 2 Nov 2016 18:41:43 +0000</resolved>
                                    <version>1.6.0</version>
                    <version>2.0.0</version>
                    <version>2.0.1</version>
                                    <fixVersion>2.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="15227551" author="maropu" created="Wed, 6 Apr 2016 01:55:14 +0000"  >&lt;p&gt;Seems different `MonotonicallyIncreasingID` instances share the same stage, that is the same partition id. However, I&apos;m not 100% sure this is a wrong behaviour because we can easily break this monotonically-increasing semantics by using repartition/coalesce after  select(monotonicallyIncreasingId()).&lt;/p&gt;</comment>
                            <comment id="15227722" author="jpiper" created="Wed, 6 Apr 2016 04:59:11 +0000"  >&lt;p&gt;If this isn&apos;t a bug, I guess it needs to be clear in the documentation what the intended behaviour is here - I assumed that it would guarantee a monotonically-increasing in the end result.&lt;/p&gt;</comment>
                            <comment id="15558029" author="gurwls223" created="Sat, 8 Oct 2016 14:05:50 +0000"  >&lt;p&gt;Still happens in the current master/2.0&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; spark.range(10).repartition(5).select(monotonicallyIncreasingId()).coalesce(1).show()
warning: there was one deprecation warning; re-run with -deprecation &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; details
+-----------------------------+
|monotonically_increasing_id()|
+-----------------------------+
|                            0|
|                            0|
|                            1|
|                            2|
|                            0|
|                            1|
|                            0|
|                            1|
|                            2|
|                            0|
+-----------------------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15560941" author="maropu" created="Mon, 10 Oct 2016 00:58:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt; What do u think the issue of this ticket should be fixed, or documented?&lt;/p&gt;</comment>
                            <comment id="15560991" author="gurwls223" created="Mon, 10 Oct 2016 01:36:42 +0000"  >&lt;p&gt;Thanks for pinging me!, in my personal opinion, we should document this first if we can have some concrete reasons that why it is virtually the limitation in the current implementation.&lt;br/&gt;
I haven&apos;t look into this but I &lt;b&gt;guess&lt;/b&gt; it can be documented as I &lt;b&gt;guess&lt;/b&gt; it seems pretty easy to reproduce but it seems not fixed for several months.&lt;br/&gt;
I &lt;b&gt;think&lt;/b&gt; (and as you already know) it is fine to submit a PR if we have a good reason to support the PR whether it is about documentation or the actual fix &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15561008" author="maropu" created="Mon, 10 Oct 2016 01:48:40 +0000"  >&lt;p&gt;yea, since this ticket is totally inactive for a while, I think it&apos;s okay to document this somewhere and close for now.&lt;/p&gt;</comment>
                            <comment id="15562887" author="kevinushey" created="Mon, 10 Oct 2016 17:25:30 +0000"  >&lt;p&gt;Am I correct to understand that I should simply expect `monotonicallyIncreasingId()` to &lt;em&gt;not&lt;/em&gt; produce monotonically increasing ids, sometimes?&lt;/p&gt;

&lt;p&gt;If this is the case, then how can one use this function safely?&lt;/p&gt;</comment>
                            <comment id="15564350" author="maropu" created="Tue, 11 Oct 2016 03:47:38 +0000"  >&lt;p&gt;Since coalesce() just after monotonicallyIncreasingId() breaks the semantics, it&apos;s okay not to do that.&lt;br/&gt;
For example, coalesce() before monotonicallyIncreasingId() is okay;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; spark.range(10).repartition(5).coalesce(1).select(monotonicallyIncreasingId()).show
warning: there was one deprecation warning; re-run with -deprecation &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; details
+-----------------------------+
|monotonically_increasing_id()|
+-----------------------------+
|                            0|
|                            1|
|                            2|
|                            3|
|                            4|
|                            5|
|                            6|
|                            7|
|                            8|
|                            9|
+-----------------------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15584761" author="mengxr" created="Tue, 18 Oct 2016 07:42:27 +0000"  >&lt;p&gt;This is a bigger issue. It would happen with (`monotonically_increasing_id`, `rand`, `randn`, etc) x (`coalesce`, `union`, etc). The root cause is that the partition ID used to initialize the operator is not the partition ID associated with the DataFrame where the column was originally defined, which is expected by users.&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rxin%40databricks.com&quot; class=&quot;user-hover&quot; rel=&quot;rxin@databricks.com&quot;&gt;rxin@databricks.com&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;yhuai&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15591397" author="apachespark" created="Thu, 20 Oct 2016 10:02:06 +0000"  >&lt;p&gt;User &apos;mengxr&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15567&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15567&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15631653" author="apachespark" created="Thu, 3 Nov 2016 05:26:03 +0000"  >&lt;p&gt;User &apos;felixcheung&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15747&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15747&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15884486" author="everett" created="Sun, 26 Feb 2017 01:38:25 +0000"  >&lt;p&gt;Appears this also happens in 2.0.2.&lt;/p&gt;

&lt;p&gt;Thanks for fixing this!&lt;/p&gt;

&lt;p&gt;I disagree that monotonically_increasing_id function should ever be allowed to create duplicate values in a table given its documentation is &quot;The generated ID is guaranteed to be monotonically increasing and unique, but not consecutive.&quot; &lt;/p&gt;

&lt;p&gt;We were certainly relying on it to produce unique values!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12954291">SPARK-14241</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 38 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vmxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12335644">2.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>