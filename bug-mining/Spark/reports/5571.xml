<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:58:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-23240] PythonWorkerFactory issues unhelpful message when pyspark.daemon produces bogus stdout</title>
                <link>https://issues.apache.org/jira/browse/SPARK-23240</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Environmental issues or site-local customizations (i.e., sitecustomize.py present in the python install directory) can interfere with daemon.py&#8217;s output to stdout. PythonWorkerFactory produces unhelpful messages when this happens, causing some head scratching before the actual issue is determined.&lt;/p&gt;

&lt;p&gt;Case #1: Extraneous data in pyspark.daemon&#8217;s stdout. In this case, PythonWorkerFactory uses the output as the daemon&#8217;s port number and ends up throwing an exception when creating the socket:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IllegalArgumentException: port out of range:1819239265
	at java.net.InetSocketAddress.checkPort(InetSocketAddress.java:143)
	at java.net.InetSocketAddress.&amp;lt;init&amp;gt;(InetSocketAddress.java:188)
	at java.net.Socket.&amp;lt;init&amp;gt;(Socket.java:244)
	at org.apache.spark.api.python.PythonWorkerFactory.createSocket$1(PythonWorkerFactory.scala:78)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Case #2: No data in pyspark.daemon&#8217;s stdout. In this case, PythonWorkerFactory throws an EOFException exception reading the from the Process input stream.&lt;/p&gt;

&lt;p&gt;The second case is somewhat less mysterious&#160;than the first, because PythonWorkerFactory also displays the stderr from the python process.&lt;/p&gt;

&lt;p&gt;When there is unexpected or missing output in pyspark.daemon&#8217;s stdout, PythonWorkerFactory should say so.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13134095">SPARK-23240</key>
            <summary>PythonWorkerFactory issues unhelpful message when pyspark.daemon produces bogus stdout</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bersprockets">Bruce Robbins</assignee>
                                    <reporter username="bersprockets">Bruce Robbins</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Jan 2018 20:03:59 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:49 +0000</updated>
                            <resolved>Tue, 20 Feb 2018 11:26:57 +0000</resolved>
                                    <version>2.2.1</version>
                                    <fixVersion>2.4.0</fixVersion>
                                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16341609" author="bersprockets" created="Fri, 26 Jan 2018 21:16:05 +0000"  >&lt;p&gt;I will be making a pull request.&lt;/p&gt;</comment>
                            <comment id="16342432" author="gurwls223" created="Sun, 28 Jan 2018 04:37:52 +0000"  >&lt;p&gt;Actually &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bersprockets&quot; class=&quot;user-hover&quot; rel=&quot;bersprockets&quot;&gt;bersprockets&lt;/a&gt;, now there is a workaround for a custom fix within daemon and worker - &lt;a href=&quot;https://github.com/apache/spark/pull/20151&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20151&lt;/a&gt; from 2.4.0.&lt;/p&gt;</comment>
                            <comment id="16342688" author="bersprockets" created="Sun, 28 Jan 2018 19:38:48 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I am not sure this update covers the case where python site-local customizations puts arbitrary data into stdout before the daemon module (whatever it is) is able to&#160;put a&#160;port number into stdout. What happens in that case is that PythonWorkerFactory ends up reading the arbitrary data as the port number, since it exists in the python process&apos;s stdout ahead of the actual port number. My proposed pull request will not fix that, but it will produce an error message that will&#160;explicitly implicate the daemon&apos;s python process as the source&#160;of the bad port number.&lt;/p&gt;</comment>
                            <comment id="16343792" author="apachespark" created="Mon, 29 Jan 2018 18:40:03 +0000"  >&lt;p&gt;User &apos;bersprockets&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/20424&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20424&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16353945" author="apachespark" created="Tue, 6 Feb 2018 14:38:03 +0000"  >&lt;p&gt;User &apos;bersprockets&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/20519&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20519&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16359568" author="bersprockets" created="Sat, 10 Feb 2018 18:26:46 +0000"  >&lt;p&gt;A little background. A Spark installation had a Python sitecustomize.py like this:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;:
&#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; flotilla
 except ImportError as e:
&#160; &#160;print e&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;(flotilla is not the real python module, I just use that as an example).&lt;/p&gt;

&lt;p&gt;Because flotilla was not installed on the user&apos;s cluster, the first output in daemon&apos;s stdout was:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;No module named flotilla&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In fact, this is what I get when I run pyspark.daemon with this sitecustomize.py installed:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;bash-3.2$ python -m pyspark.daemon
python -m pyspark.daemon
No module named flotilla
^@^@\325&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Therefore,&#160;PythonWorkerFactory.startDaemon reads&#160;&apos;No m&apos;, or 0x4e6f206d or 1315905645, as the port number.&lt;/p&gt;

&lt;p&gt;Here&apos;s what happens when I run a pyspark action with the above sitecustomize.py installed:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;gt;&amp;gt;&amp;gt; text_file = sc.textFile(&quot;/Users/bruce/ncdc_gsod&quot;).count()
odule named flotilla
18/02/10 09:44:27 ERROR Executor: Exception in task 1.0 in stage 0.0 (TID 1)
java.lang.IllegalArgumentException: port out of range:1315905645
 at java.net.InetSocketAddress.checkPort(InetSocketAddress.java:143)
 at java.net.InetSocketAddress.&amp;lt;init&amp;gt;(InetSocketAddress.java:188)
 at java.net.Socket.&amp;lt;init&amp;gt;(Socket.java:244)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;




&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16369954" author="gurwls223" created="Tue, 20 Feb 2018 11:26:57 +0000"  >&lt;p&gt;Issue resolved by pull request 20424&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/20424&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20424&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3pfdb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>