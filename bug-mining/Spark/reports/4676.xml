<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:52:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-20017] Functions &quot;str_to_map&quot; and &quot;explode&quot; throws NPE exceptioin</title>
                <link>https://issues.apache.org/jira/browse/SPARK-20017</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;```&lt;br/&gt;
val sqlDf = spark.sql(&quot;select k,v from (select str_to_map(&apos;&apos;) as map_col from range(2)) tbl lateral view explode(map_col) as k,v&quot;)&lt;/p&gt;

&lt;p&gt;sqlDf.show&lt;br/&gt;
```&lt;/p&gt;

&lt;p&gt;The sql throws NPE exception.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13057341">SPARK-20017</key>
            <summary>Functions &quot;str_to_map&quot; and &quot;explode&quot; throws NPE exceptioin</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roncen_zhao">roncenzhao</assignee>
                                    <reporter username="roncenzhao">roncenzhao</reporter>
                        <labels>
                    </labels>
                <created>Sun, 19 Mar 2017 13:38:59 +0000</created>
                <updated>Tue, 21 Mar 2017 18:34:48 +0000</updated>
                            <resolved>Tue, 21 Mar 2017 18:34:18 +0000</resolved>
                                    <version>2.1.0</version>
                                    <fixVersion>2.1.1</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15931691" author="roncenzhao" created="Sun, 19 Mar 2017 13:45:32 +0000"  >&lt;p&gt;The root cause of this exception is:&lt;br/&gt;
The `StringToMap`&apos;s `dataType` is `MapType(StringType, StringType, valueContainsNull = false)` and the result of `str_to_map(&apos;&apos;)` is `&quot;&quot; -&amp;gt; null`, so in the function `explode`, it will throw NPE exception.&lt;/p&gt;

&lt;p&gt;I think we should change the `dataType` of `StringToMap` to `MapType(StringType, StringType)`, the default value of `valueContainsNull` is `true`.&lt;/p&gt;</comment>
                            <comment id="15931749" author="maropu" created="Sun, 19 Mar 2017 15:39:03 +0000"  >&lt;p&gt;Ah, as you explained, the nullability is wrong in StringToMap; it could output null&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT str_to_map(&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;)&quot;&lt;/span&gt;).show
+-------------------+
|str_to_map(1, ,, :)|
+-------------------+
|     Map(1 -&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)|
+-------------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Could you make a pr for this fix?&lt;/p&gt;</comment>
                            <comment id="15931769" author="apachespark" created="Sun, 19 Mar 2017 16:07:03 +0000"  >&lt;p&gt;User &apos;zhaorongsheng&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17350&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17350&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15931776" author="roncenzhao" created="Sun, 19 Mar 2017 16:10:27 +0000"  >&lt;p&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maropu&quot; class=&quot;user-hover&quot; rel=&quot;maropu&quot;&gt;maropu&lt;/a&gt; Please check it, Thanks~&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12859457" name="screenshot-1.png" size="248318" author="roncenzhao" created="Sun, 19 Mar 2017 13:40:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 35 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3chfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12338779">2.1.1</customfieldvalue>
    <customfieldvalue id="12338275">2.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>