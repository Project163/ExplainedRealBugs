<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:21:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-4465] runAsSparkUser doesn&apos;t affect TaskRunner in Mesos environment at all.</title>
                <link>https://issues.apache.org/jira/browse/SPARK-4465</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;runAsSparkUser enable classes using hadoop library to change an active user to spark User, however in Mesos environment, because the function calls before running within JNI, runAsSparkUser doesn&apos;t affect anything, and meaningless code. fix the Appropriate scope of function and remove meaningless code. That&apos;s a bug because of running program incorrectly. That&apos;s related to &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-3223&quot; title=&quot;runAsSparkUser cannot change HDFS write permission properly in mesos cluster mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-3223&quot;&gt;&lt;del&gt;SPARK-3223&lt;/del&gt;&lt;/a&gt; but setting framework user is not perfect solution in my tests.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12755989">SPARK-4465</key>
            <summary>runAsSparkUser doesn&apos;t affect TaskRunner in Mesos environment at all.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jongyoul">Jongyoul Lee</assignee>
                                    <reporter username="jongyoul">Jongyoul Lee</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Nov 2014 01:29:23 +0000</created>
                <updated>Mon, 5 Jan 2015 20:06:09 +0000</updated>
                            <resolved>Mon, 5 Jan 2015 20:05:59 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.2.1</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                    <component>Deploy</component>
                    <component>Input/Output</component>
                    <component>Mesos</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14253059" author="jongyoul" created="Fri, 19 Dec 2014 06:44:10 +0000"  >&lt;p&gt;I&apos;ve dug into mesos code and jni and java.security which is used by UserGroupInformation in runAsSparkUser. Finally I&apos;ve found an exact wrong point of MesosExecutorBackend, these are about java.security scope and how mesos c++ executor works. Unlike to standalone and yarn, in a task under mesos cluster, jni runs each task in a native method via callback. There are several problems about running java code under jni environment, especially it&apos;s not covered by java.security. JDK spec warn the following&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Some important points about being privileged: Firstly, this concept only exists within a single thread. As soon as the privileged code completes, the privilege is guaranteed to be erased or revoked.&lt;br/&gt;
&amp;#8211; &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/technotes/guides/security/spec/security-spec.doc4.html#20573&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/javase/7/docs/technotes/guides/security/spec/security-spec.doc4.html#20573&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;MesosExecutorBackend.scala&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    SparkHadoopUtil.get.runAsSparkUser { () =&amp;gt;
        MesosNativeLibrary.load()
        &lt;span class=&quot;code-comment&quot;&gt;// Create a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Executor and start it running
&lt;/span&gt;        val runner = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MesosExecutorBackend()
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MesosExecutorDriver(runner).run()
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Show that code. Only run() method is only covered by runAsSparkUser, however, the actual code running tasks is not covered by runAsSparkUser. As a result, MesosExecutorBackend.launchTask doesn&apos;t affect by runAsSparkUser.&lt;/p&gt;

&lt;p&gt;I&apos;ll fix that bug by adding runAsSparkUser into MesosExecutorBackend.launchTask rather and adding them into Executor.launchTask, because Executor.launchTask is already covered in case of standalone and yarn. Thus I judged that code is exact point of fix that bug.&lt;/p&gt;</comment>
                            <comment id="14253082" author="apachespark" created="Fri, 19 Dec 2014 07:09:35 +0000"  >&lt;p&gt;User &apos;jongyoul&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/3741&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3741&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14265023" author="joshrosen" created="Mon, 5 Jan 2015 20:05:59 +0000"  >&lt;p&gt;Issue resolved by pull request 3741&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/3741&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3741&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 46 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22hk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>