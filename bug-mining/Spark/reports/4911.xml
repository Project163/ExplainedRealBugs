<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:53:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-14408] Update RDD.treeAggregate not to use reduce</title>
                <link>https://issues.apache.org/jira/browse/SPARK-14408</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;*&lt;b&gt;Issue&lt;/b&gt;*&lt;br/&gt;
In MLlib, we have assumed that &lt;tt&gt;RDD.treeAggregate&lt;/tt&gt; allows the &lt;tt&gt;seqOp&lt;/tt&gt; and &lt;tt&gt;combOp&lt;/tt&gt; functions to modify and return their first argument, just like &lt;tt&gt;RDD.aggregate&lt;/tt&gt;.  However, it is not documented that way.&lt;/p&gt;

&lt;p&gt;I started to add docs to this effect, but then noticed that &lt;tt&gt;treeAggregate&lt;/tt&gt; uses &lt;tt&gt;reduceByKey&lt;/tt&gt; and &lt;tt&gt;reduce&lt;/tt&gt; in its implementation, neither of which technically allows the seq/combOps to modify and return their first arguments.&lt;/p&gt;

&lt;p&gt;*&lt;b&gt;Question&lt;/b&gt;*: Is the implementation safe, or does it need to be updated?&lt;/p&gt;

&lt;p&gt;*&lt;b&gt;Decision&lt;/b&gt;*: Avoid using reduce.  Use fold instead.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12956227">SPARK-14408</key>
            <summary>Update RDD.treeAggregate not to use reduce</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="josephkb">Joseph K. Bradley</assignee>
                                    <reporter username="josephkb">Joseph K. Bradley</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Apr 2016 18:03:01 +0000</created>
                <updated>Fri, 9 Jun 2017 07:53:38 +0000</updated>
                            <resolved>Fri, 9 Jun 2017 07:53:38 +0000</resolved>
                                                    <fixVersion>2.3.0</fixVersion>
                                    <component>ML</component>
                    <component>MLlib</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15226944" author="srowen" created="Tue, 5 Apr 2016 19:13:04 +0000"  >&lt;p&gt;Is it right-er to use the fold methods? I had thought this was one of the key differences, yes, that the fold methods were definitely allowed to modify their first args. In practice, it might happen to be fine for reduce too.&lt;/p&gt;</comment>
                            <comment id="15227090" author="josephkb" created="Tue, 5 Apr 2016 20:36:30 +0000"  >&lt;p&gt;fold seems better to me.  PairRDDFunctions.foldByKey does not explicitly say the function can modify the first argument, but comparing its implementation with aggregateByKey, I would guess it is fine.  What do you think?&lt;/p&gt;

&lt;p&gt;RDD.fold should be fine, based on its docs.&lt;/p&gt;

&lt;p&gt;This seems like a difficult thing to cover in unit tests...&lt;/p&gt;</comment>
                            <comment id="15227110" author="srowen" created="Tue, 5 Apr 2016 20:46:06 +0000"  >&lt;p&gt;Yeah it&apos;s right-er at least. There&apos;s a test for foldByKey with a mutable type: &quot;foldByKey with mutable result type&quot;, though maybe it could be tweaked to use multiple partitions explicitly. I suppose you could assert this explicitly in the docs since apparently it&apos;s tested for.&lt;/p&gt;</comment>
                            <comment id="15229090" author="apachespark" created="Wed, 6 Apr 2016 20:58:04 +0000"  >&lt;p&gt;User &apos;jkbradley&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/12217&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12217&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15230994" author="josephkb" created="Thu, 7 Apr 2016 20:26:49 +0000"  >&lt;p&gt;After a bit of a scare (b/c of the confounding issue of StandardScaler not matching sklearn), it&apos;s definitely an issue with my initial PR to &quot;fix&quot; treeAggregate&apos;s implementation.  That said, I&apos;m still having a hard time figuring out the right way to fix the implementation.  I&apos;ll comment more on the PR.&lt;/p&gt;</comment>
                            <comment id="15231097" author="josephkb" created="Thu, 7 Apr 2016 21:22:24 +0000"  >&lt;p&gt;Note on StandardScaler: MLlib&apos;s StandardScaler uses the unbiased sample std to rescale, whereas sklearn uses the biased sample std.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;http://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;sklearn.preprocessing.StandardScaler &lt;/a&gt; uses biased sample std.  R&apos;s &lt;a href=&quot;https://stat.ethz.ch/R-manual/R-devel/library/base/html/scale.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;scale package &lt;/a&gt; uses the unbiased sample std.  I&apos;m used to seeing the biased sample std used in ML, probably because it is handy for proofs to know columns have L2 norm 1.&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mengxr&quot; class=&quot;user-hover&quot; rel=&quot;mengxr&quot;&gt;mengxr&lt;/a&gt; reports that glmnet uses the biased sample std.&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Q&lt;/b&gt;: Should we change StandardScaler to use unbiased sample std?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15231871" author="dbtsai" created="Fri, 8 Apr 2016 08:35:35 +0000"  >&lt;p&gt;I remember that when we implemented the scaler, we had similar discussion. We ended up following R&apos;s scale package which is unbiased std. How about we add extra flag to StandardScaler to make it biased but default to unbiased? &lt;/p&gt;

&lt;p&gt;I remember that when I implemented LOR/LiR in Spark, there are packages in R using unbiased std to scale the features, and most of the time, when the # of samples are huge, this will not be a concern. So I ended up just using the standard scaler in mllib.&lt;/p&gt;</comment>
                            <comment id="16036516" author="apachespark" created="Mon, 5 Jun 2017 04:31:03 +0000"  >&lt;p&gt;User &apos;HyukjinKwon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18198&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16044108" author="srowen" created="Fri, 9 Jun 2017 07:53:38 +0000"  >&lt;p&gt;Issue resolved by pull request 18198&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18198&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 23 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vobj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>