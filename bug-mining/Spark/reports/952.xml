<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:19:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-4077] A broken string timestamp value can Spark SQL return wrong values for valid string timestamp values</title>
                <link>https://issues.apache.org/jira/browse/SPARK-4077</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The following case returns wrong results.&lt;br/&gt;
The text file is &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2014-12-11 00:00:00,1
2014-12-11astring00:00:00,2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The DDL statement and the query are shown below...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sql(&quot;&quot;&quot;
create external table date_test(my_date timestamp, id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)
row format delimited
fields terminated by &lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt;
lines terminated by &lt;span class=&quot;code-quote&quot;&gt;&apos;\n&apos;&lt;/span&gt;
LOCATION &lt;span class=&quot;code-quote&quot;&gt;&apos;dateTest&apos;&lt;/span&gt;
&quot;&quot;&quot;)
sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select * from date_test&quot;&lt;/span&gt;).collect.foreach(println)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The result is &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[1969-12-31 19:00:00.0,1]
[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,2]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I change the data to &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2014-12-11 00:00:00,1
2014-12-11 00:00:00,2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The result is fine.&lt;/p&gt;

&lt;p&gt;For the data with broken string timestamp value, I tried runSqlHive. The result is fine.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12750361">SPARK-4077</key>
            <summary>A broken string timestamp value can Spark SQL return wrong values for valid string timestamp values</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gvramana">Venkata Gollamudi</assignee>
                                    <reporter username="yhuai">Yin Huai</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Oct 2014 14:37:17 +0000</created>
                <updated>Fri, 31 Oct 2014 18:30:44 +0000</updated>
                            <resolved>Fri, 31 Oct 2014 18:30:44 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14190020" author="gvramana" created="Thu, 30 Oct 2014 13:02:34 +0000"  >&lt;p&gt;In org.apache.hadoop.hive.serde2.io.TimestampWritable.set , if the next entry is null then current time stamp object is being reset. &lt;br/&gt;
Not sure why it is done like that in hive. We also can raise a bug in hive.&lt;/p&gt;

&lt;p&gt;However because of this hiveinspectors:unwrap cannot use the same timestamp object without creating a copy. &lt;/p&gt;</comment>
                            <comment id="14190531" author="yhuai" created="Thu, 30 Oct 2014 18:17:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gvramana&quot; class=&quot;user-hover&quot; rel=&quot;gvramana&quot;&gt;gvramana&lt;/a&gt; Thank you for looking at it. Seems for text source, Hive use LazyTimestamp to deserialize the value and set it to TimestampWriteable. So, this issue only affects text sources, right?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hive/blob/trunk/serde/src/java/org/apache/hadoop/hive/serde2/io/TimestampWritable.java#L130&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;The code&lt;/a&gt; mentioned by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gvramana&quot; class=&quot;user-hover&quot; rel=&quot;gvramana&quot;&gt;gvramana&lt;/a&gt; is shown as follows.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void set(Timestamp t) {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (t == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    timestamp.setTime(0);
    timestamp.setNanos(0);
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
  }
  &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.timestamp = t;
  bytesEmpty = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
  timestampEmpty = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;btw, why the result of runSqlHive(ask hive to run the query) is not affected?&lt;/p&gt;</comment>
                            <comment id="14190533" author="apachespark" created="Thu, 30 Oct 2014 18:19:09 +0000"  >&lt;p&gt;User &apos;gvramana&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/3019&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3019&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14191299" author="gvramana" created="Fri, 31 Oct 2014 03:53:38 +0000"  >&lt;p&gt;I could not find this behaviour for non text source.&lt;br/&gt;
I case of runSqlHive it is serializing row by row, so this problem will not be visible.&lt;br/&gt;
org.apache.hadoop.hive.ql.exec.FetchTask.fetch&lt;/p&gt;</comment>
                            <comment id="14192211" author="marmbrus" created="Fri, 31 Oct 2014 18:30:44 +0000"  >&lt;p&gt;Issue resolved by pull request 3019&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/3019&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3019&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 3 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21jof:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>