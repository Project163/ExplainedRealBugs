<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:21:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-4814] Enable assertions in SBT, Maven tests / AssertionError from Hive&apos;s LazyBinaryInteger</title>
                <link>https://issues.apache.org/jira/browse/SPARK-4814</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Follow up to &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-4159&quot; title=&quot;Maven build doesn&amp;#39;t run JUnit test suites&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-4159&quot;&gt;&lt;del&gt;SPARK-4159&lt;/del&gt;&lt;/a&gt;, wherein we noticed that Java tests weren&apos;t running in Maven, in part because a Java test actually fails with &lt;tt&gt;AssertionError&lt;/tt&gt;. That code/test was fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-4850&quot; title=&quot;&amp;quot;GROUP BY&amp;quot; can&amp;#39;t work if the schema of SchemaRDD contains struct or array type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-4850&quot;&gt;&lt;del&gt;SPARK-4850&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The reason it wasn&apos;t caught by SBT tests was that they don&apos;t run with assertions on, and Maven&apos;s surefire does.&lt;/p&gt;

&lt;p&gt;Turning on assertions in the SBT build is trivial, adding one line:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    javaOptions in Test += &lt;span class=&quot;code-quote&quot;&gt;&quot;-ea&quot;&lt;/span&gt;,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This reveals a test failure in Scala test suites though:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[info] - alter_merge_2 *** FAILED *** (1 second, 305 milliseconds)
[info]   Failed to execute query using catalyst:
[info]   Error: Job aborted due to stage failure: Task 1 in stage 551.0 failed 1 times, most recent failure: Lost task 1.0 in stage 551.0 (TID 1532, localhost): java.lang.AssertionError
[info]   	at org.apache.hadoop.hive.serde2.lazybinary.LazyBinaryInteger.init(LazyBinaryInteger.java:51)
[info]   	at org.apache.hadoop.hive.serde2.columnar.ColumnarStructBase$FieldInfo.uncheckedGetField(ColumnarStructBase.java:110)
[info]   	at org.apache.hadoop.hive.serde2.columnar.ColumnarStructBase.getField(ColumnarStructBase.java:171)
[info]   	at org.apache.hadoop.hive.serde2.objectinspector.ColumnarStructObjectInspector.getStructFieldData(ColumnarStructObjectInspector.java:166)
[info]   	at org.apache.spark.sql.hive.HadoopTableReader$$anonfun$fillObject$1.apply(TableReader.scala:318)
[info]   	at org.apache.spark.sql.hive.HadoopTableReader$$anonfun$fillObject$1.apply(TableReader.scala:314)
[info]   	at scala.collection.Iterator$$anon$11.next(Iterator.scala:328)
[info]   	at org.apache.spark.sql.execution.Aggregate$$anonfun$execute$1$$anonfun$6.apply(Aggregate.scala:132)
[info]   	at org.apache.spark.sql.execution.Aggregate$$anonfun$execute$1$$anonfun$6.apply(Aggregate.scala:128)
[info]   	at org.apache.spark.rdd.RDD$$anonfun$13.apply(RDD.scala:615)
[info]   	at org.apache.spark.rdd.RDD$$anonfun$13.apply(RDD.scala:615)
[info]   	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:35)
[info]   	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:264)
[info]   	at org.apache.spark.rdd.RDD.iterator(RDD.scala:231)
[info]   	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:35)
[info]   	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:264)
[info]   	at org.apache.spark.rdd.RDD.iterator(RDD.scala:231)
[info]   	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:68)
[info]   	at org.apache.spark.scheduler.ShuffleMapTask.runTask(ShuffleMapTask.scala:41)
[info]   	at org.apache.spark.scheduler.Task.run(Task.scala:56)
[info]   	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:195)
[info]   	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
[info]   	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
[info]   	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The items for this JIRA are therefore:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Enable assertions in SBT&lt;/li&gt;
	&lt;li&gt;Fix this failure&lt;/li&gt;
	&lt;li&gt;Figure out why Maven scalatest didn&apos;t trigger it - may need assertions explicitly turned on too.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12760689">SPARK-4814</key>
            <summary>Enable assertions in SBT, Maven tests / AssertionError from Hive&apos;s LazyBinaryInteger</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean R. Owen</assignee>
                                    <reporter username="srowen">Sean R. Owen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Dec 2014 09:42:41 +0000</created>
                <updated>Tue, 24 Mar 2015 10:23:17 +0000</updated>
                            <resolved>Tue, 24 Mar 2015 10:23:08 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.1.2</fixVersion>
                    <fixVersion>1.2.2</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                    <component>Spark Core</component>
                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14241179" author="srowen" created="Wed, 10 Dec 2014 14:52:20 +0000"  >&lt;p&gt;CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lian+cheng&quot; class=&quot;user-hover&quot; rel=&quot;lian cheng&quot;&gt;lian cheng&lt;/a&gt; as someone who might understand the &lt;tt&gt;AssertionError&lt;/tt&gt; above. It&apos;s coming from Hive and I don&apos;t know if it&apos;s anything we are doing wrong. But unfortunately the test fails when assertions are on as a result of this. The changes to enable assertions themselves are trivial.&lt;/p&gt;</comment>
                            <comment id="14241983" author="lian cheng" created="Thu, 11 Dec 2014 01:49:20 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt;! I&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="14242030" author="marmbrus" created="Thu, 11 Dec 2014 02:31:08 +0000"  >&lt;p&gt;Hive throws a lot of warning here for some reason even when reading data from their own test files.  One option here would be to just override the configuration only for the hive subproject.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// Hive &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; assertion errors &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; tests that pass.
&lt;/span&gt;javaOptions in Test := (javaOptions in Test).value.filterNot(_ == &lt;span class=&quot;code-quote&quot;&gt;&quot;-ea&quot;&lt;/span&gt;),
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14242611" author="lian cheng" created="Thu, 11 Dec 2014 14:38:06 +0000"  >&lt;p&gt;This assertion failure seems to be related to details of the RCFile format. I haven&apos;t found the root cause. Tested the original &lt;tt&gt;alter_merge_2.q&lt;/tt&gt; test case under Hive 0.13.1 by running&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ cd itest/qtest
$ mvn -Dtest=TestCliDriver -Phadoop-2 -Dqfile=alter_merge_2.q test
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; didn&apos;t observe similar &lt;tt&gt;AssertionError&lt;/tt&gt;. Keep digging. Although in this case the assertion failure doesn&apos;t affect correctness, I&apos;m not sure whether it&apos;s generally safe to ignore it...&lt;/p&gt;</comment>
                            <comment id="14246024" author="marmbrus" created="Sun, 14 Dec 2014 18:03:58 +0000"  >&lt;p&gt;Either way, I don&apos;t think we should block turning on assertions for the rest of Spark.&lt;/p&gt;</comment>
                            <comment id="14246135" author="apachespark" created="Sun, 14 Dec 2014 21:28:27 +0000"  >&lt;p&gt;User &apos;srowen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/3692&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3692&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14247557" author="joshrosen" created="Tue, 16 Dec 2014 01:18:01 +0000"  >&lt;p&gt;Alright, I&apos;ve merged Sean&apos;s PR into master, branch-1.2, and branch-1.1.  There&apos;s a large-ish merge conflict that we&apos;ll have to fix to get this into branch-1.0 (or I can just manually fix things up there).  Tagging this as &lt;tt&gt;backport-needed&lt;/tt&gt; so I remember to come back and do that.&lt;/p&gt;</comment>
                            <comment id="14340275" author="srowen" created="Fri, 27 Feb 2015 15:29:54 +0000"  >&lt;p&gt;General question on back-ports: at this stage, is it realistic to expect another 0.9.x release? 1.0.x? 1.1.x? That is I&apos;m wondering if something marked for back-port for 0.9, 1.0, 1.1 can be simply resolved now or not.&lt;/p&gt;</comment>
                            <comment id="14377614" author="srowen" created="Tue, 24 Mar 2015 10:23:08 +0000"  >&lt;p&gt;Provisionally deciding that it&apos;s not worth back-porting to 1.0.x at this stage, now 3 minor versions behind.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12751815">SPARK-4159</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 35 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i239of:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>