<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:28:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-8368] ClassNotFoundException in closure for map </title>
                <link>https://issues.apache.org/jira/browse/SPARK-8368</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;After upgraded the cluster from spark 1.3.0 to 1.4.0(rc4), I encountered the following exception:&lt;br/&gt;
======begin exception========&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Exception in thread &quot;main&quot; java.lang.ClassNotFoundException: com.yhd.ycache.magic.Model$$anonfun$9$$anonfun$10&lt;br/&gt;
	at java.net.URLClassLoader$1.run(URLClassLoader.java:366)&lt;br/&gt;
	at java.net.URLClassLoader$1.run(URLClassLoader.java:355)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at java.net.URLClassLoader.findClass(URLClassLoader.java:354)&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:425)&lt;br/&gt;
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:358)&lt;br/&gt;
	at java.lang.Class.forName0(Native Method)&lt;br/&gt;
	at java.lang.Class.forName(Class.java:278)&lt;br/&gt;
	at org.apache.spark.util.InnerClosureFinder$$anon$4.visitMethodInsn(ClosureCleaner.scala:455)&lt;br/&gt;
	at com.esotericsoftware.reflectasm.shaded.org.objectweb.asm.ClassReader.accept(Unknown Source)&lt;br/&gt;
	at com.esotericsoftware.reflectasm.shaded.org.objectweb.asm.ClassReader.accept(Unknown Source)&lt;br/&gt;
	at org.apache.spark.util.ClosureCleaner$.getInnerClosureClasses(ClosureCleaner.scala:101)&lt;br/&gt;
	at org.apache.spark.util.ClosureCleaner$.org$apache$spark$util$ClosureCleaner$$clean(ClosureCleaner.scala:197)&lt;br/&gt;
	at org.apache.spark.util.ClosureCleaner$.clean(ClosureCleaner.scala:132)&lt;br/&gt;
	at org.apache.spark.SparkContext.clean(SparkContext.scala:1891)&lt;br/&gt;
	at org.apache.spark.rdd.RDD$$anonfun$map$1.apply(RDD.scala:294)&lt;br/&gt;
	at org.apache.spark.rdd.RDD$$anonfun$map$1.apply(RDD.scala:293)&lt;br/&gt;
	at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:148)&lt;br/&gt;
	at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:109)&lt;br/&gt;
	at org.apache.spark.rdd.RDD.withScope(RDD.scala:286)&lt;br/&gt;
	at org.apache.spark.rdd.RDD.map(RDD.scala:293)&lt;br/&gt;
	at org.apache.spark.sql.DataFrame.map(DataFrame.scala:1210)&lt;br/&gt;
	at com.yhd.ycache.magic.Model$.main(SSExample.scala:239)&lt;br/&gt;
	at com.yhd.ycache.magic.Model.main(SSExample.scala)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:606)&lt;br/&gt;
	at org.apache.spark.deploy.SparkSubmit$.org$apache$spark$deploy$SparkSubmit$$runMain(SparkSubmit.scala:664)&lt;br/&gt;
	at org.apache.spark.deploy.SparkSubmit$.doRunMain$1(SparkSubmit.scala:169)&lt;br/&gt;
	at org.apache.spark.deploy.SparkSubmit$.submit(SparkSubmit.scala:192)&lt;br/&gt;
	at org.apache.spark.deploy.SparkSubmit$.main(SparkSubmit.scala:111)&lt;br/&gt;
	at org.apache.spark.deploy.SparkSubmit.main(SparkSubmit.scala)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;===============end exception===========&lt;/p&gt;

&lt;p&gt;I simplify the code that cause this issue, as following:&lt;br/&gt;
==========begin code==================&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;object Model extends Serializable{
  def main(args: Array[String]) {
    val Array(sql) = args
    val sparkConf = new SparkConf().setAppName(&quot;Mode Example&quot;)
    val sc = new SparkContext(sparkConf)
    val hive = new HiveContext(sc)
    //get data by hive sql
    val rows = hive.sql(sql)

    val data = rows.map(r =&amp;gt; { 
      val arr = r.toSeq.toArray
      val label = 1.0
      def fmap = ( input: Any ) =&amp;gt; 1.0
      val feature = arr.map(_=&amp;gt;1.0)
      LabeledPoint(label, Vectors.dense(feature))
    })

    data.count()
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;=====end code===========&lt;br/&gt;
This code can run pretty well on spark-shell, but error when submit it to spark cluster (standalone or local mode).  I try the same code on spark 1.3.0(local mode), and no exception is encountered.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Centos 6.5, java 1.7.0_67, scala 2.10.4. Build the project on Windows 7 and run in a spark standalone cluster(or local) mode on Centos 6.X. &lt;/p&gt;</environment>
        <key id="12837737">SPARK-8368</key>
            <summary>ClassNotFoundException in closure for map </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yhuai">Yin Huai</assignee>
                                    <reporter username="zwChan">CHEN Zhiwei</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Jun 2015 02:47:41 +0000</created>
                <updated>Thu, 1 Sep 2016 12:24:23 +0000</updated>
                            <resolved>Fri, 19 Jun 2015 18:13:59 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.4.1</fixVersion>
                    <fixVersion>1.5.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14587459" author="yhuai" created="Tue, 16 Jun 2015 04:35:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zwChan&quot; class=&quot;user-hover&quot; rel=&quot;zwChan&quot;&gt;zwChan&lt;/a&gt; How was the application submitted?&lt;/p&gt;</comment>
                            <comment id="14587685" author="zwchan" created="Tue, 16 Jun 2015 08:37:59 +0000"  >&lt;p&gt;I have tried both local and standalone mode, and both with-dependency and without-dependency jar file. Use the following command:&lt;/p&gt;

&lt;p&gt;spark-submit --class com.yhd.ycache.magic.Model --jars ./SSExample-0.0.1-SNAPSHOT-jar-with-dependencies.jar  --master local ./SSExample-0.0.1-SNAPSHOT-jar-with-dependencies.jar &quot;sql statement&quot; &lt;/p&gt;

&lt;p&gt;BTW, the same code and submit command run on spark 1.3.0 without problem.&lt;/p&gt;</comment>
                            <comment id="14590072" author="yhuai" created="Wed, 17 Jun 2015 16:44:14 +0000"  >&lt;p&gt;Can you add &lt;tt&gt;--verbose&lt;/tt&gt; and post the extra information like &lt;tt&gt;Main class:&lt;/tt&gt; and &lt;tt&gt;Classpath elements:&lt;/tt&gt;? &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andrewor14&quot; class=&quot;user-hover&quot; rel=&quot;andrewor14&quot;&gt;andrewor14&lt;/a&gt; Have we changed any thing related to spark submit in 1.4.0?&lt;/p&gt;</comment>
                            <comment id="14590636" author="yhuai" created="Wed, 17 Jun 2015 21:27:34 +0000"  >&lt;p&gt;I have reproduced it. I am investigating it now.&lt;/p&gt;</comment>
                            <comment id="14590731" author="yhuai" created="Wed, 17 Jun 2015 22:19:36 +0000"  >&lt;p&gt;Right now, looks like it is a problem caused by spark sql&apos;s isolated class loader.&lt;/p&gt;</comment>
                            <comment id="14591129" author="zwchan" created="Thu, 18 Jun 2015 02:12:32 +0000"  >&lt;p&gt;Great! &lt;br/&gt;
I am not familiar to the class loader, and hope for good news from you. If there is anything I can help, please tell me without hesitation.&lt;/p&gt;</comment>
                            <comment id="14591154" author="yhuai" created="Thu, 18 Jun 2015 02:49:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zwChan&quot; class=&quot;user-hover&quot; rel=&quot;zwChan&quot;&gt;zwChan&lt;/a&gt; I have found the cause. Will have a fix soon. &lt;/p&gt;</comment>
                            <comment id="14591171" author="yhuai" created="Thu, 18 Jun 2015 03:13:56 +0000"  >&lt;p&gt;The cause of this problem is &lt;tt&gt;SessionState.setCurrentSessionState(executionHive.state)&lt;/tt&gt; called during the construction of &lt;tt&gt;HiveContext&lt;/tt&gt; will override the context class loader of the current thread by the class loader of associated with &lt;tt&gt;executionHive.state&lt;/tt&gt;. We need to correctly set the class loader of &lt;tt&gt;executionHive.state&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14592753" author="apachespark" created="Fri, 19 Jun 2015 00:00:07 +0000"  >&lt;p&gt;User &apos;yhuai&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/6891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/6891&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14592965" author="apachespark" created="Fri, 19 Jun 2015 03:44:06 +0000"  >&lt;p&gt;User &apos;yhuai&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/6895&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/6895&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14593726" author="marmbrus" created="Fri, 19 Jun 2015 18:13:59 +0000"  >&lt;p&gt;Issue resolved by pull request 6891&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/6891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/6891&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14596001" author="dondrake" created="Mon, 22 Jun 2015 14:42:41 +0000"  >&lt;p&gt;I&apos;ve verified through a nightly build that this resolves my issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-8365&quot; title=&quot;pyspark does not retain --packages or --jars passed on the command line as of 1.4.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-8365&quot;&gt;&lt;del&gt;SPARK-8365&lt;/del&gt;&lt;/a&gt;).  Thanks!&lt;/p&gt;</comment>
                            <comment id="14596016" author="yhuai" created="Mon, 22 Jun 2015 14:49:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dondrake&quot; class=&quot;user-hover&quot; rel=&quot;dondrake&quot;&gt;dondrake&lt;/a&gt; Great! Thanks for checking it.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12837716">SPARK-8365</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12839019">SPARK-8470</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 22 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2g14f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311620" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Shepherd</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>andrewor14</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332153">1.4.1</customfieldvalue>
    <customfieldvalue id="12332078">1.5.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>