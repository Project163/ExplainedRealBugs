<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:35:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-11788] Using java.sql.Timestamp and java.sql.Date in where clauses on JDBC dataframes causes SQLServerException</title>
                <link>https://issues.apache.org/jira/browse/SPARK-11788</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I have a MSSQL table that has a timestamp column and am reading it using DataFrameReader.jdbc. Adding a where clause which compares a timestamp range causes a SQLServerException.&lt;/p&gt;

&lt;p&gt;The problem is in &lt;a href=&quot;https://github.com/apache/spark/blob/master/sql/core/src/main/scala/org/apache/spark/sql/execution/datasources/jdbc/JDBCRDD.scala#L264&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/sql/core/src/main/scala/org/apache/spark/sql/execution/datasources/jdbc/JDBCRDD.scala#L264&lt;/a&gt; (compileValue) which should surround timestamps/dates with quotes (only does it for strings).&lt;/p&gt;

&lt;p&gt;Sample pseudo-code:&lt;br/&gt;
val beg = new java.sql.Timestamp(...)&lt;br/&gt;
val end = new java.sql.Timestamp(...)&lt;br/&gt;
val filtered = jdbcdf.where($&quot;TIMESTAMP_COLUMN&quot; &amp;gt;= beg &amp;amp;&amp;amp; $&quot;TIMESTAMP_COLUMN&quot; &amp;lt; end)&lt;/p&gt;

&lt;p&gt;Generated SQL query: &quot;TIMESTAMP_COLUMN &amp;gt;= 2015-01-01 00:00:00.0&quot;&lt;br/&gt;
Query should use quotes around timestamp: &quot;TIMESTAMP_COLUMN &amp;gt;= &apos;2015-01-01 00:00:00.0&apos;&quot;&lt;/p&gt;

&lt;p&gt;Fallback is to filter client-side which is extremely inefficient as the whole table needs to be downloaded to each Spark executor.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</description>
                <environment></environment>
        <key id="12913857">SPARK-11788</key>
            <summary>Using java.sql.Timestamp and java.sql.Date in where clauses on JDBC dataframes causes SQLServerException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="huaxingao">Huaxin Gao</assignee>
                                    <reporter username="doctapp">Martin Tapp</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Nov 2015 20:21:00 +0000</created>
                <updated>Tue, 11 Apr 2017 14:39:32 +0000</updated>
                            <resolved>Tue, 1 Dec 2015 23:33:30 +0000</resolved>
                                    <version>1.5.2</version>
                                    <fixVersion>1.5.3</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15009575" author="huaxing" created="Tue, 17 Nov 2015 21:35:50 +0000"  >&lt;p&gt;I would like to work on this problem. &lt;/p&gt;</comment>
                            <comment id="15018511" author="doctapp" created="Fri, 20 Nov 2015 18:52:57 +0000"  >&lt;p&gt;Any update, this seems like an easy fix?&lt;/p&gt;</comment>
                            <comment id="15018826" author="huaxing" created="Fri, 20 Nov 2015 21:20:12 +0000"  >&lt;p&gt;Hi Martin,&lt;br/&gt;
I will try to have a Pull Request soon. &lt;/p&gt;</comment>
                            <comment id="15018928" author="apachespark" created="Fri, 20 Nov 2015 22:27:02 +0000"  >&lt;p&gt;User &apos;huaxingao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9872&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9872&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15022200" author="doctapp" created="Mon, 23 Nov 2015 14:55:01 +0000"  >&lt;p&gt;Code must use timestampValue and dateValue instead of value.&lt;br/&gt;
Test case uses wrong year for timestamp and date between dataframe data and assert (year is offset by 1)&lt;/p&gt;</comment>
                            <comment id="15022775" author="huaxing" created="Mon, 23 Nov 2015 19:12:03 +0000"  >&lt;p&gt;I will change to timestampValue and dateValue.&lt;br/&gt;
In the test case, I intentionally make the date and timestamp 1 year less than the value in the table because I am using &amp;gt; &lt;br/&gt;
$&quot;B&quot; &amp;gt; date &amp;amp;&amp;amp; $&quot;C&quot; &amp;gt; timestamp&lt;/p&gt;
</comment>
                            <comment id="15034864" author="yhuai" created="Tue, 1 Dec 2015 23:33:30 +0000"  >&lt;p&gt;Issue resolved by pull request 9872&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9872&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9872&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15964438" author="macek" created="Tue, 11 Apr 2017 14:24:19 +0000"  >&lt;p&gt;I have an issue which maybe related and occurs in 2.1.0. I created a table which contains a Timestamp column. An describe results in:&lt;/p&gt;

&lt;p&gt;user_id	int	null&lt;br/&gt;
userCreatedAt	timestamp	null&lt;br/&gt;
country_iso	string	null&lt;/p&gt;

&lt;p&gt;When i query as follows ...&lt;/p&gt;

&lt;p&gt;select  date_format(userCreatedAt, &quot;yyyy&quot;), userCreatedAt,  date_format(userCreatedAt, &quot;yyyy&quot;) = &quot;2017&quot; from result where date_format(userCreatedAt, &quot;yyyy&quot;) = &quot;2017&quot;  order by userCreatedAt&lt;/p&gt;

&lt;p&gt;... the third column contains only true values as it should be due to the corresponding expression being in the where clause.&lt;/p&gt;

&lt;p&gt;When i execute the same query on the same table in which i replaced userCreatedAt by a  java.sql.Timestamp created from the userCreatedAt column, the result contains lots of false values. This is correct, since the year of those timestamp is not 2017. But i would expect them to not be included in the result. Also, date_format(userCreatedAt, &quot;yyyy&quot;) returns the correct year. &lt;/p&gt;

&lt;p&gt;Can anybody reproduce this issue?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2oja7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>