<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:33:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-11253] reset all accumulators in physical operators before execute an action</title>
                <link>https://issues.apache.org/jira/browse/SPARK-11253</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description></description>
                <environment></environment>
        <key id="12906965">SPARK-11253</key>
            <summary>reset all accumulators in physical operators before execute an action</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cloud_fan">Wenchen Fan</assignee>
                                    <reporter username="cloud_fan">Wenchen Fan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Oct 2015 03:55:17 +0000</created>
                <updated>Mon, 26 Oct 2015 06:00:33 +0000</updated>
                            <resolved>Mon, 26 Oct 2015 05:47:53 +0000</resolved>
                                                    <fixVersion>1.6.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14968484" author="apachespark" created="Thu, 22 Oct 2015 04:02:06 +0000"  >&lt;p&gt;User &apos;cloud-fan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9215&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9215&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14973769" author="yhuai" created="Mon, 26 Oct 2015 05:47:53 +0000"  >&lt;p&gt;Issue resolved by pull request 9215&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9215&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9215&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14973786" author="cloud_fan" created="Mon, 26 Oct 2015 06:00:33 +0000"  >&lt;p&gt;There is one more issue about the SQL metric:&lt;/p&gt;

&lt;p&gt;We use -1 as initial size of the &quot;dataSize&quot; and &quot;spillSize&quot; metrics, to work around &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-11013&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-11013&lt;/a&gt;.&lt;br/&gt;
For accumulators in physical plan, we only have a final aggregated value(currently we only have `sum`), which is different from SQLListener(has values for every task). So the -1 will affect the final aggregated values.&lt;/p&gt;

&lt;p&gt;Code to confirm it:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    val metrics = ArrayBuffer.empty[&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;]
    val listener = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; QueryExecutionListener {
      override def onFailure(funcName: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, qe: QueryExecution, exception: Exception): Unit = {}

      override def onSuccess(funcName: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, qe: QueryExecution, duration: &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;): Unit = {
        metrics += qe.executedPlan.longMetric(&lt;span class=&quot;code-quote&quot;&gt;&quot;dataSize&quot;&lt;/span&gt;).value.value
        val bottomAgg = qe.executedPlan.children(0).children(0)
        metrics += bottomAgg.longMetric(&lt;span class=&quot;code-quote&quot;&gt;&quot;dataSize&quot;&lt;/span&gt;).value.value
      }
    }
    sqlContext.listenerManager.register(listener)

    withSQLConf(SQLConf.SHUFFLE_PARTITIONS.key -&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;) {
      val df = sqlContext.sparkContext.makeRDD(Seq(1 -&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, 2 -&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;), 2).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;i&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;j&quot;&lt;/span&gt;).groupBy(&lt;span class=&quot;code-quote&quot;&gt;&quot;i&quot;&lt;/span&gt;).count()
      df.collect()
      &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;(metrics(0) - metrics(1) == 2)
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But the impaction is quite small, we can fix it later.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2nczr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>