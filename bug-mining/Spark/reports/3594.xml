<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:43:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-14343] Dataframe operations on a partitioned dataset (using partition discovery) return invalid results</title>
                <link>https://issues.apache.org/jira/browse/SPARK-14343</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When reading a dataset using &lt;tt&gt;sqlContext.read.text()&lt;/tt&gt; queries on the partitioned column return invalid results.&lt;/p&gt;

&lt;h2&gt;&lt;a name=&quot;Howtoreproduce%3A&quot;&gt;&lt;/a&gt;How to reproduce:&lt;/h2&gt;

&lt;h3&gt;&lt;a name=&quot;Generatedatasets&quot;&gt;&lt;/a&gt;Generate datasets&lt;/h3&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;repro.sh&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;#!/bin/sh

mkdir -p dataset/year=2014
mkdir -p dataset/year=2015

echo &lt;span class=&quot;code-quote&quot;&gt;&quot;data from 2014&quot;&lt;/span&gt; &amp;gt; dataset/year=2014/part01.txt
echo &lt;span class=&quot;code-quote&quot;&gt;&quot;data from 2015&quot;&lt;/span&gt; &amp;gt; dataset/year=2015/part01.txt
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;repro2.sh&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;#!/bin/sh

mkdir -p dataset2/month=june
mkdir -p dataset2/month=july

echo &lt;span class=&quot;code-quote&quot;&gt;&quot;data from june&quot;&lt;/span&gt; &amp;gt; dataset2/month=june/part01.txt
echo &lt;span class=&quot;code-quote&quot;&gt;&quot;data from july&quot;&lt;/span&gt; &amp;gt; dataset2/month=july/part01.txt
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;h3&gt;&lt;a name=&quot;usingfirstdataset&quot;&gt;&lt;/a&gt;using first dataset&lt;/h3&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;&amp;gt;&amp;gt;&amp;gt; df = sqlContext.read.text(&apos;dataset&apos;)
...
&amp;gt;&amp;gt;&amp;gt; df
DataFrame[value: string, year: int]
&amp;gt;&amp;gt;&amp;gt; df.show()
+--------------+----+
|         value|year|
+--------------+----+
|data from 2014|2014|
|data from 2015|2015|
+--------------+----+
&amp;gt;&amp;gt;&amp;gt; df.select(&apos;year&apos;).show()
+----+
|year|
+----+
|  14|
|  14|
+----+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is clearly wrong. Seems like it returns the length of the value column?&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;usingseconddataset&quot;&gt;&lt;/a&gt;using second dataset&lt;/h3&gt;

&lt;p&gt;With another dataset it looks like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;&amp;gt;&amp;gt;&amp;gt; df = sqlContext.read.text(&apos;dataset2&apos;)
&amp;gt;&amp;gt;&amp;gt; df
DataFrame[value: string, month: string]
&amp;gt;&amp;gt;&amp;gt; df.show()
+--------------+-----+
|         value|month|
+--------------+-----+
|data from june| june|
|data from july| july|
+--------------+-----+
&amp;gt;&amp;gt;&amp;gt; df.select(&apos;month&apos;).show()
+--------------+
|         month|
+--------------+
|data from june|
|data from july|
+--------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here it returns the value of the value column instead of the month partition.&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;Workaround&quot;&gt;&lt;/a&gt;Workaround&lt;/h3&gt;

&lt;p&gt;When I convert the dataframe to an RDD and back to a DataFrame I get the following result (which is the expected behaviour):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;&amp;gt;&amp;gt;&amp;gt; df.rdd.toDF().select(&apos;month&apos;).show()
+-----+
|month|
+-----+
| june|
| july|
+-----+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Mac OS X 10.11.4 / Ubuntu 16.04 LTS&lt;/p&gt;</environment>
        <key id="12955496">SPARK-14343</key>
            <summary>Dataframe operations on a partitioned dataset (using partition discovery) return invalid results</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lian cheng">Cheng Lian</assignee>
                                    <reporter username="jurriaanpruis">Jurriaan Pruis</reporter>
                        <labels>
                    </labels>
                <created>Sat, 2 Apr 2016 09:03:00 +0000</created>
                <updated>Wed, 1 Jun 2016 14:36:12 +0000</updated>
                            <resolved>Wed, 1 Jun 2016 14:36:12 +0000</resolved>
                                    <version>1.6.1</version>
                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="15244669" author="jurriaanpruis" created="Sun, 17 Apr 2016 14:14:53 +0000"  >&lt;p&gt;On the spark 2.0.0 nightly build it doesn&apos;t work at all:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;&amp;gt;&amp;gt;&amp;gt; df=sqlContext.read.text(&apos;dataset&apos;)
16/04/17 16:11:34 INFO HDFSFileCatalog: Listing file:/Users/.../dataset on driver
16/04/17 16:11:34 INFO HDFSFileCatalog: Listing file:/Users/.../dataset/year=2014 on driver
16/04/17 16:11:34 INFO HDFSFileCatalog: Listing file:/Users/.../dataset/year=2015 on driver
Traceback (most recent call last):
  File &quot;&amp;lt;stdin&amp;gt;&quot;, line 1, in &amp;lt;module&amp;gt;
  File &quot;/Users/.../Downloads/spark-2.0.0-SNAPSHOT-bin-hadoop2.7/python/pyspark/sql/readwriter.py&quot;, line 245, in text
    return self._df(self._jreader.text(self._sqlContext._sc._jvm.PythonUtils.toSeq(paths)))
  File &quot;/Users/.../Downloads/spark-2.0.0-SNAPSHOT-bin-hadoop2.7/python/lib/py4j-0.9.2-src.zip/py4j/java_gateway.py&quot;, line 836, in __call__
  File &quot;/Users/.../Downloads/spark-2.0.0-SNAPSHOT-bin-hadoop2.7/python/pyspark/sql/utils.py&quot;, line 57, in deco
    raise AnalysisException(s.split(&apos;: &apos;, 1)[1], stackTrace)
pyspark.sql.utils.AnalysisException: u&apos;Try to map struct&amp;lt;value:string,year:int&amp;gt; to Tuple1, but failed as the number of fields does not line up.\n - Input schema: struct&amp;lt;value:string,year:int&amp;gt;\n - Target schema: struct&amp;lt;value:string&amp;gt;;&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15246195" author="tsuresh" created="Mon, 18 Apr 2016 18:04:12 +0000"  >&lt;p&gt;This issue may be related to  &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-14463&quot; title=&quot;read.text broken for partitioned tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-14463&quot;&gt;&lt;del&gt;SPARK-14463&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="15292139" author="davies" created="Thu, 19 May 2016 21:09:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jurriaanpruis&quot; class=&quot;user-hover&quot; rel=&quot;jurriaanpruis&quot;&gt;jurriaanpruis&lt;/a&gt; Since you fixed the &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-14463&quot; title=&quot;read.text broken for partitioned tables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-14463&quot;&gt;&lt;del&gt;SPARK-14463&lt;/del&gt;&lt;/a&gt;, could you double check this one? &lt;/p&gt;</comment>
                            <comment id="15295471" author="jurriaanpruis" created="Sun, 22 May 2016 08:28:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davies&quot; class=&quot;user-hover&quot; rel=&quot;davies&quot;&gt;davies&lt;/a&gt; This is still an issue on Spark 2.0 (You only have to use sqlContext.read.format(&apos;text&apos;).load instead of sqlContext.read.text now)&lt;/p&gt;</comment>
                            <comment id="15297282" author="lian cheng" created="Mon, 23 May 2016 22:49:28 +0000"  >&lt;p&gt;Seems that we were reading from the wrong column, and happened to extract the string length field of a &lt;tt&gt;UTF8String&lt;/tt&gt; written in &lt;tt&gt;UnsafeRow&lt;/tt&gt;. Investigating.&lt;/p&gt;</comment>
                            <comment id="15309317" author="apachespark" created="Wed, 1 Jun 2016 05:43:04 +0000"  >&lt;p&gt;User &apos;liancheng&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/13431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13431&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15310397" author="lian cheng" created="Wed, 1 Jun 2016 14:36:12 +0000"  >&lt;p&gt;Issue resolved by pull request 13431&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/13431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13431&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 24 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vjtb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329449">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>