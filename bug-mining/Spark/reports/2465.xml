<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:32:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-9078] Use of non-standard LIMIT keyword in JDBC tableExists code</title>
                <link>https://issues.apache.org/jira/browse/SPARK-9078</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;tableExists in  spark/sql/core/src/main/scala/org/apache/spark/sql/jdbc/JdbcUtils.scala uses non-standard SQL (specifically, the LIMIT keyword) to determine whether a table exists in a JDBC data source. This will cause an exception in many/most JDBC databases that doesn&apos;t support LIMIT keyword. See &lt;a href=&quot;http://stackoverflow.com/questions/1528604/how-universal-is-the-limit-statement-in-sql&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/1528604/how-universal-is-the-limit-statement-in-sql&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To check for table existence or an exception, it could be recrafted around &quot;select 1 from $table where 0 = 1&quot; which isn&apos;t the same (it returns an empty resultset rather than the value &apos;1&apos;), but would support more data sources and also support empty tables. Arguably ugly and possibly queries every row on sources that don&apos;t support constant folding, but better than failing on JDBC sources that don&apos;t support LIMIT. &lt;/p&gt;

&lt;p&gt;Perhaps &quot;supports LIMIT&quot; could be a field in the JdbcDialect class for databases that support keyword this to override. The ANSI standard is (OFFSET and) FETCH. &lt;/p&gt;

&lt;p&gt;The standard way to check for table existence would be to use information_schema.tables which is a SQL standard but may not work for other JDBC data sources that support SQL, but not the information_schema. The JDBC DatabaseMetaData interface provides getSchemas()  that allows checking for the information_schema in drivers that support it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12845388">SPARK-9078</key>
            <summary>Use of non-standard LIMIT keyword in JDBC tableExists code</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tsuresh">Suresh Thalamati</assignee>
                                    <reporter username="bobbeauch">Robert Beauchemin</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Jul 2015 20:35:06 +0000</created>
                <updated>Tue, 10 Nov 2015 08:08:23 +0000</updated>
                            <resolved>Wed, 16 Sep 2015 02:41:53 +0000</resolved>
                                    <version>1.3.1</version>
                    <version>1.4.0</version>
                                    <fixVersion>1.6.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14628895" author="rxin" created="Wed, 15 Jul 2015 22:48:36 +0000"  >&lt;p&gt;It&apos;s reasonable to have a field for limit in jdbc dialect. Would that just solve this problem? &lt;/p&gt;</comment>
                            <comment id="14629009" author="bobbeauch" created="Thu, 16 Jul 2015 00:47:29 +0000"  >&lt;p&gt;If there were also a way to get tableExists to work correctly (even the 0=1 ugly method is perhaps better than nothing) for those JDBC sources that don&apos;t support LIMIT. &lt;/p&gt;

&lt;p&gt;And, because both current sources that have coded JdbcDialect entries (MySQL and Postgres) do support LIMIT, perhaps the default should be &lt;span class=&quot;error&quot;&gt;&amp;#91;no support&amp;#93;&lt;/span&gt; and MySQL and Postgres should be coded as &lt;span class=&quot;error&quot;&gt;&amp;#91;does support&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;Thanks, Bob&lt;/p&gt;</comment>
                            <comment id="14630232" author="bobbeauch" created="Thu, 16 Jul 2015 20:00:10 +0000"  >&lt;p&gt;I&apos;m having second thoughts, if a JdbcDialect entry for LIMIT support is considered, about making &lt;span class=&quot;error&quot;&gt;&amp;#91;no support&amp;#93;&lt;/span&gt; the default, as this may affect existing code that depends on the current implementation. &lt;/p&gt;

&lt;p&gt;Using the same value for every JdbcDialect would effectively make this a no-op however, and, in future, you might consider allowing JdbcDialect settings (keyed by driver pattern, as it is currently) to be specified in a config file (or the existing config file, I couldn&apos;t find it in the current settings), so that adding a driver for a data source that uses a different dialect can be accomplished without a custom build. I can file a separate JIRA for that change if you consider it worthwhile.&lt;/p&gt;

&lt;p&gt;Thanks, Bob&lt;/p&gt;</comment>
                            <comment id="14633008" author="rxin" created="Mon, 20 Jul 2015 00:48:22 +0000"  >&lt;p&gt;That might make sense &amp;#8211; but in general it is pretty annoying to add config files. Adding a new dialect actually isn&apos;t that hard. &lt;/p&gt;

&lt;p&gt;Should we just move tableExists into the dialect itself?&lt;/p&gt;</comment>
                            <comment id="14633975" author="bobbeauch" created="Mon, 20 Jul 2015 19:30:25 +0000"  >&lt;p&gt;Could make it part of the JdbcDialect. Or a string in the JdbcDialect that is used by tableExists that returns at most 1 row. With the current configuration (&quot;SELECT 1 FROM $table LIMIT 1&quot;) being the default. Then you wouldn&apos;t have to change how the query works to determine if the table exists. Your call...&lt;/p&gt;

&lt;p&gt;About the config file... my thinking here is that to add a new dialect (say if I wanted non-standard dialect entries for DB2 JDBC driver) requires a new release or a modified version of the base source. Unless there&apos;s a easy way to inject a new JdbcDialect that and without creating a whole new data source that I&apos;m missing. Not all customers want to recompile the source (or run a modified version of the source) to support a new JDBC data source. And would require a database of that type to be available for build testing, as I&apos;m guessing MySQL and Postgres are now. Much less overhead for the build/test team than another config file (or making it part of current a config file). Allowing separation of JDBC-specific driver settings from the base code would accomplish that without custom builds.  But you know the target audience better than I do.&lt;/p&gt;

&lt;p&gt;Cheers, and thanks, &lt;br/&gt;
Bob&lt;/p&gt;
</comment>
                            <comment id="14634579" author="rxin" created="Tue, 21 Jul 2015 06:18:01 +0000"  >&lt;p&gt;Right now you do have to call JdbcDialects.registerDialect, but we can make it available as an option to pass through to the jdbc data source. In that case, it should alleviate your concern about custom build right? All that&apos;s needed is to have a JdbcDialect implementation on the classpath.&lt;/p&gt;
</comment>
                            <comment id="14635459" author="bobbeauch" created="Tue, 21 Jul 2015 17:36:02 +0000"  >&lt;p&gt;Great, I didn&apos;t realize that JdbcDialects.registerDialect was a public API, passing it through to the jdbc data source would do it. &lt;/p&gt;

&lt;p&gt;Cheers, and thanks, Bob&lt;/p&gt;</comment>
                            <comment id="14635461" author="rxin" created="Tue, 21 Jul 2015 17:36:26 +0000"  >&lt;p&gt;Want to submit a pull request? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14635480" author="bobbeauch" created="Tue, 21 Jul 2015 17:49:47 +0000"  >&lt;p&gt;That was quick. Not sure that I have all the pieces in place for building right now, is it required? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Currently I was just browsing the source code to figure out what would be required to add/use a new fully supported JDBC-based data source (how all the pieces worked) and came across the hardcoded SQL statement.  &lt;/p&gt;</comment>
                            <comment id="14720747" author="tsuresh" created="Fri, 28 Aug 2015 22:55:52 +0000"  >&lt;p&gt;@Bob, Reynold&lt;/p&gt;

&lt;p&gt;I ran into the same issue when trying to write data frames into an existing table in DB2 database.&lt;br/&gt;
if you are not working on the fix, I would like to give it a try. &lt;/p&gt;

&lt;p&gt;Thank you for the analysis of the issue , my understanding is fix should do the following to address table exists problem with LIMIT syntax.:&lt;/p&gt;

&lt;p&gt;&amp;#8211; Add table Exists method to the JdbcDialect interface, and allow dialects override the method as required for specific databases.&lt;br/&gt;
&amp;#8211; Default implementation of  table exists method should use DatabaseMetaData.getTables() to find if table exists. If that particular interface is not implement use  the query &quot;select 1 from $table where 1=0&quot;.&lt;br/&gt;
&amp;#8211; Add table exist method that use LIMIT query to  MySQL , and Postgres dialects.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Enhancing registering of dialect :  (I think this may have to be separate Jira to avoid confusion).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@Reynold : I am not understanding your comment on adding  option to pass through  the jdbc data source. If you can give an example that will be great. &lt;/p&gt;

&lt;p&gt;Are you referring to some thing like the following ?&lt;br/&gt;
 df.write.option(&quot;datasource.jdbc.dialects&quot; &quot;org.apache.DerbyDialect&quot;).jdbc(&quot;jdbc:deryby://&amp;lt;server:port/SAMPLE&quot;, &quot;emp&quot;, properties)&lt;/p&gt;</comment>
                            <comment id="14721328" author="rxin" created="Sun, 30 Aug 2015 01:18:11 +0000"  >&lt;p&gt;Please submit a pull request, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tsuresh&quot; class=&quot;user-hover&quot; rel=&quot;tsuresh&quot;&gt;tsuresh&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I think it is OK to ignore the option for now.&lt;/p&gt;</comment>
                            <comment id="14738011" author="apachespark" created="Thu, 10 Sep 2015 02:15:03 +0000"  >&lt;p&gt;User &apos;sureshthalamati&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/8676&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/8676&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14746704" author="yhuai" created="Wed, 16 Sep 2015 02:41:53 +0000"  >&lt;p&gt;Issue resolved by pull request 8676&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/8676&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/8676&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12875401">SPARK-10664</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12895385">SPARK-10756</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12905775">SPARK-11173</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12911778">SPARK-11623</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 9 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hay7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333083">1.6.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>