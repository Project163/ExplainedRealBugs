<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:43:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-15327] Catalyst code generation fails with complex data structure</title>
                <link>https://issues.apache.org/jira/browse/SPARK-15327</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Spark code generation fails with the following error when loading parquet files with a complex structure:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;: java.util.concurrent.ExecutionException: java.lang.Exception: failed to compile: org.codehaus.commons.compiler.CompileException: File &lt;span class=&quot;code-quote&quot;&gt;&apos;generated.java&apos;&lt;/span&gt;, Line 158, Column 16: Expression &lt;span class=&quot;code-quote&quot;&gt;&quot;scan_isNull&quot;&lt;/span&gt; is not an rvalue
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The generated code on line 158 looks like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;/* 153 */&lt;/span&gt;     &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.scan_arrayWriter23 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.apache.spark.sql.catalyst.expressions.codegen.UnsafeArrayWriter();
&lt;span class=&quot;code-comment&quot;&gt;/* 154 */&lt;/span&gt;     &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.scan_rowWriter40 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.apache.spark.sql.catalyst.expressions.codegen.UnsafeRowWriter(scan_holder, 1);
&lt;span class=&quot;code-comment&quot;&gt;/* 155 */&lt;/span&gt;   }
&lt;span class=&quot;code-comment&quot;&gt;/* 156 */&lt;/span&gt;   
&lt;span class=&quot;code-comment&quot;&gt;/* 157 */&lt;/span&gt;   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void scan_apply_0(InternalRow scan_row) {
&lt;span class=&quot;code-comment&quot;&gt;/* 158 */&lt;/span&gt;     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (scan_isNull) {
&lt;span class=&quot;code-comment&quot;&gt;/* 159 */&lt;/span&gt;       scan_rowWriter.setNullAt(0);
&lt;span class=&quot;code-comment&quot;&gt;/* 160 */&lt;/span&gt;     } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;span class=&quot;code-comment&quot;&gt;/* 161 */&lt;/span&gt;       &lt;span class=&quot;code-comment&quot;&gt;// Remember the current cursor so that we can calculate how many bytes are
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;/* 162 */&lt;/span&gt;       &lt;span class=&quot;code-comment&quot;&gt;// written later.
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;/* 163 */&lt;/span&gt;       &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; scan_tmpCursor = scan_holder.cursor;
&lt;span class=&quot;code-comment&quot;&gt;/* 164 */&lt;/span&gt;       
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;How to reproduce (Pyspark): &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;# Some complex structure
json = &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;h&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;adfgd&quot;&lt;/span&gt;}], &lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;testing&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;: 3}], &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;: 1}]}}, &lt;span class=&quot;code-quote&quot;&gt;&quot;d&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;adfgd&quot;&lt;/span&gt;}], &lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;testing&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;: 3}], &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;: 1}]}}, &lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;adfgd&quot;&lt;/span&gt;}], &lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;: 3}], &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;: 1}]}}, &lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;adfgd&quot;&lt;/span&gt;}], &lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;: 3}], &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;: 1}]}}, &lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;adfgd&quot;&lt;/span&gt;}], &lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;testing&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;: 3}], &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;: 1}]}}, &lt;span class=&quot;code-quote&quot;&gt;&quot;g&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;adfgd&quot;&lt;/span&gt;}], &lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;testing&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;: 3}], &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;: 1}]}}, &lt;span class=&quot;code-quote&quot;&gt;&quot;f&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;adfgd&quot;&lt;/span&gt;}], &lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;testing&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;: 3}], &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;: 1}]}}, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;adfgd&quot;&lt;/span&gt;}], &lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;: 3}], &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: [{&lt;span class=&quot;code-quote&quot;&gt;&quot;e&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;: 1}]}}}&apos;&lt;/span&gt;

# Write to parquet file
sqlContext.read.json(sparkContext.parallelize([json])).write.mode(&lt;span class=&quot;code-quote&quot;&gt;&apos;overwrite&apos;&lt;/span&gt;).parquet(&lt;span class=&quot;code-quote&quot;&gt;&apos;test&apos;&lt;/span&gt;)
# Try to read from parquet file (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; generates an exception)
sqlContext.read.parquet(&lt;span class=&quot;code-quote&quot;&gt;&apos;test&apos;&lt;/span&gt;).collect()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12969770">SPARK-15327</key>
            <summary>Catalyst code generation fails with complex data structure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davies">Davies Liu</assignee>
                                    <reporter username="jurriaanpruis">Jurriaan Pruis</reporter>
                        <labels>
                    </labels>
                <created>Sat, 14 May 2016 15:16:25 +0000</created>
                <updated>Tue, 31 May 2016 22:36:27 +0000</updated>
                            <resolved>Tue, 31 May 2016 22:36:27 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="15283581" author="jurriaanpruis" created="Sat, 14 May 2016 15:17:59 +0000"  >&lt;p&gt;See attached file for the full exception / generated code.&lt;/p&gt;</comment>
                            <comment id="15283819" author="jurriaanpruis" created="Sun, 15 May 2016 09:55:03 +0000"  >&lt;p&gt;Did a quick look for the cause of this problem and it looks like the problem here is that the CodeGenerator.splitExpressions method splits the code in separate functions but does not take into account local variables.&lt;br/&gt;
Which results in references to variables which are not in scope there. &lt;/p&gt;</comment>
                            <comment id="15294437" author="apachespark" created="Fri, 20 May 2016 22:50:03 +0000"  >&lt;p&gt;User &apos;davies&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/13235&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13235&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15308778" author="davies" created="Tue, 31 May 2016 22:36:27 +0000"  >&lt;p&gt;Issue resolved by pull request 13235&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/13235&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13235&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12804029" name="full_exception.txt" size="246334" author="jurriaanpruis" created="Sat, 14 May 2016 15:17:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 24 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2xz5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>