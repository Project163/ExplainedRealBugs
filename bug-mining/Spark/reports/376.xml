<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:14:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-2034] KafkaInputDStream doesn&apos;t close resources and may prevent JVM shutdown</title>
                <link>https://issues.apache.org/jira/browse/SPARK-2034</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Tobias noted today on the mailing list:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I am trying to use Spark Streaming with Kafka, which works like a&lt;br/&gt;
charm &amp;#8211; except for shutdown. When I run my program with &quot;sbt&lt;br/&gt;
run-main&quot;, sbt will never exit, because there are two non-daemon&lt;br/&gt;
threads left that don&apos;t die.&lt;/p&gt;

&lt;p&gt;I created a minimal example at&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://gist.github.com/tgpfeiffer/b1e765064e983449c6b6#file-kafkadoesntshutdown-scala&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/tgpfeiffer/b1e765064e983449c6b6#file-kafkadoesntshutdown-scala&lt;/a&gt;&amp;gt;.&lt;br/&gt;
It starts a StreamingContext and does nothing more than connecting to&lt;br/&gt;
a Kafka server and printing what it receives. Using the `future { ...&lt;br/&gt;
}` construct, I shut down the StreamingContext after some seconds and&lt;br/&gt;
then print the difference between the threads at start time and at end&lt;br/&gt;
time. The output can be found at&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://gist.github.com/tgpfeiffer/b1e765064e983449c6b6#file-output1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/tgpfeiffer/b1e765064e983449c6b6#file-output1&lt;/a&gt;&amp;gt;.&lt;br/&gt;
There are a number of threads remaining that will prevent sbt from&lt;br/&gt;
exiting.&lt;/p&gt;

&lt;p&gt;When I replace `KafkaUtils.createStream(...)` with a call that does&lt;br/&gt;
exactly the same, except that it calls `consumerConnector.shutdown()`&lt;br/&gt;
in `KafkaReceiver.onStop()` (which it should, IMO), the output is as&lt;br/&gt;
shown at &amp;lt;&lt;a href=&quot;https://gist.github.com/tgpfeiffer/b1e765064e983449c6b6#file-output2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/tgpfeiffer/b1e765064e983449c6b6#file-output2&lt;/a&gt;&amp;gt;.&lt;/p&gt;

&lt;p&gt;Does anyone have &lt;b&gt;any&lt;/b&gt; idea what is going on here and why the program&lt;br/&gt;
doesn&apos;t shut down properly? The behavior is the same with both kafka&lt;br/&gt;
0.8.0 and 0.8.1.1, by the way.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Something similar was noted last year:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/spark-dev/201309.mbox/%3C1380220041.2428.YahooMailNeo@web160804.mail.bf1.yahoo.com%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail-archives.apache.org/mod_mbox/spark-dev/201309.mbox/%3C1380220041.2428.YahooMailNeo@web160804.mail.bf1.yahoo.com%3E&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;KafkaInputDStream doesn&apos;t close ConsumerConnector in onStop(), and does not close the Executor it creates. The latter leaves non-daemon threads and can prevent the JVM from shutting down even if streaming is closed properly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12718584">SPARK-2034</key>
            <summary>KafkaInputDStream doesn&apos;t close resources and may prevent JVM shutdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean R. Owen</assignee>
                                    <reporter username="srowen">Sean R. Owen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Jun 2014 10:06:08 +0000</created>
                <updated>Thu, 15 Jan 2015 09:08:39 +0000</updated>
                            <resolved>Sun, 22 Jun 2014 08:12:36 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.0.1</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>DStreams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14040069" author="pwendell" created="Sun, 22 Jun 2014 08:12:36 +0000"  >&lt;p&gt;Issue resolved by pull request 980&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/980&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/980&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>396783</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 22 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1wb7z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>396902</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>