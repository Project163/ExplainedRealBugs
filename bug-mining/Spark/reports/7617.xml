<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:20:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-33669] Wrong error message from YARN application state monitor when sc.stop in yarn client mode</title>
                <link>https://issues.apache.org/jira/browse/SPARK-33669</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;For YarnClient mode, when stopping YarnClientSchedulerBackend, it first tries to interrupt Yarn application monitor thread. In MonitorThread.run() it catches InterruptedException to gracefully response to stopping request.&lt;/p&gt;

&lt;p&gt;But client.monitorApplication method also throws InterruptedIOException when the hadoop rpc call is calling. In this case, MonitorThread will not know it is interrupted, a Yarn App failed is returned with &quot;Failed to contact YARN for application xxxxx;&#160; YARN application has exited unexpectedly with state xxxxx&quot; is logged with error level. which confuse user a lot.&lt;/p&gt;

&lt;p&gt;We Should take considerate InterruptedIOException here to make it the same behavior with InterruptedException.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MonitorThread &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; {
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; allowInterrupt = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;

  override def run() {
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      val YarnAppReport(_, state, diags) =
        client.monitorApplication(appId.get, logApplicationReport = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
      logError(s&lt;span class=&quot;code-quote&quot;&gt;&quot;YARN application has exited unexpectedly with state $state! &quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;Check the YARN application logs &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; more details.&quot;&lt;/span&gt;)
      diags.foreach { err =&amp;gt;
        logError(s&lt;span class=&quot;code-quote&quot;&gt;&quot;Diagnostics message: $err&quot;&lt;/span&gt;)
      }
      allowInterrupt = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
      sc.stop()
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; e: InterruptedException =&amp;gt; logInfo(&lt;span class=&quot;code-quote&quot;&gt;&quot;Interrupting monitor thread&quot;&lt;/span&gt;)
    }
  }

 &#160;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// wrong error message
&lt;/span&gt;2020-12-05 03:06:58,000 ERROR [YARN application state monitor]: org.apache.spark.deploy.yarn.Client(91) - Failed to contact YARN &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; application application_1605868815011_1154961. 
java.io.InterruptedIOException: Call interrupted
        at org.apache.hadoop.ipc.Client.call(Client.java:1466)
        at org.apache.hadoop.ipc.Client.call(Client.java:1409)
        at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:230)
        at com.sun.proxy.$Proxy38.getApplicationReport(Unknown Source)
        at org.apache.hadoop.yarn.api.impl.pb.client.ApplicationClientProtocolPBClientImpl.getApplicationReport(ApplicationClientProtocolPBClientImpl.java:187)
        at sun.reflect.GeneratedMethodAccessor22.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:256)
        at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:104)
        at com.sun.proxy.$Proxy39.getApplicationReport(Unknown Source)
        at org.apache.hadoop.yarn.client.api.impl.YarnClientImpl.getApplicationReport(YarnClientImpl.java:408)
        at org.apache.spark.deploy.yarn.Client.getApplicationReport(Client.scala:327)
        at org.apache.spark.deploy.yarn.Client.monitorApplication(Client.scala:1039)
        at org.apache.spark.scheduler.cluster.YarnClientSchedulerBackend$MonitorThread.run(YarnClientSchedulerBackend.scala:116)
2020-12-05 03:06:58,000 ERROR [YARN application state monitor]: org.apache.spark.scheduler.cluster.YarnClientSchedulerBackend(70) - YARN application has exited unexpectedly with state FAILED! Check the YARN application logs &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; more details. 

2020-12-05 03:06:58,001 ERROR [YARN application state monitor]: org.apache.spark.scheduler.cluster.YarnClientSchedulerBackend(70) - Diagnostics message: Failed to contact YARN &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; application application_1605868815011_1154961.

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// hadoop ipc code
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Writable call(RPC.RpcKind rpcKind, Writable rpcRequest,
    ConnectionId remoteId, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; serviceClass,
    AtomicBoolean fallbackToSimpleAuth) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Call call = createCall(rpcKind, rpcRequest);
  Connection connection = getConnection(remoteId, call, serviceClass,
    fallbackToSimpleAuth);
  &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
    connection.sendRpcRequest(call);                 &lt;span class=&quot;code-comment&quot;&gt;// send the rpc request
&lt;/span&gt;  } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (RejectedExecutionException e) {
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;connection has been closed&quot;&lt;/span&gt;, e);
  } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
    &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().interrupt();
    LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;interrupted waiting to send rpc request to server&quot;&lt;/span&gt;, e);
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(e);
  }

  &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (call) {
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!call.done) {
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        call.wait();                           &lt;span class=&quot;code-comment&quot;&gt;// wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the result
&lt;/span&gt;      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException ie) {
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().interrupt();
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InterruptedIOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Call interrupted&quot;&lt;/span&gt;);
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13344341">SPARK-33669</key>
            <summary>Wrong error message from YARN application state monitor when sc.stop in yarn client mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sqlwindspeaker">Su Qilong</assignee>
                                    <reporter username="sqlwindspeaker">Su Qilong</reporter>
                        <labels>
                    </labels>
                <created>Sat, 5 Dec 2020 09:37:24 +0000</created>
                <updated>Wed, 9 Dec 2020 07:27:47 +0000</updated>
                            <resolved>Wed, 9 Dec 2020 07:25:45 +0000</resolved>
                                    <version>2.4.3</version>
                    <version>3.0.1</version>
                                    <fixVersion>3.1.0</fixVersion>
                                    <component>YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17244455" author="apachespark" created="Sat, 5 Dec 2020 10:10:23 +0000"  >&lt;p&gt;User &apos;sqlwindspeaker&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/30617&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/30617&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17244456" author="apachespark" created="Sat, 5 Dec 2020 10:11:25 +0000"  >&lt;p&gt;User &apos;sqlwindspeaker&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/30617&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/30617&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17246330" author="mridulm80" created="Wed, 9 Dec 2020 07:25:45 +0000"  >&lt;p&gt;Issue resolved by pull request 30617&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/30617&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/30617&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 48 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0l85s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>