<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:27:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-36892] Disable batch fetch for a shuffle when push based shuffle is enabled</title>
                <link>https://issues.apache.org/jira/browse/SPARK-36892</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When push based shuffle is enabled, efficient fetch of merged mapper shuffle output happens.&lt;br/&gt;
Unfortunately, this currently interacts badly with spark.sql.adaptive.fetchShuffleBlocksInBatch, potentially causing shuffle fetch to hang and/or duplicate data to be fetched, causing correctness issues.&lt;/p&gt;

&lt;p&gt;Given batch fetch does not benefit spark stages reading merged blocks when push based shuffle is enabled, ShuffleBlockFetcherIterator.doBatchFetch can be disabled when push based shuffle is enabled.&lt;/p&gt;


&lt;p&gt;Thx to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Ngone51&quot; class=&quot;user-hover&quot; rel=&quot;Ngone51&quot;&gt;Ngone51&lt;/a&gt; for surfacing this issue.&lt;br/&gt;
+CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Gengliang.Wang&quot; class=&quot;user-hover&quot; rel=&quot;Gengliang.Wang&quot;&gt;Gengliang.Wang&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13404133">SPARK-36892</key>
            <summary>Disable batch fetch for a shuffle when push based shuffle is enabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zhouyejoe">Ye Zhou</assignee>
                                    <reporter username="mridulm80">Mridul Muralidharan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Sep 2021 20:22:07 +0000</created>
                <updated>Wed, 6 Oct 2021 14:37:01 +0000</updated>
                            <resolved>Wed, 6 Oct 2021 07:43:14 +0000</resolved>
                                    <version>3.2.0</version>
                                    <fixVersion>3.2.0</fixVersion>
                                    <component>Shuffle</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17422425" author="zhouyejoe" created="Wed, 29 Sep 2021 22:22:08 +0000"  >&lt;p&gt;I am working on this issue. We have a job which can reproduce this hanging issue and after disabling the batch fetch, the job can go through. Will post PR soon.&lt;/p&gt;</comment>
                            <comment id="17422533" author="gengliang.wang" created="Thu, 30 Sep 2021 05:26:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhouyejoe&quot; class=&quot;user-hover&quot; rel=&quot;zhouyejoe&quot;&gt;zhouyejoe&lt;/a&gt; Thank you!&lt;/p&gt;</comment>
                            <comment id="17422558" author="zhouyejoe" created="Thu, 30 Sep 2021 07:06:21 +0000"  >&lt;p&gt;Raised PR &lt;a href=&quot;https://github.com/apache/spark/pull/34156.&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/34156.&lt;/a&gt;&#160;UT to be added.&lt;/p&gt;</comment>
                            <comment id="17422559" author="apachespark" created="Thu, 30 Sep 2021 07:06:48 +0000"  >&lt;p&gt;User &apos;zhouyejoe&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/34156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/34156&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17422593" author="gengliang.wang" created="Thu, 30 Sep 2021 08:00:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mridulm80&quot; class=&quot;user-hover&quot; rel=&quot;mridulm80&quot;&gt;mridulm80&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhouyejoe&quot; class=&quot;user-hover&quot; rel=&quot;zhouyejoe&quot;&gt;zhouyejoe&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mshen&quot; class=&quot;user-hover&quot; rel=&quot;mshen&quot;&gt;mshen&lt;/a&gt; The push-based shuffle feature fails the 3.2.0 RC multiple times. Could you run some real workloads(e.g TPCDS) with the latest branch 3.2 after the fix is merged? &lt;/p&gt;</comment>
                            <comment id="17422800" author="mshen" created="Thu, 30 Sep 2021 13:55:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Gengliang.Wang&quot; class=&quot;user-hover&quot; rel=&quot;Gengliang.Wang&quot;&gt;Gengliang.Wang&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This issue and the ones fixed earlier are surfaced as we started having a variety of LinkedIn&apos;s internal workloads testing against a version of Spark based on 3.2.0 RC.&lt;/p&gt;

&lt;p&gt;Notice that when we previously productionized push-based shuffle internally at LinkedIn, it was developed based on top of Spark 2.3/2.4.&lt;/p&gt;

&lt;p&gt;We are fairly certain about the major functionalities of push-based shuffle since they have been in production at LinkedIn for a year now.&lt;/p&gt;

&lt;p&gt;However, some of the code for push-based shuffle in Spark 3.2.0 RC are new and hadn&apos;t been tested with our internal workloads until recently.&lt;/p&gt;

&lt;p&gt;So hopefully this explains the context around the few recent issues, and in terms of testing with real workloads we are already doing it and will continue so to help with 3.2.0 release.&lt;/p&gt;</comment>
                            <comment id="17422964" author="gengliang.wang" created="Thu, 30 Sep 2021 18:27:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mshen&quot; class=&quot;user-hover&quot; rel=&quot;mshen&quot;&gt;mshen&lt;/a&gt; Thanks for the tests. I understand it is not easy work. &lt;br/&gt;
I talked to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mridulm80&quot; class=&quot;user-hover&quot; rel=&quot;mridulm80&quot;&gt;mridulm80&lt;/a&gt; on Slack as well. I will hold the next RC until your tests are complete. &lt;/p&gt;</comment>
                            <comment id="17424052" author="mridulm80" created="Mon, 4 Oct 2021 17:25:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Gengliang.Wang&quot; class=&quot;user-hover&quot; rel=&quot;Gengliang.Wang&quot;&gt;Gengliang.Wang&lt;/a&gt; Thanks for holding the release !&lt;br/&gt;
The team worked on testing the RC and fixed two issues:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-36705&quot; title=&quot;Disable push based shuffle when IO encryption is enabled or serializer is not relocatable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-36705&quot;&gt;&lt;del&gt;SPARK-36705&lt;/del&gt;&lt;/a&gt; (&lt;a href=&quot;https://github.com/apache/spark/pull/34158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/34158&lt;/a&gt;) and&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-36892&quot; title=&quot;Disable batch fetch for a shuffle when push based shuffle is enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-36892&quot;&gt;&lt;del&gt;SPARK-36892&lt;/del&gt;&lt;/a&gt; (&lt;a href=&quot;https://github.com/apache/spark/pull/34156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/34156&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;With these two fixes on top of RC6, in addition to internal tests, we had all queries for TPCDS (scale 100) completing successfully and correctly.&lt;br/&gt;
There was an issue identified with mismatch for TPCH query 22 - &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apatnam&quot; class=&quot;user-hover&quot; rel=&quot;apatnam&quot;&gt;apatnam&lt;/a&gt; has filed a jira (&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-36926&quot; title=&quot;Discrepancy in Q22 of TPCH for Spark 3.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-36926&quot;&gt;&lt;del&gt;SPARK-36926&lt;/del&gt;&lt;/a&gt;) for it.&lt;/p&gt;</comment>
                            <comment id="17424823" author="gengliang.wang" created="Wed, 6 Oct 2021 07:43:14 +0000"  >&lt;p&gt;Issue resolved by pull request 34156&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/34156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/34156&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17424825" author="gengliang.wang" created="Wed, 6 Oct 2021 07:45:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mridulm80&quot; class=&quot;user-hover&quot; rel=&quot;mridulm80&quot;&gt;mridulm80&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mshen&quot; class=&quot;user-hover&quot; rel=&quot;mshen&quot;&gt;mshen&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhouyejoe&quot; class=&quot;user-hover&quot; rel=&quot;zhouyejoe&quot;&gt;zhouyejoe&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apatnam&quot; class=&quot;user-hover&quot; rel=&quot;apatnam&quot;&gt;apatnam&lt;/a&gt; Again, thanks for testing Spark 3.2 with real workloads. Now that all the blockers are resolved. I will have the new RC soon.&lt;/p&gt;</comment>
                            <comment id="17425016" author="mridulm80" created="Wed, 6 Oct 2021 14:37:01 +0000"  >&lt;p&gt;Sounds good &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Gengliang.Wang&quot; class=&quot;user-hover&quot; rel=&quot;Gengliang.Wang&quot;&gt;Gengliang.Wang&lt;/a&gt;, I am not aware of any other issues.&lt;br/&gt;
Thanks for driving the process !&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0vfhk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>