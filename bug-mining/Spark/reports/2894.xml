<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:36:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-12275] No plan for BroadcastHint in some condition</title>
                <link>https://issues.apache.org/jira/browse/SPARK-12275</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;b&gt;Summary&lt;/b&gt;&lt;br/&gt;
No plan for BroadcastHint is generated in some condition.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Test Case&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    val df1 = Seq((1, &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;), (2, &lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;)).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;)
    val parquetTempFile =
      &lt;span class=&quot;code-quote&quot;&gt;&quot;%s/SPARK-xxxx_%d.parquet&quot;&lt;/span&gt;.format(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;java.io.tmpdir&quot;&lt;/span&gt;), scala.util.Random.nextInt)
    df1.write.parquet(parquetTempFile)
    val pf1 = sqlContext.read.parquet(parquetTempFile)
    #1. df1.join(broadcast(pf1)).count()
    #2. broadcast(pf1).count()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;Result&lt;/b&gt;&lt;br/&gt;
It will trigger assertion in QueryPlanner.scala, like below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt;     df1.join(broadcast(pf1)).count()
java.lang.AssertionError: assertion failed: No plan &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; BroadcastHint
+- Relation[key#6,value#7] ParquetRelation[hdfs:&lt;span class=&quot;code-comment&quot;&gt;//10.1.0.20:8020/tmp/SPARK-xxxx_1817830406.parquet]
&lt;/span&gt;
	at scala.Predef$.&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;(Predef.scala:179)
	at org.apache.spark.sql.catalyst.planning.QueryPlanner.plan(QueryPlanner.scala:59)
	at org.apache.spark.sql.catalyst.planning.QueryPlanner.planLater(QueryPlanner.scala:54)
	at org.apache.spark.sql.execution.SparkStrategies$BasicOperators$.apply(SparkStrategies.scala:336)
	at org.apache.spark.sql.catalyst.planning.QueryPlanner$$anonfun$1.apply(QueryPlanner.scala:58)
	at org.apache.spark.sql.catalyst.planning.QueryPlanner$$anonfun$1.apply(QueryPlanner.scala:58)
	at scala.collection.Iterator$$anon$13.hasNext(Iterator.scala:371)
	at org.apache.spark.sql.catalyst.planning.QueryPlanner.plan(QueryPlanner.scala:59)
	at org.apache.spark.sql.catalyst.planning.QueryPlanner.planLater(QueryPlanner.scala:54)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12920968">SPARK-12275</key>
            <summary>No plan for BroadcastHint in some condition</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yucai">yucai</assignee>
                                    <reporter username="yucai">yucai</reporter>
                        <labels>
                            <label>backport-needed</label>
                    </labels>
                <created>Fri, 11 Dec 2015 05:41:49 +0000</created>
                <updated>Thu, 24 Dec 2015 13:28:10 +0000</updated>
                            <resolved>Mon, 14 Dec 2015 21:05:46 +0000</resolved>
                                    <version>1.6.0</version>
                                    <fixVersion>1.5.3</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15052916" author="yucai" created="Fri, 11 Dec 2015 15:43:52 +0000"  >&lt;p&gt;&lt;b&gt;Root Cause&lt;/b&gt;&lt;br/&gt;
When  BasicOperators&apos;s &quot;case BroadcastHint(child)&quot; is hit (in SparkStrategies.scala), it will recursively invoke BasicOperators.apply by using &quot;child&quot;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; BroadcastHint(child) =&amp;gt; apply(child)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If BasicOperators could not process that child properly, it will lead to &quot;No plan for BroadcastHint&quot;.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; _ =&amp;gt; Nil
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In my example above, broadcast(pf1) hits &quot;case BroadcastHint(child)&quot;, so the child is pf1, its type is &quot;Relation&lt;a href=&quot;#91,value#92&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;key#91,value#92&lt;/a&gt; ParquetRelation&quot;.&lt;br/&gt;
And then using this child to invoke BasicOperators.apply again, unfortunately, this child type &quot;Relation&lt;a href=&quot;#91,value#92&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;key#91,value#92&lt;/a&gt; ParquetRelation&quot; could not match anything in BasicOperators.apply, so return Nil, &quot;No plan for BroadcastHint&quot;.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Solution&lt;/b&gt;&lt;br/&gt;
Using planLater to invoke other execution strategies that are available&lt;/p&gt;</comment>
                            <comment id="15055760" author="apachespark" created="Mon, 14 Dec 2015 10:20:04 +0000"  >&lt;p&gt;User &apos;yucai&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10291&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10291&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15057012" author="yucai" created="Tue, 15 Dec 2015 00:05:08 +0000"  >&lt;p&gt;I verified the PR has fixed this issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 49 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pr47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333969">1.5.3</customfieldvalue>
    <customfieldvalue id="12334009">1.6.1</customfieldvalue>
    <customfieldvalue id="12329449">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>