<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:02:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-25942] Aggregate expressions shouldn&apos;t be resolved on AppendColumns</title>
                <link>https://issues.apache.org/jira/browse/SPARK-25942</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Dataset.groupByKey will bring in new attributes from serializer. If key type is the same as original Dataset&apos;s object type, they have same serializer output and so the attribute names will conflict.&lt;/p&gt;

&lt;p&gt;This won&apos;t be a problem at most of cases, if we don&apos;t refer conflict attributes:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val ds: Dataset[(ClassData, &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;)] = Seq(ClassData(&lt;span class=&quot;code-quote&quot;&gt;&quot;one&quot;&lt;/span&gt;, 1), ClassData(&lt;span class=&quot;code-quote&quot;&gt;&quot;two&quot;&lt;/span&gt;, 2)).toDS()
&#160; .map(c =&amp;gt; ClassData(c.a, c.b + 1))
&#160; .groupByKey(p =&amp;gt; p).count()
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;But if we use conflict attributes, `Analyzer` will complain about ambiguous references:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val ds = Seq(1, 2, 3).toDS()
val agg = ds.groupByKey(_ &amp;gt;= 2).agg(sum(&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;).as[&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;], sum($&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt; + 1).as[&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;])
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.spark.sql.AnalysisException: Reference &lt;span class=&quot;code-quote&quot;&gt;&apos;value&apos;&lt;/span&gt; is ambiguous, could be: value, value.;                                          
[info]   at org.apache.spark.sql.catalyst.expressions.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;$AttributeSeq.resolve(&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;.scala:247)
[info]   at org.apache.spark.sql.catalyst.plans.logical.LogicalPlan.resolveChildren(LogicalPlan.scala:101)
[info]   at org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveReferences$$anonfun$38.apply(Analyzer.scala:889)
[info]   at org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveReferences$$anonfun$38.apply(Analyzer.scala:891)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Based on the API document and implementation details of KeyValueGroupedDataset, we should not allow aggregate expressions on KeyValueGroupedDataset to access key attributes.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13196188">SPARK-25942</key>
            <summary>Aggregate expressions shouldn&apos;t be resolved on AppendColumns</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="viirya">L. C. Hsieh</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 Nov 2018 08:50:26 +0000</created>
                <updated>Tue, 13 Nov 2018 17:58:35 +0000</updated>
                            <resolved>Tue, 13 Nov 2018 17:58:35 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16674841" author="apachespark" created="Mon, 5 Nov 2018 09:04:11 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22944&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22944&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16674844" author="apachespark" created="Mon, 5 Nov 2018 09:05:17 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22944&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22944&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16685544" author="cloud_fan" created="Tue, 13 Nov 2018 17:58:35 +0000"  >&lt;p&gt;Issue resolved by pull request 22944&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22944&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22944&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 1 week ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s0046g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>