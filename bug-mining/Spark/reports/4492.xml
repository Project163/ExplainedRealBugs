<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:50:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-18863] Output non-aggregate expressions without GROUP BY in a subquery does not yield an error </title>
                <link>https://issues.apache.org/jira/browse/SPARK-18863</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smilegator&quot; class=&quot;user-hover&quot; rel=&quot;smilegator&quot;&gt;smilegator&lt;/a&gt; has found that the following query does not raise a syntax error (note the GROUP BY clause is commented out):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; pk, cv
&lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt;   p, &lt;span class=&quot;code-keyword&quot;&gt;c&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;WHERE&lt;/span&gt;  p.pk = &lt;span class=&quot;code-keyword&quot;&gt;c&lt;/span&gt;.ck
&lt;span class=&quot;code-keyword&quot;&gt;AND&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;c&lt;/span&gt;.cv = (&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;max&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;avg&lt;/span&gt;)
               &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt;   (&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt;   c1.cv, &lt;span class=&quot;code-keyword&quot;&gt;avg&lt;/span&gt;(c1.cv) &lt;span class=&quot;code-keyword&quot;&gt;avg&lt;/span&gt;
                       &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt;     &lt;span class=&quot;code-keyword&quot;&gt;c&lt;/span&gt; c1
                       &lt;span class=&quot;code-keyword&quot;&gt;WHERE&lt;/span&gt;    c1.ck = p.pk
&lt;span class=&quot;code-comment&quot;&gt;--                       &lt;span class=&quot;code-keyword&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; c1.cv
&lt;/span&gt;                      ))

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There could be multiple values of &lt;tt&gt;c1.cv&lt;/tt&gt; for each value of &lt;tt&gt;avg(c1.cv)&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13028128">SPARK-18863</key>
            <summary>Output non-aggregate expressions without GROUP BY in a subquery does not yield an error </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nsyca">Nattavut Sutyanyong</assignee>
                                    <reporter username="nsyca">Nattavut Sutyanyong</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Dec 2016 16:01:01 +0000</created>
                <updated>Wed, 25 Jan 2017 16:10:02 +0000</updated>
                            <resolved>Wed, 25 Jan 2017 16:10:02 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.3</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15748975" author="smilegator" created="Wed, 14 Dec 2016 17:53:48 +0000"  >&lt;p&gt;The JIRA only shows one scenario. The expected error messages could be either&lt;br/&gt;
`org.apache.spark.sql.AnalysisException: grouping expressions sequence is empty, and &apos;c1.`cv`&apos; is not an aggregate function. `&lt;br/&gt;
or&lt;br/&gt;
`org.apache.spark.sql.AnalysisException: expression &apos;c1.`cv`&apos; is neither present in the group by, nor is it an aggregate function.`&lt;/p&gt;</comment>
                            <comment id="15749780" author="ioana-delaney" created="Wed, 14 Dec 2016 23:00:00 +0000"  >&lt;p&gt;This looks like another instance of &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-16161&quot; title=&quot;Ambiguous error message for unsupported correlated predicate subqueries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-16161&quot;&gt;&lt;del&gt;SPARK-16161&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15767537" author="nsyca" created="Wed, 21 Dec 2016 16:54:02 +0000"  >&lt;p&gt;Another case to investigate &lt;span class=&quot;error&quot;&gt;&amp;#91;subquery/in-subquery/in-group-by.sql TC 01.12&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Seq((1,1,1)).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;t1a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;t1b&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;t1c&quot;&lt;/span&gt;).createOrReplaceTempView(&lt;span class=&quot;code-quote&quot;&gt;&quot;t1&quot;&lt;/span&gt;)
Seq((1,1,1)).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;t2a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;t2b&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;t2c&quot;&lt;/span&gt;).createOrReplaceTempView(&lt;span class=&quot;code-quote&quot;&gt;&quot;t2&quot;&lt;/span&gt;)
Seq((1,1,1)).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;t3a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;t3b&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;t3c&quot;&lt;/span&gt;).createOrReplaceTempView(&lt;span class=&quot;code-quote&quot;&gt;&quot;t3&quot;&lt;/span&gt;)

&#8212; TC 01.12
select * from t1 where t1a in
(select min(t2a) from t2 where t2a = t2a and t2c &amp;gt;= 1 group by t2c having t2c in
(select t3c from t3 group by t3c, t3b having t2b &amp;gt; 6 and t3b &amp;gt; t2b ))

== Parsed Logical Plan ==
&apos;Project [*]
+- &lt;span class=&quot;code-quote&quot;&gt;&apos;Filter &apos;&lt;/span&gt;t1a IN (list#803)
   :  +- &lt;span class=&quot;code-quote&quot;&gt;&apos;Filter &apos;&lt;/span&gt;t2c IN (list#802)
   :     :  +- &lt;span class=&quot;code-quote&quot;&gt;&apos;Filter ((&apos;&lt;/span&gt;t2b &amp;gt; 6) &amp;amp;&amp;amp; (&lt;span class=&quot;code-quote&quot;&gt;&apos;t3b &amp;gt; &apos;&lt;/span&gt;t2b))
   :     :     +- &lt;span class=&quot;code-quote&quot;&gt;&apos;Aggregate [&apos;&lt;/span&gt;t3c, &lt;span class=&quot;code-quote&quot;&gt;&apos;t3b], [&apos;&lt;/span&gt;t3c]
   :     :        +- &apos;UnresolvedRelation `t3`
   :     +- &lt;span class=&quot;code-quote&quot;&gt;&apos;Aggregate [&apos;&lt;/span&gt;t2c], [unresolvedalias(&lt;span class=&quot;code-quote&quot;&gt;&apos;min(&apos;&lt;/span&gt;t2a), None)]
   :        +- &lt;span class=&quot;code-quote&quot;&gt;&apos;Filter ((&apos;&lt;/span&gt;t2a = &lt;span class=&quot;code-quote&quot;&gt;&apos;t2a) &amp;amp;&amp;amp; (&apos;&lt;/span&gt;t2c &amp;gt;= 1))
   :           +- &apos;UnresolvedRelation `t2`
   +- &apos;UnresolvedRelation `t1`

== Analyzed Logical Plan ==
t1a: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, t1b: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, t1c: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;
Project [t1a#764, t1b#765, t1c#766]
+- Filter predicate-subquery#803 [(t1a#764 = min(t2a)#816)]
   :  +- Project [min(t2a)#816]
   :     +- !Filter predicate-subquery#802 [(t2c#781 = t3c#796) &amp;amp;&amp;amp; (t2b#780 &amp;gt; 6) &amp;amp;&amp;amp; (t3b#795 &amp;gt; t2b#780)]
   :        :  +- Project [t3c#796, t3b#795]
   :        :     +- Aggregate [t3c#796, t3b#795], [t3c#796, t3b#795]
   :        :        +- SubqueryAlias t3, `t3`
   :        :           +- Project [_1#790 AS t3a#794, _2#791 AS t3b#795, _3#792 AS t3c#796]
   :        :              +- LocalRelation [_1#790, _2#791, _3#792]
   :        +- Aggregate [t2c#781], [min(t2a#779) AS min(t2a)#816, t2c#781]
   :           +- Filter ((t2a#779 = t2a#779) &amp;amp;&amp;amp; (t2c#781 &amp;gt;= 1))
   :              +- SubqueryAlias t2, `t2`
   :                 +- Project [_1#775 AS t2a#779, _2#776 AS t2b#780, _3#777 AS t2c#781]
   :                    +- LocalRelation [_1#775, _2#776, _3#777]
   +- SubqueryAlias t1, `t1`
      +- Project [_1#760 AS t1a#764, _2#761 AS t1b#765, _3#762 AS t1c#766]
         +- LocalRelation [_1#760, _2#761, _3#762]

== Optimized Logical Plan ==
Project [_1#760 AS t1a#764, _2#761 AS t1b#765, _3#762 AS t1c#766]
+- Join LeftSemi, (_1#760 = min(t2a)#816)
   :- LocalRelation [_1#760, _2#761, _3#762]
   +- Aggregate [t2c#781], [min(t2a#779) AS min(t2a)#816]
      +- Project [_1#775 AS t2a#779, _3#777 AS t2c#781]
         +- Join LeftSemi, (((_3#777 = t3c#796) &amp;amp;&amp;amp; (_2#776 &amp;gt; 6)) &amp;amp;&amp;amp; (t3b#795 &amp;gt; _2#776))
            :- Filter (_3#777 &amp;gt;= 1)
            :  +- LocalRelation [_1#775, _2#776, _3#777]
            +- Aggregate [t3c#796, t3b#795], [t3c#796, t3b#795]
               +- LocalRelation [t3b#795, t3c#796]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I don&apos;t see the column t2b#780 being part of the output of the (lower) Aggregate operator. Somehow the LeftSemi join for t2b &amp;gt; 6 is just moved down below the Aggregate over t2. This does not look right to me. &lt;/p&gt;</comment>
                            <comment id="15791310" author="nsyca" created="Sun, 1 Jan 2017 16:12:02 +0000"  >&lt;p&gt;My further investigation concludes this problem reported by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smilegator&quot; class=&quot;user-hover&quot; rel=&quot;smilegator&quot;&gt;smilegator&lt;/a&gt; is different from the one in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-16161&quot; title=&quot;Ambiguous error message for unsupported correlated predicate subqueries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-16161&quot;&gt;&lt;del&gt;SPARK-16161&lt;/del&gt;&lt;/a&gt; and the one reported by me in subquery/in-subquery/in-group-by.sql TC 01.12. I have opened &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-19047&quot; title=&quot;Invalid correlated column may not be reported as an error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-19047&quot;&gt;&lt;del&gt;SPARK-19047&lt;/del&gt;&lt;/a&gt; to track the last problem.&lt;/p&gt;</comment>
                            <comment id="15798578" author="nsyca" created="Wed, 4 Jan 2017 15:58:12 +0000"  >&lt;p&gt;I made the conclusion too soon. It turns out that the scenario TC 01.12 is a variation of this problem in which we need to perform a &lt;tt&gt;CheckAnalysis&lt;/tt&gt; on the subquery plan hanging of (currently limited to) a Filter operator. The original problem documented in the description is a subquery of the form of &lt;tt&gt;ScalarSubquery&lt;/tt&gt; whereas TC 01.12 is of the form of &lt;tt&gt;PredicateSubquery&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I will close &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-19047&quot; title=&quot;Invalid correlated column may not be reported as an error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-19047&quot;&gt;&lt;del&gt;SPARK-19047&lt;/del&gt;&lt;/a&gt; and submit a PR for this problem soon.&lt;/p&gt;</comment>
                            <comment id="15821679" author="apachespark" created="Fri, 13 Jan 2017 11:42:04 +0000"  >&lt;p&gt;User &apos;nsyca&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/16572&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/16572&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13031422">SPARK-19047</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 44 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37liv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>