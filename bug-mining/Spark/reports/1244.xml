<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:22:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-5049] ParquetTableScan always prepends the values of partition columns in output rows irrespective of the order of the partition columns in the original SELECT query</title>
                <link>https://issues.apache.org/jira/browse/SPARK-5049</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;This happens when ParquetTableScan is being used by turning on spark.sql.hive.convertMetastoreParquet&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;p&gt;spark-sql&amp;gt; set spark.sql.hive.convertMetastoreParquet=true;&lt;/p&gt;

&lt;p&gt;spark-sql&amp;gt; create table table1(a int , b int) partitioned by (p1 string, p2 int) ROW FORMAT SERDE &apos;parquet.hive.serde.ParquetHiveSerDe&apos; STORED AS  INPUTFORMAT &apos;parquet.hive.DeprecatedParquetInputFormat&apos; OUTPUTFORMAT &apos;parquet.hive.DeprecatedParquetOutputFormat&apos;;&lt;/p&gt;

&lt;p&gt;spark-sql&amp;gt; insert into table table1 partition(p1=&apos;January&apos;,p2=1) select key, 10  from src;    &lt;/p&gt;

&lt;p&gt;spark-sql&amp;gt; select a, b, p1, p2 from table1 limit 10;&lt;/p&gt;

&lt;p&gt;January	1	484	10&lt;br/&gt;
January	1	484	10&lt;br/&gt;
January	1	484	10&lt;br/&gt;
January	1	484	10&lt;br/&gt;
January	1	484	10&lt;br/&gt;
January	1	484	10&lt;br/&gt;
January	1	484	10&lt;br/&gt;
January	1	484	10&lt;br/&gt;
January	1	484	10&lt;br/&gt;
January	1	484	10&lt;/p&gt;

&lt;p&gt;The correct output should be &lt;/p&gt;

&lt;p&gt;484	10	January	1&lt;br/&gt;
484	10	January	1&lt;br/&gt;
484	10	January	1&lt;br/&gt;
484	10	January	1&lt;br/&gt;
484	10	January	1&lt;br/&gt;
484	10	January	1&lt;br/&gt;
484	10	January	1&lt;br/&gt;
484	10	January	1&lt;br/&gt;
484	10	January	1&lt;br/&gt;
484	10	January	1&lt;/p&gt;


&lt;p&gt;This also leads to schema mismatch if the query is run using HiveContext and the result is a SchemaRDD.&lt;br/&gt;
For example :&lt;/p&gt;

&lt;p&gt;scala&amp;gt; import org.apache.spark.sql.hive._&lt;br/&gt;
scala&amp;gt; val hc = new HiveContext(sc)&lt;br/&gt;
scala&amp;gt; hc.setConf(&quot;spark.sql.hive.convertMetastoreParquet&quot;, &quot;true&quot;)&lt;br/&gt;
scala&amp;gt; val res = hc.sql(&quot;select a, b, p1, p2 from table1 limit 10&quot;)&lt;br/&gt;
scala&amp;gt; res.collect&lt;br/&gt;
res2: Array&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.spark.sql.Row&amp;#93;&lt;/span&gt; = Array(&lt;span class=&quot;error&quot;&gt;&amp;#91;January,1,238,10&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;January,1,86,10&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;January,1,311,10&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;January,1,27,10&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;January,1,165,10&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;January,1,409,10&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;January,1,255,10&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;January,1,278,10&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;January,1,98,10&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;January,1,484,10&amp;#93;&lt;/span&gt;)&lt;/p&gt;

&lt;p&gt;scala&amp;gt; res.schema&lt;br/&gt;
res5: org.apache.spark.sql.StructType = StructType(ArrayBuffer(StructField(a,IntegerType,true), StructField(b,IntegerType,true), StructField(p1,StringType,true), StructField(p2,IntegerType,true)))&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12764447">SPARK-5049</key>
            <summary>ParquetTableScan always prepends the values of partition columns in output rows irrespective of the order of the partition columns in the original SELECT query</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rahul.aggarwal">Rahul Aggarwal</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Jan 2015 12:10:23 +0000</created>
                <updated>Mon, 12 Jan 2015 23:19:45 +0000</updated>
                            <resolved>Mon, 12 Jan 2015 23:19:45 +0000</resolved>
                                    <version>1.1.0</version>
                    <version>1.2.0</version>
                                    <fixVersion>1.2.1</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14262546" author="apachespark" created="Thu, 1 Jan 2015 13:09:33 +0000"  >&lt;p&gt;User &apos;rahulaggarwalguavus&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/3870&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3870&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14262547" author="rahul.aggarwal" created="Thu, 1 Jan 2015 13:09:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/pull/3870&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3870&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14272748" author="apachespark" created="Sun, 11 Jan 2015 01:00:31 +0000"  >&lt;p&gt;User &apos;marmbrus&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/3990&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3990&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14274384" author="marmbrus" created="Mon, 12 Jan 2015 23:19:45 +0000"  >&lt;p&gt;Issue resolved by pull request 3990&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/3990&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3990&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 45 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23w3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>