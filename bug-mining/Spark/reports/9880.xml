<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:43:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-49743] OptimizeCsvJsonExpr should not change the schema of underlying StructType in GetArrayStructFields</title>
                <link>https://issues.apache.org/jira/browse/SPARK-49743</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The `OptimizeCsvJsonExprs` rule can potentially change the schema of the underlying `StructField` if there are differences in the field used to access the struct vs the field in the underlying struct.&lt;/p&gt;

&lt;p&gt;This surfaces as a correctness issue where instead of picking the values for the corresponding column we end up returning NULL.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;A simple example query is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SELECT
&#160; from_json(&lt;span class=&quot;code-quote&quot;&gt;&apos;[{&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;: &apos;&lt;/span&gt;||id||&lt;span class=&quot;code-quote&quot;&gt;&apos;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: &apos;&lt;/span&gt;|| (2*id) ||&lt;span class=&quot;code-quote&quot;&gt;&apos;}]&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;array&amp;lt;struct&amp;lt;a: INT, b: INT&amp;gt;&amp;gt;&apos;&lt;/span&gt;).a,
&#160; from_json(&lt;span class=&quot;code-quote&quot;&gt;&apos;[{&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;: &apos;&lt;/span&gt;||id||&lt;span class=&quot;code-quote&quot;&gt;&apos;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;: &apos;&lt;/span&gt;|| (2*id) ||&lt;span class=&quot;code-quote&quot;&gt;&apos;}]&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;array&amp;lt;struct&amp;lt;a: INT, b: INT&amp;gt;&amp;gt;&apos;&lt;/span&gt;).A
FROM
&#160; range(3) as t&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here, the result is `&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;` for `a` but `&lt;span class=&quot;error&quot;&gt;&amp;#91;null&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;null&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;null&amp;#93;&lt;/span&gt;` for `A`. Since struct field accessor is case-insensitive, the result should had been `&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;` for both.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13592768">SPARK-49743</key>
            <summary>OptimizeCsvJsonExpr should not change the schema of underlying StructType in GetArrayStructFields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nikhilsheoran-db">Nikhil Sheoran</assignee>
                                    <reporter username="nikhilsheoran-db">Nikhil Sheoran</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 20 Sep 2024 18:53:21 +0000</created>
                <updated>Tue, 1 Oct 2024 01:49:38 +0000</updated>
                            <resolved>Tue, 1 Oct 2024 01:49:38 +0000</resolved>
                                    <version>3.5.2</version>
                                    <fixVersion>3.5.4</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17886057" author="cloud_fan" created="Tue, 1 Oct 2024 01:49:38 +0000"  >&lt;p&gt;Issue resolved by pull request 48308&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/48308&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/48308&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1rj60:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>