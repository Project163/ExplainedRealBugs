<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:22:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-4092] Input metrics don&apos;t work for coalesce()&apos;d RDD&apos;s</title>
                <link>https://issues.apache.org/jira/browse/SPARK-4092</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;In every case where we set input metrics (from both Hadoop and block storage) we currently assume that exactly one input partition is computed within the task. This is not a correct assumption in the general case. The main example in the current API is coalesce(), but user-defined RDD&apos;s could also be affected.&lt;/p&gt;

&lt;p&gt;To deal with the most general case, we would need to support the notion of a single task having multiple input sources. A more surgical and less general fix is to simply go to HadoopRDD and check if there are already inputMetrics defined for the task with the same &quot;type&quot;. If there are, then merge in the new data rather than blowing away the old one.&lt;/p&gt;

&lt;p&gt;This wouldn&apos;t cover case where, e.g. a single task has input from both on-disk and in-memory blocks. It &lt;em&gt;would&lt;/em&gt; cover the case where someone calls coalesce on a HadoopRDD... which is more common.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12750627">SPARK-4092</key>
            <summary>Input metrics don&apos;t work for coalesce()&apos;d RDD&apos;s</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kostas">Kostas Sakellis</assignee>
                                    <reporter username="pwendell">Patrick Wendell</reporter>
                        <labels>
                    </labels>
                <created>Sun, 26 Oct 2014 19:48:06 +0000</created>
                <updated>Fri, 16 Jan 2015 02:49:03 +0000</updated>
                            <resolved>Fri, 16 Jan 2015 02:49:03 +0000</resolved>
                                                    <fixVersion>1.3.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14190974" author="kostas" created="Thu, 30 Oct 2014 22:47:11 +0000"  >&lt;p&gt;The current patch I&apos;m working on does the simplest thing to address this issue. In the hadoop rdds and cache manager if the task already has input metrics of the same read method it will increment them instead of overriding. This simple solution should handle the common case of:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sc.textFile(..).coalesce(5).collect()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In addition it will cover the situation where blocks are coming from the cache. &lt;/p&gt;

&lt;p&gt;What it won&apos;t handle properly is if coalesce (or other rdds with similar properties) reads from multiple blocks of mixed read methods (memory vs. hadoop). In that case, one input metric will override the other. We have several options:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;We create a MIXED readMethod and if we see input metrics from different methods, we change to MIXED. This will loose some information because now we don&apos;t know where the blocks were read from.&lt;/li&gt;
	&lt;li&gt;We store multiple inputMetrics for each TaskContext. Up the stack (eg. JsonProtocol) we send the array of InputMetrics to the caller. We have to worry about backwards compatibility in that case so we can&apos;t just remove the single inputMetric. We might have to send back a MIXED metric and in addition the array for newer clients.&lt;/li&gt;
	&lt;li&gt;We punt on this issue for now since it can be argued is not common.&lt;br/&gt;
What are people&apos;s thoughts on this?&lt;/li&gt;
&lt;/ol&gt;

</comment>
                            <comment id="14191463" author="pwendell" created="Fri, 31 Oct 2014 06:26:21 +0000"  >&lt;p&gt;I&apos;d be fine, as a first step, just doing (3). It will solve many of the use cases and will be simple.&lt;/p&gt;</comment>
                            <comment id="14199181" author="apachespark" created="Wed, 5 Nov 2014 21:53:08 +0000"  >&lt;p&gt;User &apos;ksakellis&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/3120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3120&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14200029" author="aash" created="Thu, 6 Nov 2014 09:31:36 +0000"  >&lt;p&gt;Hi Kostas,&lt;/p&gt;

&lt;p&gt;This looks to be touching some of the same code that &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-2630&quot; title=&quot;Input data size of CoalescedRDD is incorrect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-2630&quot;&gt;&lt;del&gt;SPARK-2630&lt;/del&gt;&lt;/a&gt; aims to fix.  Your fix looks to have better testing so might be better to build on if these two are duplicates.&lt;/p&gt;

&lt;p&gt;Does your work also fix &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-2630&quot; title=&quot;Input data size of CoalescedRDD is incorrect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-2630&quot;&gt;&lt;del&gt;SPARK-2630&lt;/del&gt;&lt;/a&gt; as a side effect?&lt;/p&gt;</comment>
                            <comment id="14207190" author="kostas" created="Tue, 11 Nov 2014 22:20:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aash&quot; class=&quot;user-hover&quot; rel=&quot;aash&quot;&gt;aash&lt;/a&gt;, yes this should solve a superset of the same problems that &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-2630&quot; title=&quot;Input data size of CoalescedRDD is incorrect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-2630&quot;&gt;&lt;del&gt;SPARK-2630&lt;/del&gt;&lt;/a&gt; aims to fix. I say superset because &lt;a href=&quot;https://github.com/apache/spark/pull/3120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3120&lt;/a&gt; also includes a similar fix when hadoop 2.5 is used with the bytesReadCallback. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12728997">SPARK-2630</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12751762">SPARK-4157</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12767239">SPARK-5225</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21laf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327369">1.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>