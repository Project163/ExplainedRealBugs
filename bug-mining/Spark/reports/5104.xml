<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:55:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-21677] json_tuple throws NullPointException when column is null as string type.</title>
                <link>https://issues.apache.org/jira/browse/SPARK-21677</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I was testing &lt;tt&gt;json_tuple&lt;/tt&gt; before using this to extract values from JSONs in my testing cluster but I found it could actually throw  &lt;tt&gt;NullPointException&lt;/tt&gt; as below sometimes:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; Seq((&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;&quot;{&quot;&lt;/span&gt;Hyukjin&lt;span class=&quot;code-quote&quot;&gt;&quot;: 224, &quot;&lt;/span&gt;John&lt;span class=&quot;code-quote&quot;&gt;&quot;: 1225}&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;)).toDS.selectExpr(&quot;&lt;/span&gt;json_tuple(value, trim(&lt;span class=&quot;code-quote&quot;&gt;&apos; Hyukjin    &apos;&lt;/span&gt;))&quot;).show()
+---+
| c0|
+---+
|224|
+---+

scala&amp;gt; Seq((&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;&quot;{&quot;&lt;/span&gt;Hyukjin&lt;span class=&quot;code-quote&quot;&gt;&quot;: 224, &quot;&lt;/span&gt;John&lt;span class=&quot;code-quote&quot;&gt;&quot;: 1225}&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;)).toDS.selectExpr(&quot;&lt;/span&gt;json_tuple(value, trim(&lt;span class=&quot;code-quote&quot;&gt;&apos; Jackson    &apos;&lt;/span&gt;))&quot;).show()
+----+
|  c0|
+----+
|&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;|
+----+

scala&amp;gt; Seq((&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;&quot;{&quot;&lt;/span&gt;Hyukjin&lt;span class=&quot;code-quote&quot;&gt;&quot;: 224, &quot;&lt;/span&gt;John&lt;span class=&quot;code-quote&quot;&gt;&quot;: 1225}&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;)).toDS.selectExpr(&quot;&lt;/span&gt;json_tuple(value, trim(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;))&quot;).show()
...
java.lang.NullPointerException
	at org.apache.spark.sql.catalyst.expressions.JsonTuple$$anonfun$foldableFieldNames$1.apply(jsonExpressions.scala:367)
	at org.apache.spark.sql.catalyst.expressions.JsonTuple$$anonfun$foldableFieldNames$1.apply(jsonExpressions.scala:366)
	at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)
	at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)
	at scala.collection.mutable.ResizableArray$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(ResizableArray.scala:59)
	at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:48)
	at scala.collection.TraversableLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;map(TraversableLike.scala:234)
	at scala.collection.AbstractTraversable.map(Traversable.scala:104)
	at org.apache.spark.sql.catalyst.expressions.JsonTuple.foldableFieldNames$lzycompute(jsonExpressions.scala:366)
	at org.apache.spark.sql.catalyst.expressions.JsonTuple.foldableFieldNames(jsonExpressions.scala:365)
	at org.apache.spark.sql.catalyst.expressions.JsonTuple.constantFields$lzycompute(jsonExpressions.scala:373)
	at org.apache.spark.sql.catalyst.expressions.JsonTuple.constantFields(jsonExpressions.scala:373)
	at org.apache.spark.sql.catalyst.expressions.JsonTuple.org$apache$spark$sql$catalyst$expressions$JsonTuple$$parseRow(jsonExpressions.scala:417)
	at org.apache.spark.sql.catalyst.expressions.JsonTuple$$anonfun$eval$4.apply(jsonExpressions.scala:401)
	at org.apache.spark.sql.catalyst.expressions.JsonTuple$$anonfun$eval$4.apply(jsonExpressions.scala:400)
	at org.apache.spark.util.Utils$.tryWithResource(Utils.scala:2559)
	at org.apache.spark.sql.catalyst.expressions.JsonTuple.eval(jsonExpressions.scala:400)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It sounds we should show explicit error messages or return &lt;tt&gt;NULL&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13093474">SPARK-21677</key>
            <summary>json_tuple throws NullPointException when column is null as string type.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cjm">Jen-Ming Chung</assignee>
                                    <reporter username="gurwls223">Hyukjin Kwon</reporter>
                        <labels>
                            <label>Starter</label>
                    </labels>
                <created>Wed, 9 Aug 2017 13:23:24 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:12 +0000</updated>
                            <resolved>Thu, 17 Aug 2017 23:37:03 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16119891" author="gurwls223" created="Wed, 9 Aug 2017 13:24:59 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt;, I remember your mentee was checking through JSON related code paths. Does this make sense to you and would you be interested in this? I don&apos;t have time to work on this and am currently fighting with AppVeyor time limit issue. &lt;/p&gt;</comment>
                            <comment id="16119928" author="viirya" created="Wed, 9 Aug 2017 13:53:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt; Thanks! Definitely we are interested in this. We will work on this.&lt;/p&gt;</comment>
                            <comment id="16121641" author="cjm" created="Thu, 10 Aug 2017 13:56:42 +0000"  >&lt;p&gt;to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt;, the return &lt;tt&gt;NULL&lt;/tt&gt; you mentioned does it means all fields should be null in json_tuple, or just the non-existence field as shown in the following. Thanks!&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;e.g., spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;&quot;SELECT json_tuple(&lt;span class=&quot;code-quote&quot;&gt;&apos;{&quot;&lt;/span&gt;a&lt;span class=&quot;code-quote&quot;&gt;&quot;:1, &quot;&lt;/span&gt;b&lt;span class=&quot;code-quote&quot;&gt;&quot;:2}&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;not_exising_fields&apos;&lt;/span&gt;)&quot;&lt;/span&gt;&quot;&quot;).show()

+---+---+----+
| c0| c1|  c2|
+---+---+----+
|  1|  2|&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;|
+---+---+----+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="16121658" author="gurwls223" created="Thu, 10 Aug 2017 14:11:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cjm&quot; class=&quot;user-hover&quot; rel=&quot;cjm&quot;&gt;cjm&lt;/a&gt;, I was thinking like&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;&quot;SELECT json_tuple(&lt;span class=&quot;code-quote&quot;&gt;&apos;{&quot;&lt;/span&gt;a&lt;span class=&quot;code-quote&quot;&gt;&quot;:1, &quot;&lt;/span&gt;b&lt;span class=&quot;code-quote&quot;&gt;&quot;:2}&apos;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(NULL AS STRING), &lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(NULL AS STRING), &lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;)&quot;&lt;/span&gt;&quot;&quot;).show()

+----+---+----+---+
|  c0| c1|  c2| c3|
+----+---+----+---+
|&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;|  2|&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;|  1|
+----+---+----+---+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think this could be at least consistent with Hive&apos;s implementation:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;hive&amp;gt; SELECT json_tuple(&lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;:1, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;:2}&apos;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(NULL AS STRING), &lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(NULL AS STRING), &lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;);
...
NULL	2	NULL	1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16121740" author="viirya" created="Thu, 10 Aug 2017 14:38:45 +0000"  >&lt;p&gt;As a given field name &lt;tt&gt;null&lt;/tt&gt; can&apos;t be matched with any field names in json, we just output &lt;tt&gt;null&lt;/tt&gt; as its column value. I think it&apos;s reasonable.&lt;/p&gt;</comment>
                            <comment id="16133091" author="gurwls223" created="Fri, 18 Aug 2017 15:06:49 +0000"  >&lt;p&gt;Issue resolved by pull request 18930&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18930&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18930&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ilcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>