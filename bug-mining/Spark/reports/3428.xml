<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:41:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-14521] StackOverflowError in Kryo when executing TPC-DS</title>
                <link>https://issues.apache.org/jira/browse/SPARK-14521</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Build details:  Spark build from master branch (Apr-10)&lt;/p&gt;

&lt;p&gt;DataSet:        TPC-DS at 200 GB scale in Parq format stored in hive.&lt;/p&gt;

&lt;p&gt;Client:         $SPARK_HOME/bin/beeline &lt;/p&gt;

&lt;p&gt;Query:          TPC-DS Query27&lt;/p&gt;

&lt;p&gt;spark.sql.sources.fileScan=true (this is the default value anyways)&lt;/p&gt;

&lt;p&gt;Exception:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception in thread &quot;broadcast-exchange-0&quot; java.lang.StackOverflowError
        at com.esotericsoftware.kryo.util.DefaultClassResolver.writeName(DefaultClassResolver.java:108)
        at com.esotericsoftware.kryo.util.DefaultClassResolver.writeClass(DefaultClassResolver.java:99)
        at com.esotericsoftware.kryo.Kryo.writeClass(Kryo.java:517)
        at com.esotericsoftware.kryo.Kryo.writeClassAndObject(Kryo.java:622)
        at com.esotericsoftware.kryo.serializers.CollectionSerializer.write(CollectionSerializer.java:100)
        at com.esotericsoftware.kryo.serializers.CollectionSerializer.write(CollectionSerializer.java:40)
        at com.esotericsoftware.kryo.Kryo.writeObject(Kryo.java:552)
        at com.esotericsoftware.kryo.serializers.ObjectField.write(ObjectField.java:80)
        at com.esotericsoftware.kryo.serializers.FieldSerializer.write(FieldSerializer.java:518)
        at com.esotericsoftware.kryo.Kryo.writeObject(Kryo.java:552)
        at com.esotericsoftware.kryo.serializers.ObjectField.write(ObjectField.java:80)
        at com.esotericsoftware.kryo.serializers.FieldSerializer.write(FieldSerializer.java:518)
        at com.esotericsoftware.kryo.Kryo.writeClassAndObject(Kryo.java:628)
        at com.esotericsoftware.kryo.serializers.CollectionSerializer.write(CollectionSerializer.java:100)
        at com.esotericsoftware.kryo.serializers.CollectionSerializer.write(CollectionSerializer.java:40)
        at com.esotericsoftware.kryo.Kryo.writeObject(Kryo.java:552)
        at com.esotericsoftware.kryo.serializers.ObjectField.write(ObjectField.java:80)
        at com.esotericsoftware.kryo.serializers.FieldSerializer.write(FieldSerializer.java:518)
        at com.esotericsoftware.kryo.Kryo.writeObject(Kryo.java:552)
        at com.esotericsoftware.kryo.serializers.ObjectField.write(ObjectField.java:80)
        at com.esotericsoftware.kryo.serializers.FieldSerializer.write(FieldSerializer.java:518)
        at com.esotericsoftware.kryo.Kryo.writeClassAndObject(Kryo.java:628)
        at com.esotericsoftware.kryo.serializers.CollectionSerializer.write(CollectionSerializer.java:100)
        at com.esotericsoftware.kryo.serializers.CollectionSerializer.write(CollectionSerializer.java:40)
        at com.esotericsoftware.kryo.Kryo.writeObject(Kryo.java:552)
        at com.esotericsoftware.kryo.serializers.ObjectField.write(ObjectField.java:80)
        at com.esotericsoftware.kryo.serializers.FieldSerializer.write(FieldSerializer.java:518)
        at com.esotericsoftware.kryo.Kryo.writeObject(Kryo.java:552)
        at com.esotericsoftware.kryo.serializers.ObjectField.write(ObjectField.java:80)
        at com.esotericsoftware.kryo.serializers.FieldSerializer.write(FieldSerializer.java:518)
        at com.esotericsoftware.kryo.Kryo.writeClassAndObject(Kryo.java:628)
        at com.esotericsoftware.kryo.serializers.CollectionSerializer.write(CollectionSerializer.java:100)
        at com.esotericsoftware.kryo.serializers.CollectionSerializer.write(CollectionSerializer.java:40)
        at com.esotericsoftware.kryo.Kryo.writeObject(Kryo.java:552)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12957579">SPARK-14521</key>
            <summary>StackOverflowError in Kryo when executing TPC-DS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yzhou2001">Yan</assignee>
                                    <reporter username="rajesh.balamohan">Rajesh Balamohan</reporter>
                        <labels>
                    </labels>
                <created>Sun, 10 Apr 2016 23:56:44 +0000</created>
                <updated>Wed, 1 Jun 2016 13:06:43 +0000</updated>
                            <resolved>Tue, 3 May 2016 20:41:35 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="15234380" author="rajesh.balamohan" created="Mon, 11 Apr 2016 00:49:21 +0000"  >&lt;p&gt;Build with commit f8c9beca38f1f396eb3220b23db6d77112a50293 does not have this issue. Suspecting it to be kryo 3.0.3 upgrade issue.&lt;/p&gt;</comment>
                            <comment id="15236094" author="joshrosen" created="Mon, 11 Apr 2016 22:18:41 +0000"  >&lt;p&gt;Downgrading to Kryo 2 is not an option so we&apos;ll have to fix this.&lt;/p&gt;</comment>
                            <comment id="15249012" author="rajesh.balamohan" created="Wed, 20 Apr 2016 00:17:39 +0000"  >&lt;p&gt;Update:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;By default, spark-thrift server disables &quot;spark.kryo.referenceTracking&quot; (if not specified in conf).&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/blob/master/sql/hive-thriftserver/src/main/scala/org/apache/spark/sql/hive/thriftserver/SparkSQLEnv.scala#L55&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/sql/hive-thriftserver/src/main/scala/org/apache/spark/sql/hive/thriftserver/SparkSQLEnv.scala#L55&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;When &quot;spark.kryo.referenceTracking&quot; is set to true explicitly in spark-defaults.conf, query executes successfully. Alternatively, if &quot;spark.sql.autoBroadcastJoinThreshold&quot; can be set to a very low value in order to prevent broacasting (this is done just for verification).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Recent changes LongHashedRelation could have introduced loops which would need &quot;spark.kryo.referenceTracking=true&quot; in spark-thrift server. I will create a PR for this.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15249067" author="apachespark" created="Wed, 20 Apr 2016 01:09:04 +0000"  >&lt;p&gt;User &apos;rajeshbalamohan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/12514&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12514&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15253264" author="apachespark" created="Fri, 22 Apr 2016 03:22:03 +0000"  >&lt;p&gt;User &apos;yzhou2001&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/12598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12598&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15256836" author="jfchen@us.ibm.com" created="Mon, 25 Apr 2016 19:16:56 +0000"  >&lt;p&gt;This fix will allow us to use Kyro again (in spark-sql shell and spark-submit). Somehow the workaround described above did not work for me in spark 2.0. Did I miss something else? My workaround is actually use the java serializer for now, which sees performance hit. &lt;/p&gt;</comment>
                            <comment id="15267746" author="yhuai" created="Mon, 2 May 2016 23:46:00 +0000"  >&lt;p&gt;Do we know the root cause?&lt;/p&gt;</comment>
                            <comment id="15267811" author="yzhou2001" created="Tue, 3 May 2016 00:34:17 +0000"  >&lt;p&gt;Yes, we are serializing the fields that should not be serialized. Please check and review &lt;a href=&quot;https://github.com/apache/spark/pull/12598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12598&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15269542" author="davies" created="Tue, 3 May 2016 20:41:35 +0000"  >&lt;p&gt;Issue resolved by pull request 12598&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/12598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12598&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12952914">SPARK-14096</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 28 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vwnb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329449">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>