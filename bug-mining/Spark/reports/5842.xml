<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:00:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-24717] Split out min retain version of state for memory in HDFSBackedStateStoreProvider</title>
                <link>https://issues.apache.org/jira/browse/SPARK-24717</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;HDFSBackedStateStoreProvider has only one configuration for&#160;minimum versions to retain of state which applies to both memory cache and files. As default version of &quot;spark.sql.streaming.minBatchesToRetain&quot; is set to high (100), which doesn&apos;t require strictly 100x of memory, but I&apos;m seeing 10x ~ 80x of memory consumption for&#160;various workloads. In addition, in some cases, requiring 2x of memory is even unacceptable, so we should split out configuration for memory and let users adjust to trade-off memory usage vs cache miss.&lt;/p&gt;

&lt;p&gt;In normal case, default value &apos;2&apos; would cover both cases: success and&#160;restoring failure with less than or around 2x of memory usage, and &apos;1&apos; would only cover success case but&#160;no longer require more than 1x of memory. In extreme case,&#160;user can set the value to &apos;0&apos; to completely disable the map cache to maximize executor memory.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13169540">SPARK-24717</key>
            <summary>Split out min retain version of state for memory in HDFSBackedStateStoreProvider</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kabhwan">Jungtaek Lim</assignee>
                                    <reporter username="kabhwan">Jungtaek Lim</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Jul 2018 14:02:45 +0000</created>
                <updated>Mon, 15 Apr 2019 19:40:05 +0000</updated>
                            <resolved>Thu, 19 Jul 2018 07:08:04 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>2.4.0</fixVersion>
                                    <component>Structured Streaming</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16529962" author="kabhwan" created="Mon, 2 Jul 2018 14:03:35 +0000"  >&lt;p&gt;I have a patch for this, but now on top of &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-24441&quot; title=&quot;Expose total estimated size of states in HDFSBackedStateStoreProvider&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-24441&quot;&gt;&lt;del&gt;SPARK-24441&lt;/del&gt;&lt;/a&gt;. I&apos;ll try to decouple and rebase to master branch, and provide a pull request.&lt;/p&gt;</comment>
                            <comment id="16530508" author="apachespark" created="Mon, 2 Jul 2018 22:24:05 +0000"  >&lt;p&gt;User &apos;HeartSaVioR&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/21700&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21700&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16548895" author="tdas" created="Thu, 19 Jul 2018 07:08:04 +0000"  >&lt;p&gt;Issue resolved by pull request 21700&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/21700&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21700&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16623066" author="kabhwan" created="Fri, 21 Sep 2018 04:49:30 +0000"  >&lt;p&gt;Looks like version of this issue&#160;wasn&apos;t changed&#160;while preparing release. Just updated.&lt;/p&gt;</comment>
                            <comment id="16818326" author="skonto" created="Mon, 15 Apr 2019 19:40:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tdas&quot; class=&quot;user-hover&quot; rel=&quot;tdas&quot;&gt;tdas&lt;/a&gt; What is the point of having `spark.sql.streaming.minBatchesToRetain` set to 100 by default?&#160;&lt;/p&gt;

&lt;p&gt;Wouldnt that create problems with large states when it comes to external storage?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13145078">SPARK-23682</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 31 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3vg9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>