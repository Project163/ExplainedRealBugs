<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:52:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-17647] SQL LIKE does not handle backslashes correctly</title>
                <link>https://issues.apache.org/jira/browse/SPARK-17647</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Try the following in SQL shell:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select &lt;span class=&quot;code-quote&quot;&gt;&apos;\\\\&apos;&lt;/span&gt; like &lt;span class=&quot;code-quote&quot;&gt;&apos;%\\%&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It returned false, which is wrong.&lt;/p&gt;


&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;yhuai&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joshrosen&quot; class=&quot;user-hover&quot; rel=&quot;joshrosen&quot;&gt;joshrosen&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;A false-negative considered previously:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select &lt;span class=&quot;code-quote&quot;&gt;&apos;\\\\&apos;&lt;/span&gt; rlike &lt;span class=&quot;code-quote&quot;&gt;&apos;.*\\\\\\\\.*&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It returned true, which is correct if we assume that the pattern is treated as a Java string but not raw string.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13007185">SPARK-17647</key>
            <summary>SQL LIKE does not handle backslashes correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mengxr">Xiangrui Meng</assignee>
                                    <reporter username="mengxr">Xiangrui Meng</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Fri, 23 Sep 2016 15:55:13 +0000</created>
                <updated>Wed, 13 Jan 2021 22:02:52 +0000</updated>
                            <resolved>Mon, 17 Apr 2017 18:20:13 +0000</resolved>
                                                    <fixVersion>2.1.1</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                                                                                <comments>
                            <comment id="15517589" author="joshrosen" created="Fri, 23 Sep 2016 21:12:52 +0000"  >&lt;p&gt;I think that the first case is clearly a bug (and have a fix) but I&apos;m not so sure about the second case. Consider:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;.*\\\\\\\\.*&quot;&lt;/span&gt;.r.findFirstIn(&lt;span class=&quot;code-quote&quot;&gt;&quot;\\\\&quot;&lt;/span&gt;)
res8: Option[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;] = Some(\\)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In a regular expression, two backslashes denote an escaped backslash. Setting Java strings aside for a moment, consider using pencil/paper to writing a regex which matches a single backslash character: in the context of a regex a backslash character acts as an escape character, so you need two consecutive backslashes. When we take our handwritten regex with two backslashes and encode this into a Java string we need to add an additional layer of backslash escaping to work around the character escaping for Java strings, yielding four consecutive backslashes.&lt;/p&gt;

&lt;p&gt;One illustration of this is the fact that the Java string literal &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;\\&quot;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; is not considered a valid regex:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;\\&quot;&lt;/span&gt;.r
java.util.regex.PatternSyntaxException: Unexpected internal error near index 1
\
 ^
  at java.util.regex.Pattern.error(Pattern.java:1955)
  at java.util.regex.Pattern.compile(Pattern.java:1702)
  at java.util.regex.Pattern.&amp;lt;init&amp;gt;(Pattern.java:1351)
  at java.util.regex.Pattern.compile(Pattern.java:1028)
  at scala.util.matching.Regex.&amp;lt;init&amp;gt;(Regex.scala:191)
  at scala.collection.immutable.StringLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;r(StringLike.scala:284)
  at scala.collection.immutable.StringOps.r(StringOps.scala:29)
  at scala.collection.immutable.StringLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;r(StringLike.scala:273)
  at scala.collection.immutable.StringOps.r(StringOps.scala:29)
  ... 28 elided
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The second example returns &lt;tt&gt;true&lt;/tt&gt; on MySQL.&lt;/p&gt;

&lt;p&gt;On MySQL, running &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select &lt;span class=&quot;code-quote&quot;&gt;&apos;\\&apos;&lt;/span&gt; rlike &lt;span class=&quot;code-quote&quot;&gt;&apos;\\&apos;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; will fail with a syntax error because this will be interpreted as a trailing escape character rather than as a backslash literal, while &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select &lt;span class=&quot;code-quote&quot;&gt;&apos;\\&apos;&lt;/span&gt; rlike &lt;span class=&quot;code-quote&quot;&gt;&apos;\\\\&apos;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; will return true.&lt;/p&gt;</comment>
                            <comment id="15517636" author="joshrosen" created="Fri, 23 Sep 2016 21:33:29 +0000"  >&lt;p&gt;On the other hand, running &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select &lt;span class=&quot;code-quote&quot;&gt;&apos;\\\\&apos;&lt;/span&gt; like &lt;span class=&quot;code-quote&quot;&gt;&apos;%\\%&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;seems to return false in MySQL (because I think this is being interpreted as &quot;any characters followed by a literal percent&quot;), but it returns true in Postgres. I&apos;m running postgres via &lt;tt&gt;psql&lt;/tt&gt; and MySQL via MySQLWorkbench.&lt;/p&gt;</comment>
                            <comment id="15517656" author="joshrosen" created="Fri, 23 Sep 2016 21:43:27 +0000"  >&lt;p&gt;Another piece of evidence to help untangle this:&lt;/p&gt;

&lt;p&gt;In MySQL,&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select &lt;span class=&quot;code-quote&quot;&gt;&apos;\\&apos;&lt;/span&gt; like &lt;span class=&quot;code-quote&quot;&gt;&apos;\\&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;\\&apos;&lt;/span&gt; rlike &lt;span class=&quot;code-quote&quot;&gt;&apos;\\\\&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;returns &lt;tt&gt;true&lt;/tt&gt; for both columns, illustrating that &lt;tt&gt;like&lt;/tt&gt; and &lt;tt&gt;rlike&lt;/tt&gt; seem to have different escaping rules.&lt;/p&gt;

&lt;p&gt;However,&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select 
  &lt;span class=&quot;code-quote&quot;&gt;&apos;\\&apos;&lt;/span&gt; like &lt;span class=&quot;code-quote&quot;&gt;&apos;\\\\&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;\\&apos;&lt;/span&gt; like &lt;span class=&quot;code-quote&quot;&gt;&apos;\\&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;returns &lt;tt&gt;true&lt;/tt&gt; for both columns in MySQL and &lt;tt&gt;true, false&lt;/tt&gt; in Postgres.&lt;/p&gt;</comment>
                            <comment id="15523623" author="mengxr" created="Mon, 26 Sep 2016 17:05:44 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joshrosen&quot; class=&quot;user-hover&quot; rel=&quot;joshrosen&quot;&gt;joshrosen&lt;/a&gt;! I updated the JIRA description. The LIKE escaping behaviors in MySQL/PostgreSQL are documented here:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;MySQL: &lt;a href=&quot;http://dev.mysql.com/doc/refman/5.7/en/string-comparison-functions.html#operator_like&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://dev.mysql.com/doc/refman/5.7/en/string-comparison-functions.html#operator_like&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;PostgreSQL: &lt;a href=&quot;https://www.postgresql.org/docs/8.3/static/functions-matching.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.postgresql.org/docs/8.3/static/functions-matching.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In particular, MySQL:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception: At the end of the pattern string, backslash can be specified as &#8220;\\&#8221;.
At the end of the string, backslash stands for itself because there is nothing following to escape.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That explains why MySQL returns true for both&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&apos;\\&apos;&lt;/span&gt; like &lt;span class=&quot;code-quote&quot;&gt;&apos;\\\\&apos;&lt;/span&gt;
&lt;span class=&quot;code-quote&quot;&gt;&apos;\\&apos;&lt;/span&gt; like &lt;span class=&quot;code-quote&quot;&gt;&apos;\\&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15553357" author="yhuai" created="Thu, 6 Oct 2016 22:08:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smilegator&quot; class=&quot;user-hover&quot; rel=&quot;smilegator&quot;&gt;smilegator&lt;/a&gt; Anyone from your side has time to take a look at it?&lt;/p&gt;</comment>
                            <comment id="15553424" author="smilegator" created="Thu, 6 Oct 2016 22:34:19 +0000"  >&lt;p&gt;Sure, let me check it with my teammates. Thanks!&lt;/p&gt;</comment>
                            <comment id="15553517" author="jodersky" created="Thu, 6 Oct 2016 23:15:16 +0000"  >&lt;p&gt;Xiao pointed me to this issue, I can take a look at it&lt;/p&gt;</comment>
                            <comment id="15556767" author="apachespark" created="Sat, 8 Oct 2016 00:35:05 +0000"  >&lt;p&gt;User &apos;jodersky&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15398&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15398&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15734678" author="mengxr" created="Fri, 9 Dec 2016 08:19:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rxin%40databricks.com&quot; class=&quot;user-hover&quot; rel=&quot;rxin@databricks.com&quot;&gt;rxin@databricks.com&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;yhuai&lt;/a&gt; I think this is a critical correctness bug, which should be fixed in 2.1. Thoughts?&lt;/p&gt;</comment>
                            <comment id="15736107" author="jodersky" created="Fri, 9 Dec 2016 19:37:33 +0000"  >&lt;p&gt;I rebased the PR and resolved the conflict. However, there is still the incompatibility issue with the sql ANTLR parser. I talk about it in my last &lt;a href=&quot;https://github.com/apache/spark/pull/15398#issuecomment-255917940&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;two comments &lt;/a&gt; and propose a few solutions. Any feedback is welcome!&lt;/p&gt;</comment>
                            <comment id="15971675" author="apachespark" created="Mon, 17 Apr 2017 21:39:03 +0000"  >&lt;p&gt;User &apos;felixcheung&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17663&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17663&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16295261" author="djiangxu" created="Mon, 18 Dec 2017 17:03:48 +0000"  >&lt;p&gt;Are we sure this issue is resolved, I tested the following on spark-shell 2.2.0&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Welcome to
      ____              __
     / __/__  ___ _____/ /__
    _\ \/ _ \/ _ `/ __/  &apos;_/
   /___/ .__/\_,_/_/ /_/\_\   version 2.2.0
      /_/
         
Using Scala version 2.11.8 (Java HotSpot(TM) 64-Bit Server VM, Java 1.8.0_25)
Type in expressions to have them evaluated.
Type :help &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; more information.

scala&amp;gt; spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select &lt;span class=&quot;code-quote&quot;&gt;&apos;\\\\&apos;&lt;/span&gt; like &lt;span class=&quot;code-quote&quot;&gt;&apos;%\\%&apos;&lt;/span&gt;&quot;&lt;/span&gt;).show
+----------+
|\ LIKE %\%|
+----------+
|     &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;|
+----------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;same in spark-sql&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
spark-sql&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&apos;\\\\&apos;&lt;/span&gt; like &lt;span class=&quot;code-quote&quot;&gt;&apos;%\\%&apos;&lt;/span&gt;;
&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
Time taken: 2.296 seconds, Fetched 1 row(s)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16295976" author="maropu" created="Tue, 19 Dec 2017 01:13:58 +0000"  >&lt;p&gt;I&apos;m looking  into the code and I&apos;ll make a follow-up pr.&lt;/p&gt;</comment>
                            <comment id="16296234" author="maropu" created="Tue, 19 Dec 2017 05:29:07 +0000"  >&lt;p&gt;Probably, is it okay to set `spark.sql.parser.escapedStringLiterals` to true?&lt;/p&gt;</comment>
                            <comment id="16298456" author="cloud_fan" created="Wed, 20 Dec 2017 13:04:17 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select &lt;span class=&quot;code-quote&quot;&gt;&apos;\\\\&apos;&lt;/span&gt; like &lt;span class=&quot;code-quote&quot;&gt;&apos;%\\%&apos;&lt;/span&gt;&quot;&lt;/span&gt;).show
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;actually is&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select &lt;span class=&quot;code-quote&quot;&gt;&apos;\\&apos;&lt;/span&gt; like &lt;span class=&quot;code-quote&quot;&gt;&apos;%\%&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;as SQL statement, after the java string escaping.&lt;/p&gt;</comment>
                            <comment id="16877599" author="swiegleb" created="Wed, 3 Jul 2019 07:44:06 +0000"  >&lt;p&gt;I have tested this behavior with spark 2.4.2 and it seems to be that the bug is still there.&lt;/p&gt;

&lt;p&gt;With:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
spark.sql.parser.escapedStringLiterals=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;backslash it is working, but I&#160;run into failures with escaping&#160;&quot; and &apos; .&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
the escape character is not allowed to precede &lt;span class=&quot;code-quote&quot;&gt;&apos;\&quot;&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I have tested the behavior with the following special characters and their escaping:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
_ % \ &apos; &quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So both modes will not cover the full spectrum of escaping special characters.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17264452" author="noahkawasakigoogle" created="Wed, 13 Jan 2021 22:02:52 +0000"  >&lt;p&gt;I can also confirm that this issue is not fully resolved. Like what &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=swiegleb&quot; class=&quot;user-hover&quot; rel=&quot;swiegleb&quot;&gt;swiegleb&lt;/a&gt;&#160;has shown, escape characters are not fully supported.&#160;&lt;/p&gt;

&lt;p&gt;I have tested Spark versions 2.1, 2.2, 2.3, 2.4, and 3.0 and they all experience the issue:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# These &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; the expected backslash
SET spark.sql.parser.escapedStringLiterals=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
SELECT &lt;span class=&quot;code-quote&quot;&gt;&apos;\\&apos;&lt;/span&gt;;
&amp;gt; \
(should &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; \\)

SELECT &lt;span class=&quot;code-quote&quot;&gt;&apos;hi\hi&apos;&lt;/span&gt;;
&amp;gt; hihi
(should &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; hi\hi) 


# These are correctly escaped
SELECT &lt;span class=&quot;code-quote&quot;&gt;&apos;\&quot;&apos;&lt;/span&gt;;
&amp;gt; &quot;

 SELECT &lt;span class=&quot;code-quote&quot;&gt;&apos;\&apos;&lt;/span&gt;&apos;;
&amp;gt; &apos;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If I switch this:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# These now work
SET spark.sql.parser.escapedStringLiterals=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
SELECT &lt;span class=&quot;code-quote&quot;&gt;&apos;\\&apos;&lt;/span&gt;;
&amp;gt; \\

SELECT &lt;span class=&quot;code-quote&quot;&gt;&apos;hi\hi&apos;&lt;/span&gt;;
&amp;gt; hi\hi


# These are now not correctly escaped
SELECT &lt;span class=&quot;code-quote&quot;&gt;&apos;\&quot;&apos;&lt;/span&gt;;
&amp;gt; \&quot;
(should &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &quot;)

SELECT &lt;span class=&quot;code-quote&quot;&gt;&apos;\&apos;&lt;/span&gt;&apos;;
&amp;gt; \&apos;
(should &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &apos; )&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;So basically we have to choose:&lt;/p&gt;

&lt;p&gt;SET spark.sql.parser.escapedStringLiterals=false; if we want backslashes correctly escaped but not other special characters&lt;/p&gt;


&lt;p&gt;SET spark.sql.parser.escapedStringLiterals=true; if we want other special characters correctly escaped but not backslashes&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="13042205">SPARK-19555</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 43 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i340g7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>