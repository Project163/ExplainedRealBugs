<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:25:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-34558] warehouse path should be resolved ahead of populating and use</title>
                <link>https://issues.apache.org/jira/browse/SPARK-34558</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Currently, the warehouse path gets fully qualified in the caller side for creating a database, table, partition, etc. An unqualified path is populated into Spark and Hadoop confs, which leads to inconsistent API behaviors.  We should make it qualified ahead.&lt;/p&gt;


&lt;p&gt;When the value is a relative path `spark.sql.warehouse.dir=lakehouse`, for example.&lt;/p&gt;

&lt;p&gt;If the default database is absent at runtime, the app fails with&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.IllegalArgumentException: java.net.URISyntaxException: Relative path in absolute URI: file:./datalake
	at org.apache.hadoop.fs.Path.initialize(Path.java:263)
	at org.apache.hadoop.fs.Path.&amp;lt;init&amp;gt;(Path.java:254)
	at org.apache.hadoop.hive.metastore.Warehouse.getDnsPath(Warehouse.java:133)
	at org.apache.hadoop.hive.metastore.Warehouse.getDnsPath(Warehouse.java:137)
	at org.apache.hadoop.hive.metastore.Warehouse.getWhRoot(Warehouse.java:150)
	at org.apache.hadoop.hive.metastore.Warehouse.getDefaultDatabasePath(Warehouse.java:163)
	at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.createDefaultDB_core(HiveMetaStore.java:636)
	at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.createDefaultDB(HiveMetaStore.java:655)
	at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.init(HiveMetaStore.java:431)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.hadoop.hive.metastore.RetryingHMSHandler.invokeInternal(RetryingHMSHandler.java:148)
	at org.apache.hadoop.hive.metastore.RetryingHMSHandler.invoke(RetryingHMSHandler.java:107)
	at org.apache.hadoop.hive.metastore.RetryingHMSHandler.&amp;lt;init&amp;gt;(RetryingHMSHandler.java:79)
	... 73 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the default database is present at runtime, the app can work with it, and if we create a database, it gets fully qualified, for example&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
spark-&lt;span class=&quot;code-keyword&quot;&gt;sql&lt;/span&gt;&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;database&lt;/span&gt; test2 &lt;span class=&quot;code-keyword&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;datalake&apos;&lt;/span&gt;;
21/02/26 21:52:57 WARN ObjectStore: Failed &lt;span class=&quot;code-keyword&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;database&lt;/span&gt; test2, returning NoSuchObjectException
&lt;span class=&quot;code-keyword&quot;&gt;Time&lt;/span&gt; taken: 0.052 seconds
spark-&lt;span class=&quot;code-keyword&quot;&gt;sql&lt;/span&gt;&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;desc&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;database&lt;/span&gt; test;
&lt;span class=&quot;code-keyword&quot;&gt;Database&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;Name&lt;/span&gt;	test
Comment
&lt;span class=&quot;code-keyword&quot;&gt;Location&lt;/span&gt;	&lt;span class=&quot;code-keyword&quot;&gt;file&lt;/span&gt;:/Users/kentyao/Downloads/spark/spark-3.2.0-SNAPSHOT-bin-20210226/datalake/test.db
&lt;span class=&quot;code-keyword&quot;&gt;Owner&lt;/span&gt;	kentyao
&lt;span class=&quot;code-keyword&quot;&gt;Time&lt;/span&gt; taken: 0.023 seconds, Fetched 4 &lt;span class=&quot;code-keyword&quot;&gt;row&lt;/span&gt;(s)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Another thing is that the log becomes nubilous, for example.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
21/02/27 13:54:17 INFO SharedState: Setting hive.metastore.warehouse.dir (&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&apos;&lt;/span&gt;) to the value of spark.sql.warehouse.dir (&lt;span class=&quot;code-quote&quot;&gt;&apos;datalake&apos;&lt;/span&gt;).
21/02/27 13:54:17 INFO SharedState: Warehouse path is &lt;span class=&quot;code-quote&quot;&gt;&apos;datalake&apos;&lt;/span&gt;.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


</description>
                <environment></environment>
        <key id="13361311">SPARK-34558</key>
            <summary>warehouse path should be resolved ahead of populating and use</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Qin Yao">Kent Yao 2</assignee>
                                    <reporter username="Qin Yao">Kent Yao 2</reporter>
                        <labels>
                    </labels>
                <created>Sat, 27 Feb 2021 05:57:16 +0000</created>
                <updated>Fri, 21 May 2021 16:26:06 +0000</updated>
                            <resolved>Tue, 2 Mar 2021 15:14:50 +0000</resolved>
                                    <version>3.0.2</version>
                    <version>3.1.2</version>
                                    <fixVersion>3.2.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17292035" author="apachespark" created="Sat, 27 Feb 2021 06:21:42 +0000"  >&lt;p&gt;User &apos;yaooqinn&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/31671&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/31671&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17293770" author="cloud_fan" created="Tue, 2 Mar 2021 15:14:50 +0000"  >&lt;p&gt;Issue resolved by pull request 31671&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/31671&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/31671&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17303506" author="apachespark" created="Wed, 17 Mar 2021 14:59:31 +0000"  >&lt;p&gt;User &apos;cloud-fan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/31868&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/31868&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17349294" author="apachespark" created="Fri, 21 May 2021 14:28:42 +0000"  >&lt;p&gt;User &apos;cloud-fan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/32622&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/32622&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17349295" author="apachespark" created="Fri, 21 May 2021 14:28:57 +0000"  >&lt;p&gt;User &apos;cloud-fan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/32622&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/32622&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17349363" author="apachespark" created="Fri, 21 May 2021 16:26:06 +0000"  >&lt;p&gt;User &apos;dongjoon-hyun&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/32623&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/32623&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 25 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0o4cg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>