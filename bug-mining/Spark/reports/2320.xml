<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:31:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-9725] spark sql query string field return empty/garbled string</title>
                <link>https://issues.apache.org/jira/browse/SPARK-9725</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;to reproduce it:&lt;br/&gt;
1 deploy spark cluster mode, i use standalone mode locally&lt;br/&gt;
2 set executor memory &amp;gt;= 32g, set following config in spark-default.xml&lt;br/&gt;
   spark.executor.memory            36g &lt;/p&gt;

&lt;p&gt;3 run spark-sql.sh with &quot;show tables&quot; it return empty/garbled string&lt;/p&gt;</description>
                <environment></environment>
        <key id="12852845">SPARK-9725</key>
            <summary>spark sql query string field return empty/garbled string</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davies">Davies Liu</assignee>
                                    <reporter username="scwf">Fei Wang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Aug 2015 01:03:45 +0000</created>
                <updated>Fri, 21 Aug 2015 08:08:50 +0000</updated>
                            <resolved>Sat, 15 Aug 2015 05:31:44 +0000</resolved>
                                                    <fixVersion>1.5.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14661333" author="davies" created="Fri, 7 Aug 2015 05:15:50 +0000"  >&lt;p&gt;I tried with latest master in standalone mode :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;davies@localhost:~/work/spark$ bin/spark-sql --master spark:&lt;span class=&quot;code-comment&quot;&gt;//localhost:7077
&lt;/span&gt;NOTE: SPARK_PREPEND_CLASSES is set, placing locally compiled Spark classes ahead of assembly.
SET hive.support.sql11.reserved.keywords=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
SET spark.sql.hive.version=1.2.1
SET spark.sql.hive.version=1.2.1
spark-sql&amp;gt; show tables;
src	&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
srcaaaa	&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
srcbbbb	&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
Time taken: 1.968 seconds, Fetched 3 row(s)
spark-sql&amp;gt; CREATE TABLE IF NOT EXISTS srcbasdfasdfasdf (key INT, value STRING);
OK
Time taken: 1.956 seconds
spark-sql&amp;gt; show tables;
src	&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
srcaaaa	&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
srcbasdfasdfasdf	&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
srcbbbb	&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
Time taken: 0.102 seconds, Fetched 4 row(s)
spark-sql&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can&apos;t reproduce your problem, how many tables do you have?&lt;/p&gt;</comment>
                            <comment id="14661383" author="scwf" created="Fri, 7 Aug 2015 06:07:31 +0000"  >&lt;p&gt;how much memory you set to executor?&lt;/p&gt;</comment>
                            <comment id="14661389" author="scwf" created="Fri, 7 Aug 2015 06:20:35 +0000"  >&lt;p&gt;i try the master again and reproduce this issue:&lt;/p&gt;


&lt;p&gt;M151:/home/wf/spark # bin/spark-sql&lt;br/&gt;
SET hive.support.sql11.reserved.keywords=false&lt;br/&gt;
SET spark.sql.hive.version=1.2.1&lt;br/&gt;
SET spark.sql.hive.version=1.2.1&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Unable to bind key for unsupported operation: backward-delete-word&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Unable to bind key for unsupported operation: backward-delete-word&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Unable to bind key for unsupported operation: down-history&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Unable to bind key for unsupported operation: up-history&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Unable to bind key for unsupported operation: up-history&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Unable to bind key for unsupported operation: down-history&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Unable to bind key for unsupported operation: up-history&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Unable to bind key for unsupported operation: down-history&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Unable to bind key for unsupported operation: up-history&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Unable to bind key for unsupported operation: down-history&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Unable to bind key for unsupported operation: up-history&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Unable to bind key for unsupported operation: down-history&lt;br/&gt;
spark-sql&amp;gt; CREATE TABLE IF NOT EXISTS srcbasdfasdfasdf (key INT, value STRING);&lt;br/&gt;
OK&lt;br/&gt;
Time taken: 3.493 seconds&lt;br/&gt;
spark-sql&amp;gt; CREATE TABLE IF NOT EXISTS src (key INT, value STRING);&lt;br/&gt;
OK&lt;br/&gt;
Time taken: 0.181 seconds&lt;br/&gt;
spark-sql&amp;gt; show tables;&lt;br/&gt;
        false&lt;br/&gt;
srcbasdf        false&lt;br/&gt;
Time taken: 0.211 seconds, Fetched 2 row(s)&lt;br/&gt;
spark-sql&amp;gt; &lt;/p&gt;</comment>
                            <comment id="14662847" author="scwf" created="Sat, 8 Aug 2015 06:52:40 +0000"  >&lt;p&gt;And i not set SPARK_PREPEND_CLASSES&lt;/p&gt;</comment>
                            <comment id="14695652" author="davies" created="Thu, 13 Aug 2015 17:52:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lian+cheng&quot; class=&quot;user-hover&quot; rel=&quot;lian cheng&quot;&gt;lian cheng&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;yhuai&lt;/a&gt; Can you reproduce this issue? I still can&apos;t.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=scwf&quot; class=&quot;user-hover&quot; rel=&quot;scwf&quot;&gt;scwf&lt;/a&gt; Can you narrow down the commit (or range) that introduce this issue?&lt;/p&gt;</comment>
                            <comment id="14696230" author="lian cheng" created="Fri, 14 Aug 2015 00:34:56 +0000"  >&lt;p&gt;I don&apos;t have so much memory to reproduce this issue if the 32g executor memory setting is really a necessity...&lt;/p&gt;</comment>
                            <comment id="14696235" author="lian cheng" created="Fri, 14 Aug 2015 00:37:05 +0000"  >&lt;p&gt;Seems that the result of &lt;tt&gt;show tables&lt;/tt&gt; is truncated rather than garbled?&lt;/p&gt;</comment>
                            <comment id="14696323" author="scwf" created="Fri, 14 Aug 2015 02:00:38 +0000"  >&lt;p&gt;in some cases(the long table name) of ours it also show garbled string.&lt;/p&gt;</comment>
                            <comment id="14696324" author="scwf" created="Fri, 14 Aug 2015 02:01:44 +0000"  >&lt;p&gt;we test on suse and redhat, both has this issue.&lt;br/&gt;
Now we find some clue, will post here later.&lt;/p&gt;</comment>
                            <comment id="14696336" author="doingdone9" created="Fri, 14 Aug 2015 02:15:27 +0000"  >&lt;p&gt;I have debug this issue  and i find BYTE_ARRAY_OFFSET has different result when i use different memory.&lt;br/&gt;
 when set spark.executor.memory=36g, BYTE_ARRAY_OFFSET is 24, but  set spark.executor.memory=30g,  BYTE_ARRAY_OFFSET is 16. So getBytes() of UTF8String will enter different branches when i use different memory. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davies&quot; class=&quot;user-hover&quot; rel=&quot;davies&quot;&gt;davies&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lian+cheng&quot; class=&quot;user-hover&quot; rel=&quot;lian cheng&quot;&gt;lian cheng&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=scwf&quot; class=&quot;user-hover&quot; rel=&quot;scwf&quot;&gt;scwf&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14696449" author="scwf" created="Fri, 14 Aug 2015 04:19:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davies&quot; class=&quot;user-hover&quot; rel=&quot;davies&quot;&gt;davies&lt;/a&gt; please see the comment of peizhongshuai&lt;/p&gt;</comment>
                            <comment id="14696475" author="rxin" created="Fri, 14 Aug 2015 04:58:04 +0000"  >&lt;p&gt;It&apos;s always the case that the offset is dependent on the JVM environment (e.g. heap size, compressed oops).&lt;/p&gt;

&lt;p&gt;Why would they hit different branches? &quot;offset&quot; should change according to BYTE_ARRAY_OFFSET as well.&lt;/p&gt;</comment>
                            <comment id="14696684" author="doingdone9" created="Fri, 14 Aug 2015 08:15:57 +0000"  >&lt;p&gt;In my environment,&quot;offset&quot; did not change according to BYTE_ARRAY_OFFSET.&lt;br/&gt;
when set spark.executor.memory=36g, &quot;BYTE_ARRAY_OFFSET&quot; is 24, &quot;offset&quot; is 16 , but set spark.executor.memory=30g, &quot;BYTE_ARRAY_OFFSET&quot; is 16,  &quot;offset&quot; is 16 too. So &quot;if (offset == BYTE_ARRAY_OFFSET &amp;amp;&amp;amp; base instanceof byte[]  &amp;amp;&amp;amp; ((byte[]) base).length == numBytes)&quot; will get different result. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rxin&quot; class=&quot;user-hover&quot; rel=&quot;rxin&quot;&gt;rxin&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="14697378" author="davies" created="Fri, 14 Aug 2015 17:00:26 +0000"  >&lt;p&gt;So the problem came from serialization of UTF8String (it&apos;s not portable) across different executor/driver with different memory or JVM environments. Is it right?&lt;/p&gt;</comment>
                            <comment id="14697426" author="davies" created="Fri, 14 Aug 2015 17:32:27 +0000"  >&lt;p&gt;I can reproduce this issue now (&amp;lt;32G for executor, &amp;gt; 32G for driver).&lt;/p&gt;

&lt;p&gt;Many things are broken:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; sqlContext.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select &lt;span class=&quot;code-quote&quot;&gt;&apos;abc&apos;&lt;/span&gt;&quot;&lt;/span&gt;).collect()
res0: Array[org.apache.spark.sql.Row] = Array([???])

scala&amp;gt; sqlContext.range(10).registerTempTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;)

scala&amp;gt; sqlContext.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select &lt;span class=&quot;code-quote&quot;&gt;&apos;abc&apos;&lt;/span&gt;,id from t&quot;&lt;/span&gt;).collect()
res2: Array[org.apache.spark.sql.Row] = Array([???,0], [???,1], [???,2], [???,3], [???,4], [???,5], [???,6], [???,7], [???,8], [???,9])
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14697474" author="apachespark" created="Fri, 14 Aug 2015 18:06:05 +0000"  >&lt;p&gt;User &apos;davies&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/8210&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/8210&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14698120" author="davies" created="Sat, 15 Aug 2015 05:31:44 +0000"  >&lt;p&gt;Issue resolved by pull request 8210&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/8210&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/8210&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14698124" author="scwf" created="Sat, 15 Aug 2015 05:41:09 +0000"  >&lt;p&gt;good job &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 14 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ig7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332078">1.5.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>