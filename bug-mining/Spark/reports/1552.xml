<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:24:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-5845] Time to cleanup spilled shuffle files not included in shuffle write time</title>
                <link>https://issues.apache.org/jira/browse/SPARK-5845</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When the disk is contended, I&apos;ve observed cases when it takes as long as 7 seconds to clean up all of the intermediate spill files for a shuffle (when using the sort based shuffle, but bypassing merging because there are &amp;lt;=200 shuffle partitions).  This is even when the shuffle data is non-huge (152MB written from one of the tasks where I observed this).  This is effectively part of the shuffle write time (because it&apos;s a necessary side effect of writing data to disk) so should be added to the shuffle write time to facilitate debugging.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12775461">SPARK-5845</key>
            <summary>Time to cleanup spilled shuffle files not included in shuffle write time</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ilganeli">Ilya Ganelin</assignee>
                                    <reporter username="kayousterhout">Kay Ousterhout</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Feb 2015 21:07:47 +0000</created>
                <updated>Sun, 17 May 2020 18:30:19 +0000</updated>
                            <resolved>Fri, 13 Mar 2015 13:21:15 +0000</resolved>
                                    <version>1.2.1</version>
                    <version>1.3.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>Shuffle</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14333691" author="ilganeli" created="Mon, 23 Feb 2015 19:25:59 +0000"  >&lt;p&gt;Hi Kay - I can knock this one out. Thanks. &lt;/p&gt;</comment>
                            <comment id="14335646" author="ilganeli" created="Tue, 24 Feb 2015 23:19:33 +0000"  >&lt;p&gt;If I understand correctly, the file cleanup happens in IndexShuffleBlockManager:::removeDataByMap(), which is called from either the SortShuffleManager or the SortShuffleWriter. The problem is that these classes do not have any knowledge of the currently collected metrics. Furthermore, the disk cleanup is, unless configured in the SparkConf, triggered asynchronously via the RemoveShuffle message so there doesn&apos;t appear to be a straightforward way to provide a set of metrics to be updated. &lt;/p&gt;

&lt;p&gt;Do you have any suggestions for getting around this? Please let me know, thank you. &lt;/p&gt;</comment>
                            <comment id="14335667" author="pwendell" created="Tue, 24 Feb 2015 23:33:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kayousterhout&quot; class=&quot;user-hover&quot; rel=&quot;kayousterhout&quot;&gt;kayousterhout&lt;/a&gt; did you mean the time required to delete spill files used during aggregation? For the shuffle files themselves, they are deleted asynchronously, as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ilganeli&quot; class=&quot;user-hover&quot; rel=&quot;ilganeli&quot;&gt;ilganeli&lt;/a&gt; has mentioned.&lt;/p&gt;</comment>
                            <comment id="14335676" author="kayousterhout" created="Tue, 24 Feb 2015 23:46:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pwendell&quot; class=&quot;user-hover&quot; rel=&quot;pwendell&quot;&gt;pwendell&lt;/a&gt; that&apos;s exactly what I meant &amp;#8211; I just updated the JIRA description.&lt;/p&gt;</comment>
                            <comment id="14335751" author="ilganeli" created="Wed, 25 Feb 2015 00:51:01 +0000"  >&lt;p&gt;My mistake - missed your comment about the spill files in the detailed description. Given that we&apos;re interested in cleaning up the spill files which appear to be cleaned up in ExternalSorter.stop() (please correct me if I&apos;m wrong), I would like to either &lt;/p&gt;

&lt;p&gt;a) Pass the context to the stop() method - this is possible since the SortShuffleWriter has visibility of the TaskContext (which in turn stores the metrics we&apos;re interested in).&lt;/p&gt;

&lt;p&gt;b) (My preference since it won&apos;t break the existing interface) Surround sorter.stop() on line 91 of SortShuffleWriter.scala with a timer. The only downside to this second approach is that it will also include the cleanup of the partition writers. I&apos;m not sure whether that should be included in this time computation. &lt;/p&gt;</comment>
                            <comment id="14335757" author="kayousterhout" created="Wed, 25 Feb 2015 00:54:36 +0000"  >&lt;p&gt;I&apos;d go with (b) &amp;#8211; it&apos;s fine (and good, I think!) to include time to cleanup the partition writers, since this also involves interacting with the disk.  Thanks!&lt;/p&gt;</comment>
                            <comment id="14339794" author="ilganeli" created="Fri, 27 Feb 2015 06:34:56 +0000"  >&lt;p&gt;I&apos;m code complete on this, will submit a PR shortly.&lt;/p&gt;</comment>
                            <comment id="14355638" author="apachespark" created="Tue, 10 Mar 2015 20:30:53 +0000"  >&lt;p&gt;User &apos;ilganeli&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/4965&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/4965&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14360324" author="srowen" created="Fri, 13 Mar 2015 13:21:16 +0000"  >&lt;p&gt;Issue resolved by pull request 4965&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/4965&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/4965&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25p0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>