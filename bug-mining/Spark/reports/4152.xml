<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:48:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-17123] Performing set operations that combine string and date / timestamp columns may result in generated projection code which doesn&apos;t compile</title>
                <link>https://issues.apache.org/jira/browse/SPARK-17123</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The following example program causes SpecificSafeProjection code generation to produce Java code which doesn&apos;t compile:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.types._
spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;set spark.sql.codegen.fallback=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;)
val dateDF = spark.createDataFrame(sc.parallelize(Seq(Row(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; java.sql.Date(0)))), StructType(StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;, DateType) :: Nil))
val longDF = sc.parallelize(Seq(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; java.sql.Date(0).toString)).toDF
dateDF.union(longDF).collect()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This fails at runtime with the following error:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;failed to compile: org.codehaus.commons.compiler.CompileException: File &lt;span class=&quot;code-quote&quot;&gt;&apos;generated.java&apos;&lt;/span&gt;, Line 28, Column 107: No applicable constructor/method found &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; actual parameters &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.spark.unsafe.types.UTF8String&quot;&lt;/span&gt;; candidates are: &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; java.sql.Date org.apache.spark.sql.catalyst.util.DateTimeUtils.toJavaDate(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)&quot;&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 001 */&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; generate(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] references) {
&lt;span class=&quot;code-comment&quot;&gt;/* 002 */&lt;/span&gt;   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SpecificSafeProjection(references);
&lt;span class=&quot;code-comment&quot;&gt;/* 003 */&lt;/span&gt; }
&lt;span class=&quot;code-comment&quot;&gt;/* 004 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 005 */&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SpecificSafeProjection &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; org.apache.spark.sql.catalyst.expressions.codegen.BaseProjection {
&lt;span class=&quot;code-comment&quot;&gt;/* 006 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 007 */&lt;/span&gt;   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] references;
&lt;span class=&quot;code-comment&quot;&gt;/* 008 */&lt;/span&gt;   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; MutableRow mutableRow;
&lt;span class=&quot;code-comment&quot;&gt;/* 009 */&lt;/span&gt;   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] values;
&lt;span class=&quot;code-comment&quot;&gt;/* 010 */&lt;/span&gt;   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; org.apache.spark.sql.types.StructType schema;
&lt;span class=&quot;code-comment&quot;&gt;/* 011 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 012 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 013 */&lt;/span&gt;   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; SpecificSafeProjection(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] references) {
&lt;span class=&quot;code-comment&quot;&gt;/* 014 */&lt;/span&gt;     &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.references = references;
&lt;span class=&quot;code-comment&quot;&gt;/* 015 */&lt;/span&gt;     mutableRow = (MutableRow) references[references.length - 1];
&lt;span class=&quot;code-comment&quot;&gt;/* 016 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 017 */&lt;/span&gt;     &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.schema = (org.apache.spark.sql.types.StructType) references[0];
&lt;span class=&quot;code-comment&quot;&gt;/* 018 */&lt;/span&gt;   }
&lt;span class=&quot;code-comment&quot;&gt;/* 019 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 020 */&lt;/span&gt;   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; apply(java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; _i) {
&lt;span class=&quot;code-comment&quot;&gt;/* 021 */&lt;/span&gt;     InternalRow i = (InternalRow) _i;
&lt;span class=&quot;code-comment&quot;&gt;/* 022 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 023 */&lt;/span&gt;     values = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[1];
&lt;span class=&quot;code-comment&quot;&gt;/* 024 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 025 */&lt;/span&gt;     &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isNull2 = i.isNullAt(0);
&lt;span class=&quot;code-comment&quot;&gt;/* 026 */&lt;/span&gt;     UTF8String value2 = isNull2 ? &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; : (i.getUTF8String(0));
&lt;span class=&quot;code-comment&quot;&gt;/* 027 */&lt;/span&gt;     &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isNull1 = isNull2;
&lt;span class=&quot;code-comment&quot;&gt;/* 028 */&lt;/span&gt;     &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; java.sql.Date value1 = isNull1 ? &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; : org.apache.spark.sql.catalyst.util.DateTimeUtils.toJavaDate(value2);
&lt;span class=&quot;code-comment&quot;&gt;/* 029 */&lt;/span&gt;     isNull1 = value1 == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;span class=&quot;code-comment&quot;&gt;/* 030 */&lt;/span&gt;     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isNull1) {
&lt;span class=&quot;code-comment&quot;&gt;/* 031 */&lt;/span&gt;       values[0] = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;span class=&quot;code-comment&quot;&gt;/* 032 */&lt;/span&gt;     } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;span class=&quot;code-comment&quot;&gt;/* 033 */&lt;/span&gt;       values[0] = value1;
&lt;span class=&quot;code-comment&quot;&gt;/* 034 */&lt;/span&gt;     }
&lt;span class=&quot;code-comment&quot;&gt;/* 035 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 036 */&lt;/span&gt;     &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; org.apache.spark.sql.Row value = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.apache.spark.sql.catalyst.expressions.GenericRowWithSchema(values, schema);
&lt;span class=&quot;code-comment&quot;&gt;/* 037 */&lt;/span&gt;     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;) {
&lt;span class=&quot;code-comment&quot;&gt;/* 038 */&lt;/span&gt;       mutableRow.setNullAt(0);
&lt;span class=&quot;code-comment&quot;&gt;/* 039 */&lt;/span&gt;     } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;span class=&quot;code-comment&quot;&gt;/* 040 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 041 */&lt;/span&gt;       mutableRow.update(0, value);
&lt;span class=&quot;code-comment&quot;&gt;/* 042 */&lt;/span&gt;     }
&lt;span class=&quot;code-comment&quot;&gt;/* 043 */&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* 044 */&lt;/span&gt;     &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; mutableRow;
&lt;span class=&quot;code-comment&quot;&gt;/* 045 */&lt;/span&gt;   }
&lt;span class=&quot;code-comment&quot;&gt;/* 046 */&lt;/span&gt; }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here, the invocation of &lt;tt&gt;DateTimeUtils.toJavaDate&lt;/tt&gt; is incorrect because the generated code tries to call it with a UTF8String while the method expects an int instead.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12998101">SPARK-17123</key>
            <summary>Performing set operations that combine string and date / timestamp columns may result in generated projection code which doesn&apos;t compile</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gurwls223">Hyukjin Kwon</assignee>
                                    <reporter username="joshrosen">Josh Rosen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Aug 2016 05:43:53 +0000</created>
                <updated>Mon, 12 Dec 2022 17:35:47 +0000</updated>
                            <resolved>Sat, 22 Oct 2016 18:10:52 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.2</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15436393" author="rxin" created="Thu, 25 Aug 2016 07:10:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dongjoon&quot; class=&quot;user-hover&quot; rel=&quot;dongjoon&quot;&gt;dongjoon&lt;/a&gt; are you still working on this?&lt;/p&gt;</comment>
                            <comment id="15436404" author="dongjoon" created="Thu, 25 Aug 2016 07:20:42 +0000"  >&lt;p&gt;Not now. Unfortunately, my first attempt failed eventually. So I removed my comment not to make the other people confused.&lt;/p&gt;</comment>
                            <comment id="15486354" author="apachespark" created="Tue, 13 Sep 2016 05:55:08 +0000"  >&lt;p&gt;User &apos;HyukjinKwon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15072&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15072&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15599444" author="apachespark" created="Sun, 23 Oct 2016 09:58:05 +0000"  >&lt;p&gt;User &apos;HyukjinKwon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15601&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15601&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16305577" author="wassimdr" created="Thu, 28 Dec 2017 16:36:05 +0000"  >&lt;p&gt;Hello, having same issue at runtime in java with spark 2.2.0, could you please suggest a solution &lt;/p&gt;

&lt;p&gt;&lt;tt&gt;org.codehaus.commons.compiler.CompileException: File &apos;generated.java&apos;, Line 214, Column 114: No applicable constructor/method found for actual parameters &quot;org.apache.spark.unsafe.types.UTF8String&quot;; candidates are: &quot;public static java.sql.Date org.apache.spark.sql.catalyst.util.DateTimeUtils.toJavaDate(int)&quot;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;dependency&amp;gt;&lt;br/&gt;
   &amp;lt;groupId&amp;gt;org.apache.spark&amp;lt;/groupId&amp;gt;&lt;br/&gt;
   &amp;lt;artifactId&amp;gt;spark-core_2.11&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
   &amp;lt;version&amp;gt;2.2.0&amp;lt;/version&amp;gt;&lt;br/&gt;
&amp;lt;/dependency&amp;gt;&lt;br/&gt;
 &amp;lt;dependency&amp;gt;&lt;br/&gt;
    &amp;lt;groupId&amp;gt;org.apache.spark&amp;lt;/groupId&amp;gt;&lt;br/&gt;
    &amp;lt;artifactId&amp;gt;spark-sql_2.11&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
    &amp;lt;version&amp;gt;2.2.0&amp;lt;/version&amp;gt;&lt;br/&gt;
&amp;lt;/dependency&amp;gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 46 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32ghb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>