<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:35:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-12002] offsetRanges attribute missing in Kafka RDD when resuming from checkpoint</title>
                <link>https://issues.apache.org/jira/browse/SPARK-12002</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-8389&quot; title=&quot;Expose KafkaRDDs offsetRange in Python&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-8389&quot;&gt;&lt;del&gt;SPARK-8389&lt;/del&gt;&lt;/a&gt; added offsetRanges to Kafka direct streams. And &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-10122&quot; title=&quot;AttributeError: &amp;#39;RDD&amp;#39; object has no attribute &amp;#39;offsetRanges&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-10122&quot;&gt;&lt;del&gt;SPARK-10122&lt;/del&gt;&lt;/a&gt; fixed the issue of not ending up with non-Kafka RDDs when chaining transforms to Kafka RDDs. It appears that this issue remains for the case where a streaming application using Kafka direct streams is initialized from the checkpoint directory. The following is a representative example where everything works as expected during the first run, but exceptions are thrown on a subsequent run when the context is being initialized from the checkpoint directory.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;test_checkpoint.py&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from pyspark &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; SparkContext                                                                                            
from pyspark.streaming &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; StreamingContext                                                                              
from pyspark.streaming.kafka &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; KafkaUtils                                                                              


def attach_kafka_metadata(kafka_rdd):                                                                                       
    offset_ranges = kafka_rdd.offsetRanges()                                                                                
                                                                                                                            
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; kafka_rdd                                                                                                        
                                                                                                                            
                                                                                                                            
def create_context():                                                                                                       
    sc = SparkContext(appName=&lt;span class=&quot;code-quote&quot;&gt;&apos;kafka-test&apos;&lt;/span&gt;)                                                                                 
    ssc = StreamingContext(sc, 10)                                                                                          
    ssc.checkpoint(CHECKPOINT_URI)                                                                                          
                                                                                                                            
    kafka_stream = KafkaUtils.createDirectStream(                                                                           
        ssc,                                                                                                                
        [TOPIC],                                                                                                            
        kafkaParams={                                                                                                       
            &lt;span class=&quot;code-quote&quot;&gt;&apos;metadata.broker.list&apos;&lt;/span&gt;: BROKERS,                                                                                
        },                                                                                                                  
    )                                                                                                                       
    kafka_stream.transform(attach_kafka_metadata).count().pprint()                                                          
                                                                                                                            
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ssc                                                                                                              
                                                                                                                            
                                                                                                                            
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; __name__ == &lt;span class=&quot;code-quote&quot;&gt;&quot;__main__&quot;&lt;/span&gt;:                                                                                                  
    ssc = StreamingContext.getOrCreate(CHECKPOINT_URI, create_context)                                                      
    ssc.start()                                                                                                             
    ssc.awaitTermination()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Exception on resuming from checkpoint&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/spark/spark/python/lib/pyspark.zip/pyspark/streaming/util.py&quot;&lt;/span&gt;, line 62, in call
    r = self.func(t, *rdds)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/spark/spark/python/lib/pyspark.zip/pyspark/streaming/kafka.py&quot;&lt;/span&gt;, line 344, in &amp;lt;lambda&amp;gt;
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/spark/batch/test_checkpoint.py&quot;&lt;/span&gt;, line 12, in attach_kafka_metadata
    offset_ranges = kafka_rdd.offsetRanges()
AttributeError: &lt;span class=&quot;code-quote&quot;&gt;&apos;RDD&apos;&lt;/span&gt; object has no attribute &lt;span class=&quot;code-quote&quot;&gt;&apos;offsetRanges&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12916315">SPARK-12002</key>
            <summary>offsetRanges attribute missing in Kafka RDD when resuming from checkpoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jerryshao">Saisai Shao</assignee>
                                    <reporter username="aramesh">Amit Ramesh</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Nov 2015 00:00:38 +0000</created>
                <updated>Wed, 30 Dec 2015 00:22:04 +0000</updated>
                            <resolved>Wed, 30 Dec 2015 00:22:03 +0000</resolved>
                                                    <fixVersion>1.6.0</fixVersion>
                                    <component>DStreams</component>
                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15029058" author="cody@koeninger.org" created="Thu, 26 Nov 2015 16:17:15 +0000"  >&lt;p&gt;Just to be clear, this is a only an issue with python?&lt;/p&gt;</comment>
                            <comment id="15029421" author="jerryshao" created="Fri, 27 Nov 2015 03:36:29 +0000"  >&lt;p&gt;Looks like because Python `KafkaTransformDStream` specific object does not serialize into the checkpoint file, so recovered from checkpoint file it will use default property, which will wrap as default RDD, so function &lt;tt&gt;offsetRanges&lt;/tt&gt; cannot be find.&lt;/p&gt;

&lt;p&gt;My bad I haven&apos;t tested with checkpoint recovery. I will fix it.&lt;/p&gt;</comment>
                            <comment id="15029879" author="apachespark" created="Fri, 27 Nov 2015 13:39:02 +0000"  >&lt;p&gt;User &apos;jerryshao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10017&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10017&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15031278" author="aramesh" created="Mon, 30 Nov 2015 03:07:29 +0000"  >&lt;p&gt;Thanks for picking this up, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15034549" author="apachespark" created="Tue, 1 Dec 2015 20:54:33 +0000"  >&lt;p&gt;User &apos;zsxwing&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10074&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10074&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12838096">SPARK-8389</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12857345">SPARK-10122</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 50 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2oyfb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>