<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:48:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-18207] class &quot;org.apache.spark.sql.catalyst.expressions.GeneratedClass$SpecificUnsafeProjection&quot; grows beyond 64 KB</title>
                <link>https://issues.apache.org/jira/browse/SPARK-18207</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I have 2 wide dataframes that contain nested data structures, when I explode one of the dataframes, it doesn&apos;t include records with an empty nested structure (outer explode not supported).  So, I create a similar dataframe with null values and union them together.  See &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-13721&quot; title=&quot;Add support for LATERAL VIEW OUTER explode()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-13721&quot;&gt;&lt;del&gt;SPARK-13721&lt;/del&gt;&lt;/a&gt; for more details as to why I have to do this.&lt;/p&gt;

&lt;p&gt;I was hoping that &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-16845&quot; title=&quot;org.apache.spark.sql.catalyst.expressions.GeneratedClass$SpecificOrdering&amp;quot; grows beyond 64 KB&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-16845&quot;&gt;&lt;del&gt;SPARK-16845&lt;/del&gt;&lt;/a&gt; was going to address my issue, but it does not.  I was asked by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lwlin&quot; class=&quot;user-hover&quot; rel=&quot;lwlin&quot;&gt;lwlin&lt;/a&gt; to open this JIRA.  &lt;/p&gt;

&lt;p&gt;I will attach a code snippet that can be pasted into spark-shell that duplicates my code and the exception.  This worked just fine in Spark 1.6.x.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.spark.SparkException: Job aborted due to stage failure: Task 35 in stage 5.0 failed 4 times, most recent failure: Lost task 35.3 in stage 5.0 (TID 812, somehost.mydomain.com, executor 8): java.util.concurrent.ExecutionException: java.lang.Exception: failed to compile: org.codehaus.janino.JaninoRuntimeException: Code of method &lt;span class=&quot;code-quote&quot;&gt;&quot;apply(Lorg/apache/spark/sql/catalyst/InternalRow;)Lorg/apache/spark/sql/catalyst/expressions/UnsafeRow;&quot;&lt;/span&gt; of class &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.spark.sql.catalyst.expressions.GeneratedClass$SpecificUnsafeProjection&quot;&lt;/span&gt; grows beyond 64 KB
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13017004">SPARK-18207</key>
            <summary>class &quot;org.apache.spark.sql.catalyst.expressions.GeneratedClass$SpecificUnsafeProjection&quot; grows beyond 64 KB</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kiszk">Kazuaki Ishizaki</assignee>
                                    <reporter username="dondrake">Don Drake</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Nov 2016 21:15:13 +0000</created>
                <updated>Sat, 12 Nov 2016 17:31:09 +0000</updated>
                            <resolved>Tue, 8 Nov 2016 11:05:07 +0000</resolved>
                                    <version>2.0.1</version>
                    <version>2.1.0</version>
                                    <fixVersion>2.1.0</fixVersion>
                                    <component>Optimizer</component>
                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15626714" author="dondrake" created="Tue, 1 Nov 2016 21:21:53 +0000"  >&lt;p&gt;Please read the comments at the top of the attachment, you need to :paste portions of this into spark-shell.&lt;/p&gt;
</comment>
                            <comment id="15628338" author="srowen" created="Wed, 2 Nov 2016 09:26:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-16845&quot; title=&quot;org.apache.spark.sql.catalyst.expressions.GeneratedClass$SpecificOrdering&amp;quot; grows beyond 64 KB&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-16845&quot;&gt;&lt;del&gt;SPARK-16845&lt;/del&gt;&lt;/a&gt; is unresolved and this seems to be exactly the same issue. Why open another jIRA?&lt;/p&gt;</comment>
                            <comment id="15629140" author="dondrake" created="Wed, 2 Nov 2016 14:33:11 +0000"  >&lt;p&gt;I opened it based on &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lwlin&quot; class=&quot;user-hover&quot; rel=&quot;lwlin&quot;&gt;lwlin&lt;/a&gt;&apos;s suggestion in the comments of &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-16845&quot; title=&quot;org.apache.spark.sql.catalyst.expressions.GeneratedClass$SpecificOrdering&amp;quot; grows beyond 64 KB&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-16845&quot;&gt;&lt;del&gt;SPARK-16845&lt;/del&gt;&lt;/a&gt;.  &lt;/p&gt;</comment>
                            <comment id="15629154" author="srowen" created="Wed, 2 Nov 2016 14:37:00 +0000"  >&lt;p&gt;Can you note the difference here? if he&apos;s just saying that one fix X doesn&apos;t fix the issue I don&apos;t know if that means it&apos;s a different issue.&lt;/p&gt;</comment>
                            <comment id="15629177" author="dondrake" created="Wed, 2 Nov 2016 14:45:55 +0000"  >&lt;p&gt;The difference with my case versus the other test cases is that my scenario involves a wide dataframe (800+ columns) that also have multiple nested structures (arrays of classes) involved in a SQL query (union).  &lt;/p&gt;

&lt;p&gt;I have verified that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lwlin&quot; class=&quot;user-hover&quot; rel=&quot;lwlin&quot;&gt;lwlin&lt;/a&gt;&apos;s fix does not work for my case, but it does work for wide dataframes without nested structures.&lt;/p&gt;

&lt;p&gt;I agree it&apos;s similar to the others, but more complicated to reproduce.&lt;/p&gt;</comment>
                            <comment id="15629522" author="kiszk" created="Wed, 2 Nov 2016 16:41:04 +0000"  >&lt;p&gt;I created a smaller program to reproduce this problem, and understand why this error occurs.&lt;br/&gt;
This program tries to calculate a hash value for a row that includes 1000 String fields. During a code generation, &lt;tt&gt;HashExpression.doGenCode&lt;/tt&gt; generates a lot of Java statements to calculate a hash value for the row. The generated code exceeds 64KB. &lt;/p&gt;

&lt;p&gt;I have just created a fix. Can I use this JIRA entry to submit a PR? Or, should I use &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-16845&quot; title=&quot;org.apache.spark.sql.catalyst.expressions.GeneratedClass$SpecificOrdering&amp;quot; grows beyond 64 KB&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-16845&quot;&gt;&lt;del&gt;SPARK-16845&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="15631321" author="apachespark" created="Thu, 3 Nov 2016 02:47:06 +0000"  >&lt;p&gt;User &apos;kiszk&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15745&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15745&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15659978" author="dondrake" created="Sat, 12 Nov 2016 17:31:09 +0000"  >&lt;p&gt;Hi, I was able to download a nightly SNAPSHOT release and verify that this resolves the issue for my project.  Thanks to everyone who contributed to this fix and getting it merged in a timely manner.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12994148">SPARK-16845</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12947678">SPARK-13721</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12836440" name="spark-18207.txt" size="19857" author="dondrake" created="Tue, 1 Nov 2016 21:21:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 1 week, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35ovr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311620" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Shepherd</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>marmbrus</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>