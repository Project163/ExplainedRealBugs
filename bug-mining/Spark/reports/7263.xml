<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:17:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-31990] Streaming&apos;s state store compatibility is broken</title>
                <link>https://issues.apache.org/jira/browse/SPARK-31990</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/pull/28062/files#diff-7a46f10c3cedbf013cf255564d9483cdR2458&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;This line&lt;/a&gt;&#160;of&#160;&lt;a href=&quot;https://github.com/apache/spark/pull/28062&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28062&lt;/a&gt; changed the order of groupCols in dropDuplicates(). Thus, the executor JVM could probably crash, throw a random exception or even return a wrong answer when using the checkpoint written by the previous version.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13311352">SPARK-31990</key>
            <summary>Streaming&apos;s state store compatibility is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="maropu">Takeshi Yamamuro</assignee>
                                    <reporter username="smilegator">Xiao Li</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Sun, 14 Jun 2020 19:10:24 +0000</created>
                <updated>Mon, 15 Jun 2020 14:49:39 +0000</updated>
                            <resolved>Mon, 15 Jun 2020 14:49:39 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.0.1</fixVersion>
                    <fixVersion>3.1.0</fixVersion>
                                    <component>Structured Streaming</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17135268" author="smilegator" created="Sun, 14 Jun 2020 19:14:20 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maropu&quot; class=&quot;user-hover&quot; rel=&quot;maropu&quot;&gt;maropu&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sowen&quot; class=&quot;user-hover&quot; rel=&quot;sowen&quot;&gt;sowen&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sekikn&quot; class=&quot;user-hover&quot; rel=&quot;sekikn&quot;&gt;sekikn&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17135272" author="smilegator" created="Sun, 14 Jun 2020 19:23:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=XuanYuan&quot; class=&quot;user-hover&quot; rel=&quot;XuanYuan&quot;&gt;XuanYuan&lt;/a&gt; just identified the problem when fixing the test failure in&#160;&lt;a href=&quot;https://github.com/apache/spark/pull/28707&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28707&lt;/a&gt;&#160;. Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=XuanYuan&quot; class=&quot;user-hover&quot; rel=&quot;XuanYuan&quot;&gt;XuanYuan&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="17135286" author="kabhwan" created="Sun, 14 Jun 2020 20:59:39 +0000"  >&lt;p&gt;Nice finding!&lt;/p&gt;

&lt;p&gt;One thing I&apos;d like to add is, technically it can&apos;t be said &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-31292&quot; title=&quot;Replace toSet.toSeq with distinct for readability&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-31292&quot;&gt;&lt;del&gt;SPARK-31292&lt;/del&gt;&lt;/a&gt; is the root cause. The root cause is that we use toSet which doesn&apos;t guarantee order, where order should be preserved.&lt;/p&gt;

&lt;p&gt;Paradoxically, &quot;Seq.distinct&quot; is more likely fit to the requirement, according to the scaladoc.&#160;Below is the description of &quot;Seq.distinct&quot;:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;def distinct:&#160;Seq[A]

Builds a new sequence from this sequence without any duplicate elements.

Note: will not terminate for infinite-sized collections.

returns 

A new sequence which contains the first occurrence of every element of this sequence.

Definition 

Classes SeqLike&#160;&#8594;&#160;GenSeqLike &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(NOTE: the description is changed in 2.13 - I don&apos;t know why. Would they change the implementation? If we don&apos;t believe Scala description of distinct then probably we can implement some utils which have functions with preserving order of the element.)&lt;/p&gt;

&lt;p&gt;Though I have to say yes it may break backward compatibility, especially much more chance compared to the chance the algorithm of toSet affects the order. &lt;/p&gt;

&lt;p&gt;Looks like we should go through the hard decision - &quot;fix it to get it right&quot; vs &quot;leave it as it is unless problem occurs&quot;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17135313" author="maropu" created="Mon, 15 Jun 2020 00:49:56 +0000"  >&lt;p&gt;Oh, nice catch, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=XuanYuan&quot; class=&quot;user-hover&quot; rel=&quot;XuanYuan&quot;&gt;XuanYuan&lt;/a&gt; ! I&apos;ll make a PR for that.&lt;/p&gt;</comment>
                            <comment id="17135314" author="apachespark" created="Mon, 15 Jun 2020 01:23:37 +0000"  >&lt;p&gt;User &apos;maropu&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28830&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28830&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17135315" author="apachespark" created="Mon, 15 Jun 2020 01:24:39 +0000"  >&lt;p&gt;User &apos;maropu&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28830&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28830&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17135341" author="dongjoon" created="Mon, 15 Jun 2020 02:32:58 +0000"  >&lt;p&gt;I linked &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-31292&quot; title=&quot;Replace toSet.toSeq with distinct for readability&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-31292&quot;&gt;&lt;del&gt;SPARK-31292&lt;/del&gt;&lt;/a&gt; according to the PR description, but I also agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kabhwan&quot; class=&quot;user-hover&quot; rel=&quot;kabhwan&quot;&gt;kabhwan&lt;/a&gt;&apos;s opinion.&lt;br/&gt;
 &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maropu&quot; class=&quot;user-hover&quot; rel=&quot;maropu&quot;&gt;maropu&lt;/a&gt;&apos;s new fix is also resemble to Scala&apos;s `distinct` implementation also. &lt;br/&gt;
 &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smilegator&quot; class=&quot;user-hover&quot; rel=&quot;smilegator&quot;&gt;smilegator&lt;/a&gt;. Could you give us some reproducible example of the broken ordering, please?&lt;/p&gt;</comment>
                            <comment id="17135428" author="xuanyuan" created="Mon, 15 Jun 2020 05:59:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maropu&quot; class=&quot;user-hover&quot; rel=&quot;maropu&quot;&gt;maropu&lt;/a&gt; Thanks for the quick fix!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dongjoon&quot; class=&quot;user-hover&quot; rel=&quot;dongjoon&quot;&gt;dongjoon&lt;/a&gt;&#160;This issue is found when investigating &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-31894&quot; title=&quot;Introduce UnsafeRow format validation for streaming state store&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-31894&quot;&gt;&lt;del&gt;SPARK-31894&lt;/del&gt;&lt;/a&gt;, and it&apos;s also a blocker issue for it. I added a detailed analysis in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-31894&quot; title=&quot;Introduce UnsafeRow format validation for streaming state store&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-31894&quot;&gt;&lt;del&gt;SPARK-31894&lt;/del&gt;&lt;/a&gt;&apos;s &lt;a href=&quot;https://github.com/apache/spark/pull/28707#issuecomment-643916110&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR comments&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I think the simple revert fix in&#160;&lt;a href=&quot;https://github.com/apache/spark/pull/28830&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28830&lt;/a&gt;&#160;can be merged without tests. I&apos;ll add a new integrated test in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-31905&quot; title=&quot;Add compatibility tests for streaming state store format&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-31905&quot;&gt;&lt;del&gt;SPARK-31905&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17135930" author="dongjoon" created="Mon, 15 Jun 2020 14:49:39 +0000"  >&lt;p&gt;Issue resolved by pull request 28830&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28830&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28830&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13309010">SPARK-31894</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="13309379">SPARK-31905</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13294750">SPARK-31292</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13041028">SPARK-19497</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 22 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0fu3c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12347862">3.0.1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>