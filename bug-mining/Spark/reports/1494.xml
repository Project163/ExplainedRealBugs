<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:24:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-2972] APPLICATION_COMPLETE not created in Python unless context explicitly stopped</title>
                <link>https://issues.apache.org/jira/browse/SPARK-2972</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;If you don&apos;t explicitly stop a SparkContext at the end of a Python application with sc.stop(), an APPLICATION_COMPLETE file isn&apos;t created and the job doesn&apos;t get picked up by the history server.&lt;/p&gt;

&lt;p&gt;This can be easily reproduced with pyspark (but affects scripts as well).&lt;/p&gt;

&lt;p&gt;The current workaround is to wrap the entire script with a try/finally and stop manually.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Cloudera 5.1, yarn master on ubuntu precise&lt;/p&gt;</environment>
        <key id="12733284">SPARK-2972</key>
            <summary>APPLICATION_COMPLETE not created in Python unless context explicitly stopped</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="roji">Shay Rojansky</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Aug 2014 17:00:44 +0000</created>
                <updated>Wed, 10 Sep 2014 06:53:56 +0000</updated>
                            <resolved>Wed, 10 Sep 2014 06:53:56 +0000</resolved>
                                    <version>1.0.2</version>
                                                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14124872" author="farrellee" created="Sun, 7 Sep 2014 11:47:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roji&quot; class=&quot;user-hover&quot; rel=&quot;roji&quot;&gt;roji&lt;/a&gt; this was addressed for a pyspark shell in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-2435&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-2435&lt;/a&gt;. as for applications, it is the programmer&apos;s responsibility to stop the context before exit. this can be seen in all the example code provided with spark. are you looking for the SparkContext to stop itself?&lt;/p&gt;</comment>
                            <comment id="14124873" author="roji" created="Sun, 7 Sep 2014 11:54:10 +0000"  >&lt;p&gt;Thanks for answering. I guess it&apos;s a debatable question. I admit I expected the context to shut itself down at application exit, a bit in the way that files and other resources get closed.&lt;/p&gt;

&lt;p&gt;Note that the way the examples are currently written (pi.py), an exception anywhere in the code would bypass sc.stop() and the Spark application disappears without leaving a trace in the history server. For this reason, my scripts all contain try/finally blocks around the application code, which seems like needless boilerplate that complicates life and can easily be forgotten.&lt;/p&gt;

&lt;p&gt;Is there any specific reason not to use the application shutdown hooks available in python/java to close the context(s)?&lt;/p&gt;</comment>
                            <comment id="14125938" author="farrellee" created="Mon, 8 Sep 2014 19:11:21 +0000"  >&lt;p&gt;&amp;gt; Thanks for answering. I guess it&apos;s a debatable question. I admit I expected the context to shut itself down at application exit, a bit in the way that files and other resources get closed.&lt;/p&gt;

&lt;p&gt;i can understand that. those resources are ones that are cleaned up by the kernel, which doesn&apos;t have external dependencies on their cleanup, e.g. closing a file handle need not depend on writing to a log. it&apos;s always nice to have the lower level library handle things like this for you.&lt;/p&gt;

&lt;p&gt;&amp;gt; Note that the way the examples are currently written (pi.py), an exception anywhere in the code would bypass sc.stop() and the Spark application disappears without leaving a trace in the history server. For this reason, my scripts all contain try/finally blocks around the application code, which seems like needless boilerplate that complicates life and can easily be forgotten.&lt;/p&gt;

&lt;p&gt;you&apos;re right! imho, this means your program is written better than the examples. it would be good to enhance the examples w/ try/finally semantics. however,&lt;/p&gt;

&lt;p&gt;&amp;gt; Is there any specific reason not to use the application shutdown hooks available in python/java to close the context(s)?&lt;/p&gt;

&lt;p&gt;getting the shutdown semantics right is difficult, and may not apply broadly across applications. for instance, your application may want to catch a failure in stop() and retry to make sure that a history record is written. another application may be ok w/ best effort writing history events. still another application may want to exit w/o stop() to avoid having a history event written.&lt;/p&gt;

&lt;p&gt;asking the context creator to do context destruction shifts burden to the application writer and maintains flexibility for applications.&lt;/p&gt;

&lt;p&gt;that&apos;s my 2c&lt;/p&gt;</comment>
                            <comment id="14126686" author="roji" created="Tue, 9 Sep 2014 06:34:56 +0000"  >&lt;p&gt;&amp;gt; you&apos;re right! imho, this means your program is written better than the examples. it would be good to enhance the examples w/ try/finally semantics. however,&lt;/p&gt;

&lt;p&gt;Then I can submit a pull request for that, no problem.&lt;/p&gt;

&lt;p&gt;&amp;gt; getting the shutdown semantics right is difficult, and may not apply broadly across applications. for instance, your application may want to catch a failure in stop() and retry to make sure that a history record is written. another application may be ok w/ best effort writing history events. still another application may want to exit w/o stop() to avoid having a history event written.&lt;/p&gt;

&lt;p&gt;I don&apos;t think explicit stop() should be removed - of course users may choose to manually manage stop(), catch exceptions and retry, etc. For me it&apos;s just a question of what to do with a context that &lt;b&gt;didn&apos;t&lt;/b&gt; get explicitly closed at the end of the application.&lt;/p&gt;

&lt;p&gt;As to apps that need to exit without a history event - it&apos;s a requirement that&apos;s hard to imagine (for me). At least with YARN/Mesos you will be leaving traces anyway, and these traces will be partial and difficult to understand, since the corresponding Spark traces haven&apos;t been produced.&lt;/p&gt;

&lt;p&gt;&amp;gt; asking the context creator to do context destruction shifts burden to the application writer and maintains flexibility for applications.&lt;/p&gt;

&lt;p&gt;I guess it&apos;s a question of how high-level a tool you want Spark to be. It seems a bit strange for Spark to handle so much of the troublesome low-level details, while forcing the user to boilerplate-wrap all their programs with try/finally.&lt;/p&gt;

&lt;p&gt;But I do understand the points you&apos;re making and it can be argued both ways. As a minimum, I suggest having context implement the language-specific dispose patterns (&apos;using&apos; in Java, &apos;with&apos; in Python), so at least the code looks better?&lt;/p&gt;</comment>
                            <comment id="14127016" author="farrellee" created="Tue, 9 Sep 2014 14:08:57 +0000"  >&lt;p&gt;&amp;gt; I suggest having context implement the language-specific dispose patterns (&apos;using&apos; in Java, &apos;with&apos; in Python), so at least the code looks better?&lt;/p&gt;

&lt;p&gt;that&apos;s a great idea. i&apos;ll spec this out for python, would you care to do it for java / scala?&lt;/p&gt;</comment>
                            <comment id="14127137" author="farrellee" created="Tue, 9 Sep 2014 15:52:07 +0000"  >&lt;p&gt;fyi - i&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-3458&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-3458&lt;/a&gt; to track the feature request for pyspark&lt;/p&gt;</comment>
                            <comment id="14127171" author="roji" created="Tue, 9 Sep 2014 16:17:17 +0000"  >&lt;p&gt;I&apos;d love to help on this, but I know 0 Scala (I could have helped with the Python though &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;).&lt;/p&gt;

&lt;p&gt;A quick search shows that Scala has no Python &apos;with&apos; or Java Closeable equivalent in Java. There are several third-party implementations out there, but it doesn&apos;t seem right to bring in a non-core library for this kind of thing. I think someone with real Scala knowledge should take a look at this.&lt;/p&gt;

&lt;p&gt;We can close this issue and open a separate one for the Scala closeability if you want.&lt;/p&gt;</comment>
                            <comment id="14127187" author="farrellee" created="Tue, 9 Sep 2014 16:32:12 +0000"  >&lt;p&gt;+1 close this and open 2 feature requests, one for java and one for scala that mirror &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-3458&quot; title=&quot;enable use of python&amp;#39;s &amp;quot;with&amp;quot; statements for SparkContext management&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-3458&quot;&gt;&lt;del&gt;SPARK-3458&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12740167">SPARK-3458</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>411312</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 11 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yrhb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>411304</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>