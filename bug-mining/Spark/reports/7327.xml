<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:18:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-32232] IllegalArgumentException: MultilayerPerceptronClassifier_... parameter solver given invalid value auto</title>
                <link>https://issues.apache.org/jira/browse/SPARK-32232</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I believe I have discovered a bug when loading MultilayerPerceptronClassificationModel in spark 3.0.0, scala 2.1.2 which I have tested and can see is not there in at least Spark 2.4.3, Scala 2.11.&#160; (I&apos;m not sure if the Scala version is important).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I am using pyspark on a databricks cluster and importing the library &#160;&quot;from pyspark.ml.classification import MultilayerPerceptronClassificationModel&quot;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;When running model=MultilayerPerceptronClassificationModel.(&quot;load&quot;) and then model. transform (df) I get the following error: IllegalArgumentException: MultilayerPerceptronClassifier_8055d1368e78 parameter solver given invalid value auto.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This issue can be easily replicated by running the example given on the spark documents: &lt;a href=&quot;http://spark.apache.org/docs/latest/ml-classification-regression.html#multilayer-perceptron-classifier&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://spark.apache.org/docs/latest/ml-classification-regression.html#multilayer-perceptron-classifier&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Then adding a save model, load model and transform statement as such:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;from&lt;/b&gt; &lt;b&gt;pyspark.ml.classification&lt;/b&gt; &lt;b&gt;import&lt;/b&gt; MultilayerPerceptronClassifier&lt;/p&gt;

&lt;p&gt;&lt;b&gt;from&lt;/b&gt; &lt;b&gt;pyspark.ml.evaluation&lt;/b&gt; &lt;b&gt;import&lt;/b&gt; MulticlassClassificationEvaluator&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;# Load training data&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;data = spark.read.format(&quot;libsvm&quot;)\&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160; .load(&quot;data/mllib/sample_multiclass_classification_data.txt&quot;)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;# Split the data into train and test&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;splits = data.randomSplit(&lt;span class=&quot;error&quot;&gt;&amp;#91;0.6, 0.4&amp;#93;&lt;/span&gt;, 1234)&lt;/p&gt;

&lt;p&gt;train = splits&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;test = splits&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;# specify layers for the neural network:&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;# input layer of size 4 (features), two intermediate of size 5 and 4&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;# and output of size 3 (classes)&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;layers = &lt;span class=&quot;error&quot;&gt;&amp;#91;4, 5, 4, 3&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;# create the trainer and set its parameters&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;trainer = MultilayerPerceptronClassifier(maxIter=100, layers=layers, blockSize=128, seed=1234)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;# train the model&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;model = trainer.fit(train)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;# compute accuracy on the test set&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;result = model.transform(test)&lt;/p&gt;

&lt;p&gt;predictionAndLabels = result.select(&quot;prediction&quot;, &quot;label&quot;)&lt;/p&gt;

&lt;p&gt;evaluator = MulticlassClassificationEvaluator(metricName=&quot;accuracy&quot;)&lt;/p&gt;

&lt;p&gt;&lt;b&gt;print&lt;/b&gt;(&quot;Test set accuracy = &quot; + str(evaluator.evaluate(predictionAndLabels)))&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;from&lt;/b&gt; &lt;b&gt;pyspark.ml.classification&lt;/b&gt; &lt;b&gt;import&lt;/b&gt; MultilayerPerceptronClassifier, MultilayerPerceptronClassificationModel&lt;/p&gt;

&lt;p&gt;model.save(Save_location)&lt;/p&gt;

&lt;p&gt;model2. MultilayerPerceptronClassificationModel.load(Save_location)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;result_from_loaded = model2.transform(test)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13315667">SPARK-32232</key>
            <summary>IllegalArgumentException: MultilayerPerceptronClassifier_... parameter solver given invalid value auto</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="huaxingao">Huaxin Gao</assignee>
                                    <reporter username="st_60">steven taylor</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Jul 2020 15:57:25 +0000</created>
                <updated>Sat, 11 Jul 2020 15:38:00 +0000</updated>
                            <resolved>Sat, 11 Jul 2020 15:38:00 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.0.1</fixVersion>
                    <fixVersion>3.1.0</fixVersion>
                                    <component>ML</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17153769" author="srowen" created="Wed, 8 Jul 2020 17:13:18 +0000"  >&lt;p&gt;A few more notes: the equivalent code in Scala works fine, so it&apos;s related to the Pyspark wrappers.&lt;br/&gt;
The serialized model looks fine even in this case; it records a default solver param of &apos;l-bfgs&apos; and no overridden value.&lt;br/&gt;
When loaded back, the solver is &apos;auto&apos;, the default in HasSolver. I think something in MultilayerPerceptronParams doesn&apos;t quite override this as intended. It does have a solver member but not sure if something else is missing.&lt;/p&gt;</comment>
                            <comment id="17154311" author="huaxingao" created="Thu, 9 Jul 2020 08:02:32 +0000"  >&lt;p&gt;I think the problem is this:&lt;/p&gt;

&lt;p&gt;model2.transform(df) -&amp;gt; wrapper._transfer_params_to_java -&amp;gt; get the default value for solver which is &apos;auto&apos;, this causes Exception because it is an invalid solver.&lt;/p&gt;

&lt;p&gt;On python side, we set solver default value to &apos;l-bfgs&apos; in MultilayerPerceptron, but we don&apos;t set solver default value in MultilayerPerceptronModel. This makes sense because for fitted model, we don&apos;t need the solver value any more, so no need to set it. However, since we don&apos;t set default value for solver in MultilayerPerceptronModel, when calling wrapper._transfer_params_to_java, the default value for solver in HasSolver is used, which is &apos;auto&apos;, and this caused Exception because it is an invalid solver. &lt;br/&gt;
Seems to me that we don&apos;t need to set solver or set any of the params for MultilayerPerceptronModel. I will fix this problem. &lt;/p&gt;</comment>
                            <comment id="17154344" author="st_60" created="Thu, 9 Jul 2020 08:46:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=huaxingao&quot; class=&quot;user-hover&quot; rel=&quot;huaxingao&quot;&gt;huaxingao&lt;/a&gt;&#160; will your intended fix remove the ability to retrieve the&lt;font color=&quot;#172b4d&quot;&gt; MultilayerPerceptronModel&lt;/font&gt; params using the get&amp;lt;Param&amp;gt; method or will that still exist? (e.g.&#160;model.getSolver()&#160;&lt;font color=&quot;#555555&quot;&gt;Out&lt;span class=&quot;error&quot;&gt;&amp;#91;12&amp;#93;&lt;/span&gt;: &apos;l-bfgs&apos;&lt;/font&gt;)&lt;/p&gt;

&lt;p&gt;--this is still quite useful functionality&#160;&lt;/p&gt;</comment>
                            <comment id="17154755" author="huaxingao" created="Thu, 9 Jul 2020 17:36:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=st_60&quot; class=&quot;user-hover&quot; rel=&quot;st_60&quot;&gt;st_60&lt;/a&gt;No, I will not remove the getter.&lt;br/&gt;
I think over, seems all I need to do is to make sure that Python and Scala have the same solver default value for MultilayerPerceptronModel.&lt;br/&gt;
I will submit a PR soon.&lt;/p&gt;</comment>
                            <comment id="17154875" author="apachespark" created="Thu, 9 Jul 2020 19:15:42 +0000"  >&lt;p&gt;User &apos;huaxingao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29060&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29060&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17156020" author="srowen" created="Sat, 11 Jul 2020 15:38:00 +0000"  >&lt;p&gt;Issue resolved by pull request 29060&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29060&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29060&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 18 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0gkhk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>