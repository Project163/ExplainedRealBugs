<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:47:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-52006] CollectMetricsExec&apos;s accumulator should be excluded from heartbeats and event logs</title>
                <link>https://issues.apache.org/jira/browse/SPARK-52006</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;CollectMetricsExec uses an accumulator(AggregatingAccumulator) for emitting metrics in a side-channel that can be collected to the driver.&lt;/p&gt;

&lt;p&gt;Unfortunately, this inherits many default accumulator behaviors, some of which are undesirable:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;This is a named accumulator but isn&#8217;t an internal accumulator (i.e. its name doesn&#8217;t start with the internal task metrics prefix), so its result is shown in the Spark UI. But that result isn&#8217;t meaningful to users because it&#8217;s the `.toString` representation of an UnsafeRow representing an aggregation buffer.&lt;/li&gt;
	&lt;li&gt;This same string representation is also logged in event logs on a per-task basis, slowing down event logging and bloating log size.&lt;/li&gt;
	&lt;li&gt;The underlying accumulator value is also retained by the live UI even though it&#8217;s not displayed on a per-task basis, bloating driver memory consumption.&lt;/li&gt;
	&lt;li&gt;Even though our code tries to only publish a metric update once at the end of the task, there is a race condition between task completion listeners and metric heartbeater deregistration(stemming from the division of responsibilities between Task.scala and Executor.scala) which will lead to accumulator serialization issues.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Based on the above undesirable facts, we should give this metric a special internal accumulator name and should use that name to explicitly exclude it from heartbeats and from event logs.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13617110">SPARK-52006</key>
            <summary>CollectMetricsExec&apos;s accumulator should be excluded from heartbeats and event logs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ivoson">Tengfei Huang</assignee>
                                    <reporter username="ivoson">Tengfei Huang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 5 May 2025 08:37:24 +0000</created>
                <updated>Fri, 9 May 2025 01:15:31 +0000</updated>
                            <resolved>Fri, 9 May 2025 01:15:31 +0000</resolved>
                                    <version>3.5.5</version>
                                    <fixVersion>4.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17949393" author="ivoson" created="Mon, 5 May 2025 08:38:15 +0000"  >&lt;p&gt;Working on a PR to fix it.&lt;/p&gt;</comment>
                            <comment id="17950404" author="cloud_fan" created="Fri, 9 May 2025 01:15:31 +0000"  >&lt;p&gt;Issue resolved by pull request 50812&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/50812&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/50812&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            26 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1voh4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>