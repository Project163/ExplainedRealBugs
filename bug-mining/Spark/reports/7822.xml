<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:24:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-34087] a memory leak occurs when we clone the spark session</title>
                <link>https://issues.apache.org/jira/browse/SPARK-34087</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;In Spark-3.0.1, the memory leak occurs when we keep cloning the spark session because a new ExecutionListenerBus instance will add to AsyncEventQueue when we clone a new session.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13351742">SPARK-34087</key>
            <summary>a memory leak occurs when we clone the spark session</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Ngone51">wuyi</assignee>
                                    <reporter username="fchen">Fu Chen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Jan 2021 11:06:38 +0000</created>
                <updated>Mon, 12 Apr 2021 00:57:57 +0000</updated>
                            <resolved>Tue, 23 Mar 2021 07:39:08 +0000</resolved>
                                    <version>3.0.1</version>
                                    <fixVersion>3.2.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17263266" author="fchen" created="Tue, 12 Jan 2021 11:37:24 +0000"  >&lt;p&gt;&lt;b&gt;bug replay&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;here is code for replay this bug:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// run with spark-3.0.1
&lt;/span&gt;test(&lt;span class=&quot;code-quote&quot;&gt;&quot;bug replay&quot;&lt;/span&gt;) {
  (1 to 1000).foreach(i =&amp;gt; { 
    spark.cloneSession() 
    SparkSession.clearActiveSession()
  })
  val cnt = spark.sparkContext
   .listenerBus
   .listeners
   .asScala
   .collect{ &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; e: ExecutionListenerBus =&amp;gt; e}
   .size
  println(s&lt;span class=&quot;code-quote&quot;&gt;&quot;total ExecutionListenerBus count ${cnt}.&quot;&lt;/span&gt;)
  &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(Int.MaxValue) 
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;output:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;total ExecutionListenerBus count 1001.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;jmap&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&#160; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13018622/13018622_1610451044690.jpg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Each ExecutionListenerBus holds one SparkSession instance, so JVM can&apos;t collect these SparkSession object&lt;/p&gt;</comment>
                            <comment id="17263498" author="apachespark" created="Tue, 12 Jan 2021 17:07:28 +0000"  >&lt;p&gt;User &apos;cfmcgrady&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/31156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/31156&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17263499" author="apachespark" created="Tue, 12 Jan 2021 17:08:26 +0000"  >&lt;p&gt;User &apos;cfmcgrady&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/31156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/31156&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17267091" author="apachespark" created="Mon, 18 Jan 2021 08:56:45 +0000"  >&lt;p&gt;User &apos;cfmcgrady&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/31231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/31231&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17301665" author="apachespark" created="Mon, 15 Mar 2021 14:07:51 +0000"  >&lt;p&gt;User &apos;Ngone51&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/31839&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/31839&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17303895" author="apachespark" created="Thu, 18 Mar 2021 07:06:29 +0000"  >&lt;p&gt;User &apos;Ngone51&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/31881&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/31881&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17305858" author="apachespark" created="Mon, 22 Mar 2021 03:17:27 +0000"  >&lt;p&gt;User &apos;Ngone51&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/31919&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/31919&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17305859" author="apachespark" created="Mon, 22 Mar 2021 03:17:47 +0000"  >&lt;p&gt;User &apos;Ngone51&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/31919&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/31919&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17306852" author="cloud_fan" created="Tue, 23 Mar 2021 07:39:08 +0000"  >&lt;p&gt;Issue resolved by pull request 31919&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/31919&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/31919&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13363523">SPARK-34689</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13018622" name="1610451044690.jpg" size="431046" author="fchen" created="Tue, 12 Jan 2021 11:37:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0mhz4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>