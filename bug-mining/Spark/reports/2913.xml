<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:36:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-12345] Mesos cluster mode is broken</title>
                <link>https://issues.apache.org/jira/browse/SPARK-12345</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The same setup worked in 1.5.2 but is now failing for 1.6.0-RC2.&lt;/p&gt;

&lt;p&gt;The driver is confused about where SPARK_HOME is. It resolves `mesos.executor.uri` or `spark.mesos.executor.home` relative to the filesystem where the driver runs, which is wrong.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;I1215 15:00:39.411212 28032 exec.cpp:134] Version: 0.25.0
I1215 15:00:39.413512 28037 exec.cpp:208] Executor registered on slave 130bdc39-44e7-4256-8c22-602040d337f1-S1
bin/spark-submit: line 27: /Users/dragos/workspace/Spark/dev/rc-tests/spark-1.6.0-bin-hadoop2.6/bin/spark-class: No such file or directory
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12922098">SPARK-12345</key>
            <summary>Mesos cluster mode is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tnachen">Timothy Chen</assignee>
                                    <reporter username="andrewor14">Andrew Or</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Dec 2015 19:10:34 +0000</created>
                <updated>Sat, 3 Nov 2018 19:21:07 +0000</updated>
                            <resolved>Wed, 16 Dec 2015 19:01:34 +0000</resolved>
                                    <version>1.6.0</version>
                                    <fixVersion>1.6.0</fixVersion>
                                    <component>Mesos</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15058873" author="dragos" created="Tue, 15 Dec 2015 21:32:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=skonto&quot; class=&quot;user-hover&quot; rel=&quot;skonto&quot;&gt;skonto&lt;/a&gt; pointed out this commit: &lt;a href=&quot;https://github.com/apache/spark/commit/8aff36e91de0fee2f3f56c6d240bb203b5bb48ba&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/8aff36e91de0fee2f3f56c6d240bb203b5bb48ba&lt;/a&gt; it could be part of the problem.&lt;/p&gt;</comment>
                            <comment id="15058887" author="apachespark" created="Tue, 15 Dec 2015 21:43:04 +0000"  >&lt;p&gt;User &apos;dragos&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10315&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10315&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15059569" author="jerryshao" created="Wed, 16 Dec 2015 06:21:31 +0000"  >&lt;p&gt;It is OK in my local test when I followed the step one by one in doc to run Spark on Mesos example, though my environment may not be the same as real cluster.&lt;/p&gt;

&lt;p&gt;So I&apos;m not sure how to reproduce this issue, you mean it is introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-2960&quot; title=&quot;Spark executables fail to start via symlinks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-2960&quot;&gt;&lt;del&gt;SPARK-2960&lt;/del&gt;&lt;/a&gt;, but the behavior of &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-2960&quot; title=&quot;Spark executables fail to start via symlinks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-2960&quot;&gt;&lt;del&gt;SPARK-2960&lt;/del&gt;&lt;/a&gt; is no difference to the previous version if SPARK_HOME is not manually specified.&lt;/p&gt;</comment>
                            <comment id="15059648" author="srowen" created="Wed, 16 Dec 2015 07:39:42 +0000"  >&lt;p&gt;Agree, there &lt;em&gt;shouldn&apos;t&lt;/em&gt; be any change in behavior if &lt;tt&gt;SPARK_HOME&lt;/tt&gt; is not set; the change was to use this value if set to find Spark files and scripts. If unset, it also sets &lt;tt&gt;SPARK_HOME&lt;/tt&gt; to the location it had inferred before. However it also seems like there could well be a connection here.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dragos&quot; class=&quot;user-hover&quot; rel=&quot;dragos&quot;&gt;dragos&lt;/a&gt; is it possible the cluster has set &lt;tt&gt;SPARK_HOME&lt;/tt&gt; &quot;incorrectly&quot; or otherwise copies the value that the driver uses somehow?&lt;/p&gt;</comment>
                            <comment id="15059717" author="dragos" created="Wed, 16 Dec 2015 08:54:19 +0000"  >&lt;p&gt;There&apos;s isn&apos;t any &lt;tt&gt;SPARK_HOME&lt;/tt&gt; set on any of the Mesos slaves.&lt;/p&gt;

&lt;p&gt;Here&apos;s what I think happens: the &lt;tt&gt;SPARK_HOME&lt;/tt&gt; variable is exported by &lt;tt&gt;spark-submit&lt;/tt&gt;, and copied &lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/scheduler/cluster/mesos/MesosClusterScheduler.scala#L369-L372&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; to the driver environment.&lt;/p&gt;</comment>
                            <comment id="15059769" author="skonto" created="Wed, 16 Dec 2015 09:52:46 +0000"  >&lt;p&gt;Adding to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dragos&quot; class=&quot;user-hover&quot; rel=&quot;dragos&quot;&gt;dragos&lt;/a&gt;.....(MesosClusterScheduler.scala) ...&lt;/p&gt;

&lt;p&gt;Mesos Dispatcher passed that env variable to the driver at line:&lt;br/&gt;
builder.setEnvironment(envBuilder.build())&lt;br/&gt;
also having set executor uri it picks this path:  &lt;/p&gt;

&lt;p&gt;else if (executorUri.isDefined) {&lt;/p&gt;

&lt;p&gt;In 1.6 the spark-submit script has changed...&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/&lt;/a&gt; spark/blob/master/bin/spark-submit&lt;br/&gt;
This line make SPARK_HOME not to change to the local path on mesos slave (from which the spark-submit was called from) because it has already been set.&lt;br/&gt;
if [ -z &quot;${SPARK_HOME}&quot; ]; then&lt;br/&gt;
export SPARK_HOME=&quot;$(cd &quot;dirname &quot;$0&quot;&quot;/..; pwd)&quot;&lt;br/&gt;
fi&lt;br/&gt;
And the driver is started with spark-submit command anyway... &lt;/p&gt;</comment>
                            <comment id="15059778" author="jerryshao" created="Wed, 16 Dec 2015 10:01:05 +0000"  >&lt;p&gt;A simple solution is to change the scripts to not expose `SPARK_HOME`. From my understanding a good solution for Mesos is to do the same way as YARN to directly invoke Java program, not relying on script to start program.&lt;/p&gt;</comment>
                            <comment id="15059812" author="srowen" created="Wed, 16 Dec 2015 10:38:25 +0000"  >&lt;p&gt;Yeah, but why is &lt;tt&gt;SPARK_HOME&lt;/tt&gt; copied across machines to begin with? that seems like the more fundamental issue.&lt;/p&gt;</comment>
                            <comment id="15059937" author="jerryshao" created="Wed, 16 Dec 2015 12:42:41 +0000"  >&lt;p&gt;I think by default Spark Mesos implementation will ship all the environment variables to the remote nodes, which includes &lt;tt&gt;SPARK_HOME&lt;/tt&gt;, and Mesos itself will invoke the spark application through scripts, and inside the scripts we honor if &lt;tt&gt;SPARK_HOME&lt;/tt&gt; is already set, so that&apos;s the problem.&lt;/p&gt;

&lt;p&gt;Basically, I think there&apos;re two sides we could fix:&lt;/p&gt;

&lt;p&gt;1. We should not expose &lt;tt&gt;SPARK_HOME&lt;/tt&gt; to the environment if it is not set specifically. Otherwise cases like here will potentially have problem.&lt;br/&gt;
2. Spark on Mesos should not blindly ship all the environment variables to the remote side. The best way for Spark on Mesos is to invoke the Java program like what YARN did currently, not rely on scripts.&lt;/p&gt;</comment>
                            <comment id="15059954" author="jerryshao" created="Wed, 16 Dec 2015 13:11:38 +0000"  >&lt;p&gt;Having a quick test by not exporting &lt;tt&gt;SPARK_HOME&lt;/tt&gt;, the application is failed to start, code in &lt;tt&gt;SparkLaucher&lt;/tt&gt; needs &lt;tt&gt;SPARK_HOME&lt;/tt&gt;. So solution 2 is the only choice to filter out &lt;tt&gt;SPARK_HOME&lt;/tt&gt; if necessary.&lt;/p&gt;</comment>
                            <comment id="15060035" author="jerryshao" created="Wed, 16 Dec 2015 14:25:38 +0000"  >&lt;p&gt;Here is the one solution (&lt;a href=&quot;https://github.com/apache/spark/compare/master...jerryshao:SPARK-12345&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/compare/master...jerryshao:SPARK-12345&lt;/a&gt;), mind taking a trying in your cluster? Thanks a lot.&lt;/p&gt;</comment>
                            <comment id="15060153" author="skyluc" created="Wed, 16 Dec 2015 15:32:56 +0000"  >&lt;p&gt;I have almost the same fix, which is the same logic: do not carry &lt;tt&gt;SPARK_HOME&lt;/tt&gt; information across systems. But I changed it in SparkSubmit side:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/skyluc/spark/commit/5b6eaa5bf936ef42d46b53564816d62b2aa44e86&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/skyluc/spark/commit/5b6eaa5bf936ef42d46b53564816d62b2aa44e86&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m running tests to check that Mesos is working fine with those changes.&lt;/p&gt;</comment>
                            <comment id="15060236" author="dragos" created="Wed, 16 Dec 2015 16:23:56 +0000"  >&lt;p&gt;I&apos;d prefer filtering it at at the submit side, if everything else works. Doing it in the scheduler will be confusing for users. The Driver environment would still show SPARK_HOME (in the dispatcher UI), but in fact it would be filtered out in practice.&lt;/p&gt;</comment>
                            <comment id="15060239" author="skyluc" created="Wed, 16 Dec 2015 16:25:34 +0000"  >&lt;p&gt;I tested our usual test cases with my change, and it is working well.&lt;/p&gt;</comment>
                            <comment id="15060475" author="apachespark" created="Wed, 16 Dec 2015 18:30:06 +0000"  >&lt;p&gt;User &apos;tnachen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10332&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10332&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15065047" author="andrewor14" created="Sat, 19 Dec 2015 00:28:58 +0000"  >&lt;p&gt;For those who are following:&lt;/p&gt;

&lt;p&gt;There are 4 patches related to this issue that are merged in this order:&lt;br/&gt;
(1) &lt;a href=&quot;https://github.com/apache/spark/pull/10332&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10332&lt;/a&gt; - doesn&apos;t actually work&lt;br/&gt;
(2) &lt;a href=&quot;https://github.com/apache/spark/pull/10359&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10359&lt;/a&gt; - fixes #10332 to make it actually work&lt;br/&gt;
(3) &lt;a href=&quot;https://github.com/apache/spark/pull/10366&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10366&lt;/a&gt; - fixes #10359, which broke HA (&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-12413&quot; title=&quot;Mesos ZK persistence throws a NotSerializableException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-12413&quot;&gt;&lt;del&gt;SPARK-12413&lt;/del&gt;&lt;/a&gt;)&lt;br/&gt;
(4) &lt;a href=&quot;https://github.com/apache/spark/pull/10329&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10329&lt;/a&gt; - an alternative, more correct fix&lt;/p&gt;

&lt;p&gt;Patches (1), (2), and (3) are merged ONLY into branch-1.6.&lt;br/&gt;
Patch (4) is merged ONLY in master.&lt;/p&gt;

&lt;p&gt;We have a different fix for branch-1.6 because it was an RC blocker and we wanted to minimize the scope of the changes there. However, patch (4) is a better fix, and so it exists in master for the longer term.&lt;/p&gt;</comment>
                            <comment id="15188589" author="eran.chinthaka@gmail.com" created="Thu, 10 Mar 2016 03:15:06 +0000"  >&lt;p&gt;is the resolution to this issue available in Spark 1.6.0 release? &lt;/p&gt;

&lt;p&gt;I just used Spark 1.6.0 and got the following error in mesos logs, when it tried to run the task&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;I0310 03:13:11.417009 131594 exec.cpp:132] Version: 0.23.1
I0310 03:13:11.419452 131601 exec.cpp:206] Executor registered on slave 20160223-000314-3439362570-5050-631-S0
sh: 1: /usr/spark-1.6.0-bin-hadoop2.6/bin/spark-class: not found
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To provide more context, here is my spark-submit script&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$SPARK_HOME/bin/spark-submit \
 --&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;com.mycompany.SparkStarter \
 --master mesos:&lt;span class=&quot;code-comment&quot;&gt;//mesos-dispatcher:7077 \
&lt;/span&gt; --name SparkStarterJob \
--driver-memory 1G \
 --executor-memory 4G \
--deploy-mode cluster \
 --total-executor-cores 1 \
 --conf spark.mesos.executor.docker.image=echinthaka/mesos-spark:0.23.1-1.6.0-2.6 \
 http:&lt;span class=&quot;code-comment&quot;&gt;//abc.com/spark-starter.jar&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13196065">SPARK-25934</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12913340">SPARK-11759</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12922873">SPARK-12413</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pxjz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333083">1.6.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>