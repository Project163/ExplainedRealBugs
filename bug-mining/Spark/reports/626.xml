<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:16:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-2967] Several SQL unit test failed when sort-based shuffle is enabled</title>
                <link>https://issues.apache.org/jira/browse/SPARK-2967</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Several SQLQuerySuite unit test failed when sort-based shuffle is enabled. Seems SQL test uses GenericMutableRow  which will make ExternalSorter&apos;s internal buffer all refered to the same object finally because of object&apos;s mutability. Seems row should be copied when feeding into ExternalSorter.&lt;/p&gt;

&lt;p&gt;The error shows below, though have many failures, I only pasted part of them:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; SQLQuerySuite:
 - SPARK-2041 column name equals tablename
 - SPARK-2407 Added Parser of SQL SUBSTR()
 - index into array
 - left semi greater than predicate
 - index into array of arrays
 - agg *** FAILED ***
   Results do not match for query:
   Aggregate [&apos;a], [&apos;a,SUM(&apos;b) AS c1#38]
    UnresolvedRelation None, testData2, None
   
   == Analyzed Plan ==
   Aggregate [a#4], [a#4,SUM(CAST(b#5, LongType)) AS c1#38L]
    SparkLogicalPlan (ExistingRdd [a#4,b#5], MapPartitionsRDD[7] at mapPartitions at basicOperators.scala:215)
   
   == Physical Plan ==
   Aggregate false, [a#4], [a#4,SUM(PartialSum#40L) AS c1#38L]
    Exchange (HashPartitioning [a#4], 200)
     Aggregate true, [a#4], [a#4,SUM(CAST(b#5, LongType)) AS PartialSum#40L]
      ExistingRdd [a#4,b#5], MapPartitionsRDD[7] at mapPartitions at basicOperators.scala:215
   
   == Results ==
   !== Correct Answer - 3 ==   == Spark Answer - 3 ==
   !Vector(1, 3)               [1,3]
   !Vector(2, 3)               [1,3]
   !Vector(3, 3)               [1,3] (QueryTest.scala:53)
 - aggregates with nulls
 - select *
 - simple select
 - sorting *** FAILED ***
   Results do not match for query:
   Sort [&apos;a ASC,&apos;b ASC]
    Project [*]
     UnresolvedRelation None, testData2, None
   
   == Analyzed Plan ==
   Sort [a#4 ASC,b#5 ASC]
    Project [a#4,b#5]
     SparkLogicalPlan (ExistingRdd [a#4,b#5], MapPartitionsRDD[7] at mapPartitions at basicOperators.scala:215)
   
   == Physical Plan ==
   Sort [a#4 ASC,b#5 ASC], true
    Exchange (RangePartitioning [a#4 ASC,b#5 ASC], 200)
     ExistingRdd [a#4,b#5], MapPartitionsRDD[7] at mapPartitions at basicOperators.scala:215
   
   == Results ==
   !== Correct Answer - 6 ==   == Spark Answer - 6 ==
   !Vector(1, 1)               [3,2]
   !Vector(1, 2)               [3,2]
   !Vector(2, 1)               [3,2]
   !Vector(2, 2)               [3,2]
   !Vector(3, 1)               [3,2]
   !Vector(3, 2)               [3,2] (QueryTest.scala:53)
 - limit
 - average
 - average overflow *** FAILED ***
   Results do not match for query:
   Aggregate [&apos;b], [AVG(&apos;a) AS c0#90,&apos;b]
    UnresolvedRelation None, largeAndSmallInts, None
   
   == Analyzed Plan ==
   Aggregate [b#3], [AVG(CAST(a#2, LongType)) AS c0#90,b#3]
    SparkLogicalPlan (ExistingRdd [a#2,b#3], MapPartitionsRDD[4] at mapPartitions at basicOperators.scala:215)
   
   == Physical Plan ==
   Aggregate false, [b#3], [(CAST(SUM(PartialSum#93L), DoubleType) / CAST(SUM(PartialCount#94L), DoubleType)) AS c0#90,b#3]
    Exchange (HashPartitioning [b#3], 200)
     Aggregate true, [b#3], [b#3,COUNT(CAST(a#2, LongType)) AS PartialCount#94L,SUM(CAST(a#2, LongType)) AS PartialSum#93L]
      ExistingRdd [a#2,b#3], MapPartitionsRDD[4] at mapPartitions at basicOperators.scala:215
   
   == Results ==
   !== Correct Answer - 2 ==   == Spark Answer - 2 ==
   !Vector(2.0, 2)             [2.147483645E9,1]
   !Vector(2.147483645E9, 1)   [2.147483645E9,1] (QueryTest.scala:53)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="12733203">SPARK-2967</key>
            <summary>Several SQL unit test failed when sort-based shuffle is enabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marmbrus">Michael Armbrust</assignee>
                                    <reporter username="jerryshao">Saisai Shao</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Aug 2014 10:11:35 +0000</created>
                <updated>Thu, 21 Aug 2014 01:12:44 +0000</updated>
                            <resolved>Wed, 20 Aug 2014 22:52:57 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14093845" author="matei" created="Tue, 12 Aug 2014 07:32:56 +0000"  >&lt;p&gt;Good catch, this is a difference in behavior with sort-based shuffle. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rxin&quot; class=&quot;user-hover&quot; rel=&quot;rxin&quot;&gt;rxin&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marmbrus&quot; class=&quot;user-hover&quot; rel=&quot;marmbrus&quot;&gt;marmbrus&lt;/a&gt; would it be possible to not pass the same object here?&lt;/p&gt;</comment>
                            <comment id="14093857" author="marmbrus" created="Tue, 12 Aug 2014 07:46:01 +0000"  >&lt;p&gt;Yes, its possible and seems to fix the issue.  However I think we&apos;ll only wanna do it when sort based shuffle is on, since its pretty expensive.&lt;/p&gt;</comment>
                            <comment id="14093874" author="jerryshao" created="Tue, 12 Aug 2014 08:06:25 +0000"  >&lt;p&gt;Hi Matei and Michael, thanks a lot for looking into this issue. I think some users&apos; codes may also encounter this problem when using same mutable object, like in mapPartitions(), maybe we should add some docs to warn this.&lt;/p&gt;</comment>
                            <comment id="14104619" author="apachespark" created="Wed, 20 Aug 2014 21:22:11 +0000"  >&lt;p&gt;User &apos;marmbrus&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2066&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2066&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14104902" author="apachespark" created="Thu, 21 Aug 2014 01:12:44 +0000"  >&lt;p&gt;User &apos;marmbrus&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2072&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2072&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>411231</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yqzb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>411223</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326686">1.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>