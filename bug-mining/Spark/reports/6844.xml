<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:08:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-29152] Spark Executor Plugin API shutdown is not proper when dynamic allocation enabled</title>
                <link>https://issues.apache.org/jira/browse/SPARK-29152</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;b&gt;Issue Description&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Spark Executor Plugin API &lt;b&gt;shutdown handling is not proper&lt;/b&gt;, when dynamic allocation enabled .Plugin&apos;s shutdown method is not processed when dynamic allocation is enabled and &lt;b&gt;executors become dead&lt;/b&gt; after inactive time.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Test Precondition&lt;/b&gt;&lt;br/&gt;
1. Create a plugin and make a jar named SparkExecutorplugin.jar&lt;/p&gt;

&lt;p&gt;import org.apache.spark.ExecutorPlugin;&lt;br/&gt;
public class ExecutoTest1 implements ExecutorPlugin{&lt;br/&gt;
    public void init()&lt;/p&gt;
{
        System.out.println(&quot;Executor Plugin Initialised.&quot;);
    }

&lt;p&gt;    public void shutdown()&lt;/p&gt;
{
        System.out.println(&quot;Executor plugin closed successfully.&quot;);
    }
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;2. Create the  jars with the same and put it in folder /spark/examples/jars&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Test Steps&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;1. launch bin/spark-sql with dynamic allocation enabled&lt;/p&gt;

&lt;p&gt;./spark-sql --master yarn --conf spark.executor.plugins=ExecutoTest1  --jars /opt/HA/C10/install/spark/spark/examples/jars/SparkExecutorPlugin.jar --conf spark.dynamicAllocation.enabled=true --conf spark.dynamicAllocation.initialExecutors=2 --conf spark.dynamicAllocation.minExecutors=1&lt;/p&gt;

&lt;p&gt;2 create a table , insert the data and select * from tablename&lt;br/&gt;
3.Check the spark UI Jobs tab/SQL tab&lt;br/&gt;
4. Check all Executors(executor tab will give all executors details) application log file for Executor plugin Initialization and Shutdown messages or operations.&lt;br/&gt;
Example /yarn/logdir/application_1567156749079_0025/container_e02_1567156749079_0025_01_000005/ stdout&lt;/p&gt;

&lt;p&gt;5. Wait for the executor to be dead after the inactive time and check the same container log &lt;br/&gt;
6. Kill the spark sql and check the container log  for executor plugin shutdown.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Expect Output&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;1. Job should be success. Create table ,insert and select query should be success.&lt;/p&gt;

&lt;p&gt;2.While running query All Executors  log should contain the executor plugin Init messages or operations.&lt;br/&gt;
&quot;Executor Plugin Initialised.&lt;/p&gt;

&lt;p&gt;3.Once the executors are dead ,shutdown message should be there in log file.&lt;br/&gt;
&#8220; Executor plugin closed successfully.&lt;/p&gt;

&lt;p&gt;4.Once the sql application closed ,shutdown message should be there in log.&lt;br/&gt;
&#8220; Executor plugin closed successfully&quot;. &lt;/p&gt;


&lt;p&gt;&lt;b&gt;Actual Output&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Shutdown message is not called when executor is dead after inactive time.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Observation&lt;/b&gt;&lt;br/&gt;
Without dynamic allocation Executor plugin is working fine. But after enabling dynamic allocation,Executor shutdown is not processed.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="13257376">SPARK-29152</key>
            <summary>Spark Executor Plugin API shutdown is not proper when dynamic allocation enabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rakson">Rakesh Raushan</assignee>
                                    <reporter username="jobitmathew">jobit mathew</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Sep 2019 13:07:05 +0000</created>
                <updated>Wed, 2 Jun 2021 16:29:40 +0000</updated>
                            <resolved>Tue, 10 Dec 2019 22:24:46 +0000</resolved>
                                    <version>2.4.0</version>
                    <version>2.4.1</version>
                    <version>2.4.2</version>
                    <version>2.4.3</version>
                    <version>2.4.4</version>
                    <version>3.0.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16932436" author="rakson" created="Wed, 18 Sep 2019 13:12:40 +0000"  >&lt;p&gt;I will look into this issue.&lt;/p&gt;</comment>
                            <comment id="16989578" author="jobitmathew" created="Fri, 6 Dec 2019 09:35:34 +0000"  >&lt;p&gt;Reopening the Jira, as the issue exists in the master branch also.&lt;/p&gt;</comment>
                            <comment id="16993010" author="vanzin" created="Tue, 10 Dec 2019 22:24:46 +0000"  >&lt;p&gt;Issue resolved by pull request 26810&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/26810&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/26810&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13381655">SPARK-35610</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13174410">SPARK-24918</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 48 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z06rfk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>