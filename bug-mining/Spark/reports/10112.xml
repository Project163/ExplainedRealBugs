<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:46:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-51603] logical circular dependency between modules `connect-client-jvm` and `assembly`</title>
                <link>https://issues.apache.org/jira/browse/SPARK-51603</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-48936&quot; title=&quot;Makes spark-shell works with Spark connect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-48936&quot;&gt;&lt;del&gt;SPARK-48936&lt;/del&gt;&lt;/a&gt;, the `assembly` module is compiled prior to `connect-client-jvm` to facilitate the packaging output. However, tests related to RemoteSparkSession in the `connect-client-jvm` module depend on the packaged results from the `assembly` module, specifically the JARs located in `assembly/target/scala-2.13/jars/`. Since the latter is a convention, executing&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
build/mvn clean install -DskipTests &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;will not produce any errors. But if we directly execute&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
build/mvn clean install &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;we will encounter test errors similar to the following when testing the `connect-client-jvm` module:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.044 s &amp;lt;&amp;lt;&amp;lt; FAILURE! &#8211; in org.apache.spark.sql.JavaEncoderSuite
[ERROR] org.apache.spark.sql.JavaEncoderSuite &#8211; Time elapsed: 0.044 s &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: assertion failed: Fail to locate the target folder: &lt;span class=&quot;code-quote&quot;&gt;&apos;/Users/yangjie01/SourceCode/git/spark-maven/sql/connect/server/target&apos;&lt;/span&gt;. SPARK_HOME=&lt;span class=&quot;code-quote&quot;&gt;&apos;/Users/yangjie01/SourceCode/git/spark-maven&apos;&lt;/span&gt;. Make sure the spark project jars has been built (e.g. using build/sbt &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;)and the env variable `SPARK_HOME` is set correctly.
&#160; at scala.Predef$.&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;(Predef.scala:279)
&#160; at org.apache.spark.sql.connect.test.IntegrationTestUtils$.tryFindJar(IntegrationTestUtils.scala:138)
&#160; at org.apache.spark.sql.connect.test.IntegrationTestUtils$.findJar(IntegrationTestUtils.scala:116)
&#160; at org.apache.spark.sql.connect.test.SparkConnectServerUtils$.sparkConnect$lzycompute(RemoteSparkSession.scala:65)
&#160; at org.apache.spark.sql.connect.test.SparkConnectServerUtils$.sparkConnect(RemoteSparkSession.scala:62)
&#160; at org.apache.spark.sql.connect.test.SparkConnectServerUtils$.start(RemoteSparkSession.scala:135)
&#160; at org.apache.spark.sql.connect.test.SparkConnectServerUtils$.createSparkSession(RemoteSparkSession.scala:181)
&#160; at org.apache.spark.sql.connect.test.SparkConnectServerUtils.createSparkSession(RemoteSparkSession.scala)
&#160; at org.apache.spark.sql.JavaEncoderSuite.setup(JavaEncoderSuite.java:42)
&#160; at java.base/java.lang.reflect.Method.invoke(Method.java:569)
&#160; at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
&#160; Suppressed: java.lang.NullPointerException: Cannot invoke &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.spark.sql.SparkSession.stop()&quot;&lt;/span&gt; because &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.spark.sql.JavaEncoderSuite.spark&quot;&lt;/span&gt; is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&#160; &#160; at org.apache.spark.sql.JavaEncoderSuite.tearDown(JavaEncoderSuite.java:47)
&#160; &#160; at java.base/java.lang.reflect.Method.invoke(Method.java:569)
&#160; &#160; at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
&#160; &#160; at java.base/java.util.Collections$UnmodifiableCollection.forEach(Collections.java:1092)
&#160; &#160; ... 1 more
[INFO]&#160;
[INFO] Results:
[INFO]&#160;
[ERROR] Failures:&#160;
[ERROR] &#160; JavaEncoderSuite.setup:42 assertion failed: Fail to locate the target folder: &lt;span class=&quot;code-quote&quot;&gt;&apos;/Users/yangjie01/SourceCode/git/spark-maven/sql/connect/server/target&apos;&lt;/span&gt;. SPARK_HOME=&lt;span class=&quot;code-quote&quot;&gt;&apos;/Users/yangjie01/SourceCode/git/spark-maven&apos;&lt;/span&gt;. Make sure the spark project jars has been built (e.g. using build/sbt &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;)and the env variable `SPARK_HOME` is set correctly.
[INFO]&#160;
[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13613119">SPARK-51603</key>
            <summary>logical circular dependency between modules `connect-client-jvm` and `assembly`</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="LuciferYang">Yang Jie</assignee>
                                    <reporter username="LuciferYang">Yang Jie</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 26 Mar 2025 05:18:48 +0000</created>
                <updated>Fri, 28 Mar 2025 12:02:07 +0000</updated>
                            <resolved>Fri, 28 Mar 2025 03:56:49 +0000</resolved>
                                    <version>4.0.0</version>
                                    <fixVersion>4.0.0</fixVersion>
                                    <component>Connect</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17939118" author="luciferyang" created="Fri, 28 Mar 2025 03:11:31 +0000"  >&lt;p&gt;Regarding the issue described in Jira, here are the possible solutions:&lt;/p&gt;

&lt;p&gt;1. Try to create a new module named `connect-jvm-integration-testing` and move the tests related to `RemoteSparkSession` into this module. At the same time, make the `connect-jvm-integration-testing` module dependent on `connect-client-jvm`, `connect`, and `assembly`. The feasibility of this solution remains to be verified.&lt;/p&gt;

&lt;p&gt;2. As I suggested in the pull request at &lt;a href=&quot;https://github.com/apache/spark/pull/50396&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/50396&lt;/a&gt;, automatically skip the tests related to `RemoteSparkSession` when the directory `assembly/target/scala-2.13/jars/` does not exist.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gurwls223&quot; class=&quot;user-hover&quot; rel=&quot;gurwls223&quot;&gt;gurwls223&lt;/a&gt;&#160; WDYT? Additionally, do you think this issue could potentially block the release of version 4.0(Personally, I think it is)?&lt;/p&gt;</comment>
                            <comment id="17939119" author="luciferyang" created="Fri, 28 Mar 2025 03:16:46 +0000"  >&lt;p&gt;Unfortunately, the Maven daily test didn&apos;t catch this issue earlier because we always execute `mvn clean install -DskipTests` first in the Maven daily test, followed by `mvn test -pl sql/connect/client/jvm`.&lt;/p&gt;</comment>
                            <comment id="17939121" author="gurwls223" created="Fri, 28 Mar 2025 03:30:31 +0000"  >&lt;p&gt;1. is an over kill I think. I would go with 2 for now&lt;/p&gt;</comment>
                            <comment id="17939124" author="luciferyang" created="Fri, 28 Mar 2025 03:56:49 +0000"  >&lt;p&gt;Issue resolved by pull request 50396&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/50396&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/50396&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            32 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1uzvk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>