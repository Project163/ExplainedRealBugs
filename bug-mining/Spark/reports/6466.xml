<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:05:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-27638] date format yyyy-M-dd string comparison not handled properly </title>
                <link>https://issues.apache.org/jira/browse/SPARK-27638</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The below example works with both Mysql and Hive, however not with spark.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
mysql&amp;gt; select * from date_test where date_col &amp;gt;= &lt;span class=&quot;code-quote&quot;&gt;&apos;2000-1-1&apos;&lt;/span&gt;;
+------------+
| date_col   |
+------------+
| 2000-01-01 |
+------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The reason is that Spark casts both sides to String type during date and string comparison for partial date support. Please find more details in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-8420&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-8420&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Based on some tests, the behavior of Date and String comparison in Hive and Mysql:&lt;br/&gt;
Hive: Cast to Date, partial date is not supported&lt;br/&gt;
Mysql: Cast to Date,  certain &quot;partial date&quot; is supported by defining certain date string parse rules. Check out &lt;tt&gt;str_to_datetime&lt;/tt&gt; in &lt;a href=&quot;https://github.com/mysql/mysql-server/blob/5.5/sql-common/my_time.c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mysql/mysql-server/blob/5.5/sql-common/my_time.c&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here&apos;s 2 proposals:&lt;br/&gt;
a. Follow Mysql parse rule, but some partial date string comparison cases won&apos;t be supported either. &lt;br/&gt;
b. Cast String value to Date, if it passes use date.toString, original string otherwise.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13231714">SPARK-27638</key>
            <summary>date format yyyy-M-dd string comparison not handled properly </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pengbo">peng bo</assignee>
                                    <reporter username="pengbo">peng bo</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 May 2019 07:59:33 +0000</created>
                <updated>Sun, 5 Mar 2023 23:49:23 +0000</updated>
                            <resolved>Tue, 14 May 2019 13:28:55 +0000</resolved>
                                    <version>2.4.2</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16833584" author="pengbo" created="Mon, 6 May 2019 08:16:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt; Your opinion will be appreciated.&lt;/p&gt;</comment>
                            <comment id="16833931" author="srowen" created="Mon, 6 May 2019 15:43:28 +0000"  >&lt;p&gt;CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxgekk&quot; class=&quot;user-hover&quot; rel=&quot;maxgekk&quot;&gt;maxgekk&lt;/a&gt; but isn&apos;t the issue that your date isn&apos;t matching the default format yyyy-MM-dd? what about parsing the string with the format explicitly specified?&lt;/p&gt;</comment>
                            <comment id="16833949" author="maxgekk" created="Mon, 6 May 2019 15:56:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt; The date literal should be casted to the date type by&#160;&lt;a href=&quot;https://github.com/apache/spark/blob/ab8710b57916a129fcb89464209361120d224535/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/util/DateTimeUtils.scala#L376&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;stringToDate&lt;/a&gt; that is able to parse the date by default, see supported patterns:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
`yyyy`
`yyyy-[m]m`
`yyyy-[m]m-[d]d`
`yyyy-[m]m-[d]d `
`yyyy-[m]m-[d]d *`
`yyyy-[m]m-[d]dT*
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16833957" author="maxgekk" created="Mon, 6 May 2019 16:06:50 +0000"  >&lt;p&gt;It works with explicit to_date:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
scala&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; ds = spark.range(1).selectExpr(&lt;span class=&quot;code-quote&quot;&gt;&quot;date &apos;2000-01-01&apos; as d&quot;&lt;/span&gt;)
ds: org.apache.spark.sql.DataFrame = [d: date]

scala&amp;gt; ds.where(&lt;span class=&quot;code-quote&quot;&gt;&quot;d &amp;gt;= to_date(&apos;2000-1-1&apos;)&quot;&lt;/span&gt;).show
+----------+
|         d|
+----------+
|2000-01-01|
+----------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but with to_date, it compares strings:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; ds.where(&lt;span class=&quot;code-quote&quot;&gt;&quot;d &amp;gt;= &lt;span class=&quot;code-quote&quot;&gt;&apos;2000-1-1&apos;&lt;/span&gt;&quot;&lt;/span&gt;).explain(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
== Parsed Logical Plan ==
&lt;span class=&quot;code-quote&quot;&gt;&apos;Filter (&apos;&lt;/span&gt;d &amp;gt;= 2000-1-1)
+- Project [10957 AS d#51]
   +- Range (0, 1, step=1, splits=Some(8))

== Analyzed Logical Plan ==
d: date
Filter (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(d#51 as string) &amp;gt;= 2000-1-1)
+- Project [10957 AS d#51]
   +- Range (0, 1, step=1, splits=Some(8))

== Optimized Logical Plan ==
LocalRelation &amp;lt;empty&amp;gt;, [d#51]

== Physical Plan ==
LocalTableScan &amp;lt;empty&amp;gt;, [d#51]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The same is for &apos;2000-01-01&apos;, the date column is casted to string. &lt;/p&gt;</comment>
                            <comment id="16833992" author="srowen" created="Mon, 6 May 2019 16:47:11 +0000"  >&lt;p&gt;Are you saying that&apos;s intended behavior or should be changed?&lt;/p&gt;</comment>
                            <comment id="16833999" author="cloud_fan" created="Mon, 6 May 2019 16:52:09 +0000"  >&lt;p&gt;I think it should be changed. When comapring string and int, we cast string to int. When comparing string and date, I think it&apos;s reasonable to cast string to date. We also need to think about some corner cases like `date_col &amp;gt; &apos;invalid_date_string&apos;`.&lt;/p&gt;</comment>
                            <comment id="16834214" author="maxgekk" created="Mon, 6 May 2019 21:41:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pengbo&quot; class=&quot;user-hover&quot; rel=&quot;pengbo&quot;&gt;pengbo&lt;/a&gt; Are you going to propose a PR for that? If not, I can fix the issue.&lt;/p&gt;</comment>
                            <comment id="16834322" author="pengbo" created="Tue, 7 May 2019 02:14:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxgekk&quot; class=&quot;user-hover&quot; rel=&quot;maxgekk&quot;&gt;maxgekk&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;I&apos;d love to propose a PR for this. However i am in the middle of something, I will try to do it by the end of this week if that&apos;s convenient for you as well.&lt;/p&gt;

&lt;p&gt;Besides, what&apos;s your suggestion about corner cases like `date_col &amp;gt; &apos;invalid_date_string&apos;` mentioned by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt; ? Switch back to string comparison?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="16839415" author="cloud_fan" created="Tue, 14 May 2019 13:28:55 +0000"  >&lt;p&gt;Issue resolved by pull request 24567&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/24567&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/24567&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13483830">SPARK-40610</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 27 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z02ew8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>