<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:59:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-23405] The task will hang up when a small table left semi join a big table</title>
                <link>https://issues.apache.org/jira/browse/SPARK-23405</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;ol&gt;
	&lt;li&gt;I run a sql: `select ls.cs_order_number from ls left semi join catalog_sales cs on ls.cs_order_number = cs.cs_order_number`, The `ls` table is a small table ,and the number is one. The `catalog_sales` table is a big table,&#160; and the number is 10 billion. The task will be hang up:&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12910363/12910363_taskhang+up.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;And the sql page is :&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12910362/12910362_SQL.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13138111">SPARK-23405</key>
            <summary>The task will hang up when a small table left semi join a big table</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="KaiXinXIaoLei">KaiXinXIaoLei</assignee>
                                    <reporter username="KaiXinXIaoLei">KaiXinXIaoLei</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Feb 2018 09:15:19 +0000</created>
                <updated>Thu, 1 Mar 2018 16:12:53 +0000</updated>
                            <resolved>Thu, 1 Mar 2018 16:10:48 +0000</resolved>
                                    <version>2.2.1</version>
                                    <fixVersion>2.4.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16362126" author="srowen" created="Tue, 13 Feb 2018 10:49:57 +0000"  >&lt;p&gt;There&apos;s just not enough info here to even establish something &apos;hung&apos; vs &apos;is taking a long time&apos;. This isn&apos;t reproducible and there&apos;s not much context about your data. It is, however, huge. This isn&apos;t useful as a JIRA.&lt;/p&gt;</comment>
                            <comment id="16362162" author="q79969786" created="Tue, 13 Feb 2018 11:23:10 +0000"  >&lt;p&gt;I think it&apos;s data skew, you should broadcast small table.&lt;/p&gt;</comment>
                            <comment id="16373785" author="kaixinxiaolei" created="Fri, 23 Feb 2018 01:26:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=q79969786&quot; class=&quot;user-hover&quot; rel=&quot;q79969786&quot;&gt;q79969786&lt;/a&gt; In the left semi join, the left table will not broadcast. And&#160; there is many null value of &apos;cs_order_number&apos; in the right table. I think the&#160; null value should be filter in the logical plan.&lt;/p&gt;</comment>
                            <comment id="16374182" author="kaixinxiaolei" created="Fri, 23 Feb 2018 10:17:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=q79969786&quot; class=&quot;user-hover&quot; rel=&quot;q79969786&quot;&gt;q79969786&lt;/a&gt; And if i run &apos;select ls.cs_order_number from ls left semi join catalog_sales cs on ls.cs_order_number = cs.cs_order_number and cs.cs_order_number is not null&apos;, the job will success&lt;/p&gt;</comment>
                            <comment id="16375973" author="apachespark" created="Sun, 25 Feb 2018 07:24:04 +0000"  >&lt;p&gt;User &apos;KaiXinXiaoLei&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/20670&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20670&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16375985" author="kaixinxiaolei" created="Sun, 25 Feb 2018 08:16:48 +0000"  >&lt;p&gt;i run `select ls.cs_order_number from ls left semi join catalog_sales cs on ls.cs_order_number = cs.cs_order_number`, the&#160;&#160;Optimized Logical Plan is :&lt;/p&gt;

&lt;p&gt;== Optimized Logical Plan ==&lt;br/&gt;
 Join LeftSemi, (cs_order_number#1 = cs_order_number#22)&lt;br/&gt;
 :- Project &lt;a href=&quot;#1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;cs_order_number#1&lt;/a&gt;&lt;br/&gt;
 : +- Filter isnotnull(cs_order_number#1)&lt;br/&gt;
 : +- MetastoreRelation 100t, ls&lt;br/&gt;
 +- Project &lt;a href=&quot;#22&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;cs_order_number#22&lt;/a&gt;&lt;br/&gt;
 +-Relation&lt;a href=&quot;#5,cs_ext_sales_price#28,... 10 more fields&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;cs_sold_date_sk#5,cs_ext_sales_price#28,... 10 more fields&lt;/a&gt; parquet&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I think the Optimized Logical Plan should be:&lt;/p&gt;

&lt;p&gt;== Optimized Logical Plan ==&lt;br/&gt;
 Join LeftSemi, (cs_order_number#1 = cs_order_number#22)&lt;br/&gt;
 :- Project &lt;a href=&quot;#1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;cs_order_number#1&lt;/a&gt;&lt;br/&gt;
 : +- Filter isnotnull(cs_order_number#1)&lt;br/&gt;
 : +- MetastoreRelation 100t, ls&lt;br/&gt;
 +- Project &lt;a href=&quot;#22&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;cs_order_number#22&lt;/a&gt;&lt;br/&gt;
 &lt;font color=&quot;#ff0000&quot;&gt;+- Filter isnotnull(cs_order_number#22)&lt;/font&gt;&lt;br/&gt;
 +- Relation&lt;a href=&quot;#5,,cs_ext_sales_price#28,... 10 more fields&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;cs_sold_date_sk#5,,cs_ext_sales_price#28,... 10 more fields&lt;/a&gt; parquet&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16382226" author="cloud_fan" created="Thu, 1 Mar 2018 16:10:48 +0000"  >&lt;p&gt;Issue resolved by pull request 20670&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/20670&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20670&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12910362" name="SQL.png" size="45199" author="KaiXinXIaoLei" created="Tue, 13 Feb 2018 09:16:04 +0000"/>
                            <attachment id="12910363" name="taskhang up.png" size="48015" author="KaiXinXIaoLei" created="Tue, 13 Feb 2018 09:16:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3q447:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>