<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:52:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-19812] YARN shuffle service fails to relocate recovery DB across NFS directories</title>
                <link>https://issues.apache.org/jira/browse/SPARK-19812</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The yarn shuffle service tries to switch from the yarn local directories to the real recovery directory but can fail to move the existing recovery db&apos;s.  It fails due to Files.move not doing directories that have contents.&lt;/p&gt;

&lt;p&gt;2017-03-03 14:57:19,558 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; ERROR yarn.YarnShuffleService: Failed to move recovery file sparkShuffleRecovery.ldb to the path /mapred/yarn-nodemanager/nm-aux-services/spark_shuffle&lt;br/&gt;
java.nio.file.DirectoryNotEmptyException:/yarn-local/sparkShuffleRecovery.ldb&lt;br/&gt;
        at sun.nio.fs.UnixCopyFile.move(UnixCopyFile.java:498)&lt;br/&gt;
        at sun.nio.fs.UnixFileSystemProvider.move(UnixFileSystemProvider.java:262)&lt;br/&gt;
        at java.nio.file.Files.move(Files.java:1395)&lt;br/&gt;
        at org.apache.spark.network.yarn.YarnShuffleService.initRecoveryDb(YarnShuffleService.java:369)&lt;br/&gt;
        at org.apache.spark.network.yarn.YarnShuffleService.createSecretManager(YarnShuffleService.java:200)&lt;br/&gt;
        at org.apache.spark.network.yarn.YarnShuffleService.serviceInit(YarnShuffleService.java:174)&lt;br/&gt;
        at org.apache.hadoop.service.AbstractService.init(AbstractService.java:163)&lt;br/&gt;
        at org.apache.hadoop.yarn.server.nodemanager.containermanager.AuxServices.serviceInit(AuxServices.java:143)&lt;br/&gt;
        at org.apache.hadoop.service.AbstractService.init(AbstractService.java:163)&lt;br/&gt;
        at org.apache.hadoop.service.CompositeService.serviceInit(CompositeService.java:107)&lt;br/&gt;
        at org.apache.hadoop.yarn.server.nodemanager.containermanager.ContainerManagerImpl.serviceInit(ContainerManagerImpl.java:262)&lt;br/&gt;
        at org.apache.hadoop.service.AbstractService.init(AbstractService.java:163)&lt;br/&gt;
        at org.apache.hadoop.service.CompositeService.serviceInit(CompositeService.java:107)&lt;br/&gt;
        at org.apache.hadoop.yarn.server.nodemanager.NodeManager.serviceInit(NodeManager.java:357)&lt;br/&gt;
        at org.apache.hadoop.service.AbstractService.init(AbstractService.java:163)&lt;br/&gt;
        at org.apache.hadoop.yarn.server.nodemanager.NodeManager.initAndStartNodeManager(NodeManager.java:636)&lt;br/&gt;
        at org.apache.hadoop.yarn.server.nodemanager.NodeManager.main(NodeManager.java:684)&lt;/p&gt;

&lt;p&gt;This used to use f.renameTo and we switched it in the pr due to review comments and it looks like didn&apos;t do a final real test. The tests are using files rather then directories so it didn&apos;t catch. We need to fix the test also.&lt;/p&gt;

&lt;p&gt;history: &lt;a href=&quot;https://github.com/apache/spark/pull/14999/commits/65de8531ccb91287f5a8a749c7819e99533b9440&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14999/commits/65de8531ccb91287f5a8a749c7819e99533b9440&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13048083">SPARK-19812</key>
            <summary>YARN shuffle service fails to relocate recovery DB across NFS directories</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tgraves">Thomas Graves</assignee>
                                    <reporter username="tgraves">Thomas Graves</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Mar 2017 15:42:01 +0000</created>
                <updated>Sun, 17 May 2020 18:13:50 +0000</updated>
                            <resolved>Wed, 26 Apr 2017 13:25:26 +0000</resolved>
                                    <version>2.0.1</version>
                                    <fixVersion>2.2.0</fixVersion>
                    <fixVersion>2.3.0</fixVersion>
                                    <component>Spark Core</component>
                    <component>YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15894584" author="tgraves" created="Fri, 3 Mar 2017 15:43:57 +0000"  >&lt;p&gt;note that it will go ahead and start using the recovery db, it just doesn&apos;t copy over the old one so anything running gets lost.&lt;/p&gt;</comment>
                            <comment id="15900821" author="jerryshao" created="Wed, 8 Mar 2017 07:10:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tgraves&quot; class=&quot;user-hover&quot; rel=&quot;tgraves&quot;&gt;tgraves&lt;/a&gt;, I&apos;m not quite sure what you mean here?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The tests are using files rather then directories so it didn&apos;t catch. We need to fix the test also.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;From my understanding this issues happens when dest dir is not empty and try to move with REPLACE_EXISTING. Also be happened when calling rename failed and the source dir is not empty directory.&lt;/p&gt;

&lt;p&gt;But I cannot imagine how this happened, from the log it is more like a `rename` failure issue, since the path in Exception points to source dir.&lt;/p&gt;</comment>
                            <comment id="15979349" author="tgraves" created="Fri, 21 Apr 2017 20:44:28 +0000"  >&lt;p&gt;Sorry wasn&apos;t clear in the original description, it errors when moving across nfs mounts.  I was wrong on the unit test comment.  Unit test is fine except it doesn&apos;t test across mounts which would be really difficult to do.&lt;/p&gt;</comment>
                            <comment id="15981592" author="apachespark" created="Mon, 24 Apr 2017 18:02:04 +0000"  >&lt;p&gt;User &apos;tgravescs&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17748&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17748&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 30 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ax7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>