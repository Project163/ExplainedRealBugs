<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:29:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-38604] ceil and floor return different types when called from scala than sql</title>
                <link>https://issues.apache.org/jira/browse/SPARK-38604</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;In Spark 3.3.0 &#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-37475&quot; title=&quot;Add Scale Parameter to Floor and Ceil functions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-37475&quot;&gt;&lt;del&gt;SPARK-37475&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;http://example.com/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt;[https://github.com/apache/spark/pull/34729] went in and added support for a scale parameter to floor and ceil.&#160; There was &lt;a href=&quot;https://github.com/apache/spark/pull/34729#discussion_r761157050&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;discussion&lt;/a&gt; about potential incompatibilities, specifically with respect to the return types. It looks like it was [decided|https://github.com/apache/spark/pull/34729#discussion_r767446855 to keep the old behavior if no scale parameter was passed in, but use the new functionality if a scale is passed in.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;But the scala API didn&apos;t get updated to do the same thing as the SQL API.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
scala&amp;gt; spark.range(1).selectExpr(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;ceil(id) as one_arg_sql&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;ceil(id, 0) as two_arg_sql&quot;&lt;/span&gt;).select(col(&lt;span class=&quot;code-quote&quot;&gt;&quot;*&quot;&lt;/span&gt;), ceil(col(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;)).alias(&lt;span class=&quot;code-quote&quot;&gt;&quot;one_arg_func&quot;&lt;/span&gt;), ceil(col(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;), lit(0)).alias(&lt;span class=&quot;code-quote&quot;&gt;&quot;two_arg_func&quot;&lt;/span&gt;)).printSchema
root
 |-- id: &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; (nullable = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
 |-- one_arg_sql: &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- two_arg_sql: decimal(20,0) (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- one_arg_func: decimal(20,0) (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- two_arg_func: decimal(20,0) (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&#160;

scala&amp;gt; spark.range(1).selectExpr(&lt;span class=&quot;code-quote&quot;&gt;&quot;cast(id as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) as id&quot;&lt;/span&gt;).selectExpr(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;ceil(id) as one_arg_sql&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;ceil(id, 0) as two_arg_sql&quot;&lt;/span&gt;).select(col(&lt;span class=&quot;code-quote&quot;&gt;&quot;*&quot;&lt;/span&gt;), ceil(col(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;)).alias(&lt;span class=&quot;code-quote&quot;&gt;&quot;one_arg_func&quot;&lt;/span&gt;), ceil(col(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;), lit(0)).alias(&lt;span class=&quot;code-quote&quot;&gt;&quot;two_arg_func&quot;&lt;/span&gt;)).printSchema
root
&#160;|-- id: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; (nullable = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
&#160;|-- one_arg_sql: &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&#160;|-- two_arg_sql: decimal(30,0) (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&#160;|-- one_arg_func: decimal(30,0) (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&#160;|-- two_arg_func: decimal(30,0) (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And because the python code call into this too it also has the same problem. I suspect that the java and R code also expose it too, but I didn&apos;t check.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13434685">SPARK-38604</key>
            <summary>ceil and floor return different types when called from scala than sql</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="revans2">Robert Joseph Evans</assignee>
                                    <reporter username="revans2">Robert Joseph Evans</reporter>
                        <labels>
                    </labels>
                <created>Sat, 19 Mar 2022 13:03:29 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:00 +0000</updated>
                            <resolved>Tue, 22 Mar 2022 00:48:09 +0000</resolved>
                                    <version>3.3.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17509265" author="revans2" created="Sat, 19 Mar 2022 13:07:00 +0000"  >&lt;p&gt;I marked this as a critical because it technically is a breaking change for all but the SQL APIs. I could see blocker because it could be considered data corruption, but only in a really loose definition of that.&#160; Could someone assign this to me? I have a patch that fixes it. It is a very simple patch. I don&apos;t appear to have permission to assign to myself.&lt;/p&gt;</comment>
                            <comment id="17509266" author="apachespark" created="Sat, 19 Mar 2022 13:17:08 +0000"  >&lt;p&gt;User &apos;revans2&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/35913&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35913&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17509267" author="apachespark" created="Sat, 19 Mar 2022 13:17:55 +0000"  >&lt;p&gt;User &apos;revans2&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/35913&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35913&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17509915" author="apachespark" created="Mon, 21 Mar 2022 14:33:28 +0000"  >&lt;p&gt;User &apos;revans2&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/35925&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35925&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17509916" author="apachespark" created="Mon, 21 Mar 2022 14:33:48 +0000"  >&lt;p&gt;User &apos;revans2&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/35925&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35925&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17510171" author="gurwls223" created="Tue, 22 Mar 2022 00:48:09 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;https://github.com/apache/spark/pull/35913&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35913&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z10mvk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12350369">3.3.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>