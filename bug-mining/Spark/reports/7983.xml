<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:26:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-35673] Spark fails on unrecognized hint in subquery</title>
                <link>https://issues.apache.org/jira/browse/SPARK-35673</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Spark queries to fail on unrecognized hints in subqueries. An example to reproduce:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; /*+ use_hash */ 42;
&lt;span class=&quot;code-comment&quot;&gt;-- 21/06/08 01:28:05 WARN HintErrorLogger: Unrecognized hint: use_hash()
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;-- 42
&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; *
&lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; (
    &lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; /*+ use_hash */ 42
);
&lt;span class=&quot;code-comment&quot;&gt;-- 21/06/08 01:28:07 WARN HintErrorLogger: Unrecognized hint: use_hash()
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;-- Error &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; query: unresolved &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; &apos;Project [*];
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;-- &apos;Project [*]
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;-- +- SubqueryAlias __auto_generated_subquery_name
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;--    +- Project [42 &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; 42#2]
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;--       +- OneRowRelation&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13382583">SPARK-35673</key>
            <summary>Spark fails on unrecognized hint in subquery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fchen">Fu Chen</assignee>
                                    <reporter username="rshkv">Willi Raschkowski</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Jun 2021 00:29:47 +0000</created>
                <updated>Sun, 20 Jun 2021 03:31:30 +0000</updated>
                            <resolved>Thu, 10 Jun 2021 07:50:29 +0000</resolved>
                                    <version>3.0.2</version>
                    <version>3.1.1</version>
                    <version>3.1.2</version>
                    <version>3.2.0</version>
                                    <fixVersion>3.0.3</fixVersion>
                    <fixVersion>3.2.0</fixVersion>
                    <fixVersion>3.1.3</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17359059" author="maropu" created="Tue, 8 Jun 2021 06:09:00 +0000"  >&lt;p&gt;Since 2.4.x does not have this issue, it is a kind of regressions. (I&apos;ve checked that the master still has it). cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=angerszhuuu&quot; class=&quot;user-hover&quot; rel=&quot;angerszhuuu&quot;&gt;angerszhuuu&lt;/a&gt;&#160;Do you have time to look into this?&lt;/p&gt;</comment>
                            <comment id="17359524" author="fchen" created="Tue, 8 Jun 2021 18:48:44 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maropu&quot; class=&quot;user-hover&quot; rel=&quot;maropu&quot;&gt;maropu&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;This is because &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-28292&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Spark-28292&lt;/a&gt; move rule RemoveAllHints after batch Resolution.&lt;br/&gt;
 The rule ResolveReferences is executed before rule RemoveAllHints. when the plan(Project&lt;span class=&quot;error&quot;&gt;&amp;#91;*&amp;#93;&lt;/span&gt;) contains an unresolved child(UnresolvedHint), means `plan.childrenResolved == false`, so ResolveReferences can&apos;t expand stars.&lt;/p&gt;

&lt;p&gt;But we can&apos;t put the rule RemoveAllHints before batch Resolution, because the user-defined hint is injected in batch Resolution.&lt;/p&gt;

&lt;p&gt;Any idea or suggestions to fix it?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17359663" author="maropu" created="Tue, 8 Jun 2021 23:56:23 +0000"  >&lt;p&gt;We cannot move `RemoveAllHints` just after the `Hints` batch?&lt;/p&gt;</comment>
                            <comment id="17359704" author="fchen" created="Wed, 9 Jun 2021 02:15:04 +0000"  >&lt;p&gt;No, we can&apos;t.&#160; The user-defined hint is injected in batch `Post-Hoc Resolution`.&lt;/p&gt;</comment>
                            <comment id="17359716" author="fchen" created="Wed, 9 Jun 2021 02:40:53 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maropu&quot; class=&quot;user-hover&quot; rel=&quot;maropu&quot;&gt;maropu&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I think a better implement for injecting user-defined hint is &lt;a href=&quot;https://github.com/apache/spark/pull/25071/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR-25071&lt;/a&gt;, add a new public API `injectResolutionHint`, then we can inject user-defined hint in batch `Hints`, and add`RemoveAllHints`to the end of batch `Hints`.&lt;/p&gt;</comment>
                            <comment id="17359773" author="cloud_fan" created="Wed, 9 Jun 2021 05:40:13 +0000"  >&lt;p&gt;Can we simply change `UnresolvedHint.resolved` to true?&lt;/p&gt;</comment>
                            <comment id="17359807" author="angerszhuuu" created="Wed, 9 Jun 2021 06:52:35 +0000"  >&lt;p&gt;Just check the comment, problem is clear, we need to discuss more about this feature.&lt;/p&gt;</comment>
                            <comment id="17359835" author="fchen" created="Wed, 9 Jun 2021 07:34:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can we simply change `UnresolvedHint.resolved` to true?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We can&apos;t simply change `UnresolvedHint.resolved = true`, but `UnresolvedHint.resolved = child.resolved`.&lt;/p&gt;

&lt;p&gt;I will try and create the pull request later.&lt;/p&gt;</comment>
                            <comment id="17359908" author="apachespark" created="Wed, 9 Jun 2021 10:19:50 +0000"  >&lt;p&gt;User &apos;cfmcgrady&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/32841&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/32841&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13384309">SPARK-35795</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0rqmo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>