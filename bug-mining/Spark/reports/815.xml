<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:18:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-3535] Spark on Mesos not correctly setting heap overhead</title>
                <link>https://issues.apache.org/jira/browse/SPARK-3535</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Spark on Mesos does account for any memory overhead.  The result is that tasks are OOM killed nearly 95% of the time.&lt;/p&gt;

&lt;p&gt;Like with the Hadoop on Mesos project, Spark should set aside 15-25% of the executor memory for JVM overhead.&lt;/p&gt;

&lt;p&gt;For example, see: &lt;a href=&quot;https://github.com/mesos/hadoop/blob/master/src/main/java/org/apache/hadoop/mapred/ResourcePolicy.java#L55-L63&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mesos/hadoop/blob/master/src/main/java/org/apache/hadoop/mapred/ResourcePolicy.java#L55-L63&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12741598">SPARK-3535</key>
            <summary>Spark on Mesos not correctly setting heap overhead</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brenden">Brenden Matthews</assignee>
                                    <reporter username="brenden">Brenden Matthews</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Sep 2014 21:12:03 +0000</created>
                <updated>Wed, 20 May 2015 08:25:47 +0000</updated>
                            <resolved>Fri, 3 Oct 2014 19:59:34 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.1.1</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                                    <component>Mesos</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14134499" author="tstclair" created="Mon, 15 Sep 2014 21:20:01 +0000"  >&lt;p&gt;Are you seeing this under fine grained, course grained, or both.  &lt;/p&gt;</comment>
                            <comment id="14134524" author="brenden" created="Mon, 15 Sep 2014 21:31:25 +0000"  >&lt;p&gt;I&apos;m seeing this in fine grained mode. I confirmed that Spark sets the heap size to equal to the task memory.&lt;/p&gt;</comment>
                            <comment id="14134533" author="brenden" created="Mon, 15 Sep 2014 21:37:14 +0000"  >&lt;p&gt;I wrote a patch:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/pull/2401&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2401&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m not very familiar with Spark internals or conventions, so feel free to rip this apart.&lt;/p&gt;</comment>
                            <comment id="14134592" author="aash" created="Mon, 15 Sep 2014 22:21:13 +0000"  >&lt;p&gt;Why does the task need extra memory if the heap size equals the available task memory?  Filesystem cache?&lt;/p&gt;</comment>
                            <comment id="14134599" author="brenden" created="Mon, 15 Sep 2014 22:26:17 +0000"  >&lt;p&gt;The JVM heap size does not include the stack size, GC overhead, or anything malloc&apos;d by other libraries linked into the JVM.&lt;/p&gt;</comment>
                            <comment id="14135073" author="deric" created="Tue, 16 Sep 2014 07:05:17 +0000"  >&lt;p&gt;I&apos;m having the same issue in course grained mode - &lt;tt&gt;spark.mesos.coarse=true&lt;/tt&gt; (in fine grained it&apos;s less frequent) and with cgroups isolation enabled. Without the isolation it might be harder to reproduce the bug.&lt;/p&gt;</comment>
                            <comment id="14136321" author="brenden" created="Tue, 16 Sep 2014 22:01:05 +0000"  >&lt;p&gt;I&apos;ve updated the patch to include the same change for coarse mode, and also updated the documentation.&lt;/p&gt;</comment>
                            <comment id="14139763" author="brenden" created="Thu, 18 Sep 2014 23:58:10 +0000"  >&lt;p&gt;After some even further digging, I noticed the following error in the Mesos slave log:&lt;/p&gt;

&lt;p&gt;  E0918 23:13:48.726176 130743 slave.cpp:2204] Failed to update resources for container ae051668-6cb8-4252-8b6e-cfbac38e7e5c of executor 20140813-050807-3852091146-5050-1861-231 running task 3 on status update for terminal task, destroying container:Collect failed: No cpus resource given&lt;/p&gt;

&lt;p&gt;I&apos;ll update my patch accordingly.&lt;/p&gt;</comment>
                            <comment id="14139845" author="vinodkone" created="Fri, 19 Sep 2014 01:26:46 +0000"  >&lt;p&gt;This can happen if the spark executor doesn&apos;t use any cpus (or memory) and there are no tasks running on it. Note that in the next release of Mesos, such an executor is not allowed to launch. &lt;a href=&quot;https://issues.apache.org/jira/browse/MESOS-1807&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/MESOS-1807&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12726751">SPARK-2445</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i202ef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327368">1.1.1</customfieldvalue>
    <customfieldvalue id="12327369">1.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>