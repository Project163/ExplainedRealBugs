<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:02:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-19287] JavaPairRDD flatMapValues requires function returning Iterable, not Iterator</title>
                <link>https://issues.apache.org/jira/browse/SPARK-19287</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-3369&quot; title=&quot;Java mapPartitions Iterator-&amp;gt;Iterable is inconsistent with Scala&amp;#39;s Iterator-&amp;gt;Iterator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-3369&quot;&gt;&lt;del&gt;SPARK-3369&lt;/del&gt;&lt;/a&gt; corrected an old oversight in the Java API, wherein &lt;tt&gt;FlatMapFunction&lt;/tt&gt; required an &lt;tt&gt;Iterable&lt;/tt&gt; rather than &lt;tt&gt;Iterator&lt;/tt&gt;. As reported by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akrim&quot; class=&quot;user-hover&quot; rel=&quot;akrim&quot;&gt;akrim&lt;/a&gt;, it seems that this same type of problem was overlooked also in &lt;tt&gt;JavaPairRDD&lt;/tt&gt; (&lt;a href=&quot;https://github.com/apache/spark/blob/6c00c069e3c3f5904abd122cea1d56683031cca0/core/src/main/scala/org/apache/spark/api/java/JavaPairRDD.scala#L677&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/6c00c069e3c3f5904abd122cea1d56683031cca0/core/src/main/scala/org/apache/spark/api/java/JavaPairRDD.scala#L677&lt;/a&gt; ):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def flatMapValues[U](f: JFunction[V, java.lang.Iterable[U]]): JavaPairRDD[K, U] =
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As in &lt;tt&gt;PairRDDFunctions.scala&lt;/tt&gt;, whose &lt;tt&gt;flatMapValues&lt;/tt&gt; operates on &lt;tt&gt;TraversableOnce&lt;/tt&gt;, this should really take a function that returns an &lt;tt&gt;Iterator&lt;/tt&gt; &amp;#8211; really, &lt;tt&gt;FlatMapFunction&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;We can easily add an overload and deprecate the existing method.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def flatMapValues[U](f: FlatMapFunction[V, U]): JavaPairRDD[K, U]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is source- and binary-backwards-compatible, in Java 7. It&apos;s binary-backwards-compatible in Java 8, but not source-compatible. The following natural usage with Java 8 lambdas becomes ambiguous and won&apos;t compile &amp;#8211; Java won&apos;t figure out which to implement even based on the return type unfortunately:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;JavaPairRDD&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; pairRDD = ...
JavaPairRDD&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; mappedRDD = 
  pairRDD.flatMapValues(s -&amp;gt; Arrays.asList(s.length()).iterator());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It can be resolved by explicitly casting the lambda.&lt;/p&gt;

&lt;p&gt;We can at least document this. One day in Spark 3.x this can just be changed outright.&lt;/p&gt;

&lt;p&gt;It&apos;s conceivable to resolve this by making the new method called &quot;flatMapValues2&quot; or something ugly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13036178">SPARK-19287</key>
            <summary>JavaPairRDD flatMapValues requires function returning Iterable, not Iterator</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean R. Owen</assignee>
                                    <reporter username="srowen">Sean R. Owen</reporter>
                        <labels>
                            <label>release-notes</label>
                    </labels>
                <created>Thu, 19 Jan 2017 11:09:17 +0000</created>
                <updated>Tue, 28 Jan 2020 07:41:01 +0000</updated>
                            <resolved>Fri, 12 Oct 2018 23:11:16 +0000</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>Java API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15829739" author="srowen" created="Thu, 19 Jan 2017 11:11:16 +0000"  >&lt;p&gt;For the moment, targeting this to a hypothetical future Spark 3.x, because at least, this can be fixed in a major release. We may do something earlier for 2.x.&lt;/p&gt;</comment>
                            <comment id="15830715" author="akrim" created="Thu, 19 Jan 2017 22:24:20 +0000"  >&lt;p&gt;Considering that this was an oversight and should have been corrected in spark 2, is it really wrong to just fix it now, even at the cost of it being a breaking change? There are sometimes behavioral changes between spark minor releases, at least this change will fail loudly and the fix will be self evident.&lt;/p&gt;</comment>
                            <comment id="15831600" author="srowen" created="Fri, 20 Jan 2017 11:50:14 +0000"  >&lt;p&gt;Whether it was an oversight doesn&apos;t really change things. Someone could be using it. Generally minor versions must be backwards-compatible. The catch here is that it would only be source-incompatible, which is a lesser problem, but still not great. In exceptional circumstances you can take a breaking change. Here I would want someone else to agree that&apos;s the right thing; I think it&apos;s at best add a new method, which is ugly. It&apos;s not a critical bug or blocking usage.&lt;/p&gt;</comment>
                            <comment id="16645559" author="apachespark" created="Wed, 10 Oct 2018 21:15:33 +0000"  >&lt;p&gt;User &apos;srowen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22690&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22690&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16645560" author="apachespark" created="Wed, 10 Oct 2018 21:15:33 +0000"  >&lt;p&gt;User &apos;srowen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22690&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22690&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16648555" author="srowen" created="Fri, 12 Oct 2018 23:11:16 +0000"  >&lt;p&gt;Issue resolved by pull request 22690&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22690&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22690&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12312720" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Docs Text</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>JavaPairRDD/JavaPairDStream.flatMapValues() now requires a FlatMapFunction as an argument. This means this function now must return an Iterator, not Iterable. This corrects a long-standing inconsistency between the Scala and Java API, and allows the caller to supply merely an Iterator, not a full Iterable. Existing functions passed to this method can simply invoke &amp;quot;.iterator()&amp;quot; on their existing return value to comply with the new signature.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 5 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38xdb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12339177">3.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>