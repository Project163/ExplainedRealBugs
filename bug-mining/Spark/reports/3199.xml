<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 02:12:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92">
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-13207] _SUCCESS should not break partition discovery</title>
                <link>https://issues.apache.org/jira/browse/SPARK-13207</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Partitioning discovery will fail with the following case&lt;/p&gt;
&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;test(&lt;span class="code-quote"&gt;"_SUCCESS should not &lt;span class="code-keyword"&gt;break&lt;/span&gt; partitioning discovery"&lt;/span&gt;) {
    withTempPath { dir =&amp;gt;
      val tablePath = &lt;span class="code-keyword"&gt;new&lt;/span&gt; File(dir, &lt;span class="code-quote"&gt;"table"&lt;/span&gt;)
      val df = (1 to 3).map(i =&amp;gt; (i, i, i, i)).toDF(&lt;span class="code-quote"&gt;"a"&lt;/span&gt;, &lt;span class="code-quote"&gt;"b"&lt;/span&gt;, &lt;span class="code-quote"&gt;"c"&lt;/span&gt;, &lt;span class="code-quote"&gt;"d"&lt;/span&gt;)

      df.write
        .format(&lt;span class="code-quote"&gt;"parquet"&lt;/span&gt;)
        .partitionBy(&lt;span class="code-quote"&gt;"b"&lt;/span&gt;, &lt;span class="code-quote"&gt;"c"&lt;/span&gt;, &lt;span class="code-quote"&gt;"d"&lt;/span&gt;)
        .save(tablePath.getCanonicalPath)

      Files.touch(&lt;span class="code-keyword"&gt;new&lt;/span&gt; File(s&lt;span class="code-quote"&gt;"${tablePath.getCanonicalPath}/b=1"&lt;/span&gt;, &lt;span class="code-quote"&gt;"_SUCCESS"&lt;/span&gt;))
      Files.touch(&lt;span class="code-keyword"&gt;new&lt;/span&gt; File(s&lt;span class="code-quote"&gt;"${tablePath.getCanonicalPath}/b=1/c=1"&lt;/span&gt;, &lt;span class="code-quote"&gt;"_SUCCESS"&lt;/span&gt;))
      Files.touch(&lt;span class="code-keyword"&gt;new&lt;/span&gt; File(s&lt;span class="code-quote"&gt;"${tablePath.getCanonicalPath}/b=1/c=1/d=1"&lt;/span&gt;, &lt;span class="code-quote"&gt;"_SUCCESS"&lt;/span&gt;))
      checkAnswer(sqlContext.read.format(&lt;span class="code-quote"&gt;"parquet"&lt;/span&gt;).load(tablePath.getCanonicalPath), df)
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Because &lt;tt&gt;_SUCCESS&lt;/tt&gt; is the in the inner partitioning dirs, partitioning discovery will fail.&lt;/p&gt;</description>
                <environment/>
        <key id="12936936">SPARK-13207</key>
            <summary>_SUCCESS should not break partition discovery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yhuai">Yin Huai</assignee>
                                    <reporter username="yhuai">Yin Huai</reporter>
                        <labels>
                            <label>backport-needed</label>
                    </labels>
                <created>Fri, 5 Feb 2016 02:21:01 +0000</created>
                <updated>Sat, 11 Jun 2016 06:21:12 +0000</updated>
                            <resolved>Mon, 14 Mar 2016 16:03:32 +0000</resolved>
                                                    <fixVersion>1.6.2</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>SQL</component>
                        <due/>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15133529" author="yhuai" created="Fri, 5 Feb 2016 02:28:46 +0000">&lt;p&gt;It will be better to let partitioning discovery ignore files/dirs starting with "_" or ".". But, we need to change parquet to not rely on leaf files to get those metadata files (see &lt;a href="https://github.com/apache/spark/blob/master/sql/core/src/main/scala/org/apache/spark/sql/execution/datasources/parquet/ParquetRelation.scala#L421-L422" class="external-link" target="_blank" rel="nofollow noopener"&gt;https://github.com/apache/spark/blob/master/sql/core/src/main/scala/org/apache/spark/sql/execution/datasources/parquet/ParquetRelation.scala#L421-L422&lt;/a&gt;). I am thinking we can get a simple fix in master and 1.6 branch and then have a better fix in master.&lt;/p&gt;</comment>
                            <comment id="15133540" author="apachespark" created="Fri, 5 Feb 2016 02:53:04 +0000">&lt;p&gt;User 'yhuai' has created a pull request for this issue:&lt;br/&gt;
&lt;a href="https://github.com/apache/spark/pull/11088" class="external-link" target="_blank" rel="nofollow noopener"&gt;https://github.com/apache/spark/pull/11088&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15193524" author="yhuai" created="Mon, 14 Mar 2016 16:03:32 +0000">&lt;p&gt;Issue resolved by pull request 11088&lt;br/&gt;
&lt;a href="https://github.com/apache/spark/pull/11088" class="external-link" target="_blank" rel="nofollow noopener"&gt;https://github.com/apache/spark/pull/11088&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15193526" author="yhuai" created="Mon, 14 Mar 2016 16:04:00 +0000">&lt;p&gt;It will be good to back port this to 1.6 branch.&lt;/p&gt;</comment>
                            <comment id="15193730" author="apachespark" created="Mon, 14 Mar 2016 17:45:04 +0000">&lt;p&gt;User 'yhuai' has created a pull request for this issue:&lt;br/&gt;
&lt;a href="https://github.com/apache/spark/pull/11697" class="external-link" target="_blank" rel="nofollow noopener"&gt;https://github.com/apache/spark/pull/11697&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15305703" author="simeons" created="Sun, 29 May 2016 00:25:59 +0000">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai" class="user-hover" rel="yhuai"&gt;yhuai&lt;/a&gt; I see the same problem with common metadata files. Do we need another JIRA issue for those? &lt;/p&gt;

&lt;p&gt;For example, the following S3 directory structure:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;2016-05-28 20:08:18      41207 ss/tests/partitioning/placements/par_ts=201605260400/_common_metadata
2016-05-28 20:08:17    3981760 ss/tests/partitioning/placements/par_ts=201605260400/_metadata
2016-05-28 20:06:10   26149863 ss/tests/partitioning/placements/par_ts=201605260400/par_job=load/par_cat=engagement/part-r-00001-85d6c96a-4384-4e43-a575-ac71e147f349.gz.parquet
2016-05-28 20:06:42   32882968 ss/tests/partitioning/placements/par_ts=201605260400/par_job=load/par_cat=error/part-r-00002-85d6c96a-4384-4e43-a575-ac71e147f349.gz.parquet
2016-05-28 20:05:49    1700553 ss/tests/partitioning/placements/par_ts=201605260400/par_job=load/par_cat=late/part-r-00000-85d6c96a-4384-4e43-a575-ac71e147f349.gz.parquet
2016-05-28 20:04:21      41207 ss/tests/partitioning/placements/par_ts=201605270400/_common_metadata
2016-05-28 20:04:20    4120453 ss/tests/partitioning/placements/par_ts=201605270400/_metadata
2016-05-28 20:02:37   21471845 ss/tests/partitioning/placements/par_ts=201605270400/par_job=load/par_cat=engagement/part-r-00028-ad451b48-e48c-46eb-9e5f-c1bc4c663a4c.gz.parquet
2016-05-28 20:03:12   29981797 ss/tests/partitioning/placements/par_ts=201605270400/par_job=load/par_cat=error/part-r-00029-ad451b48-e48c-46eb-9e5f-c1bc4c663a4c.gz.parquet
2016-05-28 20:02:29    1525027 ss/tests/partitioning/placements/par_ts=201605270400/par_job=load/par_cat=late/part-r-00025-ad451b48-e48c-46eb-9e5f-c1bc4c663a4c.gz.parquet
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;generates the following partition discovery exception when loading &lt;tt&gt;/ss/tests/partitioning/placements&lt;/tt&gt;:&lt;/p&gt;

&lt;div class="code panel" style="border-width: 1px;"&gt;&lt;div class="codeContent panelContent"&gt;
&lt;pre class="code-java"&gt;java.lang.AssertionError: assertion failed: Conflicting partition column names detected:

	Partition column name list #0: par_ts, par_job, par_cat
	Partition column name list #1: par_ts

For partitioned table directories, data files should only live in leaf directories.
And directories at the same level should have the same partition column name.
Please check the following directories &lt;span class="code-keyword"&gt;for&lt;/span&gt; unexpected files or inconsistent partition column names:

	dbfs:/mnt/swoop-spark-play/ss/tests/partitioning/placements/par_ts=201605270400
	dbfs:/mnt/swoop-spark-play/ss/tests/partitioning/placements/par_ts=201605260400
	dbfs:/mnt/swoop-spark-play/ss/tests/partitioning/placements/par_ts=201605260400/par_job=load/par_cat=late
	dbfs:/mnt/swoop-spark-play/ss/tests/partitioning/placements/par_ts=201605270400/par_job=load/par_cat=late
	dbfs:/mnt/swoop-spark-play/ss/tests/partitioning/placements/par_ts=201605260400/par_job=load/par_cat=error
	dbfs:/mnt/swoop-spark-play/ss/tests/partitioning/placements/par_ts=201605270400/par_job=load/par_cat=error
	dbfs:/mnt/swoop-spark-play/ss/tests/partitioning/placements/par_ts=201605270400/par_job=load/par_cat=engagement
	dbfs:/mnt/swoop-spark-play/ss/tests/partitioning/placements/par_ts=201605260400/par_job=load/par_cat=engagement
	at scala.Predef$.&lt;span class="code-keyword"&gt;assert&lt;/span&gt;(Predef.scala:179)
	at org.apache.spark.sql.execution.datasources.PartitioningUtils$.resolvePartitions(PartitioningUtils.scala:246)
	at org.apache.spark.sql.execution.datasources.PartitioningUtils$.parsePartitions(PartitioningUtils.scala:115)
	at org.apache.spark.sql.sources.HadoopFsRelation.org$apache$spark$sql$sources$HadoopFsRelation$$discoverPartitions(interfaces.scala:621)
	at org.apache.spark.sql.sources.HadoopFsRelation$$anonfun$partitionSpec$3.apply(interfaces.scala:526)
	at org.apache.spark.sql.sources.HadoopFsRelation$$anonfun$partitionSpec$3.apply(interfaces.scala:525)
	at scala.Option.getOrElse(Option.scala:120)
	at org.apache.spark.sql.sources.HadoopFsRelation.partitionSpec(interfaces.scala:524)
	at org.apache.spark.sql.sources.HadoopFsRelation$$anonfun$partitionColumns$1.apply(interfaces.scala:578)
	at org.apache.spark.sql.sources.HadoopFsRelation$$anonfun$partitionColumns$1.apply(interfaces.scala:578)
	at scala.Option.getOrElse(Option.scala:120)
	at org.apache.spark.sql.sources.HadoopFsRelation.partitionColumns(interfaces.scala:578)
	at org.apache.spark.sql.sources.HadoopFsRelation.schema$lzycompute(interfaces.scala:637)
	at org.apache.spark.sql.sources.HadoopFsRelation.schema(interfaces.scala:635)
	at org.apache.spark.sql.execution.datasources.LogicalRelation.&amp;lt;init&amp;gt;(LogicalRelation.scala:37)
	at org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:125)
	at org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:109)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15325337" author="yhuai" created="Fri, 10 Jun 2016 21:51:41 +0000">&lt;p&gt;Hey &lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simeons" class="user-hover" rel="simeons"&gt;simeons&lt;/a&gt;, sorry for late reply. &lt;a href="https://issues.apache.org/jira/browse/SPARK-15454" title="HadoopFsRelation should filter out files starting with _" class="issue-link" data-issue-key="SPARK-15454"&gt;&lt;del&gt;SPARK-15454&lt;/del&gt;&lt;/a&gt; has fixed this issue.&lt;/p&gt;</comment>
                            <comment id="15325718" author="simeons" created="Sat, 11 Jun 2016 04:58:19 +0000">&lt;p&gt;&lt;a href="https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai" class="user-hover" rel="yhuai"&gt;yhuai&lt;/a&gt; The PR associated with that ticket explicitly calls out &lt;tt&gt;_metadata&lt;/tt&gt; and &lt;tt&gt;_common_metadata&lt;/tt&gt; as not excluded. i am wondering why that PR will fix this issue... Can you add a test to demonstrate that this is fixed?&lt;/p&gt;</comment>
                            <comment id="15325744" author="yhuai" created="Sat, 11 Jun 2016 06:10:59 +0000">&lt;p&gt;oh, I only looked at the title. OK. It is not fixed. Can you create a jira?&lt;/p&gt;</comment>
                            <comment id="15325749" author="yhuai" created="Sat, 11 Jun 2016 06:20:50 +0000">&lt;p&gt;Created &lt;a href="https://issues.apache.org/jira/browse/SPARK-15895" class="external-link" rel="nofollow"&gt;https://issues.apache.org/jira/browse/SPARK-15895&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12977835">SPARK-15895</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sgjb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334910">1.6.2</customfieldvalue>
    <customfieldvalue id="12329449">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>