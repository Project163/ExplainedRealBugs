<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:16:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-29854] lpad and rpad built in function not throw Exception for invalid len value</title>
                <link>https://issues.apache.org/jira/browse/SPARK-29854</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Spark Returns Empty String)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
0: jdbc:hive2:&lt;span class=&quot;code-comment&quot;&gt;//10.18.19.208:23040/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&amp;gt; SELECT lpad(&lt;span class=&quot;code-quote&quot;&gt;&apos;hihhhhhhhhhhhhhhhhhhhhhhh&apos;&lt;/span&gt;, 500000000000000000000000, &lt;span class=&quot;code-quote&quot;&gt;&apos;????????????&apos;&lt;/span&gt;);
&lt;/span&gt; +----------------------------------------------------+
|lpad(hihhhhhhhhhhhhhhhhhhhhhhh, CAST(500000000000000000000000 AS INT), ????????????)|

+----------------------------------------------------+


+----------------------------------------------------+


Hive:


SELECT lpad(&lt;span class=&quot;code-quote&quot;&gt;&apos;hihhhhhhhhhhhhhhhhhhhhhhh&apos;&lt;/span&gt;, 500000000000000000000000, &lt;span class=&quot;code-quote&quot;&gt;&apos;????????????&apos;&lt;/span&gt;);
 Error: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; compiling statement: FAILED: SemanticException [Error 10016]: Line 1:67 Argument type mismatch &lt;span class=&quot;code-quote&quot;&gt;&apos;&apos;????????????&apos;&lt;/span&gt;&apos;: lpad only takes INT/SHORT/BYTE types as 2-ths argument, got DECIMAL (state=42000,code=10016)


PostgreSQL


function lpad(unknown, numeric, unknown) does not exist


&#160;

Expected output:

In Spark also it should &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; Exception like Hive
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13267611">SPARK-29854</key>
            <summary>lpad and rpad built in function not throw Exception for invalid len value</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="maropu">Takeshi Yamamuro</assignee>
                                    <reporter username="abhishek.akg">ABHISHEK KUMAR GUPTA</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Nov 2019 05:41:33 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:09 +0000</updated>
                            <resolved>Fri, 22 May 2020 23:50:26 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16972076" author="ankitraj" created="Tue, 12 Nov 2019 05:43:40 +0000"  >&lt;p&gt;i will raise PR for this.&lt;/p&gt;</comment>
                            <comment id="16972302" author="gurwls223" created="Tue, 12 Nov 2019 11:38:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abhishek.akg&quot; class=&quot;user-hover&quot; rel=&quot;abhishek.akg&quot;&gt;abhishek.akg&lt;/a&gt; Can you please use {code} ... {code} block.&lt;/p&gt;</comment>
                            <comment id="16972303" author="gurwls223" created="Tue, 12 Nov 2019 11:39:28 +0000"  >&lt;p&gt;Other DMBSes have rpad and lpad too. Can you check?&lt;/p&gt;</comment>
                            <comment id="16973007" author="abhishek.akg" created="Wed, 13 Nov 2019 04:27:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt;: Hi I checked in Hive PostgreSQL : It gives Excpetion&lt;br/&gt;
In my SQL It gives NULL&lt;br/&gt;
mysql&amp;gt; SELECT lpad(&apos;hihhhhhhhhhhhhhhhhhhhhhhh&apos;, 500000000000000000000000, &apos;????????????&apos;);&lt;br/&gt;
&lt;ins&gt;-----------------------------------------------------------------------------&lt;/ins&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; lpad(&apos;hihhhhhhhhhhhhhhhhhhhhhhh&apos;, 500000000000000000000000, &apos;????????????&apos;) &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;-----------------------------------------------------------------------------&lt;/ins&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; NULL                                                                        &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;-----------------------------------------------------------------------------&lt;/ins&gt;&lt;br/&gt;
1 row in set, 3 warnings (0.00 sec)&lt;/p&gt;

&lt;p&gt;mysql&amp;gt; SELECT rpad(&apos;hihhhhhhhhhhhhhhhhhhhhhhh&apos;, 500000000000000000000000, &apos;????????????&apos;);&lt;br/&gt;
&lt;ins&gt;-----------------------------------------------------------------------------&lt;/ins&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; rpad(&apos;hihhhhhhhhhhhhhhhhhhhhhhh&apos;, 500000000000000000000000, &apos;????????????&apos;) &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;-----------------------------------------------------------------------------&lt;/ins&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; NULL                                                                        &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;ins&gt;-----------------------------------------------------------------------------&lt;/ins&gt;&lt;br/&gt;
1 row in set, 3 warnings (0.00 sec)&lt;/p&gt;</comment>
                            <comment id="17081694" author="sathyaprakashg" created="Sun, 12 Apr 2020 08:10:01 +0000"  >&lt;p&gt;In Spark 3.0, you can change the behaviour by using&#160; configuration &lt;b&gt;spark.sql.ansi.enabled&lt;/b&gt; (&#160;&lt;em&gt;When `spark.sql.ansi.enabled` is set to `true`, Spark SQL follows the standard in basic behaviours (e.g., arithmetic operations, type conversion, SQL functions and SQL parsing)&lt;/em&gt;)&lt;/p&gt;

&lt;p&gt;If&#160;spark.sql.ansi.enabled=false, which is default, then spark does not throw any arithmetic error like overflowException. For the given sql query, it basically executes below statement to cast the input value to int. Since returned value is negative, passing negative value to lpad/rpad gives empty string as output for the sql query mentioned in this issue&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; BigDecimal(&lt;span class=&quot;code-quote&quot;&gt;&quot;500000000000000000000000&quot;&lt;/span&gt;).longValue.toInt
res7: Int = -796917760&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;if you set&#160;spark.sql.ansi.enabled=true, then it throws below error.&#160;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.ArithmeticException: Casting 500000000000000000000000 to &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; causes overflow
  at org.apache.spark.sql.types.Decimal.overflowException(Decimal.scala:254)
  at org.apache.spark.sql.types.Decimal.roundToInt(Decimal.scala:317)
  at org.apache.spark.sql.types.DecimalExactNumeric$.toInt(numerics.scala:183)
  at org.apache.spark.sql.types.DecimalExactNumeric$.toInt(numerics.scala:182)
  at org.apache.spark.sql.catalyst.expressions.CastBase.$anonfun$castToInt$13(Cast.scala:518)
  at org.apache.spark.sql.catalyst.expressions.CastBase.$anonfun$castToInt$13$adapted(Cast.scala:518)
  at org.apache.spark.sql.catalyst.expressions.CastBase.nullSafeEval(Cast.scala:808)
  at org.apache.spark.sql.catalyst.expressions.UnaryExpression.eval(Expression.scala:461)
  at org.apache.spark.sql.catalyst.expressions.TernaryExpression.eval(Expression.scala:686)
  at org.apache.spark.sql.catalyst.expressions.UnaryExpression.eval(Expression.scala:457)
  at org.apache.spark.sql.catalyst.optimizer.ConstantFolding$$anonfun$apply$1$$anonfun$applyOrElse$1.applyOrElse(expressions.scala:52)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17113644" author="apachespark" created="Fri, 22 May 2020 00:09:53 +0000"  >&lt;p&gt;User &apos;maropu&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28604&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28604&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17114454" author="maropu" created="Fri, 22 May 2020 23:50:26 +0000"  >&lt;p&gt;Resolved by&#160;&lt;a href=&quot;https://github.com/apache/spark/pull/28604&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28604&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 25 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z08hq0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>