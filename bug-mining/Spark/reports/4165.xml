<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:48:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-17733] InferFiltersFromConstraints rule never terminates for query</title>
                <link>https://issues.apache.org/jira/browse/SPARK-17733</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The following (complicated) example becomes stuck in the &lt;tt&gt;InferFiltersFromConstraints&lt;/tt&gt; rule and never runs. However, it doesn&apos;t fail with a stack overflow and doesn&apos;t hit the limit on optimization passes, so I think there&apos;s some sort of non-obvious infinite loop within the rule itself.&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Table Creation&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; -- Query #0

CREATE TEMPORARY VIEW table_4(float_col_1, boolean_col_2, decimal2610_col_3, boolean_col_4, timestamp_col_5, boolean_col_6, bigint_col_7, timestamp_col_8) AS VALUES
  (CAST(21.920416 AS FLOAT), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, -182.0700000000BD, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;1996-10-24 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, CAST(-993 AS BIGINT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2007-01-13 00:00:00.0&apos;&lt;/span&gt;)),
  (CAST(722.4906 AS FLOAT), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, 497.5400000000BD, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2015-12-14 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, CAST(268 AS BIGINT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2021-04-19 00:00:00.0&apos;&lt;/span&gt;)),
  (CAST(534.9996 AS FLOAT), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, -470.8300000000BD, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;1996-01-31 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, CAST(-910 AS BIGINT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2019-10-16 00:00:00.0&apos;&lt;/span&gt;)),
  (CAST(-289.6454 AS FLOAT), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, 892.2500000000BD, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2014-03-14 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, CAST(-462 AS BIGINT), CAST(NULL AS TIMESTAMP)),
  (CAST(46.395535 AS FLOAT), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, -662.8900000000BD, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2000-10-16 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, CAST(-656 AS BIGINT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2024-09-01 00:00:00.0&apos;&lt;/span&gt;)),
  (CAST(-555.36285 AS FLOAT), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, -938.9300000000BD, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2007-04-10 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, CAST(252 AS BIGINT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2028-12-03 00:00:00.0&apos;&lt;/span&gt;)),
  (CAST(826.29004 AS FLOAT), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, 53.1800000000BD, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2004-06-11 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, CAST(437 AS BIGINT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;1994-04-04 00:00:00.0&apos;&lt;/span&gt;)),
  (CAST(-15.276999 AS FLOAT), CAST(NULL AS BOOLEAN), -889.3100000000BD, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;1991-05-23 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, CAST(226 AS BIGINT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2023-07-08 00:00:00.0&apos;&lt;/span&gt;)),
  (CAST(385.27386 AS FLOAT), CAST(NULL AS BOOLEAN), -9.9500000000BD, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2022-10-22 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, CAST(430 AS BIGINT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2013-09-29 00:00:00.0&apos;&lt;/span&gt;)),
  (CAST(988.7868 AS FLOAT), CAST(NULL AS BOOLEAN), 715.1700000000BD, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2026-10-03 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, CAST(-696 AS BIGINT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;1990-08-10 00:00:00.0&apos;&lt;/span&gt;))
     ;


 -- Query #1

CREATE TEMPORARY VIEW table_1(double_col_1, boolean_col_2, timestamp_col_3, smallint_col_4, boolean_col_5, int_col_6, timestamp_col_7, varchar0008_col_8, int_col_9, string_col_10) AS VALUES
  (CAST(-147.818640624 AS DOUBLE), CAST(NULL AS BOOLEAN), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2012-10-19 00:00:00.0&apos;&lt;/span&gt;), CAST(9 AS SMALLINT), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, 77, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2014-07-01 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;-945&apos;&lt;/span&gt;, -646, &lt;span class=&quot;code-quote&quot;&gt;&apos;722&apos;&lt;/span&gt;),
  (CAST(594.195125271 AS DOUBLE), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2016-12-04 00:00:00.0&apos;&lt;/span&gt;), CAST(NULL AS SMALLINT), CAST(NULL AS BOOLEAN), CAST(NULL AS INT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;1999-12-26 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;250&apos;&lt;/span&gt;, -861, &lt;span class=&quot;code-quote&quot;&gt;&apos;55&apos;&lt;/span&gt;),
  (CAST(-454.171126363 AS DOUBLE), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2008-12-13 00:00:00.0&apos;&lt;/span&gt;), CAST(NULL AS SMALLINT), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, -783, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2010-05-28 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;211&apos;&lt;/span&gt;, -959, CAST(NULL AS STRING)),
  (CAST(437.670945524 AS DOUBLE), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2011-10-16 00:00:00.0&apos;&lt;/span&gt;), CAST(952 AS SMALLINT), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, 297, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2013-01-13 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;262&apos;&lt;/span&gt;, CAST(NULL AS INT), &lt;span class=&quot;code-quote&quot;&gt;&apos;936&apos;&lt;/span&gt;),
  (CAST(-387.226759334 AS DOUBLE), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2019-10-03 00:00:00.0&apos;&lt;/span&gt;), CAST(-496 AS SMALLINT), CAST(NULL AS BOOLEAN), -925, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2028-06-27 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;-657&apos;&lt;/span&gt;, 948, &lt;span class=&quot;code-quote&quot;&gt;&apos;18&apos;&lt;/span&gt;),
  (CAST(-306.138230875 AS DOUBLE), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;1997-10-07 00:00:00.0&apos;&lt;/span&gt;), CAST(332 AS SMALLINT), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, 744, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;1990-09-22 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;-345&apos;&lt;/span&gt;, 566, &lt;span class=&quot;code-quote&quot;&gt;&apos;-574&apos;&lt;/span&gt;),
  (CAST(675.402140308 AS DOUBLE), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2017-06-26 00:00:00.0&apos;&lt;/span&gt;), CAST(972 AS SMALLINT), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, CAST(NULL AS INT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2026-06-10 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;518&apos;&lt;/span&gt;, 683, &lt;span class=&quot;code-quote&quot;&gt;&apos;-320&apos;&lt;/span&gt;),
  (CAST(734.839647174 AS DOUBLE), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;1995-06-01 00:00:00.0&apos;&lt;/span&gt;), CAST(-792 AS SMALLINT), CAST(NULL AS BOOLEAN), CAST(NULL AS INT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2021-07-11 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;-318&apos;&lt;/span&gt;, 564, &lt;span class=&quot;code-quote&quot;&gt;&apos;142&apos;&lt;/span&gt;),
  (CAST(-836.513475295 AS DOUBLE), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2027-01-02 00:00:00.0&apos;&lt;/span&gt;), CAST(-446 AS SMALLINT), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, CAST(NULL AS INT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;1993-09-01 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;771&apos;&lt;/span&gt;, CAST(NULL AS INT), &lt;span class=&quot;code-quote&quot;&gt;&apos;977&apos;&lt;/span&gt;),
  (CAST(-768.883638815 AS DOUBLE), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;1994-02-11 00:00:00.0&apos;&lt;/span&gt;), CAST(-244 AS SMALLINT), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, -493, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;1994-01-02 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;-921&apos;&lt;/span&gt;, CAST(NULL AS INT), &lt;span class=&quot;code-quote&quot;&gt;&apos;-409&apos;&lt;/span&gt;)
     ;


 -- Query #2

CREATE TEMPORARY VIEW table_5(float_col_1, varchar0138_col_2, string_col_3, decimal2211_col_4, float_col_5, string_col_6, timestamp_col_7, varchar0207_col_8) AS VALUES
  (CAST(-885.7606 AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;-740&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;680&apos;&lt;/span&gt;, -929.06000000000BD, CAST(NULL AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;-915&apos;&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;1994-09-12 00:00:00.0&apos;&lt;/span&gt;), CAST(NULL AS STRING)),
  (CAST(NULL AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;489&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;692&apos;&lt;/span&gt;, -220.60000000000BD, CAST(939.18964 AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;-514&apos;&lt;/span&gt;, CAST(NULL AS TIMESTAMP), &lt;span class=&quot;code-quote&quot;&gt;&apos;181&apos;&lt;/span&gt;),
  (CAST(210.7055 AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;44&apos;&lt;/span&gt;, CAST(NULL AS STRING), -174.70000000000BD, CAST(760.21045 AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;325&apos;&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2019-09-25 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;505&apos;&lt;/span&gt;),
  (CAST(952.8074 AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;838&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;705&apos;&lt;/span&gt;, CAST(NULL AS DECIMAL(22,11)), CAST(NULL AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;-62&apos;&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2029-05-22 00:00:00.0&apos;&lt;/span&gt;), CAST(NULL AS STRING)),
  (CAST(-113.300446 AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;-210&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;765&apos;&lt;/span&gt;, CAST(NULL AS DECIMAL(22,11)), CAST(-819.2468 AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;-829&apos;&lt;/span&gt;, CAST(NULL AS TIMESTAMP), &lt;span class=&quot;code-quote&quot;&gt;&apos;465&apos;&lt;/span&gt;),
  (CAST(-739.9902 AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;614&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;-393&apos;&lt;/span&gt;, -509.22000000000BD, CAST(-339.78568 AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;568&apos;&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2013-05-14 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;305&apos;&lt;/span&gt;),
  (CAST(976.0611 AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;670&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;71&apos;&lt;/span&gt;, 663.23000000000BD, CAST(-685.9362 AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;42&apos;&lt;/span&gt;, CAST(NULL AS TIMESTAMP), &lt;span class=&quot;code-quote&quot;&gt;&apos;150&apos;&lt;/span&gt;),
  (CAST(NULL AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;302&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;-404&apos;&lt;/span&gt;, -349.42000000000BD, CAST(2.113715 AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;-703&apos;&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2003-01-09 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;-863&apos;&lt;/span&gt;),
  (CAST(-40.604317 AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;856&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;632&apos;&lt;/span&gt;, 844.57000000000BD, CAST(-730.8376 AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;151&apos;&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2021-05-11 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;494&apos;&lt;/span&gt;),
  (CAST(884.62714 AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;-195&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;960&apos;&lt;/span&gt;, -664.40000000000BD, CAST(374.4844 AS FLOAT), &lt;span class=&quot;code-quote&quot;&gt;&apos;814&apos;&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2006-06-12 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;-900&apos;&lt;/span&gt;)
     ;


 -- Query #3

CREATE TEMPORARY VIEW table_2(bigint_col_1, boolean_col_2, double_col_3, double_col_4, double_col_5, varchar0164_col_6) AS VALUES
  (CAST(-374 AS BIGINT), CAST(NULL AS BOOLEAN), CAST(939.626553676 AS DOUBLE), CAST(-777.275379746 AS DOUBLE), CAST(235.613760023 AS DOUBLE), &lt;span class=&quot;code-quote&quot;&gt;&apos;86&apos;&lt;/span&gt;),
  (CAST(324 AS BIGINT), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, CAST(-507.23760783 AS DOUBLE), CAST(NULL AS DOUBLE), CAST(966.753434439 AS DOUBLE), &lt;span class=&quot;code-quote&quot;&gt;&apos;304&apos;&lt;/span&gt;),
  (CAST(882 AS BIGINT), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, CAST(-366.529706229 AS DOUBLE), CAST(787.000491043 AS DOUBLE), CAST(-331.333188698 AS DOUBLE), &lt;span class=&quot;code-quote&quot;&gt;&apos;158&apos;&lt;/span&gt;),
  (CAST(-510 AS BIGINT), CAST(NULL AS BOOLEAN), CAST(-855.344932257 AS DOUBLE), CAST(-858.167264921 AS DOUBLE), CAST(NULL AS DOUBLE), &lt;span class=&quot;code-quote&quot;&gt;&apos;-419&apos;&lt;/span&gt;),
  (CAST(-13 AS BIGINT), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, CAST(589.966987492 AS DOUBLE), CAST(NULL AS DOUBLE), CAST(-653.515783257 AS DOUBLE), &lt;span class=&quot;code-quote&quot;&gt;&apos;970&apos;&lt;/span&gt;),
  (CAST(-361 AS BIGINT), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, CAST(-413.021011259 AS DOUBLE), CAST(-716.638705947 AS DOUBLE), CAST(-936.480108205 AS DOUBLE), &lt;span class=&quot;code-quote&quot;&gt;&apos;807&apos;&lt;/span&gt;),
  (CAST(815 AS BIGINT), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, CAST(-643.690268711 AS DOUBLE), CAST(-684.206112496 AS DOUBLE), CAST(335.557479371 AS DOUBLE), &lt;span class=&quot;code-quote&quot;&gt;&apos;-872&apos;&lt;/span&gt;),
  (CAST(617 AS BIGINT), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, CAST(-93.3806447556 AS DOUBLE), CAST(-322.66171021 AS DOUBLE), CAST(-951.18299435 AS DOUBLE), &lt;span class=&quot;code-quote&quot;&gt;&apos;-167&apos;&lt;/span&gt;),
  (CAST(-876 AS BIGINT), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, CAST(-481.774062168 AS DOUBLE), CAST(-204.40537387 AS DOUBLE), CAST(224.889845986 AS DOUBLE), &lt;span class=&quot;code-quote&quot;&gt;&apos;-986&apos;&lt;/span&gt;),
  (CAST(2 AS BIGINT), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, CAST(462.843898322 AS DOUBLE), CAST(-9.85549856798 AS DOUBLE), CAST(-549.875829922 AS DOUBLE), &lt;span class=&quot;code-quote&quot;&gt;&apos;121&apos;&lt;/span&gt;)
     ;


 -- Query #4

CREATE TEMPORARY VIEW table_3(string_col_1, float_col_2, timestamp_col_3, boolean_col_4, timestamp_col_5, decimal3317_col_6) AS VALUES
  (&lt;span class=&quot;code-quote&quot;&gt;&apos;-450&apos;&lt;/span&gt;, CAST(-903.6053 AS FLOAT), CAST(NULL AS TIMESTAMP), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2020-08-22 00:00:00.0&apos;&lt;/span&gt;), -376.39000000000000000BD),
  (&lt;span class=&quot;code-quote&quot;&gt;&apos;698&apos;&lt;/span&gt;, CAST(402.56534 AS FLOAT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2013-10-13 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2012-11-06 00:00:00.0&apos;&lt;/span&gt;), -498.81000000000000000BD),
  (&lt;span class=&quot;code-quote&quot;&gt;&apos;139&apos;&lt;/span&gt;, CAST(-895.7336 AS FLOAT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2018-09-08 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2019-03-13 00:00:00.0&apos;&lt;/span&gt;), CAST(NULL AS DECIMAL(33,17))),
  (&lt;span class=&quot;code-quote&quot;&gt;&apos;616&apos;&lt;/span&gt;, CAST(-464.9475 AS FLOAT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2028-05-18 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2016-05-22 00:00:00.0&apos;&lt;/span&gt;), -109.88000000000000000BD),
  (&lt;span class=&quot;code-quote&quot;&gt;&apos;943&apos;&lt;/span&gt;, CAST(605.42303 AS FLOAT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;1996-08-04 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2028-05-18 00:00:00.0&apos;&lt;/span&gt;), 201.36000000000000000BD),
  (&lt;span class=&quot;code-quote&quot;&gt;&apos;-764&apos;&lt;/span&gt;, CAST(-503.56726 AS FLOAT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;1990-02-28 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, CAST(NULL AS TIMESTAMP), 211.25000000000000000BD),
  (&lt;span class=&quot;code-quote&quot;&gt;&apos;-587&apos;&lt;/span&gt;, CAST(84.67886 AS FLOAT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2013-06-06 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2022-05-07 00:00:00.0&apos;&lt;/span&gt;), 90.75000000000000000BD),
  (&lt;span class=&quot;code-quote&quot;&gt;&apos;712&apos;&lt;/span&gt;, CAST(141.08926 AS FLOAT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2001-05-12 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2019-11-22 00:00:00.0&apos;&lt;/span&gt;), 929.89000000000000000BD),
  (&lt;span class=&quot;code-quote&quot;&gt;&apos;948&apos;&lt;/span&gt;, CAST(0.74294764 AS FLOAT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2002-06-14 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;1990-01-13 00:00:00.0&apos;&lt;/span&gt;), -100.90000000000000000BD),
  (&lt;span class=&quot;code-quote&quot;&gt;&apos;-201&apos;&lt;/span&gt;, CAST(366.82578 AS FLOAT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2015-11-28 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, CAST(NULL AS TIMESTAMP), 196.33000000000000000BD)
     ;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Query&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SELECT
t1.int_col_2,
(t1.bigint_col_7) / (t2.double_col_3) AS float_col,
TRIM(t2.varchar0164_col_6) AS char_col
FROM (
SELECT
COALESCE(t1.bigint_col_7, t2.bigint_col_7, t2.bigint_col_7) AS int_col,
t1.bigint_col_7,
t2.bigint_col_7 AS int_col_1,
t1.bigint_col_7 AS int_col_2,
COALESCE(t2.bigint_col_7, (COALESCE(t1.bigint_col_7, t2.bigint_col_7, t2.bigint_col_7)) - (t1.bigint_col_7), MIN(t2.bigint_col_7)) AS int_col_3
FROM table_4 t1
INNER JOIN table_4 t2 ON ((t2.timestamp_col_5) = (t1.timestamp_col_8)) AND ((t2.decimal2610_col_3) = (t1.decimal2610_col_3))
WHERE
(t1.bigint_col_7) IN (t2.bigint_col_7, t2.bigint_col_7)
GROUP BY
COALESCE(t1.bigint_col_7, t2.bigint_col_7, t2.bigint_col_7),
t1.bigint_col_7,
t2.bigint_col_7,
t1.bigint_col_7
HAVING
(MIN(COALESCE(t1.bigint_col_7, t2.bigint_col_7, t2.bigint_col_7))) NOT IN (423.13, t2.bigint_col_7)
UNION
SELECT
MIN((436) * (927)) OVER (ORDER BY (t2.int_col_6) * (NULL) DESC, (t1.smallint_col_4) - (t2.int_col_6) DESC ROWS BETWEEN 96 PRECEDING AND 16 PRECEDING) AS int_col,
(t2.int_col_6) * (NULL) AS decimal_col,
(t1.smallint_col_4) - (t2.int_col_6) AS int_col_1,
LAG((449) * (-157.519107824), 46) OVER (ORDER BY (t2.int_col_6) * (NULL) DESC, (t1.smallint_col_4) - (t2.int_col_6) DESC) AS float_col,
AVG((669) - (-773)) OVER (ORDER BY (t2.int_col_6) * (NULL) ASC, (t1.smallint_col_4) - (t2.int_col_6) ASC ROWS BETWEEN CURRENT ROW AND 62 FOLLOWING) AS float_col_1
FROM table_1 t1
INNER JOIN table_1 t2 ON ((t2.smallint_col_4) = (t1.int_col_9)) AND ((t2.smallint_col_4) = (t1.int_col_6))
) t1
INNER JOIN table_2 t2 ON (((t2.bigint_col_1) = (t1.bigint_col_7)) AND ((t2.bigint_col_1) = (t1.int_col))) AND ((t2.bigint_col_1) = (t1.int_col_1))
GROUP BY
t1.int_col_2,
(t1.bigint_col_7) / (t2.double_col_3),
TRIM(t2.varchar0164_col_6)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I attached YourKit to my Spark process and recorded some stack traces. See the attached screenshots showing the distribution of time for the hung query.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13008709">SPARK-17733</key>
            <summary>InferFiltersFromConstraints rule never terminates for query</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jiangxb1987">Xingbo Jiang</assignee>
                                    <reporter username="joshrosen">Josh Rosen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Sep 2016 20:20:53 +0000</created>
                <updated>Wed, 10 May 2017 21:31:28 +0000</updated>
                            <resolved>Wed, 26 Oct 2016 15:11:26 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.2</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15533968" author="joshrosen" created="Thu, 29 Sep 2016 20:32:23 +0000"  >&lt;p&gt;I think the problem is that &lt;tt&gt;InferFiltersFromConstraints&lt;/tt&gt; appears to be constructing bigger-and-bigger constraints, causing it to become slower and slower. If I let this run long enough I imagine that it would OOM.&lt;/p&gt;

&lt;p&gt;Here&apos;s trace logging showing the plans after the first two applications of InferFiltersFromConstraints&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;16/09/29 13:26:17 TRACE SparkOptimizer:
=== Applying Rule org.apache.spark.sql.catalyst.optimizer.InferFiltersFromConstraints ===
 Aggregate [count(1) AS count#179L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Aggregate [count(1) AS count#179L]
 +- Project                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            +- Project
    +- Aggregate [int_col_2#165, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#14L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) / &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(double_col_3#63 as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)), trim(varchar0164_col_6#66)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        +- Aggregate [int_col_2#165, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#14L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) / &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(double_col_3#63 as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)), trim(varchar0164_col_6#66)]
       +- Project [bigint_col_7#14L, int_col_2#165, double_col_3#63, varchar0164_col_6#66]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   +- Project [bigint_col_7#14L, int_col_2#165, double_col_3#63, varchar0164_col_6#66]
!         +- Join Inner, (((bigint_col_1#61L = bigint_col_7#14L) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col_1#82L))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    +- Join Inner, (((((((int_col#81L = int_col_1#82L) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col_1#82L)) &amp;amp;&amp;amp; isnotnull(bigint_col_7#14L)) &amp;amp;&amp;amp; isnotnull(int_col#81L)) &amp;amp;&amp;amp; isnotnull(int_col_1#82L)) &amp;amp;&amp;amp; (((bigint_col_1#61L = bigint_col_7#14L) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col_1#82L)))
             :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]
             :  +- Aggregate [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165, int_col_3#166], [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           :  +- Aggregate [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165, int_col_3#166], [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]
             :     +- Union                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        :     +- Union
             :        :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_2#83L as decimal(29,9)) AS int_col_2#165, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_3#84L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) AS int_col_3#166]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             :        :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_2#83L as decimal(29,9)) AS int_col_2#165, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_3#84L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) AS int_col_3#166]
             :        :  +- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#83L, int_col_3#84L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   :        :  +- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#83L, int_col_3#84L]
             :        :     +- Filter NOT &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L as decimal(22,2)) IN (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(423.13 as decimal(22,2)),&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#140L as decimal(22,2)))                                                                                                                                                                                                                                                                                                                                                                                                                                                            :        :     +- Filter NOT &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L as decimal(22,2)) IN (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(423.13 as decimal(22,2)),&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#140L as decimal(22,2)))
             :        :        +- Aggregate [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L), bigint_col_7#14L, bigint_col_7#140L], [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) AS int_col#81L, bigint_col_7#14L, bigint_col_7#140L AS int_col_1#82L, bigint_col_7#14L AS int_col_2#83L, coalesce(bigint_col_7#140L, (coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) - bigint_col_7#14L), min(bigint_col_7#140L)) AS int_col_3#84L, min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L)) AS min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L, bigint_col_7#140L]               :        :        +- Aggregate [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L), bigint_col_7#14L, bigint_col_7#140L], [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) AS int_col#81L, bigint_col_7#14L, bigint_col_7#140L AS int_col_1#82L, bigint_col_7#14L AS int_col_2#83L, coalesce(bigint_col_7#140L, (coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) - bigint_col_7#14L), min(bigint_col_7#140L)) AS int_col_3#84L, min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L)) AS min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L, bigint_col_7#140L]
             :        :           +- Project [bigint_col_7#14L, bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 :        :           +- Project [bigint_col_7#14L, bigint_col_7#140L]
!            :        :              +- Join Inner, (bigint_col_7#14L IN (bigint_col_7#140L,bigint_col_7#140L) &amp;amp;&amp;amp; ((timestamp_col_5#138 = timestamp_col_8#15) &amp;amp;&amp;amp; (decimal2610_col_3#136 = decimal2610_col_3#10)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                  :        :              +- Join Inner, ((isnotnull(timestamp_col_8#15) &amp;amp;&amp;amp; isnotnull(timestamp_col_5#138)) &amp;amp;&amp;amp; (bigint_col_7#14L IN (bigint_col_7#140L,bigint_col_7#140L) &amp;amp;&amp;amp; ((timestamp_col_5#138 = timestamp_col_8#15) &amp;amp;&amp;amp; (decimal2610_col_3#136 = decimal2610_col_3#10))))
             :        :                 :- Project [decimal2610_col_3#10, bigint_col_7#14L, timestamp_col_8#15]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    :        :                 :- Project [decimal2610_col_3#10, bigint_col_7#14L, timestamp_col_8#15]
             :        :                 :  +- Project [col3#2 AS decimal2610_col_3#10, col7#6L AS bigint_col_7#14L, col8#7 AS timestamp_col_8#15]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  :        :                 :  +- Project [col3#2 AS decimal2610_col_3#10, col7#6L AS bigint_col_7#14L, col8#7 AS timestamp_col_8#15]
             :        :                 :     +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   :        :                 :     +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]
             :        :                 +- Project [decimal2610_col_3#136, timestamp_col_5#138, bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 :        :                 +- Project [decimal2610_col_3#136, timestamp_col_5#138, bigint_col_7#140L]
             :        :                    +- Project [col3#2 AS decimal2610_col_3#136, col5#4 AS timestamp_col_5#138, col7#6L AS bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               :        :                    +- Project [col3#2 AS decimal2610_col_3#136, col5#4 AS timestamp_col_5#138, col7#6L AS bigint_col_7#140L]
             :        :                       +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   :        :                       +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]
             :        +- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) AS int_col#167L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) AS decimal_col#168L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) AS int_col_1#169L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(float_col#88 as decimal(29,9)) AS float_col#170, float_col_1#89]                                                                                                                                                                                                                                                                                                                                                                                                                            :        +- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) AS int_col#167L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) AS decimal_col#168L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) AS int_col_1#169L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(float_col#88 as decimal(29,9)) AS float_col#170, float_col_1#89]
             :           +- Project [int_col#85, decimal_col#86, int_col_1#87, float_col#88, float_col_1#89]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       :           +- Project [int_col#85, decimal_col#86, int_col_1#87, float_col#88, float_col_1#89]
             :              +- Project [decimal_col#86, int_col_1#87, float_col_1#89, int_col#85, float_col#88, int_col#85, float_col#88, float_col_1#89]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          :              +- Project [decimal_col#86, int_col_1#87, float_col_1#89, int_col#85, float_col#88, int_col#85, float_col#88, float_col_1#89]
             :                 +- Project [decimal_col#86, int_col_1#87, _w0#158, _w1#159, _w2#160, _w3#161, _w4#162, _w5#163, float_col_1#89, int_col#85, float_col#88, int_col#85, float_col#88, float_col_1#89]                                                                                                                                                                                                                                                                                                                                                                                                                                                                 :                 +- Project [decimal_col#86, int_col_1#87, _w0#158, _w1#159, _w2#160, _w3#161, _w4#162, _w5#163, float_col_1#89, int_col#85, float_col#88, int_col#85, float_col#88, float_col_1#89]
             :                    +- Window [lag(CheckOverflow((promote_precision(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(449 as decimal(10,0)) as decimal(19,9))) * promote_precision(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(-157.519107824 as decimal(19,9)))), DecimalType(23,9)), 46, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) windowspecdefinition(_w2#160 DESC, _w3#161 DESC, ROWS BETWEEN 46 PRECEDING AND 46 PRECEDING) AS float_col#88], [_w2#160 DESC, _w3#161 DESC]                                                                                                                                                                                                                                                                                                        :                    +- Window [lag(CheckOverflow((promote_precision(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(449 as decimal(10,0)) as decimal(19,9))) * promote_precision(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(-157.519107824 as decimal(19,9)))), DecimalType(23,9)), 46, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) windowspecdefinition(_w2#160 DESC, _w3#161 DESC, ROWS BETWEEN 46 PRECEDING AND 46 PRECEDING) AS float_col#88], [_w2#160 DESC, _w3#161 DESC]
             :                       +- Window [min((436 * 927)) windowspecdefinition(_w0#158 DESC, _w1#159 DESC, ROWS BETWEEN 96 PRECEDING AND 16 PRECEDING) AS int_col#85], [_w0#158 DESC, _w1#159 DESC]                                                                                                                                                                                                                                                                                                                                                                                                                                                                         :                       +- Window [min((436 * 927)) windowspecdefinition(_w0#158 DESC, _w1#159 DESC, ROWS BETWEEN 96 PRECEDING AND 16 PRECEDING) AS int_col#85], [_w0#158 DESC, _w1#159 DESC]
             :                          +- Window [avg(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;((669 - -773) as bigint)) windowspecdefinition(_w4#162 ASC, _w5#163 ASC, ROWS BETWEEN CURRENT ROW AND 62 FOLLOWING) AS float_col_1#89], [_w4#162 ASC, _w5#163 ASC]                                                                                                                                                                                                                                                                                                                                                                                                                                                      :                          +- Window [avg(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;((669 - -773) as bigint)) windowspecdefinition(_w4#162 ASC, _w5#163 ASC, ROWS BETWEEN CURRENT ROW AND 62 FOLLOWING) AS float_col_1#89], [_w4#162 ASC, _w5#163 ASC]
             :                             +- Project [(int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS decimal_col#86, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS int_col_1#87, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS _w0#158, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w1#159, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS _w2#160, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w3#161, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS _w4#162, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w5#163]                                                                                                                                                             :                             +- Project [(int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS decimal_col#86, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS int_col_1#87, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS _w0#158, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w1#159, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS _w2#160, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w3#161, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS _w4#162, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w5#163]
!            :                                +- Join Inner, ((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_9#35) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_6#32))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :                                +- Join Inner, (((isnotnull(smallint_col_4#145) &amp;amp;&amp;amp; isnotnull(int_col_6#32)) &amp;amp;&amp;amp; isnotnull(int_col_9#35)) &amp;amp;&amp;amp; ((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_9#35) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_6#32)))
             :                                   :- Project [smallint_col_4#30, int_col_6#32, int_col_9#35]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        :                                   :- Project [smallint_col_4#30, int_col_6#32, int_col_9#35]
             :                                   :  +- Project [col4#20 AS smallint_col_4#30, col6#22 AS int_col_6#32, col9#25 AS int_col_9#35]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    :                                   :  +- Project [col4#20 AS smallint_col_4#30, col6#22 AS int_col_6#32, col9#25 AS int_col_9#35]
             :                                   :     +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :                                   :     +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
             :                                   +- Project [smallint_col_4#145, int_col_6#147]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    :                                   +- Project [smallint_col_4#145, int_col_6#147]
             :                                      +- Project [col4#20 AS smallint_col_4#145, col6#22 AS int_col_6#147]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           :                                      +- Project [col4#20 AS smallint_col_4#145, col6#22 AS int_col_6#147]
             :                                         +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :                                         +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
             +- Project [bigint_col_1#61L, double_col_3#63, varchar0164_col_6#66]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  +- Project [bigint_col_1#61L, double_col_3#63, varchar0164_col_6#66]
                +- Project [col1#55L AS bigint_col_1#61L, col3#57 AS double_col_3#63, col6#60 AS varchar0164_col_6#66]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                +- Project [col1#55L AS bigint_col_1#61L, col3#57 AS double_col_3#63, col6#60 AS varchar0164_col_6#66]
                   +- LocalRelation [col1#55L, col2#56, col3#57, col4#58, col5#59, col6#60]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +- LocalRelation [col1#55L, col2#56, col3#57, col4#58, col5#59, col6#60]

16/09/29 13:26:17 TRACE SparkOptimizer:
=== Applying Rule org.apache.spark.sql.catalyst.optimizer.CollapseProject ===
 Aggregate [count(1) AS count#179L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Aggregate [count(1) AS count#179L]
!+- Project                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            +- Aggregate [int_col_2#165, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#14L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) / &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(double_col_3#63 as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)), trim(varchar0164_col_6#66)]
!   +- Aggregate [int_col_2#165, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#14L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) / &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(double_col_3#63 as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)), trim(varchar0164_col_6#66)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        +- Project [bigint_col_7#14L, int_col_2#165, double_col_3#63, varchar0164_col_6#66]
!      +- Project [bigint_col_7#14L, int_col_2#165, double_col_3#63, varchar0164_col_6#66]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   +- Join Inner, (((((((int_col#81L = int_col_1#82L) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col_1#82L)) &amp;amp;&amp;amp; isnotnull(bigint_col_7#14L)) &amp;amp;&amp;amp; isnotnull(int_col#81L)) &amp;amp;&amp;amp; isnotnull(int_col_1#82L)) &amp;amp;&amp;amp; (((bigint_col_1#61L = bigint_col_7#14L) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col_1#82L)))
!         +- Join Inner, (((((((int_col#81L = int_col_1#82L) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col_1#82L)) &amp;amp;&amp;amp; isnotnull(bigint_col_7#14L)) &amp;amp;&amp;amp; isnotnull(int_col#81L)) &amp;amp;&amp;amp; isnotnull(int_col_1#82L)) &amp;amp;&amp;amp; (((bigint_col_1#61L = bigint_col_7#14L) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col_1#82L)))                                                                                                                                                                                                                                                                                                                        :- Aggregate [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165, int_col_3#166], [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]
!            :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           :  +- Union
!            :  +- Aggregate [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165, int_col_3#166], [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        :     :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_2#83L as decimal(29,9)) AS int_col_2#165, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_3#84L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) AS int_col_3#166]
!            :     +- Union                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     :     :  +- Filter NOT &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L as decimal(22,2)) IN (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(423.13 as decimal(22,2)),&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#140L as decimal(22,2)))
!            :        :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_2#83L as decimal(29,9)) AS int_col_2#165, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_3#84L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) AS int_col_3#166]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          :     :     +- Aggregate [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L), bigint_col_7#14L, bigint_col_7#140L], [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) AS int_col#81L, bigint_col_7#14L, bigint_col_7#140L AS int_col_1#82L, bigint_col_7#14L AS int_col_2#83L, coalesce(bigint_col_7#140L, (coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) - bigint_col_7#14L), min(bigint_col_7#140L)) AS int_col_3#84L, min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L)) AS min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L, bigint_col_7#140L]
!            :        :  +- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#83L, int_col_3#84L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :     :        +- Project [bigint_col_7#14L, bigint_col_7#140L]
!            :        :     +- Filter NOT &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L as decimal(22,2)) IN (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(423.13 as decimal(22,2)),&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#140L as decimal(22,2)))                                                                                                                                                                                                                                                                                                                                                                                                                                                         :     :           +- Join Inner, ((isnotnull(timestamp_col_8#15) &amp;amp;&amp;amp; isnotnull(timestamp_col_5#138)) &amp;amp;&amp;amp; (bigint_col_7#14L IN (bigint_col_7#140L,bigint_col_7#140L) &amp;amp;&amp;amp; ((timestamp_col_5#138 = timestamp_col_8#15) &amp;amp;&amp;amp; (decimal2610_col_3#136 = decimal2610_col_3#10))))
!            :        :        +- Aggregate [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L), bigint_col_7#14L, bigint_col_7#140L], [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) AS int_col#81L, bigint_col_7#14L, bigint_col_7#140L AS int_col_1#82L, bigint_col_7#14L AS int_col_2#83L, coalesce(bigint_col_7#140L, (coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) - bigint_col_7#14L), min(bigint_col_7#140L)) AS int_col_3#84L, min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L)) AS min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L, bigint_col_7#140L]            :     :              :- Project [col3#2 AS decimal2610_col_3#10, col7#6L AS bigint_col_7#14L, col8#7 AS timestamp_col_8#15]
!            :        :           +- Project [bigint_col_7#14L, bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              :     :              :  +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]
!            :        :              +- Join Inner, ((isnotnull(timestamp_col_8#15) &amp;amp;&amp;amp; isnotnull(timestamp_col_5#138)) &amp;amp;&amp;amp; (bigint_col_7#14L IN (bigint_col_7#140L,bigint_col_7#140L) &amp;amp;&amp;amp; ((timestamp_col_5#138 = timestamp_col_8#15) &amp;amp;&amp;amp; (decimal2610_col_3#136 = decimal2610_col_3#10))))                                                                                                                                                                                                                                                                                                                                                                                        :     :              +- Project [col3#2 AS decimal2610_col_3#136, col5#4 AS timestamp_col_5#138, col7#6L AS bigint_col_7#140L]
!            :        :                 :- Project [decimal2610_col_3#10, bigint_col_7#14L, timestamp_col_8#15]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 :     :                 +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]
!            :        :                 :  +- Project [col3#2 AS decimal2610_col_3#10, col7#6L AS bigint_col_7#14L, col8#7 AS timestamp_col_8#15]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               :     +- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) AS int_col#167L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) AS decimal_col#168L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) AS int_col_1#169L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(float_col#88 as decimal(29,9)) AS float_col#170, float_col_1#89]
!            :        :                 :     +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :        +- Window [lag(CheckOverflow((promote_precision(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(449 as decimal(10,0)) as decimal(19,9))) * promote_precision(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(-157.519107824 as decimal(19,9)))), DecimalType(23,9)), 46, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) windowspecdefinition(_w2#160 DESC, _w3#161 DESC, ROWS BETWEEN 46 PRECEDING AND 46 PRECEDING) AS float_col#88], [_w2#160 DESC, _w3#161 DESC]
!            :        :                 +- Project [decimal2610_col_3#136, timestamp_col_5#138, bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              :           +- Window [min((436 * 927)) windowspecdefinition(_w0#158 DESC, _w1#159 DESC, ROWS BETWEEN 96 PRECEDING AND 16 PRECEDING) AS int_col#85], [_w0#158 DESC, _w1#159 DESC]
!            :        :                    +- Project [col3#2 AS decimal2610_col_3#136, col5#4 AS timestamp_col_5#138, col7#6L AS bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            :              +- Window [avg(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;((669 - -773) as bigint)) windowspecdefinition(_w4#162 ASC, _w5#163 ASC, ROWS BETWEEN CURRENT ROW AND 62 FOLLOWING) AS float_col_1#89], [_w4#162 ASC, _w5#163 ASC]
!            :        :                       +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :                 +- Project [(int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS decimal_col#86, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS int_col_1#87, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS _w0#158, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w1#159, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS _w2#160, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w3#161, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS _w4#162, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w5#163]
!            :        +- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) AS int_col#167L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) AS decimal_col#168L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) AS int_col_1#169L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(float_col#88 as decimal(29,9)) AS float_col#170, float_col_1#89]                                                                                                                                                                                                                                                                                                                                                                                                                         :                    +- Join Inner, (((isnotnull(smallint_col_4#145) &amp;amp;&amp;amp; isnotnull(int_col_6#32)) &amp;amp;&amp;amp; isnotnull(int_col_9#35)) &amp;amp;&amp;amp; ((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_9#35) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_6#32)))
!            :           +- Project [int_col#85, decimal_col#86, int_col_1#87, float_col#88, float_col_1#89]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    :                       :- Project [col4#20 AS smallint_col_4#30, col6#22 AS int_col_6#32, col9#25 AS int_col_9#35]
!            :              +- Project [decimal_col#86, int_col_1#87, float_col_1#89, int_col#85, float_col#88, int_col#85, float_col#88, float_col_1#89]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       :                       :  +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
!            :                 +- Project [decimal_col#86, int_col_1#87, _w0#158, _w1#159, _w2#160, _w3#161, _w4#162, _w5#163, float_col_1#89, int_col#85, float_col#88, int_col#85, float_col#88, float_col_1#89]                                                                                                                                                                                                                                                                                                                                                                                                                                                              :                       +- Project [col4#20 AS smallint_col_4#145, col6#22 AS int_col_6#147]
!            :                    +- Window [lag(CheckOverflow((promote_precision(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(449 as decimal(10,0)) as decimal(19,9))) * promote_precision(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(-157.519107824 as decimal(19,9)))), DecimalType(23,9)), 46, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) windowspecdefinition(_w2#160 DESC, _w3#161 DESC, ROWS BETWEEN 46 PRECEDING AND 46 PRECEDING) AS float_col#88], [_w2#160 DESC, _w3#161 DESC]                                                                                                                                                                                                                                                                                                     :                          +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
!            :                       +- Window [min((436 * 927)) windowspecdefinition(_w0#158 DESC, _w1#159 DESC, ROWS BETWEEN 96 PRECEDING AND 16 PRECEDING) AS int_col#85], [_w0#158 DESC, _w1#159 DESC]                                                                                                                                                                                                                                                                                                                                                                                                                                                                      +- Project [col1#55L AS bigint_col_1#61L, col3#57 AS double_col_3#63, col6#60 AS varchar0164_col_6#66]
!            :                          +- Window [avg(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;((669 - -773) as bigint)) windowspecdefinition(_w4#162 ASC, _w5#163 ASC, ROWS BETWEEN CURRENT ROW AND 62 FOLLOWING) AS float_col_1#89], [_w4#162 ASC, _w5#163 ASC]                                                                                                                                                                                                                                                                                                                                                                                                                                                      +- LocalRelation [col1#55L, col2#56, col3#57, col4#58, col5#59, col6#60]
!            :                             +- Project [(int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS decimal_col#86, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS int_col_1#87, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS _w0#158, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w1#159, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS _w2#160, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w3#161, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS _w4#162, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w5#163]
!            :                                +- Join Inner, (((isnotnull(smallint_col_4#145) &amp;amp;&amp;amp; isnotnull(int_col_6#32)) &amp;amp;&amp;amp; isnotnull(int_col_9#35)) &amp;amp;&amp;amp; ((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_9#35) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_6#32)))
!            :                                   :- Project [smallint_col_4#30, int_col_6#32, int_col_9#35]
!            :                                   :  +- Project [col4#20 AS smallint_col_4#30, col6#22 AS int_col_6#32, col9#25 AS int_col_9#35]
!            :                                   :     +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
!            :                                   +- Project [smallint_col_4#145, int_col_6#147]
!            :                                      +- Project [col4#20 AS smallint_col_4#145, col6#22 AS int_col_6#147]
!            :                                         +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
!            +- Project [bigint_col_1#61L, double_col_3#63, varchar0164_col_6#66]
!               +- Project [col1#55L AS bigint_col_1#61L, col3#57 AS double_col_3#63, col6#60 AS varchar0164_col_6#66]
!                  +- LocalRelation [col1#55L, col2#56, col3#57, col4#58, col5#59, col6#60]

16/09/29 13:26:17 TRACE SparkOptimizer:
=== Applying Rule org.apache.spark.sql.catalyst.optimizer.ConstantFolding ===
 Aggregate [count(1) AS count#179L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           Aggregate [count(1) AS count#179L]
 +- Aggregate [int_col_2#165, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#14L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) / &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(double_col_3#63 as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)), trim(varchar0164_col_6#66)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               +- Aggregate [int_col_2#165, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#14L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) / &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(double_col_3#63 as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)), trim(varchar0164_col_6#66)]
    +- Project [bigint_col_7#14L, int_col_2#165, double_col_3#63, varchar0164_col_6#66]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          +- Project [bigint_col_7#14L, int_col_2#165, double_col_3#63, varchar0164_col_6#66]
       +- Join Inner, (((((((int_col#81L = int_col_1#82L) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col_1#82L)) &amp;amp;&amp;amp; isnotnull(bigint_col_7#14L)) &amp;amp;&amp;amp; isnotnull(int_col#81L)) &amp;amp;&amp;amp; isnotnull(int_col_1#82L)) &amp;amp;&amp;amp; (((bigint_col_1#61L = bigint_col_7#14L) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col_1#82L)))                                                                                                                                                                                                                                                                                                               +- Join Inner, (((((((int_col#81L = int_col_1#82L) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col_1#82L)) &amp;amp;&amp;amp; isnotnull(bigint_col_7#14L)) &amp;amp;&amp;amp; isnotnull(int_col#81L)) &amp;amp;&amp;amp; isnotnull(int_col_1#82L)) &amp;amp;&amp;amp; (((bigint_col_1#61L = bigint_col_7#14L) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col_1#82L)))
          :- Aggregate [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165, int_col_3#166], [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     :- Aggregate [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165, int_col_3#166], [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]
          :  +- Union                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  :  +- Union
          :     :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_2#83L as decimal(29,9)) AS int_col_2#165, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_3#84L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) AS int_col_3#166]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       :     :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_2#83L as decimal(29,9)) AS int_col_2#165, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_3#84L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) AS int_col_3#166]
!         :     :  +- Filter NOT &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L as decimal(22,2)) IN (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(423.13 as decimal(22,2)),&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#140L as decimal(22,2)))                                                                                                                                                                                                                                                                                                                                                                                                                                                         :     :  +- Filter NOT &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L as decimal(22,2)) IN (423.13,&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#140L as decimal(22,2)))
          :     :     +- Aggregate [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L), bigint_col_7#14L, bigint_col_7#140L], [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) AS int_col#81L, bigint_col_7#14L, bigint_col_7#140L AS int_col_1#82L, bigint_col_7#14L AS int_col_2#83L, coalesce(bigint_col_7#140L, (coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) - bigint_col_7#14L), min(bigint_col_7#140L)) AS int_col_3#84L, min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L)) AS min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L, bigint_col_7#140L]            :     :     +- Aggregate [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L), bigint_col_7#14L, bigint_col_7#140L], [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) AS int_col#81L, bigint_col_7#14L, bigint_col_7#140L AS int_col_1#82L, bigint_col_7#14L AS int_col_2#83L, coalesce(bigint_col_7#140L, (coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) - bigint_col_7#14L), min(bigint_col_7#140L)) AS int_col_3#84L, min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L)) AS min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L, bigint_col_7#140L]
          :     :        +- Project [bigint_col_7#14L, bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              :     :        +- Project [bigint_col_7#14L, bigint_col_7#140L]
          :     :           +- Join Inner, ((isnotnull(timestamp_col_8#15) &amp;amp;&amp;amp; isnotnull(timestamp_col_5#138)) &amp;amp;&amp;amp; (bigint_col_7#14L IN (bigint_col_7#140L,bigint_col_7#140L) &amp;amp;&amp;amp; ((timestamp_col_5#138 = timestamp_col_8#15) &amp;amp;&amp;amp; (decimal2610_col_3#136 = decimal2610_col_3#10))))                                                                                                                                                                                                                                                                                                                                                                                        :     :           +- Join Inner, ((isnotnull(timestamp_col_8#15) &amp;amp;&amp;amp; isnotnull(timestamp_col_5#138)) &amp;amp;&amp;amp; (bigint_col_7#14L IN (bigint_col_7#140L,bigint_col_7#140L) &amp;amp;&amp;amp; ((timestamp_col_5#138 = timestamp_col_8#15) &amp;amp;&amp;amp; (decimal2610_col_3#136 = decimal2610_col_3#10))))
          :     :              :- Project [col3#2 AS decimal2610_col_3#10, col7#6L AS bigint_col_7#14L, col8#7 AS timestamp_col_8#15]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  :     :              :- Project [col3#2 AS decimal2610_col_3#10, col7#6L AS bigint_col_7#14L, col8#7 AS timestamp_col_8#15]
          :     :              :  +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   :     :              :  +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]
          :     :              +- Project [col3#2 AS decimal2610_col_3#136, col5#4 AS timestamp_col_5#138, col7#6L AS bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               :     :              +- Project [col3#2 AS decimal2610_col_3#136, col5#4 AS timestamp_col_5#138, col7#6L AS bigint_col_7#140L]
          :     :                 +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   :     :                 +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]
          :     +- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) AS int_col#167L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) AS decimal_col#168L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) AS int_col_1#169L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(float_col#88 as decimal(29,9)) AS float_col#170, float_col_1#89]                                                                                                                                                                                                                                                                                                                                                                                                                      :     +- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) AS int_col#167L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) AS decimal_col#168L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) AS int_col_1#169L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(float_col#88 as decimal(29,9)) AS float_col#170, float_col_1#89]
!         :        +- Window [lag(CheckOverflow((promote_precision(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(449 as decimal(10,0)) as decimal(19,9))) * promote_precision(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(-157.519107824 as decimal(19,9)))), DecimalType(23,9)), 46, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) windowspecdefinition(_w2#160 DESC, _w3#161 DESC, ROWS BETWEEN 46 PRECEDING AND 46 PRECEDING) AS float_col#88], [_w2#160 DESC, _w3#161 DESC]                                                                                                                                                                                                                                                                                                           :        +- Window [lag(-70726.079412976, 46, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) windowspecdefinition(_w2#160 DESC, _w3#161 DESC, ROWS BETWEEN 46 PRECEDING AND 46 PRECEDING) AS float_col#88], [_w2#160 DESC, _w3#161 DESC]
!         :           +- Window [min((436 * 927)) windowspecdefinition(_w0#158 DESC, _w1#159 DESC, ROWS BETWEEN 96 PRECEDING AND 16 PRECEDING) AS int_col#85], [_w0#158 DESC, _w1#159 DESC]                                                                                                                                                                                                                                                                                                                                                                                                                                                                            :           +- Window [min(404172) windowspecdefinition(_w0#158 DESC, _w1#159 DESC, ROWS BETWEEN 96 PRECEDING AND 16 PRECEDING) AS int_col#85], [_w0#158 DESC, _w1#159 DESC]
!         :              +- Window [avg(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;((669 - -773) as bigint)) windowspecdefinition(_w4#162 ASC, _w5#163 ASC, ROWS BETWEEN CURRENT ROW AND 62 FOLLOWING) AS float_col_1#89], [_w4#162 ASC, _w5#163 ASC]                                                                                                                                                                                                                                                                                                                                                                                                                                                         :              +- Window [avg(1442) windowspecdefinition(_w4#162 ASC, _w5#163 ASC, ROWS BETWEEN CURRENT ROW AND 62 FOLLOWING) AS float_col_1#89], [_w4#162 ASC, _w5#163 ASC]
!         :                 +- Project [(int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS decimal_col#86, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS int_col_1#87, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS _w0#158, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w1#159, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS _w2#160, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w3#161, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) AS _w4#162, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w5#163]                                                                                                                                                                :                 +- Project [(int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS decimal_col#86, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS int_col_1#87, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w0#158, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w1#159, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w2#160, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w3#161, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w4#162, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w5#163]
          :                    +- Join Inner, (((isnotnull(smallint_col_4#145) &amp;amp;&amp;amp; isnotnull(int_col_6#32)) &amp;amp;&amp;amp; isnotnull(int_col_9#35)) &amp;amp;&amp;amp; ((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_9#35) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_6#32)))                                                                                                                                                                                                                                                                                                                                                                                                                      :                    +- Join Inner, (((isnotnull(smallint_col_4#145) &amp;amp;&amp;amp; isnotnull(int_col_6#32)) &amp;amp;&amp;amp; isnotnull(int_col_9#35)) &amp;amp;&amp;amp; ((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_9#35) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_6#32)))
          :                       :- Project [col4#20 AS smallint_col_4#30, col6#22 AS int_col_6#32, col9#25 AS int_col_9#35]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          :                       :- Project [col4#20 AS smallint_col_4#30, col6#22 AS int_col_6#32, col9#25 AS int_col_9#35]
          :                       :  +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      :                       :  +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
          :                       +- Project [col4#20 AS smallint_col_4#145, col6#22 AS int_col_6#147]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 :                       +- Project [col4#20 AS smallint_col_4#145, col6#22 AS int_col_6#147]
          :                          +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      :                          +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
          +- Project [col1#55L AS bigint_col_1#61L, col3#57 AS double_col_3#63, col6#60 AS varchar0164_col_6#66]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       +- Project [col1#55L AS bigint_col_1#61L, col3#57 AS double_col_3#63, col6#60 AS varchar0164_col_6#66]
             +- LocalRelation [col1#55L, col2#56, col3#57, col4#58, col5#59, col6#60]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     +- LocalRelation [col1#55L, col2#56, col3#57, col4#58, col5#59, col6#60]

16/09/29 13:26:17 TRACE SparkOptimizer:
=== Applying Rule org.apache.spark.sql.catalyst.optimizer.SimplifyCasts ===
 Aggregate [count(1) AS count#179L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           Aggregate [count(1) AS count#179L]
!+- Aggregate [int_col_2#165, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#14L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) / &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(double_col_3#63 as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)), trim(varchar0164_col_6#66)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               +- Aggregate [int_col_2#165, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#14L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) / double_col_3#63), trim(varchar0164_col_6#66)]
    +- Project [bigint_col_7#14L, int_col_2#165, double_col_3#63, varchar0164_col_6#66]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          +- Project [bigint_col_7#14L, int_col_2#165, double_col_3#63, varchar0164_col_6#66]
       +- Join Inner, (((((((int_col#81L = int_col_1#82L) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col_1#82L)) &amp;amp;&amp;amp; isnotnull(bigint_col_7#14L)) &amp;amp;&amp;amp; isnotnull(int_col#81L)) &amp;amp;&amp;amp; isnotnull(int_col_1#82L)) &amp;amp;&amp;amp; (((bigint_col_1#61L = bigint_col_7#14L) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col_1#82L)))                                                                                                                                                                                                                                                                                                               +- Join Inner, (((((((int_col#81L = int_col_1#82L) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col_1#82L)) &amp;amp;&amp;amp; isnotnull(bigint_col_7#14L)) &amp;amp;&amp;amp; isnotnull(int_col#81L)) &amp;amp;&amp;amp; isnotnull(int_col_1#82L)) &amp;amp;&amp;amp; (((bigint_col_1#61L = bigint_col_7#14L) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col_1#82L)))
          :- Aggregate [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165, int_col_3#166], [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     :- Aggregate [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165, int_col_3#166], [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]
          :  +- Union                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  :  +- Union
          :     :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_2#83L as decimal(29,9)) AS int_col_2#165, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_3#84L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) AS int_col_3#166]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       :     :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_2#83L as decimal(29,9)) AS int_col_2#165, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_3#84L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) AS int_col_3#166]
          :     :  +- Filter NOT &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L as decimal(22,2)) IN (423.13,&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#140L as decimal(22,2)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :     :  +- Filter NOT &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L as decimal(22,2)) IN (423.13,&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#140L as decimal(22,2)))
          :     :     +- Aggregate [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L), bigint_col_7#14L, bigint_col_7#140L], [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) AS int_col#81L, bigint_col_7#14L, bigint_col_7#140L AS int_col_1#82L, bigint_col_7#14L AS int_col_2#83L, coalesce(bigint_col_7#140L, (coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) - bigint_col_7#14L), min(bigint_col_7#140L)) AS int_col_3#84L, min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L)) AS min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L, bigint_col_7#140L]            :     :     +- Aggregate [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L), bigint_col_7#14L, bigint_col_7#140L], [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) AS int_col#81L, bigint_col_7#14L, bigint_col_7#140L AS int_col_1#82L, bigint_col_7#14L AS int_col_2#83L, coalesce(bigint_col_7#140L, (coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) - bigint_col_7#14L), min(bigint_col_7#140L)) AS int_col_3#84L, min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L)) AS min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L, bigint_col_7#140L]
          :     :        +- Project [bigint_col_7#14L, bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              :     :        +- Project [bigint_col_7#14L, bigint_col_7#140L]
          :     :           +- Join Inner, ((isnotnull(timestamp_col_8#15) &amp;amp;&amp;amp; isnotnull(timestamp_col_5#138)) &amp;amp;&amp;amp; (bigint_col_7#14L IN (bigint_col_7#140L,bigint_col_7#140L) &amp;amp;&amp;amp; ((timestamp_col_5#138 = timestamp_col_8#15) &amp;amp;&amp;amp; (decimal2610_col_3#136 = decimal2610_col_3#10))))                                                                                                                                                                                                                                                                                                                                                                                        :     :           +- Join Inner, ((isnotnull(timestamp_col_8#15) &amp;amp;&amp;amp; isnotnull(timestamp_col_5#138)) &amp;amp;&amp;amp; (bigint_col_7#14L IN (bigint_col_7#140L,bigint_col_7#140L) &amp;amp;&amp;amp; ((timestamp_col_5#138 = timestamp_col_8#15) &amp;amp;&amp;amp; (decimal2610_col_3#136 = decimal2610_col_3#10))))
          :     :              :- Project [col3#2 AS decimal2610_col_3#10, col7#6L AS bigint_col_7#14L, col8#7 AS timestamp_col_8#15]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  :     :              :- Project [col3#2 AS decimal2610_col_3#10, col7#6L AS bigint_col_7#14L, col8#7 AS timestamp_col_8#15]
          :     :              :  +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   :     :              :  +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]
          :     :              +- Project [col3#2 AS decimal2610_col_3#136, col5#4 AS timestamp_col_5#138, col7#6L AS bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               :     :              +- Project [col3#2 AS decimal2610_col_3#136, col5#4 AS timestamp_col_5#138, col7#6L AS bigint_col_7#140L]
          :     :                 +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   :     :                 +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]
          :     +- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) AS int_col#167L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) AS decimal_col#168L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) AS int_col_1#169L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(float_col#88 as decimal(29,9)) AS float_col#170, float_col_1#89]                                                                                                                                                                                                                                                                                                                                                                                                                      :     +- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) AS int_col#167L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) AS decimal_col#168L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) AS int_col_1#169L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(float_col#88 as decimal(29,9)) AS float_col#170, float_col_1#89]
          :        +- Window [lag(-70726.079412976, 46, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) windowspecdefinition(_w2#160 DESC, _w3#161 DESC, ROWS BETWEEN 46 PRECEDING AND 46 PRECEDING) AS float_col#88], [_w2#160 DESC, _w3#161 DESC]                                                                                                                                                                                                                                                                                                                                                                                                                                                              :        +- Window [lag(-70726.079412976, 46, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) windowspecdefinition(_w2#160 DESC, _w3#161 DESC, ROWS BETWEEN 46 PRECEDING AND 46 PRECEDING) AS float_col#88], [_w2#160 DESC, _w3#161 DESC]
          :           +- Window [min(404172) windowspecdefinition(_w0#158 DESC, _w1#159 DESC, ROWS BETWEEN 96 PRECEDING AND 16 PRECEDING) AS int_col#85], [_w0#158 DESC, _w1#159 DESC]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 :           +- Window [min(404172) windowspecdefinition(_w0#158 DESC, _w1#159 DESC, ROWS BETWEEN 96 PRECEDING AND 16 PRECEDING) AS int_col#85], [_w0#158 DESC, _w1#159 DESC]
          :              +- Window [avg(1442) windowspecdefinition(_w4#162 ASC, _w5#163 ASC, ROWS BETWEEN CURRENT ROW AND 62 FOLLOWING) AS float_col_1#89], [_w4#162 ASC, _w5#163 ASC]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 :              +- Window [avg(1442) windowspecdefinition(_w4#162 ASC, _w5#163 ASC, ROWS BETWEEN CURRENT ROW AND 62 FOLLOWING) AS float_col_1#89], [_w4#162 ASC, _w5#163 ASC]
          :                 +- Project [(int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS decimal_col#86, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS int_col_1#87, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w0#158, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w1#159, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w2#160, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w3#161, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w4#162, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w5#163]                                                                                                                                                                                                                    :                 +- Project [(int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS decimal_col#86, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS int_col_1#87, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w0#158, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w1#159, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w2#160, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w3#161, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w4#162, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w5#163]
          :                    +- Join Inner, (((isnotnull(smallint_col_4#145) &amp;amp;&amp;amp; isnotnull(int_col_6#32)) &amp;amp;&amp;amp; isnotnull(int_col_9#35)) &amp;amp;&amp;amp; ((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_9#35) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_6#32)))                                                                                                                                                                                                                                                                                                                                                                                                                      :                    +- Join Inner, (((isnotnull(smallint_col_4#145) &amp;amp;&amp;amp; isnotnull(int_col_6#32)) &amp;amp;&amp;amp; isnotnull(int_col_9#35)) &amp;amp;&amp;amp; ((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_9#35) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_6#32)))
          :                       :- Project [col4#20 AS smallint_col_4#30, col6#22 AS int_col_6#32, col9#25 AS int_col_9#35]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          :                       :- Project [col4#20 AS smallint_col_4#30, col6#22 AS int_col_6#32, col9#25 AS int_col_9#35]
          :                       :  +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      :                       :  +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
          :                       +- Project [col4#20 AS smallint_col_4#145, col6#22 AS int_col_6#147]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 :                       +- Project [col4#20 AS smallint_col_4#145, col6#22 AS int_col_6#147]
          :                          +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      :                          +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
          +- Project [col1#55L AS bigint_col_1#61L, col3#57 AS double_col_3#63, col6#60 AS varchar0164_col_6#66]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       +- Project [col1#55L AS bigint_col_1#61L, col3#57 AS double_col_3#63, col6#60 AS varchar0164_col_6#66]
             +- LocalRelation [col1#55L, col2#56, col3#57, col4#58, col5#59, col6#60]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     +- LocalRelation [col1#55L, col2#56, col3#57, col4#58, col5#59, col6#60]

16/09/29 13:26:17 TRACE SparkOptimizer:
=== Applying Rule org.apache.spark.sql.catalyst.optimizer.PushPredicateThroughJoin ===
 Aggregate [count(1) AS count#179L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           Aggregate [count(1) AS count#179L]
 +- Aggregate [int_col_2#165, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#14L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) / double_col_3#63), trim(varchar0164_col_6#66)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               +- Aggregate [int_col_2#165, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#14L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) / double_col_3#63), trim(varchar0164_col_6#66)]
    +- Project [bigint_col_7#14L, int_col_2#165, double_col_3#63, varchar0164_col_6#66]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          +- Project [bigint_col_7#14L, int_col_2#165, double_col_3#63, varchar0164_col_6#66]
!      +- Join Inner, (((((((int_col#81L = int_col_1#82L) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col_1#82L)) &amp;amp;&amp;amp; isnotnull(bigint_col_7#14L)) &amp;amp;&amp;amp; isnotnull(int_col#81L)) &amp;amp;&amp;amp; isnotnull(int_col_1#82L)) &amp;amp;&amp;amp; (((bigint_col_1#61L = bigint_col_7#14L) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col_1#82L)))                                                                                                                                                                                                                                                                                                               +- Join Inner, (((bigint_col_1#61L = bigint_col_7#14L) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col_1#82L))
!         :- Aggregate [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165, int_col_3#166], [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     :- Filter ((((((int_col#81L = int_col_1#82L) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col_1#82L)) &amp;amp;&amp;amp; isnotnull(bigint_col_7#14L)) &amp;amp;&amp;amp; isnotnull(int_col#81L)) &amp;amp;&amp;amp; isnotnull(int_col_1#82L))
!         :  +- Union                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  :  +- Aggregate [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165, int_col_3#166], [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]
!         :     :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_2#83L as decimal(29,9)) AS int_col_2#165, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_3#84L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) AS int_col_3#166]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       :     +- Union
!         :     :  +- Filter NOT &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L as decimal(22,2)) IN (423.13,&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#140L as decimal(22,2)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :        :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_2#83L as decimal(29,9)) AS int_col_2#165, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_3#84L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) AS int_col_3#166]
!         :     :     +- Aggregate [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L), bigint_col_7#14L, bigint_col_7#140L], [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) AS int_col#81L, bigint_col_7#14L, bigint_col_7#140L AS int_col_1#82L, bigint_col_7#14L AS int_col_2#83L, coalesce(bigint_col_7#140L, (coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) - bigint_col_7#14L), min(bigint_col_7#140L)) AS int_col_3#84L, min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L)) AS min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L, bigint_col_7#140L]            :        :  +- Filter NOT &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L as decimal(22,2)) IN (423.13,&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#140L as decimal(22,2)))
!         :     :        +- Project [bigint_col_7#14L, bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              :        :     +- Aggregate [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L), bigint_col_7#14L, bigint_col_7#140L], [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) AS int_col#81L, bigint_col_7#14L, bigint_col_7#140L AS int_col_1#82L, bigint_col_7#14L AS int_col_2#83L, coalesce(bigint_col_7#140L, (coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) - bigint_col_7#14L), min(bigint_col_7#140L)) AS int_col_3#84L, min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L)) AS min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L, bigint_col_7#140L]
!         :     :           +- Join Inner, ((isnotnull(timestamp_col_8#15) &amp;amp;&amp;amp; isnotnull(timestamp_col_5#138)) &amp;amp;&amp;amp; (bigint_col_7#14L IN (bigint_col_7#140L,bigint_col_7#140L) &amp;amp;&amp;amp; ((timestamp_col_5#138 = timestamp_col_8#15) &amp;amp;&amp;amp; (decimal2610_col_3#136 = decimal2610_col_3#10))))                                                                                                                                                                                                                                                                                                                                                                                        :        :        +- Project [bigint_col_7#14L, bigint_col_7#140L]
!         :     :              :- Project [col3#2 AS decimal2610_col_3#10, col7#6L AS bigint_col_7#14L, col8#7 AS timestamp_col_8#15]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  :        :           +- Join Inner, ((bigint_col_7#14L IN (bigint_col_7#140L,bigint_col_7#140L) &amp;amp;&amp;amp; (timestamp_col_5#138 = timestamp_col_8#15)) &amp;amp;&amp;amp; (decimal2610_col_3#136 = decimal2610_col_3#10))
!         :     :              :  +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   :        :              :- Filter isnotnull(timestamp_col_8#15)
!         :     :              +- Project [col3#2 AS decimal2610_col_3#136, col5#4 AS timestamp_col_5#138, col7#6L AS bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               :        :              :  +- Project [col3#2 AS decimal2610_col_3#10, col7#6L AS bigint_col_7#14L, col8#7 AS timestamp_col_8#15]
!         :     :                 +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   :        :              :     +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]
!         :     +- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) AS int_col#167L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) AS decimal_col#168L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) AS int_col_1#169L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(float_col#88 as decimal(29,9)) AS float_col#170, float_col_1#89]                                                                                                                                                                                                                                                                                                                                                                                                                      :        :              +- Filter isnotnull(timestamp_col_5#138)
!         :        +- Window [lag(-70726.079412976, 46, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) windowspecdefinition(_w2#160 DESC, _w3#161 DESC, ROWS BETWEEN 46 PRECEDING AND 46 PRECEDING) AS float_col#88], [_w2#160 DESC, _w3#161 DESC]                                                                                                                                                                                                                                                                                                                                                                                                                                                              :        :                 +- Project [col3#2 AS decimal2610_col_3#136, col5#4 AS timestamp_col_5#138, col7#6L AS bigint_col_7#140L]
!         :           +- Window [min(404172) windowspecdefinition(_w0#158 DESC, _w1#159 DESC, ROWS BETWEEN 96 PRECEDING AND 16 PRECEDING) AS int_col#85], [_w0#158 DESC, _w1#159 DESC]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 :        :                    +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]
!         :              +- Window [avg(1442) windowspecdefinition(_w4#162 ASC, _w5#163 ASC, ROWS BETWEEN CURRENT ROW AND 62 FOLLOWING) AS float_col_1#89], [_w4#162 ASC, _w5#163 ASC]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 :        +- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) AS int_col#167L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) AS decimal_col#168L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) AS int_col_1#169L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(float_col#88 as decimal(29,9)) AS float_col#170, float_col_1#89]
!         :                 +- Project [(int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS decimal_col#86, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS int_col_1#87, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w0#158, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w1#159, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w2#160, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w3#161, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w4#162, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w5#163]                                                                                                                                                                                                                    :           +- Window [lag(-70726.079412976, 46, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) windowspecdefinition(_w2#160 DESC, _w3#161 DESC, ROWS BETWEEN 46 PRECEDING AND 46 PRECEDING) AS float_col#88], [_w2#160 DESC, _w3#161 DESC]
!         :                    +- Join Inner, (((isnotnull(smallint_col_4#145) &amp;amp;&amp;amp; isnotnull(int_col_6#32)) &amp;amp;&amp;amp; isnotnull(int_col_9#35)) &amp;amp;&amp;amp; ((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_9#35) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_6#32)))                                                                                                                                                                                                                                                                                                                                                                                                                      :              +- Window [min(404172) windowspecdefinition(_w0#158 DESC, _w1#159 DESC, ROWS BETWEEN 96 PRECEDING AND 16 PRECEDING) AS int_col#85], [_w0#158 DESC, _w1#159 DESC]
!         :                       :- Project [col4#20 AS smallint_col_4#30, col6#22 AS int_col_6#32, col9#25 AS int_col_9#35]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          :                 +- Window [avg(1442) windowspecdefinition(_w4#162 ASC, _w5#163 ASC, ROWS BETWEEN CURRENT ROW AND 62 FOLLOWING) AS float_col_1#89], [_w4#162 ASC, _w5#163 ASC]
!         :                       :  +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      :                    +- Project [(int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS decimal_col#86, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS int_col_1#87, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w0#158, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w1#159, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w2#160, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w3#161, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w4#162, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w5#163]
!         :                       +- Project [col4#20 AS smallint_col_4#145, col6#22 AS int_col_6#147]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 :                       +- Join Inner, ((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_9#35) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_6#32))
!         :                          +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      :                          :- Filter (isnotnull(int_col_6#32) &amp;amp;&amp;amp; isnotnull(int_col_9#35))
!         +- Project [col1#55L AS bigint_col_1#61L, col3#57 AS double_col_3#63, col6#60 AS varchar0164_col_6#66]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       :                          :  +- Project [col4#20 AS smallint_col_4#30, col6#22 AS int_col_6#32, col9#25 AS int_col_9#35]
!            +- LocalRelation [col1#55L, col2#56, col3#57, col4#58, col5#59, col6#60]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  :                          :     +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
!                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      :                          +- Filter isnotnull(smallint_col_4#145)
!                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      :                             +- Project [col4#20 AS smallint_col_4#145, col6#22 AS int_col_6#147]
!                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      :                                +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
!                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      +- Project [col1#55L AS bigint_col_1#61L, col3#57 AS double_col_3#63, col6#60 AS varchar0164_col_6#66]
!                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         +- LocalRelation [col1#55L, col2#56, col3#57, col4#58, col5#59, col6#60]

16/09/29 13:26:17 TRACE SparkOptimizer:
=== Applying Rule org.apache.spark.sql.catalyst.optimizer.PushDownPredicate ===
 Aggregate [count(1) AS count#179L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Aggregate [count(1) AS count#179L]
 +- Aggregate [int_col_2#165, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#14L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) / double_col_3#63), trim(varchar0164_col_6#66)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  +- Aggregate [int_col_2#165, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#14L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) / double_col_3#63), trim(varchar0164_col_6#66)]
    +- Project [bigint_col_7#14L, int_col_2#165, double_col_3#63, varchar0164_col_6#66]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             +- Project [bigint_col_7#14L, int_col_2#165, double_col_3#63, varchar0164_col_6#66]
       +- Join Inner, (((bigint_col_1#61L = bigint_col_7#14L) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col_1#82L))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +- Join Inner, (((bigint_col_1#61L = bigint_col_7#14L) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col_1#82L))
!         :- Filter ((((((int_col#81L = int_col_1#82L) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col_1#82L)) &amp;amp;&amp;amp; isnotnull(bigint_col_7#14L)) &amp;amp;&amp;amp; isnotnull(int_col#81L)) &amp;amp;&amp;amp; isnotnull(int_col_1#82L))                                                                                                                                                                                                                                                                                                                                                                                                                                                :- Aggregate [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165, int_col_3#166], [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]
!         :  +- Aggregate [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165, int_col_3#166], [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     :  +- Union
!         :     +- Union                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  :     :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_2#83L as decimal(29,9)) AS int_col_2#165, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_3#84L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) AS int_col_3#166]
!         :        :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_2#83L as decimal(29,9)) AS int_col_2#165, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_3#84L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) AS int_col_3#166]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       :     :  +- Filter ((((((int_col#81L = int_col_1#82L) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col_1#82L)) &amp;amp;&amp;amp; isnotnull(bigint_col_7#14L)) &amp;amp;&amp;amp; isnotnull(int_col#81L)) &amp;amp;&amp;amp; isnotnull(int_col_1#82L))
!         :        :  +- Filter NOT &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L as decimal(22,2)) IN (423.13,&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#140L as decimal(22,2)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :     :     +- Filter NOT &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L as decimal(22,2)) IN (423.13,&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#140L as decimal(22,2)))
!         :        :     +- Aggregate [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L), bigint_col_7#14L, bigint_col_7#140L], [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) AS int_col#81L, bigint_col_7#14L, bigint_col_7#140L AS int_col_1#82L, bigint_col_7#14L AS int_col_2#83L, coalesce(bigint_col_7#140L, (coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) - bigint_col_7#14L), min(bigint_col_7#140L)) AS int_col_3#84L, min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L)) AS min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L, bigint_col_7#140L]            :     :        +- Aggregate [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L), bigint_col_7#14L, bigint_col_7#140L], [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) AS int_col#81L, bigint_col_7#14L, bigint_col_7#140L AS int_col_1#82L, bigint_col_7#14L AS int_col_2#83L, coalesce(bigint_col_7#140L, (coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) - bigint_col_7#14L), min(bigint_col_7#140L)) AS int_col_3#84L, min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L)) AS min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L, bigint_col_7#140L]
!         :        :        +- Project [bigint_col_7#14L, bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              :     :           +- Project [bigint_col_7#14L, bigint_col_7#140L]
!         :        :           +- Join Inner, ((bigint_col_7#14L IN (bigint_col_7#140L,bigint_col_7#140L) &amp;amp;&amp;amp; (timestamp_col_5#138 = timestamp_col_8#15)) &amp;amp;&amp;amp; (decimal2610_col_3#136 = decimal2610_col_3#10))                                                                                                                                                                                                                                                                                                                                                                                                                                                               :     :              +- Join Inner, ((bigint_col_7#14L IN (bigint_col_7#140L,bigint_col_7#140L) &amp;amp;&amp;amp; (timestamp_col_5#138 = timestamp_col_8#15)) &amp;amp;&amp;amp; (decimal2610_col_3#136 = decimal2610_col_3#10))
!         :        :              :- Filter isnotnull(timestamp_col_8#15)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 :     :                 :- Project [col3#2 AS decimal2610_col_3#10, col7#6L AS bigint_col_7#14L, col8#7 AS timestamp_col_8#15]
!         :        :              :  +- Project [col3#2 AS decimal2610_col_3#10, col7#6L AS bigint_col_7#14L, col8#7 AS timestamp_col_8#15]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               :     :                 :  +- Filter isnotnull(col8#7)
!         :        :              :     +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :     :                 :     +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]
!         :        :              +- Filter isnotnull(timestamp_col_5#138)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :     :                 +- Project [col3#2 AS decimal2610_col_3#136, col5#4 AS timestamp_col_5#138, col7#6L AS bigint_col_7#140L]
!         :        :                 +- Project [col3#2 AS decimal2610_col_3#136, col5#4 AS timestamp_col_5#138, col7#6L AS bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            :     :                    +- Filter isnotnull(col5#4)
!         :        :                    +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :     :                       +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]
!         :        +- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) AS int_col#167L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) AS decimal_col#168L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) AS int_col_1#169L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(float_col#88 as decimal(29,9)) AS float_col#170, float_col_1#89]                                                                                                                                                                                                                                                                                                                                                                                                                      :     +- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) AS int_col#167L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) AS decimal_col#168L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) AS int_col_1#169L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(float_col#88 as decimal(29,9)) AS float_col#170, float_col_1#89]
!         :           +- Window [lag(-70726.079412976, 46, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) windowspecdefinition(_w2#160 DESC, _w3#161 DESC, ROWS BETWEEN 46 PRECEDING AND 46 PRECEDING) AS float_col#88], [_w2#160 DESC, _w3#161 DESC]                                                                                                                                                                                                                                                                                                                                                                                                                                                              :        +- Filter ((((((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint))) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint))) &amp;amp;&amp;amp; isnotnull(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint))) &amp;amp;&amp;amp; isnotnull(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint))) &amp;amp;&amp;amp; isnotnull(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)))
!         :              +- Window [min(404172) windowspecdefinition(_w0#158 DESC, _w1#159 DESC, ROWS BETWEEN 96 PRECEDING AND 16 PRECEDING) AS int_col#85], [_w0#158 DESC, _w1#159 DESC]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 :           +- Window [lag(-70726.079412976, 46, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) windowspecdefinition(_w2#160 DESC, _w3#161 DESC, ROWS BETWEEN 46 PRECEDING AND 46 PRECEDING) AS float_col#88], [_w2#160 DESC, _w3#161 DESC]
!         :                 +- Window [avg(1442) windowspecdefinition(_w4#162 ASC, _w5#163 ASC, ROWS BETWEEN CURRENT ROW AND 62 FOLLOWING) AS float_col_1#89], [_w4#162 ASC, _w5#163 ASC]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 :              +- Window [min(404172) windowspecdefinition(_w0#158 DESC, _w1#159 DESC, ROWS BETWEEN 96 PRECEDING AND 16 PRECEDING) AS int_col#85], [_w0#158 DESC, _w1#159 DESC]
!         :                    +- Project [(int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS decimal_col#86, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS int_col_1#87, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w0#158, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w1#159, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w2#160, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w3#161, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w4#162, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w5#163]                                                                                                                                                                                                                    :                 +- Window [avg(1442) windowspecdefinition(_w4#162 ASC, _w5#163 ASC, ROWS BETWEEN CURRENT ROW AND 62 FOLLOWING) AS float_col_1#89], [_w4#162 ASC, _w5#163 ASC]
!         :                       +- Join Inner, ((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_9#35) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_6#32))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   :                    +- Project [(int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS decimal_col#86, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS int_col_1#87, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w0#158, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w1#159, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w2#160, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w3#161, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w4#162, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w5#163]
!         :                          :- Filter (isnotnull(int_col_6#32) &amp;amp;&amp;amp; isnotnull(int_col_9#35))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       :                       +- Join Inner, ((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_9#35) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_6#32))
!         :                          :  +- Project [col4#20 AS smallint_col_4#30, col6#22 AS int_col_6#32, col9#25 AS int_col_9#35]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       :                          :- Project [col4#20 AS smallint_col_4#30, col6#22 AS int_col_6#32, col9#25 AS int_col_9#35]
!         :                          :     +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   :                          :  +- Filter (isnotnull(col6#22) &amp;amp;&amp;amp; isnotnull(col9#25))
!         :                          +- Filter isnotnull(smallint_col_4#145)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              :                          :     +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
!         :                             +- Project [col4#20 AS smallint_col_4#145, col6#22 AS int_col_6#147]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              :                          +- Project [col4#20 AS smallint_col_4#145, col6#22 AS int_col_6#147]
!         :                                +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   :                             +- Filter isnotnull(col4#20)
!         +- Project [col1#55L AS bigint_col_1#61L, col3#57 AS double_col_3#63, col6#60 AS varchar0164_col_6#66]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          :                                +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
!            +- LocalRelation [col1#55L, col2#56, col3#57, col4#58, col5#59, col6#60]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     +- Project [col1#55L AS bigint_col_1#61L, col3#57 AS double_col_3#63, col6#60 AS varchar0164_col_6#66]
!                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            +- LocalRelation [col1#55L, col2#56, col3#57, col4#58, col5#59, col6#60]

16/09/29 13:26:17 TRACE SparkOptimizer:
=== Applying Rule org.apache.spark.sql.catalyst.optimizer.ColumnPruning ===
 Aggregate [count(1) AS count#179L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Aggregate [count(1) AS count#179L]
 +- Aggregate [int_col_2#165, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#14L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) / double_col_3#63), trim(varchar0164_col_6#66)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  +- Aggregate [int_col_2#165, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#14L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) / double_col_3#63), trim(varchar0164_col_6#66)]
    +- Project [bigint_col_7#14L, int_col_2#165, double_col_3#63, varchar0164_col_6#66]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             +- Project [bigint_col_7#14L, int_col_2#165, double_col_3#63, varchar0164_col_6#66]
       +- Join Inner, (((bigint_col_1#61L = bigint_col_7#14L) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col_1#82L))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +- Join Inner, (((bigint_col_1#61L = bigint_col_7#14L) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col_1#82L))
          :- Aggregate [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165, int_col_3#166], [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        :- Aggregate [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165, int_col_3#166], [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]
          :  +- Union                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     :  +- Union
          :     :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_2#83L as decimal(29,9)) AS int_col_2#165, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_3#84L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) AS int_col_3#166]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          :     :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_2#83L as decimal(29,9)) AS int_col_2#165, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_3#84L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) AS int_col_3#166]
          :     :  +- Filter ((((((int_col#81L = int_col_1#82L) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col_1#82L)) &amp;amp;&amp;amp; isnotnull(bigint_col_7#14L)) &amp;amp;&amp;amp; isnotnull(int_col#81L)) &amp;amp;&amp;amp; isnotnull(int_col_1#82L))                                                                                                                                                                                                                                                                                                                                                                                                                                       :     :  +- Filter ((((((int_col#81L = int_col_1#82L) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col_1#82L)) &amp;amp;&amp;amp; isnotnull(bigint_col_7#14L)) &amp;amp;&amp;amp; isnotnull(int_col#81L)) &amp;amp;&amp;amp; isnotnull(int_col_1#82L))
          :     :     +- Filter NOT &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L as decimal(22,2)) IN (423.13,&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#140L as decimal(22,2)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :     :     +- Filter NOT &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L as decimal(22,2)) IN (423.13,&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#140L as decimal(22,2)))
          :     :        +- Aggregate [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L), bigint_col_7#14L, bigint_col_7#140L], [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) AS int_col#81L, bigint_col_7#14L, bigint_col_7#140L AS int_col_1#82L, bigint_col_7#14L AS int_col_2#83L, coalesce(bigint_col_7#140L, (coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) - bigint_col_7#14L), min(bigint_col_7#140L)) AS int_col_3#84L, min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L)) AS min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L, bigint_col_7#140L]            :     :        +- Aggregate [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L), bigint_col_7#14L, bigint_col_7#140L], [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) AS int_col#81L, bigint_col_7#14L, bigint_col_7#140L AS int_col_1#82L, bigint_col_7#14L AS int_col_2#83L, coalesce(bigint_col_7#140L, (coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) - bigint_col_7#14L), min(bigint_col_7#140L)) AS int_col_3#84L, min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L)) AS min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L, bigint_col_7#140L]
          :     :           +- Project [bigint_col_7#14L, bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              :     :           +- Project [bigint_col_7#14L, bigint_col_7#140L]
          :     :              +- Join Inner, ((bigint_col_7#14L IN (bigint_col_7#140L,bigint_col_7#140L) &amp;amp;&amp;amp; (timestamp_col_5#138 = timestamp_col_8#15)) &amp;amp;&amp;amp; (decimal2610_col_3#136 = decimal2610_col_3#10))                                                                                                                                                                                                                                                                                                                                                                                                                                                               :     :              +- Join Inner, ((bigint_col_7#14L IN (bigint_col_7#140L,bigint_col_7#140L) &amp;amp;&amp;amp; (timestamp_col_5#138 = timestamp_col_8#15)) &amp;amp;&amp;amp; (decimal2610_col_3#136 = decimal2610_col_3#10))
          :     :                 :- Project [col3#2 AS decimal2610_col_3#10, col7#6L AS bigint_col_7#14L, col8#7 AS timestamp_col_8#15]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  :     :                 :- Project [col3#2 AS decimal2610_col_3#10, col7#6L AS bigint_col_7#14L, col8#7 AS timestamp_col_8#15]
          :     :                 :  +- Filter isnotnull(col8#7)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          :     :                 :  +- Filter isnotnull(col8#7)
          :     :                 :     +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :     :                 :     +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]
          :     :                 +- Project [col3#2 AS decimal2610_col_3#136, col5#4 AS timestamp_col_5#138, col7#6L AS bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               :     :                 +- Project [col3#2 AS decimal2610_col_3#136, col5#4 AS timestamp_col_5#138, col7#6L AS bigint_col_7#140L]
          :     :                    +- Filter isnotnull(col5#4)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          :     :                    +- Filter isnotnull(col5#4)
          :     :                       +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :     :                       +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]
          :     +- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) AS int_col#167L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) AS decimal_col#168L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) AS int_col_1#169L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(float_col#88 as decimal(29,9)) AS float_col#170, float_col_1#89]                                                                                                                                                                                                                                                                                                                                                                                                                         :     +- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) AS int_col#167L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) AS decimal_col#168L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) AS int_col_1#169L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(float_col#88 as decimal(29,9)) AS float_col#170, float_col_1#89]
          :        +- Filter ((((((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint))) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint))) &amp;amp;&amp;amp; isnotnull(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint))) &amp;amp;&amp;amp; isnotnull(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint))) &amp;amp;&amp;amp; isnotnull(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)))                                                                                                                                                                                                                                                                                                   :        +- Filter ((((((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint))) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint))) &amp;amp;&amp;amp; isnotnull(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint))) &amp;amp;&amp;amp; isnotnull(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint))) &amp;amp;&amp;amp; isnotnull(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)))
          :           +- Window [lag(-70726.079412976, 46, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) windowspecdefinition(_w2#160 DESC, _w3#161 DESC, ROWS BETWEEN 46 PRECEDING AND 46 PRECEDING) AS float_col#88], [_w2#160 DESC, _w3#161 DESC]                                                                                                                                                                                                                                                                                                                                                                                                                                                              :           +- Window [lag(-70726.079412976, 46, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) windowspecdefinition(_w2#160 DESC, _w3#161 DESC, ROWS BETWEEN 46 PRECEDING AND 46 PRECEDING) AS float_col#88], [_w2#160 DESC, _w3#161 DESC]
!         :              +- Window [min(404172) windowspecdefinition(_w0#158 DESC, _w1#159 DESC, ROWS BETWEEN 96 PRECEDING AND 16 PRECEDING) AS int_col#85], [_w0#158 DESC, _w1#159 DESC]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 :              +- Project [decimal_col#86, int_col_1#87, _w2#160, _w3#161, float_col_1#89, int_col#85]
!         :                 +- Window [avg(1442) windowspecdefinition(_w4#162 ASC, _w5#163 ASC, ROWS BETWEEN CURRENT ROW AND 62 FOLLOWING) AS float_col_1#89], [_w4#162 ASC, _w5#163 ASC]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 :                 +- Window [min(404172) windowspecdefinition(_w0#158 DESC, _w1#159 DESC, ROWS BETWEEN 96 PRECEDING AND 16 PRECEDING) AS int_col#85], [_w0#158 DESC, _w1#159 DESC]
!         :                    +- Project [(int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS decimal_col#86, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS int_col_1#87, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w0#158, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w1#159, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w2#160, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w3#161, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w4#162, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w5#163]                                                                                                                                                                                                                    :                    +- Project [decimal_col#86, int_col_1#87, _w0#158, _w1#159, _w2#160, _w3#161, float_col_1#89]
!         :                       +- Join Inner, ((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_9#35) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_6#32))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   :                       +- Window [avg(1442) windowspecdefinition(_w4#162 ASC, _w5#163 ASC, ROWS BETWEEN CURRENT ROW AND 62 FOLLOWING) AS float_col_1#89], [_w4#162 ASC, _w5#163 ASC]
!         :                          :- Project [col4#20 AS smallint_col_4#30, col6#22 AS int_col_6#32, col9#25 AS int_col_9#35]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          :                          +- Project [(int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS decimal_col#86, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS int_col_1#87, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w0#158, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w1#159, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w2#160, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w3#161, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w4#162, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w5#163]
!         :                          :  +- Filter (isnotnull(col6#22) &amp;amp;&amp;amp; isnotnull(col9#25))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              :                             +- Join Inner, ((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_9#35) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_6#32))
!         :                          :     +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   :                                :- Project [col4#20 AS smallint_col_4#30, col6#22 AS int_col_6#32, col9#25 AS int_col_9#35]
!         :                          +- Project [col4#20 AS smallint_col_4#145, col6#22 AS int_col_6#147]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 :                                :  +- Filter (isnotnull(col6#22) &amp;amp;&amp;amp; isnotnull(col9#25))
!         :                             +- Filter isnotnull(col4#20)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      :                                :     +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
!         :                                +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   :                                +- Project [col4#20 AS smallint_col_4#145, col6#22 AS int_col_6#147]
!         +- Project [col1#55L AS bigint_col_1#61L, col3#57 AS double_col_3#63, col6#60 AS varchar0164_col_6#66]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          :                                   +- Filter isnotnull(col4#20)
!            +- LocalRelation [col1#55L, col2#56, col3#57, col4#58, col5#59, col6#60]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     :                                      +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
!                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         +- Project [col1#55L AS bigint_col_1#61L, col3#57 AS double_col_3#63, col6#60 AS varchar0164_col_6#66]
!                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            +- LocalRelation [col1#55L, col2#56, col3#57, col4#58, col5#59, col6#60]

16/09/29 13:26:17 TRACE SparkOptimizer:
=== Applying Rule org.apache.spark.sql.catalyst.optimizer.InferFiltersFromConstraints ===
 Aggregate [count(1) AS count#179L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Aggregate [count(1) AS count#179L]
 +- Aggregate [int_col_2#165, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#14L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) / double_col_3#63), trim(varchar0164_col_6#66)]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  +- Aggregate [int_col_2#165, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#14L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) / double_col_3#63), trim(varchar0164_col_6#66)]
    +- Project [bigint_col_7#14L, int_col_2#165, double_col_3#63, varchar0164_col_6#66]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             +- Project [bigint_col_7#14L, int_col_2#165, double_col_3#63, varchar0164_col_6#66]
!      +- Join Inner, (((bigint_col_1#61L = bigint_col_7#14L) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col_1#82L))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              +- Join Inner, ((((int_col#81L = int_col_1#82L) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col_1#82L)) &amp;amp;&amp;amp; (((bigint_col_1#61L = bigint_col_7#14L) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_1#61L = int_col_1#82L)))
          :- Aggregate [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165, int_col_3#166], [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        :- Aggregate [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165, int_col_3#166], [int_col#81L, bigint_col_7#14L, int_col_1#82L, int_col_2#165]
          :  +- Union                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     :  +- Union
          :     :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_2#83L as decimal(29,9)) AS int_col_2#165, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_3#84L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) AS int_col_3#166]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          :     :- Project [int_col#81L, bigint_col_7#14L, int_col_1#82L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_2#83L as decimal(29,9)) AS int_col_2#165, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_3#84L as &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;) AS int_col_3#166]
!         :     :  +- Filter ((((((int_col#81L = int_col_1#82L) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col_1#82L)) &amp;amp;&amp;amp; isnotnull(bigint_col_7#14L)) &amp;amp;&amp;amp; isnotnull(int_col#81L)) &amp;amp;&amp;amp; isnotnull(int_col_1#82L))                                                                                                                                                                                                                                                                                                                                                                                                                                       :     :  +- Filter (((((((((((((((coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) &amp;lt;=&amp;gt; int_col_1#82L) &amp;amp;&amp;amp; (int_col#81L &amp;lt;=&amp;gt; int_col_2#83L)) &amp;amp;&amp;amp; (int_col_1#82L &amp;lt;=&amp;gt; int_col_2#83L)) &amp;amp;&amp;amp; (bigint_col_7#140L &amp;lt;=&amp;gt; int_col#81L)) &amp;amp;&amp;amp; int_col#81L IN (int_col_1#82L,int_col_1#82L)) &amp;amp;&amp;amp; (bigint_col_7#140L &amp;lt;=&amp;gt; bigint_col_7#14L)) &amp;amp;&amp;amp; (coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) &amp;lt;=&amp;gt; bigint_col_7#14L)) &amp;amp;&amp;amp; (coalesce(int_col_1#82L, bigint_col_7#140L, bigint_col_7#140L) &amp;lt;=&amp;gt; int_col#81L)) &amp;amp;&amp;amp; bigint_col_7#14L IN (bigint_col_7#14L,bigint_col_7#14L)) &amp;amp;&amp;amp; int_col_1#82L IN (int_col_1#82L,int_col_1#82L)) &amp;amp;&amp;amp; int_col#81L IN (bigint_col_7#140L,bigint_col_7#140L)) &amp;amp;&amp;amp; int_col_1#82L IN (bigint_col_7#140L,bigint_col_7#140L)) &amp;amp;&amp;amp; (coalesce(int_col#81L, bigint_col_7#140L, bigint_col_7#140L) &amp;lt;=&amp;gt; int_col#81L)) &amp;amp;&amp;amp; bigint_col_7#14L IN (int_col#81L,int_col#81L)) &amp;amp;&amp;amp; ((((((int_col#81L = int_col_1#82L) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col#81L)) &amp;amp;&amp;amp; (bigint_col_7#14L = int_col_1#82L)) &amp;amp;&amp;amp; isnotnull(bigint_col_7#14L)) &amp;amp;&amp;amp; isnotnull(int_col#81L)) &amp;amp;&amp;amp; isnotnull(int_col_1#82L)))
          :     :     +- Filter NOT &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L as decimal(22,2)) IN (423.13,&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#140L as decimal(22,2)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :     :     +- Filter NOT &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L as decimal(22,2)) IN (423.13,&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(bigint_col_7#140L as decimal(22,2)))
          :     :        +- Aggregate [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L), bigint_col_7#14L, bigint_col_7#140L], [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) AS int_col#81L, bigint_col_7#14L, bigint_col_7#140L AS int_col_1#82L, bigint_col_7#14L AS int_col_2#83L, coalesce(bigint_col_7#140L, (coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) - bigint_col_7#14L), min(bigint_col_7#140L)) AS int_col_3#84L, min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L)) AS min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L, bigint_col_7#140L]            :     :        +- Aggregate [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L), bigint_col_7#14L, bigint_col_7#140L], [coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) AS int_col#81L, bigint_col_7#14L, bigint_col_7#140L AS int_col_1#82L, bigint_col_7#14L AS int_col_2#83L, coalesce(bigint_col_7#140L, (coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L) - bigint_col_7#14L), min(bigint_col_7#140L)) AS int_col_3#84L, min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L)) AS min(coalesce(bigint_col_7#14L, bigint_col_7#140L, bigint_col_7#140L))#157L, bigint_col_7#140L]
          :     :           +- Project [bigint_col_7#14L, bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              :     :           +- Project [bigint_col_7#14L, bigint_col_7#140L]
          :     :              +- Join Inner, ((bigint_col_7#14L IN (bigint_col_7#140L,bigint_col_7#140L) &amp;amp;&amp;amp; (timestamp_col_5#138 = timestamp_col_8#15)) &amp;amp;&amp;amp; (decimal2610_col_3#136 = decimal2610_col_3#10))                                                                                                                                                                                                                                                                                                                                                                                                                                                               :     :              +- Join Inner, ((bigint_col_7#14L IN (bigint_col_7#140L,bigint_col_7#140L) &amp;amp;&amp;amp; (timestamp_col_5#138 = timestamp_col_8#15)) &amp;amp;&amp;amp; (decimal2610_col_3#136 = decimal2610_col_3#10))
          :     :                 :- Project [col3#2 AS decimal2610_col_3#10, col7#6L AS bigint_col_7#14L, col8#7 AS timestamp_col_8#15]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  :     :                 :- Project [col3#2 AS decimal2610_col_3#10, col7#6L AS bigint_col_7#14L, col8#7 AS timestamp_col_8#15]
          :     :                 :  +- Filter isnotnull(col8#7)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          :     :                 :  +- Filter isnotnull(col8#7)
          :     :                 :     +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :     :                 :     +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]
          :     :                 +- Project [col3#2 AS decimal2610_col_3#136, col5#4 AS timestamp_col_5#138, col7#6L AS bigint_col_7#140L]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               :     :                 +- Project [col3#2 AS decimal2610_col_3#136, col5#4 AS timestamp_col_5#138, col7#6L AS bigint_col_7#140L]
          :     :                    +- Filter isnotnull(col5#4)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          :     :                    +- Filter isnotnull(col5#4)
          :     :                       +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :     :                       +- LocalRelation [col1#0, col2#1, col3#2, col4#3, col5#4, col6#5, col7#6L, col8#7]
          :     +- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) AS int_col#167L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) AS decimal_col#168L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) AS int_col_1#169L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(float_col#88 as decimal(29,9)) AS float_col#170, float_col_1#89]                                                                                                                                                                                                                                                                                                                                                                                                                         :     +- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) AS int_col#167L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) AS decimal_col#168L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) AS int_col_1#169L, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(float_col#88 as decimal(29,9)) AS float_col#170, float_col_1#89]
!         :        +- Filter ((((((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint))) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint))) &amp;amp;&amp;amp; isnotnull(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint))) &amp;amp;&amp;amp; isnotnull(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint))) &amp;amp;&amp;amp; isnotnull(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)))                                                                                                                                                                                                                                                                                                   :        +- Filter (((isnotnull(int_col_1#87) &amp;amp;&amp;amp; isnotnull(int_col#85)) &amp;amp;&amp;amp; isnotnull(decimal_col#86)) &amp;amp;&amp;amp; ((((((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint))) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint) = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint))) &amp;amp;&amp;amp; isnotnull(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(decimal_col#86 as bigint))) &amp;amp;&amp;amp; isnotnull(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint))) &amp;amp;&amp;amp; isnotnull(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint))))
          :           +- Window [lag(-70726.079412976, 46, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) windowspecdefinition(_w2#160 DESC, _w3#161 DESC, ROWS BETWEEN 46 PRECEDING AND 46 PRECEDING) AS float_col#88], [_w2#160 DESC, _w3#161 DESC]                                                                                                                                                                                                                                                                                                                                                                                                                                                              :           +- Window [lag(-70726.079412976, 46, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) windowspecdefinition(_w2#160 DESC, _w3#161 DESC, ROWS BETWEEN 46 PRECEDING AND 46 PRECEDING) AS float_col#88], [_w2#160 DESC, _w3#161 DESC]
          :              +- Project [decimal_col#86, int_col_1#87, _w2#160, _w3#161, float_col_1#89, int_col#85]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          :              +- Project [decimal_col#86, int_col_1#87, _w2#160, _w3#161, float_col_1#89, int_col#85]
          :                 +- Window [min(404172) windowspecdefinition(_w0#158 DESC, _w1#159 DESC, ROWS BETWEEN 96 PRECEDING AND 16 PRECEDING) AS int_col#85], [_w0#158 DESC, _w1#159 DESC]                                                                                                                                                                                                                                                                                                                                                                                                                                                                              :                 +- Window [min(404172) windowspecdefinition(_w0#158 DESC, _w1#159 DESC, ROWS BETWEEN 96 PRECEDING AND 16 PRECEDING) AS int_col#85], [_w0#158 DESC, _w1#159 DESC]
          :                    +- Project [decimal_col#86, int_col_1#87, _w0#158, _w1#159, _w2#160, _w3#161, float_col_1#89]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              :                    +- Project [decimal_col#86, int_col_1#87, _w0#158, _w1#159, _w2#160, _w3#161, float_col_1#89]
          :                       +- Window [avg(1442) windowspecdefinition(_w4#162 ASC, _w5#163 ASC, ROWS BETWEEN CURRENT ROW AND 62 FOLLOWING) AS float_col_1#89], [_w4#162 ASC, _w5#163 ASC]                                                                                                                                                                                                                                                                                                                                                                                                                                                                           :                       +- Window [avg(1442) windowspecdefinition(_w4#162 ASC, _w5#163 ASC, ROWS BETWEEN CURRENT ROW AND 62 FOLLOWING) AS float_col_1#89], [_w4#162 ASC, _w5#163 ASC]
          :                          +- Project [(int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS decimal_col#86, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS int_col_1#87, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w0#158, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w1#159, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w2#160, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w3#161, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w4#162, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w5#163]                                                                                                                                                                                                              :                          +- Project [(int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS decimal_col#86, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS int_col_1#87, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w0#158, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w1#159, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w2#160, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w3#161, (int_col_6#147 * &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) AS _w4#162, (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#30 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) - int_col_6#147) AS _w5#163]
          :                             +- Join Inner, ((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_9#35) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_6#32))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             :                             +- Join Inner, ((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_9#35) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(smallint_col_4#145 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) = int_col_6#32))
          :                                :- Project [col4#20 AS smallint_col_4#30, col6#22 AS int_col_6#32, col9#25 AS int_col_9#35]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    :                                :- Project [col4#20 AS smallint_col_4#30, col6#22 AS int_col_6#32, col9#25 AS int_col_9#35]
          :                                :  +- Filter (isnotnull(col6#22) &amp;amp;&amp;amp; isnotnull(col9#25))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        :                                :  +- Filter (isnotnull(col6#22) &amp;amp;&amp;amp; isnotnull(col9#25))
          :                                :     +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             :                                :     +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
          :                                +- Project [col4#20 AS smallint_col_4#145, col6#22 AS int_col_6#147]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           :                                +- Project [col4#20 AS smallint_col_4#145, col6#22 AS int_col_6#147]
          :                                   +- Filter isnotnull(col4#20)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                :                                   +- Filter isnotnull(col4#20)
          :                                      +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             :                                      +- LocalRelation [col1#17, col2#18, col3#19, col4#20, col5#21, col6#22, col7#23, col8#24, col9#25, col10#26]
          +- Project [col1#55L AS bigint_col_1#61L, col3#57 AS double_col_3#63, col6#60 AS varchar0164_col_6#66]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          +- Project [col1#55L AS bigint_col_1#61L, col3#57 AS double_col_3#63, col6#60 AS varchar0164_col_6#66]
             +- LocalRelation [col1#55L, col2#56, col3#57, col4#58, col5#59, col6#60]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        +- LocalRelation [col1#55L, col2#56, col3#57, col4#58, col5#59, col6#60]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15533996" author="joshrosen" created="Thu, 29 Sep 2016 20:43:37 +0000"  >&lt;p&gt;Actually, the above log segment wasn&apos;t super useful, so let me post some of the inferred filters instead, since that might make the pattern easier to spot:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Filter ((isnotnull(col8#7) &amp;amp;&amp;amp; (((((col7#6L IN (coalesce(col7#6L, col7#6L, col7#6L),coalesce(col7#6L, col7#6L, col7#6L)) &amp;amp;&amp;amp; (coalesce(coalesce(col7#6L, col7#6L, col7#6L), col7#6L, col7#6L) &amp;lt;=&amp;gt; coalesce(col7#6L, col7#6L, col7#6L))) &amp;amp;&amp;amp; (col7#6L = coalesce(col7#6L, col7#6L, col7#6L))) &amp;amp;&amp;amp; (col7#6L &amp;lt;=&amp;gt; coalesce(col7#6L, col7#6L, col7#6L))) &amp;amp;&amp;amp; coalesce(col7#6L, col7#6L, col7#6L) IN (col7#6L,col7#6L)) &amp;amp;&amp;amp; col7#6L IN (col7#6L,col7#6L))) &amp;amp;&amp;amp; ((((((((((((((((col7#6L = coalesce(col7#6L, coalesce(col7#6L, col7#6L, col7#6L), coalesce(col7#6L, col7#6L, col7#6L))) &amp;amp;&amp;amp; (coalesce(coalesce(col7#6L, col7#6L, col7#6L), col7#6L, col7#6L) = col7#6L)) &amp;amp;&amp;amp; (coalesce(coalesce(col7#6L, col7#6L, col7#6L), col7#6L, col7#6L) &amp;lt;=&amp;gt; col7#6L)) &amp;amp;&amp;amp; (coalesce(col7#6L, coalesce(col7#6L, col7#6L, col7#6L), coalesce(col7#6L, col7#6L, col7#6L)) &amp;lt;=&amp;gt; col7#6L)) &amp;amp;&amp;amp; (coalesce(coalesce(coalesce(col7#6L, col7#6L, col7#6L), col7#6L, col7#6L), col7#6L, col7#6L) &amp;lt;=&amp;gt; coalesce(coalesce(col7#6L, col7#6L, col7#6L), col7#6L, col7#6L))) &amp;amp;&amp;amp; (coalesce(col7#6L, col7#6L, col7#6L) = coalesce(coalesce(col7#6L, col7#6L, col7#6L), col7#6L, col7#6L))) &amp;amp;&amp;amp; (coalesce(coalesce(col7#6L, col7#6L, col7#6L), coalesce(col7#6L, col7#6L, col7#6L), coalesce(col7#6L, col7#6L, col7#6L)) &amp;lt;=&amp;gt; col7#6L)) &amp;amp;&amp;amp; (coalesce(coalesce(col7#6L, col7#6L, col7#6L), coalesce(col7#6L, col7#6L, col7#6L), coalesce(col7#6L, col7#6L, col7#6L)) &amp;lt;=&amp;gt; coalesce(col7#6L, coalesce(col7#6L, col7#6L, col7#6L), coalesce(col7#6L, col7#6L, col7#6L)))) &amp;amp;&amp;amp; coalesce(coalesce(col7#6L, col7#6L, col7#6L), col7#6L, col7#6L) IN (col7#6L,col7#6L)) &amp;amp;&amp;amp; col7#6L IN (coalesce(col7#6L, coalesce(col7#6L, col7#6L, col7#6L), coalesce(col7#6L, col7#6L, col7#6L)),coalesce(col7#6L, coalesce(col7#6L, col7#6L, col7#6L), coalesce(col7#6L, col7#6L, col7#6L)))) &amp;amp;&amp;amp; coalesce(col7#6L, coalesce(col7#6L, col7#6L, col7#6L), coalesce(col7#6L, col7#6L, col7#6L)) IN (coalesce(col7#6L, col7#6L, col7#6L),coalesce(col7#6L, col7#6L, col7#6L))) &amp;amp;&amp;amp; (coalesce(coalesce(col7#6L, coalesce(col7#6L, col7#6L, col7#6L), coalesce(col7#6L, col7#6L, col7#6L)), coalesce(col7#6L, col7#6L, col7#6L), coalesce(col7#6L, col7#6L, col7#6L)) &amp;lt;=&amp;gt; coalesce(col7#6L, coalesce(col7#6L, col7#6L, col7#6L), coalesce(col7#6L, col7#6L, col7#6L)))) &amp;amp;&amp;amp; (coalesce(col7#6L, col7#6L, col7#6L) &amp;lt;=&amp;gt; coalesce(col7#6L, coalesce(col7#6L, col7#6L, col7#6L), coalesce(col7#6L, col7#6L, col7#6L)))) &amp;amp;&amp;amp; coalesce(col7#6L, col7#6L, col7#6L) IN (coalesce(coalesce(col7#6L, col7#6L, col7#6L), col7#6L, col7#6L),coalesce(coalesce(col7#6L, col7#6L, col7#6L), col7#6L, col7#6L))) &amp;amp;&amp;amp; (coalesce(col7#6L, coalesce(col7#6L, col7#6L, col7#6L), coalesce(col7#6L, col7#6L, col7#6L)) = coalesce(col7#6L, col7#6L, col7#6L))) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; Filter ((((isnotnull(int_col_1#87) &amp;amp;&amp;amp; isnotnull(int_col#85)) &amp;amp;&amp;amp; (((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; ((((((((((((((((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) IN (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint),&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)) &amp;amp;&amp;amp; (coalesce(coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)) &amp;lt;=&amp;gt; coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)))) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) &amp;lt;=&amp;gt; coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)))) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) = coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)))) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) IN (coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)),coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)))) &amp;amp;&amp;amp; coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)) IN (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint),&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint))) || &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; ((((((&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; isnull(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)) &amp;amp;&amp;amp; isnull(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) || &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; ((((((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) IN (coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)),coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint))) &amp;amp;&amp;amp; (coalesce(coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)) &amp;lt;=&amp;gt; coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)))) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) &amp;lt;=&amp;gt; coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)))) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) = coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)))) &amp;amp;&amp;amp; coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)) IN (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint),&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint))) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) IN (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint),&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint))) || isnull(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)))) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; ((((((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) IN (coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)),coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint))) &amp;amp;&amp;amp; (coalesce(coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)) &amp;lt;=&amp;gt; coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)))) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) &amp;lt;=&amp;gt; coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)))) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) = coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)))) &amp;amp;&amp;amp; coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)) IN (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint),&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint))) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) IN (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint),&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint))) || isnull(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)))) &amp;amp;&amp;amp; ((((((&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; isnull(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; isnull(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) || &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)) &amp;amp;&amp;amp; ((((((&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; isnull(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)) &amp;amp;&amp;amp; isnull(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) || isnull(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;))) &amp;amp;&amp;amp; ((((((coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)) IN (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint),&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)) &amp;amp;&amp;amp; (coalesce(coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)) &amp;lt;=&amp;gt; coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)))) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) IN (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint),&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint))) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) &amp;lt;=&amp;gt; coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)))) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) = coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)))) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint) IN (coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)),coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col_1#87 as bigint)))) || &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)) &amp;amp;&amp;amp; ((((((&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) IN (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint),&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)) &amp;amp;&amp;amp; (coalesce(coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)) &amp;lt;=&amp;gt; coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)))) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) &amp;lt;=&amp;gt; coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)))) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) = coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)))) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) IN (coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)),coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)))) &amp;amp;&amp;amp; coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)) IN (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint),&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint))) || &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)) &amp;amp;&amp;amp; ((((((coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)) IN (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint),&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)) &amp;amp;&amp;amp; (coalesce(coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)) &amp;lt;=&amp;gt; coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)))) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) IN (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint),&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint))) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) &amp;lt;=&amp;gt; coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)))) &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) = coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)))) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint) IN (coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)),coalesce(&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint), &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(int_col#85 as bigint)))) || &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15534082" author="joshrosen" created="Thu, 29 Sep 2016 21:18:11 +0000"  >&lt;p&gt;I managed to shrink to a smaller case which freezes &lt;tt&gt;explain&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sql(&quot;&quot;&quot;
    CREATE TEMPORARY VIEW table_4(float_col_1, boolean_col_2, decimal2610_col_3, boolean_col_4, timestamp_col_5, boolean_col_6, bigint_col_7, timestamp_col_8) AS VALUES
  (CAST(21.920416 AS FLOAT), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, -182.0700000000BD, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;1996-10-24 00:00:00.0&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, CAST(-993 AS BIGINT), TIMESTAMP(&lt;span class=&quot;code-quote&quot;&gt;&apos;2007-01-13 00:00:00.0&apos;&lt;/span&gt;))
&quot;&quot;&quot;)

sql(&quot;&quot;&quot;
    CREATE TEMPORARY VIEW table_2(bigint_col_1, boolean_col_2, double_col_3, double_col_4, double_col_5, varchar0164_col_6) AS VALUES
  (CAST(-374 AS BIGINT), CAST(NULL AS BOOLEAN), CAST(939.626553676 AS DOUBLE), CAST(-777.275379746 AS DOUBLE), CAST(235.613760023 AS DOUBLE), &lt;span class=&quot;code-quote&quot;&gt;&apos;86&apos;&lt;/span&gt;)
  &quot;&quot;&quot;)

sql(&quot;&quot;&quot;
    SELECT
    *
    FROM (
        SELECT
        COALESCE(t1.bigint_col_7, t2.bigint_col_7) AS int_col,
        t1.bigint_col_7,
        t2.bigint_col_7 AS int_col_1
        FROM table_4 t1
        CROSS JOIN table_4 t2
    ) t1
        INNER JOIN table_2 t2 ON (((t2.bigint_col_1) = (t1.bigint_col_7)) AND ((t2.bigint_col_1) = (t1.int_col))) AND ((t2.bigint_col_1) = (t1.int_col_1))
   &quot;&quot;&quot;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15534127" author="joshrosen" created="Thu, 29 Sep 2016 21:37:15 +0000"  >&lt;p&gt;Here&apos;s an even simpler test case:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;&quot;CREATE TEMPORARY VIEW foo(a) AS VALUES (CAST(-993 AS BIGINT))&quot;&lt;/span&gt;&quot;&quot;)

sql(&quot;&quot;&quot;
    SELECT
    *
    FROM (
        SELECT
        COALESCE(t1.a, t2.a) AS int_col,
        t1.a,
        t2.a AS b
        FROM foo t1
        CROSS JOIN foo t2
    ) t1
        INNER JOIN foo t2 ON (((t2.a) = (t1.a)) AND ((t2.a) = (t1.int_col))) AND ((t2.a) = (t1.b))
   &quot;&quot;&quot;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15535727" author="jiangxb1987" created="Fri, 30 Sep 2016 11:19:15 +0000"  >&lt;p&gt;The problem lies in function `QueryPlan.inferAdditionalConstraints`, this functions infers an set of additional constraints from given equality constraints, and it&apos;s possible to cause expressions to propagate, For instance:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;Set&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;a&lt;/span&gt; = b, &lt;span class=&quot;code-keyword&quot;&gt;a&lt;/span&gt; = &lt;span class=&quot;code-keyword&quot;&gt;c&lt;/span&gt;) =&amp;gt; b = &lt;span class=&quot;code-keyword&quot;&gt;c&lt;/span&gt;
(&lt;span class=&quot;code-keyword&quot;&gt;a&lt;/span&gt;&#12289;b&#12289;&lt;span class=&quot;code-keyword&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;are&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;all&lt;/span&gt; `&lt;span class=&quot;code-keyword&quot;&gt;Attribute&lt;/span&gt;`s.)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When c is created from an `Alias`, like `Alias(Coalesce(a, b))`, then we deduct &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;b = Alias(Coalesce(a, b))&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;, after the `PushPredicateThroughJoin` push this predicate through `Join` operator, it will appear in constraints. Such process repeated, the constraints grows larger and larger.&lt;/p&gt;

&lt;p&gt;It will be complecated to adapt the `PushPredicateThroughJoin` rule to this case, so maybe we should remove the wrongly propagated constraints in rule `InferFiltersFromConstraints`. I&apos;ll submit a PR to resolve this problem soon. Thank you!&lt;/p&gt;</comment>
                            <comment id="15536636" author="sameerag" created="Fri, 30 Sep 2016 18:22:19 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jiangxb&quot; class=&quot;user-hover&quot; rel=&quot;jiangxb&quot;&gt;jiangxb&lt;/a&gt;, we came to the same conclusion yesterday. More generally, the issue here is that the `QueryPlan.inferAdditionalConstraints` and `UnaryNode.getAliasedConstraints` can produce a non-converging set of constraints for recursive functions. So if we have 2 constraints of the form (where a is an alias):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;a = b, a = f(b, c)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Applying both these rules in the next iteration would infer:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;b = f(f(b, c), c)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and next would infer: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;b = f(f(f(b, c), c), c)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and so on...&lt;/p&gt;

&lt;p&gt;These rules aren&apos;t incorrect per se, but are obviously useless and causes problems of this kind. I think the right fix here would be to modify `UnaryNode.getAliasedConstraints` to not produce these recursive constraints. Would you like to submit a patch?&lt;/p&gt;</comment>
                            <comment id="15537815" author="jiangxb1987" created="Sat, 1 Oct 2016 03:54:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sameer&quot; class=&quot;user-hover&quot; rel=&quot;sameer&quot;&gt;sameer&lt;/a&gt;Thank you for your help! Since `UnaryNode.getAliasedConstraints` don&apos;t generate recursive constraints, I think we&apos;d better modify `QueryPlan.inferAdditionalConstraints` to avoid problems of this kind, I&apos;ve finished a naive version of this fix and will soon submit a patch. Thank you!&lt;/p&gt;</comment>
                            <comment id="15537900" author="apachespark" created="Sat, 1 Oct 2016 05:04:05 +0000"  >&lt;p&gt;User &apos;jiangxb1987&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15319&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15319&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13070965">SPARK-20700</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12830985" name="SparkSubmit-2016-09-29-1_snapshot___Users_joshrosen_Snapshots__-_YourKit_Java_Profiler_2013_build_13088_-_64-bit.png" size="308831" author="joshrosen" created="Thu, 29 Sep 2016 20:21:17 +0000"/>
                            <attachment id="12830986" name="constraints.png" size="165332" author="joshrosen" created="Thu, 29 Sep 2016 20:22:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 7 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i349v3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>