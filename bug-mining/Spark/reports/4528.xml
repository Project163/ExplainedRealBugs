<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:51:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-19488] CSV infer schema does not take into account Inf,-Inf,NaN</title>
                <link>https://issues.apache.org/jira/browse/SPARK-19488</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I observed that while loading a CSV as a dataframe, user-specified values for nanValue, positiveInf and negativeInf are disregarded when inferSchema = true. (They work if a user-specified schema is provided). However, even the spark defaults for the infinities (Inf and -Inf) do not work with inferSchema. &lt;/p&gt;

&lt;p&gt;Taking a look at the source code for the inferSchema for CSV (CSVInferSchema.scala), I found the following code snippet.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1.		&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; def tryParseDouble(field: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, options: CSVOptions): DataType = {
2.		    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((allCatch opt field.toDouble).isDefined) {
3.		      DoubleType
4.		    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
5.		      tryParseTimestamp(field, options)
6.		    }
7.		  }
8.		
9.		  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; def tryParseTimestamp(field: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, options: CSVOptions): DataType = {
10.		    &lt;span class=&quot;code-comment&quot;&gt;// This &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; infers a custom `dataFormat` is set.
&lt;/span&gt;11.		    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((allCatch opt options.timestampFormat.parse(field)).isDefined) {
12.		      TimestampType
13.		    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((allCatch opt DateTimeUtils.stringToTime(field)).isDefined) {
14.		      &lt;span class=&quot;code-comment&quot;&gt;// We keep &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; backwords competibility.
&lt;/span&gt;15.		      TimestampType
16.		    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
17.		      tryParseBoolean(field, options)
18.		    }
19.		  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Interestingly, the user-specified csv options are not at all used while determining if the field is of type double (as we can see in line 2). We can see that the options is used for timestamp type (line 11), which is why the &apos;dateFormat&apos; option does work. &lt;br/&gt;
However, when the field is NaN, it works because scala&apos;s toDouble function does convert the string NaN to the double equivalent of NaN. (I tried it using the shell):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; allCatch.opt(field.toDouble)
res12: Option[&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;] = Some(8.0942)

scala&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; field = &lt;span class=&quot;code-quote&quot;&gt;&quot;NaN&quot;&lt;/span&gt;;
field: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = NaN

scala&amp;gt; allCatch.opt(field.toDouble)
res13: Option[&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;] = Some(NaN)

scala&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; field = &lt;span class=&quot;code-quote&quot;&gt;&quot;Inf&quot;&lt;/span&gt;;
field: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = Inf

scala&amp;gt; allCatch.opt(field.toDouble)
res14: Option[&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;] = None
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Interestingly, scala does have Double equivalents of Infinity and -Infinity (but spark defaults are Inf and -Inf, which is why they don&apos;t work):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; field = &lt;span class=&quot;code-quote&quot;&gt;&quot;Infinity&quot;&lt;/span&gt;;
field: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = Infinity

scala&amp;gt; allCatch.opt(field.toDouble)
res15: Option[&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;] = Some(Infinity)

scala&amp;gt; field = &lt;span class=&quot;code-quote&quot;&gt;&quot;-Infinity&quot;&lt;/span&gt;;
field: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = -Infinity

scala&amp;gt; allCatch.opt(field.toDouble)
res16: Option[&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;] = Some(-Infinity)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The following csv, when ingested with inferSchema = true, therefore interprets the value column as a Double! (Regardless of the user-specified options)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ID,name,value,irrational,prime,real
1,e,2.7,&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
2,pi,3.14,&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
3,inf,Infinity,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
4,-inf,-Infinity,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
5,i,NaN,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment>&lt;p&gt;Windows 10, SparkShell&lt;/p&gt;</environment>
        <key id="13040883">SPARK-19488</key>
            <summary>CSV infer schema does not take into account Inf,-Inf,NaN</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="windpiger">Song Jun</assignee>
                                    <reporter username="sdalmia_asf">Shivam Dalmia</reporter>
                        <labels>
                            <label>easyfix</label>
                            <label>features</label>
                    </labels>
                <created>Tue, 7 Feb 2017 08:01:18 +0000</created>
                <updated>Wed, 8 Feb 2017 06:32:01 +0000</updated>
                            <resolved>Wed, 8 Feb 2017 06:32:01 +0000</resolved>
                                    <version>2.0.2</version>
                                    <fixVersion>2.2.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15856186" author="apachespark" created="Tue, 7 Feb 2017 15:17:04 +0000"  >&lt;p&gt;User &apos;windpiger&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/16834&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/16834&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15857492" author="cloud_fan" created="Wed, 8 Feb 2017 06:32:01 +0000"  >&lt;p&gt;Issue resolved by pull request 16834&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/16834&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/16834&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 40 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i39pfz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311620" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Shepherd</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>$iddhe$h</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>