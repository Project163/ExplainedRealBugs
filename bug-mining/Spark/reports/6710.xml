<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:07:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-29186] SubqueryAlias name value is null in Spark 2.4.3 Logical plan.</title>
                <link>https://issues.apache.org/jira/browse/SPARK-29186</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I am writing a program to analyze sql query. So I am using Spark logical plan.I am writing a program to analyze sql query. So I am using Spark logical plan.&lt;/p&gt;

&lt;p&gt;Below is the code which I am using&lt;br/&gt;
 &#160; &#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
object QueryAnalyzer
{&#160; &#160;
val LOG = LoggerFactory.getLogger(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getClass) &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;//Spark Conf&#160;
&lt;/span&gt; &#160; 
val conf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;&#160;&#160; &#160; SparkConf().setMaster(&lt;span class=&quot;code-quote&quot;&gt;&quot;local[2]&quot;&lt;/span&gt;).setAppName(&lt;span class=&quot;code-quote&quot;&gt;&quot;LocalEdlExecutor&quot;&lt;/span&gt;) &#160; &#160; 
&lt;span class=&quot;code-comment&quot;&gt;//Spark Context&#160; &#160; 
&lt;/span&gt;val sc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SparkContext(conf)

&lt;span class=&quot;code-comment&quot;&gt;//sql Context&#160; &#160; 
&lt;/span&gt;val sqlContext = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SQLContext(sc) &#160; 
&#160; 
&lt;span class=&quot;code-comment&quot;&gt;//Spark Session&#160; &#160; 
&lt;/span&gt;val sparkSession = SparkSession&#160; &#160; &#160; 
.builder()&#160; &#160; &#160; 
.appName(&lt;span class=&quot;code-quote&quot;&gt;&quot;Spark User Data&quot;&lt;/span&gt;)&#160; &#160; &#160; .config(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark.app.name&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;LocalEdl&quot;&lt;/span&gt;)&#160; &#160; &#160; .getOrCreate() &#160; &#160; 

def main(args: Array[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;])
{&#160; &#160; &#160;&#160;&#160; &#160; 
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; inputDfColumns = Map[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;,List[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;]]()&#160;
val dfSession =&#160; sparkSession.read.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;csv&quot;&lt;/span&gt;).&#160; &#160; &#160; option(&lt;span class=&quot;code-quote&quot;&gt;&quot;header&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;).&#160; &#160; &#160; option(&lt;span class=&quot;code-quote&quot;&gt;&quot;inferschema&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;).&#160; &#160; &#160; option(&lt;span class=&quot;code-quote&quot;&gt;&quot;delimiter&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;).option(&lt;span class=&quot;code-quote&quot;&gt;&quot;decoding&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;utf8&quot;&lt;/span&gt;).option(&lt;span class=&quot;code-quote&quot;&gt;&quot;multiline&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)&#160;
 &#160;&#160;&#160; &#160; 
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; oDF = dfSession.&#160; &#160; &#160; load(&lt;span class=&quot;code-quote&quot;&gt;&quot;C:\\Users\\tarun.khaneja\\data\\order.csv&quot;&lt;/span&gt;)&#160; &#160;&#160;&#160; &#160; 
println(&lt;span class=&quot;code-quote&quot;&gt;&quot;smaple data in oDF====&amp;gt;&quot;&lt;/span&gt;)
&#160; &#160; &#160; 
oDF.show()&#160; &#160; &#160;&#160; &#160; &#160; 

&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; cusDF = dfSession.&#160; &#160; &#160; &#160; load(&lt;span class=&quot;code-quote&quot;&gt;&quot;C:\\Users\\tarun.khaneja\\data\\customer.csv&quot;&lt;/span&gt;)&#160; &#160;&#160;&#160; &#160; &#160; 
println(&lt;span class=&quot;code-quote&quot;&gt;&quot;smaple data in cusDF====&amp;gt;&quot;&lt;/span&gt;)&#160; &#160; &#160; cusDF.show()&#160;
 &#160;&#160;&#160; &#160;&#160;&#160; &#160; &#160; oDF.createOrReplaceTempView(&lt;span class=&quot;code-quote&quot;&gt;&quot;orderTempView&quot;&lt;/span&gt;)&#160; &#160; &#160; cusDF.createOrReplaceTempView(&lt;span class=&quot;code-quote&quot;&gt;&quot;customerTempView&quot;&lt;/span&gt;)
&#160; &#160; &#160;&#160;&#160; &#160; &#160; 
&lt;span class=&quot;code-comment&quot;&gt;//get input columns from all dataframe&#160; &#160; &#160; 
&lt;/span&gt;
inputDfColumns += 
(&lt;span class=&quot;code-quote&quot;&gt;&quot;orderTempView&quot;&lt;/span&gt;-&amp;gt;oDF.columns.toList)&#160;
 &#160; &#160; 
inputDfColumns += 
(&lt;span class=&quot;code-quote&quot;&gt;&quot;customerTempView&quot;&lt;/span&gt;-&amp;gt;cusDF.columns.toList)&#160;
 &#160; &#160;&#160;&#160; &#160; &#160; 
val res = sqlContext.sql(&quot;&quot;&quot;select OID, max(MID+CID) as MID_new,ROW_NUMBER() OVER (&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;  &#160;
ORDER BY CID) as rn from&#160;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; (select OID_1 as OID, CID_1 as CID, OID_1+CID_1 as MID from (select min(ot.OrderID) as OID_1, ct.CustomerID as CID_1&#160;from orderTempView as ot &lt;span class=&quot;code-keyword&quot;&gt;inner&lt;/span&gt; join customerTempView as ct&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; on ot.CustomerID = ct.CustomerID group by CID_1)) group by OID,CID&quot;&quot;&quot;)

println(res.show(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;))&#160; &#160;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 

val analyzedPlan = res.queryExecution.analyzed&#160; &#160; &#160; println(analyzedPlan.prettyJson)

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
 Now problem is, with &lt;b&gt;Spark 2.2.1&lt;/b&gt;, I am getting below json. where I have SubqueryAlias which provide important information of alias name for table which we used in query, as shown below.&lt;/p&gt;

&lt;p&gt;&#160; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12981282/12981282_image-2019-09-25-12-17-53-552.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160; &#160;&lt;/p&gt;

&lt;p&gt;But with Spark 2.4, I am getting SubqueryAlias name as null. As shown below in json screenshot&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12981283/12981283_image-2019-09-25-12-21-52-136.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So, I am not sure if it is bug in Spark 2.4 because of which I am getting name as null in SubquerAlias.&lt;/p&gt;

&lt;p&gt;Or if it is not bug then how can I get relation between alias name and real table name.&lt;br/&gt;
 Any idea on this?&lt;/p&gt;</description>
                <environment>&lt;p&gt;I have tried this on AWS Glue with Spark 2.4.3&lt;/p&gt;

&lt;p&gt;and on windows 10 with 2.4.4&lt;/p&gt;

&lt;p&gt;at both of them facing same issue&lt;/p&gt;</environment>
        <key id="13257859">SPARK-29186</key>
            <summary>SubqueryAlias name value is null in Spark 2.4.3 Logical plan.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10003">Resolved</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="tarun.khaneja">Tarun Khaneja</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Sep 2019 06:51:52 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:00 +0000</updated>
                            <resolved>Mon, 30 Sep 2019 03:04:18 +0000</resolved>
                                    <version>2.4.3</version>
                                    <fixVersion>2.4.5</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16936770" author="gurwls223" created="Tue, 24 Sep 2019 13:11:21 +0000"  >&lt;p&gt;Can you reformat the description with {code} ... {code} with correct indentation? Looks impossible to read.&lt;/p&gt;</comment>
                            <comment id="16937439" author="tarun.khaneja" created="Wed, 25 Sep 2019 06:28:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt;&#160;I have added an external link of stackoverflow.. that is clean code.. you may refer to that&lt;/p&gt;</comment>
                            <comment id="16937464" author="tarun.khaneja" created="Wed, 25 Sep 2019 06:56:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt;&#160;I have cleaned the code by adding screenshot.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Please let me know if anything else is require!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12981282" name="image-2019-09-25-12-17-53-552.png" size="83095" author="tarun.khaneja" created="Wed, 25 Sep 2019 06:47:54 +0000"/>
                            <attachment id="12981283" name="image-2019-09-25-12-21-52-136.png" size="71775" author="tarun.khaneja" created="Wed, 25 Sep 2019 06:51:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://stackoverflow.com/questions/58016993/subqueryalias-is-null-in-spark-2-4-logical-plan-is-it-bug]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 7 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z06uew:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>