<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:18:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-32024] Disk usage tracker went negative in HistoryServerDiskManager</title>
                <link>https://issues.apache.org/jira/browse/SPARK-32024</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;After restart history server, we would see below error randomly.&lt;/p&gt;
&lt;h2&gt;&lt;a name=&quot;HTTPERROR500java.lang.IllegalStateException%3ADiskusagetrackerwentnegative%28now%3D%2Cdelta%3D%29&quot;&gt;&lt;/a&gt;HTTP ERROR 500 java.lang.IllegalStateException: Disk usage tracker went negative (now = -***&lt;b&gt;, delta = -&lt;/b&gt;***)&lt;/h2&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;URI:&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;/history/*******&lt;b&gt;/&lt;/b&gt;/stages/&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;STATUS:&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;500&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;MESSAGE:&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;java.lang.IllegalStateException: Disk usage tracker went negative (now = -***&lt;b&gt;, delta = -&lt;/b&gt;***)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;SERVLET:&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;org.apache.spark.deploy.history.HistoryServer$$anon$1-6ce1f601&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;CAUSED BY:&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;java.lang.IllegalStateException: Disk usage tracker went negative (now = -***&lt;b&gt;, delta = -&lt;/b&gt;***)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;h3&gt;&lt;a name=&quot;Causedby%3A&quot;&gt;&lt;/a&gt;Caused by:&lt;/h3&gt;

&lt;p&gt;java.lang.IllegalStateException: Disk usage tracker went negative (now = -633925, delta = -38947) at org.apache.spark.deploy.history.HistoryServerDiskManager.org$apache$spark$deploy$history$HistoryServerDiskManager$$updateUsage(HistoryServerDiskManager.scala:258) at org.apache.spark.deploy.history.HistoryServerDiskManager$Lease.rollback(HistoryServerDiskManager.scala:316) at org.apache.spark.deploy.history.FsHistoryProvider.loadDiskStore(FsHistoryProvider.scala:1192) at org.apache.spark.deploy.history.FsHistoryProvider.getAppUI(FsHistoryProvider.scala:363) at org.apache.spark.deploy.history.HistoryServer.getAppUI(HistoryServer.scala:191) at org.apache.spark.deploy.history.ApplicationCache.$anonfun$loadApplicationEntry$2(ApplicationCache.scala:163) at org.apache.spark.deploy.history.ApplicationCache.time(ApplicationCache.scala:135) at org.apache.spark.deploy.history.ApplicationCache.org$apache$spark$deploy$history$ApplicationCache$$loadApplicationEntry(ApplicationCache.scala:161) at org.apache.spark.deploy.history.ApplicationCache$$anon$1.load(ApplicationCache.scala:56) at org.apache.spark.deploy.history.ApplicationCache$$anon$1.load(ApplicationCache.scala:52) at org.sparkproject.guava.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3599) at org.sparkproject.guava.cache.LocalCache$Segment.loadSync(LocalCache.java:2379) at org.sparkproject.guava.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2342) at org.sparkproject.guava.cache.LocalCache$Segment.get(LocalCache.java:2257) at org.sparkproject.guava.cache.LocalCache.get(LocalCache.java:4000) at org.sparkproject.guava.cache.LocalCache.getOrLoad(LocalCache.java:4004) at org.sparkproject.guava.cache.LocalCache$LocalLoadingCache.get(LocalCache.java:4874) at org.apache.spark.deploy.history.ApplicationCache.get(ApplicationCache.scala:89) at org.apache.spark.deploy.history.ApplicationCache.withSparkUI(ApplicationCache.scala:101) at org.apache.spark.deploy.history.HistoryServer.org$apache$spark$deploy$history$HistoryServer$$loadAppUi(HistoryServer.scala:248) at org.apache.spark.deploy.history.HistoryServer$$anon$1.doGet(HistoryServer.scala:101) at javax.servlet.http.HttpServlet.service(HttpServlet.java:687) at javax.servlet.http.HttpServlet.service(HttpServlet.java:790) at org.sparkproject.jetty.servlet.ServletHolder.handle(ServletHolder.java:763) at org.sparkproject.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1631) at org.apache.spark.ui.HttpSecurityFilter.doFilter(HttpSecurityFilter.scala:95) at org.sparkproject.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1618) at org.sparkproject.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:549) at org.sparkproject.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233) at org.sparkproject.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1363) at org.sparkproject.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188) at org.sparkproject.jetty.servlet.ServletHandler.doScope(ServletHandler.java:489) at org.sparkproject.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186) at org.sparkproject.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1278) at org.sparkproject.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) at org.sparkproject.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:767) at org.sparkproject.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:221) at org.sparkproject.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127) at org.sparkproject.jetty.server.Server.handle(Server.java:500) at org.sparkproject.jetty.server.HttpChannel.lambda$handle$1(HttpChannel.java:383) at org.sparkproject.jetty.server.HttpChannel.dispatch(HttpChannel.java:547) at org.sparkproject.jetty.server.HttpChannel.handle(HttpChannel.java:375) at org.sparkproject.jetty.server.HttpConnection.onFillable(HttpConnection.java:273) at org.sparkproject.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:311) at org.sparkproject.jetty.io.FillInterest.fillable(FillInterest.java:103) at org.sparkproject.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:117) at org.sparkproject.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:336) at org.sparkproject.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:313) at org.sparkproject.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:171) at org.sparkproject.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:129) at org.sparkproject.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:375) at org.sparkproject.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:806) at org.sparkproject.jetty.util.thread.QueuedThreadPool$Runner.run(QueuedThreadPool.java:938) at java.lang.Thread.run(Thread.java:748)&lt;/p&gt;</description>
                <environment>&lt;p&gt;System: Windows, Linux.&lt;/p&gt;

&lt;p&gt;Config:&lt;/p&gt;

&lt;p&gt;spark.history.retainedApplications 200&lt;/p&gt;

&lt;p&gt;spark.history.store.maxDiskUsage 10g&lt;/p&gt;

&lt;p&gt;spark.history.store.path /cache_hs&lt;/p&gt;</environment>
        <key id="13312238">SPARK-32024</key>
            <summary>Disk usage tracker went negative in HistoryServerDiskManager</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zhli">Zhen Li</assignee>
                                    <reporter username="zhli">Zhen Li</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Jun 2020 13:54:57 +0000</created>
                <updated>Wed, 8 Jul 2020 23:37:22 +0000</updated>
                            <resolved>Wed, 8 Jul 2020 13:00:24 +0000</resolved>
                                    <version>2.4.4</version>
                    <version>3.0.0</version>
                    <version>3.1.0</version>
                                    <fixVersion>2.4.7</fixVersion>
                    <fixVersion>3.0.1</fixVersion>
                    <fixVersion>3.1.0</fixVersion>
                                    <component>Web UI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17139455" author="apachespark" created="Thu, 18 Jun 2020 14:22:42 +0000"  >&lt;p&gt;User &apos;zhli1142015&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28859&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28859&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17139456" author="apachespark" created="Thu, 18 Jun 2020 14:22:49 +0000"  >&lt;p&gt;User &apos;zhli1142015&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28859&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28859&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17153583" author="kabhwan" created="Wed, 8 Jul 2020 13:00:25 +0000"  >&lt;p&gt;Issue resolved by pull request 28859&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28859&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28859&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17154050" author="apachespark" created="Wed, 8 Jul 2020 22:20:42 +0000"  >&lt;p&gt;User &apos;HeartSaVioR&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29046&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29046&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17154051" author="apachespark" created="Wed, 8 Jul 2020 22:22:43 +0000"  >&lt;p&gt;User &apos;HeartSaVioR&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29046&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29046&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17154085" author="apachespark" created="Wed, 8 Jul 2020 23:30:18 +0000"  >&lt;p&gt;User &apos;HeartSaVioR&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29047&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29047&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17154086" author="apachespark" created="Wed, 8 Jul 2020 23:30:32 +0000"  >&lt;p&gt;User &apos;HeartSaVioR&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29047&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29047&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17154091" author="apachespark" created="Wed, 8 Jul 2020 23:37:05 +0000"  >&lt;p&gt;User &apos;HeartSaVioR&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29048&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29048&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17154092" author="apachespark" created="Wed, 8 Jul 2020 23:37:22 +0000"  >&lt;p&gt;User &apos;HeartSaVioR&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29048&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29048&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 18 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0fzj4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>