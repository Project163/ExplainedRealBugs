<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:17:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-32056] Repartition by key should support partition coalesce for AQE</title>
                <link>https://issues.apache.org/jira/browse/SPARK-32056</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;when adaptive query execution is enabled the following expression should support coalescing of partitions:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
dataframe.repartition(col(&lt;span class=&quot;code-quote&quot;&gt;&quot;somecolumn&quot;&lt;/span&gt;)) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;currently it does not because it simply calls the repartition implementation where number of partitions is specified:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  def repartition(partitionExprs: Column*): Dataset[T] = {
    repartition(sparkSession.sessionState.conf.numShufflePartitions, partitionExprs: _*)
  }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and repartition with the number of partitions specified does now allow for coalescing of partitions (since this breaks the user&apos;s expectation that it will have the number of partitions specified).&lt;/p&gt;

&lt;p&gt;for more context see the discussion here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/pull/27986&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/27986&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;a simple test to confirm that repartition by key does not support coalescing of partitions can be added in AdaptiveQueryExecSuite like this (it currently fails):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  test(&lt;span class=&quot;code-quote&quot;&gt;&quot;SPARK-32056 repartition has less partitions &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; small data when adaptiveExecutionEnabled&quot;&lt;/span&gt;) {
    Seq(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;).foreach { enableAQE =&amp;gt;
      withSQLConf(
        SQLConf.ADAPTIVE_EXECUTION_ENABLED.key -&amp;gt; enableAQE.toString,
        SQLConf.SHUFFLE_PARTITIONS.key -&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;50&quot;&lt;/span&gt;,
        SQLConf.COALESCE_PARTITIONS_INITIAL_PARTITION_NUM.key -&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;50&quot;&lt;/span&gt;,
        SQLConf.SHUFFLE_PARTITIONS.key -&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;50&quot;&lt;/span&gt;) {
        val partitionsNum = (1 to 10).toDF.repartition($&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;)
          .rdd.collectPartitions().length
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (enableAQE) {
          &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;(partitionsNum &amp;lt; 50)
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
          &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;(partitionsNum === 50)
        }
      }
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;spark release 3.0.0&lt;/p&gt;</environment>
        <key id="13312897">SPARK-32056</key>
            <summary>Repartition by key should support partition coalesce for AQE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="koert">koert kuipers</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Jun 2020 19:37:20 +0000</created>
                <updated>Sat, 23 Oct 2021 06:14:00 +0000</updated>
                            <resolved>Mon, 29 Jun 2020 11:33:59 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17142570" author="apachespark" created="Tue, 23 Jun 2020 02:56:11 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28900&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28900&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17142571" author="apachespark" created="Tue, 23 Jun 2020 02:57:11 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28900&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28900&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17147701" author="cloud_fan" created="Mon, 29 Jun 2020 11:33:59 +0000"  >&lt;p&gt;Issue resolved by pull request 28900&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28900&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28900&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17148218" author="apachespark" created="Tue, 30 Jun 2020 00:05:44 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28952&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28952&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17148219" author="apachespark" created="Tue, 30 Jun 2020 00:06:14 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28952&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28952&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13293226">SPARK-31220</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 20 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0g3lk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>