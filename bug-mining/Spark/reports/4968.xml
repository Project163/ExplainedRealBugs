<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:54:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-3577] Add task metric to report spill time</title>
                <link>https://issues.apache.org/jira/browse/SPARK-3577</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The &lt;tt&gt;ExternalSorter&lt;/tt&gt; passes its own &lt;tt&gt;ShuffleWriteMetrics&lt;/tt&gt; into &lt;tt&gt;ExternalSorter&lt;/tt&gt;.  The write time recorded in those metrics is never used.  We should probably add task metrics to report this spill time, since for shuffles, this would have previously been reported as part of shuffle write time (with the original hash-based sorter).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12742308">SPARK-3577</key>
            <summary>Add task metric to report spill time</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sitalkedia@gmail.com">Sital Kedia</assignee>
                                    <reporter username="kayousterhout">Kay Ousterhout</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Sep 2014 22:59:58 +0000</created>
                <updated>Thu, 29 Jun 2017 06:27:09 +0000</updated>
                            <resolved>Thu, 29 Jun 2017 06:26:56 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>Shuffle</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>4</votes>
                                    <watches>23</watches>
                                                                                                                <comments>
                            <comment id="14138245" author="sandyr" created="Thu, 18 Sep 2014 00:08:47 +0000"  >&lt;p&gt;On it&lt;/p&gt;</comment>
                            <comment id="14138334" author="sandyr" created="Thu, 18 Sep 2014 01:17:27 +0000"  >&lt;p&gt;Have you noticed the incorrect metrics reported or is this just something you noticed in the code?  My understanding is that my patch maintained the existing behavior of not including the time it spent spilling bytes for ExternalSorter in the shuffle write time.  Are you saying we should in fact include the time we spent spilling in the shuffle write time?&lt;/p&gt;</comment>
                            <comment id="14138346" author="kayousterhout" created="Thu, 18 Sep 2014 01:24:40 +0000"  >&lt;p&gt;I noticed it in the code when I was trying to fix a different problem.  I&lt;br/&gt;
thought in the old code, the disk writer grabbed the shuffle metrics object&lt;br/&gt;
from the TaskContext, so the time would be included?&lt;/p&gt;

</comment>
                            <comment id="14138354" author="sandyr" created="Thu, 18 Sep 2014 01:33:59 +0000"  >&lt;p&gt;In the old code, the ShuffleWriteMetrics didn&apos;t get passed into the disk writer.  The disk writer would track the bytes it wrote itself and how long it took to write them and these would be used to create the shuffle metrics.  ExternalSorter didn&apos;t interact with ShuffleWriteMetrics at all.  With the change, ExternalSorter creates a ShuffleWriteMetrics because it&apos;s now what&apos;s used to find how many bytes were written from the disk writer.  It might make sense to rename ShuffleWriteMetrics to something like WriteMetrics or DiskWriteMetrics, though I think this was discussed and rejected in the initial patch.&lt;/p&gt;</comment>
                            <comment id="14138375" author="kayousterhout" created="Thu, 18 Sep 2014 01:46:10 +0000"  >&lt;p&gt;Yeah sorry you&apos;re totally right &amp;#8211; sorry for looking at this too quickly!!  I wonder if we should just add a new metric in task metrics for the time spent spilling data &amp;#8211; since as you said, it seems maybe non-intuitive to report this as part of the shuffle write metrics.  I&apos;ve updated the JIRA.  Thanks for looking at this!!&lt;/p&gt;</comment>
                            <comment id="14142524" author="sandyr" created="Sun, 21 Sep 2014 17:41:56 +0000"  >&lt;p&gt;No problem.  Yeah, I agree that a spill time metric would be useful.&lt;/p&gt;</comment>
                            <comment id="14144412" author="apachespark" created="Tue, 23 Sep 2014 06:05:34 +0000"  >&lt;p&gt;User &apos;sryza&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2504&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2504&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14578240" author="mammothcm" created="Tue, 9 Jun 2015 03:09:47 +0000"  >&lt;p&gt;Why have not the metric been added? I think this is rather important, for that it may affect the results of the research work on this :  &lt;a href=&quot;https://kayousterhout.github.io/trace-analysis/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://kayousterhout.github.io/trace-analysis/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14628646" author="thubregtsen" created="Wed, 15 Jul 2015 20:13:37 +0000"  >&lt;p&gt;I could also use this metric&lt;/p&gt;</comment>
                            <comment id="15417916" author="tzachz" created="Thu, 11 Aug 2016 20:54:34 +0000"  >&lt;p&gt;Does this mean that currently, spill time will be displayed as part of the &lt;b&gt;Scheduler Delay&lt;/b&gt;? &lt;br/&gt;
Scheduler Delay is calculated pretty much as &quot;everything that isn&apos;t specifically measured&quot; (see &lt;a href=&quot;https://github.com/apache/spark/blob/v2.0.0/core/src/main/scala/org/apache/spark/ui/jobs/StagePage.scala#L770&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;StagePage.getSchedulerDelay&lt;/a&gt;), so I&apos;m wondering if indeed it might include  spill time if it&apos;s not included anywhere else. &lt;/p&gt;

&lt;p&gt;If so - this might explain long Scheduler Delay values which would be hard to make sense of otherwise (which I think is what I&apos;m seeing...).&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="15417929" author="kayousterhout" created="Thu, 11 Aug 2016 21:00:34 +0000"  >&lt;p&gt;I believe spill time will currently be displayed as part of the task runtime, but not as part of scheduler delay.&lt;/p&gt;

&lt;p&gt;The scheduler delay is calculated by looking at the difference between two values:&lt;/p&gt;

&lt;p&gt;(1) The time that the task was running on the executor&lt;br/&gt;
(2) The time from when the scheduler sent information about the task to the executor (so the executor could run the task) until the scheduler received a message that the task completed.&lt;/p&gt;

&lt;p&gt;Scheduler delay is (2) - (1).  Usually when it&apos;s high, it&apos;s because of queueing delays in the scheduler that are either delaying the task getting sent to the executor (e.g., because the scheduler has a long queue of other tasks that need to be launched, or because tasks are large so take a while to send over the network) or that are delaying the task completion message getting back to the scheduler (which can happen when the rate of task launch is high &amp;#8211; greater than 1K or so task launches / second).&lt;/p&gt;</comment>
                            <comment id="15562925" author="dreamworks007" created="Mon, 10 Oct 2016 17:35:53 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kayousterhout&quot; class=&quot;user-hover&quot; rel=&quot;kayousterhout&quot;&gt;kayousterhout&lt;/a&gt;, &lt;/p&gt;

&lt;p&gt;Just want to make sure that this JIRA is still relevant, right ?  Is there any changes to the requirement ?&lt;/p&gt;

&lt;p&gt;I am currently working on this one, so just want to make sure.&lt;/p&gt;

&lt;p&gt;Thanks !&lt;/p&gt;</comment>
                            <comment id="15562938" author="rxin" created="Mon, 10 Oct 2016 17:39:39 +0000"  >&lt;p&gt;This is still relevant.&lt;/p&gt;</comment>
                            <comment id="15562945" author="rxin" created="Mon, 10 Oct 2016 17:41:13 +0000"  >&lt;p&gt;Actually instead of tracking spill time, it&apos;s more important to first report spill data size.&lt;/p&gt;</comment>
                            <comment id="15563038" author="dreamworks007" created="Mon, 10 Oct 2016 18:16:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rxin&quot; class=&quot;user-hover&quot; rel=&quot;rxin&quot;&gt;rxin&lt;/a&gt; I find that the spill size metrics is already added  in &lt;a href=&quot;https://github.com/apache/spark/commit/bb8098f203e61111faddf2e1a04b03d62037e6c7#diff-1bd3dc38f6306e0a822f93d62c32b1d0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/bb8098f203e61111faddf2e1a04b03d62037e6c7#diff-1bd3dc38f6306e0a822f93d62c32b1d0&lt;/a&gt;, and I have confirm in the UI. (please refer to the attachment of this JIRA - &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12832515/spill_size.jpg&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12832515/spill_size.jpg&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Also, we noticed that it&apos;s wield that the spill size is somehow not reported in the reducer , but reported in the mapper.&lt;/p&gt;

&lt;p&gt;Back to the previous question, for the spill time, if it&apos;s still relevant to add, then I plan to work on it if there is no objections. &lt;/p&gt;</comment>
                            <comment id="15564472" author="rxin" created="Tue, 11 Oct 2016 04:59:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dreamworks007&quot; class=&quot;user-hover&quot; rel=&quot;dreamworks007&quot;&gt;dreamworks007&lt;/a&gt; can you take a look at the problem here? &lt;a href=&quot;https://github.com/apache/spark/pull/15347&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15347&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15947669" author="sitalkedia@gmail.com" created="Wed, 29 Mar 2017 18:38:15 +0000"  >&lt;p&gt;I am making a change to report correct spill data size on disk. &lt;/p&gt;</comment>
                            <comment id="15947678" author="apachespark" created="Wed, 29 Mar 2017 18:47:04 +0000"  >&lt;p&gt;User &apos;sitalkedia&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17471&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17471&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16067830" author="cloud_fan" created="Thu, 29 Jun 2017 06:26:56 +0000"  >&lt;p&gt;Issue resolved by pull request 17471&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17471&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17471&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12827867">SPARK-7413</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12735818">SPARK-3172</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12832515" name="spill_size.jpg" size="176619" author="dreamworks007" created="Mon, 10 Oct 2016 18:14:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 20 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i206of:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>