<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:48:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-17853] Kafka OffsetOutOfRangeException on DStreams union from separate Kafka clusters with identical topic names.</title>
                <link>https://issues.apache.org/jira/browse/SPARK-17853</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;During migration from Spark 1.6 to 2.0 I observed OffsetOutOfRangeException  reported by Kafka client. In our scenario we create single DStream as a union of multiple DStreams. One DStream for one Kafka cluster (multi dc solution). Both Kafka clusters have the same topics and number of partitions.&lt;/p&gt;

&lt;p&gt;After quick investigation, I found that class DirectKafkaInputDStream keeps offset state for topic and partitions, but it is not aware of different Kafka clusters. &lt;/p&gt;

&lt;p&gt;For every topic, single DStream is created as a union from all configured Kafka clusters.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;KafkaDStreamSource(configs: Iterable[Map[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;]]) {
def createSource(ssc: StreamingContext, topic: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;): DStream[(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Array[&lt;span class=&quot;code-object&quot;&gt;Byte&lt;/span&gt;])] = {
    val streams = configs.map { config =&amp;gt;
      val kafkaParams = config
      val kafkaTopics = Set(topic)

      KafkaUtils.
          createDirectStream[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Array[&lt;span class=&quot;code-object&quot;&gt;Byte&lt;/span&gt;]](
        ssc,
        LocationStrategies.PreferConsistent,
        ConsumerStrategies.Subscribe[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Array[&lt;span class=&quot;code-object&quot;&gt;Byte&lt;/span&gt;]](kafkaTopics, kafkaParams)
      ).map { record =&amp;gt;
        (record.key, record.value)
      }
    }

    ssc.union(streams.toSeq)
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At the end, offsets from one Kafka cluster overwrite offsets from second one. Fortunately OffsetOutOfRangeException was thrown because offsets in both Kafka clusters are significantly different.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13011015">SPARK-17853</key>
            <summary>Kafka OffsetOutOfRangeException on DStreams union from separate Kafka clusters with identical topic names.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="koeninger">Cody Koeninger</assignee>
                                    <reporter username="marcin.kuthan">Marcin Kuthan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Oct 2016 12:30:00 +0000</created>
                <updated>Wed, 12 Oct 2016 07:39:52 +0000</updated>
                            <resolved>Wed, 12 Oct 2016 07:39:50 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.2</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>DStreams</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15565278" author="cody@koeninger.org" created="Tue, 11 Oct 2016 12:22:00 +0000"  >&lt;p&gt;Which version of DStream are you using, 0-10 or 0-8?&lt;br/&gt;
Are you using the same group id for both streams?&lt;/p&gt;</comment>
                            <comment id="15565307" author="pguzik" created="Tue, 11 Oct 2016 12:37:21 +0000"  >&lt;p&gt;Hi. We are using version 0-10. We are also using the same group id for both streams.&lt;/p&gt;</comment>
                            <comment id="15565400" author="cody@koeninger.org" created="Tue, 11 Oct 2016 13:24:40 +0000"  >&lt;p&gt;Use a different group id.&lt;/p&gt;

&lt;p&gt;Let me know if that addresses the issue.&lt;/p&gt;

</comment>
                            <comment id="15565448" author="oleki" created="Tue, 11 Oct 2016 13:47:49 +0000"  >&lt;p&gt;Setting different group ids solved the issue.&lt;/p&gt;</comment>
                            <comment id="15565559" author="cody@koeninger.org" created="Tue, 11 Oct 2016 14:23:41 +0000"  >&lt;p&gt;Good, will keep this ticket open at least until documentation is made&lt;br/&gt;
clearer.&lt;/p&gt;

&lt;p&gt;On Oct 11, 2016 8:48 AM, &quot;Aleksander Ihnatowicz (JIRA)&quot; &amp;lt;jira@apache.org&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="15567199" author="apachespark" created="Wed, 12 Oct 2016 01:23:04 +0000"  >&lt;p&gt;User &apos;koeninger&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15442&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15442&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34o2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>