<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:32:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-42034] QueryExecutionListener and Observation API, df.observe do not work with `foreach` action.</title>
                <link>https://issues.apache.org/jira/browse/SPARK-42034</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Observation API,&#160;&lt;tt&gt;observe&lt;/tt&gt; dataframe transformation, and custom QueryExecutionListener.&lt;br/&gt;
Do not work with &lt;tt&gt;foreach&lt;/tt&gt;&#160;or&#160;&lt;tt&gt;foreachPartition actions.&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;This is due to }}QueryExecutionListener functions do not trigger on queries whose action is {{foreach&lt;/tt&gt;&#160;or&#160;&lt;tt&gt;foreachPartition&lt;/tt&gt;.&lt;br/&gt;
But the Spark GUI SQL tab sees this query as SQL query and shows its query plans and etc.&lt;/p&gt;


&lt;p&gt;here is the code to reproduce it:&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/GrigorievNick/e7cf9ec5584b417d9719e2812722e6d3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/GrigorievNick/e7cf9ec5584b417d9719e2812722e6d3&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;I test it locally and on YARN in cluster mode.&lt;br/&gt;
Spark 3.3.1 and 3.2.2 and 3.1.1.&lt;br/&gt;
Yarn 2.9.2 and 3.2.1.&lt;/p&gt;</environment>
        <key id="13517904">SPARK-42034</key>
            <summary>QueryExecutionListener and Observation API, df.observe do not work with `foreach` action.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Zing">zzzzming95</assignee>
                                    <reporter username="hryhoriev.nick">Nick Hryhoriev</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>sql-api</label>
                    </labels>
                <created>Thu, 12 Jan 2023 17:28:10 +0000</created>
                <updated>Tue, 10 Oct 2023 03:23:04 +0000</updated>
                            <resolved>Mon, 13 Feb 2023 05:10:11 +0000</resolved>
                                    <version>3.1.3</version>
                    <version>3.2.2</version>
                    <version>3.3.1</version>
                                    <fixVersion>3.5.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17680411" author="gurwls223" created="Wed, 25 Jan 2023 00:53:08 +0000"  >&lt;p&gt;I think the action has to be triggered by using `withAction` in the codes.&lt;/p&gt;</comment>
                            <comment id="17680412" author="gurwls223" created="Wed, 25 Jan 2023 00:53:23 +0000"  >&lt;p&gt;please go ahead a PR if you&apos;re interested in doing that!&lt;/p&gt;</comment>
                            <comment id="17686612" author="zing" created="Thu, 9 Feb 2023 15:47:30 +0000"  >&lt;p&gt;I am interested in this pr, if no one else is in development I will fix this issue&lt;/p&gt;</comment>
                            <comment id="17686807" author="gurwls223" created="Thu, 9 Feb 2023 23:57:24 +0000"  >&lt;p&gt;please go ahead&lt;/p&gt;</comment>
                            <comment id="17686914" author="hryhoriev.nick" created="Fri, 10 Feb 2023 07:36:13 +0000"  >&lt;p&gt;I can do PR, but I need someone to target me to some doc or piece of code to understand how this part of spark works.&lt;br/&gt;
Do there any documentation or at least a diagram to show spark-sql architecture?&lt;br/&gt;
I really do not understand how rdd execution is linked to SQL query listeners.&lt;/p&gt;</comment>
                            <comment id="17687465" author="apachespark" created="Sat, 11 Feb 2023 17:33:51 +0000"  >&lt;p&gt;User &apos;zzzzming95&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/39976&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/39976&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17687730" author="gurwls223" created="Mon, 13 Feb 2023 05:10:11 +0000"  >&lt;p&gt;Issue resolved by pull request 39976&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/39976&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/39976&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>scala</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ers0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>