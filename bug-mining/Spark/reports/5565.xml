<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:58:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-23377] Bucketizer with multiple columns persistence bug</title>
                <link>https://issues.apache.org/jira/browse/SPARK-23377</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;A Bucketizer with multiple input/output columns get &quot;inputCol&quot; set to the default value on write -&amp;gt; read which causes it to throw an error on transform. Here&apos;s an example.&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.ml.feature._

val splits = Array(&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;.NegativeInfinity, 0, 10, 100, &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;.PositiveInfinity)
val bucketizer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Bucketizer()
  .setSplitsArray(Array(splits, splits))
  .setInputCols(Array(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;foo2&quot;&lt;/span&gt;))
  .setOutputCols(Array(&lt;span class=&quot;code-quote&quot;&gt;&quot;bar1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;bar2&quot;&lt;/span&gt;))

val data = Seq((1.0, 2.0), (10.0, 100.0), (101.0, -1.0)).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;foo2&quot;&lt;/span&gt;)
bucketizer.transform(data)

val path = &lt;span class=&quot;code-quote&quot;&gt;&quot;/temp/bucketrizer-persist-test&quot;&lt;/span&gt;
bucketizer.write.overwrite.save(path)
val bucketizerAfterRead = Bucketizer.read.load(path)
println(bucketizerAfterRead.isDefined(bucketizerAfterRead.outputCol))
&lt;span class=&quot;code-comment&quot;&gt;// This line &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; an error because &lt;span class=&quot;code-quote&quot;&gt;&quot;outputCol&quot;&lt;/span&gt; is set
&lt;/span&gt;bucketizerAfterRead.transform(data)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the trace:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.IllegalArgumentException: Bucketizer bucketizer_6f0acc3341f7 has the inputCols Param set &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; multi-column transform. The following Params are not applicable and should not be set: outputCol.
	at org.apache.spark.ml.param.ParamValidators$.checkExclusiveParams$1(params.scala:300)
	at org.apache.spark.ml.param.ParamValidators$.checkSingleVsMultiColumnParams(params.scala:314)
	at org.apache.spark.ml.feature.Bucketizer.transformSchema(Bucketizer.scala:189)
	at org.apache.spark.ml.feature.Bucketizer.transform(Bucketizer.scala:141)
	at line251821108a8a433da484ee31f166c83725.$read$$iw$$iw$$iw$$iw$$iw$$iw.&amp;lt;init&amp;gt;(command-6079631:17)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="13137575">SPARK-23377</key>
            <summary>Bucketizer with multiple columns persistence bug</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="bago.amirbekian">Bago Amirbekian</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Feb 2018 23:11:51 +0000</created>
                <updated>Tue, 20 Feb 2018 20:50:16 +0000</updated>
                            <resolved>Thu, 15 Feb 2018 19:24:04 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                    <fixVersion>2.4.0</fixVersion>
                                    <component>ML</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16359340" author="apachespark" created="Sat, 10 Feb 2018 09:17:04 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/20566&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20566&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16361154" author="josephkb" created="Mon, 12 Feb 2018 17:47:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt;&apos;s patch currently changes DefaultParamsWriter to save only the explicitly set Param values.  This means that loading a model into a new version of Spark could use different Param values if the default values have changed.&lt;/p&gt;

&lt;p&gt;In the original design of persistence (see &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-6725&quot; title=&quot;Model export/import for Pipeline API (Scala)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-6725&quot;&gt;&lt;del&gt;SPARK-6725&lt;/del&gt;&lt;/a&gt;), the goal was to make behavior exactly reproducible.  This means that default Param values do need to be saved.  I recommend that we maintain this guarantee.&lt;/p&gt;

&lt;p&gt;I can see a couple of possibilities:&lt;br/&gt;
1. Simplest: Change the loading logic of Bucketizer so that it handles this edge case (by removing the value for inputCol when inputCols is set).  This may be best for Spark 2.3 since it&apos;s the fastest fix.&lt;br/&gt;
2. Reasonable: Change the saving logic of Bucketizer to handle this case.  This will be best in terms of fixing the edge case and being pretty quick to do.&lt;br/&gt;
3. Largest: Change DefaultParamsWriter to separate explicitly set values and default values.  Then update Bucketizer&apos;s loading logic to make use of this distinction.  I&apos;m not a fan of this approach since it would involve shoving a huge change into branch-2.3 during late QA.&lt;/p&gt;

&lt;p&gt;I&apos;d vote strongly for the 2nd option now, and perhaps the 3rd option later on.  Opinions?&lt;/p&gt;</comment>
                            <comment id="16361718" author="viirya" created="Tue, 13 Feb 2018 02:11:17 +0000"  >&lt;p&gt;I have no objection to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=josephkb&quot; class=&quot;user-hover&quot; rel=&quot;josephkb&quot;&gt;josephkb&lt;/a&gt;&apos;s proposal (first 2nd and later 3rd).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The considering design is we should keep the default values of original Spark when saving the model, or use the default values of the Spark when loading the model. To keep the default values of original Spark, can make the behavior of the saved models reproducible. However, I have in mind that the behavior between loaded models and models created with current Spark can be different. E.g., The model &quot;foo&quot; from 2.1 with default value as &quot;a&quot; can reproducible behavior when loading back into 2.3. But it behaves differently with the same &quot;foo&quot; model created in 2.3 if the default value is changed to &quot;b&quot;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In other words, one is to keep the model behavior consistent before and after persistence even across Spark versions. Another one is to let the same kind of models has consistent behavior even they are coming from different Spark versions.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Current my patch follows the later one. I think the user should notice the change of default values in upgraded Spark, if they want to use old models. Btw, I also think of a rare but possible situation is, if we remove the default value from old version, the old models may not be easily loaded into new Spark.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16361724" author="viirya" created="Tue, 13 Feb 2018 02:21:42 +0000"  >&lt;p&gt;For now, I think neither 3rd option or my current patch can be easily going into 2.3 because they are both not small change. So I also support to have the fixing of 2nd option first as a quick fix in 2.3. If no objection, I will prepare the fixing as a PR soon.&lt;/p&gt;</comment>
                            <comment id="16361824" author="josephkb" created="Tue, 13 Feb 2018 04:59:55 +0000"  >&lt;p&gt;Thanks for reconsidering here &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt;!  I can help get the PR merged when ready.&lt;/p&gt;</comment>
                            <comment id="16361830" author="apachespark" created="Tue, 13 Feb 2018 05:09:05 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/20594&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20594&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16362182" author="mlnick" created="Tue, 13 Feb 2018 11:46:30 +0000"  >&lt;p&gt;Should this be a blocker for 2.3? I think so since it should really be fixed before release.&lt;/p&gt;</comment>
                            <comment id="16363367" author="viirya" created="Wed, 14 Feb 2018 01:58:05 +0000"  >&lt;p&gt;I agree with what &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mlnick&quot; class=&quot;user-hover&quot; rel=&quot;mlnick&quot;&gt;mlnick&lt;/a&gt; said.&lt;/p&gt;</comment>
                            <comment id="16366153" author="josephkb" created="Thu, 15 Feb 2018 19:24:04 +0000"  >&lt;p&gt;Resolved in master and branch-2.3 with &lt;a href=&quot;https://github.com/apache/spark/pull/20594&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20594&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13139219">SPARK-23455</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3q0t3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>