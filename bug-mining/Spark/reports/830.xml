<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:18:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-3731] RDD caching stops working in pyspark after some time</title>
                <link>https://issues.apache.org/jira/browse/SPARK-3731</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Consider a file F which when loaded with sc.textFile and cached takes up slightly more than half of free memory for RDD cache.&lt;/p&gt;

&lt;p&gt;When in PySpark the following is executed:&lt;br/&gt;
  1) a = sc.textFile(F)&lt;br/&gt;
  2) a.cache().count()&lt;br/&gt;
  3) b = sc.textFile(F)&lt;br/&gt;
  4) b.cache().count()&lt;br/&gt;
and then the following is repeated (for example 10 times):&lt;br/&gt;
  a) a.unpersist().cache().count()&lt;br/&gt;
  b) b.unpersist().cache().count()&lt;br/&gt;
after some time, there are no RDD cached in memory.&lt;/p&gt;

&lt;p&gt;Also, since that time, no other RDD ever gets cached (the worker always reports something like &quot;WARN CacheManager: Not enough space to cache partition rdd_23_5 in memory! Free memory is 277478190 bytes.&quot;, even if rdd_23_5 is ~50MB). The Executors tab of the Application Detail UI shows that all executors have 0MB memory used (which is consistent with the CacheManager warning).&lt;/p&gt;

&lt;p&gt;When doing the same in scala, everything works perfectly.&lt;/p&gt;

&lt;p&gt;I understand that this is a vague description, but I do no know how to describe the problem better.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux, 32bit, both in local mode or in standalone cluster mode&lt;/p&gt;</environment>
        <key id="12744773">SPARK-3731</key>
            <summary>RDD caching stops working in pyspark after some time</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davies">Davies Liu</assignee>
                                    <reporter username="straka">Milan Straka</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Sep 2014 20:03:10 +0000</created>
                <updated>Tue, 7 Oct 2014 20:09:05 +0000</updated>
                            <resolved>Tue, 7 Oct 2014 20:09:05 +0000</resolved>
                                    <version>1.0.2</version>
                    <version>1.1.0</version>
                    <version>1.2.0</version>
                                    <fixVersion>1.1.1</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                                    <component>PySpark</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14152188" author="straka" created="Mon, 29 Sep 2014 20:09:07 +0000"  >&lt;p&gt;Sample worker.log showing the problem. For example, consider rdd_1_1. It has size 46.3MB. At the beginning, the caching work, but that stops &amp;#8211; the last time rdd_1_1 does not fit into cache, the following is reported:&lt;br/&gt;
&lt;tt&gt;14/09/29 21:53:10 WARN CacheManager: Not enough space to cache partition rdd_1_1 in memory! Free memory is 148908945 bytes.&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="14155844" author="pwendell" created="Thu, 2 Oct 2014 00:11:59 +0000"  >&lt;p&gt;Thanks for reporting this - can you reproduce by any chance in local mode with a dataset you can attach to the JIRA? That makes it much easier for us to track down.&lt;/p&gt;</comment>
                            <comment id="14156125" author="straka" created="Thu, 2 Oct 2014 06:18:33 +0000"  >&lt;p&gt;I will get to it later today and attach a dataset and program which exhibit this behaviour locally. I believe I will find it because I saw this behaviour in many local runs.&lt;/p&gt;</comment>
                            <comment id="14156174" author="straka" created="Thu, 2 Oct 2014 07:29:34 +0000"  >&lt;p&gt;I have attached reproducible program, input file and log from the local run. You have to uncompress the input file before executing. I have used unmodified spark-1.1.0-bin-hadoop2.4.tgz.&lt;/p&gt;

&lt;p&gt;Before the for loop, 3 out of 4 partitions are cached. After first iteration of the for loop, only 2 are cached, after second iteration only 1 and after third iteration 0 partitions are cached.&lt;/p&gt;

&lt;p&gt;I believe this behaviour is not dependent on StorageLevel used, I am using MEMORY_ONLY for the cached partitions to be big even on easily compresible file, but I have encountered the issue when using MEMORY_ONLY_SER.&lt;/p&gt;

&lt;p&gt;I also believe that this behaviour is triggered only when some RDD partition does &lt;em&gt;not&lt;/em&gt; fit into memory. Before that happens, caching and uncaching work as expected.&lt;/p&gt;

&lt;p&gt;An equivalent scala program seems to be working fine.&lt;/p&gt;</comment>
                            <comment id="14160002" author="pwendell" created="Mon, 6 Oct 2014 04:47:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davies&quot; class=&quot;user-hover&quot; rel=&quot;davies&quot;&gt;davies&lt;/a&gt; any chance you can take a look at this?&lt;/p&gt;</comment>
                            <comment id="14160037" author="apachespark" created="Mon, 6 Oct 2014 06:10:32 +0000"  >&lt;p&gt;User &apos;davies&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2668&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2668&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14162441" author="joshrosen" created="Tue, 7 Oct 2014 20:09:05 +0000"  >&lt;p&gt;Fixed by Davies&apos; PR, which I backported to 1.1.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12672509" name="spark-3731.log" size="25436" author="straka" created="Thu, 2 Oct 2014 07:20:50 +0000"/>
                            <attachment id="12672507" name="spark-3731.py" size="256" author="straka" created="Thu, 2 Oct 2014 07:20:32 +0000"/>
                            <attachment id="12672508" name="spark-3731.txt.bz2" size="204" author="straka" created="Thu, 2 Oct 2014 07:20:42 +0000"/>
                            <attachment id="12671861" name="worker.log" size="86268" author="straka" created="Mon, 29 Sep 2014 20:09:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20lrj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327368">1.1.1</customfieldvalue>
    <customfieldvalue id="12327369">1.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>