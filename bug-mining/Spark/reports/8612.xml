<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:30:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-39743] Unable to set zstd compression level while writing parquet files</title>
                <link>https://issues.apache.org/jira/browse/SPARK-39743</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;While writing zstd compressed parquet files, the following setting `spark.io.compression.zstd.level` does not have any affect with regards to the compression level of zstd.&lt;/p&gt;

&lt;p&gt;All files seem to be written with the default zstd compression level, and the config option seems to be ignored.&lt;/p&gt;

&lt;p&gt;Using the zstd cli tool, we confirmed that setting a higher compression level for the same file tested in spark resulted in a smaller file.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13470972">SPARK-39743</key>
            <summary>Unable to set zstd compression level while writing parquet files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Zing">zzzzming95</assignee>
                                    <reporter username="yeachan153">Yeachan Park</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 11 Jul 2022 10:06:23 +0000</created>
                <updated>Tue, 28 May 2024 04:09:22 +0000</updated>
                            <resolved>Wed, 10 Aug 2022 19:11:08 +0000</resolved>
                                    <version>3.2.0</version>
                                    <fixVersion>3.4.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17565923" author="zing" created="Tue, 12 Jul 2022 16:27:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yeachan153&quot; class=&quot;user-hover&quot; rel=&quot;yeachan153&quot;&gt;yeachan153&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m Interested in this, could you assign it to me&#65311;&lt;/p&gt;</comment>
                            <comment id="17566077" author="gurwls223" created="Wed, 13 Jul 2022 00:22:42 +0000"  >&lt;p&gt;No need to assign somebody. you can start working on this directly&lt;/p&gt;</comment>
                            <comment id="17570434" author="apachespark" created="Sun, 24 Jul 2022 08:40:17 +0000"  >&lt;p&gt;User &apos;zzzzming95&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/37263&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/37263&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17570435" author="apachespark" created="Sun, 24 Jul 2022 08:41:17 +0000"  >&lt;p&gt;User &apos;zzzzming95&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/37263&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/37263&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17571995" author="zing" created="Wed, 27 Jul 2022 15:19:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yeachan153&quot; class=&quot;user-hover&quot; rel=&quot;yeachan153&quot;&gt;yeachan153&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;spark.io.compression.zstd.level is adapted to&#160;&lt;tt&gt;spark.io.compression.codec&lt;/tt&gt;. It only works on internal data.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If you want to set a different zstd level to write parquet files , you can set `parquet.compression.codec.zstd.level` in sparkConf, like :&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val spark = SparkSession
&#160; &#160; &#160; .builder()
&#160; &#160; &#160; .master(&lt;span class=&quot;code-quote&quot;&gt;&quot;local&quot;&lt;/span&gt;)
&#160; &#160; &#160; .appName(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark example&quot;&lt;/span&gt;)
&#160; &#160; &#160; .config(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark.sql.parquet.compression.codec&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;zstd&quot;&lt;/span&gt;)
&#160; &#160; &#160; .config(&lt;span class=&quot;code-quote&quot;&gt;&quot;parquet.compression.codec.zstd.level&quot;&lt;/span&gt;, 10)  &lt;span class=&quot;code-comment&quot;&gt;// here 
&lt;/span&gt;&#160; &#160; &#160; .getOrCreate(); 

    val csvfile = spark.read.csv(&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///home/test_data/Reviews.csv&quot;&lt;/span&gt;)
&lt;/span&gt;    csvfile.coalesce(1).write.parquet(&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///home/test_data/nn_parq_10&quot;&lt;/span&gt;)&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17572169" author="zing" created="Thu, 28 Jul 2022 00:07:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;can you mark this issue as `Resolved`.&lt;/p&gt;</comment>
                            <comment id="17572308" author="JIRAUSER288356" created="Thu, 28 Jul 2022 08:28:16 +0000"  >&lt;p&gt;OK, thanks for the clarification. Should we look at improving the documentation for this?&lt;/p&gt;

&lt;p&gt;For example, for AVRO files, we have a config option to determine the compression level in  &lt;a href=&quot;https://spark.apache.org/docs/latest/configuration.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://spark.apache.org/docs/latest/configuration.html&lt;/a&gt;, is there a reason we also don&apos;t do that for parquet? I don&apos;t see it in the config docs or the parquet files docs: &lt;a href=&quot;https://spark.apache.org/docs/latest/sql-data-sources-parquet.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://spark.apache.org/docs/latest/sql-data-sources-parquet.html&lt;/a&gt;. If we don&apos;t have it documented, should we add it or at least add a link to &lt;a href=&quot;https://github.com/apache/parquet-mr/blob/master/parquet-hadoop/README.md?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/parquet-mr/blob/master/parquet-hadoop/README.md?&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The docs also say that `spark.io.compression.zstd.level` controls the compression level for the zstd codec. Based on this, I didn&apos;t realise that this only applied to internal data. Should we make that clearer in the config docs?&lt;/p&gt;


</comment>
                            <comment id="17572546" author="zing" created="Thu, 28 Jul 2022 16:31:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yeachan153&quot; class=&quot;user-hover&quot; rel=&quot;yeachan153&quot;&gt;yeachan153&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Only some more important parameters are supported in spark, such as `avro.mapred.deflate.level`. Other less important parameters are usually not supported in spark, such as `avro.mapred.zstd.level` and `parquet.compression.codec.zstd.level`. Unless there is a special reason.&lt;/p&gt;

&lt;p&gt;In addition, the problem you mentioned does exist, and I will modify the corresponding parameter description in the document later.&lt;/p&gt;</comment>
                            <comment id="17572551" author="zing" created="Thu, 28 Jul 2022 16:39:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;As &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yeachan153&quot; class=&quot;user-hover&quot; rel=&quot;yeachan153&quot;&gt;yeachan153&lt;/a&gt;&#160; said, is it possible to add some clarification in spark docs or post external docs about some parameters that are not controlled by spark &#160;(like parquet zstd level). Not sure if this is possible as I haven&apos;t found a link to other libraries documentation in the spark doc.&lt;/p&gt;</comment>
                            <comment id="17575542" author="apachespark" created="Fri, 5 Aug 2022 03:25:04 +0000"  >&lt;p&gt;User &apos;zzzzming95&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/37416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/37416&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17578119" author="dongjoon" created="Wed, 10 Aug 2022 19:11:08 +0000"  >&lt;p&gt;Issue resolved by pull request 37416&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/37416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/37416&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17655211" author="euigeun_chung" created="Fri, 6 Jan 2023 02:31:55 +0000"  >&lt;p&gt;I&apos;m sorry to ask a question here but I couldn&apos;t find the answer on Internet.&lt;/p&gt;

&lt;p&gt;Can I set the zstd compression level for ORC?&lt;/p&gt;</comment>
                            <comment id="17655799" author="zing" created="Sun, 8 Jan 2023 15:23:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=euigeun_chung&quot; class=&quot;user-hover&quot; rel=&quot;euigeun_chung&quot;&gt;euigeun_chung&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Currently, Spark uses `airCompressor` lib to support ORC writes, and does not support setting ZSTD levels~&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/airlift/aircompressor/blob/79265477482a4594efcc87aaef92b589c6ec2277/src/main/java/io/airlift/compress/zstd/ZstdCompressor.java#L113&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/airlift/aircompressor/blob/79265477482a4594efcc87aaef92b589c6ec2277/src/main/java/io/airlift/compress/zstd/ZstdCompressor.java#L113&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 44 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z16rbs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>