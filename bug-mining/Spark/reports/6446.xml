<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:05:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-27612] Creating a DataFrame in PySpark with ArrayType produces some Rows with Arrays of None</title>
                <link>https://issues.apache.org/jira/browse/SPARK-27612</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;This seems to only affect Python 3.&lt;/p&gt;

&lt;p&gt;When creating a DataFrame with type &lt;tt&gt;ArrayType(IntegerType(), True)&lt;/tt&gt; there ends up being rows that are filled with None.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
In [1]: from pyspark.sql.types &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; ArrayType, IntegerType&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;

In [2]: df = spark.createDataFrame([[1, 2, 3, 4]] * 100, ArrayType(IntegerType(), True))&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;

In [3]: df.distinct().collect()&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;
Out[3]: [Row(value=[None, None, None, None]), Row(value=[1, 2, 3, 4])]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;From this example, it is consistently at elements 97, 98:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
In [5]: df.collect()[-5:]&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;
Out[5]: 
[Row(value=[1, 2, 3, 4]),
&#160;Row(value=[1, 2, 3, 4]),
&#160;Row(value=[None, None, None, None]),
&#160;Row(value=[None, None, None, None]),
&#160;Row(value=[1, 2, 3, 4])]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This also happens with a type of &lt;tt&gt;ArrayType(ArrayType(IntegerType(), True))&lt;/tt&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13231019">SPARK-27612</key>
            <summary>Creating a DataFrame in PySpark with ArrayType produces some Rows with Arrays of None</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gurwls223">Hyukjin Kwon</assignee>
                                    <reporter username="bryanc">Bryan Cutler</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Tue, 30 Apr 2019 23:26:33 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:44 +0000</updated>
                            <resolved>Fri, 3 May 2019 05:40:43 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>PySpark</component>
                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16830945" author="mgaido" created="Wed, 1 May 2019 10:45:16 +0000"  >&lt;p&gt;I am not able to reproduce...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

____ __
 / __/__ ___ _____/ /__
 _\ \/ _ \/ _ `/ __/ &apos;_/
 /__ / .__/\_,_/_/ /_/\_\ version 3.0.0-SNAPSHOT
 /_/

Using Python version 2.7.10 (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;, Oct 6 2017 22:29:07)
SparkSession available as &lt;span class=&quot;code-quote&quot;&gt;&apos;spark&apos;&lt;/span&gt;.
&amp;gt;&amp;gt;&amp;gt; from pyspark.sql.types &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; ArrayType, IntegerType 
&amp;gt;&amp;gt;&amp;gt; df = spark.createDataFrame([[1, 2, 3, 4]] * 100, ArrayType(IntegerType(), True)) 
&amp;gt;&amp;gt;&amp;gt; df.distinct().collect() 
[Row(value=[1, 2, 3, 4])] 
&amp;gt;&amp;gt;&amp;gt;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16831092" author="bryanc" created="Wed, 1 May 2019 16:04:21 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgaido&quot; class=&quot;user-hover&quot; rel=&quot;mgaido&quot;&gt;mgaido&lt;/a&gt;, it seems like the problem does not happen for me with Python 2, so only my Python 3 environments. Would you be able to check with Python 3?&lt;/p&gt;</comment>
                            <comment id="16831097" author="mgaido" created="Wed, 1 May 2019 16:10:47 +0000"  >&lt;p&gt;I don&apos;t have a python3 env, sorry...&lt;/p&gt;</comment>
                            <comment id="16831098" author="bryanc" created="Wed, 1 May 2019 16:10:55 +0000"  >&lt;p&gt;Also cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt;, this is a little strange.. I hope I&apos;m not crazy&lt;/p&gt;</comment>
                            <comment id="16831596" author="gurwls223" created="Thu, 2 May 2019 12:48:47 +0000"  >&lt;p&gt;haha, you&apos;re not crazy&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Welcome to
      ____              __
     / __/__  ___ _____/ /__
    _\ \/ _ \/ _ `/ __/  &apos;_/
   /__ / .__/\_,_/_/ /_/\_\   version 3.0.0-SNAPSHOT
      /_/

Using Python version 3.7.3 (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;, Mar 27 2019 09:23:15)
SparkSession available as &lt;span class=&quot;code-quote&quot;&gt;&apos;spark&apos;&lt;/span&gt;.
&amp;gt;&amp;gt;&amp;gt; from pyspark.sql.types &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; ArrayType, IntegerType
&amp;gt;&amp;gt;&amp;gt; df = spark.createDataFrame([[1, 2, 3, 4]] * 100, ArrayType(IntegerType(), True))
&amp;gt;&amp;gt;&amp;gt; df.distinct().collect()
[Row(value=[None, None]), Row(value=[1, 2, 3, 4])]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16831600" author="viirya" created="Thu, 2 May 2019 12:54:09 +0000"  >&lt;p&gt;Yup, I can reproduce it too. No worry &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanc&quot; class=&quot;user-hover&quot; rel=&quot;bryanc&quot;&gt;bryanc&lt;/a&gt;. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Will take some time to look into it.&lt;/p&gt;
</comment>
                            <comment id="16831602" author="gurwls223" created="Thu, 2 May 2019 12:57:10 +0000"  >&lt;p&gt;Argh, seems to be a regression.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;gt;&amp;gt;&amp;gt; from pyspark.sql.types &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; ArrayType, IntegerType
&amp;gt;&amp;gt;&amp;gt; df = spark.createDataFrame([[1, 2, 3, 4]] * 100, ArrayType(IntegerType(), True))
&amp;gt;&amp;gt;&amp;gt; df.distinct().collect()

[Row(value=[1, 2, 3, 4])]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Doesn&apos;t happen in Spark 2.4.1 and Spark 2.3.3&lt;/p&gt;</comment>
                            <comment id="16831623" author="gurwls223" created="Thu, 2 May 2019 13:33:26 +0000"  >&lt;p&gt;Argh, this happens after we upgraded the cloudpickle to 0.6.2 &lt;a href=&quot;https://github.com/apache/spark/commit/75ea89ad94ca76646e4697cf98c78d14c6e2695f#diff-19fd865e0dd0d7e6b04b3b1e047dcda7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/75ea89ad94ca76646e4697cf98c78d14c6e2695f#diff-19fd865e0dd0d7e6b04b3b1e047dcda7&lt;/a&gt;&lt;br/&gt;
Upgrading cloudpickle to 0.8.1 still doesn&apos;t solve the problem .. I think we should fix it in cloudpickle, I made a cloudpickle release and we port that change into Spark.&lt;/p&gt;</comment>
                            <comment id="16831680" author="viirya" created="Thu, 2 May 2019 15:01:13 +0000"  >&lt;p&gt;yeah, seems the issue is happened when python object gets pickled...&lt;/p&gt;</comment>
                            <comment id="16832265" author="gurwls223" created="Fri, 3 May 2019 05:40:43 +0000"  >&lt;p&gt;Issue resolved by pull request 24519&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/24519&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/24519&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17023481" author="dongjoon" created="Sat, 25 Jan 2020 09:45:38 +0000"  >&lt;p&gt;I also did double-check that this is not required in branch-2.4 still.&lt;br/&gt;
To distinguish this from the other correctness issue, I set `Target Version` as `3.0.0`.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13016070">SPARK-18161</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13231471">SPARK-27629</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 42 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z02als:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12339177">3.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>