<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:33:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-10856] SQL Server dialect needs to map java.sql.Timestamp to DATETIME instead of TIMESTAMP</title>
                <link>https://issues.apache.org/jira/browse/SPARK-10856</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When saving a DataFrame to MS SQL Server, en error is thrown if there is more than one TIMESTAMP column:&lt;/p&gt;

&lt;p&gt;df.printSchema&lt;/p&gt;

&lt;p&gt;root&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;#8211; Id: string (nullable = false)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;#8211; TypeInformation_CreatedBy: string (nullable = false)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;#8211; TypeInformation_ModifiedBy: string (nullable = true)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;#8211; TypeInformation_TypeStatus: integer (nullable = false)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;#8211; TypeInformation_CreatedAtDatabase: timestamp (nullable = false)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;#8211; TypeInformation_ModifiedAtDatabase: timestamp (nullable = true)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;df.write.mode(&quot;overwrite&quot;).jdbc(url, tablename, props)&lt;/p&gt;

&lt;p&gt;com.microsoft.sqlserver.jdbc.SQLServerException: A table can only have one timestamp column. Because table &apos;DebtorTypeSet1&apos; already has one, the column &apos;TypeInformation_ModifiedAtDatabase&apos; cannot be added.&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError&lt;br/&gt;
(SQLServerException.java:217)&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServ&lt;br/&gt;
erStatement.java:1635)&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.doExecutePrep&lt;br/&gt;
aredStatement(SQLServerPreparedStatement.java:426)&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement$PrepStmtExecC&lt;br/&gt;
md.doExecute(SQLServerPreparedStatement.java:372)&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:6276)&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLSe&lt;br/&gt;
rverConnection.java:1793)&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLSer&lt;br/&gt;
verStatement.java:184)&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLS&lt;br/&gt;
erverStatement.java:159)&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.executeUpdate&lt;br/&gt;
(SQLServerPreparedStatement.java:315)&lt;/p&gt;

&lt;p&gt;I tested this on Windows and SQL Server 12 using Spark 1.4.1.&lt;/p&gt;

&lt;p&gt;I think this can be fixed in a similar way to Spark-10419.&lt;/p&gt;

&lt;p&gt;As a refererence, here is the type mapping according to the SQL Server JDBC driver (basicDT.java, extracted from sqljdbc_4.2.6420.100_enu.exe):&lt;/p&gt;

&lt;p&gt;   private static void displayRow(String title, ResultSet rs) {&lt;br/&gt;
      try {&lt;br/&gt;
         System.out.println(title);&lt;br/&gt;
         System.out.println(rs.getInt(1) + &quot; , &quot; +  		// SQL integer type.&lt;br/&gt;
               rs.getString(2) + &quot; , &quot; +            		// SQL char type.&lt;br/&gt;
               rs.getString(3) + &quot; , &quot; +            		// SQL varchar type.&lt;br/&gt;
               rs.getBoolean(4) + &quot; , &quot; +           		// SQL bit type.&lt;br/&gt;
               rs.getDouble(5) + &quot; , &quot; +            		// SQL decimal type.&lt;br/&gt;
               rs.getDouble(6) + &quot; , &quot; +            		// SQL money type.&lt;br/&gt;
               rs.getTimestamp(7) + &quot; , &quot; +        		// SQL datetime type.&lt;br/&gt;
               rs.getDate(8) + &quot; , &quot; +              		// SQL date type.&lt;br/&gt;
               rs.getTime(9) + &quot; , &quot; +              		// SQL time type.&lt;br/&gt;
               rs.getTimestamp(10) + &quot; , &quot; +            	// SQL datetime2 type.&lt;br/&gt;
               ((SQLServerResultSet)rs).getDateTimeOffset(11)); // SQL datetimeoffset type. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12901078">SPARK-10856</key>
            <summary>SQL Server dialect needs to map java.sql.Timestamp to DATETIME instead of TIMESTAMP</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="henrikbehrens">Henrik Behrens</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Mon, 28 Sep 2015 17:24:11 +0000</created>
                <updated>Thu, 21 Feb 2019 20:05:06 +0000</updated>
                            <resolved>Wed, 7 Oct 2015 21:49:20 +0000</resolved>
                                    <version>1.4.0</version>
                    <version>1.4.1</version>
                    <version>1.5.0</version>
                                    <fixVersion>1.6.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14943017" author="apachespark" created="Mon, 5 Oct 2015 07:48:08 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/8978&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/8978&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14944786" author="henrikbehrens" created="Tue, 6 Oct 2015 09:30:43 +0000"  >&lt;p&gt;Thank you for creating a pull request, I did it the same way at my site. &lt;/p&gt;

&lt;p&gt;In the mean time, I found two other types that need a special mapping for MS SQL Server:&lt;/p&gt;

&lt;p&gt;1. java.sql.types.BIT needs to be mapped to BIT instead of BIT&lt;span class=&quot;error&quot;&gt;&amp;#91;n&amp;#93;&lt;/span&gt;, otherwise we get the following error message with Spark:&lt;/p&gt;

&lt;p&gt;com.microsoft.sqlserver.jdbc.SQLServerException: Column, parameter, or variable&lt;br/&gt;
#10: Cannot specify a column width on data type bit.&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError&lt;br/&gt;
(SQLServerException.java:217)&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServ&lt;br/&gt;
erStatement.java:1635)&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.doExecutePrep&lt;br/&gt;
aredStatement(SQLServerPreparedStatement.java:426)&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement$PrepStmtExecC&lt;br/&gt;
md.doExecute(SQLServerPreparedStatement.java:372)&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:6276)&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLSe&lt;br/&gt;
rverConnection.java:1793)&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLSer&lt;br/&gt;
verStatement.java:184)&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLS&lt;br/&gt;
erverStatement.java:159)&lt;br/&gt;
        at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.executeUpdate&lt;br/&gt;
(SQLServerPreparedStatement.java:315)&lt;br/&gt;
        at org.apache.spark.sql.DataFrameWriter.jdbc(DataFrameWriter.scala:277)&lt;/p&gt;

&lt;p&gt;2. Strings of unlimited length should be mapped to NVARCHAR(MAX) in SQL Server instead of TEXT, because TEXT is deprecated (see &lt;a href=&quot;https://msdn.microsoft.com/en-us/library/ms187993.aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://msdn.microsoft.com/en-us/library/ms187993.aspx&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;I tested the following patch successfully:&lt;/p&gt;

&lt;p&gt;  override def getJDBCType(dt: DataType): Option&lt;span class=&quot;error&quot;&gt;&amp;#91;JdbcType&amp;#93;&lt;/span&gt; = dt match &lt;/p&gt;
{
    case TimestampType =&amp;gt; Some(JdbcType(&quot;DATETIME&quot;, java.sql.Types.TIMESTAMP))
    case StringType =&amp;gt; Some(JdbcType(&quot;NVARCHAR(MAX)&quot;, java.sql.Types.NVARCHAR))
    case BooleanType =&amp;gt; Some(JdbcType(&quot;BIT&quot;, java.sql.Types.BIT))
    case _ =&amp;gt; None
  }

&lt;p&gt;Please consider including the other two changes into your pull request. I you prefer, I can create two new bug reports.&lt;/p&gt;</comment>
                            <comment id="16378904" author="gmichalopoulos@gmail.com" created="Tue, 27 Feb 2018 16:42:10 +0000"  >&lt;p&gt;I am facing an issue with one of the datatypes (bit) suggested by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=henrikbehrens&quot; class=&quot;user-hover&quot; rel=&quot;henrikbehrens&quot;&gt;henrikbehrens&lt;/a&gt; for patching.&#160; Was this addressed in another bug?&#160; I am using Spark 2.1.1.&lt;/p&gt;</comment>
                            <comment id="16774473" author="srinivas_gade" created="Thu, 21 Feb 2019 20:05:06 +0000"  >&lt;p&gt;I see similar issue with the datatype (bit), can someone confirm whether this has been addressed. I am using the Spark 2.1.1&lt;/p&gt;

&lt;p&gt;Below is the&#160;error message:&lt;/p&gt;

&lt;p&gt;java.sql.SQLException: Column, parameter, or variable #5: Cannot specify a column width on data type bit.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 38 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2md7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>