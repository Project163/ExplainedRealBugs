diff --git a/sql/core/src/main/scala/org/apache/spark/sql/execution/metric/CustomMetrics.scala b/sql/core/src/main/scala/org/apache/spark/sql/execution/metric/CustomMetrics.scala
index 222a7056318..e0138b9948b 100644
--- a/sql/core/src/main/scala/org/apache/spark/sql/execution/metric/CustomMetrics.scala
+++ b/sql/core/src/main/scala/org/apache/spark/sql/execution/metric/CustomMetrics.scala
@@ -29,7 +29,7 @@ object CustomMetrics {
    * `CustomMetric`.
    */
   def buildV2CustomMetricTypeName(customMetric: CustomMetric): String = {
-    s"${V2_CUSTOM}_${customMetric.getClass.getCanonicalName}"
+    s"${V2_CUSTOM}_${customMetric.getClass.getName}"
   }
 
   /**
diff --git a/sql/core/src/test/scala/org/apache/spark/sql/execution/ui/SQLAppStatusListenerSuite.scala b/sql/core/src/test/scala/org/apache/spark/sql/execution/ui/SQLAppStatusListenerSuite.scala
index bcb5892c50c..e776a4ac23f 100644
--- a/sql/core/src/test/scala/org/apache/spark/sql/execution/ui/SQLAppStatusListenerSuite.scala
+++ b/sql/core/src/test/scala/org/apache/spark/sql/execution/ui/SQLAppStatusListenerSuite.scala
@@ -854,9 +854,12 @@ class SQLAppStatusListenerSuite extends SharedSparkSession with JsonTestUtils
     val metrics = statusStore.executionMetrics(execId)
     val expectedMetric = physicalPlan.metrics("custom_metric")
     val expectedValue = "custom_metric: 12345, 12345"
-
+    val innerMetric = physicalPlan.metrics("inner_metric")
+    val expectedInnerValue = "inner_metric: 54321, 54321"
     assert(metrics.contains(expectedMetric.id))
     assert(metrics(expectedMetric.id) === expectedValue)
+    assert(metrics.contains(innerMetric.id))
+    assert(metrics(innerMetric.id) === expectedInnerValue)
   }
 
   test("SPARK-36030: Report metrics from Datasource v2 write") {
@@ -882,7 +885,9 @@ class SQLAppStatusListenerSuite extends SharedSparkSession with JsonTestUtils
       val execId = statusStore.executionsList().last.executionId
       val metrics = statusStore.executionMetrics(execId)
       val customMetric = metrics.find(_._2 == "custom_metric: 12345, 12345")
+      val innerMetric = metrics.find(_._2 == "inner_metric: 54321, 54321")
       assert(customMetric.isDefined)
+      assert(innerMetric.isDefined)
     }
   }
 }
@@ -960,6 +965,16 @@ class SQLAppStatusListenerMemoryLeakSuite extends SparkFunSuite {
   }
 }
 
+object Outer {
+  class InnerCustomMetric extends CustomMetric {
+    override def name(): String = "inner_metric"
+    override def description(): String = "a simple custom metric in an inner class"
+    override def aggregateTaskMetrics(taskMetrics: Array[Long]): String = {
+      s"inner_metric: ${taskMetrics.mkString(", ")}"
+    }
+  }
+}
+
 class SimpleCustomMetric extends CustomMetric {
   override def name(): String = "custom_metric"
   override def description(): String = "a simple custom metric"
@@ -989,7 +1004,11 @@ object CustomMetricReaderFactory extends PartitionReaderFactory {
           override def name(): String = "custom_metric"
           override def value(): Long = 12345
         }
-        Array(metric)
+        val innerMetric = new CustomTaskMetric {
+          override def name(): String = "inner_metric"
+          override def value(): Long = 54321;
+        }
+        Array(metric, innerMetric)
       }
     }
   }
@@ -1001,7 +1020,7 @@ class CustomMetricScanBuilder extends SimpleScanBuilder {
   }
 
   override def supportedCustomMetrics(): Array[CustomMetric] = {
-    Array(new SimpleCustomMetric)
+    Array(new SimpleCustomMetric, new Outer.InnerCustomMetric)
   }
 
   override def createReaderFactory(): PartitionReaderFactory = CustomMetricReaderFactory
@@ -1013,7 +1032,11 @@ class CustomMetricsCSVDataWriter(fs: FileSystem, file: Path) extends CSVDataWrit
       override def name(): String = "custom_metric"
       override def value(): Long = 12345
     }
-    Array(metric)
+    val innerMetric = new CustomTaskMetric {
+      override def name(): String = "inner_metric"
+      override def value(): Long = 54321;
+    }
+    Array(metric, innerMetric)
   }
 }
 
@@ -1055,7 +1078,7 @@ class CustomMetricsDataSource extends SimpleWritableDataSource {
         }
 
         override def supportedCustomMetrics(): Array[CustomMetric] = {
-          Array(new SimpleCustomMetric)
+          Array(new SimpleCustomMetric, new Outer.InnerCustomMetric)
         }
       }
     }
