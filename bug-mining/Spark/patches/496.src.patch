diff --git a/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/analysis/Analyzer.scala b/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/analysis/Analyzer.scala
index 02bdb64f308..74c0104e5b1 100644
--- a/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/analysis/Analyzer.scala
+++ b/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/analysis/Analyzer.scala
@@ -159,7 +159,7 @@ class Analyzer(catalog: Catalog, registry: FunctionRegistry, caseSensitive: Bool
   object UnresolvedHavingClauseAttributes extends Rule[LogicalPlan] {
     def apply(plan: LogicalPlan): LogicalPlan = plan transformUp {
       case filter @ Filter(havingCondition, aggregate @ Aggregate(_, originalAggExprs, _)) 
-          if !filter.resolved && aggregate.resolved && containsAggregate(havingCondition) => {
+          if aggregate.resolved && containsAggregate(havingCondition) => {
         val evaluatedCondition = Alias(havingCondition,  "havingCondition")()
         val aggExprsWithHaving = evaluatedCondition +: originalAggExprs
         
diff --git a/sql/hive/src/test/resources/golden/having no references-0-d2de3ba23759d25ef77cdfbab72cbb63 b/sql/hive/src/test/resources/golden/having no references-0-d2de3ba23759d25ef77cdfbab72cbb63
new file mode 100644
index 00000000000..3f2cab688cc
--- /dev/null
+++ b/sql/hive/src/test/resources/golden/having no references-0-d2de3ba23759d25ef77cdfbab72cbb63	
@@ -0,0 +1,136 @@
+0
+5
+12
+15
+18
+24
+26
+35
+37
+42
+51
+58
+67
+70
+72
+76
+83
+84
+90
+95
+97
+98
+100
+103
+104
+113
+118
+119
+120
+125
+128
+129
+134
+137
+138
+146
+149
+152
+164
+165
+167
+169
+172
+174
+175
+176
+179
+187
+191
+193
+195
+197
+199
+200
+203
+205
+207
+208
+209
+213
+216
+217
+219
+221
+223
+224
+229
+230
+233
+237
+238
+239
+242
+255
+256
+265
+272
+273
+277
+278
+280
+281
+282
+288
+298
+307
+309
+311
+316
+317
+318
+321
+322
+325
+327
+331
+333
+342
+344
+348
+353
+367
+369
+382
+384
+395
+396
+397
+399
+401
+403
+404
+406
+409
+413
+414
+417
+424
+429
+430
+431
+438
+439
+454
+458
+459
+462
+463
+466
+468
+469
+478
+480
+489
+492
+498
diff --git a/sql/hive/src/test/scala/org/apache/spark/sql/hive/execution/HiveQuerySuite.scala b/sql/hive/src/test/scala/org/apache/spark/sql/hive/execution/HiveQuerySuite.scala
index 50f85289fda..aadfd2e9001 100644
--- a/sql/hive/src/test/scala/org/apache/spark/sql/hive/execution/HiveQuerySuite.scala
+++ b/sql/hive/src/test/scala/org/apache/spark/sql/hive/execution/HiveQuerySuite.scala
@@ -30,6 +30,9 @@ case class TestData(a: Int, b: String)
  */
 class HiveQuerySuite extends HiveComparisonTest {
 
+  createQueryTest("having no references",
+    "SELECT key FROM src GROUP BY key HAVING COUNT(*) > 1")
+
   createQueryTest("boolean = number",
     """
       |SELECT
