diff --git a/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/analysis/Analyzer.scala b/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/analysis/Analyzer.scala
index f30c22c2566..bcedceee6e7 100644
--- a/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/analysis/Analyzer.scala
+++ b/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/analysis/Analyzer.scala
@@ -4218,13 +4218,14 @@ object UpdateOuterReferences extends Rule[LogicalPlan] {
   private def updateOuterReferenceInSubquery(
       plan: LogicalPlan,
       refExprs: Seq[Expression]): LogicalPlan = {
-    plan resolveExpressions { case e =>
-      val outerAlias =
-        refExprs.find(stripAlias(_).semanticEquals(stripOuterReference(e)))
-      outerAlias match {
-        case Some(a: Alias) => OuterReference(a.toAttribute)
-        case _ => e
-      }
+    plan resolveExpressions {
+      case e if e.containsPattern(OUTER_REFERENCE) =>
+        val outerAlias =
+          refExprs.find(stripAlias(_).semanticEquals(stripOuterReference(e)))
+        outerAlias match {
+          case Some(a: Alias) => OuterReference(a.toAttribute)
+          case _ => e
+        }
     }
   }
 
diff --git a/sql/core/src/test/resources/sql-tests/analyzer-results/subquery/scalar-subquery/scalar-subquery-predicate.sql.out b/sql/core/src/test/resources/sql-tests/analyzer-results/subquery/scalar-subquery/scalar-subquery-predicate.sql.out
index 0414782fb7e..8765e590a8d 100644
--- a/sql/core/src/test/resources/sql-tests/analyzer-results/subquery/scalar-subquery/scalar-subquery-predicate.sql.out
+++ b/sql/core/src/test/resources/sql-tests/analyzer-results/subquery/scalar-subquery/scalar-subquery-predicate.sql.out
@@ -1766,3 +1766,27 @@ Project [t0a#x, t0b#x]
       +- View (`t0`, [t0a#x, t0b#x])
          +- Project [cast(col1#x as int) AS t0a#x, cast(col2#x as int) AS t0b#x]
             +- LocalRelation [col1#x, col2#x]
+
+
+-- !query
+SELECT MAX(a.col1)
+FROM VALUES (1) AS a(col1)
+GROUP BY a.col1
+HAVING COUNT(*) = (
+        SELECT COUNT(*)
+        FROM VALUES (1),(1),(2),(2) AS c(col1)
+        WHERE c.col1 >= a.col1
+        LIMIT 1
+    )
+-- !query analysis
+Project [max(col1)#x]
++- Filter (count(1)#xL = scalar-subquery#x [col1#x])
+   :  +- GlobalLimit 1
+   :     +- LocalLimit 1
+   :        +- Aggregate [count(1) AS count(1)#xL]
+   :           +- Filter (col1#x >= outer(col1#x))
+   :              +- SubqueryAlias c
+   :                 +- LocalRelation [col1#x]
+   +- Aggregate [col1#x], [max(col1#x) AS max(col1)#x, count(1) AS count(1)#xL, col1#x]
+      +- SubqueryAlias a
+         +- LocalRelation [col1#x]
diff --git a/sql/core/src/test/resources/sql-tests/inputs/subquery/scalar-subquery/scalar-subquery-predicate.sql b/sql/core/src/test/resources/sql-tests/inputs/subquery/scalar-subquery/scalar-subquery-predicate.sql
index 81e0c5f98d8..640ed52cff4 100644
--- a/sql/core/src/test/resources/sql-tests/inputs/subquery/scalar-subquery/scalar-subquery-predicate.sql
+++ b/sql/core/src/test/resources/sql-tests/inputs/subquery/scalar-subquery/scalar-subquery-predicate.sql
@@ -532,3 +532,14 @@ WHERE (SELECT max(t2c)
 
 
 SELECT * FROM t0 WHERE t0a = (SELECT distinct(t1c) FROM t1 WHERE t1a = t0a);
+
+-- SPARK-52531: Inner aggregate expressions are properly decorrelated from outer aggregate expressions
+SELECT MAX(a.col1)
+FROM VALUES (1) AS a(col1)
+GROUP BY a.col1
+HAVING COUNT(*) = (
+        SELECT COUNT(*)
+        FROM VALUES (1),(1),(2),(2) AS c(col1)
+        WHERE c.col1 >= a.col1
+        LIMIT 1
+    );
diff --git a/sql/core/src/test/resources/sql-tests/results/subquery/scalar-subquery/scalar-subquery-predicate.sql.out b/sql/core/src/test/resources/sql-tests/results/subquery/scalar-subquery/scalar-subquery-predicate.sql.out
index 2460c2452ea..b37fe614e23 100644
--- a/sql/core/src/test/resources/sql-tests/results/subquery/scalar-subquery/scalar-subquery-predicate.sql.out
+++ b/sql/core/src/test/resources/sql-tests/results/subquery/scalar-subquery/scalar-subquery-predicate.sql.out
@@ -914,3 +914,19 @@ SELECT * FROM t0 WHERE t0a = (SELECT distinct(t1c) FROM t1 WHERE t1a = t0a)
 struct<t0a:int,t0b:int>
 -- !query output
 
+
+
+-- !query
+SELECT MAX(a.col1)
+FROM VALUES (1) AS a(col1)
+GROUP BY a.col1
+HAVING COUNT(*) = (
+        SELECT COUNT(*)
+        FROM VALUES (1),(1),(2),(2) AS c(col1)
+        WHERE c.col1 >= a.col1
+        LIMIT 1
+    )
+-- !query schema
+struct<max(col1):int>
+-- !query output
+
