diff --git a/sql/hive/src/main/scala/org/apache/spark/sql/hive/hiveUDFs.scala b/sql/hive/src/main/scala/org/apache/spark/sql/hive/hiveUDFs.scala
index 76e4085712b..d78fc9da9f8 100644
--- a/sql/hive/src/main/scala/org/apache/spark/sql/hive/hiveUDFs.scala
+++ b/sql/hive/src/main/scala/org/apache/spark/sql/hive/hiveUDFs.scala
@@ -468,13 +468,19 @@ private[hive] case class HiveUDAFFunction(
   }
 
   override def eval(buffer: HiveUDAFBuffer): Any = {
-    resultUnwrapper(finalHiveEvaluator.evaluator.terminate(buffer.buf))
+    resultUnwrapper(finalHiveEvaluator.evaluator.terminate(
+      if (buffer == null) {
+        finalHiveEvaluator.evaluator.getNewAggregationBuffer
+      } else {
+        buffer.buf
+      }
+    ))
   }
 
   override def serialize(buffer: HiveUDAFBuffer): Array[Byte] = {
     // Serializes an `AggregationBuffer` that holds partial aggregation results so that we can
     // shuffle it for global aggregation later.
-    aggBufferSerDe.serialize(buffer.buf)
+    aggBufferSerDe.serialize(if (buffer == null) null else buffer.buf)
   }
 
   override def deserialize(bytes: Array[Byte]): HiveUDAFBuffer = {
diff --git a/sql/hive/src/test/scala/org/apache/spark/sql/hive/execution/HiveUDAFSuite.scala b/sql/hive/src/test/scala/org/apache/spark/sql/hive/execution/HiveUDAFSuite.scala
index 3252cdafa1b..b0d615c1ace 100644
--- a/sql/hive/src/test/scala/org/apache/spark/sql/hive/execution/HiveUDAFSuite.scala
+++ b/sql/hive/src/test/scala/org/apache/spark/sql/hive/execution/HiveUDAFSuite.scala
@@ -149,6 +149,16 @@ class HiveUDAFSuite extends QueryTest with TestHiveSingleton with SQLTestUtils {
       }
     }
   }
+
+  test("SPARK-27907 HiveUDAF with 0 rows throws NPE") {
+    withTable("abc") {
+      sql("create table abc(a int)")
+      checkAnswer(sql("select histogram_numeric(a,2) from abc"), Row(null))
+      sql("insert into abc values (1)")
+      checkAnswer(sql("select histogram_numeric(a,2) from abc"), Row(Row(1.0, 1.0) :: Nil))
+      checkAnswer(sql("select histogram_numeric(a,2) from abc where a=3"), Row(null))
+    }
+  }
 }
 
 /**
