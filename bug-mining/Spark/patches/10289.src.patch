diff --git a/sql/core/src/test/scala/org/apache/spark/sql/AlwaysPersistedConfigsSuite.scala b/sql/core/src/test/scala/org/apache/spark/sql/AlwaysPersistedConfigsSuite.scala
index 7b141f42238..bfadf1eb188 100644
--- a/sql/core/src/test/scala/org/apache/spark/sql/AlwaysPersistedConfigsSuite.scala
+++ b/sql/core/src/test/scala/org/apache/spark/sql/AlwaysPersistedConfigsSuite.scala
@@ -17,6 +17,9 @@
 
 package org.apache.spark.sql
 
+import org.scalactic.source.Position
+import org.scalatest.Tag
+
 import org.apache.spark.SparkConf
 import org.apache.spark.sql.catalyst.TableIdentifier
 import org.apache.spark.sql.catalyst.analysis.SQLScalarFunction
@@ -38,6 +41,13 @@ import org.apache.spark.sql.types.StructType
  */
 class AlwaysPersistedConfigsSuite extends QueryTest with SharedSparkSession {
 
+  override protected def test(testName: String, testTags: Tag*)(testFun: => Any)(
+    implicit pos: Position): Unit = {
+    if (!sys.env.get("SPARK_ANSI_SQL_MODE").contains("false")) {
+      super.test(testName, testTags: _*)(testFun)
+    }
+  }
+
   protected override def sparkConf: SparkConf = {
     super.sparkConf
       .set(SQLConf.ASSUME_ANSI_FALSE_IF_NOT_PERSISTED.key, "true")
