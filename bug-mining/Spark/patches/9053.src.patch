diff --git a/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/analysis/ColumnResolutionHelper.scala b/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/analysis/ColumnResolutionHelper.scala
index c5634278490..318a23c36af 100644
--- a/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/analysis/ColumnResolutionHelper.scala
+++ b/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/analysis/ColumnResolutionHelper.scala
@@ -65,7 +65,9 @@ trait ColumnResolutionHelper extends Logging {
             (AttributeSet(newExprs) -- u.outputSet).intersect(newChild.outputSet)
           u match {
             case p: Project =>
-              (newExprs, Project(p.projectList ++ missingAttrs, newChild))
+              val newProject = Project(p.projectList ++ missingAttrs, newChild)
+              newProject.copyTagsFrom(p)
+              (newExprs, newProject)
 
             case a @ Aggregate(groupExprs, aggExprs, child) =>
               if (missingAttrs.forall(attr => groupExprs.exists(_.semanticEquals(attr)))) {
diff --git a/sql/core/src/test/resources/sql-tests/analyzer-results/using-join.sql.out b/sql/core/src/test/resources/sql-tests/analyzer-results/using-join.sql.out
index 8dc5a674897..0fe7254d734 100644
--- a/sql/core/src/test/resources/sql-tests/analyzer-results/using-join.sql.out
+++ b/sql/core/src/test/resources/sql-tests/analyzer-results/using-join.sql.out
@@ -806,3 +806,33 @@ Project [k#x, k#x]
                +- Project [k#x, v2#x]
                   +- SubqueryAlias nt2
                      +- LocalRelation [k#x, v2#x]
+
+
+-- !query
+WITH
+  t1 AS (select key from values ('a') t(key)),
+  t2 AS (select key from values ('a') t(key))
+SELECT t1.key
+FROM t1 FULL OUTER JOIN t2 USING (key)
+WHERE t1.key NOT LIKE 'bb.%'
+-- !query analysis
+WithCTE
+:- CTERelationDef xxxx, false
+:  +- SubqueryAlias t1
+:     +- Project [key#x]
+:        +- SubqueryAlias t
+:           +- LocalRelation [key#x]
+:- CTERelationDef xxxx, false
+:  +- SubqueryAlias t2
+:     +- Project [key#x]
+:        +- SubqueryAlias t
+:           +- LocalRelation [key#x]
++- Project [key#x]
+   +- Project [key#x, key#x, key#x]
+      +- Filter NOT key#x LIKE bb.%
+         +- Project [coalesce(key#x, key#x) AS key#x, key#x, key#x, key#x]
+            +- Join FullOuter, (key#x = key#x)
+               :- SubqueryAlias t1
+               :  +- CTERelationRef xxxx, true, [key#x]
+               +- SubqueryAlias t2
+                  +- CTERelationRef xxxx, true, [key#x]
diff --git a/sql/core/src/test/resources/sql-tests/inputs/using-join.sql b/sql/core/src/test/resources/sql-tests/inputs/using-join.sql
index 0c06023b14d..f2657a91910 100644
--- a/sql/core/src/test/resources/sql-tests/inputs/using-join.sql
+++ b/sql/core/src/test/resources/sql-tests/inputs/using-join.sql
@@ -86,3 +86,10 @@ SELECT nt2.k AS key FROM nt1 inner join nt2 using (k) ORDER BY key;
 SELECT k, nt1.k FROM nt1 inner join nt2 using (k);
 
 SELECT k, nt2.k FROM nt1 inner join nt2 using (k);
+
+WITH
+  t1 AS (select key from values ('a') t(key)),
+  t2 AS (select key from values ('a') t(key))
+SELECT t1.key
+FROM t1 FULL OUTER JOIN t2 USING (key)
+WHERE t1.key NOT LIKE 'bb.%';
diff --git a/sql/core/src/test/resources/sql-tests/results/using-join.sql.out b/sql/core/src/test/resources/sql-tests/results/using-join.sql.out
index 360507e727f..1e71191de87 100644
--- a/sql/core/src/test/resources/sql-tests/results/using-join.sql.out
+++ b/sql/core/src/test/resources/sql-tests/results/using-join.sql.out
@@ -432,3 +432,16 @@ struct<k:string,k:string>
 one	one
 one	one
 two	two
+
+
+-- !query
+WITH
+  t1 AS (select key from values ('a') t(key)),
+  t2 AS (select key from values ('a') t(key))
+SELECT t1.key
+FROM t1 FULL OUTER JOIN t2 USING (key)
+WHERE t1.key NOT LIKE 'bb.%'
+-- !query schema
+struct<key:string>
+-- !query output
+a
