<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:12:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[VALIDATOR-336] CUSIPCheckDigit thinks invalid CUSIP is valid</title>
                <link>https://issues.apache.org/jira/browse/VALIDATOR-336</link>
                <project id="12310494" key="VALIDATOR">Commons Validator</project>
                    <description>&lt;p&gt;When testing if a specific CUSIP is valid using org.apache.commons.validator.routines.checkdigit.CUSIPCheckDigit.CUSIP_CHECK_DIGIT.isValid, a call to this returns true when it should return false. A specific example is with the following invalid CUSIP: DUS0421CW.&lt;/p&gt;

&lt;p&gt;What seems to be happening is when toInt is called on W it turns it to an int value and then sends it to weightedValue. This is fine for the first 8 characters of a CUSIP, but not the check digit. The expected result should be to return false because the check digit is a letter (on a CUSIP a check digit must be 0-9). &lt;/p&gt;

&lt;p&gt;With the current implementation, I believe each CUSIP can have up to 4 valid check digits.&lt;/p&gt;

&lt;p&gt;A test is attached.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12726871">VALIDATOR-336</key>
            <summary>CUSIPCheckDigit thinks invalid CUSIP is valid</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="britter">Benedikt Ritter</assignee>
                                    <reporter username="jjmeyer0">Josh Meyer</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Jul 2014 20:21:55 +0000</created>
                <updated>Tue, 13 Jan 2015 20:02:24 +0000</updated>
                            <resolved>Thu, 1 Jan 2015 15:55:48 +0000</resolved>
                                    <version>1.4.0 Release</version>
                                    <fixVersion>1.4.1 Release</fixVersion>
                                    <component>Routines</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14059295" author="jjmeyer0" created="Fri, 11 Jul 2014 20:22:20 +0000"  >&lt;p&gt;Attaching tests.&lt;/p&gt;</comment>
                            <comment id="14193717" author="plindberg" created="Sun, 2 Nov 2014 05:46:14 +0000"  >&lt;p&gt;Patch to fix the issue by checking if the checkdigit is a letter, and throwing an exception if so.&lt;/p&gt;</comment>
                            <comment id="14203888" author="britter" created="Sun, 9 Nov 2014 11:37:53 +0000"  >&lt;p&gt;After applying the patch I get:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Failed tests:
  org.apache.commons.validator.ISBNValidatorTest#testIsValid AssertionFailedError
  org.apache.commons.validator.routines.checkdigit.CUSIPCheckDigitTest#testCalculateInvalid AssertionFailedError
  org.apache.commons.validator.routines.checkdigit.ISBN10CheckDigitTest#testIsValidTrue AssertionFailedError
  org.apache.commons.validator.routines.checkdigit.ISBNCheckDigitTest#testIsValidTrue AssertionFailedError
  org.apache.commons.validator.routines.ISBNValidatorTest#testIsValidISBN10 AssertionFailedError
  org.apache.commons.validator.routines.ISBNValidatorTest#testValidateISBN10 ComparisonFailure
  org.apache.commons.validator.routines.ISBNValidatorTest#testValidateISBN10Convert ComparisonFailure
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can you check?&lt;/p&gt;</comment>
                            <comment id="14205124" author="plindberg" created="Mon, 10 Nov 2014 18:30:43 +0000"  >&lt;p&gt;Benedikt:&lt;br/&gt;
Whoops!  I did not realize that ISBN is an exception to the rule that the checkdigit can not be a letter.  My fault for not running all the tests.&lt;br/&gt;
I applied the same type of fix in CUSIPCheckDigit instead of ModulusCheckDigit.  I&apos;m attaching a patch for it and also a modified version of the test that Josh Meyer originally posted.  Thanks.&lt;/p&gt;</comment>
                            <comment id="14206777" author="britter" created="Tue, 11 Nov 2014 18:36:25 +0000"  >&lt;p&gt;Hello again,&lt;/p&gt;

&lt;p&gt;I&apos;ve tried to incorporate the changes from CusipValidatorTest_v2.java into the CUSIPCheckDigitTest (see &lt;a href=&quot;https://issues.apache.org/jira/browse/VALIDATOR-336&quot; title=&quot;CUSIPCheckDigit thinks invalid CUSIP is valid&quot; class=&quot;issue-link&quot; data-issue-key=&quot;VALIDATOR-336&quot;&gt;&lt;del&gt;VALIDATOR-336&lt;/del&gt;&lt;/a&gt;.patch). Although the code &lt;tt&gt;DUS0421CW&lt;/tt&gt; is invalid, the calculate method doesn&apos;t throw an exception for it (hence the test fails). Can you check once again? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Regarding the general style of patches: Please include Apache License Headers if you add new files and use spaces for indentation (not tabs).&lt;/p&gt;

&lt;p&gt;TIA!&lt;br/&gt;
Benedikt&lt;/p&gt;</comment>
                            <comment id="14208450" author="plindberg" created="Wed, 12 Nov 2014 18:49:53 +0000"  >&lt;p&gt;Benedikt:&lt;br/&gt;
There is some weird behavior with CUSIPCheckDigitTest and/or AbstractCheckDigitTest:  Elements in CUSIPCheckDigitTest.invalid are passed to both calculate and isValid, in separate tests.  &lt;/p&gt;

&lt;p&gt;If the string contains a non-alphanumeric character, BOTH methods will throw the &quot;invalid character&quot; exception, which is actually coming from the toInt method. &lt;/p&gt;

&lt;p&gt;However, if the string represents a code with an invalid checkdigit (e.g. &lt;tt&gt;DUS0421CW&lt;/tt&gt;), only isValid throws an exception, which is expected, because calculate only determines what the checkdigit should be &amp;#8211; it does not determine correctness.&lt;/p&gt;

&lt;p&gt;Because of this behavior, &lt;tt&gt;DUS0421CW&lt;/tt&gt; will pass testIsValidFalse, but it will generate a failure for testCalculateInvalid.&lt;/p&gt;

&lt;p&gt;I believe this is a bug, and I&apos;ll submit an issue for it when I get a chance.&lt;/p&gt;

&lt;p&gt;A work-around would be to put the whole method testCheckDigitIsLetter from the CusipValidatorTest_v2.java into CUSIPCheckDigitTest, but that is a little messy, because it breaks the pattern of all the tests being in AbstractCheckDigitTest.  Thanks.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Peter&lt;/p&gt;</comment>
                            <comment id="14213935" author="sebb@apache.org" created="Sun, 16 Nov 2014 14:51:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;ISBN is an exception to the rule that the checkdigit can not be a letter.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If most other subclasses of ModulusCheckDigit only permit digits, then maybe the solution is to fix ISBN etc.?&lt;br/&gt;
Do any other algorithms incorrectly allow non-digits?&lt;/p&gt;</comment>
                            <comment id="14214219" author="plindberg" created="Mon, 17 Nov 2014 03:25:26 +0000"  >&lt;p&gt;Sebb:&lt;br/&gt;
That&apos;s a good point.  I think that ISBN is &lt;em&gt;probably&lt;/em&gt; the only code that allows the checkdigit to be a letter, but I&apos;m not completely sure.&lt;/p&gt;</comment>
                            <comment id="14216483" author="sebb@apache.org" created="Tue, 18 Nov 2014 17:41:59 +0000"  >&lt;p&gt;I agree that there are is a problem with the design of the AbstractCheckDigitTest class.&lt;/p&gt;

&lt;p&gt;The problem is that the same strings are passed both to isValid(String), which expects the check digit to be present at the end, and also to calculate(String), which generates the missing check digit. See &lt;a href=&quot;https://issues.apache.org/jira/browse/VALIDATOR-344&quot; title=&quot;AbstractCheckDigit class does not fully test invalid strings&quot; class=&quot;issue-link&quot; data-issue-key=&quot;VALIDATOR-344&quot;&gt;&lt;del&gt;VALIDATOR-344&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14216558" author="sebb@apache.org" created="Tue, 18 Nov 2014 18:33:07 +0000"  >&lt;p&gt;A further problem with CUSIP validation is that the length is not checked at all.&lt;/p&gt;

&lt;p&gt;CUSIP is supposed to be 9 characters including the check digit.&lt;br/&gt;
However, both longer and shorter strings are accepted.&lt;/p&gt;</comment>
                            <comment id="14261127" author="sebb@apache.org" created="Tue, 30 Dec 2014 14:34:40 +0000"  >&lt;p&gt;Proposed fix and unit test; disallows all but digits as the check digit&lt;/p&gt;</comment>
                            <comment id="14262580" author="britter" created="Thu, 1 Jan 2015 15:55:48 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ svn ci -m &lt;span class=&quot;code-quote&quot;&gt;&quot;VALIDATOR-336: CUSIPCheckDigit thinks invalid CUSIP is valid. Patch implemented by Sebb. Thanks to Josh Meyer and Peter Lindberg who also contributed to the fix by providing unit tests and proposing fixes.&quot;&lt;/span&gt;
Sending        RELEASE-NOTES.txt
Sending        src/changes/changes.xml
Sending        src/main/java/org/apache/commons/validator/routines/checkdigit/CUSIPCheckDigit.java
Sending        src/test/java/org/apache/commons/validator/routines/checkdigit/CUSIPCheckDigitTest.java
Transmitting file data ....
Committed revision 1648862.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thanks to all for helping to get this fixed!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12756158">VALIDATOR-344</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12680617" name="CUSIPCheckDigit.java.patch" size="1251" author="plindberg" created="Mon, 10 Nov 2014 18:32:03 +0000"/>
                            <attachment id="12655289" name="CusipValidatorTest.java" size="2117" author="jjmeyer0" created="Fri, 11 Jul 2014 20:22:20 +0000"/>
                            <attachment id="12680618" name="CusipValidatorTest_v2.java" size="968" author="plindberg" created="Mon, 10 Nov 2014 18:32:03 +0000"/>
                            <attachment id="12680830" name="VALIDATOR-336.patch" size="2225" author="britter" created="Tue, 11 Nov 2014 18:36:25 +0000"/>
                            <attachment id="12689507" name="cusip.patch" size="2295" author="sebb" created="Tue, 30 Dec 2014 14:34:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>404978</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 46 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1xp33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>405014</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>