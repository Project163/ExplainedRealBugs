<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:21:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-1949] Digest authentication is not working properly behind a proxy server</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-1949</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;I wrote a client to authenticate with a server that requires digest authentication. Everything went OK if client is connecting directly to the server.&lt;/p&gt;

&lt;p&gt;Adding a proxy server in the middle all the requests returned 401 Unauthorized.&lt;/p&gt;

&lt;p&gt;After digging a little in the httpclient code, mainly in DigestScheme, I figured that &quot;uri&quot; used to calculate the digest request is an absolute uri but the request that hits the server is an absolute path. So the server is unable to calculate the &quot;response&quot; parameter properly.&lt;/p&gt;

&lt;p&gt;I would suggest to use the uri path&#160; URI(request.getRequestLine().getUri()).getPath() instead of request.getRequestLine().getUri()&lt;/p&gt;

&lt;p&gt;&#160;&lt;b&gt;Original: DigestScheme.java&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Header authenticate(
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Credentials credentials,
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpRequest request,
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpContext context) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; AuthenticationException {

        Args.notNull(credentials, &lt;span class=&quot;code-quote&quot;&gt;&quot;Credentials&quot;&lt;/span&gt;);
        Args.notNull(request, &lt;span class=&quot;code-quote&quot;&gt;&quot;HTTP request&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (getParameter(&lt;span class=&quot;code-quote&quot;&gt;&quot;realm&quot;&lt;/span&gt;) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AuthenticationException(&lt;span class=&quot;code-quote&quot;&gt;&quot;missing realm in challenge&quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (getParameter(&lt;span class=&quot;code-quote&quot;&gt;&quot;nonce&quot;&lt;/span&gt;) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AuthenticationException(&lt;span class=&quot;code-quote&quot;&gt;&quot;missing nonce in challenge&quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-comment&quot;&gt;// Add method name and request-URI to the parameter map
&lt;/span&gt;        getParameters().put(&lt;span class=&quot;code-quote&quot;&gt;&quot;methodname&quot;&lt;/span&gt;, request.getRequestLine().getMethod());
        getParameters().put(&lt;span class=&quot;code-quote&quot;&gt;&quot;uri&quot;&lt;/span&gt;, request.getRequestLine().getUri());
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; charset = getParameter(&lt;span class=&quot;code-quote&quot;&gt;&quot;charset&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (charset == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            getParameters().put(&lt;span class=&quot;code-quote&quot;&gt;&quot;charset&quot;&lt;/span&gt;, getCredentialsCharset(request));
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; createDigestHeader(credentials, request);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Correction: DigestScheme.java&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Header authenticate(
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Credentials credentials,
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpRequest request,
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpContext context) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; AuthenticationException {

        Args.notNull(credentials, &lt;span class=&quot;code-quote&quot;&gt;&quot;Credentials&quot;&lt;/span&gt;);
        Args.notNull(request, &lt;span class=&quot;code-quote&quot;&gt;&quot;HTTP request&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (getParameter(&lt;span class=&quot;code-quote&quot;&gt;&quot;realm&quot;&lt;/span&gt;) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AuthenticationException(&lt;span class=&quot;code-quote&quot;&gt;&quot;missing realm in challenge&quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (getParameter(&lt;span class=&quot;code-quote&quot;&gt;&quot;nonce&quot;&lt;/span&gt;) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AuthenticationException(&lt;span class=&quot;code-quote&quot;&gt;&quot;missing nonce in challenge&quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-comment&quot;&gt;// Add method name and request-URI to the parameter map
&lt;/span&gt;        getParameters().put(&lt;span class=&quot;code-quote&quot;&gt;&quot;methodname&quot;&lt;/span&gt;, request.getRequestLine().getMethod());
        getParameters().put(&lt;span class=&quot;code-quote&quot;&gt;&quot;uri&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URI(request.getRequestLine().getUri()).getPath());
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; charset = getParameter(&lt;span class=&quot;code-quote&quot;&gt;&quot;charset&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (charset == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            getParameters().put(&lt;span class=&quot;code-quote&quot;&gt;&quot;charset&quot;&lt;/span&gt;, getCredentialsCharset(request));
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; createDigestHeader(credentials, request);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13194984">HTTPCLIENT-1949</key>
            <summary>Digest authentication is not working properly behind a proxy server</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="cmsr">Carlos Rodrigues</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Oct 2018 22:25:28 +0000</created>
                <updated>Tue, 30 Oct 2018 14:18:08 +0000</updated>
                            <resolved>Tue, 30 Oct 2018 10:53:20 +0000</resolved>
                                    <version>4.5.6</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16668526" author="olegk" created="Tue, 30 Oct 2018 10:53:20 +0000"  >&lt;p&gt;HttpClient is correct in using an absolute URI in the digest response while sending messages through a proxy. For details see &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1793&quot; title=&quot;Digest authentication - bad format of URI param &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-1793&quot;&gt;&lt;del&gt;HTTPCLIENT-1793&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16668601" author="cmsr" created="Tue, 30 Oct 2018 11:42:50 +0000"  >&lt;p&gt;Hi Oleg,&lt;/p&gt;

&lt;p&gt;Thanks for your answer. &lt;br/&gt;
Your absolutely right, the specification says that you should use the absolute URI. However in httpcomponents-client-5.0.x you are already using URI path to calculate the digest message:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://hc.apache.org/httpcomponents-client-5.0.x/httpclient5/xref/org/apache/hc/client5/http/impl/auth/DigestScheme.html#L219&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hc.apache.org/httpcomponents-client-5.0.x/httpclient5/xref/org/apache/hc/client5/http/impl/auth/DigestScheme.html#L219&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
219     &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; createDigestResponse(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpRequest request) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; AuthenticationException {
220 
221         &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; uri = request.getPath();
222         &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; method = request.getMethod();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Besides that, every test I made with curl using digest and proxy the &quot;uri&quot; param is the URI path.&lt;/p&gt;</comment>
                            <comment id="16668627" author="jira-bot" created="Tue, 30 Oct 2018 12:12:12 +0000"  >&lt;p&gt;Commit 3c25ca72669d893340f29c18c70cb4743cefd692 in httpcomponents-client&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=httpcomponents-client.git;h=3c25ca7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=httpcomponents-client.git;h=3c25ca7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1949&quot; title=&quot;Digest authentication is not working properly behind a proxy server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-1949&quot;&gt;&lt;del&gt;HTTPCLIENT-1949&lt;/del&gt;&lt;/a&gt;: DigestScheme to use HttpRequest#getRequestUri instead of HttpRequest#getPath&lt;/p&gt;</comment>
                            <comment id="16668630" author="olegk" created="Tue, 30 Oct 2018 12:15:56 +0000"  >&lt;p&gt;The request path will be rewritten by&#160;the&#160;&lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/master/httpclient5/src/main/java/org/apache/hc/client5/http/impl/classic/ProtocolExec.java#L128&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;protocol request interceptor&lt;/a&gt;&#160;but I changed the `DigestScheme` to use `#getRequestUri` instead of  `#getPath` for the clarity sake.&lt;/p&gt;

&lt;p&gt;As far as CURL incorrect behavior is concerned you will have to take it up with the CURL developers.&lt;/p&gt;

&lt;p&gt;Oleg  &lt;/p&gt;</comment>
                            <comment id="16668766" author="cmsr" created="Tue, 30 Oct 2018 14:18:08 +0000"  >&lt;p&gt;Thank you very much for your help and clarifications.&lt;br/&gt;
Carlos&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13026328">HTTPCLIENT-1793</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3zs0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>