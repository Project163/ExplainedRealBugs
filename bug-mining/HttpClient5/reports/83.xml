<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:22:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-2177] Unable to use HTTP Proxy with CloseableHttpAsyncClient</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-2177</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;When executing a standard GET request with a configured proxy (authenticated or not) using an instance of CloseableHttpAsyncClient, the request fails with &quot;IllegalStateException: No tunnel unless connected.&quot;&lt;/p&gt;

&lt;p&gt;Is making requests via proxies using an AsyncClient not supported? It is not entirely clear from the current release notes/examples.&lt;/p&gt;

&lt;p&gt;Minimal example to reproduce issue, although you will of course need to configure the proxy accordingly given your environment.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.concurrent.Future;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.net.ssl.SSLEngine;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.net.ssl.SSLSession;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.async.methods.SimpleHttpRequest;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.async.methods.SimpleHttpResponse;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.async.methods.SimpleRequestBuilder;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.async.methods.SimpleRequestProducer;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.async.methods.SimpleResponseConsumer;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.config.RequestConfig;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.impl.async.CloseableHttpAsyncClient;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.impl.async.HttpAsyncClients;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.impl.nio.PoolingAsyncClientConnectionManager;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.impl.nio.PoolingAsyncClientConnectionManagerBuilder;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.protocol.HttpClientContext;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.ssl.ClientTlsStrategyBuilder;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.concurrent.FutureCallback;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.function.Factory;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.http.HttpHost;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.http.message.StatusLine;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.http.nio.ssl.TlsStrategy;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.http2.HttpVersionPolicy;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.io.CloseMode;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.reactor.ssl.TlsDetails;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;AsyncMain {

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TlsStrategy tlsStrategy = ClientTlsStrategyBuilder.create()
        .useSystemProperties()
        .setTlsDetailsFactory(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Factory&amp;lt;SSLEngine, TlsDetails&amp;gt;() {
          @Override
          &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; TlsDetails create(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SSLEngine sslEngine) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TlsDetails(sslEngine.getSession(), sslEngine.getApplicationProtocol());
          }
        }).build();

    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PoolingAsyncClientConnectionManager cm = PoolingAsyncClientConnectionManagerBuilder.create()
        .setTlsStrategy(tlsStrategy)
        .build();

    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CloseableHttpAsyncClient client = HttpAsyncClients.custom()
        .setVersionPolicy(HttpVersionPolicy.NEGOTIATE)
        .setConnectionManager(cm)
        .build()) {

      client.start();

      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpClientContext clientContext = HttpClientContext.create();
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpHost target = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HttpHost(&lt;span class=&quot;code-quote&quot;&gt;&quot;https&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;nghttp2.org&quot;&lt;/span&gt;);
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpHost proxy = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HttpHost(&lt;span class=&quot;code-quote&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;, 8888);
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RequestConfig config = RequestConfig.custom().setProxy(proxy).build();
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SimpleHttpRequest request = SimpleRequestBuilder.get()
          .setHttpHost(target)
          .setRequestConfig(config)
          .setPath(&lt;span class=&quot;code-quote&quot;&gt;&quot;/httpbin/&quot;&lt;/span&gt;)
          .build();

      &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Executing request &quot;&lt;/span&gt; + request);
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Future&amp;lt;SimpleHttpResponse&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; = client.execute(
          SimpleRequestProducer.create(request),
          SimpleResponseConsumer.create(),
          clientContext,
          &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FutureCallback&amp;lt;SimpleHttpResponse&amp;gt;() {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void completed(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SimpleHttpResponse response) {
              &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(request + &lt;span class=&quot;code-quote&quot;&gt;&quot;-&amp;gt;&quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StatusLine(response));
              &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SSLSession sslSession = clientContext.getSSLSession();
              &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sslSession != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;SSL protocol &quot;&lt;/span&gt; + sslSession.getProtocol());
                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;SSL cipher suite &quot;&lt;/span&gt; + sslSession.getCipherSuite());
              }
              &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(response.getBody());
            }

            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void failed(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Exception ex) {
              &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(request + &lt;span class=&quot;code-quote&quot;&gt;&quot;-&amp;gt;&quot;&lt;/span&gt; + ex);
            }

            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void cancelled() {
              &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(request + &lt;span class=&quot;code-quote&quot;&gt;&quot; cancelled&quot;&lt;/span&gt;);
            }
          });
      &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;.get();
      &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Shutting down&quot;&lt;/span&gt;);
      client.close(CloseMode.GRACEFUL);
    }
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The resulting stack trace :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.util.concurrent.ExecutionException: java.lang.IllegalStateException: No tunnel unless connected at org.apache.hc.core5.concurrent.BasicFuture.getResult(BasicFuture.java:72) at org.apache.hc.core5.concurrent.BasicFuture.get(BasicFuture.java:85) at AsyncMain.main(AsyncMain.java:86)Caused by: java.lang.IllegalStateException: No tunnel unless connected at org.apache.hc.core5.util.Asserts.check(Asserts.java:38) at org.apache.hc.client5.http.RouteTracker.tunnelTarget(RouteTracker.java:143) at org.apache.hc.client5.http.impl.async.AsyncConnectExec$4.completed(AsyncConnectExec.java:270) at org.apache.hc.client5.http.impl.async.AsyncConnectExec$5.completed(AsyncConnectExec.java:388) at org.apache.hc.client5.http.impl.async.HttpAsyncMainClientExec$1.consumeResponse(HttpAsyncMainClientExec.java:206) at org.apache.hc.core5.http.impl.nio.ClientHttp1StreamHandler.consumeHeader(ClientHttp1StreamHandler.java:253) at org.apache.hc.core5.http.impl.nio.ClientHttp1StreamDuplexer.consumeHeader(ClientHttp1StreamDuplexer.java:348) at org.apache.hc.core5.http.impl.nio.ClientHttp1StreamDuplexer.consumeHeader(ClientHttp1StreamDuplexer.java:80)Caused by: java.lang.IllegalStateException: No tunnel unless connected
 at org.apache.hc.core5.http.impl.nio.AbstractHttp1StreamDuplexer.onInput(AbstractHttp1StreamDuplexer.java:288) at org.apache.hc.core5.http.impl.nio.AbstractHttp1IOEventHandler.inputReady(AbstractHttp1IOEventHandler.java:64) at org.apache.hc.core5.http.impl.nio.ClientHttp1IOEventHandler.inputReady(ClientHttp1IOEventHandler.java:39) at org.apache.hc.core5.reactor.InternalDataChannel.onIOEvent(InternalDataChannel.java:131) at org.apache.hc.core5.reactor.InternalChannel.handleIOEvent(InternalChannel.java:51) at org.apache.hc.core5.reactor.SingleCoreIOReactor.processEvents(SingleCoreIOReactor.java:178) at org.apache.hc.core5.reactor.SingleCoreIOReactor.doExecute(SingleCoreIOReactor.java:127) at org.apache.hc.core5.reactor.AbstractSingleCoreIOReactor.execute(AbstractSingleCoreIOReactor.java:85) at org.apache.hc.core5.reactor.IOReactorWorker.run(IOReactorWorker.java:44) at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>Windows 10.0.19041 Build 19041&lt;br/&gt;
Java 11.0.11&lt;br/&gt;
Gradle 6.8</environment>
        <key id="13401186">HTTPCLIENT-2177</key>
            <summary>Unable to use HTTP Proxy with CloseableHttpAsyncClient</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="avasilev">Andrei Vasilev</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Sep 2021 02:44:44 +0000</created>
                <updated>Sat, 18 Sep 2021 19:36:27 +0000</updated>
                            <resolved>Sat, 18 Sep 2021 08:45:20 +0000</resolved>
                                    <version>5.0</version>
                    <version>5.1</version>
                                    <fixVersion>5.1.1</fixVersion>
                    <fixVersion>5.2-alpha1</fixVersion>
                                    <component>HttpClient (async)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17415438" author="olegk" created="Wed, 15 Sep 2021 10:50:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=avasilev&quot; class=&quot;user-hover&quot; rel=&quot;avasilev&quot;&gt;avasilev&lt;/a&gt;&#160;All productive branches of HttpClient 5.x presently do not support HTTP/2 tunnelling via an HTTP/1.1 proxy. This limitation will be fixed in the coming 5.2-alpha1 (please see&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2120&quot; title=&quot;Support HTTP/2 (TLS) Tunneling over HTTP-Proxy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2120&quot;&gt;&lt;del&gt;HTTPCLIENT-2120&lt;/del&gt;&lt;/a&gt; for details). However the error message clearly look wrong. There should have been a protocol level exception instread. Could you please post a &lt;em&gt;complete&lt;/em&gt; context / wire log of the session exhibiting the problem?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://hc.apache.org/httpcomponents-client-5.1.x/logging.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hc.apache.org/httpcomponents-client-5.1.x/logging.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17415650" author="avasilev" created="Wed, 15 Sep 2021 17:21:00 +0000"  >&lt;p&gt;Hi Oleg,&lt;/p&gt;

&lt;p&gt;Thank you for responding so quickly. My apologies for not finding &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2120&quot; title=&quot;Support HTTP/2 (TLS) Tunneling over HTTP-Proxy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2120&quot;&gt;&lt;del&gt;HTTPCLIENT-2120&lt;/del&gt;&lt;/a&gt;&#160;, as it clearly answers my question.&lt;/p&gt;

&lt;p&gt;I have attached the full context/wire log as requested. Let me know if there is anything else I can do to help.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13033605/13033605_context-wire.log&quot; title=&quot;context-wire.log attached to HTTPCLIENT-2177&quot;&gt;context-wire.log&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;P.S. Any idea when 5.2-alpha1 will be released on Maven? Thanks again.&lt;/p&gt;</comment>
                            <comment id="17415655" author="olegk" created="Wed, 15 Sep 2021 17:28:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=avasilev&quot; class=&quot;user-hover&quot; rel=&quot;avasilev&quot;&gt;avasilev&lt;/a&gt; What we have is this. The proxy responds to the CONNECT request with status 200 but at the same time instructs the client to drop the connection with `Connection: close`.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;193 [httpclient-dispatch-1] DEBUG org.apache.hc.client5.http.headers  - c-0000000000 &amp;lt;&amp;lt; HTTP/1.1 200 Connection Established
194 [httpclient-dispatch-1] DEBUG org.apache.hc.client5.http.headers  - c-0000000000 &amp;lt;&amp;lt; FiddlerGateway: Direct
194 [httpclient-dispatch-1] DEBUG org.apache.hc.client5.http.headers  - c-0000000000 &amp;lt;&amp;lt; StartTime: 10:16:47.826
194 [httpclient-dispatch-1] DEBUG org.apache.hc.client5.http.headers  - c-0000000000 &amp;lt;&amp;lt; Connection: close
194 [httpclient-dispatch-1] DEBUG org.apache.hc.core5.reactor.IOSessionImpl  - c-0000000000[ACTIVE][r:r] Close GRACEFUL
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is clearly a defect in whatever proxy software you have been using. I will however make HttpClient throw a more comprehensible protocol level exception in such a case.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17415678" author="avasilev" created="Wed, 15 Sep 2021 18:24:44 +0000"  >&lt;p&gt;Oleg,&lt;/p&gt;

&lt;p&gt;After reading around, I tend to agree and I am not sure why the Connection: close header is sent. However, I tried this with 4 separate proxies / proxy providers and the behavior was the same for all of them. They were :&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Fiddler (local proxy server, only supports HTTP/1.1)&lt;/li&gt;
	&lt;li&gt;Packet Stream (paid service, supports HTTP/2)&lt;/li&gt;
	&lt;li&gt;Web Share (free tier of a paid service, supports HTTP/2)&lt;/li&gt;
	&lt;li&gt;Free-Proxy-List (free proxy, unknown support)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I suppose it could be coincidence, but is it possible something else is leading the proxy servers to be inclined to close the connection like this? My apologies but I am not well versed enough in the HTTP protocol to provide any insight myself. For what its worth, I have tested these against the OkHttp client as well, and they all worked as expected, but maybe this is irrelevant since I believe OkHttp supports HTTP/2 tunneling via HTTP/1.1 proxies.&lt;/p&gt;

&lt;p&gt;In any case, thank you for your help. It is much appreciated.&lt;/p&gt;</comment>
                            <comment id="17415709" author="olegk" created="Wed, 15 Sep 2021 19:30:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=avasilev&quot; class=&quot;user-hover&quot; rel=&quot;avasilev&quot;&gt;avasilev&lt;/a&gt;&#160;I have no idea why all these proxy servers behave this way but it is clearly wrong in my opinion. I have been using Squid &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;for years&#160;to test proxy functions in all versions of HttpClient and generally trust it to do things correctly. There is a Docker image of the test proxy server I use for our integrations tests &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;Oleg &lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://www.squid-cache.org/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.squid-cache.org/&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/master/httpclient5-testing/docker/squid/Dockerfile&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/blob/master/httpclient5-testing/docker/squid/Dockerfile&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17416011" author="jira-bot" created="Thu, 16 Sep 2021 09:41:57 +0000"  >&lt;p&gt;Commit 68b50cbac1924c4c7bc99551009e1c10c2c9748d in httpcomponents-client&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=68b50cb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=68b50cb&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt;: async clients made to ignore `Connection` directive in 200 status response to CONNECT request&lt;/p&gt;</comment>
                            <comment id="17416017" author="olegk" created="Thu, 16 Sep 2021 09:49:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=avasilev&quot; class=&quot;user-hover&quot; rel=&quot;avasilev&quot;&gt;avasilev&lt;/a&gt;&#160;To my absolute surprise and astonishment I found out that the classic HttpClient was ignoring `Connection` directives on response messages to CONNECT requests, as well as any other headers. This is not quite right but I am going to leave the final conclusion until 5.2. For now I made async HttpClient behave consistently with the classic one.&lt;/p&gt;

&lt;p&gt;Could you please test this patch &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; and let me know the outcome?&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/httpcomponents-client/tree/HTTPCLIENT-2177&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/tree/HTTPCLIENT-2177&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17416359" author="avasilev" created="Thu, 16 Sep 2021 23:27:25 +0000"  >&lt;p&gt;Oleg,&lt;/p&gt;

&lt;p&gt;My provided code sample successfully connects to the target using your patch. However, I believe this is just coincidental. The local proxy server I am using (Fiddler) is quite strange, in that it sends a Connection: close header in response to CONNECT requests, but it does not actually close the connection on its end. So since the DefaultClientConnectionReuseStrategy you provided also ignores the Connection: close header in the CONNECT response, it just happens to work.&#160;&lt;/p&gt;

&lt;p&gt;Here is the wire/context log :&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13033741/13033741_unauth-proxy-context-wire-HTTPCLIENT-2177.log&quot; title=&quot;unauth-proxy-context-wire-HTTPCLIENT-2177.log attached to HTTPCLIENT-2177&quot;&gt;unauth-proxy-context-wire-HTTPCLIENT-2177.log&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;However, I tried another authenticated proxy service, who as I described previously also sends a Connection: close header for some reason, and it does not work and results in the same error.&lt;/p&gt;

&lt;p&gt;Here are the context/wire log for that. I have redacted all credential information with **** :&#160;&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13033740/13033740_auth-proxy-context-wire-HTTPCLIENT-2177.log&quot; title=&quot;auth-proxy-context-wire-HTTPCLIENT-2177.log attached to HTTPCLIENT-2177&quot;&gt;auth-proxy-context-wire-HTTPCLIENT-2177.log&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17416605" author="olegk" created="Fri, 17 Sep 2021 10:08:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=avasilev&quot; class=&quot;user-hover&quot; rel=&quot;avasilev&quot;&gt;avasilev&lt;/a&gt;&#160;when using a sane proxy such as Squid things work as expected.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing request GET https://nghttp2.org/
2021-09-17 12:06:29,503 DEBUG ex-0000000001 preparing request execution
2021-09-17 12:06:29,512 DEBUG ex-0000000001 Cookie spec selected: strict
2021-09-17 12:06:29,517 DEBUG ex-0000000001 Auth cache not set in the context
2021-09-17 12:06:29,517 DEBUG ex-0000000001 target auth state: UNCHALLENGED
2021-09-17 12:06:29,520 DEBUG ex-0000000001 acquiring connection with route {tls}-&amp;gt;http://localhost:8889-&amp;gt;https://nghttp2.org:443
2021-09-17 12:06:29,521 DEBUG ex-0000000001 acquiring endpoint (3 MINUTES)
2021-09-17 12:06:29,523 DEBUG ex-0000000001 endpoint lease request (3 MINUTES) [route: {tls}-&amp;gt;http://localhost:8889-&amp;gt;https://nghttp2.org:443][total available: 0; route allocated: 0 of 5; total allocated: 0 of 25]
2021-09-17 12:06:29,527 DEBUG ex-0000000001 endpoint leased [route: {tls}-&amp;gt;http://localhost:8889-&amp;gt;https://nghttp2.org:443][total available: 0; route allocated: 1 of 5; total allocated: 1 of 25]
2021-09-17 12:06:29,528 DEBUG ex-0000000001 acquired ep-0000000000
2021-09-17 12:06:29,528 DEBUG ex-0000000001 acquired endpoint ep-0000000000
2021-09-17 12:06:29,529 DEBUG ep-0000000000 connecting endpoint (3 MINUTES)
2021-09-17 12:06:29,530 DEBUG ep-0000000000 connecting endpoint to http://localhost:8889 (3 MINUTES)
2021-09-17 12:06:29,531 DEBUG http://localhost:8889 resolving remote address
2021-09-17 12:06:29,532 DEBUG http://localhost:8889 resolved to [localhost/127.0.0.1]
2021-09-17 12:06:29,533 DEBUG http://localhost:8889 connecting null to localhost/127.0.0.1:8889 (3 MINUTES)
2021-09-17 12:06:29,547 DEBUG c-0000000000[ACTIVE][rc:c] protocol upgrade class org.apache.hc.core5.http2.impl.nio.ClientHttpProtocolNegotiator
2021-09-17 12:06:29,548 DEBUG http://localhost:8889 connected c-0000000000 /127.0.0.1:50008-&amp;gt;localhost/127.0.0.1:8889
2021-09-17 12:06:29,549 DEBUG ep-0000000000 connected c-0000000000
2021-09-17 12:06:29,549 DEBUG ep-0000000000 endpoint connected
2021-09-17 12:06:29,549 DEBUG ex-0000000001 connected to proxy
2021-09-17 12:06:29,551 DEBUG ex-0000000001 executing CONNECT nghttp2.org:443 HTTP/1.1
2021-09-17 12:06:29,553 DEBUG ep-0000000000 start execution ex-0000000001
2021-09-17 12:06:29,553 DEBUG ep-0000000000 executing exchange ex-0000000001 over c-0000000000
2021-09-17 12:06:29,554 DEBUG c-0000000000 RequestExecutionCommand with NORMAL priority
2021-09-17 12:06:29,554 DEBUG c-0000000000[ACTIVE][rwc:c] Enqueued RequestExecutionCommand with priority IMMEDIATE
2021-09-17 12:06:29,555 DEBUG c-0000000000[ACTIVE][rw:c] Event cleared [c]
2021-09-17 12:06:29,565 DEBUG c-0000000000[ACTIVE][rw:c] protocol upgrade class org.apache.hc.core5.http.impl.nio.ClientHttp1IOEventHandler
2021-09-17 12:06:29,567 DEBUG ex-0000000001 send request CONNECT nghttp2.org:443 HTTP/1.1, null entity
2021-09-17 12:06:29,567 DEBUG c-0000000000 &amp;gt;&amp;gt; CONNECT nghttp2.org:443 HTTP/1.1
2021-09-17 12:06:29,567 DEBUG c-0000000000 &amp;gt;&amp;gt; Host: nghttp2.org:443
2021-09-17 12:06:29,567 DEBUG c-0000000000 &amp;gt;&amp;gt; User-Agent: Apache-HttpAsyncClient/5.1.1-SNAPSHOT (Java/1.8.0_282)
2021-09-17 12:06:29,568 DEBUG c-0000000000[ACTIVE][rw:c] 127 bytes written
2021-09-17 12:06:29,568 DEBUG c-0000000000[ACTIVE][rw:c] Event set [w]
2021-09-17 12:06:29,568 DEBUG c-0000000000[ACTIVE][r:c] Event cleared [w]
2021-09-17 12:06:29,568 DEBUG c-0000000000[ACTIVE][r:r] 3607 bytes read
2021-09-17 12:06:29,572 DEBUG c-0000000000 &amp;lt;&amp;lt; HTTP/1.1 407 Proxy Authentication Required
2021-09-17 12:06:29,572 DEBUG c-0000000000 &amp;lt;&amp;lt; Server: squid/3.3.8
2021-09-17 12:06:29,572 DEBUG c-0000000000 &amp;lt;&amp;lt; Mime-Version: 1.0
2021-09-17 12:06:29,572 DEBUG c-0000000000 &amp;lt;&amp;lt; Date: Fri, 17 Sep 2021 10:06:29 GMT
2021-09-17 12:06:29,572 DEBUG c-0000000000 &amp;lt;&amp;lt; Content-Type: text/html
2021-09-17 12:06:29,572 DEBUG c-0000000000 &amp;lt;&amp;lt; Content-Length: 3165
2021-09-17 12:06:29,572 DEBUG c-0000000000 &amp;lt;&amp;lt; X-Squid-Error: ERR_CACHE_ACCESS_DENIED 0
2021-09-17 12:06:29,572 DEBUG c-0000000000 &amp;lt;&amp;lt; Vary: Accept-Language
2021-09-17 12:06:29,572 DEBUG c-0000000000 &amp;lt;&amp;lt; Content-Language: en
2021-09-17 12:06:29,572 DEBUG c-0000000000 &amp;lt;&amp;lt; Proxy-Authenticate: Basic realm=&quot;test-proxy&quot;
2021-09-17 12:06:29,572 DEBUG c-0000000000 &amp;lt;&amp;lt; X-Cache: MISS from 6a774a46c2a3
2021-09-17 12:06:29,572 DEBUG c-0000000000 &amp;lt;&amp;lt; X-Cache-Lookup: NONE from 6a774a46c2a3:8888
2021-09-17 12:06:29,573 DEBUG c-0000000000 &amp;lt;&amp;lt; Via: 1.1 6a774a46c2a3 (squid/3.3.8)
2021-09-17 12:06:29,573 DEBUG c-0000000000 &amp;lt;&amp;lt; Connection: keep-alive
2021-09-17 12:06:29,574 DEBUG ex-0000000001 consume response HTTP/1.1 407 Proxy Authentication Required, entity len 3165
2021-09-17 12:06:29,574 DEBUG ex-0000000001 Authentication required
2021-09-17 12:06:29,574 DEBUG ex-0000000001 localhost:8889 requested authentication
2021-09-17 12:06:29,576 DEBUG ex-0000000001 Authentication schemes in the order of preference: [Negotiate, Kerberos, NTLM, Digest, Basic]
2021-09-17 12:06:29,576 DEBUG ex-0000000001, Challenge for Negotiate authentication scheme not available
2021-09-17 12:06:29,577 DEBUG ex-0000000001, Challenge for Kerberos authentication scheme not available
2021-09-17 12:06:29,580 DEBUG ex-0000000001, Challenge for NTLM authentication scheme not available
2021-09-17 12:06:29,581 DEBUG ex-0000000001, Challenge for Digest authentication scheme not available
2021-09-17 12:06:29,582 DEBUG ex-0000000001 Selecting authentication options
2021-09-17 12:06:29,582 DEBUG ex-0000000001 Selected authentication options: [Basic{realm=test-proxy}]
2021-09-17 12:06:29,585 DEBUG ex-0000000001 consume response data, len 3165 bytes
2021-09-17 12:06:29,585 DEBUG ex-0000000001 end of response data
2021-09-17 12:06:29,586 DEBUG ex-0000000001 Generating response to an authentication challenge using Basic scheme
2021-09-17 12:06:29,592 DEBUG ex-0000000001 executing CONNECT nghttp2.org:443 HTTP/1.1
2021-09-17 12:06:29,593 DEBUG ep-0000000000 start execution ex-0000000001
2021-09-17 12:06:29,593 DEBUG ep-0000000000 executing exchange ex-0000000001 over c-0000000000
2021-09-17 12:06:29,593 DEBUG c-0000000000 RequestExecutionCommand with NORMAL priority
2021-09-17 12:06:29,593 DEBUG c-0000000000[ACTIVE][rw:r] Enqueued RequestExecutionCommand with priority IMMEDIATE
2021-09-17 12:06:29,593 DEBUG c-0000000000[ACTIVE][rw:r] Event set [r]
2021-09-17 12:06:29,593 DEBUG c-0000000000 Connection is kept alive
2021-09-17 12:06:29,594 DEBUG c-0000000000[ACTIVE][r:r] Event cleared [w]
2021-09-17 12:06:29,594 DEBUG ex-0000000001 send request CONNECT nghttp2.org:443 HTTP/1.1, null entity
2021-09-17 12:06:29,594 DEBUG c-0000000000 &amp;gt;&amp;gt; CONNECT nghttp2.org:443 HTTP/1.1
2021-09-17 12:06:29,594 DEBUG c-0000000000 &amp;gt;&amp;gt; Host: nghttp2.org:443
2021-09-17 12:06:29,594 DEBUG c-0000000000 &amp;gt;&amp;gt; User-Agent: Apache-HttpAsyncClient/5.1.1-SNAPSHOT (Java/1.8.0_282)
2021-09-17 12:06:29,594 DEBUG c-0000000000 &amp;gt;&amp;gt; Proxy-Authorization: Basic c3F1aWQ6bm9wYXNzd29yZA==
2021-09-17 12:06:29,595 DEBUG c-0000000000[ACTIVE][r:r] 180 bytes written
2021-09-17 12:06:29,595 DEBUG c-0000000000[ACTIVE][rw:r] Event set [w]
2021-09-17 12:06:29,595 DEBUG c-0000000000[ACTIVE][r:w] Event cleared [w]
2021-09-17 12:06:30,066 DEBUG c-0000000000[ACTIVE][r:r] 39 bytes read
2021-09-17 12:06:30,066 DEBUG c-0000000000 &amp;lt;&amp;lt; HTTP/1.1 200 Connection established
2021-09-17 12:06:30,067 DEBUG ex-0000000001 consume response HTTP/1.1 200 Connection established,  null entity
2021-09-17 12:06:30,067 DEBUG ex-0000000001 Authentication succeeded
2021-09-17 12:06:30,069 DEBUG ex-0000000001 Caching &apos;Basic&apos; auth scheme for http://localhost:8889
2021-09-17 12:06:30,078 DEBUG ex-0000000001 tunnel to target created
2021-09-17 12:06:30,078 DEBUG ep-0000000000 upgrading endpoint
2021-09-17 12:06:30,079 DEBUG c-0000000000 start TLS
2021-09-17 12:06:30,098 DEBUG ep-0000000000 upgraded c-0000000000
2021-09-17 12:06:30,098 DEBUG ex-0000000001 upgraded to TLS
2021-09-17 12:06:30,098 DEBUG ex-0000000001 route fully established
2021-09-17 12:06:30,098 DEBUG ex-0000000001 executing GET / HTTP/1.1
2021-09-17 12:06:30,098 DEBUG ep-0000000000 start execution ex-0000000001
2021-09-17 12:06:30,098 DEBUG ep-0000000000 executing exchange ex-0000000001 over c-0000000000
2021-09-17 12:06:30,098 DEBUG c-0000000000 RequestExecutionCommand with NORMAL priority
2021-09-17 12:06:30,099 DEBUG c-0000000000[ACTIVE][rw:r][ACTIVE][rw][NOT_HANDSHAKING][0][0][0] Enqueued RequestExecutionCommand with priority IMMEDIATE
2021-09-17 12:06:30,099 DEBUG c-0000000000 Connection is kept alive
2021-09-17 12:06:30,099 DEBUG c-0000000000[ACTIVE][rw:r][ACTIVE][rw][NOT_HANDSHAKING][0][0][0] Event set [r]
2021-09-17 12:06:30,101 DEBUG Enabled protocols: [TLSv1.2, TLSv1.1, TLSv1]
2021-09-17 12:06:30,101 DEBUG Enabled cipher suites:[TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384, TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256, TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384, TLS_RSA_WITH_AES_256_GCM_SHA384, TLS_ECDH_ECDSA_WITH_AES_256_GCM_SHA384, TLS_ECDH_RSA_WITH_AES_256_GCM_SHA384, TLS_DHE_RSA_WITH_AES_256_GCM_SHA384, TLS_DHE_DSS_WITH_AES_256_GCM_SHA384, TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256, TLS_RSA_WITH_AES_128_GCM_SHA256, TLS_ECDH_ECDSA_WITH_AES_128_GCM_SHA256, TLS_ECDH_RSA_WITH_AES_128_GCM_SHA256, TLS_DHE_RSA_WITH_AES_128_GCM_SHA256, TLS_DHE_DSS_WITH_AES_128_GCM_SHA256, TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384, TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384, TLS_RSA_WITH_AES_256_CBC_SHA256, TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA384, TLS_ECDH_RSA_WITH_AES_256_CBC_SHA384, TLS_DHE_RSA_WITH_AES_256_CBC_SHA256, TLS_DHE_DSS_WITH_AES_256_CBC_SHA256, TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA, TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA, TLS_RSA_WITH_AES_256_CBC_SHA, TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA, TLS_ECDH_RSA_WITH_AES_256_CBC_SHA, TLS_DHE_RSA_WITH_AES_256_CBC_SHA, TLS_DHE_DSS_WITH_AES_256_CBC_SHA, TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256, TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256, TLS_RSA_WITH_AES_128_CBC_SHA256, TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA256, TLS_ECDH_RSA_WITH_AES_128_CBC_SHA256, TLS_DHE_RSA_WITH_AES_128_CBC_SHA256, TLS_DHE_DSS_WITH_AES_128_CBC_SHA256, TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA, TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA, TLS_RSA_WITH_AES_128_CBC_SHA, TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA, TLS_ECDH_RSA_WITH_AES_128_CBC_SHA, TLS_DHE_RSA_WITH_AES_128_CBC_SHA, TLS_DHE_DSS_WITH_AES_128_CBC_SHA, TLS_EMPTY_RENEGOTIATION_INFO_SCSV]
2021-09-17 12:06:31,097 DEBUG Secure session established
2021-09-17 12:06:31,098 DEBUG  negotiated protocol: TLSv1.2
2021-09-17 12:06:31,098 DEBUG  negotiated cipher suite: TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
2021-09-17 12:06:31,099 DEBUG  peer principal: CN=nghttp2.org
2021-09-17 12:06:31,100 DEBUG  peer alternative names: [nghttp2.org, www.nghttp2.org]
2021-09-17 12:06:31,100 DEBUG  issuer principal: CN=R3, O=Let&apos;s Encrypt, C=US
2021-09-17 12:06:31,105 DEBUG c-0000000000[ACTIVE][r:r][ACTIVE][r][NOT_HANDSHAKING][0][0][0] Event cleared [w]
2021-09-17 12:06:31,105 DEBUG ex-0000000001 send request GET / HTTP/1.1, null entity
2021-09-17 12:06:31,106 DEBUG c-0000000000 &amp;gt;&amp;gt; GET / HTTP/1.1
2021-09-17 12:06:31,106 DEBUG c-0000000000 &amp;gt;&amp;gt; User-Agent: Apache-HttpAsyncClient/5.1.1-SNAPSHOT (Java/1.8.0_282)
2021-09-17 12:06:31,106 DEBUG c-0000000000 &amp;gt;&amp;gt; Host: nghttp2.org
2021-09-17 12:06:31,107 DEBUG c-0000000000 &amp;gt;&amp;gt; Connection: keep-alive
2021-09-17 12:06:31,108 DEBUG c-0000000000[ACTIVE][r:r][ACTIVE][r][NOT_HANDSHAKING][0][0][158] 129 bytes written
2021-09-17 12:06:31,109 DEBUG c-0000000000[ACTIVE][rw:r][ACTIVE][rw][NOT_HANDSHAKING][0][0][158] Event set [w]
2021-09-17 12:06:31,109 DEBUG c-0000000000[ACTIVE][r:w][ACTIVE][r][NOT_HANDSHAKING][0][0][0] Event cleared [w]
2021-09-17 12:06:31,514 DEBUG c-0000000000[ACTIVE][r:r][ACTIVE][r][NOT_HANDSHAKING][1329][1300][0] 0 bytes read
2021-09-17 12:06:31,515 DEBUG c-0000000000 &amp;lt;&amp;lt; HTTP/1.1 200 OK
2021-09-17 12:06:31,516 DEBUG c-0000000000 &amp;lt;&amp;lt; Date: Fri, 17 Sep 2021 10:06:32 GMT
2021-09-17 12:06:31,516 DEBUG c-0000000000 &amp;lt;&amp;lt; Content-Type: text/html
2021-09-17 12:06:31,516 DEBUG c-0000000000 &amp;lt;&amp;lt; Last-Modified: Sun, 18 Jul 2021 04:17:59 GMT
2021-09-17 12:06:31,516 DEBUG c-0000000000 &amp;lt;&amp;lt; Etag: &quot;60f3ab77-19d8&quot;
2021-09-17 12:06:31,517 DEBUG c-0000000000 &amp;lt;&amp;lt; Accept-Ranges: bytes
2021-09-17 12:06:31,517 DEBUG c-0000000000 &amp;lt;&amp;lt; Content-Length: 6616
2021-09-17 12:06:31,517 DEBUG c-0000000000 &amp;lt;&amp;lt; X-Backend-Header-Rtt: 0.001851
2021-09-17 12:06:31,518 DEBUG c-0000000000 &amp;lt;&amp;lt; Strict-Transport-Security: max-age=31536000
2021-09-17 12:06:31,518 DEBUG c-0000000000 &amp;lt;&amp;lt; Alt-Svc: h3=&quot;:443&quot;; ma=3600
2021-09-17 12:06:31,518 DEBUG c-0000000000 &amp;lt;&amp;lt; Server: nghttpx
2021-09-17 12:06:31,518 DEBUG c-0000000000 &amp;lt;&amp;lt; Via: 2 nghttpx
2021-09-17 12:06:31,518 DEBUG c-0000000000 &amp;lt;&amp;lt; x-frame-options: SAMEORIGIN
2021-09-17 12:06:31,519 DEBUG c-0000000000 &amp;lt;&amp;lt; x-xss-protection: 1; mode=block
2021-09-17 12:06:31,519 DEBUG c-0000000000 &amp;lt;&amp;lt; x-content-type-options: nosniff
2021-09-17 12:06:31,520 DEBUG ex-0000000001 consume response HTTP/1.1 200 OK, entity len 6616
2021-09-17 12:06:31,527 DEBUG ex-0000000001 consume response data, len 872 bytes
2021-09-17 12:06:31,532 DEBUG ex-0000000001 consume response data, len 1300 bytes
2021-09-17 12:06:31,533 DEBUG ex-0000000001 consume response data, len 1300 bytes
2021-09-17 12:06:31,534 DEBUG ex-0000000001 consume response data, len 1300 bytes
2021-09-17 12:06:31,535 DEBUG c-0000000000[ACTIVE][r:r][ACTIVE][r][NOT_HANDSHAKING][5316][0][0] 0 bytes read
2021-09-17 12:06:31,536 DEBUG ex-0000000001 consume response data, len 1300 bytes
2021-09-17 12:06:31,537 DEBUG ex-0000000001 consume response data, len 544 bytes
2021-09-17 12:06:31,537 DEBUG ex-0000000001 end of response data
Shutting down
GET https://nghttp2.org/-&amp;gt;HTTP/1.1 200 OK
SimpleBody{content length=6616, content type=text/html}
2021-09-17 12:06:31,541 DEBUG ex-0000000001 message exchange successfully completed
2021-09-17 12:06:31,541 DEBUG Shutdown GRACEFUL
2021-09-17 12:06:31,541 DEBUG ep-0000000000 releasing valid endpoint
2021-09-17 12:06:31,541 DEBUG ep-0000000000 releasing endpoint
2021-09-17 12:06:31,542 DEBUG ep-0000000000 connection c-0000000000 can be kept alive for 3 MINUTES
2021-09-17 12:06:31,544 DEBUG ep-0000000000 connection released [route: {tls}-&amp;gt;http://localhost:8889-&amp;gt;https://nghttp2.org:443][total available: 1; route allocated: 1 of 5; total allocated: 1 of 25]
2021-09-17 12:06:31,544 DEBUG c-0000000000[ACTIVE][r:r][ACTIVE][r][NOT_HANDSHAKING][1902][544][0] Event set [r]
2021-09-17 12:06:31,544 DEBUG c-0000000000 Connection is kept alive
2021-09-17 12:06:31,545 DEBUG c-0000000000[ACTIVE][rw:r][ACTIVE][rw][NOT_HANDSHAKING][0][0][0] Enqueued ShutdownCommand with priority IMMEDIATE
2021-09-17 12:06:31,546 DEBUG c-0000000000[ACTIVE][r:w][ACTIVE][r][NOT_HANDSHAKING][0][0][0] Event cleared [w]
2021-09-17 12:06:31,546 DEBUG c-0000000000[ACTIVE][rw:w][ACTIVE][rw][NOT_HANDSHAKING][0][0][0] Event set [w]
2021-09-17 12:06:31,547 DEBUG c-0000000000[ACTIVE][r:w][ACTIVE][r][NOT_HANDSHAKING][0][0][0] Event cleared [w]
2021-09-17 12:06:31,547 DEBUG c-0000000000[ACTIVE][r:w][ACTIVE][r][NOT_HANDSHAKING][0][0][0] Close GRACEFUL
2021-09-17 12:06:32,016 DEBUG Shutdown connection pool GRACEFUL
2021-09-17 12:06:32,017 DEBUG c-0000000000 Shutdown connection GRACEFUL
2021-09-17 12:06:32,017 DEBUG Connection pool shut down
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17416606" author="olegk" created="Fri, 17 Sep 2021 10:13:40 +0000"  >&lt;p&gt;I have decided to make no changes to the current behavior of HC 5.1 and disallow bad responses to CONNECT requests as of HC 5.2.&lt;/p&gt;

&lt;p&gt;However, one can still plug in a custom `ConnectionReuseStrategy` and disregard `Connection: close` directive to tolerate silliness of some proxy implementations.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17416730" author="jira-bot" created="Fri, 17 Sep 2021 14:34:00 +0000"  >&lt;p&gt;Commit 90d89af98e6cb9e4437d178acf084259607a20c3 in httpcomponents-client&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=90d89af&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=90d89af&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt;: keep successful tunnel connections alive regardless of `Connection: close`&lt;/p&gt;</comment>
                            <comment id="17416731" author="jira-bot" created="Fri, 17 Sep 2021 14:34:02 +0000"  >&lt;p&gt;Commit 33ca630c8f402551d4474f4e2e13e700811874b7 in httpcomponents-client&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=33ca630&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=33ca630&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt;: fixed incorrect route state tracking by the async connect executor when negotiating a tunnel via a proxy&lt;/p&gt;</comment>
                            <comment id="17416746" author="olegk" created="Fri, 17 Sep 2021 14:59:02 +0000"  >&lt;p&gt;My apologies, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=avasilev&quot; class=&quot;user-hover&quot; rel=&quot;avasilev&quot;&gt;avasilev&lt;/a&gt;&#160;You were right and I was wrong. There was another defect in the async connect executor. The async connecting route tracking code did not track routing state correctly in case of the proxy not keeping the tunnel connection alive during the authetication challenge exchange and as a result could not re-establish the tunnel in case of an authentication failure.&#160;&lt;/p&gt;

&lt;p&gt;Please re-test the fix &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. Please note there are two relevant commits in the branch.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/httpcomponents-client/tree/HTTPCLIENT-2177&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/tree/HTTPCLIENT-2177&lt;/a&gt;&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="17416813" author="avasilev" created="Fri, 17 Sep 2021 17:14:52 +0000"  >&lt;p&gt;Hi Oleg,&lt;/p&gt;

&lt;p&gt;I am now receiving &quot;ParseException: Invalid protocol version&quot;. This is the desired behavior for now that you mentioned in your first comment correct?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13033779/13033779_protocol-exception-context-wire.log&quot; title=&quot;protocol-exception-context-wire.log attached to HTTPCLIENT-2177&quot;&gt;protocol-exception-context-wire.log&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17416814" author="olegk" created="Fri, 17 Sep 2021 17:19:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=avasilev&quot; class=&quot;user-hover&quot; rel=&quot;avasilev&quot;&gt;avasilev&lt;/a&gt; This is to due to the HTTP protocol mismatch and is be expected with HC 5.1. Once I merge the fix to master you can try out HC 5.2 snapshot and see it works for you.&lt;/p&gt;

&lt;p&gt;Oleg &lt;/p&gt;</comment>
                            <comment id="17416815" author="olegk" created="Fri, 17 Sep 2021 17:21:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=avasilev&quot; class=&quot;user-hover&quot; rel=&quot;avasilev&quot;&gt;avasilev&lt;/a&gt; For the time being make sure you disable protocol negotiation (by using `HttpVersionPolicy#FORCE_HTTP_1` protocol policy).&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17416849" author="avasilev" created="Fri, 17 Sep 2021 18:24:53 +0000"  >&lt;p&gt;Oleg,&lt;/p&gt;

&lt;p&gt;Sounds good. Thanks again for your time and efforts. I am looking forward to the 5.2 snapshot.&lt;/p&gt;</comment>
                            <comment id="17416906" author="jira-bot" created="Fri, 17 Sep 2021 20:38:36 +0000"  >&lt;p&gt;Commit b49080353fbe554181b3d0d25e8521db1424ecce in httpcomponents-client&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=b490803&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=b490803&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt;: automatically force HTTP/1.1 protocol policy when executing requests via a proxy tunnel&lt;/p&gt;</comment>
                            <comment id="17416908" author="olegk" created="Fri, 17 Sep 2021 20:43:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=avasilev&quot; class=&quot;user-hover&quot; rel=&quot;avasilev&quot;&gt;avasilev&lt;/a&gt; I made another change to the execution pipeline that automatically forces HTTP/1.1 protocol policy when executing requests via a proxy tunnel. I would really appreciate if you could test it as well. &lt;/p&gt;

&lt;p&gt;If everything works as expected I will merge the fixes to 5.0.x, 5.1.x and master (5.2.x) tomorrow.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17416971" author="avasilev" created="Fri, 17 Sep 2021 23:49:21 +0000"  >&lt;p&gt;Oleg,&lt;/p&gt;

&lt;p&gt;I just tried it out. Works as expected. Successfully tunnels and receives response via HTTP/1.1 protocol.&lt;/p&gt;</comment>
                            <comment id="17417073" author="jira-bot" created="Sat, 18 Sep 2021 08:12:47 +0000"  >&lt;p&gt;Commit 90d89af98e6cb9e4437d178acf084259607a20c3 in httpcomponents-client&apos;s branch refs/heads/5.1.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=90d89af&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=90d89af&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt;: keep successful tunnel connections alive regardless of `Connection: close`&lt;/p&gt;</comment>
                            <comment id="17417074" author="jira-bot" created="Sat, 18 Sep 2021 08:12:49 +0000"  >&lt;p&gt;Commit 33ca630c8f402551d4474f4e2e13e700811874b7 in httpcomponents-client&apos;s branch refs/heads/5.1.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=33ca630&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=33ca630&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt;: fixed incorrect route state tracking by the async connect executor when negotiating a tunnel via a proxy&lt;/p&gt;</comment>
                            <comment id="17417075" author="jira-bot" created="Sat, 18 Sep 2021 08:12:51 +0000"  >&lt;p&gt;Commit b49080353fbe554181b3d0d25e8521db1424ecce in httpcomponents-client&apos;s branch refs/heads/5.1.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=b490803&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=b490803&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt;: automatically force HTTP/1.1 protocol policy when executing requests via a proxy tunnel&lt;/p&gt;</comment>
                            <comment id="17417079" author="jira-bot" created="Sat, 18 Sep 2021 08:30:06 +0000"  >&lt;p&gt;Commit 2af0bab75649093e0e621396c511ed3ca99298a9 in httpcomponents-client&apos;s branch refs/heads/5.0.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=2af0bab&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=2af0bab&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt;: keep successful tunnel connections alive regardless of `Connection: close`&lt;/p&gt;</comment>
                            <comment id="17417080" author="jira-bot" created="Sat, 18 Sep 2021 08:30:09 +0000"  >&lt;p&gt;Commit d7aa782971d87f405222d88dbd5c1e4111b4c1fe in httpcomponents-client&apos;s branch refs/heads/5.0.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=d7aa782&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=d7aa782&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt;: fixed incorrect route state tracking by the async connect executor when negotiating a tunnel via a proxy&lt;/p&gt;</comment>
                            <comment id="17417081" author="jira-bot" created="Sat, 18 Sep 2021 08:30:11 +0000"  >&lt;p&gt;Commit b95b917cb2ba39773e9b3114cd873e8d9f95002d in httpcomponents-client&apos;s branch refs/heads/5.0.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=b95b917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=b95b917&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt;: automatically force HTTP/1.1 protocol policy when executing requests via a proxy tunnel&lt;/p&gt;</comment>
                            <comment id="17417089" author="jira-bot" created="Sat, 18 Sep 2021 08:44:24 +0000"  >&lt;p&gt;Commit 1686495e7398a618965314b385982b7e8e5f9061 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=1686495&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=1686495&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt;: keep successful tunnel connections alive regardless of `Connection: close`&lt;/p&gt;</comment>
                            <comment id="17417090" author="jira-bot" created="Sat, 18 Sep 2021 08:44:26 +0000"  >&lt;p&gt;Commit c5b260acd12546351993e4a7b506697082c4aa3c in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=c5b260a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=c5b260a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt;: fixed incorrect route state tracking by the async connect executor when negotiating a tunnel via a proxy&lt;/p&gt;</comment>
                            <comment id="17417213" author="jira-bot" created="Sat, 18 Sep 2021 19:36:25 +0000"  >&lt;p&gt;Commit 4ce032c92c6f1f7beaafbb5622647de8db93586f in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=4ce032c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=4ce032c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt;: keep successful tunnel connections alive regardless of `Connection: close`&lt;/p&gt;</comment>
                            <comment id="17417214" author="jira-bot" created="Sat, 18 Sep 2021 19:36:27 +0000"  >&lt;p&gt;Commit 90f69c87b27b721ea8f0e23bdb4baf92bd7cde06 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=90f69c8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=90f69c8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2177&quot; title=&quot;Unable to use HTTP Proxy with CloseableHttpAsyncClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2177&quot;&gt;&lt;del&gt;HTTPCLIENT-2177&lt;/del&gt;&lt;/a&gt;: fixed incorrect route state tracking by the async connect executor when negotiating a tunnel via a proxy&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13033740" name="auth-proxy-context-wire-HTTPCLIENT-2177.log" size="26329" author="avasilev" created="Thu, 16 Sep 2021 23:25:10 +0000"/>
                            <attachment id="13033605" name="context-wire.log" size="12889" author="avasilev" created="Wed, 15 Sep 2021 17:20:06 +0000"/>
                            <attachment id="13033779" name="protocol-exception-context-wire.log" size="37297" author="avasilev" created="Fri, 17 Sep 2021 17:07:33 +0000"/>
                            <attachment id="13033741" name="unauth-proxy-context-wire-HTTPCLIENT-2177.log" size="94006" author="avasilev" created="Thu, 16 Sep 2021 23:25:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>Java</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 7 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0uxbc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>