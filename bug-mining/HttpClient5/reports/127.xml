<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:23:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-2363] execute(HttpHost, HttpRequest, ResponseHandler) adds port to Host header while execute(HttpRequest, ResponseHandler) does not</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-2363</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;I&apos;ve found what I think is a bug, but could also be expected behavior that&apos;s surprising from the user&apos;s perspective.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://gist.github.com/Earth-Turtle/c39c5282af1c8a306099e89091fafea9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/Earth-Turtle/c39c5282af1c8a306099e89091fafea9&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Expected behavior: assume we have some URI &lt;tt&gt;&lt;a href=&quot;https://www.example.com/some/path&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.example.com/some/path&lt;/a&gt;&lt;/tt&gt;. &lt;tt&gt;HttpClient&lt;/tt&gt; provides overloads for execute that allow the URI to be split into host and path components(&quot;&lt;tt&gt;&lt;a href=&quot;https://www.example.com/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.example.com&lt;/a&gt;&lt;/tt&gt;&quot;, &quot;&lt;tt&gt;/some/path&lt;/tt&gt;&quot;), or provided all in the same &lt;tt&gt;HttpRequest&lt;/tt&gt; (where &lt;tt&gt;request.getAuthority(&lt;/tt&gt;) is &quot;&lt;a href=&quot;https://example.com/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;https://example.com&lt;/tt&gt;&lt;/a&gt;&quot; and &lt;tt&gt;request.getUri()&lt;/tt&gt; is &quot;/some/path&quot;). Using either of these two methods provides the exact same result.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Actual behavior: &lt;tt&gt;execute(HttpHost, HttpRequest, ResponseHandler)&lt;/tt&gt; sets the Host header to be &lt;a href=&quot;http://www.example.com:443/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;www.example.com:443&lt;/tt&gt;&lt;/a&gt;, while &lt;tt&gt;execute(HttpRequest, ResponseHandler)&lt;/tt&gt; sets it to &lt;a href=&quot;http://www.example.com/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;www.example.com&lt;/tt&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Normally, this behavior has no effect. In fact, &lt;a href=&quot;https://echo.free.beeceptor.com/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://echo.free.beeceptor.com&lt;/a&gt; will strip the port in the Host header when echoing back the headers in a request. However, I&apos;ve recently come across a server that rejected some requests with &quot;Invalid host header, this site must be accessed as &lt;a href=&quot;https://www.example.com/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.example.com&lt;/a&gt;&quot;. Investigation revealed that it rejected requests where the port was included in the Host header, and would only accept requests where a port was not defined.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This behavior is not defined by the HTTP spec; the port number is not required in the Host header sent by the client, nor is the server obligated to respect the host portion without the port. This case feels like an outlier from usual behavior; however, this hidden behavior from &lt;tt&gt;HttpClient&lt;/tt&gt; was unexpected.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;It appears that this happens when &lt;tt&gt;ProtocolExec&lt;/tt&gt;, &lt;tt&gt;AsyncProtocolExec&lt;/tt&gt;, and &lt;tt&gt;MinimalHttpClient&lt;/tt&gt; are filling in the authority and scheme for a request if it didn&apos;t have one to begin with. Because they fill from the &lt;tt&gt;HttpRoute&lt;/tt&gt;&apos;s target &lt;tt&gt;HttpHost&lt;/tt&gt;, this host also contains port information (usually scheme-default) when it is set as the request&apos;s authority.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This bug is very easily worked around by simply setting the requests authority from the target before calling execute, but it still seems unusual. Was this behavior intended?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13612451">HTTPCLIENT-2363</key>
            <summary>execute(HttpHost, HttpRequest, ResponseHandler) adds port to Host header while execute(HttpRequest, ResponseHandler) does not</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="earthturtle">Nicholas O&apos;Connor</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Mar 2025 21:48:12 +0000</created>
                <updated>Sat, 22 Mar 2025 10:05:53 +0000</updated>
                            <resolved>Sat, 22 Mar 2025 10:05:53 +0000</resolved>
                                    <version>5.3.1</version>
                    <version>5.4.2</version>
                                    <fixVersion>5.4.3</fixVersion>
                    <fixVersion>5.5</fixVersion>
                                    <component>HttpClient (classic)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="604800">168h</timeoriginalestimate>
                            <timeestimate seconds="604800">168h</timeestimate>
                                        <comments>
                            <comment id="17937038" author="abernal" created="Thu, 20 Mar 2025 07:47:40 +0000"  >&lt;p&gt;Based on &lt;a href=&quot;http://example.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;RFC 7230 Section 5.4&lt;/a&gt;https://datatracker.ietf.org/doc/html/rfc7230#section-5.4, &quot;If the target URI includes an authority component, then a client MUST send a field value for Host that is identical to that authority component.&quot; for what i understand this means that including the default port (e.g., &quot;:443&quot; for HTTPS) is allowed when it is part of the URI&apos;s authority.&lt;/p&gt;</comment>
                            <comment id="17937115" author="jira-bot" created="Thu, 20 Mar 2025 13:40:11 +0000"  >&lt;p&gt;Commit d91eeb35ad70f08e72a92103f3d9ba0475d42f6c in httpcomponents-client&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2363&quot; title=&quot;execute(HttpHost, HttpRequest, ResponseHandler) adds port to Host header while execute(HttpRequest, ResponseHandler) does not&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2363&quot;&gt;&lt;del&gt;HTTPCLIENT-2363&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=d91eeb35a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=d91eeb35a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2363&quot; title=&quot;execute(HttpHost, HttpRequest, ResponseHandler) adds port to Host header while execute(HttpRequest, ResponseHandler) does not&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2363&quot;&gt;&lt;del&gt;HTTPCLIENT-2363&lt;/del&gt;&lt;/a&gt;: ensure requests have a scheme and an authority populated before they get committed to the execution pipeline&lt;/p&gt;</comment>
                            <comment id="17937116" author="olegk" created="Thu, 20 Mar 2025 13:42:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abernal&quot; class=&quot;user-hover&quot; rel=&quot;abernal&quot;&gt;abernal&lt;/a&gt; What Httpclient does is not wrong or non-conformant with the specification, it is inconsistent. We should fix the inconsistency.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=earthturtle&quot; class=&quot;user-hover&quot; rel=&quot;earthturtle&quot;&gt;earthturtle&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abernal&quot; class=&quot;user-hover&quot; rel=&quot;abernal&quot;&gt;abernal&lt;/a&gt; Please review the proposed fix:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-client/compare/5.4.x...HTTPCLIENT-2363&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/compare/5.4.x...HTTPCLIENT-2363&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17937132" author="abernal" created="Thu, 20 Mar 2025 14:53:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;&#160; the change LGTM&lt;/p&gt;</comment>
                            <comment id="17937162" author="JIRAUSER309096" created="Thu, 20 Mar 2025 17:00:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt; Looks good, thank you!&lt;/p&gt;</comment>
                            <comment id="17937565" author="jira-bot" created="Sat, 22 Mar 2025 10:01:23 +0000"  >&lt;p&gt;Commit 8d0f3b10c315615a250f1d2047ffac87348807e8 in httpcomponents-client&apos;s branch refs/heads/5.4.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=8d0f3b10c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=8d0f3b10c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2363&quot; title=&quot;execute(HttpHost, HttpRequest, ResponseHandler) adds port to Host header while execute(HttpRequest, ResponseHandler) does not&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2363&quot;&gt;&lt;del&gt;HTTPCLIENT-2363&lt;/del&gt;&lt;/a&gt;: ensure requests have a scheme and an authority populated before they get committed to the execution pipeline&lt;/p&gt;</comment>
                            <comment id="17937566" author="jira-bot" created="Sat, 22 Mar 2025 10:05:20 +0000"  >&lt;p&gt;Commit 57d5a13763006099a292f058fc5495218b2fd968 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=57d5a1376&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=57d5a1376&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2363&quot; title=&quot;execute(HttpHost, HttpRequest, ResponseHandler) adds port to Host header while execute(HttpRequest, ResponseHandler) does not&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2363&quot;&gt;&lt;del&gt;HTTPCLIENT-2363&lt;/del&gt;&lt;/a&gt;: ensure requests have a scheme and an authority populated before they get committed to the execution pipeline&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>java</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            33 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1uvr4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>