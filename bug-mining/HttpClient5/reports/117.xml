<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:23:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-2331] Single cookie header should be sent for multiple cookies</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-2331</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;Single cookie header should be sent for multiple cookies&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Use case&lt;/b&gt; -&#160;&lt;/p&gt;

&lt;p&gt;When &lt;b&gt;Cookie&lt;/b&gt; header is added explicitly using &lt;b&gt;setHeader&lt;/b&gt;() method and there exists multiple cookies in cookie store (BasicCookieStore), then for this use case two Cookie headers are sent by HttpClient.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Expectation&lt;/b&gt; - Single Cookie header should be sent by Apache HttpClient where all cookies should be separated by semi-colon&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Actual&lt;/b&gt;&#160;- Two Cookie headers are sent by Apache HttpClient, where in cookie set using setHeader is sent as one cookie Header and cookies in BasicCookieStore are sent in another Cookie header wherein value is all cookies separates by semi-colon.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Steps to reproduce -&lt;/b&gt;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Setup two microservices&lt;/li&gt;
	&lt;li&gt;1st microservice will set custom Cookie header as part of API request to 2nd micro service.&lt;/li&gt;
	&lt;li&gt;2nd microservice will respond back with two Set-Cookie headers&#160;&lt;/li&gt;
	&lt;li&gt;First time when call is made from 1st micro service to 2nd micro service only custom cookie header will be sent and BasicCookieStore on 1st microservice will be updated with cookies that we got from 2nd microservice&lt;/li&gt;
	&lt;li&gt;Second time when call is made from 1st micro service to 2nd micro service both custom cookie and cookies from BasicCookieStore will be sent as separate Cookie headers.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2024-06-18 09:45:28.074 DEBUG 3540 --- [nio-8090-exec-7] org.apache.hc.client5.http.headers &#160; &#160; &#160; : http-outgoing-1 &amp;gt;&amp;gt; GET /demo-service-two/test HTTP/1.1
2024-06-18 09:45:28.074 DEBUG 3540 --- [nio-8090-exec-7] org.apache.hc.client5.http.headers &#160; &#160; &#160; : http-outgoing-1 &amp;gt;&amp;gt; Cookie: MyCustomCookie=QWERTY
2024-06-18 09:45:28.074 DEBUG 3540 --- [nio-8090-exec-7] org.apache.hc.client5.http.headers &#160; &#160; &#160; : http-outgoing-1 &amp;gt;&amp;gt; Accept-Encoding: gzip, x-gzip, deflate
2024-06-18 09:45:28.075 DEBUG 3540 --- [nio-8090-exec-7] org.apache.hc.client5.http.headers &#160; &#160; &#160; : http-outgoing-1 &amp;gt;&amp;gt; Host: localhost:8091
2024-06-18 09:45:28.075 DEBUG 3540 --- [nio-8090-exec-7] org.apache.hc.client5.http.headers &#160; &#160; &#160; : http-outgoing-1 &amp;gt;&amp;gt; Connection: keep-alive
2024-06-18 09:45:28.075 DEBUG 3540 --- [nio-8090-exec-7] org.apache.hc.client5.http.headers &#160; &#160; &#160; : http-outgoing-1 &amp;gt;&amp;gt; User-Agent: Apache-HttpClient/5.1.3 (Java/17.0.8)
2024-06-18 09:45:28.075 DEBUG 3540 --- [nio-8090-exec-7] org.apache.hc.client5.http.headers &#160; &#160; &#160; : http-outgoing-1 &amp;gt;&amp;gt; Cookie: ServiceTwoSession1=POIUY; ServiceTwoSession2=ZXCVB &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13583053">HTTPCLIENT-2331</key>
            <summary>Single cookie header should be sent for multiple cookies</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="nvchaudhari1991">Nikhil Chaudhari</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Jun 2024 13:49:07 +0000</created>
                <updated>Thu, 20 Jun 2024 06:06:22 +0000</updated>
                            <resolved>Thu, 20 Jun 2024 06:06:22 +0000</resolved>
                                                    <fixVersion>5.4-beta1</fixVersion>
                                    <component>HttpClient (async)</component>
                    <component>HttpClient (classic)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17855945" author="olegk" created="Tue, 18 Jun 2024 14:06:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nvchaudhari1991&quot; class=&quot;user-hover&quot; rel=&quot;nvchaudhari1991&quot;&gt;nvchaudhari1991&lt;/a&gt; HttpClient 5.x conforms to RFC 6265 and generates a single `Cookie` header. If the request contains other `Cookie` headers manually added by the caller HttpClient does not remove them.&lt;/p&gt;

&lt;p&gt;Oleg   &lt;/p&gt;</comment>
                            <comment id="17855950" author="JIRAUSER305855" created="Tue, 18 Jun 2024 14:15:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Yes, I see that HttpClient doesn&apos;t remove the manually added Cookie headers but shouldn&apos;t it merge all cookies, i.e. both cookies that are added manually plus the cookies from BasicCookieStore ?&lt;/p&gt;

&lt;p&gt;Following is how HttpClient is sending Cookie headers&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2024-06-18 09:45:28.074 DEBUG 3540 --- [nio-8090-exec-7] org.apache.hc.client5.http.headers &#160; &#160; &#160; : http-outgoing-1 &amp;gt;&amp;gt; Cookie: MyCustomCookie=QWERTY 
2024-06-18 09:45:28.075 DEBUG 3540 --- [nio-8090-exec-7] org.apache.hc.client5.http.headers &#160; &#160; &#160; : http-outgoing-1 &amp;gt;&amp;gt; Cookie: ServiceTwoSession1=POIUY; ServiceTwoSession2=ZXCVB
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
But it rather should be something like below&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.hc.client5.http.headers &#160; &#160; &#160; : http-outgoing-1 &amp;gt;&amp;gt; Cookie: MyCustomCookie=QWERTY; ServiceTwoSession1=POIUY; ServiceTwoSession2=ZXCVB
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17855953" author="olegk" created="Tue, 18 Jun 2024 14:23:26 +0000"  >&lt;p&gt;&amp;gt; Yes, I see that HttpClient doesn&apos;t remove the manually added Cookie headers but shouldn&apos;t it merge all cookies&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nvchaudhari1991&quot; class=&quot;user-hover&quot; rel=&quot;nvchaudhari1991&quot;&gt;nvchaudhari1991&lt;/a&gt; No, it should not. HttpClient does not meddle with manually added headers, pretty much never. &lt;/p&gt;

&lt;p&gt;What I am going to change in 5.4 is the behavior of HttpClient when there is a Cookie header present in the request message. Most likely I will make it skip Cookie header generation altogether.  &lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17856392" author="jira-bot" created="Thu, 20 Jun 2024 06:06:01 +0000"  >&lt;p&gt;Commit 336263da6c7ac509ae2d40b9c36e043be52a11ba in httpcomponents-client&apos;s branch refs/heads/master from Arturo Bernal&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=336263da6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=336263da6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Fix &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2331&quot; title=&quot;Single cookie header should be sent for multiple cookies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2331&quot;&gt;&lt;del&gt;HTTPCLIENT-2331&lt;/del&gt;&lt;/a&gt;: Skip cookie header generation if a Cookie header is already present (#561)&lt;/p&gt;

&lt;p&gt;This fix ensures that if a Cookie header is already present in the request, HttpClient skips adding additional Cookie headers from the BasicCookieStore.&lt;/p&gt;</comment>
                            <comment id="17856393" author="abernal" created="Thu, 20 Jun 2024 06:06:22 +0000"  >&lt;p&gt;Solved&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-client/pull/561&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/pull/561&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13069570" name="DemoServiceOneController.java" size="1570" author="nvchaudhari1991" created="Tue, 18 Jun 2024 13:49:00 +0000"/>
                            <attachment id="13069569" name="DemoServiceOneLogs.txt" size="12961" author="nvchaudhari1991" created="Tue, 18 Jun 2024 13:49:00 +0000"/>
                            <attachment id="13069568" name="DemoServiceTwoController.java" size="753" author="nvchaudhari1991" created="Tue, 18 Jun 2024 13:49:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 20 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1pvb4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>