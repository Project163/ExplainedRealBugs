<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:22:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-2232] Registering RequestInterceptorLast is misleading</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-2232</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CloseableHttpAsyncClient client = HttpAsyncClients.custom()
.addRequestInterceptorLast(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyRequestInterceptor())
.build();
client.start();&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We were registering our request interceptor and were trying to log out some of the important headers we wish to see on our outgoing requests, like transfer-encoding.&#160; We found out the hard way this header is set later in processing, in the H2RequestContent class that is registered in the HttpAsyncClientEventHandlerFactory and later in IOReactor.&#160; This is super frustrating because registering something &apos;last&apos; should be the last thing that is hit before reaching out to target.&#160; Because we it is not, we do not see the header we wish to see.&#160; &#160;We limit the headers we expose, so turning on Wire logging or something like that is not an option for us. The way the HttpAsyncClientBuilder is written, I do not have the option of registering my own interceptor in HttpAsyncClientEventHandlerFactory or even providing my own IOEventHandlerFactory.&#160; &#160;What do you guys suggest here? The only option I see is to manually create our async client, and due to the heavy configuration of this class, I am hoping for an alternative.&#160; FYI- I do not need to change the outgoing request in any way, this is merely a logging issue for us.&lt;/p&gt;



&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; IOEventHandlerFactory ioEventHandlerFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HttpAsyncClientEventHandlerFactory(
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultHttpProcessor(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; H2RequestContent(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; H2RequestTargetHost(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; H2RequestConnControl()),
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HandlerFactory&amp;lt;AsyncPushConsumer&amp;gt;() {

            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; AsyncPushConsumer create(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpRequest request, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpContext context) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; HttpException {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; pushConsumerRegistry.get(request);
            }

        },
        versionPolicy != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? versionPolicy : HttpVersionPolicy.NEGOTIATE,
        h2Config != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? h2Config : H2Config.DEFAULT,
        h1Config != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? h1Config : Http1Config.DEFAULT,
        charCodingConfig != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? charCodingConfig : CharCodingConfig.DEFAULT,
        reuseStrategyCopy); 

&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; DefaultConnectingIOReactor ioReactor = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultConnectingIOReactor(
        ioEventHandlerFactory,
        ioReactorConfig != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? ioReactorConfig : IOReactorConfig.DEFAULT,
        threadFactory != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? threadFactory : &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultThreadFactory(&lt;span class=&quot;code-quote&quot;&gt;&quot;httpclient-dispatch&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;),
        LoggingIOSessionDecorator.INSTANCE,
        ioReactorExceptionCallback != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? ioReactorExceptionCallback : LoggingExceptionCallback.INSTANCE,
        &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Callback&amp;lt;IOSession&amp;gt;() {

            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void execute(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; IOSession ioSession) {
                ioSession.enqueue(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ShutdownCommand(CloseMode.GRACEFUL), Command.Priority.IMMEDIATE);
            }

        });&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13479916">HTTPCLIENT-2232</key>
            <summary>Registering RequestInterceptorLast is misleading</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="patrickjamesbarry">Patrick Barry</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Sep 2022 16:17:51 +0000</created>
                <updated>Sun, 11 Sep 2022 16:57:20 +0000</updated>
                            <resolved>Sun, 11 Sep 2022 16:57:20 +0000</resolved>
                                    <version>5.1.3</version>
                                    <fixVersion>5.1.4</fixVersion>
                    <fixVersion>5.2</fixVersion>
                                    <component>HttpClient (async)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17600044" author="jira-bot" created="Sun, 4 Sep 2022 10:42:48 +0000"  >&lt;p&gt;Commit bfb8ec2d7e22c065d008f814b1b8309f2516bd89 in httpcomponents-client&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2232&quot; title=&quot;Registering RequestInterceptorLast is misleading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2232&quot;&gt;&lt;del&gt;HTTPCLIENT-2232&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=bfb8ec2d7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=bfb8ec2d7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2232&quot; title=&quot;Registering RequestInterceptorLast is misleading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2232&quot;&gt;&lt;del&gt;HTTPCLIENT-2232&lt;/del&gt;&lt;/a&gt;: last protocol interceptrs moved at the end of the H2 protocol processing pipeline&lt;/p&gt;</comment>
                            <comment id="17600045" author="jira-bot" created="Sun, 4 Sep 2022 10:46:27 +0000"  >&lt;p&gt;Commit 517ebf4e79f35a3405d13df213f8576a3d8e4b90 in httpcomponents-client&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2232&quot; title=&quot;Registering RequestInterceptorLast is misleading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2232&quot;&gt;&lt;del&gt;HTTPCLIENT-2232&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=517ebf4e7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=517ebf4e7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2232&quot; title=&quot;Registering RequestInterceptorLast is misleading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2232&quot;&gt;&lt;del&gt;HTTPCLIENT-2232&lt;/del&gt;&lt;/a&gt;: last protocol interceptrs moved at the end of the H2 protocol processing pipeline&lt;/p&gt;</comment>
                            <comment id="17600046" author="olegk" created="Sun, 4 Sep 2022 10:48:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=patrickjamesbarry&quot; class=&quot;user-hover&quot; rel=&quot;patrickjamesbarry&quot;&gt;patrickjamesbarry&lt;/a&gt; This is the easiest and admittedly the ugliest fix &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. I will see if I can come up with a something better in 5.2.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/httpcomponents-client/commit/517ebf4e79f35a3405d13df213f8576a3d8e4b90&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/commit/517ebf4e79f35a3405d13df213f8576a3d8e4b90&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17600786" author="patrickjamesbarry" created="Tue, 6 Sep 2022 14:09:38 +0000"  >&lt;p&gt;That should work. Would I need to perform a custom build from this repo to use or will there be a new 5.1.4 release cut?&lt;/p&gt;</comment>
                            <comment id="17601165" author="olegk" created="Wed, 7 Sep 2022 07:01:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=patrickjamesbarry&quot; class=&quot;user-hover&quot; rel=&quot;patrickjamesbarry&quot;&gt;patrickjamesbarry&lt;/a&gt; 5.1.4 will likely be released sometime in Q4 2022.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17602885" author="jira-bot" created="Sun, 11 Sep 2022 16:53:45 +0000"  >&lt;p&gt;Commit 9c0575494a8de03f05f14542a03ec3ed57136418 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=9c0575494&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=9c0575494&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2232&quot; title=&quot;Registering RequestInterceptorLast is misleading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2232&quot;&gt;&lt;del&gt;HTTPCLIENT-2232&lt;/del&gt;&lt;/a&gt;: last protocol interceptrs moved at the end of the H2 protocol processing pipeline&lt;/p&gt;</comment>
                            <comment id="17602887" author="jira-bot" created="Sun, 11 Sep 2022 16:56:14 +0000"  >&lt;p&gt;Commit ce41bf26c4a51d8e20b4da0c820486bb6ffb2ef2 in httpcomponents-client&apos;s branch refs/heads/5.1.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=ce41bf26c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=ce41bf26c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2232&quot; title=&quot;Registering RequestInterceptorLast is misleading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2232&quot;&gt;&lt;del&gt;HTTPCLIENT-2232&lt;/del&gt;&lt;/a&gt;: last protocol interceptrs moved at the end of the H2 protocol processing pipeline&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 8 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z18a9k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>