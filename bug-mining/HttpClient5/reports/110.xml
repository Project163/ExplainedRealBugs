<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:22:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-2310] Async client incorrectly pipes CONNECT requests through the main request protocol chain</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-2310</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;HttpRequestInterceptor can be added to both CloseableHttpClient and CloseableHttpAsyncClient, but a CONNECT request can be caught only with CloseableHttpAsyncClient.&#160;&lt;br/&gt;
Even if I use the following examples: &lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/5.2.x/httpclient5/src/test/java/org/apache/hc/client5/http/examples/AsyncClientInterceptors.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;for async&lt;/a&gt; or &lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/5.2.x/httpclient5/src/test/java/org/apache/hc/client5/http/examples/ClientInterceptors.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;for classic&lt;/a&gt; from GitHub.&lt;/p&gt;

&lt;p&gt;Could it be possible to fix this issue and cover the &quot;connect&quot; request in CloseableHttpClient&apos;s request interceptor?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13559382">HTTPCLIENT-2310</key>
            <summary>Async client incorrectly pipes CONNECT requests through the main request protocol chain</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="marianbabii">Marian</reporter>
                        <labels>
                    </labels>
                <created>Sat, 25 Nov 2023 09:08:48 +0000</created>
                <updated>Sat, 2 Dec 2023 10:33:10 +0000</updated>
                            <resolved>Sat, 2 Dec 2023 10:33:10 +0000</resolved>
                                    <version>5.2.2</version>
                    <version>5.2.1</version>
                                    <fixVersion>5.3</fixVersion>
                                    <component>HttpClient (classic)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17790541" author="olegk" created="Tue, 28 Nov 2023 12:31:07 +0000"  >&lt;p&gt;&amp;gt; CONNECT request can be caught only with CloseableHttpAsyncClient.&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marianbabii&quot; class=&quot;user-hover&quot; rel=&quot;marianbabii&quot;&gt;marianbabii&lt;/a&gt; I do not think it can be. Could you please provide a test app demonstrating that?&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17790562" author="JIRAUSER303275" created="Tue, 28 Nov 2023 13:16:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;, there is a code example:&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.example;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.async.methods.SimpleHttpRequest;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.async.methods.SimpleRequestBuilder;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.async.methods.SimpleRequestProducer;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.config.ConnectionConfig;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.config.RequestConfig;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.config.TlsConfig;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.cookie.StandardCookieSpec;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.impl.async.CloseableHttpAsyncClient;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.impl.async.HttpAsyncClientBuilder;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.impl.async.HttpAsyncClients;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.impl.nio.PoolingAsyncClientConnectionManagerBuilder;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.client5.http.ssl.ClientTlsStrategyBuilder;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.concurrent.FutureCallback;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.http.HttpHost;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.http.HttpResponse;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.http.Message;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.http.nio.AsyncResponseConsumer;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.http.nio.entity.BasicAsyncEntityConsumer;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.http.nio.support.BasicResponseConsumer;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.http.ssl.TLS;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.http2.HttpVersionPolicy;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.io.CloseMode;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.pool.PoolConcurrencyPolicy;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.pool.PoolReusePolicy;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.reactor.IOReactorConfig;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hc.core5.util.Timeout;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.concurrent.CountDownLatch;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.concurrent.Future;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;App 
{
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpAsyncClientBuilder clientBuilder = HttpAsyncClients.custom()
                .addRequestInterceptorFirst((request, entity, context) -&amp;gt; {
                    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; method = request.getMethod();
                    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;method: &quot;&lt;/span&gt; + method);
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (method.equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;CONNECT&quot;&lt;/span&gt;)) {
                        request.addHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;Custom-Header&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;);
                    }
                })
                .setConnectionManager(PoolingAsyncClientConnectionManagerBuilder.create()
                        .setTlsStrategy(ClientTlsStrategyBuilder.create()
                                .setTlsVersions(TLS.V_1_3)
                                .build())
                        .setPoolConcurrencyPolicy(PoolConcurrencyPolicy.LAX)
                        .setConnPoolPolicy(PoolReusePolicy.LIFO)
                        .setDefaultConnectionConfig(ConnectionConfig.custom()
                                .setSocketTimeout(Timeout.ofMinutes(1))
                                .setConnectTimeout(Timeout.ofMinutes(1))
                                .setTimeToLive(Timeout.ofMinutes(1))
                                .build())
                        .setDefaultTlsConfig(TlsConfig.custom()
                                .setVersionPolicy(HttpVersionPolicy.FORCE_HTTP_2)
                                .setHandshakeTimeout(Timeout.ofMinutes(1))
                                .build())
                        .build())
                .setIOReactorConfig(IOReactorConfig.custom()
                        .setSoTimeout(Timeout.ofMinutes(1))
                        .setIoThreadCount(1)
                        .build())
                .setDefaultRequestConfig(RequestConfig.custom()
                        .setCookieSpec(StandardCookieSpec.STRICT)
                        .build())
                .disableCookieManagement()
                .setProxy(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HttpHost(&lt;span class=&quot;code-quote&quot;&gt;&quot;38.15.154.224&quot;&lt;/span&gt;, 3128)); &lt;span class=&quot;code-comment&quot;&gt;//Set your own proxy
&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CloseableHttpAsyncClient client = clientBuilder.build();
        client.start();

        CountDownLatch latch = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CountDownLatch(1);

        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; requestUri = &lt;span class=&quot;code-quote&quot;&gt;&quot;https:&lt;span class=&quot;code-comment&quot;&gt;//www.google.com/&quot;&lt;/span&gt;;
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SimpleHttpRequest request = SimpleRequestBuilder.get(requestUri).build();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SimpleRequestProducer producer = SimpleRequestProducer.create(request);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; AsyncResponseConsumer&amp;lt;Message&amp;lt;HttpResponse, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]&amp;gt;&amp;gt; consumer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BasicResponseConsumer&amp;lt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BasicAsyncEntityConsumer());

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Executing request &quot;&lt;/span&gt; + request);
        FutureCallback&amp;lt;Message&amp;lt;HttpResponse, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]&amp;gt;&amp;gt; callback = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FutureCallback&amp;lt;Message&amp;lt;HttpResponse, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]&amp;gt;&amp;gt;() {

            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void completed(Message&amp;lt;HttpResponse, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]&amp;gt; response) {
                latch.countDown();
                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(response.getHead().getVersion() + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt; + response.getHead().getCode());
            }

            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void failed(Exception ex) {
                latch.countDown();
                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error executing HTTP request: &quot;&lt;/span&gt; + ex.getMessage());
            }

            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void cancelled() {
                latch.countDown();
                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;HTTP request execution cancelled&quot;&lt;/span&gt;);
            }

        };

        Future&amp;lt;Message&amp;lt;org.apache.hc.core5.http.HttpResponse, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]&amp;gt;&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; = client.execute(producer, consumer, callback);
        latch.await();
        &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;.get();

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Shutting down&quot;&lt;/span&gt;);
        client.close(CloseMode.GRACEFUL);
    }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The main part of the code is proxy. Due to a proxy, we can catch connect:&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Executing request GET https:&lt;span class=&quot;code-comment&quot;&gt;//www.google.com/
&lt;/span&gt;method: CONNECT
method: GET
HTTP/2.0 200
Shutting downProcess finished with exit code 0 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This helps us to throw our request to the server with custom headers:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13064767/13064767_image-2023-11-28-15-12-20-327.png&quot; height=&quot;133&quot; width=&quot;681&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;This won&apos;t work without the proxy, but if the client can catch it in the described case, could it catch the &quot;connect&quot; request every time?&lt;/p&gt;</comment>
                            <comment id="17790571" author="olegk" created="Tue, 28 Nov 2023 13:36:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marianbabii&quot; class=&quot;user-hover&quot; rel=&quot;marianbabii&quot;&gt;marianbabii&lt;/a&gt; I see. I will make sure CONNECT requests cannot be intercepted by all client implementations.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17790664" author="JIRAUSER303275" created="Tue, 28 Nov 2023 16:43:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;, just out of curiosity, what&apos;s wrong with the &quot;connect&quot; request, and why can&apos;t it be intercepted like any other request?&lt;/p&gt;</comment>
                            <comment id="17790974" author="olegk" created="Wed, 29 Nov 2023 08:33:37 +0000"  >&lt;p&gt;&amp;gt; what&apos;s wrong with the &quot;connect&quot; request, and why can&apos;t it be intercepted like any other request&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marianbabii&quot; class=&quot;user-hover&quot; rel=&quot;marianbabii&quot;&gt;marianbabii&lt;/a&gt; CONNECT method is precisely not like &quot;any other request&quot;. This is a special method that has distinct protocol requirements and requests of this method should not go through the same protocol processing pipeline as other methods.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17791619" author="olegk" created="Thu, 30 Nov 2023 12:44:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marianbabii&quot; class=&quot;user-hover&quot; rel=&quot;marianbabii&quot;&gt;marianbabii&lt;/a&gt; I would really appreciate if you could test this PR locally before it gets merged. Proxy related issues are extremely difficult to test and would very much appreciate some help&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-client/pull/516&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/pull/516&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please also let me know why you think one may need to intercept CONNECT requests and I may be able to propose an alternative solution&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17791641" author="JIRAUSER303275" created="Thu, 30 Nov 2023 13:59:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;, I can&apos;t reproduce intercepting a connect request using the branch you mentioned. I rechecked it with the released version (5.2.2) and intercepted the connect request, but it isn&apos;t working anymore with the fix.&#160;&lt;/p&gt;

&lt;p&gt;It seems like the fix works fine.&lt;/p&gt;

&lt;p&gt;IMHO, I think it&apos;s a good idea to have the possibility to intercept any requests, even the connect. If I want to modify a request before sending it (like adding extra headers, cookies, etc), I could create a new one (it&apos;s a cheap operation), and this is related to regular requests like GET, POST, and so on. Therefore, I don&apos;t need to intercept something for these requests.&lt;/p&gt;

&lt;p&gt;However, I can&apos;t create a connect request due to an exception, and there is no reason to do so. I can&apos;t add extra headers to this request, and a simple example is a &quot;Proxy-Authorization&quot; header to avoid 407 status code from a proxy server and re-creating a new connect request with the needed header. Or any other additional information to communicate with some specific servers. I guess it is a powerful tool, but its potential isn&apos;t full if we can only intercept requests that we can easily modify due to a re-creation, and at that moment, we can&apos;t do anything with the connection process (through proxy-server or directly).&#160;&lt;/p&gt;

&lt;p&gt;It would be a rare situation but could still be usable in some exceptional cases.&lt;/p&gt;</comment>
                            <comment id="17791674" author="olegk" created="Thu, 30 Nov 2023 15:15:22 +0000"  >&lt;p&gt;&amp;gt; It seems like the fix works fine.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marianbabii&quot; class=&quot;user-hover&quot; rel=&quot;marianbabii&quot;&gt;marianbabii&lt;/a&gt; Much appreciated. I was more concerned about breaking things in the process more than about the fix itself.&lt;/p&gt;

&lt;p&gt;&amp;gt; However, I can&apos;t create a connect request due to an exception, and there is no reason to do so&lt;/p&gt;

&lt;p&gt;There is. Status 200 response to CONNECT immediately puts the connection into the tunnel mode, which completely breaks the HttpClient message processing pipeline and connection management as well. For those cases when one needs to establish a tunnel through a proxy we provide `ProxyClient` class that does exactly that. &#160;&lt;/p&gt;

&lt;p&gt;&amp;gt; &#160;I can&apos;t add extra headers to this request, and a simple example is a &quot;Proxy-Authorization&quot; header to avoid 407 status code&lt;/p&gt;

&lt;p&gt;One should never meddle with CONNECT requests and should let HttpClient generate the correct `Proxy-Authorization` header by configuring `CredentialsProvider` in the HTTP execution context.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17791720" author="JIRAUSER303275" created="Thu, 30 Nov 2023 17:38:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;, I tested only with a simple realization like the one I pasted before, but everything looks ok.&lt;/p&gt;

&lt;p&gt;&apos;CredentialsProvider&apos; works well; the point here isn&apos;t about something wrong but about resources. It&apos;s not free to use proxies, and of course, it&apos;s not very expensive (in most cases), but if we do millions of requests daily, we would like to reduce some expenses (even 1-2%).&#160;&lt;br/&gt;
A similar situation is with opening a TCP connection: I&apos;d rather decline some invalid connections to the server (throw 503 if missing some extra data, whatever) than open a connection (that is not lightweight) and validate some tokens in headers after TCP is opened.&lt;/p&gt;

&lt;p&gt;As I mentioned before, these cases are really rare, but they are dependent on a load. The need to interfere with the connection process should not be the norm, but if one wants to do so, one must understand the risks of misusing the specification.&lt;/p&gt;

&lt;p&gt;Of course, these reasons are not enough to intercept a &quot;connect&quot; request, and it&apos;s an example of when I&apos;d like to use this functionality.&lt;/p&gt;</comment>
                            <comment id="17791751" author="olegk" created="Thu, 30 Nov 2023 19:28:34 +0000"  >&lt;p&gt;&amp;gt; It&apos;s not free to use proxies, and of course, it&apos;s not very expensive (in most cases), but if we do millions of requests daily, we would like to reduce some expenses (even 1-2%).&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marianbabii&quot; class=&quot;user-hover&quot; rel=&quot;marianbabii&quot;&gt;marianbabii&lt;/a&gt; I am not sure I understand. Are you referring to preemptive authentication here?&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17791948" author="JIRAUSER303275" created="Fri, 1 Dec 2023 08:32:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;, yes, my failure. I totally forgot about preemptive authentication and somehow tried to go around and use an interceptor to avoid an additional Connect request.&lt;/p&gt;

&lt;p&gt;I guess there are no more valuable reasons to intercept the connect request. &#160;I&apos;m glad I finally understood my failure, which helped to locate a bug with this request in the async client.&lt;/p&gt;

&lt;p&gt;Thanks for the response and help.&lt;/p&gt;</comment>
                            <comment id="17792358" author="jira-bot" created="Sat, 2 Dec 2023 10:31:48 +0000"  >&lt;p&gt;Commit f7ac968aaf499abe7858eb6cdc45ece0a26dda28 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=f7ac968aa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=f7ac968aa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2310&quot; title=&quot;Async client incorrectly pipes CONNECT requests through the main request protocol chain&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2310&quot;&gt;&lt;del&gt;HTTPCLIENT-2310&lt;/del&gt;&lt;/a&gt;: Async Connect exec handler incorrectly pipes CONNECT requests through the main request protocol chain&lt;/p&gt;</comment>
                            <comment id="17792359" author="olegk" created="Sat, 2 Dec 2023 10:33:10 +0000"  >&lt;p&gt;&amp;gt; I&apos;m glad I finally understood my failure&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marianbabii&quot; class=&quot;user-hover&quot; rel=&quot;marianbabii&quot;&gt;marianbabii&lt;/a&gt; I would not see this as a failure. It is a different way of approaching the problem. Thank you for your help.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13064766" name="image-2023-11-28-15-12-04-268.png" size="286470" author="marianbabii" created="Tue, 28 Nov 2023 13:12:04 +0000"/>
                            <attachment id="13064767" name="image-2023-11-28-15-12-20-327.png" size="286470" author="marianbabii" created="Tue, 28 Nov 2023 13:12:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 49 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1lua8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>