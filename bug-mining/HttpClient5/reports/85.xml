<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:22:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-2135] TLS handshake timeouts cannot be controlled through RequestConfig</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-2135</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;Apparently as a consequence of &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2091&quot; title=&quot;Connect timeout is used instead of socket timeout after a tls upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2091&quot;&gt;&lt;del&gt;HTTPCLIENT-2091&lt;/del&gt;&lt;/a&gt; and/or &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2099&quot; title=&quot;unlimited socket timeout results in the connect timeout being used as a socket timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2099&quot;&gt;&lt;del&gt;HTTPCLIENT-2099&lt;/del&gt;&lt;/a&gt;, TLS handshake timeouts can no longer be specified through any of the three &lt;tt&gt;RequestConfig&lt;/tt&gt; timeout parameters (connect, connection request, response). The only way to limit TLS handshake duration is through low-level socket configuration (socket timeout), which of course affects more than just TLS handshakes.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13358215">HTTPCLIENT-2135</key>
            <summary>TLS handshake timeouts cannot be controlled through RequestConfig</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rschmitt">Ryan Schmitt</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Feb 2021 18:37:42 +0000</created>
                <updated>Sat, 23 Oct 2021 17:57:28 +0000</updated>
                            <resolved>Sun, 12 Sep 2021 16:26:50 +0000</resolved>
                                    <version>5.0.3</version>
                                    <fixVersion>5.2-alpha1</fixVersion>
                                    <component>HttpClient (classic)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17283295" author="ckozak" created="Thu, 11 Feb 2021 18:48:34 +0000"  >&lt;p&gt;I&apos;ve configured the handshake timeout by setting a socket timeout in the socket configuration while also setting a default RequestConfig with a responseTimeout matching my expected timeout after the TLS handshake has succeeded.&lt;/p&gt;

&lt;p&gt;I agree that it&apos;s confusing, and the &quot;.setResponseTimeout&quot; suggests something different from the actual behavior. I&apos;ve been considering contributing something to split the request lifecycle timeouts into a few stages:&lt;/p&gt;

&lt;p&gt;1. connect timeout (already in place)&lt;br/&gt;
2. handshake timeout (can be done in a roundabout way)&lt;br/&gt;
3. request write socket timeout: Used as a socket timeout while writing the request headers and body to the socket&lt;br/&gt;
3. response timeout: Timeout used to block waiting for the first response byte from the remote server&lt;br/&gt;
4. response read socket timeout: Used as a socket timeout after the first response byte has been received.&lt;/p&gt;

&lt;p&gt;I&apos;ve mostly kept this idea to myself because I&apos;m not actively blocked, and unfortunately very busy with other work, but if it&apos;s useful to more people I can prioritize building the feature in my spare time.&lt;/p&gt;</comment>
                            <comment id="17283305" author="rschmitt" created="Thu, 11 Feb 2021 19:01:38 +0000"  >&lt;p&gt;For my use case, I wrote a simple wrapper that enforces the &lt;tt&gt;connectTimeout&lt;/tt&gt; during the TLS handshake:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TlsHandshakeTimeoutSocketFactory &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; LayeredConnectionSocketFactory {
        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; LayeredConnectionSocketFactory delegate;

        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; TlsHandshakeTimeoutSocketFactory(LayeredConnectionSocketFactory delegate) {
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.delegate = delegate;
        }

        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Socket createSocket(HttpContext context) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; delegate.createSocket(context);
        }

        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Socket connectSocket(TimeValue connectTimeout, Socket socket, HttpHost host, InetSocketAddress remoteAddress, InetSocketAddress localAddress, HttpContext context) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; soTimeout = socket.getSoTimeout();
            socket.setSoTimeout(connectTimeout.toMillisecondsIntBound());
            Socket ret = delegate.connectSocket(connectTimeout, socket, host, remoteAddress, localAddress,
                context);
            socket.setSoTimeout(soTimeout);
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ret;
        }

        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Socket createLayeredSocket(Socket socket, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; target, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; port, HttpContext context) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; delegate.createLayeredSocket(socket, target, port, context);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17284267" author="michael-o" created="Sat, 13 Feb 2021 17:37:35 +0000"  >&lt;p&gt;I consider &lt;tt&gt;RequestConfig&lt;/tt&gt; to apply to HTTP only and not a security layer below. So this class is evaluted when &lt;tt&gt;Application Data&lt;/tt&gt; kicks in.&lt;/p&gt;</comment>
                            <comment id="17284281" author="rschmitt" created="Sat, 13 Feb 2021 20:01:44 +0000"  >&lt;p&gt;In that case, why can &lt;tt&gt;RequestConfig&lt;/tt&gt;&apos;s &lt;tt&gt;connectTimeout&lt;/tt&gt; be used to control the timeout of TCP connection establishment? That&apos;s &lt;em&gt;two&lt;/em&gt; layers below!&lt;/p&gt;</comment>
                            <comment id="17284284" author="olegk" created="Sat, 13 Feb 2021 20:32:28 +0000"  >&lt;p&gt;&amp;gt;  why can RequestConfig&apos;s connectTimeout be used to control the timeout of TCP connection establishment? That&apos;s two layers below!&lt;/p&gt;

&lt;p&gt;That was my mistake. `#connectTimeout` should have never been added to `RequestConfig`.&lt;/p&gt;

&lt;p&gt;Oleg &lt;/p&gt;</comment>
                            <comment id="17413747" author="jira-bot" created="Sun, 12 Sep 2021 16:24:58 +0000"  >&lt;p&gt;Commit aa57120c91918491af8f9433efb321d611e31225 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=aa57120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=aa57120&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2135&quot; title=&quot;TLS handshake timeouts cannot be controlled through RequestConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2135&quot;&gt;&lt;del&gt;HTTPCLIENT-2135&lt;/del&gt;&lt;/a&gt;: support for a distinct handshake timeout (mainly intended for TLS/SSL) by the connection management APIs&lt;/p&gt;</comment>
                            <comment id="17413748" author="olegk" created="Sun, 12 Sep 2021 16:26:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt; Could you please take a look at my changes &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; and let me know if they resolve the issue to your satisfaction?&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/httpcomponents-client/commit/aa57120c91918491af8f9433efb321d611e31225&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/commit/aa57120c91918491af8f9433efb321d611e31225&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17414481" author="rschmitt" created="Mon, 13 Sep 2021 18:32:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt; I&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="17414602" author="rschmitt" created="Mon, 13 Sep 2021 21:46:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt; The intention is to fall back on the &lt;tt&gt;connectTimeout&lt;/tt&gt; when the &lt;tt&gt;handshakeTimeout&lt;/tt&gt; is not specified, right? This fallback logic appears to work for the classic client, but not the async client. The async client seems to wait forever for the handshake to finish.&lt;/p&gt;

&lt;p&gt;Meanwhile, on the classic client, I noticed that this connection timeout is being reported as a socket timeout, which then confuses our error handling (we report the error as a regular HTTP timeout, not as a connection timeout).&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.net.SocketTimeoutException: connect timed out
	at java.net.PlainSocketImpl.socketConnect(Native Method)
	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)
	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)
	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)
	at java.net.Socket.connect(Socket.java:607)
	at org.apache.hc.client5.http.socket.PlainConnectionSocketFactory.lambda$connectSocket$0(PlainConnectionSocketFactory.java:85)
	at java.security.AccessController.doPrivileged(Native Method)
	at org.apache.hc.client5.http.socket.PlainConnectionSocketFactory.connectSocket(PlainConnectionSocketFactory.java:84)
	at org.apache.hc.client5.http.impl.io.MultihomeSocketConnector.connect(MultihomeSocketConnector.java:70)
	at org.apache.hc.client5.http.impl.io.DefaultHttpClientConnectionOperator.connect(DefaultHttpClientConnectionOperator.java:131)
	at org.apache.hc.client5.http.impl.io.PoolingHttpClientConnectionManager.connect(PoolingHttpClientConnectionManager.java:418)
	at org.apache.hc.client5.http.impl.classic.InternalExecRuntime.connectEndpoint(InternalExecRuntime.java:159)
	at org.apache.hc.client5.http.impl.classic.InternalExecRuntime.connectEndpoint(InternalExecRuntime.java:169)
	at org.apache.hc.client5.http.impl.classic.ConnectExec.execute(ConnectExec.java:136)
	at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51)
	at org.apache.hc.client5.http.impl.classic.ProtocolExec.execute(ProtocolExec.java:166)
	at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51)
	at org.apache.hc.client5.http.impl.classic.HttpRequestRetryExec.execute(HttpRequestRetryExec.java:96)
	at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51)
	at org.apache.hc.client5.http.impl.classic.InternalHttpClient.doExecute(InternalHttpClient.java:179)
	at org.apache.hc.client5.http.impl.classic.CloseableHttpClient.execute(CloseableHttpClient.java:75)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I haven&apos;t had a chance yet to dig in to either of these issues and figure out exactly what is causing them. I also haven&apos;t had a chance to migrate to the new &lt;tt&gt;handshakeTimeout&lt;/tt&gt; and connection-layer configuration and see how it works.&lt;/p&gt;</comment>
                            <comment id="17414787" author="jira-bot" created="Tue, 14 Sep 2021 07:56:46 +0000"  >&lt;p&gt;Commit f911b055bb23cc3f6caa55d57e2111e4461e16a5 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=f911b05&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=f911b05&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2135&quot; title=&quot;TLS handshake timeouts cannot be controlled through RequestConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2135&quot;&gt;&lt;del&gt;HTTPCLIENT-2135&lt;/del&gt;&lt;/a&gt;: support for a distinct handshake timeout (mainly intended for TLS/SSL) by the connection management APIs&lt;/p&gt;</comment>
                            <comment id="17414788" author="olegk" created="Tue, 14 Sep 2021 07:57:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;This fallback logic appears to work for the classic client, but not the async client. The async client seems to wait forever for the handshake to finish.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt; I re-checked my changes. I do not see a reason why the fallback logic would not work.&lt;br/&gt;
 &lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/master/httpclient5/src/main/java/org/apache/hc/client5/http/impl/nio/DefaultAsyncClientConnectionOperator.java#L102&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/blob/master/httpclient5/src/main/java/org/apache/hc/client5/http/impl/nio/DefaultAsyncClientConnectionOperator.java#L102&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Meanwhile, on the classic client, I noticed that this connection timeout is being reported as a socket timeout, which then confuses our error handling&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That was my bad. Corrected.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17414797" author="jira-bot" created="Tue, 14 Sep 2021 08:15:35 +0000"  >&lt;p&gt;Commit 4b7057ed73ca287665d4fef2b23532a3547a3fd4 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=4b7057e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=4b7057e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2135&quot; title=&quot;TLS handshake timeouts cannot be controlled through RequestConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2135&quot;&gt;&lt;del&gt;HTTPCLIENT-2135&lt;/del&gt;&lt;/a&gt;: support for a distinct handshake timeout (mainly intended for TLS/SSL) by the connection management APIs&lt;/p&gt;</comment>
                            <comment id="17415170" author="rschmitt" created="Tue, 14 Sep 2021 21:01:30 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I do not see a reason why the fallback logic would not work.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You&apos;re right. It&apos;s not the &lt;em&gt;fallback&lt;/em&gt; logic that is broken, it&apos;s the handshake timeouts themselves.&lt;/p&gt;</comment>
                            <comment id="17415184" author="rschmitt" created="Tue, 14 Sep 2021 21:31:36 +0000"  >&lt;p&gt;I captured some logging statements to see what changed. Before:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
14 Sep 2021 14:19:49,018 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.core5.reactor.IOSessionImpl: c-0000000000[ACTIVE][rc:c] protocol upgrade &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.hc.core5.http2.impl.nio.ClientHttpProtocolNegotiator
14 Sep 2021 14:19:49,018 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.nio.MultihomeIOSessionRequester: https:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8444 connected c-0000000000 /127.0.0.1:57095-&amp;gt;localhost/127.0.0.1:8444
&lt;/span&gt;14 Sep 2021 14:19:49,020 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.nio.DefaultManagedAsyncClientConnection: c-0000000000 start TLS
14 Sep 2021 14:19:49,029 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.ssl.AbstractClientTlsStrategy: Enabled protocols: [TLSv1, TLSv1.1, TLSv1.2]
14 Sep 2021 14:19:49,029 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.ssl.AbstractClientTlsStrategy: Enabled cipher suites: [...]
14 Sep 2021 14:19:49,054 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.nio.PoolingAsyncClientConnectionManager: ep-0000000000 connected c-0000000000
14 Sep 2021 14:19:49,054 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.async.InternalHttpAsyncClient: ep-0000000000 endpoint connected
14 Sep 2021 14:19:49,054 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.async.AsyncConnectExec: ex-0000000001 connected to target
14 Sep 2021 14:19:49,054 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.async.AsyncConnectExec: ex-0000000001 route fully established
14 Sep 2021 14:19:49,055 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.async.HttpAsyncMainClientExec: ex-0000000001 executing GET /fuzz?size=1048576&amp;amp;duration=0&amp;amp;offset=0&amp;amp;chunked=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; HTTP/1.1
14 Sep 2021 14:19:49,057 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.async.InternalHttpAsyncClient: ep-0000000000 start execution ex-0000000001
14 Sep 2021 14:19:49,057 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.nio.PoolingAsyncClientConnectionManager: ep-0000000000 executing exchange ex-0000000001 over c-0000000000
14 Sep 2021 14:19:49,058 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.nio.DefaultManagedAsyncClientConnection: c-0000000000 RequestExecutionCommand with NORMAL priority
14 Sep 2021 14:19:49,058 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.core5.reactor.ssl.SSLIOSession: c-0000000000[ACTIVE][rw:c][ACTIVE][rw][NEED_UNWRAP][0][0][296] Enqueued RequestExecutionCommand with priority IMMEDIATE
14 Sep 2021 14:19:49,058 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.core5.reactor.ssl.SSLIOSession: c-0000000000[ACTIVE][rw:c][ACTIVE][rw][NEED_UNWRAP][0][0][296] Event cleared [c]
14 Sep 2021 14:19:52,069 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.core5.reactor.ssl.SSLIOSession: c-0000000000[ACTIVE][r:c][ACTIVE][rw][NEED_UNWRAP][0][0][0] Close IMMEDIATE
14 Sep 2021 14:19:52,070 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.async.HttpAsyncMainClientExec: ex-0000000001 execution failed: 2500 MILLISECONDS
14 Sep 2021 14:19:52,071 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.async.InternalAbstractHttpAsyncClient: ex-0000000001 request failed: 2500 MILLISECONDS
14 Sep 2021 14:19:52,071 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.nio.PoolingAsyncClientConnectionManager: ep-0000000000 close IMMEDIATE
14 Sep 2021 14:19:52,071 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.nio.DefaultManagedAsyncClientConnection: c-0000000000 Shutdown connection IMMEDIATE
14 Sep 2021 14:19:52,071 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.core5.reactor.ssl.SSLIOSession: c-0000000000[CLOSED][][CLOSED][rw][NEED_UNWRAP][0][0][0] Close IMMEDIATE
14 Sep 2021 14:19:52,071 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.async.InternalHttpAsyncClient: ep-0000000000 endpoint closed
14 Sep 2021 14:19:52,071 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.async.InternalHttpAsyncClient: ep-0000000000 discarding endpoint
14 Sep 2021 14:19:52,071 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.nio.PoolingAsyncClientConnectionManager: ep-0000000000 releasing endpoint
14 Sep 2021 14:19:52,071 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.nio.PoolingAsyncClientConnectionManager: ep-0000000000 connection released [route: {s}-&amp;gt;https:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8444][total available: 0; route allocated: 0 of 2147483647; total allocated: 0 of 2147483647]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
14 Sep 2021 14:18:21,099 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.core5.reactor.IOSessionImpl: c-0000000000[ACTIVE][rc:c] protocol upgrade &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.hc.core5.http2.impl.nio.ClientHttpProtocolNegotiator
14 Sep 2021 14:18:21,100 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.nio.MultihomeIOSessionRequester: https:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8444 connected c-0000000000 /127.0.0.1:56990-&amp;gt;localhost/127.0.0.1:8444
&lt;/span&gt;14 Sep 2021 14:18:21,104 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.impl.nio.DefaultManagedAsyncClientConnection: c-0000000000 start TLS
14 Sep 2021 14:18:21,113 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.ssl.AbstractClientTlsStrategy: Enabled protocols: [TLSv1, TLSv1.1, TLSv1.2]
14 Sep 2021 14:18:21,113 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.client5.http.ssl.AbstractClientTlsStrategy: Enabled cipher suites:[...]
14 Sep 2021 14:18:21,140 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.core5.reactor.ssl.SSLIOSession: c-0000000000[ACTIVE][rw:c][ACTIVE][r][NEED_UNWRAP][0][0][296] Event cleared [c]
14 Sep 2021 14:18:24,153 [DEBUG]  (httpclient-dispatch-1) org.apache.hc.core5.reactor.ssl.SSLIOSession: c-0000000000[ACTIVE][r:c][ACTIVE][r][NEED_UNWRAP][0][0][0] Close IMMEDIATE
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So the handshake is still timing out, but the exception isn&apos;t being reported. I&apos;m also not seeing the &quot;route fully established&quot; messages associated with successful TCP/IP connection establishment.&lt;/p&gt;</comment>
                            <comment id="17415442" author="olegk" created="Wed, 15 Sep 2021 11:04:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;So the handshake is still timing out, but the exception isn&apos;t being reported.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt; This might well be a regression caused by massive changes in the TLS layer due to &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2120&quot; title=&quot;Support HTTP/2 (TLS) Tunneling over HTTP-Proxy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2120&quot;&gt;&lt;del&gt;HTTPCLIENT-2120&lt;/del&gt;&lt;/a&gt; but could we tackle the original issue first and deal with regressions as the next step? So, are new `ConnectionConfig` settings good enough?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m also not seeing the &quot;route fully established&quot; messages associated with successful TCP/IP connection establishment.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The `route fully established` statement was actually fully wrong. The route cannot be considered fully established until the TLS handshake is successfully completed, which is presently not the case with 5.0 and 5.1 branches. This was one of the reasons for TLS changes in the 5.2 branch.&lt;/p&gt;</comment>
                            <comment id="17415653" author="rschmitt" created="Wed, 15 Sep 2021 17:23:20 +0000"  >&lt;p&gt;Makes sense, I&apos;ll try the &lt;tt&gt;ConnectionConfig&lt;/tt&gt; settings today and report back.&lt;/p&gt;</comment>
                            <comment id="17415741" author="rschmitt" created="Wed, 15 Sep 2021 20:28:53 +0000"  >&lt;p&gt;&lt;tt&gt;ConnectionConfig&lt;/tt&gt; looks great! Can we also move &lt;tt&gt;connectionTimeToLive&lt;/tt&gt; from the connection manager to &lt;tt&gt;ConnectionConfig&lt;/tt&gt;? It would be great if I could easily configure TLS connections to live longer than plaintext connections.&lt;/p&gt;

&lt;p&gt;Additionally, I noticed another bug in 5.2 involving connection attempt failures. Previously, when a connection attempt to a given hostname failed, the client would try again using a &lt;em&gt;different&lt;/em&gt; IP address. This no longer seems to occur. The relevant integration test uses HTTP, so we can discount the TLS layer.&lt;/p&gt;</comment>
                            <comment id="17416252" author="olegk" created="Thu, 16 Sep 2021 17:16:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;Additionally, I noticed another bug in 5.2 involving connection attempt failures.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt; Do you have a failing test case for that? The multi-home connect logic is still there. It just got moved into a separate support class &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Can we also move connectionTimeToLive from the connection manager to ConnectionConfig?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure. Will do.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/master/httpclient5/src/main/java/org/apache/hc/client5/http/impl/io/MultihomeSocketConnector.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/blob/master/httpclient5/src/main/java/org/apache/hc/client5/http/impl/io/MultihomeSocketConnector.java&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17416291" author="rschmitt" created="Thu, 16 Sep 2021 18:29:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;The multi-home connect logic is still there. It just got moved into a separate support class &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Nah, there&apos;s something screwy here. The logic in &lt;tt&gt;MultihomeSocketConnector&lt;/tt&gt; appears to be doing what it&apos;s supposed to be doing, but the connection retries on the known good address are failing nevertheless, with a &lt;tt&gt;java.net.SocketException&lt;/tt&gt;. Fortunately, the classic client is pretty easy to step through in a debugger, so I&apos;ll try to see what&apos;s going on.&lt;/p&gt;</comment>
                            <comment id="17416295" author="rschmitt" created="Thu, 16 Sep 2021 18:39:14 +0000"  >&lt;p&gt;The problem appears to be that you&apos;re reusing the same &lt;tt&gt;Socket&lt;/tt&gt;, the one passed as the first parameter to the &lt;tt&gt;connect&lt;/tt&gt; method. The retry is thus doomed to fail, because the &lt;tt&gt;Socket&lt;/tt&gt; is trashed from the previous (failed) connection attempt. It looks like this bug was introduced by the refactoring, since there was previously a &lt;tt&gt;Socket sock = sf.createSocket(context);&lt;/tt&gt; statement in the body of the &lt;tt&gt;for&lt;/tt&gt;-loop. The &lt;tt&gt;MultihomeSocketConnector&lt;/tt&gt; API will have to be changed somehow.&lt;/p&gt;</comment>
                            <comment id="17416312" author="olegk" created="Thu, 16 Sep 2021 19:54:14 +0000"  >&lt;p&gt;Ah, crap. I will roll back my changes. Thank you, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17416579" author="jira-bot" created="Fri, 17 Sep 2021 09:37:21 +0000"  >&lt;p&gt;Commit 677903e186424e2785bf849ee3145c7d9b3297e0 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=677903e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=677903e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2135&quot; title=&quot;TLS handshake timeouts cannot be controlled through RequestConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2135&quot;&gt;&lt;del&gt;HTTPCLIENT-2135&lt;/del&gt;&lt;/a&gt;: support for a distinct handshake timeout (mainly intended for TLS/SSL) by the connection management APIs&lt;/p&gt;</comment>
                            <comment id="17416589" author="olegk" created="Fri, 17 Sep 2021 09:44:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt;&#160;I reverted the changes to the multi-home connect code (just made logging a bit better). I also added the timeout handshake parameter to the `ConnectionSocketFactory`&#160; and `LayeredConnectionSocketFactory` methods.&lt;/p&gt;

&lt;p&gt;Please take another look.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17416869" author="rschmitt" created="Fri, 17 Sep 2021 18:56:15 +0000"  >&lt;p&gt;The connection retries work now, but the async handshake timeouts are still broken.&lt;/p&gt;</comment>
                            <comment id="17416909" author="olegk" created="Fri, 17 Sep 2021 20:45:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;the async handshake timeouts are still broken.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt; Some more details how exactly it fails would really help. I would really appreciate it if you could test the latest HttpCore master and see if it is actually a problem in core protocol components.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17416914" author="rschmitt" created="Fri, 17 Sep 2021 21:09:25 +0000"  >&lt;p&gt;Good point, I&apos;m still on 5.2-alpha1. I&apos;ll try the latest commit.&lt;/p&gt;</comment>
                            <comment id="17416926" author="olegk" created="Fri, 17 Sep 2021 21:23:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt;&#160;HttpCore master is presently exactly the same as 5.2a1. What would really help if you could reproduce the issue with the core alone without the entire client layer.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17417109" author="olegk" created="Sat, 18 Sep 2021 10:05:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt;&#160;I managed to reproduce the issue in my development environment. I am looking into it.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17417126" author="olegk" created="Sat, 18 Sep 2021 12:13:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt;&#160;Found the bug. It unfortunately in core SSL layer. We will need another HttpCore 5.2 release before we can proceed.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17417215" author="jira-bot" created="Sat, 18 Sep 2021 19:36:30 +0000"  >&lt;p&gt;Commit 6f791afa6151ed6394959f1bcaf11943bf6f93e2 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=6f791af&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=6f791af&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2135&quot; title=&quot;TLS handshake timeouts cannot be controlled through RequestConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2135&quot;&gt;&lt;del&gt;HTTPCLIENT-2135&lt;/del&gt;&lt;/a&gt;: support for a distinct handshake timeout (mainly intended for TLS/SSL) by the connection management APIs&lt;/p&gt;</comment>
                            <comment id="17417216" author="olegk" created="Sat, 18 Sep 2021 19:37:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt;&#160;Fixed in core &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/httpcomponents-core/commit/146c967dd4c56e7a5234e03e9aff16a694f335ac&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/commit/146c967dd4c56e7a5234e03e9aff16a694f335ac&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17417741" author="rschmitt" created="Mon, 20 Sep 2021 17:12:47 +0000"  >&lt;p&gt;Looks great now, all tests are passing. Other than the &lt;tt&gt;connectionTimeToLive&lt;/tt&gt; feature request I think this can be resolved.&lt;/p&gt;</comment>
                            <comment id="17417816" author="olegk" created="Mon, 20 Sep 2021 21:21:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt;&#160;That is good. I will deal with connection TTL setting in a separate change-set. I also want to try and move HTTP protocol policy to `ConnectionConfig` as well.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17421569" author="olegk" created="Tue, 28 Sep 2021 17:44:35 +0000"  >&lt;p&gt;&amp;gt;&#160;Other than the&#160;&lt;tt&gt;connectionTimeToLive&lt;/tt&gt;&#160;feature request I think this can be resolved.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt;&#160;It turns out I need to tweak PoolEntry in core for that.&lt;/p&gt;

&lt;p&gt;Another idea. What about having a dedicated structure, `TLSConfig` for instance, for all TLS handshake and ALPN settings, and move the handshake timeout from `ConnectionConfig` to&#160;`TLSConfig`?&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17422225" author="jira-bot" created="Wed, 29 Sep 2021 16:08:26 +0000"  >&lt;p&gt;Commit 29cbe330887174102878f517a6619f4dc1d0fde7 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=29cbe33&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=29cbe33&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2135&quot; title=&quot;TLS handshake timeouts cannot be controlled through RequestConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2135&quot;&gt;&lt;del&gt;HTTPCLIENT-2135&lt;/del&gt;&lt;/a&gt;: support for a distinct handshake timeout (mainly intended for TLS/SSL) by the connection management APIs&lt;/p&gt;</comment>
                            <comment id="17422230" author="jira-bot" created="Wed, 29 Sep 2021 16:17:06 +0000"  >&lt;p&gt;Commit bab304ae6bb166c26151b73edaa733289403454d in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=bab304a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=bab304a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2135&quot; title=&quot;TLS handshake timeouts cannot be controlled through RequestConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2135&quot;&gt;&lt;del&gt;HTTPCLIENT-2135&lt;/del&gt;&lt;/a&gt;: support for a distinct handshake timeout (mainly intended for TLS/SSL) by the connection management APIs&lt;/p&gt;</comment>
                            <comment id="17423284" author="jira-bot" created="Fri, 1 Oct 2021 13:21:02 +0000"  >&lt;p&gt;Commit 4a316fdaa00150128f6e1abb5f5ff1327683de81 in httpcomponents-client&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2135&quot; title=&quot;TLS handshake timeouts cannot be controlled through RequestConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2135&quot;&gt;&lt;del&gt;HTTPCLIENT-2135&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=4a316fd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=4a316fd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2135&quot; title=&quot;TLS handshake timeouts cannot be controlled through RequestConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2135&quot;&gt;&lt;del&gt;HTTPCLIENT-2135&lt;/del&gt;&lt;/a&gt;: TLS configuration on a per-host basis&lt;/p&gt;</comment>
                            <comment id="17423288" author="olegk" created="Fri, 1 Oct 2021 13:28:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt; Could you please take a look at &lt;a href=&quot;https://github.com/apache/httpcomponents-client/commit/4a316fdaa00150128f6e1abb5f5ff1327683de81&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/commit/4a316fdaa00150128f6e1abb5f5ff1327683de81&lt;/a&gt; and let me know if the proposed change is OK with you? The main idea is to enable per-host based TLS configuration similat to per-route connection configuration introduced earlier. Beside the handshake timeout TlsConfig would have settings for HTTP protocol negotiation, TLS version, enabled ciphers and so on.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17423521" author="jira-bot" created="Sat, 2 Oct 2021 13:16:31 +0000"  >&lt;p&gt;Commit 39d48479d7f964f3fb1844128bf491a5e09af624 in httpcomponents-client&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2135&quot; title=&quot;TLS handshake timeouts cannot be controlled through RequestConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2135&quot;&gt;&lt;del&gt;HTTPCLIENT-2135&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=39d4847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=39d4847&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2135&quot; title=&quot;TLS handshake timeouts cannot be controlled through RequestConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2135&quot;&gt;&lt;del&gt;HTTPCLIENT-2135&lt;/del&gt;&lt;/a&gt;: deprecated HTTP version policy setting on the client level&lt;/p&gt;</comment>
                            <comment id="17423546" author="jira-bot" created="Sat, 2 Oct 2021 15:19:15 +0000"  >&lt;p&gt;Commit fd0cf55bd2065b4440a25dc68ce351fe1bedcfcc in httpcomponents-client&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2135&quot; title=&quot;TLS handshake timeouts cannot be controlled through RequestConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2135&quot;&gt;&lt;del&gt;HTTPCLIENT-2135&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=fd0cf55&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=fd0cf55&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2135&quot; title=&quot;TLS handshake timeouts cannot be controlled through RequestConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2135&quot;&gt;&lt;del&gt;HTTPCLIENT-2135&lt;/del&gt;&lt;/a&gt;: added #supportedProtocols and #supportedCipherSuites attributes to TlsConfig&lt;/p&gt;</comment>
                            <comment id="17423618" author="rschmitt" created="Sun, 3 Oct 2021 01:40:44 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Beside the handshake timeout TlsConfig would have settings for HTTP protocol negotiation, TLS version, enabled ciphers and so on.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That mostly makes sense to me. I&apos;m not so sure that HTTP protocol negotiation would belong in there, since there are other approaches that aren&apos;t based on TLS (such as prior knowledge, and the new-deprecated HTTP Upgrade mechanism).&lt;/p&gt;</comment>
                            <comment id="17423640" author="olegk" created="Sun, 3 Oct 2021 07:00:32 +0000"  >&lt;p&gt;&amp;gt; That mostly makes sense to me. I&apos;m not so sure that HTTP protocol negotiation would belong in there, since there are other approaches that aren&apos;t based on TLS (such as prior knowledge, and the new-deprecated HTTP Upgrade mechanism)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt; HTTP protocol negotiation setting is directly equivalent to the TLS ALPN extension. It does not preclude us from using HTTP protocol negotiation setting elsewhere, should we decide to support HTTP upgrade mechanism for plain connections.&lt;/p&gt;

&lt;p&gt;Where would you have it instead? HTTP protocol policy at the client level seems too restrictive and misplaced to me.&lt;/p&gt;

&lt;p&gt;Oleg &lt;/p&gt;</comment>
                            <comment id="17428086" author="jira-bot" created="Wed, 13 Oct 2021 08:44:02 +0000"  >&lt;p&gt;Commit dde6afab2942010f56170a1ff5cfa47618ebac02 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=dde6afa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=dde6afa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2135&quot; title=&quot;TLS handshake timeouts cannot be controlled through RequestConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2135&quot;&gt;&lt;del&gt;HTTPCLIENT-2135&lt;/del&gt;&lt;/a&gt;: support for a distinct handshake timeout (mainly intended for TLS/SSL) by the connection management APIs&lt;/p&gt;</comment>
                            <comment id="17428093" author="jira-bot" created="Wed, 13 Oct 2021 08:51:21 +0000"  >&lt;p&gt;Commit 861c071ee4f74a287e7b94b0711045bb5a46d8cf in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=861c071&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=861c071&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2135&quot; title=&quot;TLS handshake timeouts cannot be controlled through RequestConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2135&quot;&gt;&lt;del&gt;HTTPCLIENT-2135&lt;/del&gt;&lt;/a&gt;: TLS configuration on a per-host basis&lt;/p&gt;</comment>
                            <comment id="17433312" author="jira-bot" created="Sat, 23 Oct 2021 16:34:44 +0000"  >&lt;p&gt;Commit b10d43f2bb810913c421eb1ad6fe08b277692750 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=b10d43f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=b10d43f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2135&quot; title=&quot;TLS handshake timeouts cannot be controlled through RequestConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2135&quot;&gt;&lt;del&gt;HTTPCLIENT-2135&lt;/del&gt;&lt;/a&gt;: TLS configuration on a per-host basis&lt;/p&gt;</comment>
                            <comment id="17433351" author="olegk" created="Sat, 23 Oct 2021 17:57:28 +0000"  >&lt;p&gt;&amp;gt; Other than the connectionTimeToLive feature request I think this can be resolved.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt; I added TTL setting to the ConnectionConfig per your request. I also updated the examples to make use of the new APIs. Please take a look:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-client/commit/a02455acb31ad7e676130d46d6a04bd97b76e957&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/commit/a02455acb31ad7e676130d46d6a04bd97b76e957&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/httpcomponents-client/commit/ffc8cd7585f13689170bae1e1b894f649b6581a7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/commit/ffc8cd7585f13689170bae1e1b894f649b6581a7&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 3 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0nlw8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>