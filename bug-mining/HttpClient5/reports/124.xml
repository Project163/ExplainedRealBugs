<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:23:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-2355] Error &quot;Chunked transfer encoding not allowed for HTTP/1.0&quot; with proxy and HttpClient 5.4</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-2355</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;Exception org.apache.hc.core5.http.ProtocolException: &quot;Chunked transfer encoding not allowed for HTTP/1.0&quot; is thrown when sending request through corporate proxy (using Spring&apos;s RestClient). That did not occur with HttpClient 5.3.&lt;/p&gt;

&lt;p&gt;Wire protocol (see below) shows proxy replies to CONNECT request with &quot;HTTP/1.&lt;b&gt;0&lt;/b&gt; 200 Connection Established&quot;. Since 5.4., this protocol version seems to be&#160; interpreted and set on the HTTP connection that is made after establishing the TLS connection through the TCP tunnel set up by the proxy.&lt;/p&gt;

&lt;p&gt;The corporate proxies are very hard to change to e.g. return &quot;HTTP/1.&lt;b&gt;1&lt;/b&gt; 200 ...&quot; instead.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Wire protocol&lt;/b&gt; (target and proxy host names have been replaced) :&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;h.i.i.DefaultHttpClientConnectionOperator http-outgoing-0 &lt;a href=&quot;http://PROXY_HOST:8080&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://PROXY_HOST:8080&lt;/a&gt; connected &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;h.i.i.PoolingHttpClientConnectionManager ep-0000000001 executing exchange ex-0000000001 over http-outgoing-0&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;org.apache.hc.client5.http.wire &#160; http-outgoing-0 &amp;gt;&amp;gt; &quot;CONNECT TARGET_HOST:443 HTTP/1.1&lt;span class=&quot;error&quot;&gt;&amp;#91;\r&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;\n&amp;#93;&lt;/span&gt;&quot;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;org.apache.hc.client5.http.wire &#160; http-outgoing-0 &amp;gt;&amp;gt; &quot;Host TARGET_HOST:443&lt;span class=&quot;error&quot;&gt;&amp;#91;\r&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;\n&amp;#93;&lt;/span&gt;&quot;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;org.apache.hc.client5.http.wire &#160; http-outgoing-0 &amp;gt;&amp;gt; &quot;User-Agent: ApacheHttpClient/5.4.1 (Java/17.&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;)&lt;span class=&quot;error&quot;&gt;&amp;#91;\r&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;\n&amp;#93;&lt;/span&gt;&quot;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;org.apache.hc.client5.http.wire &#160; http-outgoing-0 &amp;gt;&amp;gt; &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;\r&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;\n&amp;#93;&lt;/span&gt;&quot;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;org.apache.hc.client5.http.wire &#160; http-outgoing-0 &amp;lt;&amp;lt; &quot;HTTP/1.0 200 Connection Established&lt;span class=&quot;error&quot;&gt;&amp;#91;\r&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;\n&amp;#93;&lt;/span&gt;&quot;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;org.apache.hc.client5.http.wire &#160; http-outgoing-0 &amp;lt;&amp;lt; &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;\r&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;\n&amp;#93;&lt;/span&gt;&quot;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;h.i.i.DefaultHttpClientConnectionOperator http-outgoing-0 upgrading to TLS TARGET_HOST:443&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;o.a.h.c.ssl.AbstractClientTlsStrategy Secure session established&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;o.a.h.c.ssl.AbstractClientTlsStrategy negotiated protocol: TLSv1.3&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;h.i.i.DefaultHttpClientConnectionOperator http-outgoing-0 upgraded to TLS TARGET_HOST:443&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;o.a.h.c.h.impl.classic.MainClientExec ex-0000000001 executing POST /path HTTP/1.1&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;h.i.i.DefaultManagedHttpClientConnection http-outgoing-0 close connection IMMEDIATE&#160;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Stack trace:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;org.apache.hc.core5.http.ProtocolException: Chunked transfer encoding not allowed for HTTP/1.0&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.core5.http.protocol.RequestContent.process(RequestContent.java:127) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpcore5-5.3.1.jar:5.3.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.core5.http.protocol.DefaultHttpProcessor.process(DefaultHttpProcessor.java:107) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpcore5-5.3.1.jar:5.3.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.client5.http.impl.classic.MainClientExec.execute(MainClientExec.java:119) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpclient5-5.4.1.jar:5.4.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpclient5-5.4.1.jar:5.4.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.client5.http.impl.classic.ConnectExec.execute(ConnectExec.java:199) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpclient5-5.4.1.jar:5.4.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpclient5-5.4.1.jar:5.4.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.client5.http.impl.classic.ProtocolExec.execute(ProtocolExec.java:192) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpclient5-5.4.1.jar:5.4.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpclient5-5.4.1.jar:5.4.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.client5.http.impl.classic.ContentCompressionExec.execute(ContentCompressionExec.java:150) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpclient5-5.4.1.jar:5.4.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpclient5-5.4.1.jar:5.4.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.client5.http.impl.classic.HttpRequestRetryExec.execute(HttpRequestRetryExec.java:113) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpclient5-5.4.1.jar:5.4.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpclient5-5.4.1.jar:5.4.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.client5.http.impl.classic.RedirectExec.execute(RedirectExec.java:110) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpclient5-5.4.1.jar:5.4.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpclient5-5.4.1.jar:5.4.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.client5.http.impl.classic.InternalHttpClient.doExecute(InternalHttpClient.java:174) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpclient5-5.4.1.jar:5.4.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.client5.http.impl.classic.CloseableHttpClient.execute(CloseableHttpClient.java:87) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpclient5-5.4.1.jar:5.4.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.client5.http.impl.classic.CloseableHttpClient.execute(CloseableHttpClient.java:55) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpclient5-5.4.1.jar:5.4.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.apache.hc.client5.http.classic.HttpClient.executeOpen(HttpClient.java:183) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;httpclient5-5.4.1.jar:5.4.1&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; at org.springframework.http.client.HttpComponentsClientHttpRequest.executeInternal(HttpComponentsClientHttpRequest.java:99) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;spring-web-6.2.1.jar:6.2.1&amp;#93;&lt;/span&gt;&#160;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13605438">HTTPCLIENT-2355</key>
            <summary>Error &quot;Chunked transfer encoding not allowed for HTTP/1.0&quot; with proxy and HttpClient 5.4</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="polybios">V. S.</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Jan 2025 20:27:48 +0000</created>
                <updated>Wed, 5 Feb 2025 10:29:08 +0000</updated>
                            <resolved>Mon, 20 Jan 2025 17:43:53 +0000</resolved>
                                    <version>5.4.1</version>
                                    <fixVersion>5.4.2</fixVersion>
                    <fixVersion>5.5-alpha1</fixVersion>
                                    <component>HttpClient (classic)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17914440" author="jira-bot" created="Sun, 19 Jan 2025 12:45:29 +0000"  >&lt;p&gt;Commit a7f4db325c73f0b5036e2e40bc95b8a3c3d44a07 in httpcomponents-client&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2355&quot; title=&quot;Error &amp;quot;Chunked transfer encoding not allowed for HTTP/1.0&amp;quot; with proxy and HttpClient 5.4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2355&quot;&gt;&lt;del&gt;HTTPCLIENT-2355&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=a7f4db325&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=a7f4db325&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2355&quot; title=&quot;Error &amp;quot;Chunked transfer encoding not allowed for HTTP/1.0&amp;quot; with proxy and HttpClient 5.4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2355&quot;&gt;&lt;del&gt;HTTPCLIENT-2355&lt;/del&gt;&lt;/a&gt;: Reset protocol version in the execution context upon 200 response to CONNECT request&lt;/p&gt;</comment>
                            <comment id="17914441" author="olegk" created="Sun, 19 Jan 2025 12:54:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=polybios&quot; class=&quot;user-hover&quot; rel=&quot;polybios&quot;&gt;polybios&lt;/a&gt; Please review / test the proposed fix:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-client/compare/5.4.x...HTTPCLIENT-2355&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/compare/5.4.x...HTTPCLIENT-2355&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17914444" author="olegk" created="Sun, 19 Jan 2025 13:17:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=polybios&quot; class=&quot;user-hover&quot; rel=&quot;polybios&quot;&gt;polybios&lt;/a&gt; By the way, one should be able to work around the problem with the actual version of the client by explicitly setting the version hint on the request object&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpHost target = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HttpHost(&lt;span class=&quot;code-quote&quot;&gt;&quot;https&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;httpbin.org&quot;&lt;/span&gt;, 443);
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpHost proxy = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HttpHost(&lt;span class=&quot;code-quote&quot;&gt;&quot;http&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;, 8080);
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CloseableHttpClient httpclient = HttpClients.custom()
        .setProxy(proxy)
        .build()) {

    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RequestConfig config = RequestConfig.custom()
            .build();
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpGet request = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HttpGet(&lt;span class=&quot;code-quote&quot;&gt;&quot;/get&quot;&lt;/span&gt;);
    request.setVersion(HttpVersion.HTTP_1_1);
    request.setConfig(config);

    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Executing request &quot;&lt;/span&gt; + request.getMethod() + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt; + request.getUri() +
            &lt;span class=&quot;code-quote&quot;&gt;&quot; via &quot;&lt;/span&gt; + proxy);

    httpclient.execute(target, request, response -&amp;gt; {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;----------------------------------------&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(request + &lt;span class=&quot;code-quote&quot;&gt;&quot;-&amp;gt;&quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StatusLine(response));
        EntityUtils.consume(response.getEntity());
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    });
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17914446" author="garydgregory" created="Sun, 19 Jan 2025 14:27:57 +0000"  >&lt;p&gt;RE &lt;a href=&quot;https://github.com/apache/httpcomponents-client/compare/5.4.x...HTTPCLIENT-2355&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/compare/5.4.x...HTTPCLIENT-2355&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Is there a way to unit test this to avoid future regressions?&lt;/p&gt;</comment>
                            <comment id="17914460" author="abernal" created="Sun, 19 Jan 2025 15:19:45 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Just to understand your reasoning&#8212;wouldn&apos;t explicitly setting it to &lt;tt&gt;HttpVersion.HTTP_1_1&lt;/tt&gt; be clearer and more predictable? Is there a specific reason for preferring &lt;tt&gt;null&lt;/tt&gt; over &lt;tt&gt;HttpVersion.HTTP_1_1&lt;/tt&gt; in this case?&lt;/p&gt;</comment>
                            <comment id="17914463" author="JIRAUSER308408" created="Sun, 19 Jan 2025 15:32:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;&#160; Thanks! Unfortunately, that does not fix it. Same error still appears.&lt;br/&gt;
If I debug through it, the version in the context at the patched location (&lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/HTTPCLIENT-2355/httpclient5/src/main/java/org/apache/hc/client5/http/impl/classic/ConnectExec.java#L290)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/blob/HTTPCLIENT-2355/httpclient5/src/main/java/org/apache/hc/client5/http/impl/classic/ConnectExec.java#L290)&lt;/a&gt; is null / not set yet.&lt;/p&gt;

&lt;p&gt;Apparently, it&apos;s set at a later time here from endpointInfo.getProtocol() : &lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/HTTPCLIENT-2355/httpclient5/src/main/java/org/apache/hc/client5/http/impl/classic/ConnectExec.java#L196&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/blob/HTTPCLIENT-2355/httpclient5/src/main/java/org/apache/hc/client5/http/impl/classic/ConnectExec.java#L196&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I can trace this to a DefaultHttpClientManagedConnection. The version field is set here: &lt;a href=&quot;https://github.com/apache/httpcomponents-core/blob/master/httpcore5/src/main/java/org/apache/hc/core5/http/impl/io/DefaultBHttpClientConnection.java#L339&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/blob/master/httpcore5/src/main/java/org/apache/hc/core5/http/impl/io/DefaultBHttpClientConnection.java#L339&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;during this call &lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/HTTPCLIENT-2355/httpclient5/src/main/java/org/apache/hc/client5/http/impl/classic/ConnectExec.java#L244&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/blob/HTTPCLIENT-2355/httpclient5/src/main/java/org/apache/hc/client5/http/impl/classic/ConnectExec.java#L244&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17914599" author="jira-bot" created="Mon, 20 Jan 2025 10:33:44 +0000"  >&lt;p&gt;Commit b6f62fda3d377846a02d28923759a619c6fc1073 in httpcomponents-client&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2355&quot; title=&quot;Error &amp;quot;Chunked transfer encoding not allowed for HTTP/1.0&amp;quot; with proxy and HttpClient 5.4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2355&quot;&gt;&lt;del&gt;HTTPCLIENT-2355&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=b6f62fda3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=b6f62fda3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2355&quot; title=&quot;Error &amp;quot;Chunked transfer encoding not allowed for HTTP/1.0&amp;quot; with proxy and HttpClient 5.4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2355&quot;&gt;&lt;del&gt;HTTPCLIENT-2355&lt;/del&gt;&lt;/a&gt;: Reset protocol version in the execution context upon 200 response to CONNECT request&lt;/p&gt;</comment>
                            <comment id="17914609" author="olegk" created="Mon, 20 Jan 2025 10:50:30 +0000"  >&lt;p&gt;&amp;gt; wouldn&apos;t explicitly setting it to &lt;tt&gt;HttpVersion.HTTP_1_1&lt;/tt&gt; be clearer and more predictable? Is there a specific reason for preferring &lt;tt&gt;null&lt;/tt&gt; over &lt;tt&gt;HttpVersion.HTTP_1_1&lt;/tt&gt; in this case?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abernal&quot; class=&quot;user-hover&quot; rel=&quot;abernal&quot;&gt;abernal&lt;/a&gt; We cannot know at this point what protocol version it is going to be or even if it is going to be another protocol entirely. All we know the tunnel has been established using HTTP/1.0. Setting the protocol version to null (undefined) looks the best thing to do here and let the following exec interceptors sort out the protocol.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17914611" author="olegk" created="Mon, 20 Jan 2025 10:53:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=polybios&quot; class=&quot;user-hover&quot; rel=&quot;polybios&quot;&gt;polybios&lt;/a&gt; Please give new change-set a try&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-client/compare/5.4.x...HTTPCLIENT-2355&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/compare/5.4.x...HTTPCLIENT-2355&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17914727" author="JIRAUSER308408" created="Mon, 20 Jan 2025 16:33:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt; yes, taking that line out makes it work again. Btw., I can also see the &lt;tt&gt;Transfer-Encoding: chunked&lt;/tt&gt; header in the wire logs. - Thanks! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17914751" author="jira-bot" created="Mon, 20 Jan 2025 17:43:04 +0000"  >&lt;p&gt;Commit be62a1b726be40e8e3e5cacb3dc0dd40438a1623 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=be62a1b72&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=be62a1b72&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2355&quot; title=&quot;Error &amp;quot;Chunked transfer encoding not allowed for HTTP/1.0&amp;quot; with proxy and HttpClient 5.4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2355&quot;&gt;&lt;del&gt;HTTPCLIENT-2355&lt;/del&gt;&lt;/a&gt;, regression: Reset protocol version in the execution context upon 200 response to CONNECT request&lt;/p&gt;</comment>
                            <comment id="17914752" author="jira-bot" created="Mon, 20 Jan 2025 17:43:26 +0000"  >&lt;p&gt;Commit 8958b36cea49766554f1d01d908628b2fe953c94 in httpcomponents-client&apos;s branch refs/heads/5.4.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=8958b36ce&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=8958b36ce&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2355&quot; title=&quot;Error &amp;quot;Chunked transfer encoding not allowed for HTTP/1.0&amp;quot; with proxy and HttpClient 5.4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2355&quot;&gt;&lt;del&gt;HTTPCLIENT-2355&lt;/del&gt;&lt;/a&gt;, regression: Reset protocol version in the execution context upon 200 response to CONNECT request&lt;/p&gt;</comment>
                            <comment id="17914753" author="olegk" created="Mon, 20 Jan 2025 17:43:53 +0000"  >&lt;p&gt;Fixed in master and 5.4.x&lt;/p&gt;</comment>
                            <comment id="17923993" author="jira-bot" created="Wed, 5 Feb 2025 10:19:26 +0000"  >&lt;p&gt;Commit be62a1b726be40e8e3e5cacb3dc0dd40438a1623 in httpcomponents-client&apos;s branch refs/heads/dependabot/maven/org.junit-junit-bom-5.11.4 from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=be62a1b72&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=be62a1b72&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2355&quot; title=&quot;Error &amp;quot;Chunked transfer encoding not allowed for HTTP/1.0&amp;quot; with proxy and HttpClient 5.4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2355&quot;&gt;&lt;del&gt;HTTPCLIENT-2355&lt;/del&gt;&lt;/a&gt;, regression: Reset protocol version in the execution context upon 200 response to CONNECT request&lt;/p&gt;</comment>
                            <comment id="17923998" author="jira-bot" created="Wed, 5 Feb 2025 10:22:36 +0000"  >&lt;p&gt;Commit be62a1b726be40e8e3e5cacb3dc0dd40438a1623 in httpcomponents-client&apos;s branch refs/heads/dependabot/maven/log4j.version-2.24.3 from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=be62a1b72&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=be62a1b72&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2355&quot; title=&quot;Error &amp;quot;Chunked transfer encoding not allowed for HTTP/1.0&amp;quot; with proxy and HttpClient 5.4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2355&quot;&gt;&lt;del&gt;HTTPCLIENT-2355&lt;/del&gt;&lt;/a&gt;, regression: Reset protocol version in the execution context upon 200 response to CONNECT request&lt;/p&gt;</comment>
                            <comment id="17924003" author="jira-bot" created="Wed, 5 Feb 2025 10:24:12 +0000"  >&lt;p&gt;Commit be62a1b726be40e8e3e5cacb3dc0dd40438a1623 in httpcomponents-client&apos;s branch refs/heads/dependabot/maven/testcontainers.version-1.20.4 from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=be62a1b72&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=be62a1b72&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2355&quot; title=&quot;Error &amp;quot;Chunked transfer encoding not allowed for HTTP/1.0&amp;quot; with proxy and HttpClient 5.4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2355&quot;&gt;&lt;del&gt;HTTPCLIENT-2355&lt;/del&gt;&lt;/a&gt;, regression: Reset protocol version in the execution context upon 200 response to CONNECT request&lt;/p&gt;</comment>
                            <comment id="17924009" author="jira-bot" created="Wed, 5 Feb 2025 10:29:08 +0000"  >&lt;p&gt;Commit be62a1b726be40e8e3e5cacb3dc0dd40438a1623 in httpcomponents-client&apos;s branch refs/heads/dependabot/maven/com.googlecode.maven-download-plugin-download-maven-plugin-1.13.0 from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=be62a1b72&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=be62a1b72&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2355&quot; title=&quot;Error &amp;quot;Chunked transfer encoding not allowed for HTTP/1.0&amp;quot; with proxy and HttpClient 5.4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2355&quot;&gt;&lt;del&gt;HTTPCLIENT-2355&lt;/del&gt;&lt;/a&gt;, regression: Reset protocol version in the execution context upon 200 response to CONNECT request&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            39 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1toyo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>