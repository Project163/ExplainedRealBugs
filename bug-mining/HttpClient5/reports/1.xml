<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:21:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-1715] NTLMEngineImpl.Type1Message not thread safe but declared as a constant</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-1715</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;&lt;tt&gt;NTLMEngineImpl&lt;/tt&gt; declares a &lt;tt&gt;static final&lt;/tt&gt; member named &lt;tt&gt;TYPE_1_MESSAGE&lt;/tt&gt; of type &lt;tt&gt;Type1Message&lt;/tt&gt;. Members of &lt;tt&gt;Type1Message&lt;/tt&gt; are final and do not change, but that is not the case for members of its superclass &lt;tt&gt;NTLMMessage&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Whenever the method &lt;tt&gt;NTLMEngineImpl#getType1Message(String, String)&lt;/tt&gt; is called, the method &lt;tt&gt;NTLMMessage#getResponse()&lt;/tt&gt; get called on the &lt;tt&gt;TYPE_1_MESSAGE&lt;/tt&gt; instance and this modifies the following members of &lt;tt&gt;NTLMMessage&lt;/tt&gt;:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;messageContents&lt;/li&gt;
	&lt;li&gt;currentOutputPosition&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This is not thread safe and we get exceptions as seen in &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1686&quot; title=&quot;Threadsafe CloseableHttpClient uses non-threadsafe NTLMScheme, causing errors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-1686&quot;&gt;&lt;del&gt;HTTPCLIENT-1686&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;My guess is that the computed response string should be kept in a constant instead of a &lt;tt&gt;Type1Message&lt;/tt&gt; instance.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12934172">HTTPCLIENT-1715</key>
            <summary>NTLMEngineImpl.Type1Message not thread safe but declared as a constant</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="olafontaine@gmail.com">Olivier Lafontaine</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Jan 2016 18:01:50 +0000</created>
                <updated>Thu, 4 May 2017 09:49:12 +0000</updated>
                            <resolved>Wed, 27 Jan 2016 08:35:01 +0000</resolved>
                                    <version>4.5.1</version>
                                    <fixVersion>4.5.2</fixVersion>
                    <fixVersion>5.0 Alpha2</fixVersion>
                                    <component>HttpClient (classic)</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15118014" author="garydgregory" created="Tue, 26 Jan 2016 21:02:50 +0000"  >&lt;p&gt;Something like this perhaps:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;### Eclipse Workspace Patch 1.0
#P httpclient5
Index: src/main/java/org/apache/hc/client5/http/impl/auth/NTLMEngineImpl.java
===================================================================
--- src/main/java/org/apache/hc/client5/http/impl/auth/NTLMEngineImpl.java	(revision 1726895)
+++ src/main/java/org/apache/hc/client5/http/impl/auth/NTLMEngineImpl.java	(working copy)
@@ -98,7 +98,7 @@
         SIGNATURE[bytesWithoutNull.length] = (byte) 0x00;
     }
 
-    private static final Type1Message TYPE_1_MESSAGE = new Type1Message();
+    private static final String TYPE_1_MESSAGE = new Type1Message().getResponse();
 
     /**
      * Returns the response for the given message.
@@ -145,7 +145,7 @@
     static String getType1Message(final String host, final String domain) {
         // For compatibility reason do not include domain and host in type 1 message
         //return new Type1Message(domain, host).getResponse();
-        return TYPE_1_MESSAGE.getResponse();
+        return TYPE_1_MESSAGE;
     }
 
     /**
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Unless we can make the superclass thread safe, which would be generally more useful.&lt;/p&gt;</comment>
                            <comment id="15118022" author="olafontaine@gmail.com" created="Tue, 26 Jan 2016 21:06:21 +0000"  >&lt;p&gt;Yes!&lt;/p&gt;</comment>
                            <comment id="15118041" author="garydgregory" created="Tue, 26 Jan 2016 21:12:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ralph_goers%40dslextreme.com&quot; class=&quot;user-hover&quot; rel=&quot;ralph_goers@dslextreme.com&quot;&gt;ralph_goers@dslextreme.com&lt;/a&gt;: Do you think we should find a way to make &lt;tt&gt;NTLMMessage&lt;/tt&gt; thread-safe? Or is my proposal good enough?&lt;/p&gt;</comment>
                            <comment id="15118098" author="ralph.goers@dslextreme.com" created="Tue, 26 Jan 2016 21:40:09 +0000"  >&lt;p&gt;Where can I find the code to look at?&lt;/p&gt;</comment>
                            <comment id="15118149" author="garydgregory" created="Tue, 26 Jan 2016 22:06:56 +0000"  >&lt;p&gt;In this JIRA as a comment.&lt;/p&gt;</comment>
                            <comment id="15118260" author="ralph.goers@dslextreme.com" created="Tue, 26 Jan 2016 23:24:25 +0000"  >&lt;p&gt;Where is the full source of what you are modifying?&lt;/p&gt;</comment>
                            <comment id="15118312" author="garydgregory" created="Tue, 26 Jan 2016 23:57:55 +0000"  >&lt;p&gt;svn trunk: &amp;#8212; src/main/java/org/apache/hc/client5/http/impl/auth/NTLMEngineImpl.java (revision 1726895)&lt;/p&gt;</comment>
                            <comment id="15118394" author="garydgregory" created="Wed, 27 Jan 2016 01:06:10 +0000"  >&lt;p&gt;Oops, I mean to ask &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15118837" author="garydgregory" created="Wed, 27 Jan 2016 08:13:45 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;I read:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /**
     * Creates the first message (type 1 message) in the NTLM authentication
     * sequence. This message includes the user name, domain and host &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the
     * authentication session.
     *
     * @param host
     *            the computer name of the host requesting authentication.
     * @param domain
     *            The domain to authenticate with.
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; the message to add to the HTTP request header.
     */
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getType1Message(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; host, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; domain) {
        &lt;span class=&quot;code-comment&quot;&gt;// For compatibility reason &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not include domain and host in type 1 message
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Type1Message(domain, host).getResponse();
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; TYPE_1_MESSAGE.getResponse();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Reading &quot;For compatibility reason&quot;, I wonder: Compatibility with what? Our version 3, 4? We could change this now in version 5. What is the best behavior?&lt;/p&gt;</comment>
                            <comment id="15118866" author="garydgregory" created="Wed, 27 Jan 2016 08:35:01 +0000"  >&lt;p&gt;Fixed in the 4.5.x branch and in trunk. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="15118872" author="garydgregory" created="Wed, 27 Jan 2016 08:39:25 +0000"  >&lt;p&gt;FYI: Deployed SNAPSHOT build to &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15118875" author="kwright@metacarta.com" created="Wed, 27 Jan 2016 08:43:54 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;As you may know, this NTLM implementation was constructed from specifications developed by reverse engineering the proprietary NTLM protocol on various versions of Windows.  There is no &quot;best behavior&quot; because everything has to be tested against multiple windows versions.  The reverse engineered specification includes a place for domain and host in the Type 1 message, but many windows versions do not seem to set these values, and we could not guarantee that setting them would not cause trouble in some instances.&lt;/p&gt;</comment>
                            <comment id="15118881" author="garydgregory" created="Wed, 27 Jan 2016 08:47:04 +0000"  >&lt;p&gt;OK, so IOW, leave it as is. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15119170" author="olafontaine@gmail.com" created="Wed, 27 Jan 2016 12:41:39 +0000"  >&lt;p&gt;Great news! Thank you very much for this fast resolution!&lt;/p&gt;</comment>
                            <comment id="15119187" author="olafontaine@gmail.com" created="Wed, 27 Jan 2016 12:54:07 +0000"  >&lt;p&gt;There&apos;s no due date for version 4.5.2. Any idea when it will be released?&lt;/p&gt;</comment>
                            <comment id="15119910" author="garydgregory" created="Wed, 27 Jan 2016 18:11:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olafontaine&quot; class=&quot;user-hover&quot; rel=&quot;olafontaine&quot;&gt;olafontaine&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;There is no due date indeed. If you scan the ML, you&apos;ll find that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt; has guesstimated a mid-February tentative goal for a 4.5.2. release. YMMV. Feel free to provide patches for outstanding fixes of course. &lt;/p&gt;

&lt;p&gt;Thank you,&lt;br/&gt;
Gary&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12901351">HTTPCLIENT-1686</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 42 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rzif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>