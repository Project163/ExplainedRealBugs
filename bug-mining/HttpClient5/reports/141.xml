<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:23:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-2391] Bug in closing AbstractHttpAsyncClientBase causing long-lived classloaders</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-2391</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;We have identified a bug in the closing mechanism of the executor service for &lt;tt&gt;AbstractHttpAsyncClientBase&lt;/tt&gt;. The executor service is created as a single-thread executor, specifically an &lt;tt&gt;AutoShutdownDelegatedExecutorService&lt;/tt&gt;. This class creates a phantom reference that is cleanable to the executor service it delegates to.&lt;/p&gt;
&lt;h4&gt;&lt;a name=&quot;IssueDetails%3A&quot;&gt;&lt;/a&gt;&lt;b&gt;Issue Details:&lt;/b&gt;&lt;/h4&gt;
&lt;ul&gt;
	&lt;li&gt;The&#160;&lt;tt&gt;AutoShutdownDelegatedExecutorService&lt;/tt&gt;&#160;correctly calls the&#160;&lt;tt&gt;shutdownNow()&lt;/tt&gt;&#160;method on the underlying executor service.&lt;/li&gt;
	&lt;li&gt;However, the phantom reference is never dereferenced and remains held internally.&lt;/li&gt;
	&lt;li&gt;When used with dynamic class loading, this results in a classloader hook that remains active, leading to long-lived classloaders that block non-heap memory.&lt;/li&gt;
&lt;/ul&gt;


&lt;h4&gt;&lt;a name=&quot;ProposedSolution%3A&quot;&gt;&lt;/a&gt;&lt;b&gt;Proposed Solution:&lt;/b&gt;&lt;/h4&gt;

&lt;p&gt;&lt;b&gt;Call shutdown() after shutdownNow() -&lt;/b&gt; Implement logic to ensure that the phantom reference is properly dereferenced&lt;/p&gt;
&lt;h4&gt;&lt;a name=&quot;Benefits%3A&quot;&gt;&lt;/a&gt;&lt;b&gt;Benefits:&lt;/b&gt;&lt;/h4&gt;
&lt;ul&gt;
	&lt;li&gt;Fixing this bug will prevent classloader hooks from hanging and ensure that non-heap memory is not blocked by long-lived classloaders.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Implementing this change will significantly enhance the resource management and reliability of the executor service in our application.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13627445">HTTPCLIENT-2391</key>
            <summary>Bug in closing AbstractHttpAsyncClientBase causing long-lived classloaders</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="koszta5">Pavel Kostelnik</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Aug 2025 10:31:21 +0000</created>
                <updated>Tue, 16 Sep 2025 12:00:37 +0000</updated>
                            <resolved>Tue, 16 Sep 2025 12:00:37 +0000</resolved>
                                    <version>5.5</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>5.6-alpha1</fixVersion>
                                    <component>HttpClient (async)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="18016551" author="koszta5" created="Wed, 27 Aug 2025 13:33:55 +0000"  >&lt;p&gt;I have prepared a fork with a fix, testing it now&lt;/p&gt;</comment>
                            <comment id="18016742" author="olegk" created="Thu, 28 Aug 2025 10:11:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=koszta5&quot; class=&quot;user-hover&quot; rel=&quot;koszta5&quot;&gt;koszta5&lt;/a&gt; Please submit the proposed fix as a PR at GitHub or as a patch by attaching it to this ticket.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="18019194" author="olegk" created="Tue, 9 Sep 2025 16:18:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=koszta5&quot; class=&quot;user-hover&quot; rel=&quot;koszta5&quot;&gt;koszta5&lt;/a&gt; Please do feel free to re-open once you have a proposed fix or a reproducer&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="18019847" author="koszta5" created="Fri, 12 Sep 2025 13:30:30 +0000"  >&lt;p&gt;reopenoning to submit a PR&lt;/p&gt;</comment>
                            <comment id="18019849" author="koszta5" created="Fri, 12 Sep 2025 13:31:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;&#160; - PR submitted - &lt;a href=&quot;https://github.com/apache/httpcomponents-client/pull/721&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/pull/721&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="18020062" author="olegk" created="Sat, 13 Sep 2025 20:22:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=koszta5&quot; class=&quot;user-hover&quot; rel=&quot;koszta5&quot;&gt;koszta5&lt;/a&gt; Please test locally the proposed fix:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-client/pull/722&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/pull/722&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="18020650" author="jira-bot" created="Tue, 16 Sep 2025 11:50:36 +0000"  >&lt;p&gt;Commit 694394ca8f5bb05eb36f9ec70ab8101a3859ed49 in httpcomponents-client&apos;s branch refs/heads/5.5.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=694394ca8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=694394ca8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2391&quot; title=&quot;Bug in closing AbstractHttpAsyncClientBase causing long-lived classloaders&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2391&quot;&gt;&lt;del&gt;HTTPCLIENT-2391&lt;/del&gt;&lt;/a&gt;: improved GRACEGUL shutdown of ExecutorService used internally by async clients&lt;/p&gt;</comment>
                            <comment id="18020652" author="jira-bot" created="Tue, 16 Sep 2025 11:56:30 +0000"  >&lt;p&gt;Commit 91d32f87846401bf64a427ebe510f3d817fb9c93 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=91d32f878&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=91d32f878&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2391&quot; title=&quot;Bug in closing AbstractHttpAsyncClientBase causing long-lived classloaders&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2391&quot;&gt;&lt;del&gt;HTTPCLIENT-2391&lt;/del&gt;&lt;/a&gt;: improved GRACEGUL shutdown of ExecutorService used internally by async clients&lt;/p&gt;</comment>
                            <comment id="18020654" author="olegk" created="Tue, 16 Sep 2025 12:00:37 +0000"  >&lt;p&gt;Fixed in 5.5.x and master.&lt;/p&gt;

&lt;p&gt;Olegg&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13078122" name="bugClient.png" size="171876" author="koszta5" created="Wed, 27 Aug 2025 10:31:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>java</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1xfwg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>