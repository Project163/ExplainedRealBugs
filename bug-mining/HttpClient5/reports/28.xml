<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:21:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-1924] connection leak issue when OutOfMemory</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-1924</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;&lt;b&gt;Yesterday, I found one of our java app is&#160;continuously throwing the following exception:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;_org.apache.http.conn.ConnectionPoolTimeoutException: Timeout waiting for connection from pool&lt;br/&gt;
 at org.apache.http.impl.conn.PoolingHttpClientConnectionManager.leaseConnection(PoolingHttpClientConnectionManager.java:313)&lt;br/&gt;
 at org.apache.http.impl.conn.PoolingHttpClientConnectionManager$1.get(PoolingHttpClientConnectionManager.java:279)&lt;br/&gt;
 at org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:191)&lt;br/&gt;
 at org.apache.http.impl.execchain.ProtocolExec.execute(ProtocolExec.java:185)&lt;br/&gt;
 at org.apache.http.impl.execchain.RedirectExec.execute(RedirectExec.java:111)&lt;br/&gt;
 at org.apache.http.impl.client.InternalHttpClient.doExecute(InternalHttpClient.java:185)&lt;br/&gt;
 at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:83)&lt;br/&gt;
 at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:108)&lt;br/&gt;
 at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:56)_&lt;/p&gt;

&lt;p&gt;&lt;em&gt;at .....&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;So I look into the log, I found that before this exception occurs, there are some `OutOfMemoryError`s (there are many different type of OutOfMemoryError, I just copy&amp;amp;paste the most interesting one):&lt;/b&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;java.lang.OutOfMemoryError: GC overhead limit exceeded&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at org.apache.http.util.CharArrayBuffer.substringTrimmed(CharArrayBuffer.java:466)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at org.apache.http.message.BasicLineParser.parseProtocolVersion(BasicLineParser.java:163)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at org.apache.http.message.BasicLineParser.parseStatusLine(BasicLineParser.java:366)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:158)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:56)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at org.apache.http.impl.io.AbstractMessageParser.parse(AbstractMessageParser.java:259)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at org.apache.http.impl.DefaultBHttpClientConnection.receiveResponseHeader(DefaultBHttpClientConnection.java:163)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at org.apache.http.impl.conn.CPoolProxy.receiveResponseHeader(CPoolProxy.java:165)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at org.apache.http.protocol.HttpRequestExecutor.doReceiveResponse(HttpRequestExecutor.java:273)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at org.apache.http.protocol.HttpRequestExecutor.execute(HttpRequestExecutor.java:125)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:272)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at org.apache.http.impl.execchain.ProtocolExec.execute(ProtocolExec.java:185)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at org.apache.http.impl.execchain.RedirectExec.execute(RedirectExec.java:111)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at org.apache.http.impl.client.InternalHttpClient.doExecute(InternalHttpClient.java:185)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:83)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:108)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at ........&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)&lt;/em&gt;&lt;br/&gt;
 at java.lang.Thread.run(Thread.java:745)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;I look into the source code of httpClient, and found that when the `OutOfMemoryError` is occur at the exacting place, the `HttpConnection` will never be get released, so it will leak, and never to be reused any more, so the following http call will be rejected,&#160; that&apos;s why `Timeout waiting for connection from pool` is&#160;*continuously trigged, even after&#160;my system have been recovered from the `GC` problem, this problem will never auto back to normal. so at this point to resolve this problem, my only choice is to fully restart my system.&lt;/b&gt;*&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13165247">HTTPCLIENT-1924</key>
            <summary>connection leak issue when OutOfMemory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="after_sss">wenqi.huang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jun 2018 06:08:49 +0000</created>
                <updated>Mon, 27 Feb 2023 05:11:03 +0000</updated>
                            <resolved>Sun, 17 Jun 2018 08:57:12 +0000</resolved>
                                    <version>4.5.3</version>
                    <version>4.5.4</version>
                    <version>4.5.5</version>
                                    <fixVersion>4.5.6</fixVersion>
                    <fixVersion>5.0 Beta2</fixVersion>
                                    <component>HttpClient (classic)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16510888" author="olegk" created="Wed, 13 Jun 2018 09:50:37 +0000"  >&lt;p&gt;I am yet to see a complex application that can gracefully recover from &lt;tt&gt;OutOfMemoryError&lt;/tt&gt; without a restart. HttpClient does not attempt to handle &lt;tt&gt;java.lang.Error&lt;/tt&gt;&#160;as they are considered fatal. If the JRE is in the &lt;tt&gt;OutOfMemoryError&lt;/tt&gt; condition complex operations such as an attempt to release a connection back to the pool is likely to cause more of &lt;tt&gt;OutOfMemoryError&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;What might be a reasonable thing to do in such situation is to flush the entire connection pool. I&apos;ll look into it.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16515027" author="olegk" created="Sun, 17 Jun 2018 08:57:12 +0000"  >&lt;p&gt;I made HttpClient to attempt to shut down its connection manager if a fatal error occurs in the course of a request execution.&lt;/p&gt;</comment>
                            <comment id="16910918" author="after_sss" created="Tue, 20 Aug 2019 02:08:09 +0000"  >&lt;p&gt;But our application  can just recover from  `OutOfMemoryError`,  we got `OutOfMemoryError` when some user export a file, because we load the total file into the memory,  it will soon use up all the memory. But when the export thread finished, the memory used by the file will soon be freed, so the entire application is recovered. All looks good until one day we meet `ConnectionPoolTimeoutException`.&lt;/p&gt;</comment>
                            <comment id="17693790" author="qxo" created="Mon, 27 Feb 2023 05:11:03 +0000"  >&lt;p&gt;ca98ad69a 20180616_10:33 Oleg Kalnichevski &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1924&quot; title=&quot;connection leak issue when OutOfMemory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-1924&quot;&gt;&lt;del&gt;HTTPCLIENT-1924&lt;/del&gt;&lt;/a&gt;: HttpClient to shut down the connection manager if a fatal error occurs in the course o... This commit should be reviewed, please!&#160;&lt;/p&gt;

&lt;p&gt;ref: &#160;&lt;a href=&quot;https://github.com/apache/httpcomponents-client/commit/ca98ad69adad79de57d8b944ba524f7267a795cb#diff-0f014e19e7deac908eabc9d7ff104061731a3a0e87102c7d21b70092f8ad0cc3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/commit/ca98ad69adad79de57d8b944ba524f7267a795cb#diff-0f014e19e7deac908eabc9d7ff104061731a3a0e87102c7d21b70092f8ad0cc3&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;shutdown the connection manager is inappropriate and meaningless, the app is still unavailable anyway, and we have to restart the app!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13526144">HTTPCORE-735</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3uprr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>