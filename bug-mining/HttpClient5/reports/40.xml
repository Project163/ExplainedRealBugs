<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:22:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-1992] Impossible to access trailer-headers available in chunked transfer-encoding</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-1992</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;Message trailers in chunked messaging are being&#160;&lt;a href=&quot;http://hc.apache.org/httpcomponents-core-5.0.x/httpcore5/xref/org/apache/hc/core5/http/impl/io/ChunkedInputStream.html#L284&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;parsed&lt;/a&gt;&#160;and&#160;&lt;a href=&quot;http://hc.apache.org/httpcomponents-core-5.0.x/httpcore5/xref/org/apache/hc/core5/http/impl/io/ChunkedInputStream.html#L88&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;kept in ChunkedInputStream&lt;/a&gt;. The&#160;parsed trailer headers are exposed with&#160;&lt;a href=&quot;http://hc.apache.org/httpcomponents-core-5.0.x/httpcore5/xref/org/apache/hc/core5/http/impl/io/ChunkedInputStream.html#L321&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;getFooters()&lt;/a&gt;&#160;method. However, there is no caller of this method in the entire call stack during a chunked messaging (both in version 4 and 5).&lt;/p&gt;

&lt;p&gt;HttpClient 5 brings the support for message trailers by creating an API in HttpEntity interface named as&#160;&lt;a href=&quot;https://hc.apache.org/httpcomponents-core-5.0.x/httpcore5/apidocs/org/apache/hc/core5/http/HttpEntity.html#getTrailers(&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;getTrailers().&lt;/a&gt;). Even though there are multiple implementations of these HttpEntity, none of them reach to ChunkedInputStream.getFooters() to get the trailers and expose them to caller of HttpEntity.getTrailers().&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;AbstractHttpEntity&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;Following implementations return hardcoded &apos;null&apos; for getTrailers() because the default implementation in AbstractHttpEntity returns null&lt;/li&gt;
		&lt;li&gt;BasicHttpEntity&lt;/li&gt;
		&lt;li&gt;BufferedHttpEntity&lt;/li&gt;
		&lt;li&gt;ByteArrayEntity&lt;/li&gt;
		&lt;li&gt;ByteBufferEntity&lt;/li&gt;
		&lt;li&gt;EntityTemplate&lt;/li&gt;
		&lt;li&gt;FileEntity&lt;/li&gt;
		&lt;li&gt;InputStreamEntity&lt;/li&gt;
		&lt;li&gt;SerializableEntity&lt;/li&gt;
		&lt;li&gt;StringEntity&lt;/li&gt;
		&lt;li&gt;ResponseEntityProxy&lt;/li&gt;
		&lt;li&gt;HttpEntityWithTrailers
		&lt;ul&gt;
			&lt;li&gt;Only returns the trailer list given its constructor instead of getting them from ChunkedInputStream.getFooters()&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
		&lt;li&gt;HttpEntityWrapper
		&lt;ul&gt;
			&lt;li&gt;Call wrappterEntity.getTrailers(), if the underlying entity is one of them in this list, this class also returns null&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Currently the call chain is following (omitted irrelevant calls);&lt;br/&gt;
 #1 MainClientExec.execute() -&amp;gt; creates ResponseEntityProxy regardless the response is chunked or not.&lt;br/&gt;
 #2 ResponseEntityProxy.enhance() -&amp;gt; wraps the underlying stream with EofSensorInputStream which hides ChunkedInputStream.getFooters() method from outside. Since EofSensorInputStream is unaware of chunked messaging and trailers, there is no way to reach ChuckedInputStream.getFooters() from outside after this point.&lt;br/&gt;
 #3 EofSensorInputStream -&amp;gt; This is to watch the stream and free it if it&apos;s EOF.&lt;br/&gt;
 #4 ChunkedInputStream.read()&lt;br/&gt;
 #5 ChunkedInputStream.nextChunk()&lt;br/&gt;
 #6 ChunkedInputStream.parseTrailerHeaders() -&amp;gt; Parses the trailer headers and puts into ChunkedInputSteam.footers field, exposed by getFooters() method but no one is calling this method.&lt;/p&gt;

&lt;p&gt;Code snip to&#160;observe the behavior;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   CloseableHttpClient httpClient = HttpClients.custom().addResponseInterceptorLast(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HttpResponseInterceptor() {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(HttpResponse response, EntityDetails entity, HttpContext context) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; HttpException, IOException {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (response &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; CloseableHttpResponse) {
                    CloseableHttpResponse closeableHttpResponse = (CloseableHttpResponse) response;
                    HttpEntity httpEntity = closeableHttpResponse.getEntity();
                    Supplier&amp;lt;List&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Header&amp;gt;&amp;gt; trailers = httpEntity.getTrailers();
                    &lt;span class=&quot;code-comment&quot;&gt;// --&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;trailers&apos;&lt;/span&gt; is always NULL
&lt;/span&gt;                }
            }
        }).build();

&lt;span class=&quot;code-comment&quot;&gt;// Make Http requests to any server which can responds in &lt;span class=&quot;code-quote&quot;&gt;&apos;Transfer-Encoding: chunked&apos;&lt;/span&gt; and send trailers, observe the trailer supplier above is always &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Proposed solution (the patch is also ready, I will&#160;submit a pull request if agree on the problem and proposal)&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;There needs to be a way to propagate what&#160;has been parsed in ChunkedInputStream.parseTrailerHeaders() by calling ChunkedInputStream.getFooters() and pass those headers to callers of HttpEntity.getTrailers(). To overcome this issue, the proposal is the following;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Implement a version of ResponseEntityProxy named as ResponseChunkedEntityProxy for chunked messaging so it recognizes the underlying stream is ChunkedInputStream and It can return a Supplier which delegates the call to ChunkedInputStream.getFooters() when ResponseChunkedEntityProxy.getTrailers() called and return the supplier for trailers to be used by users of HttpClient at the end of the communication.&lt;/li&gt;
	&lt;li&gt;Change&#160;&lt;a href=&quot;https://hc.apache.org/httpcomponents-client-5.0.x/httpclient5/xref/org/apache/hc/client5/http/impl/classic/MainClientExec.html#L138&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;MainClientExec.execute&lt;/a&gt;&#160;in a way to use ResponseChunkedEntityProxy when the response header &apos;Transfer-Encoding: chunked&apos; presents, so the HttpEntity.getTrailers() API can return trailers parsed by ChunkedInputStream.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13238832">HTTPCLIENT-1992</key>
            <summary>Impossible to access trailer-headers available in chunked transfer-encoding</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="serkanturgut">Serkan Turgut</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Jun 2019 18:19:23 +0000</created>
                <updated>Wed, 15 Mar 2023 17:17:18 +0000</updated>
                            <resolved>Fri, 14 Jun 2019 09:43:53 +0000</resolved>
                                    <version>5.0 Beta4</version>
                    <version>5.0 Beta5</version>
                                    <fixVersion>5.0 Beta5</fixVersion>
                                    <component>HttpClient (classic)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="7200">2h</timespent>
                                <comments>
                            <comment id="16861321" author="rschmitt" created="Tue, 11 Jun 2019 18:29:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt; Please take a look and let me know what you think.&lt;/p&gt;</comment>
                            <comment id="16861357" author="olegk" created="Tue, 11 Jun 2019 18:55:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=serkant&quot; class=&quot;user-hover&quot; rel=&quot;serkant&quot;&gt;serkant&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt; Sounds very reasonable. Please raise a PR at Github.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16861615" author="serkanturgut" created="Tue, 11 Jun 2019 23:48:58 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;, I submitted the PR.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-client/pull/153&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/pull/153&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16863888" author="jira-bot" created="Fri, 14 Jun 2019 09:38:59 +0000"  >&lt;p&gt;Commit 2267ef26b93464549271a2ad33e53bf8efd8b55d in httpcomponents-client&apos;s branch refs/heads/master from Serkan Turgut&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=2267ef2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=2267ef2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1992&quot; title=&quot;Impossible to access trailer-headers available in chunked transfer-encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-1992&quot;&gt;&lt;del&gt;HTTPCLIENT-1992&lt;/del&gt;&lt;/a&gt;: Impossible to access trailer-headers available in chunked transfer-encoding&lt;/p&gt;

&lt;p&gt;1. Implementing getTrailers() in ResponseEntityProxy which will return a&lt;br/&gt;
Supplier which propagates the output of ChunkedInputStream.getFooters(),&lt;br/&gt;
otherwise it returns a empty list.&lt;br/&gt;
2. Fixing a typo in ResponseEntityProxy.enhance() method name.&lt;/p&gt;</comment>
                            <comment id="16884663" author="jira-bot" created="Sun, 14 Jul 2019 12:30:15 +0000"  >&lt;p&gt;Commit 2267ef26b93464549271a2ad33e53bf8efd8b55d in httpcomponents-client&apos;s branch refs/heads/JDK-8212885 from Serkan Turgut&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=2267ef2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=2267ef2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1992&quot; title=&quot;Impossible to access trailer-headers available in chunked transfer-encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-1992&quot;&gt;&lt;del&gt;HTTPCLIENT-1992&lt;/del&gt;&lt;/a&gt;: Impossible to access trailer-headers available in chunked transfer-encoding&lt;/p&gt;

&lt;p&gt;1. Implementing getTrailers() in ResponseEntityProxy which will return a&lt;br/&gt;
Supplier which propagates the output of ChunkedInputStream.getFooters(),&lt;br/&gt;
otherwise it returns a empty list.&lt;br/&gt;
2. Fixing a typo in ResponseEntityProxy.enhance() method name.&lt;/p&gt;</comment>
                            <comment id="16884680" author="jira-bot" created="Sun, 14 Jul 2019 13:52:26 +0000"  >&lt;p&gt;Commit 2267ef26b93464549271a2ad33e53bf8efd8b55d in httpcomponents-client&apos;s branch refs/heads/httpcore-5.0b8-upgrade from Serkan Turgut&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=2267ef2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=2267ef2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1992&quot; title=&quot;Impossible to access trailer-headers available in chunked transfer-encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-1992&quot;&gt;&lt;del&gt;HTTPCLIENT-1992&lt;/del&gt;&lt;/a&gt;: Impossible to access trailer-headers available in chunked transfer-encoding&lt;/p&gt;

&lt;p&gt;1. Implementing getTrailers() in ResponseEntityProxy which will return a&lt;br/&gt;
Supplier which propagates the output of ChunkedInputStream.getFooters(),&lt;br/&gt;
otherwise it returns a empty list.&lt;br/&gt;
2. Fixing a typo in ResponseEntityProxy.enhance() method name.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13528673">HTTPCLIENT-2263</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z03mpc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>