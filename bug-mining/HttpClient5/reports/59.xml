<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:22:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-2091] Connect timeout is used instead of socket timeout after a tls upgrade</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-2091</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;After a TLS upgrade, the connect timeout is used instead of the configured socket timeout. In some configurations this results in unexpected socket timeouts earlier than expected.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This impacts forward proxies using tunneling (CONNECT approach to pass tls bytes through a proxy server as opposed to individual plain http requests) which time out after the connect timeout is reached.&lt;/p&gt;

&lt;p&gt;This is a regression from hc4 which does not exhibit this issue.&lt;/p&gt;

&lt;p&gt;Some details here, where I thought the issues could be related: &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2090?focusedCommentId=17143321&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-17143321&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HTTPCLIENT-2090?focusedCommentId=17143321&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-17143321&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13313234">HTTPCLIENT-2091</key>
            <summary>Connect timeout is used instead of socket timeout after a tls upgrade</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ckozak">Carter Kozak</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Jun 2020 11:30:56 +0000</created>
                <updated>Tue, 29 Jun 2021 12:59:46 +0000</updated>
                            <resolved>Tue, 30 Jun 2020 10:29:06 +0000</resolved>
                                    <version>5.0.1</version>
                                    <fixVersion>5.0.2</fixVersion>
                                    <component>HttpClient (async)</component>
                    <component>HttpClient (classic)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17143793" author="olegk" created="Wed, 24 Jun 2020 12:16:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ckozak&quot; class=&quot;user-hover&quot; rel=&quot;ckozak&quot;&gt;ckozak&lt;/a&gt; One possibility to fix the problem would be this:&lt;br/&gt;
&lt;a href=&quot;https://github.com/ok2c/httpcomponents-client/commit/69864bc4ec17310b23cd49f51b5ff4a08c68c963&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ok2c/httpcomponents-client/commit/69864bc4ec17310b23cd49f51b5ff4a08c68c963&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively we could make &lt;tt&gt;SocketConfig&lt;/tt&gt; have a finite socket timeout by default and drop this special logic altogether.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17143829" author="ckozak" created="Wed, 24 Jun 2020 13:06:20 +0000"  >&lt;p&gt;Interesting, in the test that I put together for the classic client, my configured socket timeout (via ConnectionManager.setDefaultSocketConfig) was used when I removed the explicit setter. Async i/o doesn&apos;t have a comparable socket timeout option, so I imagine the async case may need something along these lines?&lt;/p&gt;

&lt;p&gt;I&apos;d like to put together a test that fails if no timeout is set to help me understand why we need to set a timeout there.&lt;/p&gt;</comment>
                            <comment id="17143871" author="olegk" created="Wed, 24 Jun 2020 14:25:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ckozak&quot; class=&quot;user-hover&quot; rel=&quot;ckozak&quot;&gt;ckozak&lt;/a&gt; Fair enough. But if you want to contribute it back to the project please use our own embedded server for integration tests.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17144447" author="davidmoten2" created="Wed, 24 Jun 2020 22:24:43 +0000"  >&lt;p&gt;&amp;gt; Alternatively we could make SocketConfig have a finite socket timeout by default and drop this special logic altogether.&lt;/p&gt;

&lt;p&gt;I&apos;m a big fan of this as long as it doesn&apos;t kick in for the request socket timeout (a long response time for an application request is completely plausible and should be supported by default).&lt;/p&gt;</comment>
                            <comment id="17144455" author="davidmoten2" created="Wed, 24 Jun 2020 22:34:23 +0000"  >&lt;p&gt;Do we need separate timeout config just for SSL Handshake?&lt;/p&gt;
</comment>
                            <comment id="17148507" author="jira-bot" created="Tue, 30 Jun 2020 10:26:35 +0000"  >&lt;p&gt;Commit 445b61a01afed7b47926a3977cd58937be1831bf in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=445b61a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=445b61a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2091&quot; title=&quot;Connect timeout is used instead of socket timeout after a tls upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2091&quot;&gt;&lt;del&gt;HTTPCLIENT-2091&lt;/del&gt;&lt;/a&gt;: Connect timeout is used instead of socket timeout after a tls upgrade&lt;/p&gt;</comment>
                            <comment id="17148509" author="olegk" created="Tue, 30 Jun 2020 10:28:47 +0000"  >&lt;p&gt;I made HttpCore 5.0.x use a finite (3 minutes) socket timeout by default:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-core/commit/fd7c0cde7603b5a20f618a3e50a5f16eb2e38fe0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/commit/fd7c0cde7603b5a20f618a3e50a5f16eb2e38fe0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17148518" author="davidmoten2" created="Tue, 30 Jun 2020 10:34:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;&#160;but that&apos;s for all sockets right? Some intensive db query could easily take more than 3 minutes. I think we need to be able to specify the socket timeout for the ssl handshake separately and that could have a conservative default (like 3 mins).&lt;/p&gt;</comment>
                            <comment id="17148522" author="olegk" created="Tue, 30 Jun 2020 10:38:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davidmoten2&quot; class=&quot;user-hover&quot; rel=&quot;davidmoten2&quot;&gt;davidmoten2&lt;/a&gt; Use a reasonable default (3 minutes) as socket timeout in &lt;tt&gt;SocketConfig&lt;/tt&gt; for route negotiation and override it with &lt;tt&gt;RequestConfig&lt;/tt&gt;  on a per request basis as you deem fit.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17156013" author="jira-bot" created="Sat, 11 Jul 2020 15:19:38 +0000"  >&lt;p&gt;Commit 5bdcb242f0297c9dca8f6284ed5a4dd062a210b7 in httpcomponents-client&apos;s branch refs/heads/master from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=5bdcb24&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=5bdcb24&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2099&quot; title=&quot;unlimited socket timeout results in the connect timeout being used as a socket timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2099&quot;&gt;&lt;del&gt;HTTPCLIENT-2099&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2091&quot; title=&quot;Connect timeout is used instead of socket timeout after a tls upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2091&quot;&gt;&lt;del&gt;HTTPCLIENT-2091&lt;/del&gt;&lt;/a&gt;: SSLConnectionSocketFactory connect timeout fix (#241)&lt;/p&gt;

&lt;p&gt;SSLConnectionSocketFactory no longer overrides the socket timeout&lt;br/&gt;
with the connect timeout when an unlimited socket timeout is&lt;br/&gt;
configured. This matches behavior of &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2091&quot; title=&quot;Connect timeout is used instead of socket timeout after a tls upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2091&quot;&gt;&lt;del&gt;HTTPCLIENT-2091&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Note that in scenarios where SocketConfig sets an infinite timeout&lt;br/&gt;
and the RequestConfig sets a bounded timeout, this change results&lt;br/&gt;
in the connect-timeout no longer applying to the TLS handshake.&lt;br/&gt;
This behavior can be retained by setting the expected timeout in&lt;br/&gt;
the SocketConfig.&lt;/p&gt;</comment>
                            <comment id="17156014" author="jira-bot" created="Sat, 11 Jul 2020 15:19:39 +0000"  >&lt;p&gt;Commit 5bdcb242f0297c9dca8f6284ed5a4dd062a210b7 in httpcomponents-client&apos;s branch refs/heads/master from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=5bdcb24&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=5bdcb24&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2099&quot; title=&quot;unlimited socket timeout results in the connect timeout being used as a socket timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2099&quot;&gt;&lt;del&gt;HTTPCLIENT-2099&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2091&quot; title=&quot;Connect timeout is used instead of socket timeout after a tls upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2091&quot;&gt;&lt;del&gt;HTTPCLIENT-2091&lt;/del&gt;&lt;/a&gt;: SSLConnectionSocketFactory connect timeout fix (#241)&lt;/p&gt;

&lt;p&gt;SSLConnectionSocketFactory no longer overrides the socket timeout&lt;br/&gt;
with the connect timeout when an unlimited socket timeout is&lt;br/&gt;
configured. This matches behavior of &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2091&quot; title=&quot;Connect timeout is used instead of socket timeout after a tls upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2091&quot;&gt;&lt;del&gt;HTTPCLIENT-2091&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Note that in scenarios where SocketConfig sets an infinite timeout&lt;br/&gt;
and the RequestConfig sets a bounded timeout, this change results&lt;br/&gt;
in the connect-timeout no longer applying to the TLS handshake.&lt;br/&gt;
This behavior can be retained by setting the expected timeout in&lt;br/&gt;
the SocketConfig.&lt;/p&gt;</comment>
                            <comment id="17156028" author="jira-bot" created="Sat, 11 Jul 2020 15:38:52 +0000"  >&lt;p&gt;Commit 5bdcb242f0297c9dca8f6284ed5a4dd062a210b7 in httpcomponents-client&apos;s branch refs/heads/5.1.x from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=5bdcb24&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=5bdcb24&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2099&quot; title=&quot;unlimited socket timeout results in the connect timeout being used as a socket timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2099&quot;&gt;&lt;del&gt;HTTPCLIENT-2099&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2091&quot; title=&quot;Connect timeout is used instead of socket timeout after a tls upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2091&quot;&gt;&lt;del&gt;HTTPCLIENT-2091&lt;/del&gt;&lt;/a&gt;: SSLConnectionSocketFactory connect timeout fix (#241)&lt;/p&gt;

&lt;p&gt;SSLConnectionSocketFactory no longer overrides the socket timeout&lt;br/&gt;
with the connect timeout when an unlimited socket timeout is&lt;br/&gt;
configured. This matches behavior of &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2091&quot; title=&quot;Connect timeout is used instead of socket timeout after a tls upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2091&quot;&gt;&lt;del&gt;HTTPCLIENT-2091&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Note that in scenarios where SocketConfig sets an infinite timeout&lt;br/&gt;
and the RequestConfig sets a bounded timeout, this change results&lt;br/&gt;
in the connect-timeout no longer applying to the TLS handshake.&lt;br/&gt;
This behavior can be retained by setting the expected timeout in&lt;br/&gt;
the SocketConfig.&lt;/p&gt;</comment>
                            <comment id="17156029" author="jira-bot" created="Sat, 11 Jul 2020 15:38:54 +0000"  >&lt;p&gt;Commit 5bdcb242f0297c9dca8f6284ed5a4dd062a210b7 in httpcomponents-client&apos;s branch refs/heads/5.1.x from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=5bdcb24&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=5bdcb24&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2099&quot; title=&quot;unlimited socket timeout results in the connect timeout being used as a socket timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2099&quot;&gt;&lt;del&gt;HTTPCLIENT-2099&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2091&quot; title=&quot;Connect timeout is used instead of socket timeout after a tls upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2091&quot;&gt;&lt;del&gt;HTTPCLIENT-2091&lt;/del&gt;&lt;/a&gt;: SSLConnectionSocketFactory connect timeout fix (#241)&lt;/p&gt;

&lt;p&gt;SSLConnectionSocketFactory no longer overrides the socket timeout&lt;br/&gt;
with the connect timeout when an unlimited socket timeout is&lt;br/&gt;
configured. This matches behavior of &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2091&quot; title=&quot;Connect timeout is used instead of socket timeout after a tls upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2091&quot;&gt;&lt;del&gt;HTTPCLIENT-2091&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Note that in scenarios where SocketConfig sets an infinite timeout&lt;br/&gt;
and the RequestConfig sets a bounded timeout, this change results&lt;br/&gt;
in the connect-timeout no longer applying to the TLS handshake.&lt;br/&gt;
This behavior can be retained by setting the expected timeout in&lt;br/&gt;
the SocketConfig.&lt;/p&gt;</comment>
                            <comment id="17371332" author="tkrah" created="Tue, 29 Jun 2021 12:59:46 +0000"  >&lt;p&gt;Imho that commit is a breaking change and should not be / should not have been considered for a minor version upgrade. Before it was infinite and now all consumers of this library faces timeout exception for operations which takes more than 3 minutes like Dave stated already.&lt;/p&gt;

&lt;p&gt;I am coming from here &lt;a href=&quot;https://github.com/bmuschko/gradle-docker-plugin/issues/1022&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bmuschko/gradle-docker-plugin/issues/1022&lt;/a&gt; where the plugin integrated a new docker-java version which itself upgraded to httpcomponents-core from 5.0 to 5.0.3 and now we&apos;re facing those timeout problems where we had no issues before - at least highly unexpected as a change in a minor version change.&lt;/p&gt;

&lt;p&gt;And I can&apos;t fix that myself because first docker-java must make changes and release them, than gradle-docker-plugin must adapt to those and release them and than as a consumer / user I can configure those timeout to be infinite or longer like before - not just 3 minutes like now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 19 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0g5nc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>