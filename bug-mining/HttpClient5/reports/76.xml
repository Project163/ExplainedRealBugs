<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:22:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-2122] Details of H2ConnectionException are omitted by ConnectionClosedException</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-2122</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;As said in a comment of ticket &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2120&quot; title=&quot;Support HTTP/2 (TLS) Tunneling over HTTP-Proxy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2120&quot;&gt;&lt;del&gt;HTTPCLIENT-2120&lt;/del&gt;&lt;/a&gt; following a description of the error handling issue:&lt;/p&gt;

&lt;p&gt;When I unbiasedly tried to establish a HTTP/2 connection via HTTP-Proxy I noticed that in the logs there is a frame size error that is not obvious from the exception thrown by &lt;tt&gt;Future&amp;lt;SimpleHttpResponse&amp;gt;&lt;/tt&gt;&lt;tt&gt;.get()&lt;/tt&gt;:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;In the logs I can see &lt;tt&gt;Code FRAME_SIZE_ERROR&lt;/tt&gt; and &lt;tt&gt;Frame size exceeds maximum&lt;/tt&gt; which might be caused by trying to consume the HTTP-1.1 proxy response as HTTP/2
	&lt;ul&gt;
		&lt;li&gt;The associated Exception (&lt;tt&gt;H2ConnectionException: Frame size exceeds maximum&lt;/tt&gt;) is omitted in &lt;tt&gt;org.apache.hc.core5.http2.impl.nio.AbstractH2StreamMultiplexer.onException(Exception)&lt;/tt&gt; where &lt;tt&gt;((ExecutableCommand) command).failed(new ConnectionClosedException())&lt;/tt&gt; is called&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The following snipped can be used to reproduce the issue (&lt;tt&gt;coconutpi:8080&lt;/tt&gt; points to a basic squid 4.6 setup on a raspberry pi in my home network):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CloseableHttpAsyncClient client = HttpAsyncClients.custom().setVersionPolicy(HttpVersionPolicy.FORCE_HTTP_2)
        .setProxy(HttpHost.create(&lt;span class=&quot;code-quote&quot;&gt;&quot;coconutpi:8080&quot;&lt;/span&gt;)).build();
client.start();
&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; org.apache.hc.core5.http.ConnectionClosedException: Connection is closed
&lt;/span&gt;client.execute(SimpleHttpRequests.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;https:&lt;span class=&quot;code-comment&quot;&gt;//http2.pro/client&quot;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;).get();&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;StackTrace of exception thrown by &lt;tt&gt;Future&amp;lt;SimpleHttpResponse&amp;gt;.get()&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ava.util.concurrent.ExecutionException: org.apache.hc.core5.http.ConnectionClosedException: Connection is closed
	at org.apache.hc.core5.concurrent.BasicFuture.getResult(BasicFuture.java:72)
	at org.apache.hc.core5.concurrent.BasicFuture.get(BasicFuture.java:85)
	at com.test.MinimalProxyTest.basicTest(MinimalProxyTest.java:40)
	at com.test.MinimalProxyTest.main(MinimalProxyTest.java:26)
Caused by: org.apache.hc.core5.http.ConnectionClosedException: Connection is closed
	at org.apache.hc.core5.http2.impl.nio.AbstractH2StreamMultiplexer.onException(AbstractH2StreamMultiplexer.java:661)
	at org.apache.hc.core5.http2.impl.nio.AbstractH2IOEventHandler.exception(AbstractH2IOEventHandler.java:91)
	at org.apache.hc.core5.http2.impl.nio.ClientH2IOEventHandler.exception(ClientH2IOEventHandler.java:39)
Caused by: org.apache.hc.core5.http.ConnectionClosedException: Connection is closed
	at org.apache.hc.core5.reactor.InternalDataChannel.onException(InternalDataChannel.java:162)
	at org.apache.hc.core5.reactor.InternalChannel.handleIOEvent(InternalChannel.java:55)
	at org.apache.hc.core5.reactor.SingleCoreIOReactor.processEvents(SingleCoreIOReactor.java:179)
	at org.apache.hc.core5.reactor.SingleCoreIOReactor.doExecute(SingleCoreIOReactor.java:128)
	at org.apache.hc.core5.reactor.AbstractSingleCoreIOReactor.execute(AbstractSingleCoreIOReactor.java:85)
	at org.apache.hc.core5.reactor.IOReactorWorker.run(IOReactorWorker.java:44)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;StackTrace of the omitted exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.hc.core5.http2.H2ConnectionException: Frame size exceeds maximum
	at org.apache.hc.core5.http2.impl.nio.FrameInputBuffer.read(FrameInputBuffer.java:101)
	at org.apache.hc.core5.http2.impl.nio.AbstractH2StreamMultiplexer.onInput(AbstractH2StreamMultiplexer.java:440)
	at org.apache.hc.core5.http2.impl.nio.AbstractH2IOEventHandler.inputReady(AbstractH2IOEventHandler.java:65)
	at org.apache.hc.core5.http2.impl.nio.ClientH2IOEventHandler.inputReady(ClientH2IOEventHandler.java:39)
	at org.apache.hc.core5.reactor.InternalDataChannel.onIOEvent(InternalDataChannel.java:124)
	at org.apache.hc.core5.reactor.InternalChannel.handleIOEvent(InternalChannel.java:51)
	at org.apache.hc.core5.reactor.SingleCoreIOReactor.processEvents(SingleCoreIOReactor.java:179)
	at org.apache.hc.core5.reactor.SingleCoreIOReactor.doExecute(SingleCoreIOReactor.java:128)
	at org.apache.hc.core5.reactor.AbstractSingleCoreIOReactor.execute(AbstractSingleCoreIOReactor.java:85)
	at org.apache.hc.core5.reactor.IOReactorWorker.run(IOReactorWorker.java:44)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The complete session log can be found in the attachment &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13013812/13013812_hc5_session.log&quot; title=&quot;hc5_session.log attached to HTTPCLIENT-2122&quot;&gt;hc5_session.log&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13336151">HTTPCLIENT-2122</key>
            <summary>Details of H2ConnectionException are omitted by ConnectionClosedException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="synth3">synth3</reporter>
                        <labels>
                            <label>http2</label>
                            <label>proxy</label>
                    </labels>
                <created>Mon, 19 Oct 2020 21:50:09 +0000</created>
                <updated>Thu, 22 Oct 2020 18:28:53 +0000</updated>
                            <resolved>Thu, 22 Oct 2020 15:44:52 +0000</resolved>
                                    <version>5.0.3</version>
                                    <fixVersion>5.0.4</fixVersion>
                    <fixVersion>5.1-beta1</fixVersion>
                                    <component>HttpClient (async)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17219118" author="jira-bot" created="Thu, 22 Oct 2020 15:42:33 +0000"  >&lt;p&gt;Commit 6cd1573a5d9aa17e8b3b0e456857813dae476ba2 in httpcomponents-client&apos;s branch refs/heads/5.0.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=6cd1573&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=6cd1573&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2122&quot; title=&quot;Details of H2ConnectionException are omitted by ConnectionClosedException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2122&quot;&gt;&lt;del&gt;HTTPCLIENT-2122&lt;/del&gt;&lt;/a&gt;: async client to throw `HTTP/2 tunneling not supported` protocol exception in case of `force HTTP/2` version policy used along with request proxy routing&lt;/p&gt;</comment>
                            <comment id="17219119" author="jira-bot" created="Thu, 22 Oct 2020 15:43:26 +0000"  >&lt;p&gt;Commit 90bc5123fdf390a822d09d26d6b87c7b4c92d253 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=90bc512&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=90bc512&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2122&quot; title=&quot;Details of H2ConnectionException are omitted by ConnectionClosedException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2122&quot;&gt;&lt;del&gt;HTTPCLIENT-2122&lt;/del&gt;&lt;/a&gt;: async client to throw `HTTP/2 tunneling not supported` protocol exception in case of `force HTTP/2` version policy used along with request proxy routing&lt;/p&gt;</comment>
                            <comment id="17219248" author="jira-bot" created="Thu, 22 Oct 2020 18:28:03 +0000"  >&lt;p&gt;Commit 1026a1e55880f59a2dafb654347cc120f234ceaf in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=1026a1e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=1026a1e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2122&quot; title=&quot;Details of H2ConnectionException are omitted by ConnectionClosedException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2122&quot;&gt;&lt;del&gt;HTTPCLIENT-2122&lt;/del&gt;&lt;/a&gt;: async client to throw `HTTP/2 tunneling not supported` protocol exception in case of `force HTTP/2` version policy used along with request proxy routing&lt;/p&gt;</comment>
                            <comment id="17219251" author="jira-bot" created="Thu, 22 Oct 2020 18:28:53 +0000"  >&lt;p&gt;Commit f41096d63ef74191dc9a1cd92dddc27cfc97d18b in httpcomponents-client&apos;s branch refs/heads/5.0.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=f41096d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=f41096d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2122&quot; title=&quot;Details of H2ConnectionException are omitted by ConnectionClosedException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2122&quot;&gt;&lt;del&gt;HTTPCLIENT-2122&lt;/del&gt;&lt;/a&gt;: async client to throw `HTTP/2 tunneling not supported` protocol exception in case of `force HTTP/2` version policy used along with request proxy routing&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13013812" name="hc5_session.log" size="11130" author="synth3" created="Mon, 19 Oct 2020 21:43:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 3 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0jtow:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>