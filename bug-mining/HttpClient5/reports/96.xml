<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:22:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-2221] Differences between HttpEntity.close() and HttpEntity.getContent().close()</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-2221</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;My assumption is that closing an entity should have the same behavior as closing the entity.getContent() inputstream.&lt;/p&gt;

&lt;p&gt;Given a streaming response, calling HttpEntity.close doesn&apos;t handle connection management pieces (interactions with the &lt;tt&gt;ExecRuntime&lt;/tt&gt;) because &lt;tt&gt;ResponseEntityProxy&lt;/tt&gt; wraps &lt;tt&gt;getContent&lt;/tt&gt; and &lt;tt&gt;writeTo&lt;/tt&gt;, however it does not override the &lt;tt&gt;close&lt;/tt&gt; implementation inherited from &lt;tt&gt;HttpEntityWrapper&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;In practice, this may mean that calling HttpEntity.close instead of consuming the contents doesn&apos;t return the connection to the pool, or in my case, calling CloseableHttpResponse.close results in &lt;tt&gt;execRuntime.disconnectEndpoint();&lt;/tt&gt; after the entity has been drained within its own close, however the connection is still closed.&lt;/p&gt;

&lt;p&gt;I think we want to make either one of the following changes:&lt;br/&gt;
1. HttpEntity.close() provides the same behavior as HttpEntity.getContent().close(), draining the response (which we already do) and returning the connection for reuse&lt;br/&gt;
2. HttpEntity.close() does not read the full response, closing it immediately. I think I&apos;d prefer to avoid this approach given that much of our code assumes close leaves a connection in a reusable state.&lt;/p&gt;

&lt;p&gt;Separately, it may be helpful to provide a strategy interface to allow for more specific handling of connection closure prior to exhaustion of bytes. The current strategy of draining the full response is ideal in most scenarios, however after a certain amount of additional data, we may be better off closing the connection. I suspect part of the issue in this case is that we seem to expect subtly different behavior between &lt;tt&gt;CloseableHttpResponse.close&lt;/tt&gt; and &lt;tt&gt;EntityUtils.consume(response.getEntity())&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13449052">HTTPCLIENT-2221</key>
            <summary>Differences between HttpEntity.close() and HttpEntity.getContent().close()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ckozak">Carter Kozak</assignee>
                                    <reporter username="ckozak">Carter Kozak</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Jun 2022 16:57:51 +0000</created>
                <updated>Sat, 11 Jun 2022 12:25:33 +0000</updated>
                            <resolved>Sat, 11 Jun 2022 12:25:33 +0000</resolved>
                                    <version>5.1.3</version>
                                    <fixVersion>4.5.14</fixVersion>
                    <fixVersion>5.2</fixVersion>
                                    <component>HttpClient (classic)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17551996" author="olegk" created="Thu, 9 Jun 2022 07:10:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ckozak&quot; class=&quot;user-hover&quot; rel=&quot;ckozak&quot;&gt;ckozak&lt;/a&gt; Sounds reasonable. Feel free to raise a PR with proposed changes.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17553087" author="jira-bot" created="Sat, 11 Jun 2022 12:11:14 +0000"  >&lt;p&gt;Commit 3bd017cb0a772f0c33d22dc1f8fd40012d33dab9 in httpcomponents-client&apos;s branch refs/heads/master from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=3bd017cb0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=3bd017cb0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2221&quot; title=&quot;Differences between HttpEntity.close() and HttpEntity.getContent().close()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2221&quot;&gt;&lt;del&gt;HTTPCLIENT-2221&lt;/del&gt;&lt;/a&gt; Closing a classic response/entity allows connection reuse&lt;/p&gt;

&lt;p&gt;Previously, a partially consumed response body closed via&lt;br/&gt;
CloseableHttpResponse.close or HttpEntity.close would fully consume&lt;br/&gt;
remaining bytes (via close), however it would not release the&lt;br/&gt;
connection for reuse.&lt;br/&gt;
If CloseableHttpResponse.close was called, it would follow the close&lt;br/&gt;
with a discard/disconnect, however if only the entity was closed,&lt;br/&gt;
the connection would remain in a checked-out (leaked) state.&lt;/p&gt;

&lt;p&gt;Now, we take advantage of the fact that closing a response stream&lt;br/&gt;
on any reusable connection is required to drain bytes on closure.&lt;br/&gt;
Failures are detected by writeTo and the stream returned by&lt;br/&gt;
getContent, so we can be confident that we will not return a&lt;br/&gt;
broken connection to the pool.&lt;/p&gt;</comment>
                            <comment id="17553093" author="jira-bot" created="Sat, 11 Jun 2022 12:24:13 +0000"  >&lt;p&gt;Commit df69bd29028f50743c4a2ede4a66a663721906cd in httpcomponents-client&apos;s branch refs/heads/5.1.x from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=df69bd290&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=df69bd290&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2221&quot; title=&quot;Differences between HttpEntity.close() and HttpEntity.getContent().close()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2221&quot;&gt;&lt;del&gt;HTTPCLIENT-2221&lt;/del&gt;&lt;/a&gt; Closing a classic response/entity allows connection reuse&lt;/p&gt;

&lt;p&gt;Previously, a partially consumed response body closed via&lt;br/&gt;
CloseableHttpResponse.close or HttpEntity.close would fully consume&lt;br/&gt;
remaining bytes (via close), however it would not release the&lt;br/&gt;
connection for reuse.&lt;br/&gt;
If CloseableHttpResponse.close was called, it would follow the close&lt;br/&gt;
with a discard/disconnect, however if only the entity was closed,&lt;br/&gt;
the connection would remain in a checked-out (leaked) state.&lt;/p&gt;

&lt;p&gt;Now, we take advantage of the fact that closing a response stream&lt;br/&gt;
on any reusable connection is required to drain bytes on closure.&lt;br/&gt;
Failures are detected by writeTo and the stream returned by&lt;br/&gt;
getContent, so we can be confident that we will not return a&lt;br/&gt;
broken connection to the pool.&lt;/p&gt;</comment>
                            <comment id="17553097" author="olegk" created="Sat, 11 Jun 2022 12:25:33 +0000"  >&lt;p&gt;Committed to master and 5.1.x.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 22 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1329c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>