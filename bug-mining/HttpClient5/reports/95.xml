<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:22:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-2212] AsyncClientEndpoint is not released upon lease failure</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-2212</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;When I use AsyncHttpClient and try to lease an endpoint to host &quot;https://localhost&quot;, I receive javax.net.ssl.SSLHandshakeException exception via callback&apos;s failed method. That&apos;s ok, because my localhost certificate is not signed by authority.&lt;/p&gt;

&lt;p&gt;The strange thing is that the endpoint is allocated from PoolingAsyncClientConnectionManager, but not released after the connection failure during the endpoint lease operation.&lt;/p&gt;

&lt;p&gt;There is no way to release the endpoint from callback failed method, because there is no reference to it.&lt;/p&gt;

&lt;p&gt;Failing the lease multiple times consumes all available connections from connection manager pool and any further lease operation remains in pending state preventing any other connections to the host.&lt;/p&gt;



&lt;p&gt;example:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
httpManager = PoolingAsyncClientConnectionManagerBuilder.create()
&#160; &#160; &#160; &#160; .setDefaultConnectionConfig(ConnectionConfig.custom()
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .setTimeToLive(TimeValue.NEG_ONE_MILLISECOND) &#160; &#160;&lt;span class=&quot;code-comment&quot;&gt;//TTL is maximum time one connection can be used,
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;//then it is closed and &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; one is opened. Therefore -1 disables TTL and same connection lasts until
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;//it is actively used. Then closed by IdleConnectionEvictor thread.
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .build())
&#160; &#160; &#160; &#160; .setDefaultTlsConfig(TlsConfig.custom()
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .setVersionPolicy(HttpVersionPolicy.NEGOTIATE)
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .build())
&#160; &#160; &#160; &#160; .build();
httpClient = HttpAsyncClients.createMinimal(
&#160; &#160; &#160; &#160; H2Config.DEFAULT,
&#160; &#160; &#160; &#160; Http1Config.DEFAULT,
&#160; &#160; &#160; &#160; IOReactorConfig.DEFAULT,
&#160; &#160; &#160; &#160; httpManager);
httpClient.start();
&#160;
HttpHost host = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HttpHost(&lt;span class=&quot;code-quote&quot;&gt;&quot;https&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;, 443);
httpClient.lease(host, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FutureCallback&amp;lt;AsyncClientEndpoint&amp;gt;() {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; @Override
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void failed(Exception ex) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; @Override
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void completed(AsyncClientEndpoint result) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; @Override
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void cancelled() {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; });
&#160;
Set&amp;lt;HttpRoute&amp;gt; routes = httpManager.getRoutes();
&#160; &#160; &#160; &#160; List&amp;lt;RouteStats&amp;gt; stats = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;RouteStats&amp;gt;(routes.size());
&#160; &#160; &#160; &#160;&#160;
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(HttpRoute route : routes){
&#160; &#160; &#160; &#160; &#160; &#160; PoolStats s = httpManager.getStats(route);
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(route.getTargetHost().getHostName());
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(s.getAvailable());
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(s.getLeased());
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(s.getMax());
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(s.getPending());
&#160; &#160; &#160; &#160; }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13443033">HTTPCLIENT-2212</key>
            <summary>AsyncClientEndpoint is not released upon lease failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lhusivarga">Lubos Husivarga</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 May 2022 22:38:13 +0000</created>
                <updated>Thu, 5 May 2022 08:51:01 +0000</updated>
                            <resolved>Thu, 5 May 2022 08:51:01 +0000</resolved>
                                    <version>5.1.3</version>
                    <version>5.2-alpha1</version>
                                    <fixVersion>5.1.4</fixVersion>
                    <fixVersion>5.2-beta1</fixVersion>
                                    <component>HttpClient (async)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17531508" author="olegk" created="Wed, 4 May 2022 06:40:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhusivarga&quot; class=&quot;user-hover&quot; rel=&quot;lhusivarga&quot;&gt;lhusivarga&lt;/a&gt; I will look into it shortly.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17531901" author="olegk" created="Wed, 4 May 2022 19:06:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhusivarga&quot; class=&quot;user-hover&quot; rel=&quot;lhusivarga&quot;&gt;lhusivarga&lt;/a&gt; The defect is actually in HttpClient, not HttpCore.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17531903" author="jira-bot" created="Wed, 4 May 2022 19:17:34 +0000"  >&lt;p&gt;Commit 830adcd254e6b7be305c112ca004720c0d14d887 in httpcomponents-client&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2212&quot; title=&quot;AsyncClientEndpoint is not released upon lease failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2212&quot;&gt;&lt;del&gt;HTTPCLIENT-2212&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=830adcd25&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=830adcd25&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2212&quot; title=&quot;AsyncClientEndpoint is not released upon lease failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2212&quot;&gt;&lt;del&gt;HTTPCLIENT-2212&lt;/del&gt;&lt;/a&gt;: MinimalHttpAsyncClient fails to release client endpoints in case of a connect error (such as TLS handshake failure)&lt;/p&gt;</comment>
                            <comment id="17531904" author="olegk" created="Wed, 4 May 2022 19:21:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhusivarga&quot; class=&quot;user-hover&quot; rel=&quot;lhusivarga&quot;&gt;lhusivarga&lt;/a&gt;&#160; Please review / test the proposed fix:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-client/commit/830adcd254e6b7be305c112ca004720c0d14d887&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/commit/830adcd254e6b7be305c112ca004720c0d14d887&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17531915" author="JIRAUSER282837" created="Wed, 4 May 2022 19:47:18 +0000"  >&lt;p&gt;Tested and working fine.&lt;/p&gt;

&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt; again for quick response and fix!&lt;/p&gt;

&lt;p&gt;All the best,&lt;br/&gt;
Lubos&lt;/p&gt;</comment>
                            <comment id="17532147" author="jira-bot" created="Thu, 5 May 2022 08:47:12 +0000"  >&lt;p&gt;Commit b7a1d600a1449d1d931101e4ecc8de57b4ea188a in httpcomponents-client&apos;s branch refs/heads/5.1.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=b7a1d600a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=b7a1d600a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2212&quot; title=&quot;AsyncClientEndpoint is not released upon lease failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2212&quot;&gt;&lt;del&gt;HTTPCLIENT-2212&lt;/del&gt;&lt;/a&gt;: MinimalHttpAsyncClient fails to release client endpoints in case of a connect error (such as TLS handshake failure)&lt;/p&gt;</comment>
                            <comment id="17532148" author="jira-bot" created="Thu, 5 May 2022 08:50:41 +0000"  >&lt;p&gt;Commit 62fb4bcbe09c5fb002dcebe408c7bd1d1c0990f4 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=62fb4bcbe&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=62fb4bcbe&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2212&quot; title=&quot;AsyncClientEndpoint is not released upon lease failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2212&quot;&gt;&lt;del&gt;HTTPCLIENT-2212&lt;/del&gt;&lt;/a&gt;: MinimalHttpAsyncClient fails to release client endpoints in case of a connect error (such as TLS handshake failure)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 27 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z121aw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>