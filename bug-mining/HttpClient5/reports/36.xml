<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:21:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-1958] Thread interrupt flag leaking when aborting httpRequest during connection leasing stage</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-1958</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;When calling HttpRequestBase#abort during the leasing connection phase, the thread is being interrupted and `RequestAbortedException`&#160;will be thrown.&lt;/p&gt;

&lt;p&gt;It&#160;is an unexpected behavior that aborting the http request would cause the interrupt flag to be set on&#160;the caller thread.&lt;/p&gt;

&lt;p&gt;Here is what happened looking from the source code of 4.5.5,&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Aborting the request invokes future.cancel(true) and it throws InterruptedException &lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/4.5.5/httpclient/src/main/java/org/apache/http/impl/conn/PoolingHttpClientConnectionManager.java#L272&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/blob/4.5.5/httpclient/src/main/java/org/apache/http/impl/conn/PoolingHttpClientConnectionManager.java#L272&lt;/a&gt;&#160;&lt;/li&gt;
	&lt;li&gt;InterruptedException is caught in &lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/4.5.5/httpclient/src/main/java/org/apache/http/impl/execchain/MainClientExec.java#L193&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;MainClientExec&lt;/a&gt;&#160;and then it re-interrupts the thread and throws RequestAbortedException&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The second step is expected and the first step seems to be the root cause.&#160;Should we use `future.cancel(false)` instead as it causes the side effect for a simple httprequest#abort to interrupt the caller&apos;s thread?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Code to reproduce:&lt;/p&gt;

&lt;p&gt;ScheduledExecutorService scheduledExecutorService = Executors.newScheduledThreadPool(1);&lt;/p&gt;

&lt;p&gt;try (&lt;br/&gt;
&#160; &#160; &#160;PoolingHttpClientConnectionManager poolingHttpClientConnectionManager = new PoolingHttpClientConnectionManager();&lt;br/&gt;
&#160; &#160; &#160; CloseableHttpClient httpclient = HttpClients.custom().setConnectionManager(poolingHttpClientConnectionManager).build()) &lt;/p&gt;
{
&#160; &#160; &#160;

&#160; &#160; HttpGet httpGet = new HttpGet(&quot;https://somehost.com&quot;);

&#160; &#160;// Aborting the request when it&apos;s getting a connection from the connection pool
&#160; &#160; &#160; scheduledExecutorService.schedule(httpGet::abort, 40, TimeUnit.MILLISECONDS);
&#160; &#160; &#160; CloseableHttpResponse response = httpclient.execute(httpGet);

&#160; &#160; &#160; HttpEntity entity = response.getEntity();
&#160; &#160; &#160; EntityUtils.consume(entity);
&#160; &#160;}
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
&#160; &#160; &#160; &#160;e.printStackTrace();
&#160; &#160;}
&lt;p&gt; finally &lt;/p&gt;
{
&#160; &#160;scheduledExecutorService.shutdown();
&#160; &#160;}

&lt;p&gt;System.out.println(&quot;Interrupted ?&quot; + Thread.currentThread().isInterrupted());&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13208162">HTTPCLIENT-1958</key>
            <summary>Thread interrupt flag leaking when aborting httpRequest during connection leasing stage</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Zoe Wang">Zoe Wang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Jan 2019 22:50:28 +0000</created>
                <updated>Thu, 10 Jan 2019 12:37:54 +0000</updated>
                            <resolved>Thu, 10 Jan 2019 09:28:24 +0000</resolved>
                                    <version>4.5.5</version>
                    <version>4.5.6</version>
                                    <fixVersion>4.5.7</fixVersion>
                    <fixVersion>5.0 Beta4</fixVersion>
                                    <component>HttpClient (classic)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16737007" author="jira-bot" created="Tue, 8 Jan 2019 11:04:48 +0000"  >&lt;p&gt;Commit 9e561957d7d098453cf04fe140f6726539281814 in httpcomponents-client&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1958&quot; title=&quot;Thread interrupt flag leaking when aborting httpRequest during connection leasing stage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-1958&quot;&gt;&lt;del&gt;HTTPCLIENT-1958&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=9e56195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=9e56195&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1958&quot; title=&quot;Thread interrupt flag leaking when aborting httpRequest during connection leasing stage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-1958&quot;&gt;&lt;del&gt;HTTPCLIENT-1958&lt;/del&gt;&lt;/a&gt;: PoolingHttpClientConnectionManager to throw ExecutionException in case of a lease operation cancellation instead of InterruptedException&lt;/p&gt;</comment>
                            <comment id="16737010" author="olegk" created="Tue, 8 Jan 2019 11:06:21 +0000"  >&lt;p&gt;Please review the fix:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/httpcomponents-client/tree/HTTPCLIENT-1958&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/tree/HTTPCLIENT-1958&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16738918" author="zoe wang" created="Thu, 10 Jan 2019 02:28:10 +0000"  >&lt;p&gt;Thank you for the quick fix!&lt;/p&gt;

&lt;p&gt;LGTM. I also pulled the&#160;fix locally and verified the issue was fixed with the change.&lt;/p&gt;</comment>
                            <comment id="16739225" author="jira-bot" created="Thu, 10 Jan 2019 09:04:28 +0000"  >&lt;p&gt;Commit 9e561957d7d098453cf04fe140f6726539281814 in httpcomponents-client&apos;s branch refs/heads/4.5.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=9e56195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=9e56195&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1958&quot; title=&quot;Thread interrupt flag leaking when aborting httpRequest during connection leasing stage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-1958&quot;&gt;&lt;del&gt;HTTPCLIENT-1958&lt;/del&gt;&lt;/a&gt;: PoolingHttpClientConnectionManager to throw ExecutionException in case of a lease operation cancellation instead of InterruptedException&lt;/p&gt;</comment>
                            <comment id="16739226" author="jira-bot" created="Thu, 10 Jan 2019 09:04:29 +0000"  >&lt;p&gt;Commit 024f692df3d6dc420ebd09214dfc4cf231644c26 in httpcomponents-client&apos;s branch refs/heads/4.5.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=024f692&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=024f692&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge branch &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1958&quot; title=&quot;Thread interrupt flag leaking when aborting httpRequest during connection leasing stage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-1958&quot;&gt;&lt;del&gt;HTTPCLIENT-1958&lt;/del&gt;&lt;/a&gt;&apos; into 4.5.x&lt;/p&gt;</comment>
                            <comment id="16739231" author="jira-bot" created="Thu, 10 Jan 2019 09:26:04 +0000"  >&lt;p&gt;Commit 50e7dd51e06b877c9378846e980b99cbef2eafbb in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=50e7dd5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=50e7dd5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1958&quot; title=&quot;Thread interrupt flag leaking when aborting httpRequest during connection leasing stage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-1958&quot;&gt;&lt;del&gt;HTTPCLIENT-1958&lt;/del&gt;&lt;/a&gt;: PoolingHttpClientConnectionManager to throw ExecutionException in case of a lease operation cancellation instead of InterruptedException&lt;/p&gt;</comment>
                            <comment id="16739364" author="jira-bot" created="Thu, 10 Jan 2019 12:37:54 +0000"  >&lt;p&gt;Commit 7824d98d0ca8aa4bed14d70c01c544ac544d4170 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=7824d98&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=7824d98&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1958&quot; title=&quot;Thread interrupt flag leaking when aborting httpRequest during connection leasing stage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-1958&quot;&gt;&lt;del&gt;HTTPCLIENT-1958&lt;/del&gt;&lt;/a&gt;: PoolingHttpClientConnectionManager to throw ExecutionException in case of a lease operation cancellation instead of InterruptedException&lt;br/&gt;
(fixed previous commit)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 44 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u00log:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>