<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:22:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-2271] Do not optimize relative redirect location</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-2271</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;If an http response has an URI in the Location header, which contains special symbols - semi-colon ( ; ) and equal sign (=), the URI parser of the underlaying URI builder encodes these symbols to %3B and %3D. Then the redirect will be performed using the encoded URI.&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;Real Use Case where the issue is detected with httpcomonents updated from version 4 to 5&lt;/ins&gt;: SAML Artifact binding in an IDP initiated SSO communication.&lt;/p&gt;

&lt;p&gt;A simple simulation program is attached to demonstrate the problem.&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;Test Case:&lt;/ins&gt; There is a servlet and a client application.&lt;br/&gt;
1. The client application sends an HTTP GET request to the servlet with URI &quot;http://localhost:8080/test/welcome&quot;&lt;/p&gt;

&lt;p&gt;2. The servlet receives the request and sends a redirect response with a relative location - /test/httpclient4/welcomeHttpClient&lt;/p&gt;

&lt;p&gt;2.1. Before sending the response the redirect URL is encoded (by calling the method HttpServletResponse.encodeRedirectURL(String location)).&lt;/p&gt;

&lt;p&gt;2.2.The latter method adds jsessionid at the end of the new location in accordance to the &lt;a href=&quot;https://javaee.github.io/servlet-spec/downloads/servlet-3.1/Final/servlet-3_1-final.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Java Servlet Specification, section 7.1.3 - URL Rewriting&lt;/a&gt;.&lt;br/&gt;
As a result, the redirect location becomes similar to &lt;em&gt;/test/httpclient/welcomeHttpClient;jsessionid=FD86C2C971F595C8459028D585BCF26F&lt;/em&gt;&lt;br/&gt;
3. When the response is received the httpclient parses the new location and encodes it to:&lt;br/&gt;
&lt;a href=&quot;http://localhost:8080/test/httpclient/welcomeHttpClient%3Bjsessionid%3DFD86C2C971F595C8459028D585BCF26F&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/test/httpclient/welcomeHttpClient%3Bjsessionid%3DFD86C2C971F595C8459028D585BCF26F&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is an issue, because the latter URL is redirected at the end with &lt;em&gt;&lt;b&gt;%3B&lt;/b&gt;jsessionid&lt;b&gt;%3D&lt;/b&gt;FD86C2C971F595C8459028D585BCF26&lt;/em&gt;F (i.e. no such endpoint exists). Also &lt;em&gt;jsessionid&lt;/em&gt; is not recognized as a path parameter.&lt;br/&gt;
The expected redirect URL is without encoded semi-colon and equal sign : &lt;a href=&quot;http://localhost:8080/test/httpclient/welcomeHttpClient;jsessionid=FD86C2C971F595C8459028D585BCF26F&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/test/httpclient/welcomeHttpClient;jsessionid=FD86C2C971F595C8459028D585BCF26F&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;Remarks:&lt;/ins&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;If the servlet redirects a full URI instead of a relative URI (for example, &#160;&lt;br/&gt;
&lt;a href=&quot;http://localhost:8080/test/httpclient/welcomeHttpClient;jsessionid=FD86C2C971F595C8459028D585BCF26F&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/test/httpclient/welcomeHttpClient;jsessionid=FD86C2C971F595C8459028D585BCF26F&lt;/a&gt;, then the httpclient response is properly parsed and the redirect URL has no encoded semi-colon and equal sign characters.&lt;/li&gt;
	&lt;li&gt;If http client 4.5.5 and httpcore 4.4.9 are used, then the described issue is not present.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>httpclient5, version 5.1.2&lt;br/&gt;
httpcore5, version 5.1.2&lt;br/&gt;
javax.servlet-api, version 3.1.0</environment>
        <key id="13534137">HTTPCLIENT-2271</key>
            <summary>Do not optimize relative redirect location</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="krasimir.malchev">Krasimir Malchev</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Apr 2023 12:02:07 +0000</created>
                <updated>Sat, 24 Jun 2023 21:40:16 +0000</updated>
                            <resolved>Thu, 27 Apr 2023 14:25:24 +0000</resolved>
                                    <version>5.2.1</version>
                                    <fixVersion>5.2.2</fixVersion>
                    <fixVersion>5.3-alpha1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17716687" author="michael-o" created="Wed, 26 Apr 2023 12:17:19 +0000"  >&lt;p&gt;We are obviously talking about &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc3986#section-2.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://datatracker.ietf.org/doc/html/rfc3986#section-2.2&lt;/a&gt;. The path segment is misinterpreted. Obviously, how the the API know that the input is already encoded or not. Did you check the source code which does the bad magic?&lt;/p&gt;</comment>
                            <comment id="17716690" author="JIRAUSER300076" created="Wed, 26 Apr 2023 12:27:23 +0000"  >&lt;p&gt;Yes, = and ; are reserved characters, but the URL encoding happens only when the Redirect URL is relative. If the servlet redirects with a &quot;http://...&quot; location, then the issue is not present (remarks).&#160;&lt;/p&gt;

&lt;p&gt;Also, the httpcore behaviour was different in version 4.5 (simulation is attached).&#160;&#160;&lt;/p&gt;</comment>
                            <comment id="17716696" author="michael-o" created="Wed, 26 Apr 2023 12:34:31 +0000"  >&lt;p&gt;Reserved means that the semantics of the protocol give them a meaning. I consider this as a matrix parameter to the entire path, regardless of the query string. I am inclined to say that this is broken.&lt;/p&gt;</comment>
                            <comment id="17716698" author="olegk" created="Wed, 26 Apr 2023 12:44:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krasimir.malchev&quot; class=&quot;user-hover&quot; rel=&quot;krasimir.malchev&quot;&gt;krasimir.malchev&lt;/a&gt; You need to fix whatever piece of sever-side software that fails to handle correctly encoded redirect location.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17716707" author="olegk" created="Wed, 26 Apr 2023 12:59:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krasimir.malchev&quot; class=&quot;user-hover&quot; rel=&quot;krasimir.malchev&quot;&gt;krasimir.malchev&lt;/a&gt; By the way there is no such thing as a session id in URI as per RFC 3986. This construct is invalid.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17716722" author="michael-o" created="Wed, 26 Apr 2023 13:34:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;, I don&apos;t consider it invalid. This is protocols-specific and not is not part of a path segment or query param. For me, the encoded version would make it part of the path segment.&lt;/p&gt;</comment>
                            <comment id="17716724" author="olegk" created="Wed, 26 Apr 2023 13:37:13 +0000"  >&lt;p&gt;&amp;gt; I don&apos;t consider it invalid. This is protocols-specific and not is not part of a path segment or query param.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michael-o&quot; class=&quot;user-hover&quot; rel=&quot;michael-o&quot;&gt;michael-o&lt;/a&gt; What section of RFC 3986 states that?&lt;/p&gt;

&lt;p&gt;&amp;gt; For me, the encoded version would make it part of the path segment.&lt;/p&gt;

&lt;p&gt;Because it is.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17716729" author="michael-o" created="Wed, 26 Apr 2023 13:41:58 +0000"  >&lt;p&gt;Here it is:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;   URIs include components and subcomponents that are delimited by&lt;br/&gt;
   characters in the &quot;reserved&quot; set.  These characters are called&lt;br/&gt;
   &quot;reserved&quot; because they may (or may not) be defined as delimiters by&lt;br/&gt;
   the generic syntax, by each scheme-specific syntax, or by the&lt;br/&gt;
   implementation-specific syntax of a URI&apos;s dereferencing algorithm.&lt;br/&gt;
   If data for a URI component would conflict with a reserved&lt;br/&gt;
   character&apos;s purpose as a delimiter, then the conflicting data must be&lt;br/&gt;
   percent-encoded before the URI is formed.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="17716733" author="stanio" created="Wed, 26 Apr 2023 13:48:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc3986#section-3.3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;RFC 3986 &#8211; 3.3.  Path&lt;/a&gt; (the last paragraph of that section):&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;   Aside from dot-segments in hierarchical paths, a path segment is&lt;br/&gt;
   considered opaque by the generic syntax.  URI producing applications&lt;br/&gt;
   often use the reserved characters allowed in a segment to delimit&lt;br/&gt;
   scheme-specific or dereference-handler-specific subcomponents.  For&lt;br/&gt;
   example, the semicolon (&quot;;&quot;) and equals (&quot;=&quot;) reserved characters are&lt;br/&gt;
   often used to delimit parameters and parameter values applicable to&lt;br/&gt;
   that segment.  The comma (&quot;,&quot;) reserved character is often used for&lt;br/&gt;
   similar purposes.  For example, one URI producer might use a segment&lt;br/&gt;
   such as &quot;name;v=1.1&quot; to indicate a reference to version 1.1 of&lt;br/&gt;
   &quot;name&quot;, whereas another might use a segment such as &quot;name,1.1&quot; to&lt;br/&gt;
   indicate the same.&lt;/p&gt;&lt;/blockquote&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        URI resolved = URI.create(&lt;span class=&quot;code-quote&quot;&gt;&quot;/foo;bar=baz&quot;&lt;/span&gt;);
        URIBuilder builder = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URIBuilder(resolved);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(builder.build()); &lt;span class=&quot;code-comment&quot;&gt;// OK: /foo;bar=baz
&lt;/span&gt;        builder.normalizeSyntax();
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(builder.build()); &lt;span class=&quot;code-comment&quot;&gt;// Bad: /foo%3Bbar%3Dbaz&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17716741" author="olegk" created="Wed, 26 Apr 2023 13:59:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stanio&quot; class=&quot;user-hover&quot; rel=&quot;stanio&quot;&gt;stanio&lt;/a&gt; Where does it state &apos;,&apos; and &apos;=&apos; cannot be encoded?&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17716748" author="stanio" created="Wed, 26 Apr 2023 14:07:39 +0000"  >&lt;p&gt;Once produced, the path should not be further encoded.  When you selectively re-encode parts of it you&apos;re &lt;del&gt;obviously&lt;/del&gt; inevitably changing its semantics.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc3986#section-2.4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.4.  When to Encode or Decode&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;   Under normal circumstances, the only time when octets within a URI&lt;br/&gt;
   are percent-encoded is during the process of producing the URI from&lt;br/&gt;
   its component parts.  This is when an implementation determines which&lt;br/&gt;
   of the reserved characters are to be used as subcomponent delimiters&lt;br/&gt;
   and which can be safely used as data.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="17716755" author="michael-o" created="Wed, 26 Apr 2023 14:34:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;, I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stanio&quot; class=&quot;user-hover&quot; rel=&quot;stanio&quot;&gt;stanio&lt;/a&gt; &lt;tt&gt;/foo/bar/&lt;/tt&gt; is not the same as &lt;tt&gt;/far%2Fbar/.&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17716808" author="olegk" created="Wed, 26 Apr 2023 16:40:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stanio&quot; class=&quot;user-hover&quot; rel=&quot;stanio&quot;&gt;stanio&lt;/a&gt; The path is &lt;em&gt;not&lt;/em&gt; further encoded. The URIBuilder parses URI components and encodes them as mandated by the RFC 3986. What you are saying has &lt;em&gt;no&lt;/em&gt; bearing on the matter what so ever.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17716814" author="olegk" created="Wed, 26 Apr 2023 16:47:28 +0000"  >&lt;p&gt;&amp;gt; &lt;tt&gt;/foo/bar/&lt;/tt&gt; is not the same as &lt;tt&gt;/far%2Fbar/.&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michael-o&quot; class=&quot;user-hover&quot; rel=&quot;michael-o&quot;&gt;michael-o&lt;/a&gt; This is not what he is saying. The path &lt;tt&gt;/foo/bar/&lt;/tt&gt; is not the same as the path &lt;tt&gt;/far%2Fbar/&lt;/tt&gt;. That is clear. But the path&#160; &lt;tt&gt;/foo;bar/&lt;/tt&gt; and&#160; &lt;tt&gt;/foo%3Bbar/&lt;/tt&gt; are according to my reading of the RFC 3986.&lt;/p&gt;

&lt;p&gt;The RFC 3986 is extremely vague as to what so called references in the path segments are and what exactly they represent. It is just a matter of time another bunch of people will claim that exactly the opposite is the case we must immediately change the way URIBuilder works. We cannot please them as all.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17716823" author="stanio" created="Wed, 26 Apr 2023 17:02:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;, &lt;tt&gt;URIBuilder&lt;/tt&gt; should not normally encode reserved characters (I can&apos;t think of a case it might need to do so). I&apos;ve already cited RFC 3986 says URI producers need to percent-encode reserved characters &lt;b&gt;or not&lt;/b&gt; depending on their need. HttpClient is not a URI producer, but just an intermediate processor that should not mangle the URIs but just resolve them as necessary.&lt;/p&gt;

&lt;p&gt;You should at least admit your statement: &lt;em&gt;&quot;By the way there is no such thing as a session id in URI as per RFC 3986. This construct is invalid&quot;&lt;/em&gt; is ultimately false. Path-segment parameters (a.k.a. matrix parameters) are known for quite some time, and that&apos;s what happens to be used by the specific Java Servlets handling.&lt;/p&gt;

&lt;p&gt;Then, let&apos;s suppose current HttpClient behavior is o.k. &#8211; could you explain the difference in behavior when the redirect location is absolute or relative:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;/foo;bar=baz&lt;/tt&gt; &#8594; &lt;tt&gt;&lt;a href=&quot;http://localhost:8080/foo%3Bbar%3Dbaz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/foo%3Bbar%3Dbaz&lt;/a&gt;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;&lt;a href=&quot;http://localhost:8080/foo;bar=baz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/foo;bar=baz&lt;/a&gt;&lt;/tt&gt; &#8594; &lt;tt&gt;&lt;a href=&quot;http://localhost:8080/foo;bar=baz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/foo;bar=baz&lt;/a&gt;&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;?&lt;/p&gt;</comment>
                            <comment id="17716826" author="michael-o" created="Wed, 26 Apr 2023 17:08:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=julian.reschke%40gmx.de&quot; class=&quot;user-hover&quot; rel=&quot;julian.reschke@gmx.de&quot;&gt;julian.reschke@gmx.de&lt;/a&gt;, can you help?&lt;/p&gt;</comment>
                            <comment id="17716830" author="stanio" created="Wed, 26 Apr 2023 17:15:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;URIBuilder&lt;/tt&gt; should not normally encode reserved characters...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Maybe better stated as &lt;em&gt;&quot;&lt;tt&gt;URIBuilder&lt;/tt&gt; should not normally &lt;b&gt;re-&lt;/b&gt;encode reserved characters...&quot;&lt;/em&gt;.  I realize &lt;tt&gt;URIBuilder&lt;/tt&gt; may be used as a URI producer but in the given case it should not re-encode reserved characters from the original production.  It could be just HttpClient fault for how it is using the given &lt;tt&gt;URIBuilder&lt;/tt&gt; class.&lt;/p&gt;</comment>
                            <comment id="17716869" author="olegk" created="Wed, 26 Apr 2023 19:03:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stanio&quot; class=&quot;user-hover&quot; rel=&quot;stanio&quot;&gt;stanio&lt;/a&gt; What you are saying is completely wrong. Tested with&#160;5.2.2-SNAPSHOT.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testStuff() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; URIBuilder builder1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URIBuilder(&lt;span class=&quot;code-quote&quot;&gt;&quot;/foo;bar=baz&quot;&lt;/span&gt;);
        Assertions.assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;/foo;bar=baz&quot;&lt;/span&gt;, builder1.getPath());
        Assertions.assertEquals(Collections.singletonList(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo;bar=baz&quot;&lt;/span&gt;), builder1.getPathSegments());
        Assertions.assertEquals(URI.create(&lt;span class=&quot;code-quote&quot;&gt;&quot;/foo;bar=baz&quot;&lt;/span&gt;), builder1.build());

        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; URIBuilder builder2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URIBuilder(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8080/foo;bar=baz&quot;&lt;/span&gt;);
&lt;/span&gt;        Assertions.assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;/foo;bar=baz&quot;&lt;/span&gt;, builder2.getPath());
        Assertions.assertEquals(Collections.singletonList(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo;bar=baz&quot;&lt;/span&gt;), builder2.getPathSegments());
        Assertions.assertEquals(URI.create(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8080/foo;bar=baz&quot;&lt;/span&gt;), builder2.build());
&lt;/span&gt;    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17716875" author="stanio" created="Wed, 26 Apr 2023 19:15:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;, what part of my saying is &quot;completely wrong&quot;?  You may have a look back at my exact example a few comments prior (using 5.2.1):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        URI resolved = URI.create(&lt;span class=&quot;code-quote&quot;&gt;&quot;/foo;bar=baz&quot;&lt;/span&gt;);
        URIBuilder builder = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URIBuilder(resolved);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(builder.build()); &lt;span class=&quot;code-comment&quot;&gt;// OK: /foo;bar=baz
&lt;/span&gt;        builder.normalizeSyntax();
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(builder.build()); &lt;span class=&quot;code-comment&quot;&gt;// Bad: /foo%3Bbar%3Dbaz&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note, the &lt;tt&gt;normalizeSyntax()&lt;/tt&gt; call &#8211; that&apos;s what I&apos;m observing in current sources:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/48e4229843eed904858206d650da8f5090f40d0b/httpclient5/src/main/java/org/apache/hc/client5/http/impl/DefaultRedirectStrategy.java#L92-L102&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;DefaultRedirectStrategy.java:92-102&lt;/tt&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/48e4229843eed904858206d650da8f5090f40d0b/httpclient5/src/main/java/org/apache/hc/client5/http/utils/URIUtils.java#L195-L220&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;URIUtils.java:195-220&lt;/tt&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17716888" author="michael-o" created="Wed, 26 Apr 2023 19:40:24 +0000"  >&lt;p&gt;I am reopening this because I think here are too many misunderstandings.&lt;/p&gt;</comment>
                            <comment id="17716889" author="olegk" created="Wed, 26 Apr 2023 19:44:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stanio&quot; class=&quot;user-hover&quot; rel=&quot;stanio&quot;&gt;stanio&lt;/a&gt; Your assertion about URIBuilder behaving differently depending whether the URI is relative or absolute is wrong. Your assertion about URIBuilder re-encoding or even mangling the original URI is wrong. Your assertion about the so called path parameters being defined in the Path component specification is wrong. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testStuff() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; URIBuilder builder1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URIBuilder(&lt;span class=&quot;code-quote&quot;&gt;&quot;/foo;bar=baz&quot;&lt;/span&gt;);
        Assertions.assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;/foo;bar=baz&quot;&lt;/span&gt;, builder1.getPath());
        Assertions.assertEquals(Collections.singletonList(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo;bar=baz&quot;&lt;/span&gt;), builder1.getPathSegments());
        Assertions.assertEquals(URI.create(&lt;span class=&quot;code-quote&quot;&gt;&quot;/foo;bar=baz&quot;&lt;/span&gt;), builder1.build());
        Assertions.assertEquals(URI.create(&lt;span class=&quot;code-quote&quot;&gt;&quot;/foo%3Bbar%3Dbaz&quot;&lt;/span&gt;), builder1.normalizeSyntax().build());

        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; URIBuilder builder2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URIBuilder(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8080/foo;bar=baz&quot;&lt;/span&gt;);
&lt;/span&gt;        Assertions.assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;/foo;bar=baz&quot;&lt;/span&gt;, builder2.getPath());
        Assertions.assertEquals(Collections.singletonList(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo;bar=baz&quot;&lt;/span&gt;), builder2.getPathSegments());
        Assertions.assertEquals(URI.create(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8080/foo;bar=baz&quot;&lt;/span&gt;), builder2.build());
&lt;/span&gt;        Assertions.assertEquals(URI.create(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8080/foo%3Bbar%3Dbaz&quot;&lt;/span&gt;), builder2.normalizeSyntax().build());
&lt;/span&gt;    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17716890" author="olegk" created="Wed, 26 Apr 2023 19:44:54 +0000"  >&lt;p&gt;&amp;gt; I am reopening this because I think here are too many misunderstandings.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michael-o&quot; class=&quot;user-hover&quot; rel=&quot;michael-o&quot;&gt;michael-o&lt;/a&gt; Exactly what misunderstandings are you referring to?&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17716895" author="stanio" created="Wed, 26 Apr 2023 19:52:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;, I&apos;ve made the observation the HttpClient / DefaultRedirectStrategy is behaving wrong.  I&apos;ve seen it uses the URIBuilder class and its normalizeSyntax() method &#8211; that&apos;s what causes the wrong outcome.  I&apos;ve explicitly stated the URIBuilder behavior could be o.k. but then its usage in HttpClient / DefaultRedirectStrategy (via URIUtils) doesn&apos;t appear right.&lt;/p&gt;</comment>
                            <comment id="17716899" author="michael-o" created="Wed, 26 Apr 2023 20:00:17 +0000"  >&lt;p&gt;We have the following problems here:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;As RFC 3986 says protocol-specific meaning can be applied to the reserved characaters which make them different from normal chars which the builder ignores and assumes those to be part of the path segment&lt;/li&gt;
	&lt;li&gt;normalizeSyntax seems to encode everything even if there is no technical need according to RFC 3986&lt;/li&gt;
	&lt;li&gt;Yes, it is a URI builder, but it ignores the semantics of HTTP URLs, which is obvious&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;For me, these URIs are not identical: &lt;tt&gt;&lt;a href=&quot;http://localhost:8080/foo%3Bbar%3Dbaz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/foo%3Bbar%3Dbaz&lt;/a&gt;&lt;/tt&gt; and &lt;tt&gt;&lt;a href=&quot;http://localhost:8080/foo;bar=baz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/foo;bar=baz&lt;/a&gt;&lt;/tt&gt;. The first has one path segment, the second one path segment and one matrix parameter. This makes a difference!&lt;/p&gt;</comment>
                            <comment id="17716901" author="michael-o" created="Wed, 26 Apr 2023 20:05:32 +0000"  >&lt;blockquote&gt;
&lt;p&gt; URI producing applications should percent-encode data octets that&lt;br/&gt;
   correspond to characters in the reserved set unless these characters&lt;br/&gt;
   are specifically allowed by the URI scheme to represent data in that&lt;br/&gt;
   component.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;and for HTTP they are allowed.&lt;/p&gt;</comment>
                            <comment id="17716903" author="olegk" created="Wed, 26 Apr 2023 20:12:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michael-o&quot; class=&quot;user-hover&quot; rel=&quot;michael-o&quot;&gt;michael-o&lt;/a&gt; There are no such things as matrix parameters in the Path component definition in the RFC 3986. Please provide a reference to an RFC that defines HTTP path elements. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stanio&quot; class=&quot;user-hover&quot; rel=&quot;stanio&quot;&gt;stanio&lt;/a&gt; Could you please provide a unit test demonstrating what you think is wrong with `DefaultRedirectStrategy`, and yes, this would be the wrong project and place for that.&lt;/p&gt;

&lt;p&gt;Oleg   &lt;/p&gt;</comment>
                            <comment id="17716904" author="michael-o" created="Wed, 26 Apr 2023 20:19:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;, and that is the problem. OF course, RFC 3986 is application-agnostic, but HTTP is the application here and it uses matrix parameters. That is the exact problem. To our surprise, we produce URLs exactly for one application: HTTP.&lt;/p&gt;

&lt;p&gt;I am not saything that it is not RFC compliant, but it ignores the application context it is used it.&lt;/p&gt;</comment>
                            <comment id="17716905" author="olegk" created="Wed, 26 Apr 2023 20:23:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michael-o&quot; class=&quot;user-hover&quot; rel=&quot;michael-o&quot;&gt;michael-o&lt;/a&gt; There is no such thing as matrix parameters. Please kindly close the issue.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17716906" author="michael-o" created="Wed, 26 Apr 2023 20:27:08 +0000"  >&lt;p&gt;Of course, there are: &lt;a href=&quot;https://docs.oracle.com/javaee/7/api/javax/ws/rs/MatrixParam.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javaee/7/api/javax/ws/rs/MatrixParam.html&lt;/a&gt; and &lt;a href=&quot;https://www.baeldung.com/spring-mvc-matrix-variables&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.baeldung.com/spring-mvc-matrix-variables&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;JAX-RS and Spring WebMVC support them natively. Again, this is application-specific: HTTP and it is in compliance with RFC 3986 per section 2.2.&lt;/p&gt;</comment>
                            <comment id="17716911" author="olegk" created="Wed, 26 Apr 2023 20:36:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michael-o&quot; class=&quot;user-hover&quot; rel=&quot;michael-o&quot;&gt;michael-o&lt;/a&gt; No, there are not. It is some custom stuff invented by some vendors and it has nothing to do with the HTTP specification what so ever. Spring should be able to deal with those custom elements percent encoded. &lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17716913" author="michael-o" created="Wed, 26 Apr 2023 20:38:55 +0000"  >&lt;p&gt;Then I would really like to here &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reschke&quot; class=&quot;user-hover&quot; rel=&quot;reschke&quot;&gt;reschke&lt;/a&gt;&apos;s answer on this before we close it.&lt;/p&gt;</comment>
                            <comment id="17716914" author="michael-o" created="Wed, 26 Apr 2023 20:39:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markt&quot; class=&quot;user-hover&quot; rel=&quot;markt&quot;&gt;markt&lt;/a&gt;, what is your stance on this?&lt;/p&gt;</comment>
                            <comment id="17716915" author="michael-o" created="Wed, 26 Apr 2023 20:42:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;, I need to give you at least one credit since the matrix params are (for whatsoever reason) Java only. What about &lt;a href=&quot;https://www.rfc-editor.org/rfc/rfc3986#section-3.3:&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.rfc-editor.org/rfc/rfc3986#section-3.3:&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;   Aside from dot-segments in hierarchical paths, a path segment is&lt;br/&gt;
   considered opaque by the generic syntax.  URI producing applications&lt;br/&gt;
   often use the reserved characters allowed in a segment to delimit&lt;br/&gt;
   scheme-specific or dereference-handler-specific subcomponents.  For&lt;br/&gt;
   example, the semicolon (&quot;;&quot;) and equals (&quot;=&quot;) reserved characters are&lt;br/&gt;
   often used to delimit parameters and parameter values applicable to&lt;br/&gt;
   that segment.  The comma (&quot;,&quot;) reserved character is often used for&lt;br/&gt;
   similar purposes.  For example, one URI producer might use a segment&lt;br/&gt;
   such as &quot;name;v=1.1&quot; to indicate a reference to version 1.1 of&lt;br/&gt;
   &quot;name&quot;, whereas another might use a segment such as &quot;name,1.1&quot; to&lt;br/&gt;
   indicate the same.  Parameter types may be defined by scheme-specific&lt;br/&gt;
   semantics, but in most cases the syntax of a parameter is specific to&lt;br/&gt;
   the implementation of the URI&apos;s dereferencing algorithm.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This basically describes matrix parameters.&lt;/p&gt;</comment>
                            <comment id="17716917" author="stanio" created="Wed, 26 Apr 2023 20:51:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;It is some custom stuff invented by some vendors and it has nothing to do with the HTTP specification what so ever.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;From previous &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc2396#section-3.3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;RFC 2396&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;   The path may consist of a sequence of path segments separated by a&lt;br/&gt;
   single slash &quot;/&quot; character.  Within a path segment, the characters&lt;br/&gt;
   &quot;/&quot;, &quot;;&quot;, &quot;=&quot;, and &quot;?&quot; are reserved.  Each path segment may include a&lt;br/&gt;
   sequence of parameters, indicated by the semicolon &quot;;&quot; character.&lt;br/&gt;
   The parameters are not significant to the parsing of relative&lt;br/&gt;
   references.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="17716929" author="markt" created="Wed, 26 Apr 2023 21:59:36 +0000"  >&lt;p&gt;TL;DR - There is a bug here. The redirect URI should not be being modified to encode the &apos;;&apos; or the &apos;=&apos;. Encoding those characters changes the meaning of the URI.&lt;/p&gt;

&lt;p&gt;The (slightly) longer version:&lt;/p&gt;

&lt;p&gt;Nothing in RFC 3986 states that a reserved character can be replaced by the %nn encoded value for that character. RFC 3986 (section 6.2.2.2) is explicit that %nn encoded characters are only equivalent to their non-encoded forms for unreserved characters. Both &apos;;&apos; and &apos;=&apos; are reserved (RFC 3986, section 2.2). Therefore the the relative URIs &quot;/a/b;c=d&quot; and &quot;/a/b%3bc%3dd&quot; are NOT equivalent.&lt;/p&gt;

&lt;p&gt;RFC 3986 treats path segments as opaque. It does not define the meaning of reserved characters such as &apos;;&apos;. It does, however, note that (section 3.3) that &apos;the semicolon (&quot;;&quot;) and equals (&quot;=&quot;) reserved characters are often used to delimit parameters and parameter values applicable to that segment&apos;. Prior versions of this RFC did specify how reserved characters were to be used for parameters. RFC 3986 deliberately chose to take a more generic approach and leave the exact definition to others. As long as the client and server a) agree the format to be used and b) are consistent with the generic rules set out in RFC 3986 they are free to use any reserved characters they wish in any way they wish. RFC 3986 compliant tools MUST treat path segements as opaque in order not to interfer with any such mechanisms.&lt;/p&gt;</comment>
                            <comment id="17716979" author="reschke" created="Thu, 27 Apr 2023 05:17:23 +0000"  >&lt;p&gt;I believe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markt&quot; class=&quot;user-hover&quot; rel=&quot;markt&quot;&gt;markt&lt;/a&gt; is right here.&lt;/p&gt;</comment>
                            <comment id="17716986" author="olegk" created="Thu, 27 Apr 2023 05:51:17 +0000"  >&lt;p&gt;&amp;gt; RFC 3986 (section 6.2.2.2) is explicit that %nn encoded characters are only equivalent to their non-encoded forms for unreserved characters.&lt;/p&gt;

&lt;p&gt;With all due respect &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markt&quot; class=&quot;user-hover&quot; rel=&quot;markt&quot;&gt;markt&lt;/a&gt; but is it? To me it looks it explicitly states something quite different and the rest is just a conjecture.&lt;/p&gt;

&lt;p&gt;Oleg &lt;/p&gt;</comment>
                            <comment id="17717010" author="michael-o" created="Thu, 27 Apr 2023 06:35:56 +0000"  >&lt;p&gt;Oleg, we are talking about reserved only.&lt;/p&gt;</comment>
                            <comment id="17717040" author="stanio" created="Thu, 27 Apr 2023 07:51:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stanio&quot; class=&quot;user-hover&quot; rel=&quot;stanio&quot;&gt;stanio&lt;/a&gt; Could you please provide a unit test demonstrating what you think is wrong with `DefaultRedirectStrategy`&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Here it is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testResolveRelativeLocation() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; DefaultRedirectStrategy redirectStrategy = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultRedirectStrategy();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpClientContext context = HttpClientContext.create();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpGet request = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HttpGet(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost/&quot;&lt;/span&gt;);
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpResponse response = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BasicHttpResponse(HttpStatus.SC_MOVED_TEMPORARILY, &lt;span class=&quot;code-quote&quot;&gt;&quot;Redirect&quot;&lt;/span&gt;);
        response.addHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;Location&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;/foo;bar=baz&quot;&lt;/span&gt;);

        URI locationURI = redirectStrategy.getLocationURI(request, response, context);

        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;locationURI&quot;&lt;/span&gt;, URI.create(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost/foo;bar=baz&quot;&lt;/span&gt;), locationURI);
&lt;/span&gt;    }

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testUseAbsoluteLocation() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; DefaultRedirectStrategy redirectStrategy = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultRedirectStrategy();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpClientContext context = HttpClientContext.create();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpGet request = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HttpGet(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost/&quot;&lt;/span&gt;);
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpResponse response = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BasicHttpResponse(HttpStatus.SC_MOVED_TEMPORARILY, &lt;span class=&quot;code-quote&quot;&gt;&quot;Redirect&quot;&lt;/span&gt;);
        response.addHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;Location&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost/foo;bar=baz&quot;&lt;/span&gt;);
&lt;/span&gt;
        URI locationURI = redirectStrategy.getLocationURI(request, response, context);

        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;locationURI&quot;&lt;/span&gt;, URI.create(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost/foo;bar=baz&quot;&lt;/span&gt;), locationURI);
&lt;/span&gt;    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The former is currently failing, the latter is o.k.&lt;/p&gt;</comment>
                            <comment id="17717044" author="markt" created="Thu, 27 Apr 2023 07:54:46 +0000"  >&lt;p&gt;Yes, in this context (normalization) it is explicit.&lt;/p&gt;

&lt;p&gt;The nature and purpose of syntax based normalization is such that the RFC has to define the complete process. Adding or removing to the set of characters that is affected by percent-encoding normalization changes the definition of equivalent. The RFC is clear that only percent encoded octets that represent unreserved characters should be decoded.&lt;/p&gt;

&lt;p&gt;To put it another way, if it was permitted to switch the &apos;;&apos; and &apos;=&apos; in the original URIs in question to their %nn forms without changing the meaning of the URI then normalizing the two versions of the URI would result in the same string. It doesn&apos;t. Therefore the two URIs are not equivalent. Therefore the original transformation (replacing &apos;;&apos; and &apos;=&apos; with the %nn forms) was not valid.&lt;/p&gt;</comment>
                            <comment id="17717061" author="olegk" created="Thu, 27 Apr 2023 08:34:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markt&quot; class=&quot;user-hover&quot; rel=&quot;markt&quot;&gt;markt&lt;/a&gt; What URIBuilder does is conceptually very simple: it decomposes the original URI into its constituent components based on the component specification of the RFC and then re-assembles the URI based on the same component specification. Now you appear to be saying that URI normalization is something else. This makes no sense to me what so ever, but so be it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michael-o&quot; class=&quot;user-hover&quot; rel=&quot;michael-o&quot;&gt;michael-o&lt;/a&gt; I propose we do the following:  rename `#normalizeSyntax` to `#rebuild` or some such and deprecate the actual `#normalizeSyntax`. Whoever is so inclined is welcome to undeprecate the method and re-implement it based on the latest popular interpretation of the RFC there is.&lt;/p&gt;

&lt;p&gt;Oleg   &lt;/p&gt;</comment>
                            <comment id="17717105" author="jira-bot" created="Thu, 27 Apr 2023 10:12:07 +0000"  >&lt;p&gt;Commit 9bbc48965f62fd1aa528fc14f54438474153fedc in httpcomponents-core&apos;s branch refs/heads/5.3.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=9bbc48965&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=9bbc48965&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2271&quot; title=&quot;Do not optimize relative redirect location&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2271&quot;&gt;&lt;del&gt;HTTPCORE-744&lt;/del&gt;&lt;/a&gt;: removed references to URI normalization from URIBuilder; deprecated URIBuilder#normalizeSyntax&lt;/p&gt;</comment>
                            <comment id="17717106" author="olegk" created="Thu, 27 Apr 2023 10:15:27 +0000"  >&lt;p&gt;URI syntax normalization is no more.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stanio&quot; class=&quot;user-hover&quot; rel=&quot;stanio&quot;&gt;stanio&lt;/a&gt; Please raise a separate ticket with the HttpClient project and request removal of URI normalization from URIUtils.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17717120" author="michael-o" created="Thu, 27 Apr 2023 11:01:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;, the change isn&apos;t really clear to me, it is just a rename (ATM), no real change. Why not use the proper term &lt;tt&gt;normalize()&lt;/tt&gt; and do not touch reserved chars?&lt;/p&gt;</comment>
                            <comment id="17717121" author="olegk" created="Thu, 27 Apr 2023 11:06:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michael-o&quot; class=&quot;user-hover&quot; rel=&quot;michael-o&quot;&gt;michael-o&lt;/a&gt; Because it sounds illogical to me. You are welcome though to contribute a new normalization method as you deem fit.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17717133" author="michael-o" created="Thu, 27 Apr 2023 11:28:20 +0000"  >&lt;p&gt;Ah, ok. Your approach is not to use the term &apos;normalize&apos; because it does not meet expectations, but provide an &apos;optimize&apos; method which may yield a proper result or not?&lt;/p&gt;</comment>
                            <comment id="17717135" author="michael-o" created="Thu, 27 Apr 2023 11:32:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markt&quot; class=&quot;user-hover&quot; rel=&quot;markt&quot;&gt;markt&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reschke&quot; class=&quot;user-hover&quot; rel=&quot;reschke&quot;&gt;reschke&lt;/a&gt;, thanks for the clarification!&lt;/p&gt;</comment>
                            <comment id="17717136" author="michael-o" created="Thu, 27 Apr 2023 11:33:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krasimir.malchev&quot; class=&quot;user-hover&quot; rel=&quot;krasimir.malchev&quot;&gt;krasimir.malchev&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stanio&quot; class=&quot;user-hover&quot; rel=&quot;stanio&quot;&gt;stanio&lt;/a&gt;, do you both want to provide an updated normalize method which does NOT touch reserved chars?&lt;/p&gt;</comment>
                            <comment id="17717158" author="stanio" created="Thu, 27 Apr 2023 12:18:15 +0000"  >&lt;p&gt;I personally don&apos;t have prior HttpClient experience and I don&apos;t feel comfortable tweaking its implementation, for the time being.&lt;/p&gt;</comment>
                            <comment id="17717247" author="jira-bot" created="Thu, 27 Apr 2023 14:24:33 +0000"  >&lt;p&gt;Commit 1b3248d10fa6a86abaca1ed5ef3ba395b87b4ce5 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=1b3248d10&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=1b3248d10&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2271&quot; title=&quot;Do not optimize relative redirect location&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2271&quot;&gt;&lt;del&gt;HTTPCLIENT-2271&lt;/del&gt;&lt;/a&gt;: Do not optimize the path component of the resolved URI by default.&lt;/p&gt;</comment>
                            <comment id="17717265" author="jira-bot" created="Thu, 27 Apr 2023 15:14:09 +0000"  >&lt;p&gt;Commit 3e38a5e5ec4858be5794c22b59c2dad2b1c81f6a in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=3e38a5e5e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=3e38a5e5e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2271&quot; title=&quot;Do not optimize relative redirect location&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2271&quot;&gt;&lt;del&gt;HTTPCLIENT-2271&lt;/del&gt;&lt;/a&gt;: Do not optimize the path component of the resolved URI by default.&lt;/p&gt;</comment>
                            <comment id="17720311" author="jira-bot" created="Sun, 7 May 2023 13:31:22 +0000"  >&lt;p&gt;Commit 7faef15da1bb08e12691d1194a88c183de724b8c in httpcomponents-core&apos;s branch refs/heads/5.3.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=7faef15da&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=7faef15da&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2271&quot; title=&quot;Do not optimize relative redirect location&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2271&quot;&gt;&lt;del&gt;HTTPCORE-744&lt;/del&gt;&lt;/a&gt;: removed references to URI normalization from URIBuilder; deprecated URIBuilder#normalizeSyntax&lt;/p&gt;</comment>
                            <comment id="17722687" author="JIRAUSER300076" created="Mon, 15 May 2023 07:59:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Oleg Kalnichevski&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michael-o&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Michael Osipov&lt;/a&gt; Where can I find the 5.2.2 http components archive files in order to test it?&lt;/p&gt;

&lt;p&gt;I cannot find it in maven nor in &lt;a href=&quot;https://hc.apache.org/downloads.cgi&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache http components download page&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="17736798" author="jira-bot" created="Sat, 24 Jun 2023 21:40:16 +0000"  >&lt;p&gt;Commit 3e38a5e5ec4858be5794c22b59c2dad2b1c81f6a in httpcomponents-client&apos;s branch refs/heads/dependabot/maven/jna.version-5.13.0 from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=3e38a5e5e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=3e38a5e5e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2271&quot; title=&quot;Do not optimize relative redirect location&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2271&quot;&gt;&lt;del&gt;HTTPCLIENT-2271&lt;/del&gt;&lt;/a&gt;: Do not optimize the path component of the resolved URI by default.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13057603" name="Simulation.zip" size="188245" author="krasimir.malchev" created="Wed, 26 Apr 2023 12:29:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 19 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1hjm8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>