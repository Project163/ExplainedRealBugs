<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:22:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-2099] unlimited socket timeout results in the connect timeout being used as a socket timeout</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-2099</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;Problem:&lt;/p&gt;

&lt;p&gt;When setting an unlimited socket timeout (not a very good idea in most cases, I can&apos;t defend the practice) requests time out after a few moments, which turned out to exactly match the connect timeout.&lt;/p&gt;

&lt;p&gt;Tested using 5.0.1 classic client for both http and https requests.&lt;/p&gt;

&lt;p&gt;The problem appears to stem from &lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/986686535750a6a665a206ba0cc892d8fb24bbec/httpclient5/src/main/java/org/apache/hc/client5/http/ssl/SSLConnectionSocketFactory.java#L210-L212&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/blob/986686535750a6a665a206ba0cc892d8fb24bbec/httpclient5/src/main/java/org/apache/hc/client5/http/ssl/SSLConnectionSocketFactory.java#L210-L212&lt;/a&gt;&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (TimeValue.isPositive(connectTimeout) &amp;amp;&amp;amp; sock.getSoTimeout() == 0) {
    sock.setSoTimeout(connectTimeout.toMillisecondsIntBound());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I can understand setting the connect timeout as a socket timeout for some period of time setting up the connection, perhaps until the handshake completes, unfortunately when the connect timeout is set, it&apos;s never reverted.&lt;/p&gt;

&lt;p&gt;The solutions I can imagine, I think the difference boils down to whether or not we want the connect timeout to apply to tls handshakes.&lt;/p&gt;

&lt;p&gt;1. Remove the highlighted conditional entirely, leaving connect timeout only used as an argument to Socket.connect. This would not cover tls handshakes with the connect timeout.&lt;/p&gt;

&lt;p&gt;2. Update to use the configured connect timeout regardless of the current socket timeout, and set the socket timeout again once a connection has been established.&#160; This would apply the configured connect timeout to handshakes.&lt;/p&gt;

&lt;p&gt;Which option would you prefer, perhaps a third option I haven&apos;t considered?&lt;br/&gt;
Thanks!&lt;/p&gt;</description>
                <environment></environment>
        <key id="13316242">HTTPCLIENT-2099</key>
            <summary>unlimited socket timeout results in the connect timeout being used as a socket timeout</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ckozak">Carter Kozak</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Jul 2020 21:47:14 +0000</created>
                <updated>Sat, 11 Jul 2020 15:44:03 +0000</updated>
                            <resolved>Sat, 11 Jul 2020 15:20:56 +0000</resolved>
                                    <version>5.0.1</version>
                                    <fixVersion>5.0.2</fixVersion>
                                    <component>HttpClient (classic)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4200">1h 10m</timespent>
                                <comments>
                            <comment id="17155986" author="olegk" created="Sat, 11 Jul 2020 13:34:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ckozak&quot; class=&quot;user-hover&quot; rel=&quot;ckozak&quot;&gt;ckozak&lt;/a&gt;&#160;This is another example that no matter how hard I try I cannot make everyone happy.&#160;&lt;/p&gt;

&lt;p&gt;As of next release HttpCore 5.x will use a finite socket timeout by default (see&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2091&quot; title=&quot;Connect timeout is used instead of socket timeout after a tls upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2091&quot;&gt;&lt;del&gt;HTTPCLIENT-2091&lt;/del&gt;&lt;/a&gt;), so this logic will no longer be necessary or useful. Let&apos;s remove it in 5.1&#160;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17155995" author="ckozak" created="Sat, 11 Jul 2020 14:14:23 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;, I&apos;m less concerned about default values, in my case they&apos;re always overridden based on another configuration. The problem is when the configuration sets an unlimited socket timeout and a bounded connect timeout, the connect timeout is unexpectedly used instead of the socket timeout for the life of the connection.&lt;/p&gt;

&lt;p&gt;I never actually set the RequestConfig.responseTimeout because it wasn&apos;t clear that it would simply be used as a socket timeout for the duration of the request, I assumed it would only be set after the request bytes had been fully sent, and reverted once the response line was received. Instead, it appears that the value updates the socket timeout before sending the request, and is removed once the request has completed and the connection is passivated. I&apos;d be happy to update the javadoc to describe this case.&lt;/p&gt;</comment>
                            <comment id="17156002" author="olegk" created="Sat, 11 Jul 2020 15:00:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ckozak&quot; class=&quot;user-hover&quot; rel=&quot;ckozak&quot;&gt;ckozak&lt;/a&gt;&#160;For the sake of consistency with&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2091&quot; title=&quot;Connect timeout is used instead of socket timeout after a tls upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2091&quot;&gt;&lt;del&gt;HTTPCLIENT-2091&lt;/del&gt;&lt;/a&gt; let&apos;s just remove that conditional statement. I actually should have done it as a part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2091&quot; title=&quot;Connect timeout is used instead of socket timeout after a tls upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2091&quot;&gt;&lt;del&gt;HTTPCLIENT-2091&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17156003" author="ckozak" created="Sat, 11 Jul 2020 15:01:51 +0000"  >&lt;p&gt;Sounds good, I&apos;ll open a PR shortly. Thanks for your help!&lt;/p&gt;</comment>
                            <comment id="17156006" author="ckozak" created="Sat, 11 Jul 2020 15:10:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-client/pull/241&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/pull/241&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17156012" author="jira-bot" created="Sat, 11 Jul 2020 15:19:37 +0000"  >&lt;p&gt;Commit 5bdcb242f0297c9dca8f6284ed5a4dd062a210b7 in httpcomponents-client&apos;s branch refs/heads/master from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=5bdcb24&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=5bdcb24&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2099&quot; title=&quot;unlimited socket timeout results in the connect timeout being used as a socket timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2099&quot;&gt;&lt;del&gt;HTTPCLIENT-2099&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2091&quot; title=&quot;Connect timeout is used instead of socket timeout after a tls upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2091&quot;&gt;&lt;del&gt;HTTPCLIENT-2091&lt;/del&gt;&lt;/a&gt;: SSLConnectionSocketFactory connect timeout fix (#241)&lt;/p&gt;

&lt;p&gt;SSLConnectionSocketFactory no longer overrides the socket timeout&lt;br/&gt;
with the connect timeout when an unlimited socket timeout is&lt;br/&gt;
configured. This matches behavior of &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2091&quot; title=&quot;Connect timeout is used instead of socket timeout after a tls upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2091&quot;&gt;&lt;del&gt;HTTPCLIENT-2091&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Note that in scenarios where SocketConfig sets an infinite timeout&lt;br/&gt;
and the RequestConfig sets a bounded timeout, this change results&lt;br/&gt;
in the connect-timeout no longer applying to the TLS handshake.&lt;br/&gt;
This behavior can be retained by setting the expected timeout in&lt;br/&gt;
the SocketConfig.&lt;/p&gt;</comment>
                            <comment id="17156027" author="jira-bot" created="Sat, 11 Jul 2020 15:38:51 +0000"  >&lt;p&gt;Commit 5bdcb242f0297c9dca8f6284ed5a4dd062a210b7 in httpcomponents-client&apos;s branch refs/heads/5.1.x from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=5bdcb24&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=5bdcb24&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2099&quot; title=&quot;unlimited socket timeout results in the connect timeout being used as a socket timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2099&quot;&gt;&lt;del&gt;HTTPCLIENT-2099&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2091&quot; title=&quot;Connect timeout is used instead of socket timeout after a tls upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2091&quot;&gt;&lt;del&gt;HTTPCLIENT-2091&lt;/del&gt;&lt;/a&gt;: SSLConnectionSocketFactory connect timeout fix (#241)&lt;/p&gt;

&lt;p&gt;SSLConnectionSocketFactory no longer overrides the socket timeout&lt;br/&gt;
with the connect timeout when an unlimited socket timeout is&lt;br/&gt;
configured. This matches behavior of &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2091&quot; title=&quot;Connect timeout is used instead of socket timeout after a tls upgrade&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2091&quot;&gt;&lt;del&gt;HTTPCLIENT-2091&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Note that in scenarios where SocketConfig sets an infinite timeout&lt;br/&gt;
and the RequestConfig sets a bounded timeout, this change results&lt;br/&gt;
in the connect-timeout no longer applying to the TLS handshake.&lt;br/&gt;
This behavior can be retained by setting the expected timeout in&lt;br/&gt;
the SocketConfig.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 18 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0go0o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>