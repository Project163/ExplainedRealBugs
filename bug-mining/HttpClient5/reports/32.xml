<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:21:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-1944] Async request aborts working on HTTP/2, but not HTTP/1.1</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-1944</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;I have some test code that looks approximately like the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
client = useHttp2 ? HttpAsyncClients.createHttp2Default() : HttpAsyncClients.createDefault();
client.start();
AsyncEntityProducer requestBody = ...; &lt;span class=&quot;code-comment&quot;&gt;// A slow, endless stream of data
&lt;/span&gt;
AsyncRequestProducer post = AsyncRequestBuilder.create(&lt;span class=&quot;code-quote&quot;&gt;&quot;POST&quot;&lt;/span&gt;)
    .setUri(endpoint)
    .setEntity(requestBody)
    .build();

Future&amp;lt;SimpleHttpResponse&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; = client.execute(post, SimpleResponseConsumer.create(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FutureCallback&amp;lt;SimpleHttpResponse&amp;gt;() {
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void completed(SimpleHttpResponse result) {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Request &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; completed&quot;&lt;/span&gt;);
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void failed(Exception ex) {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Request &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; failed&quot;&lt;/span&gt;);
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void cancelled() {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Request &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; cancelled&quot;&lt;/span&gt;);
    }
});

&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(5_000);

&lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;.cancel(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What I&apos;m observing is that request cancellation works immediately with the HTTP/2 request, but doesn&apos;t work at all with the HTTP/1.1 request, which runs until it times out. My own FutureCallback gets notified of the cancellation of the request, but nothing else takes place within the client itself; the Cancellable associated with the request at the time of cancellation is a NOOP_CANCELLABLE, whereas the HTTP/2 request has a callback installed that aborts the underlying h2 stream.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13179496">HTTPCLIENT-1944</key>
            <summary>Async request aborts working on HTTP/2, but not HTTP/1.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rschmitt">Ryan Schmitt</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Aug 2018 03:00:04 +0000</created>
                <updated>Fri, 31 Aug 2018 20:26:11 +0000</updated>
                            <resolved>Fri, 31 Aug 2018 12:53:03 +0000</resolved>
                                    <version>5.0 Beta1</version>
                                    <fixVersion>5.0 Beta2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16583723" author="olegk" created="Fri, 17 Aug 2018 10:02:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt; HTTP/2 protocol provides a means of cancellation of ongoing requests, whereas HTTP/1.1 does not. What would&#160;you expect to happen in case of HTTP/1.1 response future cancellation? Connection shutdown?&lt;/p&gt;

&lt;p&gt;Oleg&#160;&lt;/p&gt;</comment>
                            <comment id="16584131" author="rschmitt" created="Fri, 17 Aug 2018 16:15:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt; Yes, I would absolutely like to be able to opt in to that behavior, as it is the only way the client can signal to the server to stop working on the request, or to not start (if the request is only buffered), or to stop streaming data to the client that it has to simply swallow. Is there a way to do this?&lt;/p&gt;</comment>
                            <comment id="16585173" author="olegk" created="Sun, 19 Aug 2018 15:06:35 +0000"  >&lt;p&gt;What should happen with other response futures that might be bound to the same connection?&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16585215" author="rschmitt" created="Sun, 19 Aug 2018 17:23:08 +0000"  >&lt;p&gt;Are there any ways that this can occur, other than HTTP pipelining? I would imagine that this can already occur with pipelined requests.&lt;/p&gt;</comment>
                            <comment id="16585218" author="olegk" created="Sun, 19 Aug 2018 17:35:31 +0000"  >&lt;p&gt;Not necessarily. This really depends on persistent connection management&#160;logic of&#160;a specific &lt;tt&gt;HttpAsyncClient&lt;/tt&gt;&#160;implementation.&#160;&#160;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16585234" author="rschmitt" created="Sun, 19 Aug 2018 18:08:25 +0000"  >&lt;p&gt;In that case, I would imagine that the other response futures would have to be failed, and then the relevant retry logic (if any) would take over. Would this be any different from how socket timeouts are handled?&lt;/p&gt;</comment>
                            <comment id="16585235" author="olegk" created="Sun, 19 Aug 2018 18:13:14 +0000"  >&lt;p&gt;No, it would, though, it may not obvious to some that cancellaton of a single future can cause&#160;other futures to fail with an I/O error or get unexpectedly cancelled.&lt;/p&gt;

&lt;p&gt;You are welcome to submit a patch changing the present behavior but please also contribute javadocs.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16597267" author="olegk" created="Thu, 30 Aug 2018 09:57:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt; What shall we do about this one? Shall we drop it or would you like to&#160;contribute a patch?&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16597495" author="rschmitt" created="Thu, 30 Aug 2018 14:04:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt; This is next on my list. I may be able to take a crack at it today.&lt;/p&gt;</comment>
                            <comment id="16598283" author="githubbot" created="Fri, 31 Aug 2018 05:55:43 +0000"  >&lt;p&gt;GitHub user rschmitt opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/httpcomponents-client/pull/111&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/pull/111&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1944&quot; title=&quot;Async request aborts working on HTTP/2, but not HTTP/1.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-1944&quot;&gt;&lt;del&gt;HTTPCLIENT-1944&lt;/del&gt;&lt;/a&gt;: Add hardCancellationEnabled option to RequestConfig&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rschmitt/httpcomponents-client&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rschmitt/httpcomponents-client&lt;/a&gt; hard-cancel&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/httpcomponents-client/pull/111.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/pull/111.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #111&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ec9927971245d3e6ec7fdfbee0021d70c615bd64&lt;br/&gt;
Author: Ryan Schmitt &amp;lt;ryansch@...&amp;gt;&lt;br/&gt;
Date:   2018-08-31T01:18:39Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1944&quot; title=&quot;Async request aborts working on HTTP/2, but not HTTP/1.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-1944&quot;&gt;&lt;del&gt;HTTPCLIENT-1944&lt;/del&gt;&lt;/a&gt;: Add hardCancellationEnabled option to RequestConfig&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16598288" author="rschmitt" created="Fri, 31 Aug 2018 06:02:24 +0000"  >&lt;p&gt;I have an ancillary PR for httpcore related to this change: &lt;a href=&quot;https://github.com/apache/httpcomponents-core/pull/75&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/pull/75&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As for the hard cancellation behavior, my personal opinion is that this should probably be the default behavior. It&apos;s more consistent with the other clients, since the blocking client always sends a RST upon cancellation and the HTTP/2 client sends a &lt;tt&gt;RST_STREAM&lt;/tt&gt;. I also think it&apos;s less surprising than letting the request continue.&lt;/p&gt;</comment>
                            <comment id="16598677" author="githubbot" created="Fri, 31 Aug 2018 12:32:16 +0000"  >&lt;p&gt;Github user rschmitt commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/httpcomponents-client/pull/111&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/pull/111&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    You can merge it as-is. Changing the default behavior may in turn require test code changes, so I&apos;ll send you a follow-up PR for that.&lt;/p&gt;</comment>
                            <comment id="16598696" author="jira-bot" created="Fri, 31 Aug 2018 12:52:34 +0000"  >&lt;p&gt;Commit ec9927971245d3e6ec7fdfbee0021d70c615bd64 in httpcomponents-client&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rschmitt&quot; class=&quot;user-hover&quot; rel=&quot;rschmitt&quot;&gt;rschmitt&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=httpcomponents-client.git;h=ec99279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=httpcomponents-client.git;h=ec99279&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-1944&quot; title=&quot;Async request aborts working on HTTP/2, but not HTTP/1.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-1944&quot;&gt;&lt;del&gt;HTTPCLIENT-1944&lt;/del&gt;&lt;/a&gt;: Add hardCancellationEnabled option to RequestConfig&lt;/p&gt;</comment>
                            <comment id="16598697" author="githubbot" created="Fri, 31 Aug 2018 12:52:47 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/httpcomponents-client/pull/111&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/pull/111&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16599248" author="rschmitt" created="Fri, 31 Aug 2018 20:26:11 +0000"  >&lt;p&gt;Follow-up for the change of default behavior: &lt;a href=&quot;https://github.com/apache/httpcomponents-client/pull/112&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/pull/112&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 11 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3x52n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>