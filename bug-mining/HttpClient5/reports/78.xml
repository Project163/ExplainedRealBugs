<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:22:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCLIENT-2126] AsyncCachingExec throws NPE when response body is null</title>
                <link>https://issues.apache.org/jira/browse/HTTPCLIENT-2126</link>
                <project id="12310360" key="HTTPCLIENT">HttpComponents HttpClient</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/master/httpclient5-cache/src/main/java/org/apache/hc/client5/http/impl/cache/AsyncCachingExec.java#L160&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/blob/master/httpclient5-cache/src/main/java/org/apache/hc/client5/http/impl/cache/AsyncCachingExec.java#L160&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This makes client&apos;s returned future/callback susccess(AsyncExecCallback#handleResponse triggers this?) but AsyncResponseConsumer/AsyncExecCallback failed.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Curious if it should avoid exception here.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13338754">HTTPCLIENT-2126</key>
            <summary>AsyncCachingExec throws NPE when response body is null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kojilin">koji lin</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Nov 2020 01:24:53 +0000</created>
                <updated>Fri, 6 Nov 2020 08:46:08 +0000</updated>
                            <resolved>Thu, 5 Nov 2020 14:18:01 +0000</resolved>
                                    <version>5.0.3</version>
                                    <fixVersion>5.0.4</fixVersion>
                    <fixVersion>5.1-beta1</fixVersion>
                                    <component>HttpClient (async)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17226027" author="olegk" created="Wed, 4 Nov 2020 12:41:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kojilin&quot; class=&quot;user-hover&quot; rel=&quot;kojilin&quot;&gt;kojilin&lt;/a&gt;&#160;Do you happen to have a test case that actually triggers the NPE?&lt;/p&gt;

&lt;p&gt;Oleg&#160;&lt;/p&gt;</comment>
                            <comment id="17226470" author="kojilin" created="Thu, 5 Nov 2020 02:56:33 +0000"  >&lt;p&gt;Hi the test code is at &lt;a href=&quot;https://github.com/kojilin/test-http-client5/blob/main/src/test/java/HttpClientTest.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kojilin/test-http-client5/blob/main/src/test/java/HttpClientTest.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I made HttpAsync, H2Async, CachingAsync. There is a little different behavior like h2 has null body(HttpAsync will get 0 length body), and cachingH2 may trigger NPE at `failed`.&lt;/p&gt;

&lt;p&gt;Also client builder&apos;s `addExecInterceptorBefore` has lazy execInterceptors init, but addExecInterceptorFirst&amp;amp;addExecInterceptorLast doesn&apos;t.&lt;/p&gt;</comment>
                            <comment id="17226732" author="jira-bot" created="Thu, 5 Nov 2020 14:13:21 +0000"  >&lt;p&gt;Commit 543d73863c3616eb3c6d4fe1ab038cfe893d7af8 in httpcomponents-client&apos;s branch refs/heads/5.0.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=543d738&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=543d738&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2126&quot; title=&quot;AsyncCachingExec throws NPE when response body is null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2126&quot;&gt;&lt;del&gt;HTTPCLIENT-2126&lt;/del&gt;&lt;/a&gt;: `AsyncCachingExec` throws NPE when response body is null&lt;/p&gt;</comment>
                            <comment id="17226735" author="jira-bot" created="Thu, 5 Nov 2020 14:16:49 +0000"  >&lt;p&gt;Commit c9489606d5ae6ff3af6eac9f407260b3e1f4dca0 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=c948960&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=c948960&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2126&quot; title=&quot;AsyncCachingExec throws NPE when response body is null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2126&quot;&gt;&lt;del&gt;HTTPCLIENT-2126&lt;/del&gt;&lt;/a&gt;: `AsyncCachingExec` throws NPE when response body is null&lt;/p&gt;</comment>
                            <comment id="17226736" author="olegk" created="Thu, 5 Nov 2020 14:18:01 +0000"  >&lt;p&gt;Fixed in 5.0.x and master.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17226769" author="kojilin" created="Thu, 5 Nov 2020 15:25:36 +0000"  >&lt;p&gt;I think `dataConsumer.streamEnd(null);` should be included too. Or it should initialize the dataConsumer in streamEnd too?&lt;/p&gt;

&lt;p&gt;Because in some consumer(maybe org.apache.hc.core5.http.nio.support.BasicResponseConsumer?), if we don&apos;t call consume first, dataConsumerRef in streamEnd will be null and NPE in `streamEnd`&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17226796" author="olegk" created="Thu, 5 Nov 2020 16:10:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kojilin&quot; class=&quot;user-hover&quot; rel=&quot;kojilin&quot;&gt;kojilin&lt;/a&gt;&#160;In such a case I would consider it a bug in the consumer class. The consumer must be able to handle no &lt;tt&gt;#consume&lt;/tt&gt; method calls followed by &lt;tt&gt;#streamEnd&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17227079" author="kojilin" created="Thu, 5 Nov 2020 23:35:30 +0000"  >&lt;p&gt;I see. I tried the fix of the change and I think AbstractAsyncResponseConsumer need to handle/initialize `dataConsumerSupplier.get()`.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.NullPointerException
	at org.apache.hc.core5.http.nio.support.AbstractAsyncResponseConsumer.streamEnd(AbstractAsyncResponseConsumer.java:155)
	at org.apache.hc.client5.http.impl.cache.AsyncCachingExec.triggerResponse(AsyncCachingExec.java:163)
	at org.apache.hc.client5.http.impl.cache.AsyncCachingExec.access$700(AsyncCachingExec.java:93)
	at org.apache.hc.client5.http.impl.cache.AsyncCachingExec$BackendResponseHandler$3.completed(AsyncCachingExec.java:544)
	at org.apache.hc.client5.http.impl.cache.AsyncCachingExec$BackendResponseHandler$3.completed(AsyncCachingExec.java:537)
	at org.apache.hc.client5.http.impl.cache.BasicHttpAsyncCache$8.completed(BasicHttpAsyncCache.java:435)
	at org.apache.hc.client5.http.impl.cache.BasicHttpAsyncCache$8.completed(BasicHttpAsyncCache.java:431)
	at org.apache.hc.client5.http.impl.cache.BasicHttpAsyncCache$2.completed(BasicHttpAsyncCache.java:178)
	at org.apache.hc.client5.http.impl.cache.BasicHttpAsyncCache$2.completed(BasicHttpAsyncCache.java:174)
	at org.apache.hc.client5.http.cache.HttpAsyncCacheStorageAdaptor.putEntry(HttpAsyncCacheStorageAdaptor.java:61)
	at org.apache.hc.client5.http.impl.cache.BasicHttpAsyncCache.storeEntry(BasicHttpAsyncCache.java:174)
	at org.apache.hc.client5.http.impl.cache.BasicHttpAsyncCache.storeInCache(BasicHttpAsyncCache.java:166)
	at org.apache.hc.client5.http.impl.cache.BasicHttpAsyncCache.createCacheEntry(BasicHttpAsyncCache.java:431)
	at org.apache.hc.client5.http.impl.cache.AsyncCachingExec$BackendResponseHandler.triggerNewCacheEntryResponse(AsyncCachingExec.java:530)
	at org.apache.hc.client5.http.impl.cache.AsyncCachingExec$BackendResponseHandler$4.completed(AsyncCachingExec.java:585)
	at org.apache.hc.client5.http.impl.cache.AsyncCachingExec$BackendResponseHandler$4.completed(AsyncCachingExec.java:572)
	at org.apache.hc.client5.http.impl.cache.BasicHttpAsyncCache$9.completed(BasicHttpAsyncCache.java:510)
	at org.apache.hc.client5.http.impl.cache.BasicHttpAsyncCache$9.completed(BasicHttpAsyncCache.java:470)
	at org.apache.hc.client5.http.cache.HttpAsyncCacheStorageAdaptor.getEntry(HttpAsyncCacheStorageAdaptor.java:74)
	at org.apache.hc.client5.http.impl.cache.BasicHttpAsyncCache.getCacheEntry(BasicHttpAsyncCache.java:470)
	at org.apache.hc.client5.http.impl.cache.AsyncCachingExec$BackendResponseHandler.completed(AsyncCachingExec.java:572)
	at org.apache.hc.client5.http.impl.cache.AsyncCachingExec$3.completed(AsyncCachingExec.java:342)
	at org.apache.hc.client5.http.impl.async.AsyncProtocolExec$1.completed(AsyncProtocolExec.java:252)
	at org.apache.hc.client5.http.impl.async.H2AsyncMainClientExec$1.consumeResponse(H2AsyncMainClientExec.java:143)
	at org.apache.hc.core5.http2.impl.nio.ClientH2StreamHandler.consumeHeader(ClientH2StreamHandler.java:222)
	at org.apache.hc.core5.http2.impl.nio.AbstractH2StreamMultiplexer$H2Stream.consumeHeader(AbstractH2StreamMultiplexer.java:1596)
	at org.apache.hc.core5.http2.impl.nio.AbstractH2StreamMultiplexer.consumeHeaderFrame(AbstractH2StreamMultiplexer.java:1078)
	at org.apache.hc.core5.http2.impl.nio.AbstractH2StreamMultiplexer.consumeFrame(AbstractH2StreamMultiplexer.java:762)
	at org.apache.hc.core5.http2.impl.nio.AbstractH2StreamMultiplexer.onInput(AbstractH2StreamMultiplexer.java:444)
	at org.apache.hc.core5.http2.impl.nio.AbstractH2IOEventHandler.inputReady(AbstractH2IOEventHandler.java:65)
	at org.apache.hc.core5.http2.impl.nio.ClientH2IOEventHandler.inputReady(ClientH2IOEventHandler.java:39)
	at org.apache.hc.core5.reactor.InternalDataChannel.onIOEvent(InternalDataChannel.java:124)
	at org.apache.hc.core5.reactor.InternalChannel.handleIOEvent(InternalChannel.java:51)
	at org.apache.hc.core5.reactor.SingleCoreIOReactor.processEvents(SingleCoreIOReactor.java:178)
	at org.apache.hc.core5.reactor.SingleCoreIOReactor.doExecute(SingleCoreIOReactor.java:127)
	at org.apache.hc.core5.reactor.AbstractSingleCoreIOReactor.execute(AbstractSingleCoreIOReactor.java:85)
	at org.apache.hc.core5.reactor.IOReactorWorker.run(IOReactorWorker.java:44)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17227233" author="jira-bot" created="Fri, 6 Nov 2020 08:40:01 +0000"  >&lt;p&gt;Commit e7043f5cdcf1d0ee7b6e8f5a3d96238dbd3c6039 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=e7043f5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=e7043f5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2126&quot; title=&quot;AsyncCachingExec throws NPE when response body is null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2126&quot;&gt;&lt;del&gt;HTTPCLIENT-2126&lt;/del&gt;&lt;/a&gt;: `InternalAbstractHttpAsyncClient` incorrectly handles response message with no enclosed entity&lt;/p&gt;</comment>
                            <comment id="17227235" author="jira-bot" created="Fri, 6 Nov 2020 08:40:50 +0000"  >&lt;p&gt;Commit f6333a5001450ec68b47bdb019e78b97a74f25f2 in httpcomponents-client&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=f6333a5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=f6333a5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2126&quot; title=&quot;AsyncCachingExec throws NPE when response body is null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2126&quot;&gt;&lt;del&gt;HTTPCLIENT-2126&lt;/del&gt;&lt;/a&gt;: `InternalAbstractHttpAsyncClient` incorrectly handles response messages with no enclosed entity&lt;/p&gt;</comment>
                            <comment id="17227237" author="jira-bot" created="Fri, 6 Nov 2020 08:42:19 +0000"  >&lt;p&gt;Commit d4216587406159653f30f908665d25cbd39e99d6 in httpcomponents-client&apos;s branch refs/heads/5.0.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=d421658&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-client.git;h=d421658&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCLIENT-2126&quot; title=&quot;AsyncCachingExec throws NPE when response body is null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCLIENT-2126&quot;&gt;&lt;del&gt;HTTPCLIENT-2126&lt;/del&gt;&lt;/a&gt;: `InternalAbstractHttpAsyncClient` incorrectly handles response messages with no enclosed entity&lt;/p&gt;</comment>
                            <comment id="17227241" author="olegk" created="Fri, 6 Nov 2020 08:46:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kojilin&quot; class=&quot;user-hover&quot; rel=&quot;kojilin&quot;&gt;kojilin&lt;/a&gt;&#160;I made `AbstractAsyncResponseConsumer` handle gracefully an inconsistent state caused by the caller signalling a response with no entity but subsequently calling methods to consume data.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-core/commit/5d413a44c3a067bd7af6088bfe7d9e3f362675a8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/commit/5d413a44c3a067bd7af6088bfe7d9e3f362675a8&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;However the real cause of this defect was actually&#160;`InternalAbstractHttpAsyncClient` incorrect handling of response messages with no enclosed entity.&#160;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-client/commit/f6333a5001450ec68b47bdb019e78b97a74f25f2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-client/commit/f6333a5001450ec68b47bdb019e78b97a74f25f2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0k9q8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>