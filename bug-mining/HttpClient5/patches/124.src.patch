diff --git a/httpclient5/src/main/java/org/apache/hc/client5/http/impl/async/AsyncConnectExec.java b/httpclient5/src/main/java/org/apache/hc/client5/http/impl/async/AsyncConnectExec.java
index 33802920f..65fac2406 100644
--- a/httpclient5/src/main/java/org/apache/hc/client5/http/impl/async/AsyncConnectExec.java
+++ b/httpclient5/src/main/java/org/apache/hc/client5/http/impl/async/AsyncConnectExec.java
@@ -464,6 +464,7 @@ public void consumeResponse(final HttpResponse response,
                         state.tunnelRefused = true;
                         entityConsumerRef.set(asyncExecCallback.handleResponse(response, entityDetails));
                     } else if (status == HttpStatus.SC_OK) {
+                        clientContext.setProtocolVersion(null);
                         asyncExecCallback.completed();
                     } else {
                         throw new HttpException("Unexpected response to CONNECT request: " + new StatusLine(response));
@@ -552,7 +553,6 @@ private void proceedConnected(
         final HttpClientContext clientContext = scope.clientContext;
         final EndpointInfo endpointInfo = execRuntime.getEndpointInfo();
         if (endpointInfo != null) {
-            clientContext.setProtocolVersion(endpointInfo.getProtocol());
             clientContext.setSSLSession(endpointInfo.getSslSession());
         }
         try {
diff --git a/httpclient5/src/main/java/org/apache/hc/client5/http/impl/classic/ConnectExec.java b/httpclient5/src/main/java/org/apache/hc/client5/http/impl/classic/ConnectExec.java
index 482d6be15..c218797af 100644
--- a/httpclient5/src/main/java/org/apache/hc/client5/http/impl/classic/ConnectExec.java
+++ b/httpclient5/src/main/java/org/apache/hc/client5/http/impl/classic/ConnectExec.java
@@ -195,7 +195,6 @@ public ClassicHttpResponse execute(
             }
             final EndpointInfo endpointInfo = execRuntime.getEndpointInfo();
             if (endpointInfo != null) {
-                context.setProtocolVersion(endpointInfo.getProtocol());
                 context.setSSLSession(endpointInfo.getSslSession());
             }
             return chain.proceed(request, scope);
@@ -288,7 +287,9 @@ private ClassicHttpResponse createTunnelToTarget(
         }
 
         final int status = response.getCode();
-        if (status != HttpStatus.SC_OK) {
+        if (status == HttpStatus.SC_OK) {
+            context.setProtocolVersion(null);
+        } else {
             final HttpEntity entity = response.getEntity();
             if (entity != null) {
                 response.setEntity(new ByteArrayEntity(
