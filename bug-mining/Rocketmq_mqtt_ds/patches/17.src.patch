diff --git a/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/config/ServiceConfListener.java b/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/config/ServiceConfListener.java
index 35adca6..d8d83f6 100644
--- a/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/config/ServiceConfListener.java
+++ b/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/config/ServiceConfListener.java
@@ -44,6 +44,7 @@ public class ServiceConfListener {
     private File confFile;
     private ScheduledThreadPoolExecutor scheduler;
     private AtomicLong gmt = new AtomicLong();
+    private long refreshCheckInterval = 3;
 
     @PostConstruct
     public void start() {
@@ -65,7 +66,7 @@ public class ServiceConfListener {
             } catch (Exception e) {
                 logger.error("", e);
             }
-        }, 3, 3, TimeUnit.SECONDS);
+        }, refreshCheckInterval, refreshCheckInterval, TimeUnit.SECONDS);
     }
 
 }
diff --git a/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/meta/FirstTopicManager.java b/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/meta/FirstTopicManager.java
index 13f828b..79e7047 100644
--- a/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/meta/FirstTopicManager.java
+++ b/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/meta/FirstTopicManager.java
@@ -19,6 +19,7 @@ package org.apache.rocketmq.mqtt.ds.meta;
 
 import com.github.benmanes.caffeine.cache.Cache;
 import com.github.benmanes.caffeine.cache.Caffeine;
+import org.apache.commons.lang3.StringUtils;
 import org.apache.rocketmq.client.exception.MQClientException;
 import org.apache.rocketmq.common.MixAll;
 import org.apache.rocketmq.common.ThreadFactoryImpl;
@@ -64,8 +65,7 @@ public class FirstTopicManager {
     public void init() throws MQClientException {
         topicExistCache = Caffeine.newBuilder().maximumSize(1000).expireAfterWrite(1, TimeUnit.MINUTES).build();
         topicNotExistCache = Caffeine.newBuilder().maximumSize(1000).expireAfterWrite(1, TimeUnit.MINUTES).build();
-        defaultMQAdminExt = MqFactory.buildDefaultMQAdminExt("TopicCheck", serviceConf.getProperties());
-        defaultMQAdminExt.start();
+        initMQAdminExt();
 
         scheduler = new ScheduledThreadPoolExecutor(1, new ThreadFactoryImpl("refreshStoreBroker"));
         scheduler.scheduleWithFixedDelay(() -> {
@@ -82,6 +82,11 @@ public class FirstTopicManager {
         }, 0, 5, TimeUnit.SECONDS);
     }
 
+    public void initMQAdminExt() throws MQClientException {
+        defaultMQAdminExt = MqFactory.buildDefaultMQAdminExt("TopicCheck", serviceConf.getProperties());
+        defaultMQAdminExt.start();
+    }
+
     public void checkFirstTopicIfCreated(String firstTopic) {
         if (topicExistCache.getIfPresent(firstTopic) != null) {
             return;
@@ -108,6 +113,9 @@ public class FirstTopicManager {
     }
 
     private void updateTopicRoute(String firstTopic) {
+        if (StringUtils.isBlank(firstTopic)) {
+            return;
+        }
         try {
             TopicRouteData topicRouteData = defaultMQAdminExt.examineTopicRouteInfo(firstTopic);
             updateTopicRoute(firstTopic, topicRouteData);
diff --git a/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqAdmin.java b/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqAdmin.java
index 6db00be..7f71a9a 100644
--- a/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqAdmin.java
+++ b/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqAdmin.java
@@ -28,9 +28,13 @@ public class MqAdmin {
     private DefaultMQAdminExt defaultMQAdminExt;
 
     public MqAdmin(Properties properties) {
+        this(properties.getProperty("NAMESRV_ADDR"));
+    }
+
+    public MqAdmin(String nameSrv) {
         defaultMQAdminExt = new DefaultMQAdminExt();
         defaultMQAdminExt.setVipChannelEnabled(false);
-        defaultMQAdminExt.setNamesrvAddr(properties.getProperty("NAMESRV_ADDR"));
+        defaultMQAdminExt.setNamesrvAddr(nameSrv);
     }
 
     public DefaultMQAdminExt getDefaultMQAdminExt() {
diff --git a/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqConsumer.java b/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqConsumer.java
index c576479..deffb83 100644
--- a/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqConsumer.java
+++ b/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqConsumer.java
@@ -32,8 +32,12 @@ public class MqConsumer  {
     private DefaultMQPushConsumer defaultMQPushConsumer;
 
     public MqConsumer(Properties properties) {
+        this(properties, properties.getProperty("NAMESRV_ADDR"));
+    }
+
+    public MqConsumer(Properties properties, String nameSrv) {
         defaultMQPushConsumer = new DefaultMQPushConsumer();
-        defaultMQPushConsumer.setNamesrvAddr(properties.getProperty("NAMESRV_ADDR"));
+        defaultMQPushConsumer.setNamesrvAddr(nameSrv);
         defaultMQPushConsumer.setConsumeMessageBatchMaxSize(1);
         defaultMQPushConsumer.setPullBatchSize(Integer.parseInt(properties.getProperty("pullBatch", "64")));
         if (properties.get(THREAD_NUM_KEY) != null) {
diff --git a/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqFactory.java b/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqFactory.java
index 16de0ba..dcd47fa 100644
--- a/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqFactory.java
+++ b/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqFactory.java
@@ -21,10 +21,7 @@ package org.apache.rocketmq.mqtt.ds.mq;
 import org.apache.rocketmq.client.consumer.DefaultMQPullConsumer;
 import org.apache.rocketmq.client.consumer.DefaultMQPushConsumer;
 import org.apache.rocketmq.client.consumer.listener.MessageListener;
-import org.apache.rocketmq.client.consumer.listener.MessageListenerConcurrently;
-import org.apache.rocketmq.client.consumer.listener.MessageListenerOrderly;
 import org.apache.rocketmq.client.producer.DefaultMQProducer;
-import org.apache.rocketmq.common.UtilAll;
 import org.apache.rocketmq.tools.admin.DefaultMQAdminExt;
 
 import java.util.Properties;
@@ -58,55 +55,28 @@ public class MqFactory {
     }
 
     public static DefaultMQProducer buildDefaultMQProducer(String group, String nameSrv) {
-        DefaultMQProducer defaultMQProducer = new DefaultMQProducer();
-        defaultMQProducer.setNamesrvAddr(nameSrv);
-        defaultMQProducer.setInstanceName(buildInstanceName());
-        defaultMQProducer.setVipChannelEnabled(false);
-        defaultMQProducer.setProducerGroup(group);
-        return defaultMQProducer;
+        MqProducer mqProducer = new MqProducer(nameSrv);
+        mqProducer.setProducerGroup(group);
+        return mqProducer.getDefaultMQProducer();
     }
 
     public static DefaultMQPushConsumer buildDefaultMQPushConsumer(String group, String nameSrv,
                                                                    MessageListener messageListener, Properties properties) {
-        DefaultMQPushConsumer defaultMQPushConsumer = new DefaultMQPushConsumer();
-        defaultMQPushConsumer.setNamesrvAddr(nameSrv);
-        defaultMQPushConsumer.setConsumeMessageBatchMaxSize(1);
-        defaultMQPushConsumer.setPullBatchSize(Integer.parseInt(properties.getProperty("pullBatch", "64")));
-        if (properties.get(MqConsumer.THREAD_NUM_KEY) != null) {
-            defaultMQPushConsumer.setConsumeThreadMin(Integer.valueOf((String) properties.get("threadNum")));
-            defaultMQPushConsumer.setConsumeThreadMax(Integer.valueOf((String) properties.get("threadNum")));
-        }
-        defaultMQPushConsumer.setInstanceName(buildInstanceName());
-        defaultMQPushConsumer.setVipChannelEnabled(false);
-        defaultMQPushConsumer.setConsumerGroup(group);
-        if (messageListener instanceof MessageListenerOrderly) {
-            defaultMQPushConsumer.registerMessageListener((MessageListenerOrderly) messageListener);
-        } else {
-            defaultMQPushConsumer.registerMessageListener((MessageListenerConcurrently) messageListener);
-        }
-        return defaultMQPushConsumer;
+        MqConsumer mqConsumer = new MqConsumer(properties, nameSrv);
+        mqConsumer.setConsumerGroup(group);
+        mqConsumer.setMessageListener(messageListener);
+        return mqConsumer.getDefaultMQPushConsumer();
     }
 
     public static DefaultMQPullConsumer buildDefaultMQPullConsumer(String group, String nameSrv) {
-        DefaultMQPullConsumer defaultMQPullConsumer = new DefaultMQPullConsumer();
-        defaultMQPullConsumer.setNamesrvAddr(nameSrv);
-        defaultMQPullConsumer.setInstanceName(buildInstanceName());
-        defaultMQPullConsumer.setVipChannelEnabled(false);
-        defaultMQPullConsumer.setConsumerGroup(group);
-        return defaultMQPullConsumer;
+        MqPullConsumer mqConsumer = new MqPullConsumer(nameSrv);
+        mqConsumer.setConsumerGroup(group);
+        return mqConsumer.getDefaultMQPullConsumer();
     }
 
     public static DefaultMQAdminExt buildDefaultMQAdminExt(String group, String nameSrv) {
-        DefaultMQAdminExt defaultMQAdminExt = new DefaultMQAdminExt();
-        defaultMQAdminExt.setNamesrvAddr(nameSrv);
-        defaultMQAdminExt.setVipChannelEnabled(false);
-        defaultMQAdminExt.setAdminExtGroup(group);
-        return defaultMQAdminExt;
-    }
-
-    public static String buildInstanceName() {
-        return Integer.toString(UtilAll.getPid())
-                + "#" + System.nanoTime();
+        MqAdmin mqadmin = new MqAdmin(nameSrv);
+        mqadmin.setAdminGroup(group);
+        return mqadmin.getDefaultMQAdminExt();
     }
-
-}
+}
\ No newline at end of file
diff --git a/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqProducer.java b/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqProducer.java
index d4b479b..2f13987 100644
--- a/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqProducer.java
+++ b/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqProducer.java
@@ -27,11 +27,15 @@ import java.util.Properties;
 
 public class MqProducer   {
 
-    private final DefaultMQProducer defaultMQProducer;
+    private DefaultMQProducer defaultMQProducer;
 
     public MqProducer(Properties properties) {
+        this(properties.getProperty("NAMESRV_ADDR"));
+    }
+
+    public MqProducer(String nameSrv) {
         defaultMQProducer = new DefaultMQProducer();
-        defaultMQProducer.setNamesrvAddr(properties.getProperty("NAMESRV_ADDR"));
+        defaultMQProducer.setNamesrvAddr(nameSrv);
         defaultMQProducer.setInstanceName(buildInstanceName());
         defaultMQProducer.setVipChannelEnabled(false);
     }
diff --git a/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqPullConsumer.java b/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqPullConsumer.java
index f39b627..cc33d78 100644
--- a/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqPullConsumer.java
+++ b/mqtt-ds/src/main/java/org/apache/rocketmq/mqtt/ds/mq/MqPullConsumer.java
@@ -28,8 +28,12 @@ public class MqPullConsumer {
     private DefaultMQPullConsumer defaultMQPullConsumer;
 
     public MqPullConsumer(Properties properties) {
+        this(properties.getProperty("NAMESRV_ADDR"));
+    }
+
+    public MqPullConsumer(String nameSrv) {
         defaultMQPullConsumer = new DefaultMQPullConsumer();
-        defaultMQPullConsumer.setNamesrvAddr(properties.getProperty("NAMESRV_ADDR"));
+        defaultMQPullConsumer.setNamesrvAddr(nameSrv);
         defaultMQPullConsumer.setInstanceName(this.buildInstanceName());
         defaultMQPullConsumer.setVipChannelEnabled(false);
     }
diff --git a/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestAuthManagerSample.java b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/auth/TestAuthManagerSample.java
similarity index 98%
rename from mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestAuthManagerSample.java
rename to mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/auth/TestAuthManagerSample.java
index afda250..acb52c6 100644
--- a/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestAuthManagerSample.java
+++ b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/auth/TestAuthManagerSample.java
@@ -15,7 +15,7 @@
  * limitations under the License.
  */
 
-package org.apache.rocketmq.mqtt.ds.test;
+package org.apache.rocketmq.mqtt.ds.test.auth;
 
 import io.netty.handler.codec.mqtt.MqttConnectMessage;
 import io.netty.handler.codec.mqtt.MqttConnectPayload;
diff --git a/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/config/TestServiceConfListener.java b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/config/TestServiceConfListener.java
new file mode 100644
index 0000000..8ccc58a
--- /dev/null
+++ b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/config/TestServiceConfListener.java
@@ -0,0 +1,65 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.rocketmq.mqtt.ds.test.config;
+
+import org.apache.commons.lang3.reflect.FieldUtils;
+import org.apache.rocketmq.mqtt.ds.config.ServiceConf;
+import org.apache.rocketmq.mqtt.ds.config.ServiceConfListener;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.mockito.Mock;
+import org.mockito.junit.MockitoJUnitRunner;
+
+import java.io.File;
+
+import static org.mockito.Mockito.times;
+import static org.mockito.Mockito.verify;
+import static org.mockito.Mockito.when;
+
+@RunWith(MockitoJUnitRunner.class)
+public class TestServiceConfListener {
+
+    @Mock
+    private ServiceConf serviceConf;
+
+    @Mock
+    private File confFile;
+
+    private ServiceConfListener confListener;
+    private final long firstModifiedTime = 1000;
+    private final long secondModifiedTime = 2000;
+
+    @Test
+    public void test() throws Exception {
+        confListener = new ServiceConfListener();
+        FieldUtils.writeDeclaredField(confListener, "serviceConf", serviceConf, true);
+        FieldUtils.writeDeclaredField(confListener, "confFile", confFile, true);
+        FieldUtils.writeDeclaredField(confListener, "refreshCheckInterval", 1, true);
+
+        when(serviceConf.getConfFile()).thenReturn(confFile);
+        when(confFile.lastModified()).thenReturn(firstModifiedTime, secondModifiedTime);
+        when(confFile.getAbsoluteFile()).thenReturn(File.createTempFile("temp", ".properties"));
+
+        confListener.start();
+        Thread.sleep(1100);
+
+        verify(serviceConf).getConfFile();
+        verify(confFile, times(3)).lastModified();
+        verify(confFile).getAbsoluteFile();
+    }
+}
diff --git a/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestFirstTopicManager.java b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/meta/TestFirstTopicManager.java
similarity index 72%
rename from mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestFirstTopicManager.java
rename to mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/meta/TestFirstTopicManager.java
index e8a4d9f..d638e97 100644
--- a/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestFirstTopicManager.java
+++ b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/meta/TestFirstTopicManager.java
@@ -17,7 +17,7 @@
  *
  */
 
-package org.apache.rocketmq.mqtt.ds.test;
+package org.apache.rocketmq.mqtt.ds.test.meta;
 
 import com.github.benmanes.caffeine.cache.Cache;
 import com.github.benmanes.caffeine.cache.Caffeine;
@@ -35,6 +35,7 @@ import org.apache.rocketmq.mqtt.ds.meta.FirstTopicManager;
 import org.apache.rocketmq.remoting.exception.RemotingException;
 import org.apache.rocketmq.tools.admin.DefaultMQAdminExt;
 import org.junit.Assert;
+import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.mockito.Mock;
@@ -42,16 +43,22 @@ import org.mockito.junit.MockitoJUnitRunner;
 
 import java.lang.reflect.InvocationTargetException;
 import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.Collections;
 import java.util.HashMap;
+import java.util.HashSet;
 import java.util.List;
 import java.util.Map;
+import java.util.Properties;
 import java.util.Set;
 import java.util.concurrent.TimeUnit;
 
 import static org.mockito.ArgumentMatchers.any;
 import static org.mockito.ArgumentMatchers.anyString;
 import static org.mockito.ArgumentMatchers.eq;
+import static org.mockito.Mockito.doNothing;
 import static org.mockito.Mockito.mock;
+import static org.mockito.Mockito.spy;
 import static org.mockito.Mockito.verify;
 import static org.mockito.Mockito.when;
 
@@ -64,15 +71,41 @@ public class TestFirstTopicManager {
     @Mock
     private ServiceConf serviceConf;
 
+    @Mock
+    private DefaultMQAdminExt defaultMQAdminExt;
+
+    private FirstTopicManager firstTopicManager;
+
+    @Before
+    public void setUp() throws Exception {
+        firstTopicManager = new FirstTopicManager();
+        FieldUtils.writeDeclaredField(firstTopicManager, "defaultMQAdminExt", defaultMQAdminExt, true);
+        FieldUtils.writeDeclaredField(firstTopicManager, "serviceConf", serviceConf, true);
+        FieldUtils.writeDeclaredField(firstTopicManager, "metaPersistManager", metaPersistManager, true);
+    }
+
     @Test
-    public void test() throws IllegalAccessException, RemotingException, InterruptedException, MQClientException {
-        FirstTopicManager firstTopicManager = new FirstTopicManager();
-        DefaultMQAdminExt defaultMQAdminExt = mock(DefaultMQAdminExt.class);
+    public void testInit() throws MQClientException, RemotingException, InterruptedException {
+        String p2pClientTopic = "tm/p2p/test";
+        when(serviceConf.getClientRetryTopic()).thenReturn(null);
+        when(serviceConf.getClientP2pTopic()).thenReturn(p2pClientTopic);
+        when(metaPersistManager.getAllFirstTopics()).thenReturn(new HashSet<>());
+        when(defaultMQAdminExt.examineTopicRouteInfo(p2pClientTopic)).thenReturn(null);
+        FirstTopicManager spyFirstTopicManger = spy(firstTopicManager);
+        doNothing().when(spyFirstTopicManger).initMQAdminExt();
+
+        spyFirstTopicManger.init();
+        Thread.sleep(100);
+
+        Assert.assertTrue(spyFirstTopicManger.getBrokerAddressMap(p2pClientTopic).isEmpty());
+        Assert.assertTrue(spyFirstTopicManger.getReadableBrokers(p2pClientTopic).isEmpty());
+    }
 
+    @Test
+    public void test() throws IllegalAccessException, RemotingException, InterruptedException, MQClientException {
         Cache<String, TopicRouteData> topicExistCache = Caffeine.newBuilder().maximumSize(1000).expireAfterWrite(1, TimeUnit.MINUTES).build();
         Cache<String, Object> topicNotExistCache = Caffeine.newBuilder().maximumSize(1000).expireAfterWrite(1, TimeUnit.MINUTES).build();
 
-        FieldUtils.writeDeclaredField(firstTopicManager, "defaultMQAdminExt", defaultMQAdminExt, true);
         FieldUtils.writeDeclaredField(firstTopicManager, "topicExistCache", topicExistCache, true);
         FieldUtils.writeDeclaredField(firstTopicManager, "topicNotExistCache", topicNotExistCache, true);
 
@@ -96,16 +129,13 @@ public class TestFirstTopicManager {
         when(defaultMQAdminExt.examineTopicRouteInfo(any())).thenReturn(topicRouteData);
         firstTopicManager.checkFirstTopicIfCreated("test");
 
-        Assert.assertFalse(topicExistCache.getIfPresent("test") == null);
-        Assert.assertTrue("test".equals(firstTopicManager.getBrokerAddressMap("test").keySet().iterator().next()));
-        Assert.assertTrue("test".equals(firstTopicManager.getReadableBrokers("test").iterator().next()));
+        Assert.assertNotNull(topicExistCache.getIfPresent("test"));
+        Assert.assertEquals("test", firstTopicManager.getBrokerAddressMap("test").keySet().iterator().next());
+        Assert.assertEquals("test", firstTopicManager.getReadableBrokers("test").iterator().next());
     }
 
     @Test
     public void notExistTopicRoute() throws IllegalAccessException, RemotingException, InterruptedException, MQClientException, InvocationTargetException, NoSuchMethodException {
-        FirstTopicManager firstTopicManager = new FirstTopicManager();
-        DefaultMQAdminExt defaultMQAdminExt = mock(DefaultMQAdminExt.class);
-        FieldUtils.writeDeclaredField(firstTopicManager, "defaultMQAdminExt", defaultMQAdminExt, true);
         when(defaultMQAdminExt.examineTopicRouteInfo(anyString())).thenThrow(new MQClientException(ResponseCode.TOPIC_NOT_EXIST, ""));
         Map<String, Set<String>> readableBrokers = mock(HashMap.class);
         FieldUtils.writeDeclaredField(firstTopicManager, "readableBrokers", readableBrokers, true);
diff --git a/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestMetaPersistManagerSample.java b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/meta/TestMetaPersistManagerSample.java
similarity index 98%
rename from mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestMetaPersistManagerSample.java
rename to mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/meta/TestMetaPersistManagerSample.java
index 6057930..1c9eebf 100644
--- a/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestMetaPersistManagerSample.java
+++ b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/meta/TestMetaPersistManagerSample.java
@@ -15,7 +15,7 @@
  * limitations under the License.
  */
 
-package org.apache.rocketmq.mqtt.ds.test;
+package org.apache.rocketmq.mqtt.ds.test.meta;
 
 import org.apache.commons.lang3.reflect.FieldUtils;
 import org.apache.commons.lang3.reflect.MethodUtils;
diff --git a/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestWildcardManager.java b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/meta/TestWildcardManager.java
similarity index 98%
rename from mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestWildcardManager.java
rename to mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/meta/TestWildcardManager.java
index 7955c4b..c305e5b 100644
--- a/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestWildcardManager.java
+++ b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/meta/TestWildcardManager.java
@@ -17,7 +17,7 @@
  *
  */
 
-package org.apache.rocketmq.mqtt.ds.test;
+package org.apache.rocketmq.mqtt.ds.test.meta;
 
 import org.apache.commons.lang3.reflect.FieldUtils;
 import org.apache.rocketmq.mqtt.common.facade.MetaPersistManager;
diff --git a/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/mq/TestMqFactory.java b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/mq/TestMqFactory.java
new file mode 100644
index 0000000..1b732d2
--- /dev/null
+++ b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/mq/TestMqFactory.java
@@ -0,0 +1,84 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.rocketmq.mqtt.ds.test.mq;
+
+import org.apache.rocketmq.client.consumer.DefaultMQPullConsumer;
+import org.apache.rocketmq.client.consumer.DefaultMQPushConsumer;
+import org.apache.rocketmq.client.consumer.listener.ConsumeOrderlyContext;
+import org.apache.rocketmq.client.consumer.listener.ConsumeOrderlyStatus;
+import org.apache.rocketmq.client.consumer.listener.MessageListener;
+import org.apache.rocketmq.client.consumer.listener.MessageListenerOrderly;
+import org.apache.rocketmq.client.producer.DefaultMQProducer;
+import org.apache.rocketmq.common.message.MessageExt;
+import org.apache.rocketmq.mqtt.ds.mq.MqFactory;
+import org.apache.rocketmq.tools.admin.DefaultMQAdminExt;
+import org.junit.Assert;
+import org.junit.Before;
+import org.junit.Test;
+
+import java.util.List;
+import java.util.Properties;
+
+public class TestMqFactory {
+
+    final String nameSrv = "test";
+    final String NAMESRV_ADDR = "NAMESRV_ADDR";
+    final String group = "group";
+
+    private MessageListener messageListener;
+
+    @Before
+    public void SetUp() {
+        messageListener = new MessageListenerOrderly() {
+            @Override
+            public ConsumeOrderlyStatus consumeMessage(List<MessageExt> list, ConsumeOrderlyContext consumeOrderlyContext) {
+                return null;
+            }
+        };
+    }
+
+    @Test
+    public void test() {
+        Properties properties = new Properties();
+        properties.setProperty(NAMESRV_ADDR, nameSrv);
+
+        DefaultMQProducer mqProducer = MqFactory.buildDefaultMQProducer(group, properties);
+        Assert.assertEquals(nameSrv, mqProducer.getNamesrvAddr());
+
+        DefaultMQAdminExt mqAdminExt = MqFactory.buildDefaultMQAdminExt(group, properties);
+        Assert.assertEquals(group, mqAdminExt.getAdminExtGroup());
+
+        DefaultMQPushConsumer mqPushConsumer = MqFactory.buildDefaultMQPushConsumer(group, properties, messageListener);
+        Assert.assertEquals(group, mqPushConsumer.getConsumerGroup());
+
+        DefaultMQPullConsumer mqPullConsumer = MqFactory.buildDefaultMQPullConsumer(group, properties);
+        Assert.assertEquals(nameSrv, mqPullConsumer.getNamesrvAddr());
+
+        mqProducer = MqFactory.buildDefaultMQProducer(group, nameSrv);
+        Assert.assertEquals(nameSrv, mqProducer.getNamesrvAddr());
+
+        mqPushConsumer = MqFactory.buildDefaultMQPushConsumer(group, nameSrv, messageListener, properties);
+        Assert.assertEquals(group, mqPushConsumer.getConsumerGroup());
+
+        mqPullConsumer = MqFactory.buildDefaultMQPullConsumer(group, nameSrv);
+        Assert.assertEquals(nameSrv, mqPullConsumer.getNamesrvAddr());
+
+        mqAdminExt = MqFactory.buildDefaultMQAdminExt(group, nameSrv);
+        Assert.assertEquals(group, mqAdminExt.getAdminExtGroup());
+    }
+}
diff --git a/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestNotifyManager.java b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/notify/TestNotifyManager.java
similarity index 88%
rename from mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestNotifyManager.java
rename to mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/notify/TestNotifyManager.java
index 8254a08..0e2d28a 100644
--- a/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestNotifyManager.java
+++ b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/notify/TestNotifyManager.java
@@ -17,7 +17,7 @@
  *
  */
 
-package org.apache.rocketmq.mqtt.ds.test;
+package org.apache.rocketmq.mqtt.ds.test.notify;
 
 import org.apache.commons.lang3.reflect.FieldUtils;
 import org.apache.commons.lang3.reflect.MethodUtils;
@@ -25,7 +25,6 @@ import org.apache.rocketmq.client.consumer.DefaultMQPushConsumer;
 import org.apache.rocketmq.client.exception.MQBrokerException;
 import org.apache.rocketmq.client.exception.MQClientException;
 import org.apache.rocketmq.client.producer.DefaultMQProducer;
-import org.apache.rocketmq.client.utils.MessageUtil;
 import org.apache.rocketmq.common.MixAll;
 import org.apache.rocketmq.common.message.Message;
 import org.apache.rocketmq.common.message.MessageAccessor;
@@ -42,6 +41,7 @@ import org.apache.rocketmq.remoting.exception.RemotingException;
 import org.apache.rocketmq.remoting.netty.NettyRemotingClient;
 import org.apache.rocketmq.remoting.protocol.RemotingCommand;
 import org.junit.Assert;
+import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.mockito.Mock;
@@ -81,18 +81,26 @@ public class TestNotifyManager {
     @Mock
     private ServiceConf serviceConf;
 
-    @Test
-    public void test() throws InvocationTargetException, NoSuchMethodException, IllegalAccessException,
-            MQClientException, RemotingException, InterruptedException, MQBrokerException {
-        NotifyManager notifyManager = new NotifyManager();
+    @Mock
+    private DefaultMQProducer defaultMQProducer;
+
+    private NotifyManager notifyManager;
+
+    @Before
+    public void SetUp() throws IllegalAccessException {
+        notifyManager = new NotifyManager();
         FieldUtils.writeDeclaredField(notifyManager, "metaPersistManager", metaPersistManager, true);
         FieldUtils.writeDeclaredField(notifyManager, "firstTopicManager", firstTopicManager, true);
         FieldUtils.writeDeclaredField(notifyManager, "defaultMQPushConsumer", defaultMQPushConsumer, true);
         FieldUtils.writeDeclaredField(notifyManager, "remotingClient", remotingClient, true);
         FieldUtils.writeDeclaredField(notifyManager, "serviceConf", serviceConf, true);
+        FieldUtils.writeDeclaredField(notifyManager, "defaultMQProducer", defaultMQProducer, true);
+    }
 
+    @Test
+    public void test() throws InvocationTargetException, NoSuchMethodException, IllegalAccessException,
+            MQClientException, RemotingException, InterruptedException, MQBrokerException {
         when(metaPersistManager.getAllFirstTopics()).thenReturn(new HashSet<>(Arrays.asList("test")));
-
         MethodUtils.invokeMethod(notifyManager, true, "refresh");
         verify(defaultMQPushConsumer).subscribe(any(), anyString());
 
@@ -107,14 +115,13 @@ public class TestNotifyManager {
     @Test
     public void testJsonByte() throws NoSuchMethodException, IllegalAccessException, InvocationTargetException {
         Set<MessageEvent> messageEvents=new HashSet<>();
-        for (int i=0;i<10;i++) {
+        for (int i = 0; i < 10; i++) {
             MessageEvent messageEvent = new MessageEvent();
-            messageEvent.setBrokerName("testBroker"+i);
-            messageEvent.setPubTopic("testTopic"+i);
-            messageEvent.setNamespace("testSpace"+i);
+            messageEvent.setBrokerName("testBroker" + i);
+            messageEvent.setPubTopic("testTopic" + i);
+            messageEvent.setNamespace("testSpace" + i);
             messageEvents.add(messageEvent);
         }
-        NotifyManager notifyManager = new NotifyManager();
         RemotingCommand remotingCommand = (RemotingCommand) MethodUtils.invokeMethod(notifyManager,  true, "createMsgEventCommand", messageEvents);
         byte[] bytes = JSONObject.toJSONString(messageEvents).getBytes(StandardCharsets.UTF_8);
         Assert.assertArrayEquals(remotingCommand.getBody(), bytes);
@@ -122,7 +129,6 @@ public class TestNotifyManager {
 
     @Test
     public void testSetPubTopic() throws InvocationTargetException, NoSuchMethodException, IllegalAccessException {
-        NotifyManager notifyManager = new NotifyManager();
         MessageEvent event = new MessageEvent();
         MessageExt message = new MessageExt();
         message.putUserProperty(Constants.PROPERTY_ORIGIN_MQTT_TOPIC, "test");
@@ -136,18 +142,13 @@ public class TestNotifyManager {
 
     @Test
     public void sendEventRetryMsg() throws Exception {
-        NotifyManager notifyManager = new NotifyManager();
         when(serviceConf.getEventNotifyRetryMaxTime()).thenReturn(3);
-        FieldUtils.writeDeclaredField(notifyManager, "serviceConf", serviceConf, true);
-        DefaultMQProducer defaultMQProducer = mock(DefaultMQProducer.class);
-        FieldUtils.writeDeclaredField(notifyManager, "defaultMQProducer", defaultMQProducer, true);
         Set<MessageEvent> events = new HashSet<>(Arrays.asList(new MessageEvent()));
         MethodUtils.invokeMethod(notifyManager, true, "sendEventRetryMsg", events, 1, "test",
                 serviceConf.getEventNotifyRetryMaxTime() + 1);
         verify(defaultMQProducer,times(0)).send(any(Message.class));
-        defaultMQProducer = mock(DefaultMQProducer.class);
-        FieldUtils.writeDeclaredField(notifyManager, "defaultMQProducer", defaultMQProducer, true);
         MethodUtils.invokeMethod(notifyManager, true, "sendEventRetryMsg", events, 1, "test", 1);
         verify(defaultMQProducer).send(any(Message.class));
     }
+
 }
diff --git a/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/notify/TestNotifyRetryManager.java b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/notify/TestNotifyRetryManager.java
new file mode 100644
index 0000000..2d7c3b6
--- /dev/null
+++ b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/notify/TestNotifyRetryManager.java
@@ -0,0 +1,61 @@
+/*
+ *
+ *  * Licensed to the Apache Software Foundation (ASF) under one or more
+ *  * contributor license agreements.  See the NOTICE file distributed with
+ *  * this work for additional information regarding copyright ownership.
+ *  * The ASF licenses this file to You under the Apache License, Version 2.0
+ *  * (the "License"); you may not use this file except in compliance with
+ *  * the License.  You may obtain a copy of the License at
+ *  *
+ *  *     http://www.apache.org/licenses/LICENSE-2.0
+ *  *
+ *  * Unless required by applicable law or agreed to in writing, software
+ *  * distributed under the License is distributed on an "AS IS" BASIS,
+ *  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ *  * See the License for the specific language governing permissions and
+ *  * limitations under the License.
+ *
+ */
+
+package org.apache.rocketmq.mqtt.ds.test.notify;
+
+import com.alibaba.fastjson.JSON;
+import org.apache.commons.lang3.reflect.FieldUtils;
+import org.apache.commons.lang3.reflect.MethodUtils;
+import org.apache.rocketmq.common.message.MessageExt;
+import org.apache.rocketmq.mqtt.common.model.Constants;
+import org.apache.rocketmq.mqtt.common.model.MessageEvent;
+import org.apache.rocketmq.mqtt.ds.notify.NotifyManager;
+import org.apache.rocketmq.mqtt.ds.notify.NotifyRetryManager;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.mockito.Mock;
+import org.mockito.junit.MockitoJUnitRunner;
+
+import java.lang.reflect.InvocationTargetException;
+import java.nio.charset.StandardCharsets;
+import java.util.Collections;
+
+@RunWith(MockitoJUnitRunner.class)
+public class TestNotifyRetryManager {
+
+    @Mock
+    private NotifyManager notifyManager;
+
+    private NotifyRetryManager notifyRetryManager;
+
+    @Test
+    public void test() throws IllegalAccessException, InvocationTargetException, NoSuchMethodException {
+        notifyRetryManager = new NotifyRetryManager();
+        FieldUtils.writeDeclaredField(notifyRetryManager, "notifyManager", notifyManager, true);
+
+        MessageExt messageExt = new MessageExt();
+        messageExt.putUserProperty(Constants.PROPERTY_MQTT_MSG_EVENT_RETRY_NODE, "test");
+        messageExt.putUserProperty(Constants.PROPERTY_MQTT_MSG_EVENT_RETRY_TIME, "1");
+        MessageEvent messageEvent = new MessageEvent();
+        messageExt.setBody(JSON.toJSONString(Collections.singleton(messageEvent)).getBytes(StandardCharsets.UTF_8));
+
+        MethodUtils.invokeMethod(notifyRetryManager, true, "doRetryNotify", messageExt);
+    }
+
+}
diff --git a/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestOffsetStoreManager.java b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/store/TestLmqOffsetStoreManager.java
similarity index 97%
rename from mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestOffsetStoreManager.java
rename to mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/store/TestLmqOffsetStoreManager.java
index dd85e42..1150d53 100644
--- a/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/TestOffsetStoreManager.java
+++ b/mqtt-ds/src/test/java/org/apache/rocketmq/mqtt/ds/test/store/TestLmqOffsetStoreManager.java
@@ -15,7 +15,7 @@
  * limitations under the License.
  */
 
-package org.apache.rocketmq.mqtt.ds.test;
+package org.apache.rocketmq.mqtt.ds.test.store;
 
 import java.util.HashMap;
 import java.util.Map;
@@ -51,12 +51,8 @@ import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.verify;
 import static org.mockito.Mockito.when;
 
-/**
- * @author tianliuliu
- * @date 2022-03-14 11:50
- */
 @RunWith(MockitoJUnitRunner.class)
-public class TestOffsetStoreManager {
+public class TestLmqOffsetStoreManager {
     @Mock
     private FirstTopicManager firstTopicManager;
 
