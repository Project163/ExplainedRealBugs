diff --git a/junit-platform-surefire-provider/src/main/java/org/junit/platform/surefire/provider/RunListenerAdapter.java b/junit-platform-surefire-provider/src/main/java/org/junit/platform/surefire/provider/RunListenerAdapter.java
index 716b7abce..5a0127176 100644
--- a/junit-platform-surefire-provider/src/main/java/org/junit/platform/surefire/provider/RunListenerAdapter.java
+++ b/junit-platform-surefire-provider/src/main/java/org/junit/platform/surefire/provider/RunListenerAdapter.java
@@ -110,13 +110,18 @@ final class RunListenerAdapter implements TestExecutionListener {
 
 	private Optional<String> getClassName(TestIdentifier testIdentifier) {
 		TestSource testSource = testIdentifier.getSource().orElse(null);
-		if (testSource instanceof ClassSource) {
-			return Optional.of(((ClassSource) testSource).getJavaClass().getName());
-		}
-		if (testSource instanceof MethodSource) {
-			return Optional.of(((MethodSource) testSource).getClassName());
+
+		if (testSource != null) {
+			if (testSource instanceof ClassSource) {
+				return Optional.of(((ClassSource) testSource).getJavaClass().getName());
+			}
+			if (testSource instanceof MethodSource) {
+				return Optional.of(((MethodSource) testSource).getClassName());
+			}
 		}
-		return Optional.empty();
+
+		return testPlan.flatMap(plan -> plan.getParent(testIdentifier))
+			.flatMap(this::getClassName);
 	}
 
 	private Optional<String> getMethodName(TestIdentifier testIdentifier) {
diff --git a/junit-platform-surefire-provider/src/test/java/org/junit/platform/surefire/provider/RunListenerAdapterTests.java b/junit-platform-surefire-provider/src/test/java/org/junit/platform/surefire/provider/RunListenerAdapterTests.java
index ccab8a373..f308fe4f0 100644
--- a/junit-platform-surefire-provider/src/test/java/org/junit/platform/surefire/provider/RunListenerAdapterTests.java
+++ b/junit-platform-surefire-provider/src/test/java/org/junit/platform/surefire/provider/RunListenerAdapterTests.java
@@ -38,7 +38,9 @@ import org.junit.jupiter.engine.descriptor.ClassTestDescriptor;
 import org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor;
 import org.junit.platform.engine.TestDescriptor;
 import org.junit.platform.engine.TestExecutionResult;
+import org.junit.platform.engine.TestSource;
 import org.junit.platform.engine.UniqueId;
+import org.junit.platform.engine.support.descriptor.ClassSource;
 import org.junit.platform.engine.support.descriptor.EngineDescriptor;
 import org.junit.platform.launcher.TestIdentifier;
 import org.junit.platform.launcher.TestPlan;
@@ -179,7 +181,7 @@ class RunListenerAdapterTests {
 
 		// Use the test plan to set up child with parent.
 		final String parentDisplay = "I am your father";
-		TestIdentifier child = newSourcelessIdentifierWithParent(plan, parentDisplay);
+		TestIdentifier child = newSourcelessIdentifierWithParent(plan, parentDisplay, null);
 		adapter.executionStarted(child);
 
 		// Check that the adapter has informed Surefire that the test has been invoked,
@@ -189,6 +191,18 @@ class RunListenerAdapterTests {
 		assertEquals(parentDisplay, entryCaptor.getValue().getSourceName());
 	}
 
+	@Test
+	void stackTraceWriterPresentWhenParentHasSource() throws Exception {
+		TestPlan plan = TestPlan.from(Collections.singletonList(new EngineDescriptor(newId(), "Some Plan")));
+		adapter.testPlanExecutionStarted(plan);
+
+		TestIdentifier child = newSourcelessIdentifierWithParent(plan, "Parent", ClassSource.from(MyTestClass.class));
+		adapter.executionFinished(child, TestExecutionResult.failed(new RuntimeException()));
+		ArgumentCaptor<ReportEntry> entryCaptor = ArgumentCaptor.forClass(ReportEntry.class);
+		verify(listener).testError(entryCaptor.capture());
+		assertNotNull(entryCaptor.getValue().getStackTraceWriter());
+	}
+
 	@Test
 	void displayNamesIgnoredInReport() throws NoSuchMethodException {
 		TestMethodTestDescriptor descriptor = new TestMethodTestDescriptor(newId(), MyTestClass.class,
@@ -222,12 +236,13 @@ class RunListenerAdapterTests {
 		return new ClassTestDescriptor(UniqueId.forEngine("class"), MyTestClass.class);
 	}
 
-	private static TestIdentifier newSourcelessIdentifierWithParent(TestPlan testPlan, String parentDisplay) {
+	private static TestIdentifier newSourcelessIdentifierWithParent(TestPlan testPlan, String parentDisplay, TestSource testSource) {
 		// A parent test identifier with a name.
 		TestDescriptor parent = mock(TestDescriptor.class);
 		when(parent.getUniqueId()).thenReturn(newId());
 		when(parent.getDisplayName()).thenReturn(parentDisplay);
 		when(parent.getLegacyReportingName()).thenReturn(parentDisplay);
+		when(parent.getSource()).thenReturn(Optional.ofNullable(testSource));
 		when(parent.getType()).thenReturn(TestDescriptor.Type.CONTAINER);
 		TestIdentifier parentId = TestIdentifier.from(parent);
 
