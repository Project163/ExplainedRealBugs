{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/4630","repository_url":"https://api.github.com/repos/junit-team/junit-framework","labels_url":"https://api.github.com/repos/junit-team/junit-framework/issues/4630/labels{/name}","comments_url":"https://api.github.com/repos/junit-team/junit-framework/issues/4630/comments","events_url":"https://api.github.com/repos/junit-team/junit-framework/issues/4630/events","html_url":"https://github.com/junit-team/junit-framework/issues/4630","id":3124071419,"node_id":"I_kwDOAbwRH866NYv7","number":4630,"title":"Introduce `withPosition()` \"wither\" method in `FileSource`","user":{"login":"lslonina","id":12303865,"node_id":"MDQ6VXNlcjEyMzAzODY1","avatar_url":"https://avatars.githubusercontent.com/u/12303865?v=4","gravatar_id":"","url":"https://api.github.com/users/lslonina","html_url":"https://github.com/lslonina","followers_url":"https://api.github.com/users/lslonina/followers","following_url":"https://api.github.com/users/lslonina/following{/other_user}","gists_url":"https://api.github.com/users/lslonina/gists{/gist_id}","starred_url":"https://api.github.com/users/lslonina/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lslonina/subscriptions","organizations_url":"https://api.github.com/users/lslonina/orgs","repos_url":"https://api.github.com/users/lslonina/repos","events_url":"https://api.github.com/users/lslonina/events{/privacy}","received_events_url":"https://api.github.com/users/lslonina/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":165165180,"node_id":"MDU6TGFiZWwxNjUxNjUxODA=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/type:%20enhancement","name":"type: enhancement","color":"84b6eb","default":false,"description":null},{"id":420912036,"node_id":"MDU6TGFiZWw0MjA5MTIwMzY=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/component:%20Platform","name":"component: Platform","color":"11dd99","default":false,"description":null},{"id":425245644,"node_id":"MDU6TGFiZWw0MjUyNDU2NDQ=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/theme:%20discovery","name":"theme: discovery","color":"ffdd22","default":false,"description":null},{"id":9327429098,"node_id":"LA_kwDOAbwRH88AAAACK_VF6g","url":"https://api.github.com/repos/junit-team/junit-framework/labels/status:%20backported","name":"status: backported","color":"f97b87","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},{"login":"lslonina","id":12303865,"node_id":"MDQ6VXNlcjEyMzAzODY1","avatar_url":"https://avatars.githubusercontent.com/u/12303865?v=4","gravatar_id":"","url":"https://api.github.com/users/lslonina","html_url":"https://github.com/lslonina","followers_url":"https://api.github.com/users/lslonina/followers","following_url":"https://api.github.com/users/lslonina/following{/other_user}","gists_url":"https://api.github.com/users/lslonina/gists{/gist_id}","starred_url":"https://api.github.com/users/lslonina/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lslonina/subscriptions","organizations_url":"https://api.github.com/users/lslonina/orgs","repos_url":"https://api.github.com/users/lslonina/repos","events_url":"https://api.github.com/users/lslonina/events{/privacy}","received_events_url":"https://api.github.com/users/lslonina/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/junit-team/junit-framework/milestones/106","html_url":"https://github.com/junit-team/junit-framework/milestone/106","labels_url":"https://api.github.com/repos/junit-team/junit-framework/milestones/106/labels","id":13581224,"node_id":"MI_kwDOAbwRH84Azzuo","number":106,"title":"6.0.0-RC3","description":"","creator":{"login":"sbrannen","id":104798,"node_id":"MDQ6VXNlcjEwNDc5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104798?v=4","gravatar_id":"","url":"https://api.github.com/users/sbrannen","html_url":"https://github.com/sbrannen","followers_url":"https://api.github.com/users/sbrannen/followers","following_url":"https://api.github.com/users/sbrannen/following{/other_user}","gists_url":"https://api.github.com/users/sbrannen/gists{/gist_id}","starred_url":"https://api.github.com/users/sbrannen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sbrannen/subscriptions","organizations_url":"https://api.github.com/users/sbrannen/orgs","repos_url":"https://api.github.com/users/sbrannen/repos","events_url":"https://api.github.com/users/sbrannen/events{/privacy}","received_events_url":"https://api.github.com/users/sbrannen/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":22,"state":"closed","created_at":"2025-08-29T13:14:03Z","updated_at":"2025-09-14T12:09:31Z","due_on":"2025-09-14T07:00:00Z","closed_at":"2025-09-14T12:09:31Z"},"comments":7,"created_at":"2025-06-06T08:37:24Z","updated_at":"2025-09-22T13:48:41Z","closed_at":"2025-09-13T09:58:30Z","author_association":"CONTRIBUTOR","type":{"id":146631,"node_id":"IT_kwDOAA1WZs4AAjzH","name":"Feature","description":"A request, idea, or new functionality","color":"blue","created_at":"2024-01-25T09:15:40Z","updated_at":"2024-10-08T08:32:28Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## ü§î Problem Description\n\nI'm experiencing high overhead during test discovery in projects using [Cucumber-JVM](https://github.com/cucumber/cucumber-jvm) with the JUnit Platform Engine. Specifically, the issue stems from repeated calls to `File.getCanonicalFile()` inside `FileSource`.\n\nIn our setup:\n\n- 200+ feature files\n- 6000+ containers\n- 20,000+ test cases\n- Runtime: Windows 11 + FSlogix (actually that could be the main culprit for slow FS access)\n- Java: 21\n\nDiscovery takes 60‚Äì70 seconds, primarily spent in canonical path resolution via:\n\n[FeatureOrigin.java#L90](https://github.com/cucumber/cucumber-jvm/blob/731f399/cucumber-junit-platform-engine/src/main/java/io/cucumber/junit/platform/engine/FeatureOrigin.java#L90)\n\n[FileSource.java#L73](https://github.com/junit-team/junit5/blob/7d02a6a2521617ab8502f8614794b7bb0a568603/junit-platform-engine/src/main/java/org/junit/platform/engine/support/descriptor/FileSource.java#L73)\n\n## ‚ú® Proposed Solution\n\nI like to propose a minor enhancement to JUnit's `FileSource`:\n\nAdd a static factory method:\n\n```java\n\t/**\n\t * Create a new {@code FileSource} from an existing instance but with a different\n\t * {@link FilePosition}. This avoids redundant canonical path resolution.\n\t *\n\t * @param source the existing {@code FileSource}; must not be {@code null}\n\t * @param filePosition the new {@code FilePosition}; may be {@code null}\n\t * @return a new {@code FileSource} with same file and updated position\n\t */\n\tpublic static FileSource withPosition(FileSource source, @Nullable FilePosition filePosition) {\n\t\tPreconditions.notNull(source, \"source must not be null\");\n\t\treturn direct(source.file, filePosition); // new FileSource without canonicalPath call\n\t}\n```\n\nThis would reuse an already-canonical `File` from an existing `FileSource`, avoiding the repeated and expensive `getCanonicalFile()` call.\n\n## üõ†Ô∏è Workarounds We've Tried\n\n- We implemented a custom `CachingFileSource` variant to avoid repeated canonicalization. Since `FileSource` has private constructors, this required duplicating its entire implementation. With caching in place, discovery time dropped from \\~60s to \\~5s.\n- We also experimented with parallelizing feature parsing in Cucumber, which reduced overall time to \\~20s, but did not address the core overhead from canonical path resolution.\n\n## üîÑ Alternatives Considered\n\nWhile this could be implemented on the Cucumber side, it currently requires duplicating the entire `FileSource` logic, unless JUnit provides extension points or additional factory methods.\n\n[Cucumber-jvm Issue for the same](https://github.com/cucumber/cucumber-jvm/issues/3010)","closed_by":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/4630/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/junit-team/junit-framework/issues/4630/timeline","performed_via_github_app":null,"state_reason":"completed"}