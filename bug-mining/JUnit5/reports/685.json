{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/4299","repository_url":"https://api.github.com/repos/junit-team/junit-framework","labels_url":"https://api.github.com/repos/junit-team/junit-framework/issues/4299/labels{/name}","comments_url":"https://api.github.com/repos/junit-team/junit-framework/issues/4299/comments","events_url":"https://api.github.com/repos/junit-team/junit-framework/issues/4299/events","html_url":"https://github.com/junit-team/junit-framework/issues/4299","id":2836457356,"node_id":"I_kwDOAbwRH86pEOeM","number":4299,"title":"@TempDir cleanup does not handle Windows junctions correctly","user":{"login":"quintesse","id":778793,"node_id":"MDQ6VXNlcjc3ODc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/778793?v=4","gravatar_id":"","url":"https://api.github.com/users/quintesse","html_url":"https://github.com/quintesse","followers_url":"https://api.github.com/users/quintesse/followers","following_url":"https://api.github.com/users/quintesse/following{/other_user}","gists_url":"https://api.github.com/users/quintesse/gists{/gist_id}","starred_url":"https://api.github.com/users/quintesse/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/quintesse/subscriptions","organizations_url":"https://api.github.com/users/quintesse/orgs","repos_url":"https://api.github.com/users/quintesse/repos","events_url":"https://api.github.com/users/quintesse/events{/privacy}","received_events_url":"https://api.github.com/users/quintesse/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":165165178,"node_id":"MDU6TGFiZWwxNjUxNjUxNzg=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":null},{"id":289029959,"node_id":"MDU6TGFiZWwyODkwMjk5NTk=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/theme:%20extensions","name":"theme: extensions","color":"c7def8","default":false,"description":null},{"id":420911923,"node_id":"MDU6TGFiZWw0MjA5MTE5MjM=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/component:%20Jupiter","name":"component: Jupiter","color":"11ee99","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/junit-team/junit-framework/milestones/88","html_url":"https://github.com/junit-team/junit-framework/milestone/88","labels_url":"https://api.github.com/repos/junit-team/junit-framework/milestones/88/labels","id":12246239,"node_id":"MI_kwDOAbwRH84Autzf","number":88,"title":"5.12.0-RC1","description":"","creator":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":4,"state":"closed","created_at":"2025-01-31T14:21:23Z","updated_at":"2025-02-07T21:38:40Z","due_on":"2025-02-07T08:00:00Z","closed_at":"2025-02-07T14:48:23Z"},"comments":6,"created_at":"2025-02-06T19:59:03Z","updated_at":"2025-02-07T16:15:13Z","closed_at":"2025-02-07T14:24:13Z","author_association":"NONE","type":{"id":146627,"node_id":"IT_kwDOAA1WZs4AAjzD","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T09:15:40Z","updated_at":"2024-07-26T10:05:45Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Using junit 5.11.4\n\nIt's a very specific situation but the cleanup of a directory created with `@TempDir` will fail on Windows if it contains junctions that point to a directory that no longer exists. The following code reproduces the issue:\n\n```java\n@Test\nvoid testTempDirWithJunction(@TempDir Path dir) throws IOException, InterruptedException {\n    Path test = dir.resolve(\"test\");\n    Files.createDirectory(test);\n    Path link = dir.resolve(\"link\");\n    // This creates a Windows \"junction\" which you can't do with Java code\n    Runtime.getRuntime().exec(String.format(\"cmd.exe /c mklink /j %s %s\", link.toString(), test.toString())).waitFor();\n    // The error might also occur without the source folder being deleted\n    // but it depends on the order that the TempDir cleanup does its work,\n    // so the following line forces the error to occur always\n    Files.delete(test);\n}\n```\n\nWhy are junctions used instead of plain symbolic (or hard) links? Well on Windows you need special privileges to create links which not everybody has, while junctions are allowed by default. (Btw, junctions can _only_ be used for directories, _not_ files!)\n\n Perhaps the easiest way to solve this would be to add an `ignoreCleanupErrors` options to `@TempDir`, which would continue trying to delete files and not throw any errors, because not being able to fully delete a temp folder might not be seen as a test failure in many cases. (But of course junit should also be able to handle this situation properly and delete broken junctions).","closed_by":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/4299/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/junit-team/junit-framework/issues/4299/timeline","performed_via_github_app":null,"state_reason":"completed"}