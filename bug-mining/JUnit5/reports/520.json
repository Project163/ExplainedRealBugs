{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/2545","repository_url":"https://api.github.com/repos/junit-team/junit-framework","labels_url":"https://api.github.com/repos/junit-team/junit-framework/issues/2545/labels{/name}","comments_url":"https://api.github.com/repos/junit-team/junit-framework/issues/2545/comments","events_url":"https://api.github.com/repos/junit-team/junit-framework/issues/2545/events","html_url":"https://github.com/junit-team/junit-framework/issues/2545","id":802230895,"node_id":"MDU6SXNzdWU4MDIyMzA4OTU=","number":2545,"title":"Provide more options to configure ForkJoinPoolHierarchicalTestExecutorService's ForkJoinPool","user":{"login":"tmirzoev","id":37933622,"node_id":"MDQ6VXNlcjM3OTMzNjIy","avatar_url":"https://avatars.githubusercontent.com/u/37933622?v=4","gravatar_id":"","url":"https://api.github.com/users/tmirzoev","html_url":"https://github.com/tmirzoev","followers_url":"https://api.github.com/users/tmirzoev/followers","following_url":"https://api.github.com/users/tmirzoev/following{/other_user}","gists_url":"https://api.github.com/users/tmirzoev/gists{/gist_id}","starred_url":"https://api.github.com/users/tmirzoev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tmirzoev/subscriptions","organizations_url":"https://api.github.com/users/tmirzoev/orgs","repos_url":"https://api.github.com/users/tmirzoev/repos","events_url":"https://api.github.com/users/tmirzoev/events{/privacy}","received_events_url":"https://api.github.com/users/tmirzoev/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":318079877,"node_id":"MDU6TGFiZWwzMTgwNzk4Nzc=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/theme:%20concurrency","name":"theme: concurrency","color":"eeccff","default":false,"description":null},{"id":420912036,"node_id":"MDU6TGFiZWw0MjA5MTIwMzY=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/component:%20Platform","name":"component: Platform","color":"11dd99","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/junit-team/junit-framework/milestones/66","html_url":"https://github.com/junit-team/junit-framework/milestone/66","labels_url":"https://api.github.com/repos/junit-team/junit-framework/milestones/66/labels","id":8591660,"node_id":"MI_kwDOAbwRH84Agxks","number":66,"title":"5.9.2","description":"","creator":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":12,"state":"closed","created_at":"2022-10-28T10:22:13Z","updated_at":"2023-01-10T11:13:11Z","due_on":"2023-01-10T08:00:00Z","closed_at":"2023-01-10T11:13:11Z"},"comments":9,"created_at":"2021-02-05T14:55:55Z","updated_at":"2023-01-06T15:13:23Z","closed_at":"2023-01-06T15:13:23Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I've recently encountered a problem similar to https://github.com/junit-team/junit5/issues/1675 , but a bit worse: provided that all tests use Future.get() at some point and there's enough of them, a user can run into situation where tests start failing with  RejectedExecutionException thrown by ForkJoinPool's tryCompensate() method.\r\n\r\nThis can be avoided by tuning the parameters of ForkJoinPool used in JUnit's ForkJoinPoolHierarchicalTestExecutorService - there are several ways,and I'm using custom ForkJoinWorkerThreadFactory implementation that keeps track of running workers.\r\n\r\nThe problem is, ForkJoinPoolHierarchicalTestExecutorService and other classes are not very open for such modifications. \r\nI have no way to inject custon thread factory via config. I can not inject already created FJP at construction time, or override a constructor, due to how FJP creation is made in private method called in a constructor.\r\nThis goes even further: ForkJoinPoolHierarchicalTestExecutorService parses the configuration with DefaultParallelExecutionConfigurationStrategy.getStrategy() method which is package-private, and JupiterTestEngine has its own share of private methods and is final, so no overriding there.\r\n\r\nThis results in a situation, where in order to change one argument sent to FJP's constructor, I have to either:\r\na) provide my own implementations of HierarchicalTestExecutorService, TestEngine and some other classes, which is a bit ridiculous because of how I want to change literally one parameter.\r\nb) copy JUnit's default implementations to my code and change that argument there, which is also not so good due to excessive code and the need to license the copied code under EPL-2.0\r\nc) use Reflection API to modify ForkJoinPoolHierarchicalTestExecutorService at runtime, replacing its FJP, or changing FJP's i\r\ninternal variables. This is the most effective solution, but it is rather brittle due to all that reflection stuff.\r\n\r\nThe point is, is there any possibility for JUnit to provide more options to configure ForkJoinPoolHierarchicalTestExecutorService and its pool, or, at least, to make the API more open to subclassing and modification? I totally understand that these APIs can and will be unstable and experimental, but it could potentially improve using JUnit with any tests that rely on code using Future - like Java's new HTTP API that runs all http requests this way.\r\n","closed_by":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/2545/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/junit-team/junit-framework/issues/2545/timeline","performed_via_github_app":null,"state_reason":"completed"}