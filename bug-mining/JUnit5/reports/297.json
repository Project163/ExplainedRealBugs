{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/1904","repository_url":"https://api.github.com/repos/junit-team/junit-framework","labels_url":"https://api.github.com/repos/junit-team/junit-framework/issues/1904/labels{/name}","comments_url":"https://api.github.com/repos/junit-team/junit-framework/issues/1904/comments","events_url":"https://api.github.com/repos/junit-team/junit-framework/issues/1904/events","html_url":"https://github.com/junit-team/junit-framework/issues/1904","id":449521156,"node_id":"MDU6SXNzdWU0NDk1MjExNTY=","number":1904,"title":"Prefer public methods when creating Vintage MethodSource","user":{"login":"obelix74","id":458859,"node_id":"MDQ6VXNlcjQ1ODg1OQ==","avatar_url":"https://avatars.githubusercontent.com/u/458859?v=4","gravatar_id":"","url":"https://api.github.com/users/obelix74","html_url":"https://github.com/obelix74","followers_url":"https://api.github.com/users/obelix74/followers","following_url":"https://api.github.com/users/obelix74/following{/other_user}","gists_url":"https://api.github.com/users/obelix74/gists{/gist_id}","starred_url":"https://api.github.com/users/obelix74/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/obelix74/subscriptions","organizations_url":"https://api.github.com/users/obelix74/orgs","repos_url":"https://api.github.com/users/obelix74/repos","events_url":"https://api.github.com/users/obelix74/events{/privacy}","received_events_url":"https://api.github.com/users/obelix74/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":165165180,"node_id":"MDU6TGFiZWwxNjUxNjUxODA=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/type:%20enhancement","name":"type: enhancement","color":"84b6eb","default":false,"description":null},{"id":293488747,"node_id":"MDU6TGFiZWwyOTM0ODg3NDc=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/theme:%20execution","name":"theme: execution","color":"fbca04","default":false,"description":null},{"id":310903254,"node_id":"MDU6TGFiZWwzMTA5MDMyNTQ=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/theme:%20reporting","name":"theme: reporting","color":"bfdadc","default":false,"description":null},{"id":420912143,"node_id":"MDU6TGFiZWw0MjA5MTIxNDM=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/component:%20Vintage","name":"component: Vintage","color":"11cc99","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/junit-team/junit-framework/milestones/37","html_url":"https://github.com/junit-team/junit-framework/milestone/37","labels_url":"https://api.github.com/repos/junit-team/junit-framework/milestones/37/labels","id":4122139,"node_id":"MDk6TWlsZXN0b25lNDEyMjEzOQ==","number":37,"title":"5.5 RC1","description":"","creator":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":54,"state":"closed","created_at":"2019-03-08T11:31:58Z","updated_at":"2019-06-06T20:59:08Z","due_on":"2019-06-06T07:00:00Z","closed_at":"2019-06-06T20:59:08Z"},"comments":5,"created_at":"2019-05-28T23:28:51Z","updated_at":"2019-06-05T18:24:50Z","closed_at":"2019-06-05T18:24:41Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I am working on porting a legacy application to JUnit5.  The test framework implements a `TestExecutionListener` which is listening for `executionStarted` and `executionFinished` methods and from the `TestIdentifier`, extract the `TestSource` and find out if it is a `ClassSource` or a `MethodSource` and do some operations based on that (the tests are cached and a TESTSUITES.xml file built at the end).\r\n\r\nWhat I notice is with a legacy JUnit4 test, if there is a test, say\r\n\r\n```java\r\n@Test \r\npublic void foo() {\r\n\r\n}\r\n```\r\n\r\nand the test also has a private overriden method with the same name:\r\n\r\n```java\r\nprivate void foo(final boolean arg) {\r\n}\r\n```\r\n\r\nthen in the `executionStarted` and `executionFinished` callbacks, the `TestSource` contained in the `TestIdentifier` are for a `ClassSource` and not a `MethodSource`.  I lose all information on that _specific_ method being tested.\r\n\r\nAttached a reproducible unit test and the build.gradle file.\r\n\r\n```java\r\nimport java.io.PrintWriter;\r\nimport java.util.HashSet;\r\nimport java.util.Set;\r\n\r\nimport org.junit.jupiter.api.Assertions;\r\nimport org.junit.jupiter.api.Test;\r\nimport org.junit.platform.engine.TestExecutionResult;\r\nimport org.junit.platform.engine.TestSource;\r\nimport org.junit.platform.engine.discovery.DiscoverySelectors;\r\nimport org.junit.platform.engine.support.descriptor.MethodSource;\r\nimport org.junit.platform.launcher.Launcher;\r\nimport org.junit.platform.launcher.LauncherDiscoveryRequest;\r\nimport org.junit.platform.launcher.TestExecutionListener;\r\nimport org.junit.platform.launcher.TestIdentifier;\r\nimport org.junit.platform.launcher.core.LauncherDiscoveryRequestBuilder;\r\nimport org.junit.platform.launcher.core.LauncherFactory;\r\nimport org.junit.platform.launcher.listeners.SummaryGeneratingListener;\r\nimport org.junit.platform.launcher.listeners.TestExecutionSummary;\r\n\r\npublic class TestLauncher {\r\n\r\n    @Test\r\n    public void testLauncher() {\r\n\r\n        final Launcher launcher = LauncherFactory.create();\r\n        final LauncherDiscoveryRequest request = LauncherDiscoveryRequestBuilder.request()\r\n                .selectors(DiscoverySelectors.selectClass(SimpleLegacyTest.class)).build();\r\n        final SummaryGeneratingListener listener = new SummaryGeneratingListener();\r\n        final SimpleListener simpleListener = new SimpleListener();\r\n        launcher.registerTestExecutionListeners(listener, simpleListener);\r\n        launcher.execute(request);\r\n        final TestExecutionSummary summary = listener.getSummary();\r\n        summary.printTo(new PrintWriter(System.out));\r\n        Assertions.assertEquals(summary.getTestsFoundCount(), simpleListener.methods.size());\r\n    }\r\n\r\n    private static class SimpleListener\r\n            implements TestExecutionListener {\r\n\r\n        private final Set<String> methods = new HashSet<>();\r\n\r\n        @Override\r\n        public void executionFinished(final TestIdentifier testIdentifier,\r\n                                      final TestExecutionResult testExecutionResult) {\r\n            final String message = String.format(\"Execution Finished: %s - %s - %s\",\r\n                    testIdentifier.getDisplayName(), testIdentifier.getUniqueId(), testExecutionResult);\r\n            System.out.println(message);\r\n            if (testIdentifier.getSource().isPresent()) {\r\n                final TestSource testSource = testIdentifier.getSource().get();\r\n                if (testSource instanceof MethodSource) {\r\n                    this.methods.add(((MethodSource) testSource).getMethodName());\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public static class SimpleLegacyTest {\r\n        @org.junit.Test\r\n        public void testFoo() {\r\n\r\n        }\r\n\r\n        @org.junit.Test\r\n        public void testBar() {\r\n\r\n        }\r\n\r\n        @org.junit.Test\r\n        public void foobar() {\r\n\r\n        }\r\n\r\n        private void testFoo(final boolean flag) {\r\n\r\n        }\r\n\r\n        private void testBar(final boolean flag) {\r\n\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n```groovy\r\nplugins {\r\n    id 'java'\r\n}\r\n\r\ngroup 'test'\r\nversion '1.0-SNAPSHOT'\r\n\r\nsourceCompatibility = 1.8\r\n\r\nrepositories {\r\n    mavenCentral()\r\n}\r\n\r\ndependencies {\r\n    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.4.2'\r\n    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.4.2'\r\n    compile(\"org.junit.platform:junit-platform-launcher:1.4.2\")\r\n    testCompile(\"org.junit.vintage:junit-vintage-engine:5.4.2\")\r\n}\r\n\r\ntest {\r\n    useJUnitPlatform {\r\n        excludeTags 'slow'\r\n        includeEngines 'junit-jupiter', 'junit-vintage'\r\n    }\r\n}\r\n```\r\n\r\nNotice that the `SummaryGeneratingListener` contains the correct number of tests executed (3), but the methods tested only has one (the only method without a non conflicting name).\r\n\r\nAlso note that, if there are no legacy tests, then this does not fail.","closed_by":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/1904/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/junit-team/junit-framework/issues/1904/timeline","performed_via_github_app":null,"state_reason":"completed"}