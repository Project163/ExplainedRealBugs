{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/3261","repository_url":"https://api.github.com/repos/junit-team/junit-framework","labels_url":"https://api.github.com/repos/junit-team/junit-framework/issues/3261/labels{/name}","comments_url":"https://api.github.com/repos/junit-team/junit-framework/issues/3261/comments","events_url":"https://api.github.com/repos/junit-team/junit-framework/issues/3261/events","html_url":"https://github.com/junit-team/junit-framework/issues/3261","id":1675068505,"node_id":"I_kwDOAbwRH85j14RZ","number":3261,"title":"Simplify implementation of self-contained dynamic tests","user":{"login":"odrotbohm","id":128577,"node_id":"MDQ6VXNlcjEyODU3Nw==","avatar_url":"https://avatars.githubusercontent.com/u/128577?v=4","gravatar_id":"","url":"https://api.github.com/users/odrotbohm","html_url":"https://github.com/odrotbohm","followers_url":"https://api.github.com/users/odrotbohm/followers","following_url":"https://api.github.com/users/odrotbohm/following{/other_user}","gists_url":"https://api.github.com/users/odrotbohm/gists{/gist_id}","starred_url":"https://api.github.com/users/odrotbohm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/odrotbohm/subscriptions","organizations_url":"https://api.github.com/users/odrotbohm/orgs","repos_url":"https://api.github.com/users/odrotbohm/repos","events_url":"https://api.github.com/users/odrotbohm/events{/privacy}","received_events_url":"https://api.github.com/users/odrotbohm/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":165165180,"node_id":"MDU6TGFiZWwxNjUxNjUxODA=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/type:%20enhancement","name":"type: enhancement","color":"84b6eb","default":false,"description":null},{"id":165165181,"node_id":"MDU6TGFiZWwxNjUxNjUxODE=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/up-for-grabs","name":"up-for-grabs","color":"159818","default":false,"description":null},{"id":293473932,"node_id":"MDU6TGFiZWwyOTM0NzM5MzI=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/theme:%20programming%20model","name":"theme: programming model","color":"c7def8","default":false,"description":null},{"id":420911923,"node_id":"MDU6TGFiZWw0MjA5MTE5MjM=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/component:%20Jupiter","name":"component: Jupiter","color":"11ee99","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/junit-team/junit-framework/milestones/77","html_url":"https://github.com/junit-team/junit-framework/milestone/77","labels_url":"https://api.github.com/repos/junit-team/junit-framework/milestones/77/labels","id":11066905,"node_id":"MI_kwDOAbwRH84AqN4Z","number":77,"title":"5.11 RC1","description":"","creator":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":21,"state":"closed","created_at":"2024-05-17T07:55:56Z","updated_at":"2024-07-31T11:14:35Z","due_on":"2024-07-31T07:00:00Z","closed_at":"2024-07-31T11:14:35Z"},"comments":13,"created_at":"2023-04-19T14:47:30Z","updated_at":"2024-08-19T12:13:12Z","closed_at":"2024-07-18T06:35:11Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"`@TestFactory`s and `DynamicTests` provide API to implement multiple test probes that will become individual tests. They're centered around the idea that one would create test fixtures as instances of types and provide API to then define the naming of the test and the actual assertion:\r\n\r\n```java\r\nclass MyTests\r\n\r\n  @TestFactory\r\n  Stream<DynamicTest> foo() {\r\n\r\n    var fixture = Stream.of(new Foo(1, 1, 2), new Foo(2, 3, 5));\r\n\r\n    return DynamicTest.stream(fixture, it -> assertThat(it.left() + it.right()).isEqualTo(it.result()));\r\n  }\r\n\r\n  record Foo(int left, int right, int result) implements Named<Foo> {\r\n\r\n    @Override\r\n    public String getName() {\r\n      return left + \" + \" + right + \" = \" + result;\r\n    }\r\n\r\n    @Override\r\n    public Foo getPayload() {\r\n      return this;\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nThere are a few things to note here:\r\n\r\n- We need to implement `getPayload()` to return the instance itself to satisfy `Named` although that method doesn't play into the signature of `DynamicTest.stream(â€¦)` as the elements of the stream are handed into the callable.\r\n- It would be nice if we were able to colocate the assertion callback with the fixture type so that the implementation of the test factory would only have to return a stream of fixtures.\r\n\r\nAssuming an extension of `Named` looking like this existed:\r\n\r\n```java\r\ninterface NamedExecutable<T extends NamedExecutable<T>> extends Named<T>, Executable {\r\n\r\n  @Override\r\n  public default T getPayload() {\r\n    return (T) this;\r\n  }\r\n}\r\n```\r\n\r\na bit of syntactical sugar on `DynamicTest`:\r\n\r\n```java\r\n@SafeVarargs\r\npublic static <T extends NamedExecutable<T>> Stream<DynamicTest> stream(\r\n    NamedExecutable<T>... inputGenerator) {\r\n  return stream(Arrays.stream(inputGenerator));\r\n}\r\n\r\npublic static <T extends NamedExecutable<T>> Stream<DynamicTest> stream(\r\n    Stream<? extends NamedExecutable<T>> inputGenerator) {\r\n  Preconditions.notNull(inputGenerator, \"inputGenerator must not be null\");\r\n\r\n  return DynamicTest.stream(inputGenerator, it -> it.execute());\r\n}\r\n```\r\n\r\nWould allow us to reduce the very first code sample to:\r\n\r\n```java\r\npublic class DummyTest {\r\n\r\n  @TestFactory\r\n  Stream<DynamicTest> foo() {\r\n    return DynamicTest.stream(new AdderTest(1, 1, 2), new AdderTest(2, 3, 5));\r\n  }\r\n\r\n  record AdderTest(int left, int right, int result) implements NamedExecutable<AdderTest> {\r\n\r\n    @Override\r\n    public String getName() {\r\n      return left + \" + \" + right + \" = \" + result;\r\n    }\r\n\r\n    @Override\r\n    public void execute() throws Throwable {\r\n      assertThat(left + right).isEqualTo(result);\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nThis allows to define parameterize test fixtures nicely and colocate the assertions within a type and the test factory method's responsibility is reduced to set up the individual probes.","closed_by":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/3261/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":2,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/junit-team/junit-framework/issues/3261/timeline","performed_via_github_app":null,"state_reason":"completed"}