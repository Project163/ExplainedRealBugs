{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/3130","repository_url":"https://api.github.com/repos/junit-team/junit-framework","labels_url":"https://api.github.com/repos/junit-team/junit-framework/issues/3130/labels{/name}","comments_url":"https://api.github.com/repos/junit-team/junit-framework/issues/3130/comments","events_url":"https://api.github.com/repos/junit-team/junit-framework/issues/3130/events","html_url":"https://github.com/junit-team/junit-framework/issues/3130","id":1551851613,"node_id":"I_kwDOAbwRH85cf2Bd","number":3130,"title":"Parameters are not validated in local `@MethodSource` factory method","user":{"login":"sbrannen","id":104798,"node_id":"MDQ6VXNlcjEwNDc5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104798?v=4","gravatar_id":"","url":"https://api.github.com/users/sbrannen","html_url":"https://github.com/sbrannen","followers_url":"https://api.github.com/users/sbrannen/followers","following_url":"https://api.github.com/users/sbrannen/following{/other_user}","gists_url":"https://api.github.com/users/sbrannen/gists{/gist_id}","starred_url":"https://api.github.com/users/sbrannen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sbrannen/subscriptions","organizations_url":"https://api.github.com/users/sbrannen/orgs","repos_url":"https://api.github.com/users/sbrannen/repos","events_url":"https://api.github.com/users/sbrannen/events{/privacy}","received_events_url":"https://api.github.com/users/sbrannen/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":165165178,"node_id":"MDU6TGFiZWwxNjUxNjUxNzg=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":null},{"id":420911923,"node_id":"MDU6TGFiZWw0MjA5MTE5MjM=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/component:%20Jupiter","name":"component: Jupiter","color":"11ee99","default":false,"description":null},{"id":747276013,"node_id":"MDU6TGFiZWw3NDcyNzYwMTM=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/theme:%20parameterized%20tests","name":"theme: parameterized tests","color":"9e9dea","default":false,"description":null},{"id":1013654175,"node_id":"MDU6TGFiZWwxMDEzNjU0MTc1","url":"https://api.github.com/repos/junit-team/junit-framework/labels/theme:%20diagnostics","name":"theme: diagnostics","color":"5098bf","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"sbrannen","id":104798,"node_id":"MDQ6VXNlcjEwNDc5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104798?v=4","gravatar_id":"","url":"https://api.github.com/users/sbrannen","html_url":"https://github.com/sbrannen","followers_url":"https://api.github.com/users/sbrannen/followers","following_url":"https://api.github.com/users/sbrannen/following{/other_user}","gists_url":"https://api.github.com/users/sbrannen/gists{/gist_id}","starred_url":"https://api.github.com/users/sbrannen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sbrannen/subscriptions","organizations_url":"https://api.github.com/users/sbrannen/orgs","repos_url":"https://api.github.com/users/sbrannen/repos","events_url":"https://api.github.com/users/sbrannen/events{/privacy}","received_events_url":"https://api.github.com/users/sbrannen/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"sbrannen","id":104798,"node_id":"MDQ6VXNlcjEwNDc5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104798?v=4","gravatar_id":"","url":"https://api.github.com/users/sbrannen","html_url":"https://github.com/sbrannen","followers_url":"https://api.github.com/users/sbrannen/followers","following_url":"https://api.github.com/users/sbrannen/following{/other_user}","gists_url":"https://api.github.com/users/sbrannen/gists{/gist_id}","starred_url":"https://api.github.com/users/sbrannen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sbrannen/subscriptions","organizations_url":"https://api.github.com/users/sbrannen/orgs","repos_url":"https://api.github.com/users/sbrannen/repos","events_url":"https://api.github.com/users/sbrannen/events{/privacy}","received_events_url":"https://api.github.com/users/sbrannen/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/junit-team/junit-framework/milestones/67","html_url":"https://github.com/junit-team/junit-framework/milestone/67","labels_url":"https://api.github.com/repos/junit-team/junit-framework/milestones/67/labels","id":9278798,"node_id":"MI_kwDOAbwRH84AjZVO","number":67,"title":"5.9.3","description":"","creator":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":6,"state":"closed","created_at":"2023-04-13T10:44:24Z","updated_at":"2023-04-26T06:57:26Z","due_on":"2023-04-26T07:00:00Z","closed_at":"2023-04-26T06:57:26Z"},"comments":3,"created_at":"2023-01-21T16:49:42Z","updated_at":"2023-04-22T20:03:50Z","closed_at":"2023-04-22T20:03:49Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Overview\r\n\r\nThe current implementation of support for local factory method names that accept arguments in `@MethodSource` does not validate the specified parameters. Rather, the lookup is performed based solely on the names of the parameters. Furthermore, the lookup ignores the parameters if there is only one factory method with the specified name.\r\n\r\nThis can lead to incorrect configuration being silently ignored or confusing error messages when the specified factory method is overloaded.\r\n\r\n## Examples\r\n\r\nGiven the following extensions:\r\n\r\n```java\r\nclass IntegerResolver implements ParameterResolver {\r\n\t@Override\r\n\tpublic boolean supportsParameter(ParameterContext pc, ExtensionContext ec) {\r\n\t\treturn pc.getParameter().getType() == int.class;\r\n\t}\r\n\t@Override\r\n\tpublic Object resolveParameter(ParameterContext pc, ExtensionContext ec) {\r\n\t\treturn 2;\r\n\t}\r\n}\r\n\r\nclass IntegerArrayResolver implements ParameterResolver {\r\n\t@Override\r\n\tpublic boolean supportsParameter(ParameterContext pc, ExtensionContext ec) {\r\n\t\treturn pc.getParameter().getType() == int[].class;\r\n\t}\r\n\t@Override\r\n\tpublic Object resolveParameter(ParameterContext pc, ExtensionContext ec) {\r\n\t\treturn new int[] { 2, 3 };\r\n\t}\r\n}\r\n```\r\n\r\nAnd given the following test class:\r\n\r\n```java\r\n@ExtendWith({IntegerResolver.class, IntegerArrayResolver.class})\r\nclass MethodSourceTests {\r\n\r\n\t@ParameterizedTest\r\n\t// @MethodSource(\"example.MethodSourceTests#factory(dog)\")\r\n\t@MethodSource(\"factory(dog)\")\r\n\tvoid test(String argument) {\r\n\t\tassertTrue(argument.startsWith(\"2\"));\r\n\t}\r\n\r\n\tstatic Stream<Arguments> factory(int quantities) {\r\n\t\treturn Stream.of(arguments(quantities + \" apples\"), arguments(quantities + \" lemons\"));\r\n\t}\r\n\r\n//\tstatic Stream<Arguments> factory(int[] quantities) {\r\n//\t\treturn Stream.of(arguments(quantities[0] + \" apples\"), arguments(quantities[0] + \" lemons\"));\r\n//\t}\r\n\r\n}\r\n```\r\n\r\nIf we run the test \"as is\", it will pass because the `dog` parameter is not validated. It is in fact completely ignored since there are no \"competing\" overloaded `factory` methods with the same name.\r\n\r\nWhereas, if we attempt to do the same using the fully qualified method name (FQMN) syntax (`@MethodSource(\"example.MethodSourceTests#factory(dog)\")`), we get the following exception.\r\n\r\n> org.junit.platform.commons.JUnitException: Failed to load parameter type [dog] for method [factory] in class [example.MethodSourceTests].\r\n\r\nSimilarly, if we supply a valid parameter type for a factory method that does not exist using the FQMN syntax (`@MethodSource(\"example.MethodSourceTests#factory(java.lang.Integer)\")`), we get the following exception.\r\n\r\n> org.junit.platform.commons.JUnitException: Could not find factory method [factory(java.lang.Integer)] in class [example.MethodSourceTests]\r\n\r\nIn contrast, using the local factory method syntax (`@MethodSource(\"factory(java.lang.Integer)\")`), the test will pass since the parameters are ignored (as with the `dog` example).\r\n\r\nIf we uncomment the `factory(int[])` method and run the test, we get the following somewhat confusing error message.\r\n\r\n> org.junit.platform.commons.PreconditionViolationException: 2 factory methods named [factory(dog)] were found in class [example.MethodSourceTests]: [static java.util.stream.Stream example.MethodSourceTests.factory(int), static java.util.stream.Stream example.MethodSourceTests.factory(int[])]\r\n\r\n## Related Issues\r\n\r\n- #3131\r\n- #3266\r\n\r\n## Deliverables\r\n\r\n- [x] Validate factory method parameter types supplied to `@MethodSource` using the local factory method name syntax.\r\n- [x] Ensure that error messages for configuration errors encountered when using the local factory method name syntax align with the error messages produced for similar configuration errors when using the fully qualified method name syntax.\r\n","closed_by":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/3130/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/junit-team/junit-framework/issues/3130/timeline","performed_via_github_app":null,"state_reason":"completed"}