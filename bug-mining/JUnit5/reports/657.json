{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/4076","repository_url":"https://api.github.com/repos/junit-team/junit-framework","labels_url":"https://api.github.com/repos/junit-team/junit-framework/issues/4076/labels{/name}","comments_url":"https://api.github.com/repos/junit-team/junit-framework/issues/4076/comments","events_url":"https://api.github.com/repos/junit-team/junit-framework/issues/4076/events","html_url":"https://github.com/junit-team/junit-framework/issues/4076","id":2592350798,"node_id":"I_kwDOAbwRH86ahCJO","number":4076,"title":"Test discovery failing with NullPointerException when trying to find methods of a test class","user":{"login":"pshevche","id":14233799,"node_id":"MDQ6VXNlcjE0MjMzNzk5","avatar_url":"https://avatars.githubusercontent.com/u/14233799?v=4","gravatar_id":"","url":"https://api.github.com/users/pshevche","html_url":"https://github.com/pshevche","followers_url":"https://api.github.com/users/pshevche/followers","following_url":"https://api.github.com/users/pshevche/following{/other_user}","gists_url":"https://api.github.com/users/pshevche/gists{/gist_id}","starred_url":"https://api.github.com/users/pshevche/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pshevche/subscriptions","organizations_url":"https://api.github.com/users/pshevche/orgs","repos_url":"https://api.github.com/users/pshevche/repos","events_url":"https://api.github.com/users/pshevche/events{/privacy}","received_events_url":"https://api.github.com/users/pshevche/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":420912036,"node_id":"MDU6TGFiZWw0MjA5MTIwMzY=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/component:%20Platform","name":"component: Platform","color":"11dd99","default":false,"description":null},{"id":420912143,"node_id":"MDU6TGFiZWw0MjA5MTIxNDM=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/component:%20Vintage","name":"component: Vintage","color":"11cc99","default":false,"description":null},{"id":425245644,"node_id":"MDU6TGFiZWw0MjUyNDU2NDQ=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/theme:%20discovery","name":"theme: discovery","color":"ffdd22","default":false,"description":null},{"id":6409526388,"node_id":"LA_kwDOAbwRH88AAAABfgmcdA","url":"https://api.github.com/repos/junit-team/junit-framework/labels/type:%20regression","name":"type: regression","color":"fc2929","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/junit-team/junit-framework/milestones/84","html_url":"https://github.com/junit-team/junit-framework/milestone/84","labels_url":"https://api.github.com/repos/junit-team/junit-framework/milestones/84/labels","id":11691187,"node_id":"MI_kwDOAbwRH84AsmSz","number":84,"title":"5.11.3","description":"","creator":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":4,"state":"closed","created_at":"2024-10-08T08:17:18Z","updated_at":"2024-10-21T13:46:01Z","due_on":"2024-10-21T07:00:00Z","closed_at":"2024-10-21T13:46:01Z"},"comments":2,"created_at":"2024-10-16T16:03:35Z","updated_at":"2024-10-17T19:11:40Z","closed_at":"2024-10-17T09:49:10Z","author_association":"CONTRIBUTOR","type":{"id":146627,"node_id":"IT_kwDOAA1WZs4AAjzD","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T09:15:40Z","updated_at":"2024-07-26T10:05:45Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Context\n\nWe observe test discovery failing with a `NullPointerException` when trying to find test class methods (stacktrace is attached below). This seems to be a regression in 1.11.x version of `junit-platform-commons`. Discovery succeeds when using 1.10.x versions. Apparently, the `.getPackage()` in this method can yield `null`:\nhttps://github.com/junit-team/junit5/blob/0de9d1033da1880dc61c72b02840941cfcc2d10e/junit-platform-commons/src/main/java/org/junit/platform/commons/util/ReflectionUtils.java#L1905-L1907\n\nAccording to the [docs](https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getPackage--) this can happen if the package object is not created by the classloader. I have not been able to create a standalone reproducer yet, but I'll keep trying :) So far, we've seen this happen only when running Spock 1.3 tests located in the root package. \n\n\n### Stacktrace\n```\nCaused by: java.lang.NullPointerException\n\tat org.junit.platform.commons.util.ReflectionUtils.declaredInSamePackage(ReflectionUtils.java:1902)\n\tat org.junit.platform.commons.util.ReflectionUtils.isMethodOverriddenBy(ReflectionUtils.java:1888)\n\tat org.junit.platform.commons.util.ReflectionUtils.lambda$isMethodOverriddenByLocalMethods$35(ReflectionUtils.java:1870)\n\tat java.util.stream.MatchOps$1MatchSink.accept(MatchOps.java:90)\n\tat java.util.ArrayList$ArrayListSpliterator.tryAdvance(ArrayList.java:1361)\n\tat java.util.stream.ReferencePipeline.forEachWithCancel(ReferencePipeline.java:126)\n\tat java.util.stream.AbstractPipeline.copyIntoWithCancel(AbstractPipeline.java:499)\n\tat java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:486)\n\tat java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)\n\tat java.util.stream.MatchOps$MatchOp.evaluateSequential(MatchOps.java:230)\n\tat java.util.stream.MatchOps$MatchOp.evaluateSequential(MatchOps.java:196)\n\tat java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n\tat java.util.stream.ReferencePipeline.anyMatch(ReferencePipeline.java:516)\n\tat org.junit.platform.commons.util.ReflectionUtils.isMethodOverriddenByLocalMethods(ReflectionUtils.java:1870)\n\tat org.junit.platform.commons.util.ReflectionUtils.lambda$findAllMethodsInHierarchy$29(ReflectionUtils.java:1661)\n\tat java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:174)\n\tat java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1384)\n\tat java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)\n\tat java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)\n\tat java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)\n\tat java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n\tat java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:566)\n\tat org.junit.platform.commons.util.ReflectionUtils.findAllMethodsInHierarchy(ReflectionUtils.java:1662)\n\tat org.junit.platform.commons.util.ReflectionUtils.streamMethods(ReflectionUtils.java:1642)\n\tat org.junit.platform.commons.util.ReflectionUtils.findMethods(ReflectionUtils.java:1627)\n\tat org.junit.platform.commons.util.ReflectionUtils.findMethods(ReflectionUtils.java:1618)\n\tat org.junit.vintage.engine.descriptor.TestSourceProvider.lambda$findMethod$1(TestSourceProvider.java:75)\n\tat java.util.HashMap.computeIfAbsent(HashMap.java:1128)\n\tat java.util.Collections$SynchronizedMap.computeIfAbsent(Collections.java:2674)\n\tat org.junit.vintage.engine.descriptor.TestSourceProvider.findMethod(TestSourceProvider.java:75)\n\tat org.junit.vintage.engine.descriptor.TestSourceProvider.computeTestSource(TestSourceProvider.java:56)\n\tat java.util.concurrent.ConcurrentHashMap.computeIfAbsent(ConcurrentHashMap.java:1660)\n\tat org.junit.vintage.engine.descriptor.TestSourceProvider.findTestSource(TestSourceProvider.java:47)\n\tat org.junit.vintage.engine.discovery.RunnerTestDescriptorPostProcessor.addChildrenRecursively(RunnerTestDescriptorPostProcessor.java:62)\n\tat org.junit.vintage.engine.discovery.RunnerTestDescriptorPostProcessor.applyFiltersAndCreateDescendants(RunnerTestDescriptorPostProcessor.java:41)\n\tat org.junit.vintage.engine.discovery.VintageDiscoverer.discover(VintageDiscoverer.java:46)\n\tat org.junit.vintage.engine.VintageTestEngine.discover(VintageTestEngine.java:64)\n\tat org.junit.platform.launcher.core.EngineDiscoveryOrchestrator.discoverEngineRoot(EngineDiscoveryOrchestrator.java:152)\n\t... 13 more\n```","closed_by":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/4076/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/junit-team/junit-framework/issues/4076/timeline","performed_via_github_app":null,"state_reason":"completed"}