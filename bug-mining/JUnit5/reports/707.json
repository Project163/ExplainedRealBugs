{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/3141","repository_url":"https://api.github.com/repos/junit-team/junit-framework","labels_url":"https://api.github.com/repos/junit-team/junit-framework/issues/3141/labels{/name}","comments_url":"https://api.github.com/repos/junit-team/junit-framework/issues/3141/comments","events_url":"https://api.github.com/repos/junit-team/junit-framework/issues/3141/events","html_url":"https://github.com/junit-team/junit-framework/issues/3141","id":1564620001,"node_id":"I_kwDOAbwRH85dQjTh","number":3141,"title":"`Locale` argument conversion not setting `language` and `country` properly","user":{"login":"scordio","id":26772046,"node_id":"MDQ6VXNlcjI2NzcyMDQ2","avatar_url":"https://avatars.githubusercontent.com/u/26772046?v=4","gravatar_id":"","url":"https://api.github.com/users/scordio","html_url":"https://github.com/scordio","followers_url":"https://api.github.com/users/scordio/followers","following_url":"https://api.github.com/users/scordio/following{/other_user}","gists_url":"https://api.github.com/users/scordio/gists{/gist_id}","starred_url":"https://api.github.com/users/scordio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scordio/subscriptions","organizations_url":"https://api.github.com/users/scordio/orgs","repos_url":"https://api.github.com/users/scordio/repos","events_url":"https://api.github.com/users/scordio/events{/privacy}","received_events_url":"https://api.github.com/users/scordio/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":165165180,"node_id":"MDU6TGFiZWwxNjUxNjUxODA=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/type:%20enhancement","name":"type: enhancement","color":"84b6eb","default":false,"description":null},{"id":420911923,"node_id":"MDU6TGFiZWw0MjA5MTE5MjM=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/component:%20Jupiter","name":"component: Jupiter","color":"11ee99","default":false,"description":null},{"id":747276013,"node_id":"MDU6TGFiZWw3NDcyNzYwMTM=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/theme:%20parameterized%20tests","name":"theme: parameterized tests","color":"9e9dea","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"scordio","id":26772046,"node_id":"MDQ6VXNlcjI2NzcyMDQ2","avatar_url":"https://avatars.githubusercontent.com/u/26772046?v=4","gravatar_id":"","url":"https://api.github.com/users/scordio","html_url":"https://github.com/scordio","followers_url":"https://api.github.com/users/scordio/followers","following_url":"https://api.github.com/users/scordio/following{/other_user}","gists_url":"https://api.github.com/users/scordio/gists{/gist_id}","starred_url":"https://api.github.com/users/scordio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scordio/subscriptions","organizations_url":"https://api.github.com/users/scordio/orgs","repos_url":"https://api.github.com/users/scordio/repos","events_url":"https://api.github.com/users/scordio/events{/privacy}","received_events_url":"https://api.github.com/users/scordio/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"scordio","id":26772046,"node_id":"MDQ6VXNlcjI2NzcyMDQ2","avatar_url":"https://avatars.githubusercontent.com/u/26772046?v=4","gravatar_id":"","url":"https://api.github.com/users/scordio","html_url":"https://github.com/scordio","followers_url":"https://api.github.com/users/scordio/followers","following_url":"https://api.github.com/users/scordio/following{/other_user}","gists_url":"https://api.github.com/users/scordio/gists{/gist_id}","starred_url":"https://api.github.com/users/scordio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scordio/subscriptions","organizations_url":"https://api.github.com/users/scordio/orgs","repos_url":"https://api.github.com/users/scordio/repos","events_url":"https://api.github.com/users/scordio/events{/privacy}","received_events_url":"https://api.github.com/users/scordio/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/junit-team/junit-framework/milestones/93","html_url":"https://github.com/junit-team/junit-framework/milestone/93","labels_url":"https://api.github.com/repos/junit-team/junit-framework/milestones/93/labels","id":12597376,"node_id":"MI_kwDOAbwRH84AwDiA","number":93,"title":"5.13.0-M3","description":"","creator":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":22,"state":"closed","created_at":"2025-03-23T13:28:20Z","updated_at":"2025-05-04T13:39:08Z","due_on":"2025-05-02T07:00:00Z","closed_at":"2025-05-02T11:37:25Z"},"comments":21,"created_at":"2023-01-31T16:16:26Z","updated_at":"2025-04-28T12:18:55Z","closed_at":"2025-04-28T07:49:53Z","author_association":"CONTRIBUTOR","type":{"id":146631,"node_id":"IT_kwDOAA1WZs4AAjzH","name":"Feature","description":"A request, idea, or new functionality","color":"blue","created_at":"2024-01-25T09:15:40Z","updated_at":"2024-10-08T08:32:28Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I am trying to write a parameterized test for a service that uses a resource bundle under the hood, loading the resource bundle with [`ResourceBundle.getBundle(String, Locale)`](https://docs.oracle.com/javase/8/docs/api/java/util/ResourceBundle.html#getBundle-java.lang.String-java.util.Locale-).\n\n\nThe test gets several `Locale` values in a `@CsvSource` annotation: \n\nThe [documentation](https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests-argument-conversion-implicit) does not have an example for a country-based locale so I initially tried with:\n\n```java\n@CsvSource({\n  \"en_FR, value1\",\n  \"en_GB, value2\",\n  \"fr_FR, value3\",\n  \"fr_MC, value4\",\n  \"it_IT, value5\",\n  ...\n})\nvoid test(Locale locale, String expected) {\n  // call service using the resource bundle\n\n  // compare result with `expected`\n}\n```\n\nAll worked fine on Windows (local environment) but failed on Linux (CI).\n\nAfter some digging, on Windows everything works because it's a case-insensitive file system, so for example the `en_FR` value is converted to a `en_fr` language-only locale (i.e., without country) and it successfully matches the file ending with `en_FR` because of case insensitivity.\n\nLooking at the code, I think the problem is here:\n\nhttps://github.com/junit-team/junit5/blob/4288cf1233b4af6002e922cb9ddd1b159fe2c9b3/junit-jupiter-params/src/main/java/org/junit/jupiter/params/converter/DefaultArgumentConverter.java#L265\n\nwhich uses the [`Locale(String)`](https://docs.oracle.com/javase/8/docs/api/java/util/Locale.html#Locale-java.lang.String-) constructor. The constructor Javadoc also explains the different behavior based on case sensitivity:\n\n> This constructor normalizes the language value to lowercase. \n\nLooking at the test cases:\n\nhttps://github.com/junit-team/junit5/blob/4288cf1233b4af6002e922cb9ddd1b159fe2c9b3/junit-jupiter-params/src/test/java/org/junit/jupiter/params/converter/DefaultArgumentConverterTests.java#L222-L223\n\nProbably the second one is invalid. I would have expected that to be:\n\n```java\nassertConverts(\"en_us\", Locale.class, Locale.US);\n```\n\nwhich does not pass with the current implementation.\n\n## Steps to reproduce\n\nAs the documentation does not cover conversion of locales with country, I am not sure what would be the \"right\" test case to demonstrate the issue.\n\nAssuming the [IETF BCP 47 language tag format](https://docs.oracle.com/javase/8/docs/api/java/util/Locale.html#forLanguageTag-java.lang.String-) would be the right format for input values, this test fails already at the first assertion:\n\n```java\n  @ParameterizedTest\n  @ValueSource(strings = { \"en-US\" })\n  void test(Locale locale) {\n    assertEquals(\"en\", locale.getLanguage());\n    assertEquals(\"US\", locale.getCountry());\n    assertEquals(Locale.US, locale);\n  }\n```\n\n## Workaround\n\nCurrently, I'm using a custom `ArgumentConverter` which delegates the conversion to [`Locale::forLanguageTag`](https://docs.oracle.com/javase/8/docs/api/java/util/Locale.html#forLanguageTag-java.lang.String-).\n\n## Context\n\n - Used versions (Jupiter/Vintage/Platform): 5.8.2\n - Build Tool/IDE: Intellij IDEA / Maven\n\n## Deliverables\n\n- [x] `DefaultArgumentConverter` properly converts IETF BCP 47 strings\n- [x] The [documentation](https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests-argument-conversion-implicit) has an example using the IETF BCP 47 language tag format\n","closed_by":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/3141/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/junit-team/junit-framework/issues/3141/timeline","performed_via_github_app":null,"state_reason":"completed"}