{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/2605","repository_url":"https://api.github.com/repos/junit-team/junit-framework","labels_url":"https://api.github.com/repos/junit-team/junit-framework/issues/2605/labels{/name}","comments_url":"https://api.github.com/repos/junit-team/junit-framework/issues/2605/comments","events_url":"https://api.github.com/repos/junit-team/junit-framework/issues/2605/events","html_url":"https://github.com/junit-team/junit-framework/issues/2605","id":872669396,"node_id":"MDU6SXNzdWU4NzI2NjkzOTY=","number":2605,"title":"@Isolated annotation doesn't work properly when @ResourceLock annotations are also used","user":{"login":"n-miles","id":12836996,"node_id":"MDQ6VXNlcjEyODM2OTk2","avatar_url":"https://avatars.githubusercontent.com/u/12836996?v=4","gravatar_id":"","url":"https://api.github.com/users/n-miles","html_url":"https://github.com/n-miles","followers_url":"https://api.github.com/users/n-miles/followers","following_url":"https://api.github.com/users/n-miles/following{/other_user}","gists_url":"https://api.github.com/users/n-miles/gists{/gist_id}","starred_url":"https://api.github.com/users/n-miles/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/n-miles/subscriptions","organizations_url":"https://api.github.com/users/n-miles/orgs","repos_url":"https://api.github.com/users/n-miles/repos","events_url":"https://api.github.com/users/n-miles/events{/privacy}","received_events_url":"https://api.github.com/users/n-miles/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":165165178,"node_id":"MDU6TGFiZWwxNjUxNjUxNzg=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":null},{"id":318079877,"node_id":"MDU6TGFiZWwzMTgwNzk4Nzc=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/theme:%20concurrency","name":"theme: concurrency","color":"eeccff","default":false,"description":null},{"id":420911923,"node_id":"MDU6TGFiZWw0MjA5MTE5MjM=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/component:%20Jupiter","name":"component: Jupiter","color":"11ee99","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/junit-team/junit-framework/milestones/56","html_url":"https://github.com/junit-team/junit-framework/milestone/56","labels_url":"https://api.github.com/repos/junit-team/junit-framework/milestones/56/labels","id":6691245,"node_id":"MDk6TWlsZXN0b25lNjY5MTI0NQ==","number":56,"title":"5.7.2","description":"","creator":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":7,"state":"closed","created_at":"2021-04-23T10:15:31Z","updated_at":"2021-05-15T12:25:04Z","due_on":"2021-05-15T07:00:00Z","closed_at":"2021-05-15T12:25:04Z"},"comments":2,"created_at":"2021-04-30T15:01:13Z","updated_at":"2024-10-16T12:42:58Z","closed_at":"2021-05-15T08:28:21Z","author_association":"NONE","type":{"id":146627,"node_id":"IT_kwDOAA1WZs4AAjzD","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T09:15:40Z","updated_at":"2024-07-26T10:05:45Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The documentaion for `@Isolated` states\r\n\r\n>`@Isolated` is used to declare that the annotated test class should be executed in isolation from other test classes.\r\n>When a test class is run in isolation, no other test class is executed concurrently. This can be used to enable parallel test execution for the entire test suite while running some tests in isolation (e.g. if they modify some global resource).\r\n\r\nThe `@Isolated` annotation is implemented as a global lock. At a glance, it looks like it's just shorthand for\r\n```java\r\n@ResourceLock(\"org.junit.platform.engine.support.hierarchical.ExclusiveResource.GLOBAL_KEY\")\r\n```\r\nThis has a very surprising and I would argue buggy implication: if you use a `@ResourceLock(\"something\")` annotation on one test and `@Isolated` on another, the `@Isolated` test will run in parallel with the `@ResourceLock`ed test, violating the \"no other test class is executed concurrently\" part of the `@Isolated` contract.\r\n\r\n## Steps to reproduce\r\nPut this in your `src/test/resources/junit-platform.properties` file\r\n```\r\njunit.jupiter.execution.parallel.enabled = true\r\njunit.jupiter.execution.parallel.mode.default = concurrent\r\n```\r\nDefine 3 test classes like this in some package:\r\n```java\r\n@Isolated\r\nclass IsolatedTest {\r\n\r\n    @Test\r\n    void test() throws InterruptedException {\r\n        System.out.println(\"Started isolated test\");\r\n        Thread.sleep(5000);\r\n        System.out.println(\"Finished isolated test\");\r\n    }\r\n}\r\n```\r\n```java\r\n@ResourceLock(\"something\")\r\nclass ResourceLock1Test {\r\n\r\n    @Test\r\n    void test() throws InterruptedException {\r\n        System.out.println(\"Started ResourceLock1Test\");\r\n        Thread.sleep(5000);\r\n        System.out.println(\"Started ResourceLock1Test\");\r\n    }\r\n}\r\n```\r\n```java\r\n@ResourceLock(\"something\")\r\nclass ResourceLock2Test {\r\n\r\n    @Test\r\n    void test() throws InterruptedException {\r\n        System.out.println(\"Started ResourceLock2Test\");\r\n        Thread.sleep(5000);\r\n        System.out.println(\"Started ResourceLock2Test\");\r\n    }\r\n}\r\n```\r\n### Expected Behavior\r\nI expect none of these tests to interleave - The `@ResourceLock(\"something\")` tests acquire the read-write lock, so they should not interleave with each other, and the `@Isolated` test has the behavior that \"no other test class is executed concurrently\", so it should not interleave with either of the other tests.\r\n\r\n### Actual Behavior\r\nThe `@Isolated` test runs in parallel with the `@ResourceLock(\"something\")` tests\r\n\r\n## Context\r\n\r\n - Used versions (Jupiter/Vintage/Platform): `junit-jupiter-api:5.7.1`\r\n - Build Tool/IDE: Confirmed behavior in Maven 3.8.1 and Intellij 2021.1\r\n","closed_by":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/2605/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/junit-team/junit-framework/issues/2605/timeline","performed_via_github_app":null,"state_reason":"completed"}