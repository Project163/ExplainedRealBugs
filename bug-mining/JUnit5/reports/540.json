{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/3051","repository_url":"https://api.github.com/repos/junit-team/junit-framework","labels_url":"https://api.github.com/repos/junit-team/junit-framework/issues/3051/labels{/name}","comments_url":"https://api.github.com/repos/junit-team/junit-framework/issues/3051/comments","events_url":"https://api.github.com/repos/junit-team/junit-framework/issues/3051/events","html_url":"https://github.com/junit-team/junit-framework/issues/3051","id":1396629724,"node_id":"I_kwDOAbwRH85TPuDc","number":3051,"title":"`EngineDiscoveryResultValidator` should produce an actionable error message for cyclic TestDescriptor structures","user":{"login":"tribbloid","id":3441413,"node_id":"MDQ6VXNlcjM0NDE0MTM=","avatar_url":"https://avatars.githubusercontent.com/u/3441413?v=4","gravatar_id":"","url":"https://api.github.com/users/tribbloid","html_url":"https://github.com/tribbloid","followers_url":"https://api.github.com/users/tribbloid/followers","following_url":"https://api.github.com/users/tribbloid/following{/other_user}","gists_url":"https://api.github.com/users/tribbloid/gists{/gist_id}","starred_url":"https://api.github.com/users/tribbloid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tribbloid/subscriptions","organizations_url":"https://api.github.com/users/tribbloid/orgs","repos_url":"https://api.github.com/users/tribbloid/repos","events_url":"https://api.github.com/users/tribbloid/events{/privacy}","received_events_url":"https://api.github.com/users/tribbloid/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":165165180,"node_id":"MDU6TGFiZWwxNjUxNjUxODA=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/type:%20enhancement","name":"type: enhancement","color":"84b6eb","default":false,"description":null},{"id":420912036,"node_id":"MDU6TGFiZWw0MjA5MTIwMzY=","url":"https://api.github.com/repos/junit-team/junit-framework/labels/component:%20Platform","name":"component: Platform","color":"11dd99","default":false,"description":null},{"id":1013654175,"node_id":"MDU6TGFiZWwxMDEzNjU0MTc1","url":"https://api.github.com/repos/junit-team/junit-framework/labels/theme:%20diagnostics","name":"theme: diagnostics","color":"5098bf","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},{"login":"giurim","id":15023637,"node_id":"MDQ6VXNlcjE1MDIzNjM3","avatar_url":"https://avatars.githubusercontent.com/u/15023637?v=4","gravatar_id":"","url":"https://api.github.com/users/giurim","html_url":"https://github.com/giurim","followers_url":"https://api.github.com/users/giurim/followers","following_url":"https://api.github.com/users/giurim/following{/other_user}","gists_url":"https://api.github.com/users/giurim/gists{/gist_id}","starred_url":"https://api.github.com/users/giurim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/giurim/subscriptions","organizations_url":"https://api.github.com/users/giurim/orgs","repos_url":"https://api.github.com/users/giurim/repos","events_url":"https://api.github.com/users/giurim/events{/privacy}","received_events_url":"https://api.github.com/users/giurim/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/junit-team/junit-framework/milestones/65","html_url":"https://github.com/junit-team/junit-framework/milestone/65","labels_url":"https://api.github.com/repos/junit-team/junit-framework/milestones/65/labels","id":8454988,"node_id":"MI_kwDOAbwRH84AgQNM","number":65,"title":"5.10 M1","description":"","creator":{"login":"sbrannen","id":104798,"node_id":"MDQ6VXNlcjEwNDc5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104798?v=4","gravatar_id":"","url":"https://api.github.com/users/sbrannen","html_url":"https://github.com/sbrannen","followers_url":"https://api.github.com/users/sbrannen/followers","following_url":"https://api.github.com/users/sbrannen/following{/other_user}","gists_url":"https://api.github.com/users/sbrannen/gists{/gist_id}","starred_url":"https://api.github.com/users/sbrannen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sbrannen/subscriptions","organizations_url":"https://api.github.com/users/sbrannen/orgs","repos_url":"https://api.github.com/users/sbrannen/repos","events_url":"https://api.github.com/users/sbrannen/events{/privacy}","received_events_url":"https://api.github.com/users/sbrannen/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":43,"state":"closed","created_at":"2022-09-24T13:32:16Z","updated_at":"2023-05-13T13:20:43Z","due_on":null,"closed_at":"2023-05-13T13:20:43Z"},"comments":9,"created_at":"2022-10-04T17:41:55Z","updated_at":"2023-04-28T13:27:32Z","closed_at":"2023-04-28T13:27:11Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This is the root cause of the problem reported in this ticket:\r\n\r\nhttps://github.com/helmethair-co/scalatest-junit-runner/issues/83\r\n\r\nDue to the flexibility of ScalaTest, A nested suite may cause several test cases to use the same ID, ScalaTest native runner can run it, but JUnit cannot. Instead it will throw a very brief error like this:\r\n\r\n```\r\nfailed to execute tests\r\n\r\norg.gradle.api.internal.tasks.testing.TestSuiteExecutionException: Could not complete execution for Gradle Test Executor 1.\r\n\tat org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.stop(SuiteTestClassProcessor.java:63)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:36)\r\n\tat org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)\r\n\tat org.gradle.internal.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:33)\r\n\tat org.gradle.internal.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:94)\r\n\tat com.sun.proxy.$Proxy2.stop(Unknown Source)\r\n\tat org.gradle.api.internal.tasks.testing.worker.TestWorker$3.run(TestWorker.java:193)\r\n\tat org.gradle.api.internal.tasks.testing.worker.TestWorker.executeAndMaintainThreadName(TestWorker.java:129)\r\n\tat org.gradle.api.internal.tasks.testing.worker.TestWorker.execute(TestWorker.java:100)\r\n\tat org.gradle.api.internal.tasks.testing.worker.TestWorker.execute(TestWorker.java:60)\r\n\tat org.gradle.process.internal.worker.child.ActionExecutionWorker.execute(ActionExecutionWorker.java:56)\r\n\tat org.gradle.process.internal.worker.child.SystemApplicationClassLoaderWorker.call(SystemApplicationClassLoaderWorker.java:133)\r\n\tat org.gradle.process.internal.worker.child.SystemApplicationClassLoaderWorker.call(SystemApplicationClassLoaderWorker.java:71)\r\n\tat worker.org.gradle.process.internal.worker.GradleWorkerMain.run(GradleWorkerMain.java:69)\r\n\tat worker.org.gradle.process.internal.worker.GradleWorkerMain.main(GradleWorkerMain.java:74)\r\nCaused by: org.junit.platform.commons.JUnitException: TestEngine with ID 'scalatest' failed to discover tests\r\n\tat org.junit.platform.launcher.core.EngineDiscoveryOrchestrator.discoverEngineRoot(EngineDiscoveryOrchestrator.java:111)\r\n\tat org.junit.platform.launcher.core.EngineDiscoveryOrchestrator.discover(EngineDiscoveryOrchestrator.java:85)\r\n\tat org.junit.platform.launcher.core.DefaultLauncher.discover(DefaultLauncher.java:92)\r\n\tat org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:75)\r\n\tat org.gradle.api.internal.tasks.testing.junitplatform.JUnitPlatformTestClassProcessor$CollectAllTestClassesExecutor.processAllTestClasses(JUnitPlatformTestClassProcessor.java:99)\r\n\tat org.gradle.api.internal.tasks.testing.junitplatform.JUnitPlatformTestClassProcessor$CollectAllTestClassesExecutor.access$000(JUnitPlatformTestClassProcessor.java:79)\r\n\tat org.gradle.api.internal.tasks.testing.junitplatform.JUnitPlatformTestClassProcessor.stop(JUnitPlatformTestClassProcessor.java:75)\r\n\tat org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.stop(SuiteTestClassProcessor.java:61)\r\n\t... 18 more\r\nCaused by: org.junit.platform.commons.PreconditionViolationException: The discover() method for TestEngine with ID 'scalatest' returned a cyclic graph.\r\n\tat org.junit.platform.commons.util.Preconditions.condition(Preconditions.java:296)\r\n\tat org.junit.platform.launcher.core.EngineDiscoveryResultValidator.validate(EngineDiscoveryResultValidator.java:40)\r\n\tat org.junit.platform.launcher.core.EngineDiscoveryOrchestrator.discoverEngineRoot(EngineDiscoveryOrchestrator.java:104)\r\n\t... 25 more\r\n```\r\n\r\nThis error information gave no explicit action to identify the root cause and fix it.\r\n\r\nIdeally, the error information should tell the exact path of the tree and its ID that have caused the cycle.\r\n\r\n## Deliverables\r\n\r\n- The following function under `EngineDiscoveryResultValidator` should be modified to push an error message if returning false:\r\n\r\n```\r\n\tboolean isAcyclic(TestDescriptor root) {\r\n\t\tSet<UniqueId> visited = new HashSet<>();\r\n\t\tvisited.add(root.getUniqueId());\r\n\t\tQueue<TestDescriptor> queue = new ArrayDeque<>();\r\n\t\tqueue.add(root);\r\n\t\twhile (!queue.isEmpty()) {\r\n\t\t\tfor (TestDescriptor child : queue.remove().getChildren()) {\r\n\t\t\t\tif (!visited.add(child.getUniqueId())) {\r\n\t\t\t\t\treturn false; // id already known: cycle detected!\r\n\t\t\t\t}\r\n\t\t\t\tif (child.isContainer()) {\r\n\t\t\t\t\tqueue.add(child);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n```\r\n\r\nThis would allow not only tests using ScalaTest runner to be corrected easily, but also tests using other flexible runners","closed_by":{"login":"marcphilipp","id":214207,"node_id":"MDQ6VXNlcjIxNDIwNw==","avatar_url":"https://avatars.githubusercontent.com/u/214207?v=4","gravatar_id":"","url":"https://api.github.com/users/marcphilipp","html_url":"https://github.com/marcphilipp","followers_url":"https://api.github.com/users/marcphilipp/followers","following_url":"https://api.github.com/users/marcphilipp/following{/other_user}","gists_url":"https://api.github.com/users/marcphilipp/gists{/gist_id}","starred_url":"https://api.github.com/users/marcphilipp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcphilipp/subscriptions","organizations_url":"https://api.github.com/users/marcphilipp/orgs","repos_url":"https://api.github.com/users/marcphilipp/repos","events_url":"https://api.github.com/users/marcphilipp/events{/privacy}","received_events_url":"https://api.github.com/users/marcphilipp/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/junit-team/junit-framework/issues/3051/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/junit-team/junit-framework/issues/3051/timeline","performed_via_github_app":null,"state_reason":"completed"}