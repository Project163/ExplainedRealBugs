{"url":"https://api.github.com/repos/httpie/cli/issues/109","repository_url":"https://api.github.com/repos/httpie/cli","labels_url":"https://api.github.com/repos/httpie/cli/issues/109/labels{/name}","comments_url":"https://api.github.com/repos/httpie/cli/issues/109/comments","events_url":"https://api.github.com/repos/httpie/cli/issues/109/events","html_url":"https://github.com/httpie/cli/issues/109","id":8801660,"node_id":"MDU6SXNzdWU4ODAxNjYw","number":109,"title":"json + verbose non tty fails TypeError: expected a character buffer object ","user":{"login":"nickl-","id":1404606,"node_id":"MDQ6VXNlcjE0MDQ2MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1404606?v=4","gravatar_id":"","url":"https://api.github.com/users/nickl-","html_url":"https://github.com/nickl-","followers_url":"https://api.github.com/users/nickl-/followers","following_url":"https://api.github.com/users/nickl-/following{/other_user}","gists_url":"https://api.github.com/users/nickl-/gists{/gist_id}","starred_url":"https://api.github.com/users/nickl-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickl-/subscriptions","organizations_url":"https://api.github.com/users/nickl-/orgs","repos_url":"https://api.github.com/users/nickl-/repos","events_url":"https://api.github.com/users/nickl-/events{/privacy}","received_events_url":"https://api.github.com/users/nickl-/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":275663,"node_id":"MDU6TGFiZWwyNzU2NjM=","url":"https://api.github.com/repos/httpie/cli/labels/bug","name":"bug","color":"ff8075","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2012-11-29T08:53:10Z","updated_at":"2012-12-05T15:35:23Z","closed_at":"2012-12-01T14:58:32Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"# json + verbose - tty\n## TypeError: expected a character buffer object\n\nThere seems to be something dodgy with the json + verbose switches when combining them and piping or redirecting output.\n## Tested on\n- Mac OS X 10.8.2 \n- Python 2.7.2 \n## Debug output:\n\n```\n$ http GET https://api.github.com/ -j -v --debug | cat\nHTTPie 0.3.0\nHTTPie data: /Users/insperion/.httpie\nRequests 0.14.2\nPygments 1.5\nPython 2.7.2 (default, Jun 20 2012, 16:23:33) \n[GCC 4.2.1 Compatible Apple Clang 4.0 (tags/Apple/clang-418.0.60)] darwin\n\n>>> requests.request({'allow_redirects': False,\n 'auth': None,\n 'config': {'base_headers': {'Accept': 'application/json',\n                             'Accept-Encoding': 'gzip, deflate, compress',\n                             'User-Agent': 'HTTPie/0.3.0'}},\n 'data': None,\n 'files': OrderedDict(),\n 'headers': {},\n 'method': 'get',\n 'params': ParamDict(),\n 'prefetch': False,\n 'proxies': {},\n 'timeout': 30,\n 'url': 'https://api.github.com/',\n 'verify': True})\n\nTraceback (most recent call last):\n  File \"/usr/local/bin/http\", line 9, in <module>\n    load_entry_point('httpie==0.3.0', 'console_scripts', 'http')()\nGET / HTTP/1.1\nHost: api.github.com\nAccept-Encoding: gzip, deflate, compress\nAccept: application/json\nUser-Agent: HTTPie/0.3.0\n\n  File \"/Library/Python/2.7/site-packages/httpie-0.3.0-py2.7.egg/httpie/core.py\", line 98, in main\n    write(**write_kwargs)\n  File \"/Library/Python/2.7/site-packages/httpie-0.3.0-py2.7.egg/httpie/output.py\", line 59, in write\n    buf.write(chunk)\nTypeError: expected a character buffer object\n\n```\n## Without debug:\n\n```\n$ http GET https://api.github.com/ -j -v| cat\n\nhttp: error: TypeError: expected a character buffer object\nGET / HTTP/1.1\nHost: api.github.com\nAccept-Encoding: gzip, deflate, compress\nAccept: application/json\nUser-Agent: HTTPie/0.3.0\n\n```\n## Redirecting is the same:\n\n```\n$ http GET https://api.github.com/ -j -v > tt.out\n\nhttp: error: TypeError: expected a character buffer object\n$ cat tt.out\nGET / HTTP/1.1\nHost: api.github.com\nAccept-Encoding: gzip, deflate, compress\nAccept: application/json\nUser-Agent: HTTPie/0.3.0\n```\n## Normal tty output\n\nOutput not being piped or redirected works as expected.\n\n```\n$ http GET https://api.github.com/ -j -v\nGET / HTTP/1.1\nAccept: application/json\nAccept-Encoding: gzip, deflate, compress\nHost: api.github.com\nUser-Agent: HTTPie/0.3.0\n\nHTTP/1.1 200 OK\nCache-Control: max-age=0, private, must-revalidate\nConnection: keep-alive\nContent-Encoding: gzip\nContent-Type: application/json; charset=utf-8\nDate: Thu, 29 Nov 2012 07:24:51 GMT\nETag: \"092bd8285eeff827d02a31e33c2b0b2c\"\nServer: nginx\nStatus: 200 OK\nTransfer-Encoding: chunked\nX-Content-Type-Options: nosniff\nX-GitHub-Media-Type: github.beta\nX-RateLimit-Limit: 60\nX-RateLimit-Remaining: 51\n\n{\n    \"authorizations_url\": \"/authorizations\", \n    \"current_user_repositories_url\": \"/user/repos{?type,page,per_page,sort}\", \n    \"current_user_url\": \"/user\", \n    \"emails_url\": \"/user/emails\", \n    \"emojis_url\": \"/emojis\", \n    \"events_url\": \"/events\", \n    \"following_url\": \"/user/following{/target}\", \n    \"gists_url\": \"/gists{/gist_id}\", \n    \"hub_url\": \"/hub\", \n    \"issue_search_url\": \"/legacy/issues/search/{owner}/{repo}/{state}/{keyword}\", \n    \"issues_url\": \"/issues\", \n    \"keys_url\": \"/user/keys\", \n    \"notifications_url\": \"/notifications\", \n    \"organization_repositories_url\": \"/orgs/{org}/repos/{?type,page,per_page,sort}\", \n    \"organization_url\": \"/orgs/{org}\", \n    \"public_gists_url\": \"/gists/public\", \n    \"rate_limit_url\": \"/rate_limit\", \n    \"repository_search_url\": \"/legacy/repos/search/{keyword}{?language,start_page}\", \n    \"repository_url\": \"/repos/{owner}/{repo}\", \n    \"starred_gists_url\": \"/gists/starred\", \n    \"starred_url\": \"/user/starred{/owner}{/repo}\", \n    \"team_url\": \"/teams\", \n    \"user_organizations_url\": \"/user/orgs\", \n    \"user_repositories_url\": \"/users/{user}/repos{?type,page,per_page,sort}\", \n    \"user_search_url\": \"/legacy/user/search/{keyword}\", \n    \"user_url\": \"/users/{user}\"\n}\n```\n## Accept header\n\nThis also doesn't happen with explicitly setting the Accept header\n\n```\n$ http GET https://api.github.com/ Accept:application/json -v|cat\nGET / HTTP/1.1\nHost: api.github.com\nAccept-Encoding: gzip, deflate, compress\nAccept: application/json\nUser-Agent: HTTPie/0.3.0\n\n\n\nHTTP/1.1 200 OK\nServer: nginx\nDate: Thu, 29 Nov 2012 08:45:05 GMT\nContent-Type: application/json; charset=utf-8\nTransfer-Encoding: chunked\nConnection: keep-alive\nStatus: 200 OK\nX-GitHub-Media-Type: github.beta\nX-RateLimit-Limit: 60\nETag: \"75b0d34912a9ba5fbf1c66e567499904\"\nX-Content-Type-Options: nosniff\nX-RateLimit-Remaining: 49\nCache-Control: max-age=0, private, must-revalidate\nContent-Encoding: gzip\n\n{\"starred_url\":\"/user/starred{/owner}{/repo}\",\"current_user_repositories_url\":\"/user/repos{?type,page,per_page,sort}\",\"emojis_url\":\"/emojis\",\"team_url\":\"/teams\",\"hub_url\":\"/hub\",\"following_url\":\"/user/following{/target}\",\"user_search_url\":\"/legacy/user/search/{keyword}\",\"user_repositories_url\":\"/users/{user}/repos{?type,page,per_page,sort}\",\"events_url\":\"/events\",\"starred_gists_url\":\"/gists/starred\",\"public_gists_url\":\"/gists/public\",\"keys_url\":\"/user/keys\",\"current_user_url\":\"/user\",\"user_organizations_url\":\"/user/orgs\",\"rate_limit_url\":\"/rate_limit\",\"organization_repositories_url\":\"/orgs/{org}/repos/{?type,page,per_page,sort}\",\"user_url\":\"/users/{user}\",\"repository_url\":\"/repos/{owner}/{repo}\",\"notifications_url\":\"/notifications\",\"issue_search_url\":\"/legacy/issues/search/{owner}/{repo}/{state}/{keyword}\",\"authorizations_url\":\"/authorizations\",\"repository_search_url\":\"/legacy/repos/search/{keyword}{?language,start_page}\",\"organization_url\":\"/orgs/{org}\",\"issues_url\":\"/issues\",\"gists_url\":\"/gists{/gist_id}\",\"emails_url\":\"/user/emails\"}\n```\n","closed_by":{"login":"jkbrzt","id":326885,"node_id":"MDQ6VXNlcjMyNjg4NQ==","avatar_url":"https://avatars.githubusercontent.com/u/326885?v=4","gravatar_id":"","url":"https://api.github.com/users/jkbrzt","html_url":"https://github.com/jkbrzt","followers_url":"https://api.github.com/users/jkbrzt/followers","following_url":"https://api.github.com/users/jkbrzt/following{/other_user}","gists_url":"https://api.github.com/users/jkbrzt/gists{/gist_id}","starred_url":"https://api.github.com/users/jkbrzt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkbrzt/subscriptions","organizations_url":"https://api.github.com/users/jkbrzt/orgs","repos_url":"https://api.github.com/users/jkbrzt/repos","events_url":"https://api.github.com/users/jkbrzt/events{/privacy}","received_events_url":"https://api.github.com/users/jkbrzt/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/httpie/cli/issues/109/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/httpie/cli/issues/109/timeline","performed_via_github_app":null,"state_reason":"completed"}