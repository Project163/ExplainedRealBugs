{"url":"https://api.github.com/repos/httpie/cli/issues/948","repository_url":"https://api.github.com/repos/httpie/cli","labels_url":"https://api.github.com/repos/httpie/cli/issues/948/labels{/name}","comments_url":"https://api.github.com/repos/httpie/cli/issues/948/comments","events_url":"https://api.github.com/repos/httpie/cli/issues/948/events","html_url":"https://github.com/httpie/cli/issues/948","id":649075547,"node_id":"MDU6SXNzdWU2NDkwNzU1NDc=","number":948,"title":"Tests fail when running openssl with security level > 1","user":{"login":"matthewhughes934","id":34972397,"node_id":"MDQ6VXNlcjM0OTcyMzk3","avatar_url":"https://avatars.githubusercontent.com/u/34972397?v=4","gravatar_id":"","url":"https://api.github.com/users/matthewhughes934","html_url":"https://github.com/matthewhughes934","followers_url":"https://api.github.com/users/matthewhughes934/followers","following_url":"https://api.github.com/users/matthewhughes934/following{/other_user}","gists_url":"https://api.github.com/users/matthewhughes934/gists{/gist_id}","starred_url":"https://api.github.com/users/matthewhughes934/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matthewhughes934/subscriptions","organizations_url":"https://api.github.com/users/matthewhughes934/orgs","repos_url":"https://api.github.com/users/matthewhughes934/repos","events_url":"https://api.github.com/users/matthewhughes934/events{/privacy}","received_events_url":"https://api.github.com/users/matthewhughes934/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-07-01T15:31:24Z","updated_at":"2020-08-06T20:24:33Z","closed_at":"2020-08-06T20:24:33Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi,\r\n\r\nI noticed an environment specific test-failure when I was poking around this repo.\r\n\r\nPS. the setup process of just running `make` to get everything ready for development is really nice, thanks for that.\r\n\r\n**Description**\r\n\r\nThe following tests fail when running openssl with security level > 1:\r\n\r\n`tests/test_ssl.py::TestClientCert::test_cert_and_key`\r\n`tests/test_ssl.py::TestClientCert::test_cert_pem`\r\n\r\nThe failures end with `[SSL: CA_MD_TOO_WEAK] ca md too weak (_ssl.c:3824)` (though I can share the entire output if needed)\r\n\r\n**Cause**\r\n\r\nThe cause appears to be `tests/client_certs/client.crt` being signed with `sha1WithRSAEncryption`, from the [openssl docs](https://www.openssl.org/docs/man1.1.1/man3/SSL_CTX_get_security_level.html):\r\n\r\n> SHA1 algorithm is very widely used in certificates and will be rejected at levels higher than 1 because it only offers 80 bits of security.\r\n\r\nI've further confirmed this by reducing the security level of openssl on my system (Debian 10, which defaults to security level 2) and observing the tests passing.\r\n\r\n**Resolution**\r\n\r\nPossible resolutions:\r\n\r\n* Do nothing, since this is likely to impact only a small portion of people wishing to run these tests. Maybe document the failure to notify others\r\n* Re-create test certificate and sign with a more secure algorithm\r\n* Skip these tests if the security level is lower than expected (though at a glance there's not a nice interface for determining this from the Python's `ssl` lib)\r\n\r\nIf it's decided that this is worth actioning I'd be happy to attempt whatever action is decided.\r\n\r\n","closed_by":{"login":"jkbrzt","id":326885,"node_id":"MDQ6VXNlcjMyNjg4NQ==","avatar_url":"https://avatars.githubusercontent.com/u/326885?v=4","gravatar_id":"","url":"https://api.github.com/users/jkbrzt","html_url":"https://github.com/jkbrzt","followers_url":"https://api.github.com/users/jkbrzt/followers","following_url":"https://api.github.com/users/jkbrzt/following{/other_user}","gists_url":"https://api.github.com/users/jkbrzt/gists{/gist_id}","starred_url":"https://api.github.com/users/jkbrzt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkbrzt/subscriptions","organizations_url":"https://api.github.com/users/jkbrzt/orgs","repos_url":"https://api.github.com/users/jkbrzt/repos","events_url":"https://api.github.com/users/jkbrzt/events{/privacy}","received_events_url":"https://api.github.com/users/jkbrzt/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/httpie/cli/issues/948/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/httpie/cli/issues/948/timeline","performed_via_github_app":null,"state_reason":"completed"}