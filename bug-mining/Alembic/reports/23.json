{"url":"https://api.github.com/repos/sqlalchemy/alembic/issues/209","repository_url":"https://api.github.com/repos/sqlalchemy/alembic","labels_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/209/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/209/comments","events_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/209/events","html_url":"https://github.com/sqlalchemy/alembic/issues/209","id":384601579,"node_id":"MDU6SXNzdWUzODQ2MDE1Nzk=","number":209,"title":"how alembic reports errors (stack trace, or clean output with a \"failed\" message, etc)","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141242821,"node_id":"MDU6TGFiZWwxMTQxMjQyODIx","url":"https://api.github.com/repos/sqlalchemy/alembic/labels/feature","name":"feature","color":"801010","default":false,"description":null},{"id":1141242890,"node_id":"MDU6TGFiZWwxMTQxMjQyODkw","url":"https://api.github.com/repos/sqlalchemy/alembic/labels/low%20priority","name":"low priority","color":"900080","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":15,"created_at":"2014-06-11T18:27:12Z","updated_at":"2014-06-12T14:30:41Z","closed_at":"2014-06-12T14:30:41Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by Jonathan Herriott ([@herriojr](https://github.com/herriojr))**\n\nEdit: See comments for why this was moved to proposal as both cases actually failed.\n\nThere are two ways I run alembic, one is where I create a separate test database for my test cases and do the migrations for a set of test cases and then tear them down afterwards.  I've run into an issue when doing an alter_column to rename some foreign keys, which work when I run it via command line, but in my tests it fails.  Any attempt at fixing this seems to cause the command line to fail.  This is all being done with MySQL.\n\n\n```\nop.alter_column('my_table', 'my_other_table_id', new_column_name='other_table_id')\n# This fails when run with alembic.command.upgrade with\n#  File \"<string>\", line 7, in alter_column\n#  File \"<string>\", line 1, in <lambda>\n#  File \"/opt/virtualenv/tkey/local/lib/python2.7/site-packages/alembic/util.py\", line 322, in go\n#    return fn(*arg, **kw)\n#  File \"/opt/virtualenv/tkey/local/lib/python2.7/site-packages/alembic/operations.py\", line #300, in alter_column\n#    existing_autoincrement=existing_autoincrement\n#  File \"/opt/virtualenv/tkey/local/lib/python2.7/site-packages/alembic/ddl/mysql.py\", line 42, #in alter_column\n#    else existing_autoincrement\n#  File \"/opt/virtualenv/tkey/local/lib/python2.7/site-packages/alembic/ddl/mysql.py\", line 71, #in __init__\n#    \"All MySQL ALTER COLUMN operations \"\n#CommandError: All MySQL ALTER COLUMN operations require the existing type.\n```\n\nSo, then I try and follow the suggestions, and do the following:\n```\nop.alter_column('my_table', 'my_other_table_id', new_column_name='other_table_id', existing_type=sa.BigInteger, existing_nullable=False)\n# This now fails for both my tests and for my command line upgrade\n#  File \"<string>\", line 7, in alter_column\n#  File \"<string>\", line 1, in <lambda>\n#  File \"/opt/virtualenv/tkey/local/lib/python2.7/site-packages/alembic/util.py\", line 322, in go\n#    return fn(*arg, **kw)\n#  File \"/opt/virtualenv/tkey/local/lib/python2.7/site-packages/alembic/operations.py\", line #300, in alter_column\n#    existing_autoincrement=existing_autoincrement\n#  File \"/opt/virtualenv/tkey/local/lib/python2.7/site-packages/alembic/ddl/mysql.py\", line 42, #in alter_column\n#    else existing_autoincrement\n#  File \"/opt/virtualenv/tkey/local/lib/python2.7/site-packages/alembic/ddl/impl.py\", line 76, in _exec\n#    conn.execute(construct, *multiparams, **params)\n#  File \"build/bdist.linux-x86_64/egg/sqlalchemy/engine/base.py\", line 717, in execute\n#    return meth(self, multiparams, params)\n#  File \"build/bdist.linux-x86_64/egg/sqlalchemy/sql/ddl.py\", line 67, in #_execute_on_connection\n#    return connection._execute_ddl(self, multiparams, params)\n#  File \"build/bdist.linux-x86_64/egg/sqlalchemy/engine/base.py\", line 771, in _execute_ddl\n#    compiled\n#  File \"build/bdist.linux-x86_64/egg/sqlalchemy/engine/base.py\", line 927, in #_execute_context\n#    context)\n#  File \"build/bdist.linux-x86_64/egg/sqlalchemy/engine/base.py\", line 1076, in #_handle_dbapi_exception\n#    exc_info\n#  File \"build/bdist.linux-x86_64/egg/sqlalchemy/util/compat.py\", line 185, in #raise_from_cause\n#    reraise(type(exception), exception, tb=exc_tb)\n#  File \"build/bdist.linux-x86_64/egg/sqlalchemy/engine/base.py\", line 920, in #_execute_context\n#    context)\n#  File \"build/bdist.linux-x86_64/egg/sqlalchemy/engine/default.py\", line 425, in do_execute\n#    cursor.execute(statement, parameters)\n#  File \"/opt/virtualenv/tkey/local/lib/python2.7/site-packages/MySQLdb/cursors.py\", line 205, in execute\n#    self.errorhandler(self, exc, value)\n#  File \"/opt/virtualenv/tkey/local/lib/python2.7/site-packages/MySQLdb/connections.py\", line 36, in defaulterrorhandler\n#    raise errorclass, errorvalue\n#OperationalError: (OperationalError) (1025, \"Error on rename of './bc_paas_test/#sql-#377_42' to './bc_paas_test/account_charge' (errno: 150)\") 'ALTER TABLE account_charge CHANGE sub_account_plan_id account_plan_id BIGINT NOT NULL' ()\n```\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/alembic/issues/209/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/209/timeline","performed_via_github_app":null,"state_reason":"completed"}