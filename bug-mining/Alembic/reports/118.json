{"url":"https://api.github.com/repos/sqlalchemy/alembic/issues/1643","repository_url":"https://api.github.com/repos/sqlalchemy/alembic","labels_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/1643/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/1643/comments","events_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/1643/events","html_url":"https://github.com/sqlalchemy/alembic/issues/1643","id":2984268240,"node_id":"I_kwDOCX47u86x4FHQ","number":1643,"title":"Replace utcnow() which is deprecated on Python 3.13","user":{"login":"jenstroeger","id":12053937,"node_id":"MDQ6VXNlcjEyMDUzOTM3","avatar_url":"https://avatars.githubusercontent.com/u/12053937?v=4","gravatar_id":"","url":"https://api.github.com/users/jenstroeger","html_url":"https://github.com/jenstroeger","followers_url":"https://api.github.com/users/jenstroeger/followers","following_url":"https://api.github.com/users/jenstroeger/following{/other_user}","gists_url":"https://api.github.com/users/jenstroeger/gists{/gist_id}","starred_url":"https://api.github.com/users/jenstroeger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jenstroeger/subscriptions","organizations_url":"https://api.github.com/users/jenstroeger/orgs","repos_url":"https://api.github.com/users/jenstroeger/repos","events_url":"https://api.github.com/users/jenstroeger/events{/privacy}","received_events_url":"https://api.github.com/users/jenstroeger/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141241826,"node_id":"MDU6TGFiZWwxMTQxMjQxODI2","url":"https://api.github.com/repos/sqlalchemy/alembic/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1142648169,"node_id":"MDU6TGFiZWwxMTQyNjQ4MTY5","url":"https://api.github.com/repos/sqlalchemy/alembic/labels/py3k","name":"py3k","color":"e54975","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2025-04-10T02:12:05Z","updated_at":"2025-05-21T00:17:57Z","closed_at":"2025-05-21T00:17:57Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Describe the bug**\n\nThis use of `utcnow()` https://github.com/sqlalchemy/alembic/blob/41198bb1a84960e908d10c61f1a96bf594a33c23/alembic/script/base.py#L631-L635 fails Alembic:\n```\nTraceback (most recent call last):\n  File \"/path/to/.venv/bin/alembic\", line 8, in <module>\n    sys.exit(main())\n             ~~~~^^\n  File \"/path/to/.venv/lib/python3.13/site-packages/alembic/config.py\", line 636, in main\n    CommandLine(prog=prog).main(argv=argv)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^\n  File \"/path/to/.venv/lib/python3.13/site-packages/alembic/config.py\", line 626, in main\n    self.run_cmd(cfg, options)\n    ~~~~~~~~~~~~^^^^^^^^^^^^^^\n  File \"/path/to/.venv/lib/python3.13/site-packages/alembic/config.py\", line 603, in run_cmd\n    fn(\n    ~~^\n        config,\n        ^^^^^^^\n        *[getattr(options, k, None) for k in positional],\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        **{k: getattr(options, k, None) for k in kwarg},\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/path/to/.venv/lib/python3.13/site-packages/alembic/command.py\", line 243, in revision\n    scripts = [script for script in revision_context.generate_scripts()]\n                                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^\n  File \"/path/to/.venv/lib/python3.13/site-packages/alembic/autogenerate/api.py\", line 650, in generate_scripts\n    yield self._to_script(generated_revision)\n          ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^\n  File \"/path/to/.venv/lib/python3.13/site-packages/alembic/autogenerate/api.py\", line 555, in _to_script\n    return self.script_directory.generate_revision(\n           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^\n        migration_script.rev_id,\n        ^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<7 lines>...\n        **template_args,\n        ^^^^^^^^^^^^^^^^\n    )\n    ^\n  File \"/path/to/.venv/lib/python3.13/site-packages/alembic/script/base.py\", line 693, in generate_revision\n    create_date = self._generate_create_date()\n  File \"/path/to/.venv/lib/python3.13/site-packages/alembic/script/base.py\", line 632, in _generate_create_date\n    datetime.datetime.utcnow()\n    ~~~~~~~~~~~~~~~~~~~~~~~~^^\nDeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).\n```\n\n**Expected behavior**\n\nAlembic should succeed.\n\n**To Reproduce**\n\nI ran\n```\nalembic -c test.ini revision --autogenerate -m \"Add column\"\n```\nin a local Python 3.13 environment.\n\n**Error**\n\nSee above.\n\n**Versions.**\n - OS: macOS 13.7.5 (22H527)\n - Python: Python 3.13.2 (main, Feb  8 2025, 23:18:32) [Clang 14.0.3 (clang-1403.0.22.14.1)] on darwin\n - Alembic: 1.15.2\n - SQLAlchemy: 2.0.39\n - Database: PG 14.17\n - DBAPI: psycopg-binary 3.2.6\n\n**Additional context**\n\nI’ve not modified a warnings filter, so I’m a little surprised that the deprecation warning _fails_ Alembic.","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/alembic/issues/1643/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/1643/timeline","performed_via_github_app":null,"state_reason":"completed"}