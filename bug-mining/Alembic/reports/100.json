{"url":"https://api.github.com/repos/sqlalchemy/alembic/issues/367","repository_url":"https://api.github.com/repos/sqlalchemy/alembic","labels_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/367/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/367/comments","events_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/367/events","html_url":"https://github.com/sqlalchemy/alembic/issues/367","id":384602993,"node_id":"MDU6SXNzdWUzODQ2MDI5OTM=","number":367,"title":"Render Mako template errors for template debugging","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141241826,"node_id":"MDU6TGFiZWwxMTQxMjQxODI2","url":"https://api.github.com/repos/sqlalchemy/alembic/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1141242848,"node_id":"MDU6TGFiZWwxMTQxMjQyODQ4","url":"https://api.github.com/repos/sqlalchemy/alembic/labels/migration%20environment","name":"migration environment","color":"600030","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2016-04-07T18:45:13Z","updated_at":"2016-04-11T14:59:44Z","closed_at":"2016-04-09T01:32:31Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by n1ywb ([@n1ywb](https://github.com/n1ywb))**\n\nRan `alembic init --template multidb alembic`\n\n(note my use of multidb template)\n\nThen trying to run `alembic revision -m 'test'`\n\nGetting `TypeError: expected string or buffer`\n\nOf course that's being thrown from inside the compiled mako template so the backtrace isn't useful.\n\nAt `/home/jeff/repos/alembic/alembic/util/pyfiles.py:15`\n\n`template.render_unicode` should be called in a try/except block a la http://docs.makotemplates.org/en/latest/usage.html#handling-exceptions\n\n        try:\n            f.write(\n                template.render_unicode(**kw).encode(output_encoding)\n            )\n        except:\n            print exceptions.text_error_template().render()\n            raise\n\n\nThen you get a useful backtrace like\n\n      File \"alembic/script.py.mako\", line 36, in render_body\n        % for db_name in re.split(r',\\s*', db_names):\n      File \"/home/jeff/.virtualenvs/wsm/lib/python2.7/re.py\", line 171, in split\n        return _compile(pattern, flags).split(string, maxsplit)\n    TypeError: expected string or buffer\n\nThe confounding factor here is that the multidb template is broken by default, but that would have been obvious immediately if the mako exception had been reported at first.\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/alembic/issues/367/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/367/timeline","performed_via_github_app":null,"state_reason":"completed"}