{"url":"https://api.github.com/repos/sqlalchemy/alembic/issues/314","repository_url":"https://api.github.com/repos/sqlalchemy/alembic","labels_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/314/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/314/comments","events_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/314/events","html_url":"https://github.com/sqlalchemy/alembic/issues/314","id":384602520,"node_id":"MDU6SXNzdWUzODQ2MDI1MjA=","number":314,"title":"dupe entries in alembic_versions can break revision logic","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141241826,"node_id":"MDU6TGFiZWwxMTQxMjQxODI2","url":"https://api.github.com/repos/sqlalchemy/alembic/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1141243687,"node_id":"MDU6TGFiZWwxMTQxMjQzNjg3","url":"https://api.github.com/repos/sqlalchemy/alembic/labels/versioning%20model","name":"versioning model","color":"F06040","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-08-03T23:11:59Z","updated_at":"2015-08-03T23:19:06Z","closed_at":"2015-08-03T23:19:06Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by Michael Bayer ([@zzzeek](https://github.com/zzzeek))**\n\ne.g.\n\n```\n#!\n\n\nsqlite> select * from alembic_version;\n32f69b44319\n32f69b44319\n```\n\nthis should raise an error on the stamp, but versioning fails:\n\n```\n#!\n\n\nTraceback (most recent call last):\n  File \"/Library/Frameworks/Python.framework/Versions/3.4/lib/python3.4/runpy.py\", line 170, in _run_module_as_main\n    \"__main__\", mod_spec)\n  File \"/Library/Frameworks/Python.framework/Versions/3.4/lib/python3.4/runpy.py\", line 85, in _run_code\n    exec(code, run_globals)\n  File \"/Users/classic/tmp/alembic_0_7_7/alembic/config.py\", line 442, in <module>\n    main()\n  File \"/Users/classic/tmp/alembic_0_7_7/alembic/config.py\", line 439, in main\n    CommandLine(prog=prog).main(argv=argv)\n  File \"/Users/classic/tmp/alembic_0_7_7/alembic/config.py\", line 433, in main\n    self.run_cmd(cfg, options)\n  File \"/Users/classic/tmp/alembic_0_7_7/alembic/config.py\", line 416, in run_cmd\n    **dict((k, getattr(options, k)) for k in kwarg)\n  File \"/Users/classic/tmp/alembic_0_7_7/alembic/command.py\", line 193, in downgrade\n    script.run_env()\n  File \"/Users/classic/tmp/alembic_0_7_7/alembic/script.py\", line 390, in run_env\n    util.load_python_file(self.dir, 'env.py')\n  File \"/Users/classic/tmp/alembic_0_7_7/alembic/util.py\", line 244, in load_python_file\n    module = load_module_py(module_id, path)\n  File \"/Users/classic/tmp/alembic_0_7_7/alembic/compat.py\", line 68, in load_module_py\n    module_id, path).load_module(module_id)\n  File \"<frozen importlib._bootstrap>\", line 539, in _check_name_wrapper\n  File \"<frozen importlib._bootstrap>\", line 1614, in load_module\n  File \"<frozen importlib._bootstrap>\", line 596, in _load_module_shim\n  File \"<frozen importlib._bootstrap>\", line 1220, in load\n  File \"<frozen importlib._bootstrap>\", line 1200, in _load_unlocked\n  File \"<frozen importlib._bootstrap>\", line 1129, in _exec\n  File \"<frozen importlib._bootstrap>\", line 1471, in exec_module\n  File \"<frozen importlib._bootstrap>\", line 321, in _call_with_frames_removed\n  File \"foo/env.py\", line 70, in <module>\n    run_migrations_online()\n  File \"foo/env.py\", line 65, in run_migrations_online\n    context.run_migrations()\n  File \"<string>\", line 7, in run_migrations\n  File \"/Users/classic/tmp/alembic_0_7_7/alembic/environment.py\", line 738, in run_migrations\n    self.get_context().run_migrations(**kw)\n  File \"/Users/classic/tmp/alembic_0_7_7/alembic/migration.py\", line 302, in run_migrations\n    for step in self._migrations_fn(heads, self):\n  File \"/Users/classic/tmp/alembic_0_7_7/alembic/command.py\", line 182, in downgrade\n    return script._downgrade_revs(revision, rev)\n  File \"/Users/classic/tmp/alembic_0_7_7/alembic/script.py\", line 315, in _downgrade_revs\n    current_rev, destination)\n  File \"/Users/classic/tmp/alembic_0_7_7/alembic/revision.py\", line 512, in iterate_revisions\n    inclusive, assert_relative_length\n  File \"/Users/classic/tmp/alembic_0_7_7/alembic/revision.py\", line 450, in _relative_iterate\n    inclusive=inclusive, implicit_base=implicit_base))\n  File \"/Users/classic/tmp/alembic_0_7_7/alembic/revision.py\", line 672, in _iterate_revisions\n    total_space.remove(rev.revision)\nKeyError: '32f69b44319'\n\n```\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/alembic/issues/314/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/314/timeline","performed_via_github_app":null,"state_reason":"completed"}