{"url":"https://api.github.com/repos/sqlalchemy/alembic/issues/124","repository_url":"https://api.github.com/repos/sqlalchemy/alembic","labels_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/124/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/124/comments","events_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/124/events","html_url":"https://github.com/sqlalchemy/alembic/issues/124","id":384600743,"node_id":"MDU6SXNzdWUzODQ2MDA3NDM=","number":124,"title":"Multiple versions directories","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141242821,"node_id":"MDU6TGFiZWwxMTQxMjQyODIx","url":"https://api.github.com/repos/sqlalchemy/alembic/labels/feature","name":"feature","color":"801010","default":false,"description":null},{"id":1141243687,"node_id":"MDU6TGFiZWwxMTQxMjQzNjg3","url":"https://api.github.com/repos/sqlalchemy/alembic/labels/versioning%20model","name":"versioning model","color":"F06040","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sqlalchemy/alembic/milestones/2","html_url":"https://github.com/sqlalchemy/alembic/milestone/2","labels_url":"https://api.github.com/repos/sqlalchemy/alembic/milestones/2/labels","id":3850498,"node_id":"MDk6TWlsZXN0b25lMzg1MDQ5OA==","number":2,"title":"tier 1","description":null,"creator":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":24,"state":"closed","created_at":"2018-11-27T03:04:06Z","updated_at":"2020-04-10T15:00:48Z","due_on":null,"closed_at":"2020-04-10T15:00:48Z"},"comments":38,"created_at":"2013-05-13T20:43:36Z","updated_at":"2023-07-07T00:41:49Z","closed_at":"2014-11-22T19:58:41Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by Wichert Akkerman ([@wichert](https://github.com/wichert))**\n\nI have a collection of packages, each of which import one or more models that may be used in an application. Each package can require its own migrations, but will may depend on migrations from other packages it depends on as well. I am looking at what it would take to use alembic in this type of environment. I see two basic approaches: manually importing versions, or allowing versions in multiple places.\n\n### Manual importing of versions ###\n\nOne option is to turn the versions directory into a package and import the downgrade and upgrade functions defined there in a version definition of another package. This does not require any changes in alembic\n\n```\nfrom other.package.versions.v3_0 import downgrade as downgrade_other\nfrom other.package.versions.v3_0 import upgrade as upgrade_other\n\ndef upgrade():\n    upgrade_other()\n    # Upgrade logic for this package\n\ndef downgrade():\n    downgrade_other()\n    # Downgrade logic for this package\n```\n\nThis works, but quickly becomes problematic as soon as the dependencies are not completely trivial.\n\n### Versions in multiple places ###\n\nAlembic has an undocumented option allowing you use a dotted path as version location. It should be easy to extend this to allow multiple version directories.\n\n```\n[alembic]\nscript_location =\n    other.package:upgrade\n    other.package2:upgrade\n    my_package:upgrade\n```\n\nYou can then treat each package as a branch to make sure all migration dependencies are handled correctly.\n\nIf you think this approach is workable I can probably whip up a pull request for it.\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/alembic/issues/124/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/alembic/issues/124/timeline","performed_via_github_app":null,"state_reason":"completed"}