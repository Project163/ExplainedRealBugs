diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/MarkSweepGarbageCollector.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/MarkSweepGarbageCollector.java
index 1f582a2fc0..2a4b0f2a5d 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/MarkSweepGarbageCollector.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/MarkSweepGarbageCollector.java
@@ -742,13 +742,8 @@ public class MarkSweepGarbageCollector implements BlobGarbageCollector {
             @Override
             void addMarked(GarbageCollectableBlobStore blobStore, GarbageCollectorFileState fs,
                     String repoId) throws DataStoreException, IOException {
-                InputStream is = new FileInputStream(fs.getMarkedRefs());
-                try {
-                    ((SharedDataStore) blobStore)
-                        .addMetadataRecord(is, SharedStoreRecordType.REFERENCES.getNameFromId(repoId));
-                } finally {
-                    Closeables.close(is, false);
-                }
+                ((SharedDataStore) blobStore)
+                    .addMetadataRecord(fs.getMarkedRefs(), SharedStoreRecordType.REFERENCES.getNameFromId(repoId));
             }
             
             @Override
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/SharedDataStore.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/SharedDataStore.java
index 08e4ce1995..0e4741c3b1 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/SharedDataStore.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/SharedDataStore.java
@@ -16,6 +16,7 @@
  */
 package org.apache.jackrabbit.oak.plugins.blob;
 
+import java.io.File;
 import java.io.InputStream;
 import java.util.Iterator;
 import java.util.List;
@@ -44,6 +45,16 @@ public interface SharedDataStore {
     void addMetadataRecord(InputStream stream, String name)
             throws DataStoreException;
 
+    /**
+     * Adds the root record.
+     *
+     * @param f the file
+     * @param name the name of the root record
+     * @throws DataStoreException the data store exception
+     */
+    void addMetadataRecord(File f, String name)
+        throws DataStoreException;
+
     /**
      * Retrieves the metadata record with the given name
      *
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/DataStoreBlobStore.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/DataStoreBlobStore.java
index d0b35e0eda..239aa34c76 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/DataStoreBlobStore.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/DataStoreBlobStore.java
@@ -426,6 +426,13 @@ public class DataStoreBlobStore implements DataStore, SharedDataStore, BlobStore
         }
     }
 
+    @Override
+    public void addMetadataRecord(File f, String name) throws DataStoreException {
+        if (delegate instanceof SharedDataStore) {
+            ((SharedDataStore) delegate).addMetadataRecord(f, name);
+        }
+    }
+
     @Override public DataRecord getMetadataRecord(String name) {
         if (delegate instanceof SharedDataStore) {
             return ((SharedDataStore) delegate).getMetadataRecord(name);
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/OakFileDataStore.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/OakFileDataStore.java
index 108b220942..8419c6764c 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/OakFileDataStore.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/OakFileDataStore.java
@@ -38,6 +38,7 @@ import com.google.common.io.BaseEncoding;
 import com.google.common.io.Closeables;
 import com.google.common.io.Files;
 
+import org.apache.commons.io.FileUtils;
 import org.apache.commons.io.IOUtils;
 import org.apache.commons.io.filefilter.FileFilterUtils;
 import org.apache.jackrabbit.core.data.DataIdentifier;
@@ -150,12 +151,24 @@ public class OakFileDataStore extends FileDataStore implements SharedDataStore {
                 Closeables.close(input, true);
             }
         } catch (IOException e) {
-            LOG.error("Exception while adding root record with name {}, {}",
+            LOG.error("Exception while adding metadata record with name {}, {}",
                     new Object[] {name, e});
             throw new DataStoreException("Could not add root record", e);
         }
     }
 
+    @Override
+    public void addMetadataRecord(File input, String name) throws DataStoreException {
+        try {
+            File file = new File(getPath(), name);
+            FileUtils.copyFile(input, file);
+        } catch (IOException e) {
+            LOG.error("Exception while adding metadata record file {} with name {}, {}",
+                new Object[] {input, name, e});
+            throw new DataStoreException("Could not add root record", e);
+        }
+    }
+
     @Override
     public DataRecord getMetadataRecord(String name) {
         File root = new File(getPath());
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/SharedS3DataStore.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/SharedS3DataStore.java
index 15aa9adb7b..c1534ecaa1 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/SharedS3DataStore.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/SharedS3DataStore.java
@@ -25,6 +25,7 @@ import org.apache.jackrabbit.oak.blob.cloud.aws.s3.S3Backend;
 import org.apache.jackrabbit.oak.blob.cloud.aws.s3.S3DataStore;
 import org.apache.jackrabbit.oak.plugins.blob.SharedDataStore;
 
+import java.io.File;
 import java.io.InputStream;
 import java.util.Iterator;
 import java.util.List;
@@ -49,6 +50,11 @@ public class SharedS3DataStore extends S3DataStore implements SharedDataStore {
         backend.addMetadataRecord(stream, name);
     }
 
+    @Override
+    public void addMetadataRecord(File f, String name) throws DataStoreException {
+        backend.addMetadataRecord(f, name);
+    }
+
     @Override
     public DataRecord getMetadataRecord(String name) {
         return backend.getMetadataRecord(name);
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/SharedDataStoreUtilsTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/SharedDataStoreUtilsTest.java
index a1128139fa..ab267229e2 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/SharedDataStoreUtilsTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/SharedDataStoreUtilsTest.java
@@ -26,6 +26,7 @@ import static org.hamcrest.CoreMatchers.instanceOf;
 
 import java.io.ByteArrayInputStream;
 import java.io.File;
+import java.io.FileInputStream;
 import java.io.IOException;
 import java.io.InputStream;
 import java.util.Date;
@@ -38,10 +39,12 @@ import javax.annotation.Nullable;
 
 import com.google.common.base.Function;
 import com.google.common.collect.Iterables;
+import com.google.common.collect.Sets;
 import junit.framework.Assert;
 
 import org.apache.commons.io.FileUtils;
 import org.apache.jackrabbit.core.data.DataRecord;
+import org.apache.jackrabbit.oak.commons.FileIOUtils;
 import org.apache.jackrabbit.oak.plugins.blob.datastore.DataStoreBlobStore;
 import org.apache.jackrabbit.oak.plugins.blob.datastore.SharedDataStoreUtils;
 import org.apache.jackrabbit.oak.plugins.blob.datastore.SharedDataStoreUtils.SharedStoreRecordType;
@@ -49,7 +52,9 @@ import org.apache.jackrabbit.oak.plugins.blob.datastore.DataStoreUtils;
 import org.junit.After;
 import org.junit.Assume;
 import org.junit.BeforeClass;
+import org.junit.Rule;
 import org.junit.Test;
+import org.junit.rules.TemporaryFolder;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -59,6 +64,9 @@ import org.slf4j.LoggerFactory;
 public class SharedDataStoreUtilsTest {
     private static final Logger log = LoggerFactory.getLogger(SharedDataStoreUtilsTest.class);
 
+    @Rule
+    public TemporaryFolder folder = new TemporaryFolder(new File("target"));
+
     DataStoreBlobStore dataStore;
 
     @BeforeClass
@@ -149,6 +157,32 @@ public class SharedDataStoreUtilsTest {
             dataStore.getAllMetadataRecords(SharedStoreRecordType.REPOSITORY.getType()).size());
     }
 
+    @Test
+    public void testAddMetadata() throws Exception {
+        dataStore = getBlobStore();
+        String repoId = UUID.randomUUID().toString();
+        Set<String> refs = Sets.newHashSet("1_1", "1_2");
+        File f = folder.newFile();
+        FileIOUtils.writeStrings(refs.iterator(), f, false);
+
+        dataStore.addMetadataRecord(new FileInputStream(f),
+            SharedStoreRecordType.REFERENCES.getNameFromId(repoId));
+        DataRecord rec = dataStore.getMetadataRecord(SharedStoreRecordType.REFERENCES.getNameFromId(repoId));
+        Set<String> refsReturned = FileIOUtils.readStringsAsSet(rec.getStream(), false);
+        Assert.assertEquals(refs, refsReturned);
+        dataStore.deleteAllMetadataRecords(SharedStoreRecordType.REFERENCES.getType());
+
+        dataStore.addMetadataRecord(f,
+            SharedStoreRecordType.REFERENCES.getNameFromId(repoId));
+        rec = dataStore.getMetadataRecord(SharedStoreRecordType.REFERENCES.getNameFromId(repoId));
+        refsReturned = FileIOUtils.readStringsAsSet(rec.getStream(), false);
+        Assert.assertEquals(refs, refsReturned);
+        assertEquals(
+            SharedStoreRecordType.REFERENCES.getIdFromName(rec.getIdentifier().toString()),
+            repoId);
+        dataStore.deleteAllMetadataRecords(SharedStoreRecordType.REFERENCES.getType());
+    }
+
     @Test
     public void testGetAllChunkIds() throws Exception {
         dataStore = getBlobStore();
