diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/migration/BlobMigrator.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/migration/BlobMigrator.java
index 5532915739..2c76e951ed 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/migration/BlobMigrator.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/migration/BlobMigrator.java
@@ -24,6 +24,7 @@ import java.util.ArrayList;
 import java.util.List;
 import java.util.concurrent.atomic.AtomicBoolean;
 
+import org.apache.commons.codec.digest.DigestUtils;
 import org.apache.jackrabbit.oak.api.Blob;
 import org.apache.jackrabbit.oak.api.CommitFailedException;
 import org.apache.jackrabbit.oak.api.PropertyState;
@@ -176,7 +177,7 @@ public class BlobMigrator {
 
     private PropertyState migrateProperty(PropertyState propertyState) throws IOException {
         Blob oldBlob = propertyState.getValue(Type.BINARY);
-        String blobId = oldBlob.getContentIdentity();
+        String blobId = getIdentity(oldBlob);
         if (blobStore.isMigrated(blobId)) {
             return null;
         }
@@ -196,7 +197,7 @@ public class BlobMigrator {
         builder.assignFrom(propertyState);
         boolean blobUpdated = false;
         for (Blob oldBlob : oldBlobs) {
-            String blobId = oldBlob.getContentIdentity();
+            String blobId = getIdentity(oldBlob);
             if (blobStore.isMigrated(blobId)) {
                 newBlobs.add(new BlobStoreBlob(blobStore, blobId));
             } else {
@@ -213,4 +214,12 @@ public class BlobMigrator {
             return null;
         }
     }
+
+    private String getIdentity(Blob blob) throws IOException {
+        String id = blob.getContentIdentity();
+        if (id == null) {
+            id = DigestUtils.shaHex(blob.getNewStream());
+        }
+        return id;
+    }
 }
\ No newline at end of file
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/migration/AbstractMigratorTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/migration/AbstractMigratorTest.java
index 50adb75c66..4800a2304c 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/migration/AbstractMigratorTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/migration/AbstractMigratorTest.java
@@ -91,7 +91,6 @@ public abstract class AbstractMigratorTest {
     }
 
     @Test
-    @Ignore("OAK-5009")
     public void blobsExistsOnTheNewBlobStore() throws IOException, CommitFailedException {
         migrator.migrate();
         NodeState root = nodeStore.getRoot();
@@ -101,7 +100,6 @@ public abstract class AbstractMigratorTest {
     }
 
     @Test
-    @Ignore("OAK-5009")
     public void blobsCanBeReadAfterSwitchingBlobStore() throws IOException, CommitFailedException {
         migrator.migrate();
         closeNodeStore();
