diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentMK.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentMK.java
index dd20f3a9c9..4e14f428d6 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentMK.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentMK.java
@@ -55,7 +55,7 @@ public class DocumentMK implements MicroKernel {
      * The threshold where special handling for many child node starts.
      */
     static final int MANY_CHILDREN_THRESHOLD = Integer.getInteger(
-            "oak.documentMK.manyChildren", 50);
+            "oak.documentMK.manyChildren", 10);
     
     /**
      * Enable the LIRS cache.
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentNodeState.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentNodeState.java
index b3d3fc2278..64a1eb8fee 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentNodeState.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentNodeState.java
@@ -52,6 +52,7 @@ import com.google.common.collect.Iterators;
 import com.google.common.collect.Maps;
 
 import static com.google.common.base.Preconditions.checkNotNull;
+import static org.apache.jackrabbit.oak.plugins.document.DocumentMK.MANY_CHILDREN_THRESHOLD;
 import static org.apache.jackrabbit.oak.plugins.memory.EmptyNodeState.EMPTY_NODE;
 
 /**
@@ -71,12 +72,6 @@ class DocumentNodeState extends AbstractNodeState implements CacheValue {
      */
     static final int MAX_FETCH_SIZE = INITIAL_FETCH_SIZE << 4;
 
-    /**
-     * Number of child nodes beyond which {@link DocumentNodeStore#}
-     * is used for diffing.
-     */
-    public static final int LOCAL_DIFF_THRESHOLD = 10;
-
     private final DocumentNodeStore store;
 
     final String path;
@@ -246,7 +241,7 @@ class DocumentNodeState extends AbstractNodeState implements CacheValue {
                     if (lastRevision.equals(mBase.lastRevision)) {
                         // no differences
                         return true;
-                    } else if (getChildNodeCount(LOCAL_DIFF_THRESHOLD) > LOCAL_DIFF_THRESHOLD) {
+                    } else if (getChildNodeCount(MANY_CHILDREN_THRESHOLD) > MANY_CHILDREN_THRESHOLD) {
                         // use DocumentNodeStore compare when there are many children
                         return dispatch(store.diffChildren(this, mBase), mBase, diff);
                     }
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/NodeDocument.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/NodeDocument.java
index ee8d4349b8..f0e80adeff 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/NodeDocument.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/NodeDocument.java
@@ -55,7 +55,7 @@ import static org.apache.jackrabbit.oak.plugins.document.UpdateOp.Operation;
 /**
  * A document storing data about a node.
  */
-public class NodeDocument extends Document implements CachedNodeDocument{
+final public class NodeDocument extends Document implements CachedNodeDocument{
 
     /**
      * Marker document, which indicates the document does not exist.
@@ -361,10 +361,6 @@ public class NodeDocument extends Document implements CachedNodeDocument{
         // check local map first
         Map<Revision, String> local = getLocalCommitRoot();
         String depth = local.get(revision);
-        if (depth == null) {
-            // check full map
-            depth = getCommitRoot().get(revision);
-        }
         if (depth != null) {
             if (depth.equals("0")) {
                 return "/";
@@ -372,9 +368,15 @@ public class NodeDocument extends Document implements CachedNodeDocument{
             String p = Utils.getPathFromId(getId());
             return PathUtils.getAncestorPath(p,
                     PathUtils.getDepth(p) - Integer.parseInt(depth));
-        } else {
-            return null;
         }
+        // check previous
+        for (NodeDocument prev : getPreviousDocs(COMMIT_ROOT, revision)) {
+            String path = prev.getCommitRootPath(revision);
+            if (path != null) {
+                return path;
+            }
+        }
+        return null;
     }
 
     /**
@@ -826,7 +828,7 @@ public class NodeDocument extends Document implements CachedNodeDocument{
     @Nonnull
     SortedMap<Revision, String> getLocalMap(String key) {
         @SuppressWarnings("unchecked")
-        SortedMap<Revision, String> map = (SortedMap<Revision, String>) get(key);
+        SortedMap<Revision, String> map = (SortedMap<Revision, String>) data.get(key);
         if (map == null) {
             map = ValueMap.EMPTY;
         }
@@ -1095,6 +1097,11 @@ public class NodeDocument extends Document implements CachedNodeDocument{
         Revision latestRev = null;
         for (Map.Entry<Revision, String> entry : valueMap.entrySet()) {
             Revision propRev = entry.getKey();
+            // ignore revisions newer than readRevision
+            // -> these are not visible anyway
+            if (isRevisionNewer(context, propRev, readRevision)) {
+                continue;
+            }
             // resolve revision
             NodeDocument commitRoot = getCommitRoot(propRev);
             if (commitRoot == null) {
