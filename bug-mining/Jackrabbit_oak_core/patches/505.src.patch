diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/core/AbstractRoot.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/core/AbstractRoot.java
index f3bfe31253..f683508834 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/core/AbstractRoot.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/core/AbstractRoot.java
@@ -328,15 +328,12 @@ public abstract class AbstractRoot implements Root {
         return new QueryEngineImpl() {
             @Override
             protected ExecutionContext getExecutionContext() {
-                NodeState rootState = AbstractRoot.this.getRootState();
-                return new ExecutionContext(rootState, rootTree, getIndexProvider(rootState));
-            }
-
-            private QueryIndexProvider getIndexProvider(NodeState rootState) {
+                QueryIndexProvider provider = indexProvider;
                 if (hasPendingChanges()) {
-                    return new UUIDDiffIndexProviderWrapper(indexProvider, getBaseState(), rootState);
+                    provider = new UUIDDiffIndexProviderWrapper(
+                            provider, getBaseState(), getRootState());
                 }
-                return indexProvider;
+                return new ExecutionContext(getBaseState(), rootTree, provider);
             }
         };
     }
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/query/index/TraversingIndexQueryTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/query/index/TraversingIndexQueryTest.java
index 6c5322c5e8..e8ecf1ba57 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/query/index/TraversingIndexQueryTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/query/index/TraversingIndexQueryTest.java
@@ -52,6 +52,7 @@ public class TraversingIndexQueryTest extends AbstractQueryTest {
         //OAK-1024 allow '/' in a full-text query 
         Tree node = root.getTree("/").addChild("content");
         node.setProperty("jcr:mimeType", "text/plain");
+        root.commit();
         assertQuery("//*[jcr:contains(., 'text/plain')]", "xpath",
                 ImmutableList.of("/content"));
     }
@@ -61,6 +62,7 @@ public class TraversingIndexQueryTest extends AbstractQueryTest {
         Tree c = root.getTree("/").addChild("content");
         c.addChild("testFullTextTermNameSimple");
         c.addChild("testFullTextTermNameFile.txt");
+        root.commit();
         assertQuery("//*[jcr:contains(., 'testFullTextTermNameSimple')]",
                 "xpath",
                 ImmutableList.of("/content/testFullTextTermNameSimple"));
