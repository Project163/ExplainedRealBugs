diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/Segment.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/Segment.java
index b5475ed205..07e4676cb5 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/Segment.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/Segment.java
@@ -188,6 +188,14 @@ public class Segment {
     }
 
     SegmentId getRefId(int index) {
+        if (refids == null || index >= refids.length) {
+            String type = "data";
+            if (!id.isDataSegmentId()) {
+                type = "bulk";
+            }
+            throw new IllegalStateException("RefId '" + index
+                    + "' doesn't exist in " + type + " segment " + id);
+        }
         SegmentId refid = refids[index];
         if (refid == null) {
             synchronized (this) {
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentWriter.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentWriter.java
index d25e8379fc..84ac11a4bb 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentWriter.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentWriter.java
@@ -87,7 +87,7 @@ public class SegmentWriter {
 
     static final int BLOCK_SIZE = 1 << 12; // 4kB
 
-    private static byte[] createNewBuffer() {
+    static byte[] createNewBuffer() {
         byte[] buffer = new byte[Segment.MAX_SEGMENT_SIZE];
         buffer[0] = '0';
         buffer[1] = 'a';
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/segment/SegmentIdFactoryTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/segment/SegmentIdFactoryTest.java
index 3cd19e8ba6..e20a6ba832 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/segment/SegmentIdFactoryTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/segment/SegmentIdFactoryTest.java
@@ -19,8 +19,8 @@ package org.apache.jackrabbit.oak.plugins.segment;
 import static junit.framework.Assert.assertFalse;
 import static junit.framework.Assert.assertTrue;
 
+import java.nio.ByteBuffer;
 import java.util.Set;
-import java.util.UUID;
 
 import org.apache.jackrabbit.oak.plugins.segment.memory.MemoryStore;
 import org.junit.Test;
@@ -84,4 +84,29 @@ public class SegmentIdFactoryTest {
         assertTrue(ids.contains(b));
     }
 
+    /**
+     * OAK-2049 - error for data segments
+     */
+    @Test(expected = IllegalStateException.class)
+    public void dataAIOOBE() {
+        SegmentId id = factory.newDataSegmentId();
+        byte[] buffer = SegmentWriter.createNewBuffer();
+        ByteBuffer data = ByteBuffer.allocate(Segment.MAX_SEGMENT_SIZE);
+        data.put(buffer);
+        data.rewind();
+        Segment s = new Segment(factory, id, data);
+        s.getRefId(1);
+    }
+
+    /**
+     * OAK-2049 - error for bulk segments
+     */
+    @Test(expected = IllegalStateException.class)
+    public void bulkAIOOBE() {
+        SegmentId id = factory.newBulkSegmentId();
+        ByteBuffer data = ByteBuffer.allocate(4);
+        Segment s = new Segment(factory, id, data);
+        s.getRefId(1);
+    }
+
 }
