diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/identifier/IdentifierManager.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/identifier/IdentifierManager.java
index c5a562e313..31ed6d346e 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/identifier/IdentifierManager.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/identifier/IdentifierManager.java
@@ -16,19 +16,11 @@
  */
 package org.apache.jackrabbit.oak.plugins.identifier;
 
-import static com.google.common.base.Preconditions.checkArgument;
-import static com.google.common.base.Predicates.notNull;
-import static com.google.common.collect.Iterators.emptyIterator;
-import static com.google.common.collect.Iterators.filter;
-import static com.google.common.collect.Iterators.singletonIterator;
-import static com.google.common.collect.Iterators.transform;
-
 import java.text.ParseException;
 import java.util.Collections;
 import java.util.Iterator;
 import java.util.Map;
 import java.util.UUID;
-
 import javax.annotation.CheckForNull;
 import javax.annotation.Nonnull;
 import javax.jcr.PropertyType;
@@ -54,6 +46,13 @@ import org.apache.jackrabbit.oak.spi.query.PropertyValues;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
+import static com.google.common.base.Preconditions.checkArgument;
+import static com.google.common.base.Predicates.notNull;
+import static com.google.common.collect.Iterators.emptyIterator;
+import static com.google.common.collect.Iterators.filter;
+import static com.google.common.collect.Iterators.singletonIterator;
+import static com.google.common.collect.Iterators.transform;
+
 /**
  * TODO document
  */
@@ -171,6 +170,24 @@ public class IdentifierManager {
         }
     }
 
+    /**
+     * Returns the path of the tree references by the specified (weak)
+     * reference {@code PropertyState}.
+     *
+     * @param referenceValue A (weak) reference value.
+     * @return The tree with the given {@code identifier} or {@code null} if no
+     *         such tree exists or isn't accessible to the content session.
+     */
+    @CheckForNull
+    public String getPath(PropertyValue referenceValue) {
+        int type = referenceValue.getType().tag();
+        if (type == PropertyType.REFERENCE || type == PropertyType.WEAKREFERENCE) {
+            return resolveUUID(referenceValue);
+        } else {
+            throw new IllegalArgumentException("Invalid value type");
+        }
+    }
+
     /**
      * Searches all reference properties to the specified {@code tree} that match
      * the given name and node type constraints.
@@ -274,8 +291,12 @@ public class IdentifierManager {
     }
 
     private String resolveUUID(PropertyState uuid) {
+        return resolveUUID(PropertyValues.create(uuid));
+    }
+
+    private String resolveUUID(PropertyValue uuid) {
         try {
-            Map<String, PropertyValue> bindings = Collections.singletonMap("id", PropertyValues.create(uuid));
+            Map<String, PropertyValue> bindings = Collections.singletonMap("id", uuid);
             Result result = root.getQueryEngine().executeQuery(
                     "SELECT * FROM [nt:base] WHERE [jcr:uuid] = $id", Query.JCR_SQL2,
                     Long.MAX_VALUE, 0, bindings, new NamePathMapper.Default());
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/GroupImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/GroupImpl.java
index 6c1ba3f730..4c774742df 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/GroupImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/GroupImpl.java
@@ -191,7 +191,7 @@ class GroupImpl extends AuthorizableImpl implements Group {
                     }
             );
         } else {
-            Iterator oakPaths = getMembershipProvider().getMembers(getTree(), AuthorizableType.AUTHORIZABLE, includeInherited);
+            Iterator<String> oakPaths = getMembershipProvider().getMembers(getTree(), AuthorizableType.AUTHORIZABLE, includeInherited);
             if (oakPaths.hasNext()) {
                 AuthorizableIterator iterator = AuthorizableIterator.create(oakPaths, userMgr, AuthorizableType.AUTHORIZABLE);
                 return new RangeIteratorAdapter(iterator, iterator.getSize());
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/MembershipProvider.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/MembershipProvider.java
index 3ef6079fa6..45e111411d 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/MembershipProvider.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/MembershipProvider.java
@@ -28,7 +28,7 @@ import org.apache.jackrabbit.oak.api.PropertyState;
 import org.apache.jackrabbit.oak.api.Root;
 import org.apache.jackrabbit.oak.api.Tree;
 import org.apache.jackrabbit.oak.api.Type;
-import org.apache.jackrabbit.oak.plugins.memory.PropertyStates;
+import org.apache.jackrabbit.oak.spi.query.PropertyValues;
 import org.apache.jackrabbit.oak.spi.security.ConfigurationParameters;
 import org.apache.jackrabbit.oak.spi.security.user.AuthorizableType;
 import org.apache.jackrabbit.oak.spi.security.user.util.UserUtil;
@@ -263,10 +263,10 @@ class MembershipProvider extends AuthorizableBaseProvider {
                         break;
                     } else {
                         String value = references.next();
-                        next = identifierManager.getPath(PropertyStates.createProperty("", value, Type.WEAKREFERENCE));
+                        next = identifierManager.getPath(PropertyValues.newWeakReference(value));
 
                         // filter by authorizable type, and/or get inherited members
-                        if (includeInherited || authorizableType != AuthorizableType.AUTHORIZABLE) {
+                        if (next != null && (includeInherited || authorizableType != AuthorizableType.AUTHORIZABLE)) {
                             Tree auth = getByPath(next);
                             AuthorizableType type = UserUtil.getType(auth);
 
