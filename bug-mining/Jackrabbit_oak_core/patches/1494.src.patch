diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/SharedDataStore.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/SharedDataStore.java
index dfd7df9b4b..f23c321d68 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/SharedDataStore.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/SharedDataStore.java
@@ -17,6 +17,7 @@
 package org.apache.jackrabbit.oak.plugins.blob;
 
 import java.io.InputStream;
+import java.util.Iterator;
 import java.util.List;
 
 import org.apache.jackrabbit.core.data.DataRecord;
@@ -73,6 +74,13 @@ public interface SharedDataStore {
      */
     void deleteAllMetadataRecords(String prefix);
 
+    /**
+     * Retrieved an iterator over all DataRecords.
+     *
+     * @return iterator over DataRecords
+     */
+    Iterator<DataRecord> getAllRecords();
+
     /**
      * Gets the type.
      * 
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/DataStoreBlobStore.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/DataStoreBlobStore.java
index e30b98b1b1..dff4355098 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/DataStoreBlobStore.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/DataStoreBlobStore.java
@@ -364,18 +364,7 @@ public class DataStoreBlobStore implements DataStore, SharedDataStore, BlobStore
 
     @Override
     public Iterator<String> getAllChunkIds(final long maxLastModifiedTime) throws Exception {
-        return transform(filter(transform(delegate.getAllIdentifiers(), new Function<DataIdentifier, DataRecord>() {
-            @Nullable
-            @Override
-            public DataRecord apply(@Nullable DataIdentifier input) {
-                try {
-                    return delegate.getRecord(input);
-                } catch (DataStoreException e) {
-                    log.warn("Error occurred while fetching DataRecord for identifier {}", input, e);
-                }
-                return null;
-            }
-        }), new Predicate<DataRecord>() {
+        return transform(filter(getAllRecords(), new Predicate<DataRecord>() {
             @Override
             public boolean apply(@Nullable DataRecord input) {
                 if (input != null && (maxLastModifiedTime <= 0
@@ -464,6 +453,14 @@ public class DataStoreBlobStore implements DataStore, SharedDataStore, BlobStore
         }
     }
 
+    @Override
+    public Iterator<DataRecord> getAllRecords() {
+        if (delegate instanceof SharedDataStore) {
+            return ((SharedDataStore) delegate).getAllRecords();
+        }
+        return Iterators.emptyIterator();
+    }
+
     @Override
     public Type getType() {
         if (delegate instanceof SharedDataStore) {
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/OakFileDataStore.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/OakFileDataStore.java
index 5e8688161d..108b220942 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/OakFileDataStore.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/OakFileDataStore.java
@@ -217,6 +217,26 @@ public class OakFileDataStore extends FileDataStore implements SharedDataStore {
         }
     }
 
+    @Override
+    public Iterator<DataRecord> getAllRecords() {
+        final String path = normalizeNoEndSeparator(getPath());
+        final OakFileDataStore store = this;
+        return Files.fileTreeTraverser().postOrderTraversal(new File(getPath()))
+            .filter(new Predicate<File>() {
+                @Override
+                public boolean apply(File input) {
+                    return input.isFile() &&
+                        !normalizeNoEndSeparator(input.getParent()).equals(path);
+                }
+            })
+            .transform(new Function<File, DataRecord>() {
+                @Override
+                public DataRecord apply(File input) {
+                    return new FileDataRecord(store, new DataIdentifier(input.getName()), input);
+                }
+            }).iterator();
+    }
+
     @Override
     public Type getType() {
         return Type.SHARED;
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/SharedS3DataStore.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/SharedS3DataStore.java
index 774503d464..15aa9adb7b 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/SharedS3DataStore.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/blob/datastore/SharedS3DataStore.java
@@ -26,6 +26,7 @@ import org.apache.jackrabbit.oak.blob.cloud.aws.s3.S3DataStore;
 import org.apache.jackrabbit.oak.plugins.blob.SharedDataStore;
 
 import java.io.InputStream;
+import java.util.Iterator;
 import java.util.List;
 
 /**
@@ -68,6 +69,11 @@ public class SharedS3DataStore extends S3DataStore implements SharedDataStore {
         backend.deleteAllMetadataRecords(prefix);
     }
 
+    @Override
+    public Iterator<DataRecord> getAllRecords() {
+        return backend.getAllRecords();
+    }
+
     @Override
     public Type getType() {
         return Type.SHARED;
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/SharedDataStoreUtilsTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/SharedDataStoreUtilsTest.java
index bc7d2d413d..a1128139fa 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/SharedDataStoreUtilsTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/SharedDataStoreUtilsTest.java
@@ -18,37 +18,53 @@
  */
 package org.apache.jackrabbit.oak.plugins.blob;
 
+import static com.google.common.collect.Sets.newHashSet;
+import static junit.framework.Assert.assertEquals;
+import static org.apache.jackrabbit.oak.plugins.blob.datastore.DataStoreUtils.cleanup;
+import static org.apache.jackrabbit.oak.plugins.blob.datastore.DataStoreUtils.getBlobStore;
 import static org.hamcrest.CoreMatchers.instanceOf;
 
 import java.io.ByteArrayInputStream;
 import java.io.File;
 import java.io.IOException;
+import java.io.InputStream;
+import java.util.Date;
+import java.util.Random;
+import java.util.Set;
 import java.util.UUID;
 import java.util.concurrent.TimeUnit;
 
+import javax.annotation.Nullable;
+
+import com.google.common.base.Function;
+import com.google.common.collect.Iterables;
 import junit.framework.Assert;
 
 import org.apache.commons.io.FileUtils;
 import org.apache.jackrabbit.core.data.DataRecord;
+import org.apache.jackrabbit.oak.plugins.blob.datastore.DataStoreBlobStore;
 import org.apache.jackrabbit.oak.plugins.blob.datastore.SharedDataStoreUtils;
 import org.apache.jackrabbit.oak.plugins.blob.datastore.SharedDataStoreUtils.SharedStoreRecordType;
 import org.apache.jackrabbit.oak.plugins.blob.datastore.DataStoreUtils;
 import org.junit.After;
 import org.junit.Assume;
 import org.junit.BeforeClass;
-import org.junit.Ignore;
 import org.junit.Test;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
 
 /**
  * Test for SharedDataUtils to test addition, retrieval and deletion of root records.
  */
 public class SharedDataStoreUtilsTest {
-    SharedDataStore dataStore;
+    private static final Logger log = LoggerFactory.getLogger(SharedDataStoreUtilsTest.class);
+
+    DataStoreBlobStore dataStore;
 
     @BeforeClass
     public static void setUpBeforeClass() throws Exception {
         try {
-            Assume.assumeThat(DataStoreUtils.getBlobStore(), instanceOf(SharedDataStore.class));
+            Assume.assumeThat(getBlobStore(), instanceOf(SharedDataStore.class));
         } catch (Exception e) {
             Assume.assumeNoException(e);
         }
@@ -56,7 +72,7 @@ public class SharedDataStoreUtilsTest {
 
     @Test
     public void test() throws Exception {
-        dataStore = DataStoreUtils.getBlobStore();
+        dataStore = getBlobStore();
         String repoId1 = UUID.randomUUID().toString();
         String repoId2 = UUID.randomUUID().toString();
 
@@ -72,7 +88,7 @@ public class SharedDataStoreUtilsTest {
         dataStore.addMetadataRecord(new ByteArrayInputStream(new byte[0]),
                                        SharedStoreRecordType.MARKED_START_MARKER.getNameFromId(repoId1));
         DataRecord markerRec1 = dataStore.getMetadataRecord(SharedStoreRecordType.MARKED_START_MARKER.getNameFromId(repoId1));
-        Assert.assertEquals(
+        assertEquals(
                SharedStoreRecordType.MARKED_START_MARKER.getIdFromName(markerRec1.getIdentifier().toString()),
                repoId1);
         long lastModifiedMarkerRec1 = markerRec1.getLastModified();
@@ -89,14 +105,14 @@ public class SharedDataStoreUtilsTest {
         DataRecord rec2 = dataStore.getMetadataRecord(SharedStoreRecordType.REFERENCES.getNameFromId(repoId2));
         long lastModifiedRec2 = rec2.getLastModified();
 
-        Assert.assertEquals(SharedStoreRecordType.REPOSITORY.getIdFromName(repo1.getIdentifier().toString()), repoId1);
-        Assert.assertEquals(
+        assertEquals(SharedStoreRecordType.REPOSITORY.getIdFromName(repo1.getIdentifier().toString()), repoId1);
+        assertEquals(
                 SharedStoreRecordType.REPOSITORY.getIdFromName(repo2.getIdentifier().toString()),
                 repoId2);
-        Assert.assertEquals(
+        assertEquals(
                 SharedStoreRecordType.REFERENCES.getIdFromName(rec1.getIdentifier().toString()),
                 repoId1);
-        Assert.assertEquals(
+        assertEquals(
                 SharedStoreRecordType.REFERENCES.getIdFromName(rec2.getIdentifier().toString()),
                 repoId2);
 
@@ -108,7 +124,7 @@ public class SharedDataStoreUtilsTest {
         // Since, we don't care about which file specifically but only the earliest timestamped record
         // Earliest time should be the min timestamp from the 2 reference files
         long minRefTime = (lastModifiedRec1 <= lastModifiedRec2 ? lastModifiedRec1 : lastModifiedRec2);
-        Assert.assertEquals(
+        assertEquals(
                SharedDataStoreUtils.getEarliestRecord(
                         dataStore.getAllMetadataRecords(SharedStoreRecordType.REFERENCES.getType())).getLastModified(), 
                         minRefTime);
@@ -129,13 +145,59 @@ public class SharedDataStoreUtilsTest {
         Assert.assertTrue(dataStore.getAllMetadataRecords(SharedStoreRecordType.MARKED_START_MARKER.getType()).isEmpty());
     
         // Repository ids should still be available
-        Assert.assertEquals(2,
+        assertEquals(2,
             dataStore.getAllMetadataRecords(SharedStoreRecordType.REPOSITORY.getType()).size());
     }
 
+    @Test
+    public void testGetAllChunkIds() throws Exception {
+        dataStore = getBlobStore();
+        int number = 1010;
+        Set<String> added = newHashSet();
+        for (int i = 0; i < number; i++) {
+            String rec = dataStore.writeBlob(randomStream(i, 16516));
+            added.add(rec);
+        }
+
+        Set<String> retrieved = newHashSet(dataStore.getAllChunkIds(0));
+        assertEquals(added, retrieved);
+    }
+
+    @Test
+    public void testGetAllRecords() throws Exception {
+        dataStore = getBlobStore();
+        int number = 1010;
+        Set<String> added = newHashSet();
+        for (int i = 0; i < number; i++) {
+            String rec = dataStore.addRecord(randomStream(i, 16516))
+                .getIdentifier().toString();
+            added.add(rec);
+        }
+
+        Set<String> retrieved = newHashSet(Iterables.transform(newHashSet(dataStore.getAllRecords()),
+            new Function<DataRecord, String>() {
+                @Nullable @Override public String apply(@Nullable DataRecord input) {
+                    return input.getIdentifier().toString();
+                }
+            }));
+        assertEquals(added, retrieved);
+    }
+
+    static InputStream randomStream(int seed, int size) {
+        Random r = new Random(seed);
+        byte[] data = new byte[size];
+        r.nextBytes(data);
+        return new ByteArrayInputStream(data);
+    }
+
     @After
     public void close() throws IOException {
         FileUtils.cleanDirectory(new File(DataStoreUtils.getHomeDir()));
+        try {
+            cleanup(dataStore.getDataStore(), new Date());
+        } catch (Exception e) {
+            log.error("Error closing data store", e);
+        }
     }
 }
 
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/datastore/DataStoreBlobStoreTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/datastore/DataStoreBlobStoreTest.java
index 4003f22883..0b0899961b 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/datastore/DataStoreBlobStoreTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/datastore/DataStoreBlobStoreTest.java
@@ -28,7 +28,12 @@ import java.util.List;
 import java.util.Random;
 import java.util.Set;
 
+import javax.annotation.Nullable;
+
+import com.google.common.base.Function;
 import com.google.common.collect.ImmutableList;
+import com.google.common.collect.Iterables;
+import com.google.common.collect.Lists;
 import com.google.common.collect.Sets;
 import org.apache.commons.io.FileUtils;
 import org.apache.commons.io.IOUtils;
@@ -38,6 +43,7 @@ import org.apache.jackrabbit.core.data.DataStore;
 import org.apache.jackrabbit.core.data.DataStoreException;
 import org.apache.jackrabbit.oak.spi.blob.AbstractBlobStoreTest;
 import org.apache.jackrabbit.oak.spi.blob.BlobStoreInputStream;
+import org.apache.jackrabbit.oak.spi.blob.GarbageCollectableBlobStore;
 import org.apache.jackrabbit.oak.spi.blob.stats.BlobStatsCollector;
 import org.junit.After;
 import org.junit.Before;
@@ -159,9 +165,16 @@ public class DataStoreBlobStoreTest extends AbstractBlobStoreTest {
         DataIdentifier d20 = new DataIdentifier("d-20");
         DataIdentifier d30 = new DataIdentifier("d-30");
         List<DataIdentifier> dis = ImmutableList.of(d10, d20, d30);
-
-        DataStore mockedDS = mock(DataStore.class);
-        when(mockedDS.getAllIdentifiers()).thenReturn(dis.iterator());
+        List<DataRecord> recs = Lists.newArrayList(
+            Iterables.transform(dis, new Function<DataIdentifier, DataRecord>() {
+                @Nullable
+                @Override
+                public DataRecord apply(@Nullable DataIdentifier input) {
+                    return new TimeDataRecord(input);
+                }
+        }));
+        OakFileDataStore mockedDS = mock(OakFileDataStore.class);
+        when(mockedDS.getAllRecords()).thenReturn(recs.iterator());
         when(mockedDS.getRecord(new DataIdentifier("d-10"))).thenReturn(new TimeDataRecord(d10));
         when(mockedDS.getRecord(new DataIdentifier("d-20"))).thenReturn(new TimeDataRecord(d20));
         when(mockedDS.getRecord(new DataIdentifier("d-30"))).thenReturn(new TimeDataRecord(d30));
@@ -170,7 +183,6 @@ public class DataStoreBlobStoreTest extends AbstractBlobStoreTest {
         Iterator<String> chunks = ds.getAllChunkIds(25);
         Set<String> expected = Sets.newHashSet("d-10","d-20");
         assertEquals(expected, Sets.newHashSet(chunks));
-
     }
 
     @Test
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/datastore/DataStoreUtils.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/datastore/DataStoreUtils.java
index 42938d1fb5..89cfb214e8 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/datastore/DataStoreUtils.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/blob/datastore/DataStoreUtils.java
@@ -105,7 +105,7 @@ public class DataStoreUtils {
     }
 
     public static FileDataStore createFDS(File root, int minRecordLength) {
-        FileDataStore fds = new FileDataStore();
+        OakFileDataStore fds = new OakFileDataStore();
         fds.setPath(root.getAbsolutePath());
         fds.setMinRecordLength(minRecordLength);
         fds.init(null);
