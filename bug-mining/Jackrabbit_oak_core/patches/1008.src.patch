diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/QueryImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/QueryImpl.java
index 037e529cfa..7d1f4cdae5 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/QueryImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/QueryImpl.java
@@ -76,6 +76,7 @@ import org.apache.jackrabbit.oak.spi.query.QueryIndex.OrderEntry;
 import org.apache.jackrabbit.oak.spi.query.QueryIndex.OrderEntry.Order;
 import org.apache.jackrabbit.oak.spi.query.QueryIndexProvider;
 import org.apache.jackrabbit.oak.spi.state.NodeState;
+import org.apache.jackrabbit.oak.spi.state.NodeStateUtils;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -139,6 +140,8 @@ public class QueryImpl implements Query {
 
     private final QueryEngineSettings settings;
 
+    private boolean warnedHidden;
+
     QueryImpl(String statement, SourceImpl source, ConstraintImpl constraint,
             ColumnImpl[] columns, NamePathMapper mapper, QueryEngineSettings settings) {
         this.statement = statement;
@@ -867,6 +870,13 @@ public class QueryImpl implements Query {
 
     @Override
     public Tree getTree(String path) {
+        if (NodeStateUtils.isHiddenPath(path)) {
+            if (!warnedHidden) {
+                warnedHidden = true;
+                LOG.warn("Hidden tree traversed: {}", path);
+            }
+            return null;
+        }
         return context.getRoot().getTree(path);
     }
 
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/state/NodeStateUtils.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/state/NodeStateUtils.java
index cea47ad625..dffc2714b3 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/state/NodeStateUtils.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/state/NodeStateUtils.java
@@ -45,6 +45,21 @@ public final class NodeStateUtils {
         return !name.isEmpty() && name.charAt(0) == ':';
     }
 
+    /**
+     * Check whether the given path contains a hidden node.
+     * 
+     * @param path the path
+     * @return true if one of the nodes is hidden
+     */
+    public static boolean isHiddenPath(@Nonnull String path) {
+        for (String n : PathUtils.elements(path)) {
+            if (isHidden(n)) {
+                return true;
+            }
+        }
+        return false;
+    }
+
     @CheckForNull
     public static String getPrimaryTypeName(NodeState nodeState) {
         PropertyState ps = nodeState.getProperty(JcrConstants.JCR_PRIMARYTYPE);
