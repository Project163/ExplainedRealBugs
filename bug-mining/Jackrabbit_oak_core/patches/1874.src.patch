diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/Oak.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/Oak.java
index 810aa2fd82..334b24285e 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/Oak.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/Oak.java
@@ -136,6 +136,7 @@ import org.apache.jackrabbit.oak.spi.whiteboard.WhiteboardUtils;
 import org.apache.jackrabbit.oak.spi.descriptors.AggregatingDescriptors;
 import org.apache.jackrabbit.oak.stats.StatisticsProvider;
 import org.jetbrains.annotations.NotNull;
+import org.jetbrains.annotations.Nullable;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -563,22 +564,24 @@ public class Oak {
     @NotNull
     public Oak with(@NotNull Whiteboard whiteboard) {
         this.whiteboard = checkNotNull(whiteboard);
-        QueryEngineSettings queryEngineSettings = WhiteboardUtils.getService(whiteboard, QueryEngineSettings.class);
-        if (queryEngineSettings != null) {
-            this.queryEngineSettings = new AnnotatedQueryEngineSettings(queryEngineSettings);
+        QueryEngineSettings whiteboardSettings = WhiteboardUtils.getService(whiteboard, QueryEngineSettings.class);
+        if (whiteboardSettings != null) {
+            queryEngineSettings = new AnnotatedQueryEngineSettings(whiteboardSettings);
         }
         StatisticsProvider statisticsProvider = WhiteboardUtils.getService(whiteboard, StatisticsProvider.class);
         if (statisticsProvider != null) {
             QueryEngineSettings newSettings = new QueryEngineSettings(statisticsProvider);
-            newSettings.setFullTextComparisonWithoutIndex(this.queryEngineSettings.settings.getFullTextComparisonWithoutIndex());
-            newSettings.setFailTraversal(this.queryEngineSettings.getFailTraversal());
-            newSettings.setFastQuerySize(this.queryEngineSettings.isFastQuerySize());
-            newSettings.setLimitInMemory(this.queryEngineSettings.getLimitInMemory());
-            newSettings.setLimitReads(this.queryEngineSettings.getLimitReads());
-            this.queryEngineSettings = new AnnotatedQueryEngineSettings(newSettings);
+            newSettings.setFullTextComparisonWithoutIndex(queryEngineSettings.settings.getFullTextComparisonWithoutIndex());
+            newSettings.setFailTraversal(queryEngineSettings.getFailTraversal());
+            newSettings.setFastQuerySize(queryEngineSettings.isFastQuerySize());
+            newSettings.setLimitInMemory(queryEngineSettings.getLimitInMemory());
+            newSettings.setLimitReads(queryEngineSettings.getLimitReads());
+            queryEngineSettings = new AnnotatedQueryEngineSettings(newSettings);
         }
+
         if (queryEngineSettings != null) {
             Feature prefetchFeature = Feature.newFeature(QueryEngineSettings.FT_NAME_PREFETCH_FOR_QUERIES, whiteboard);
+            LOG.info("Registered Prefetch feature: " + QueryEngineSettings.FT_NAME_PREFETCH_FOR_QUERIES);
             closer.register(prefetchFeature);
             queryEngineSettings.setPrefetchFeature(prefetchFeature);
         }
@@ -974,6 +977,10 @@ public class Oak {
             settings.setStrictPathRestriction(strictPathRestriction);
         }
 
+        public void setPrefetchFeature(@Nullable Feature prefetch) {
+            settings.setPrefetchFeature(prefetch);
+        }
+
         @Override
         public void setQueryValidatorPattern(String key, String pattern, String comment, boolean failQuery) {
             settings.getQueryValidator().setPattern(key, pattern, comment, failQuery);
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/QueryEngineSettings.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/QueryEngineSettings.java
index 9f6ccf1b8a..0800f5520b 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/QueryEngineSettings.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/QueryEngineSettings.java
@@ -268,6 +268,7 @@ public class QueryEngineSettings implements QueryEngineSettingsMBean, QueryLimit
                 ", fullTextComparisonWithoutIndex=" + fullTextComparisonWithoutIndex +
                 ", sql2Optimisation=" + sql2Optimisation +
                 ", fastQuerySize=" + fastQuerySize +
+                ", prefetchCount=" + prefetchCount +
                 ", classNamesIgnoredInCallTrace=" + Arrays.toString(classNamesIgnoredInCallTrace) +
                 '}';
     }
