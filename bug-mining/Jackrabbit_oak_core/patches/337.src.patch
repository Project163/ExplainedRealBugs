diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/memory/ModifiedNodeState.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/memory/ModifiedNodeState.java
index a9d13e65d5..381ba9391e 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/memory/ModifiedNodeState.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/memory/ModifiedNodeState.java
@@ -94,6 +94,27 @@ public class ModifiedNodeState extends AbstractNodeState {
         }
     }
 
+    /**
+     * "Squeezes" {@link ModifiedNodeState} instances into equivalent
+     * {@link MemoryNodeState}s. Other kinds of states are returned as-is.
+     */
+    public static NodeState squeeze(NodeState state) {
+        if (state instanceof ModifiedNodeState) {
+            Map<String, PropertyState> properties = newHashMap();
+            for (PropertyState property : state.getProperties()) {
+                properties.put(property.getName(), property);
+            }
+
+            Map<String, NodeState> nodes = newHashMap();
+            for (ChildNodeEntry child : state.getChildNodeEntries()) {
+                nodes.put(child.getName(), squeeze(child.getNodeState()));
+            }
+
+            state = new MemoryNodeState(properties, nodes);
+        }
+        return state;
+    }
+
 
     static long getPropertyCount(
             NodeState base, Map<String, PropertyState> properties) {
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/memory/MemoryNodeBuilderTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/memory/MemoryNodeBuilderTest.java
index 5ec8da41e6..cde84278d0 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/memory/MemoryNodeBuilderTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/memory/MemoryNodeBuilderTest.java
@@ -47,7 +47,7 @@ public class MemoryNodeBuilderTest {
         builder.child("x").child("q");
         builder.child("y");
         builder.child("z");
-        base = builder.getNodeState();
+        base = ModifiedNodeState.squeeze(builder.getNodeState());
     }
 
     @Test
