diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/api/PropertyState.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/api/PropertyState.java
index 0be7ae3df1..4b7f5c69c8 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/api/PropertyState.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/api/PropertyState.java
@@ -46,12 +46,12 @@ public interface PropertyState {
      * @return  the single value of this property or {@code null} if this is a multi
      * valued property.
      */
-    Scalar getScalar();
+    CoreValue getValue();
 
     /**
      * @return  an iterable of the values of this multi valued property or
      * {@code null} if this is not a multi valued property.
      */
-    Iterable<Scalar> getArray();
+    Iterable<CoreValue> getValues();
 
 }
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/api/Scalar.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/api/Scalar.java
index cd1506d2a5..059f32e71a 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/api/Scalar.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/api/Scalar.java
@@ -20,6 +20,8 @@ import java.io.InputStream;
 
 /**
  * An immutable, typed scalar value.
+ *
+ * TODO: remove if really not needed any more
  */
 public interface Scalar {
     enum Type {BOOLEAN, LONG, DOUBLE, BINARY, STRING, NULL}
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/api/Tree.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/api/Tree.java
index 333501f139..a4f484c63c 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/api/Tree.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/api/Tree.java
@@ -184,7 +184,7 @@ public interface Tree {
      * @param name The name of this property
      * @param value The value of this property
      */
-    void setProperty(String name, Scalar value);
+    void setProperty(String name, CoreValue value);
 
     /**
      * Set a multivalued valued property state
@@ -192,7 +192,7 @@ public interface Tree {
      * @param name The name of this property
      * @param values The value of this property
      */
-    void setProperty(String name, List<Scalar> values);
+    void setProperty(String name, List<CoreValue> values);
 
     /**
      * Remove a property
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/core/KernelContentRepository.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/core/KernelContentRepository.java
index b47cff501b..364313ad1f 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/core/KernelContentRepository.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/core/KernelContentRepository.java
@@ -52,8 +52,8 @@ public class KernelContentRepository implements ContentRepository {
 
     public KernelContentRepository(MicroKernel mk) {
         microKernel = mk;
-        nodeStore = new KernelNodeStore(microKernel);
         valueFactory = new CoreValueFactoryImpl(microKernel);
+        nodeStore = new KernelNodeStore(microKernel, valueFactory);
         queryEngine = new QueryEngineImpl(microKernel, valueFactory);
 
         // FIXME: workspace setup must be done elsewhere...
@@ -95,8 +95,7 @@ public class KernelContentRepository implements ContentRepository {
             throw new NoSuchWorkspaceException(workspaceName);
         }
 
-        return new KernelContentSession(
-                sc, workspaceName, nodeStore, queryEngine, valueFactory);
+        return new KernelContentSession(sc, workspaceName, nodeStore, queryEngine, valueFactory);
     }
 
 }
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/AbstractPropertyState.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/AbstractPropertyState.java
index 2be17af3e1..9493d88232 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/AbstractPropertyState.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/AbstractPropertyState.java
@@ -18,8 +18,8 @@ package org.apache.jackrabbit.oak.kernel;
 
 import java.util.Iterator;
 
+import org.apache.jackrabbit.oak.api.CoreValue;
 import org.apache.jackrabbit.oak.api.PropertyState;
-import org.apache.jackrabbit.oak.api.Scalar;
 
 /**
  * Abstract base class for {@link PropertyState} implementations.
@@ -54,15 +54,15 @@ public abstract class AbstractPropertyState implements PropertyState {
         if (isArray() != other.isArray()) {
             return false;
         } else if (isArray()) {
-            Iterator<Scalar> iterator = other.getArray().iterator();
-            for (Scalar scalar : getArray()) {
-                if (!iterator.hasNext() || !scalar.equals(iterator.next())) {
+            Iterator<CoreValue> iterator = other.getValues().iterator();
+            for (CoreValue value : getValues()) {
+                if (!iterator.hasNext() || !value.equals(iterator.next())) {
                     return false;
                 }
             }
             return !iterator.hasNext();
         } else {
-            return getScalar().equals(other.getScalar());
+            return getValue().equals(other.getValue());
         }
     }
 
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelNodeState.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelNodeState.java
index 167f076d97..c12ea5e4ed 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelNodeState.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelNodeState.java
@@ -21,8 +21,9 @@ package org.apache.jackrabbit.oak.kernel;
 import org.apache.jackrabbit.mk.api.MicroKernel;
 import org.apache.jackrabbit.mk.json.JsopReader;
 import org.apache.jackrabbit.mk.json.JsopTokenizer;
+import org.apache.jackrabbit.oak.api.CoreValue;
+import org.apache.jackrabbit.oak.api.CoreValueFactory;
 import org.apache.jackrabbit.oak.api.PropertyState;
-import org.apache.jackrabbit.oak.api.Scalar;
 
 import java.util.ArrayList;
 import java.util.Iterator;
@@ -42,6 +43,7 @@ class KernelNodeState extends AbstractNodeState {
     static final int MAX_CHILD_NODE_NAMES = 1000;
 
     private final MicroKernel kernel;
+    private final CoreValueFactory valueFactory;
 
     private final String path;
 
@@ -59,11 +61,13 @@ class KernelNodeState extends AbstractNodeState {
      * underlying Microkernel does not contain such a node.
      *
      * @param kernel
+     * @param valueFactory
      * @param path
      * @param revision
      */
-    public KernelNodeState(MicroKernel kernel, String path, String revision) {
+    public KernelNodeState(MicroKernel kernel, CoreValueFactory valueFactory, String path, String revision) {
         this.kernel = kernel;
+        this.valueFactory = valueFactory;
         this.path = path;
         this.revision = revision;
     }
@@ -89,25 +93,12 @@ class KernelNodeState extends AbstractNodeState {
                     if ("/".equals(path)) {
                         childPath = '/' + name;
                     }
-                    childNodes.put(name, new KernelNodeState(
-                            kernel, childPath, revision));
-                } else if (reader.matches(JsopTokenizer.NUMBER)) {
-                    properties.put(name, new KernelPropertyState(
-                            name, ScalarImpl.numberScalar(reader.getToken())));
-                } else if (reader.matches(JsopTokenizer.STRING)) {
-                    properties.put(name, new KernelPropertyState(
-                            name, ScalarImpl.stringScalar(reader.getToken())));
-                } else if (reader.matches(JsopTokenizer.TRUE)) {
-                    properties.put(name, new KernelPropertyState(
-                            name, ScalarImpl.booleanScalar(true)));
-                } else if (reader.matches(JsopTokenizer.FALSE)) {
-                    properties.put(name, new KernelPropertyState(
-                            name, ScalarImpl.booleanScalar(false)));
+                    childNodes.put(name, new KernelNodeState(kernel, valueFactory, childPath, revision));
                 } else if (reader.matches('[')) {
-                    properties.put(name, new KernelPropertyState(
-                            name, readArray(reader)));
+                    properties.put(name, new KernelPropertyState(name, readArray(reader)));
                 } else {
-                    throw new IllegalArgumentException("Unexpected token: " + reader.getToken());
+                    CoreValue cv = readValue(reader);
+                    properties.put(name, new KernelPropertyState(name, cv));
                 }
             } while (reader.matches(','));
             reader.read('}');
@@ -146,7 +137,7 @@ class KernelNodeState extends AbstractNodeState {
         if (child == null && childNodeCount > MAX_CHILD_NODE_NAMES) {
             String childPath = getChildPath(name);
             if (kernel.nodeExists(childPath, revision)) {
-                child = new KernelNodeState(kernel, childPath, revision);
+                child = new KernelNodeState(kernel, valueFactory, childPath, revision);
             }
         }
         return child;
@@ -194,7 +185,7 @@ class KernelNodeState extends AbstractNodeState {
                     reader.read('}');
                     String childPath = getChildPath(name);
                     NodeState child =
-                            new KernelNodeState(kernel, childPath, revision);
+                            new KernelNodeState(kernel, valueFactory, childPath, revision);
                     entries.add(new KernelChildNodeEntry(name, child));
                 } else {
                     reader.read();
@@ -225,23 +216,37 @@ class KernelNodeState extends AbstractNodeState {
         }
     }
 
-    private static List<Scalar> readArray(JsopReader reader) {
-        List<Scalar> values = new ArrayList<Scalar>();
+    private List<CoreValue> readArray(JsopReader reader) {
+        List<CoreValue> values = new ArrayList<CoreValue>();
         while (!reader.matches(']')) {
-            if (reader.matches(JsopTokenizer.NUMBER)) {
-                values.add(ScalarImpl.numberScalar(reader.getToken()));
-            } else if (reader.matches(JsopTokenizer.STRING)) {
-                values.add(ScalarImpl.stringScalar(reader.getToken()));
-            } else if (reader.matches(JsopTokenizer.TRUE)) {
-                values.add(ScalarImpl.booleanScalar(true));
-            } else if (reader.matches(JsopTokenizer.FALSE)) {
-                values.add(ScalarImpl.booleanScalar(false));
-            } else {
-                throw new IllegalArgumentException("Unexpected token: " + reader.getToken());
-            }
+            values.add(readValue(reader));
             reader.matches(',');
         }
         return values;
     }
 
+    private CoreValue readValue(JsopReader reader) {
+        CoreValue value;
+        // TODO properly handle property types not covered by JSON: Binary, double, decimal, date, name, path, (weak)ref, uri
+        if (reader.matches(JsopTokenizer.NUMBER)) {
+            String number = reader.getToken();
+            // TODO: property deal with different number types (double, BigDecimal)
+            if (number.indexOf('.') > -1) {
+                value = valueFactory.createValue(Double.valueOf(number));
+            } else {
+                value = valueFactory.createValue(Long.valueOf(number));
+            }
+        } else if (reader.matches(JsopTokenizer.TRUE)) {
+            value = valueFactory.createValue(true);
+        } else if (reader.matches(JsopTokenizer.FALSE)) {
+            value = valueFactory.createValue(false);
+        } else if (reader.matches(JsopTokenizer.STRING)) {
+            // TODO: deal with other property types
+            value = valueFactory.createValue(reader.getToken());
+        }  else {
+            throw new IllegalArgumentException("Unexpected token: " + reader.getToken());
+        }
+        return value;
+    }
+
 }
\ No newline at end of file
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelNodeStore.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelNodeStore.java
index 684f4d3b22..7ebd55c8e2 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelNodeStore.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelNodeStore.java
@@ -19,21 +19,24 @@
 package org.apache.jackrabbit.oak.kernel;
 
 import org.apache.jackrabbit.mk.api.MicroKernel;
+import org.apache.jackrabbit.oak.api.CoreValueFactory;
 
 /**
  * {@link MicroKernel}-based {@link NodeStore} implementation.
  */
 public class KernelNodeStore implements NodeStore {
 
-    final MicroKernel kernel;  // FIXME make private
+    final MicroKernel kernel;
+    final CoreValueFactory valueFactory;
 
-    public KernelNodeStore(MicroKernel kernel) {
+    public KernelNodeStore(MicroKernel kernel, CoreValueFactory valueFactory) {
         this.kernel = kernel;
+        this.valueFactory = valueFactory;
     }
 
     @Override
     public NodeState getRoot() {
-        return new KernelNodeState(kernel, "/", kernel.getHeadRevision());
+        return new KernelNodeState(kernel, valueFactory, "/", kernel.getHeadRevision());
     }
 
     @Override
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelPropertyState.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelPropertyState.java
index 588ae7f439..23dc70a209 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelPropertyState.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelPropertyState.java
@@ -21,20 +21,20 @@ package org.apache.jackrabbit.oak.kernel;
 import java.util.Collections;
 import java.util.List;
 
-import org.apache.jackrabbit.oak.api.Scalar;
+import org.apache.jackrabbit.oak.api.CoreValue;
 
 class KernelPropertyState extends AbstractPropertyState {
     private final String name;
-    private final Scalar value;
-    private final List<Scalar> values;
+    private final CoreValue value;
+    private final List<CoreValue> values;
 
-    public KernelPropertyState(String name, Scalar value) {
+    public KernelPropertyState(String name, CoreValue value) {
         this.name = name;
         this.value = value;
         this.values = null;
     }
 
-    public KernelPropertyState(String name, List<Scalar> values) {
+    public KernelPropertyState(String name, List<CoreValue> values) {
         this.name = name;
         this.value = null;
         this.values = Collections.unmodifiableList(values);
@@ -51,12 +51,12 @@ class KernelPropertyState extends AbstractPropertyState {
     }
     
     @Override
-    public Scalar getScalar() {
+    public CoreValue getValue() {
         return value;
     }
 
     @Override
-    public Iterable<Scalar> getArray() {
+    public Iterable<CoreValue> getValues() {
         return values;
     }
 
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelRoot.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelRoot.java
index 10c29db08b..df185bd867 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelRoot.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelRoot.java
@@ -21,12 +21,13 @@ package org.apache.jackrabbit.oak.kernel;
 import org.apache.jackrabbit.mk.api.MicroKernel;
 import org.apache.jackrabbit.mk.api.MicroKernelException;
 import org.apache.jackrabbit.mk.json.JsonBuilder;
+import org.apache.jackrabbit.oak.api.CoreValue;
 import org.apache.jackrabbit.oak.api.Root;
 import org.apache.jackrabbit.oak.api.CommitFailedException;
-import org.apache.jackrabbit.oak.api.Scalar;
 import org.apache.jackrabbit.oak.api.Tree;
 import org.apache.jackrabbit.oak.kernel.KernelTree.Listener;
 
+import javax.jcr.PropertyType;
 import java.util.List;
 
 import static org.apache.jackrabbit.mk.util.PathUtils.elements;
@@ -156,23 +157,24 @@ public class KernelRoot implements Root {
         return path.isEmpty() ? name : path + '/' + name;
     }
 
-    private static String encode(Scalar scalar) {
-        switch (scalar.getType()) {
-            case BOOLEAN: return JsonBuilder.encode(scalar.getBoolean());
-            case LONG:    return JsonBuilder.encode(scalar.getLong());
-            case DOUBLE:  return JsonBuilder.encode(scalar.getDouble());
-            case BINARY:  return null; // TODO implement encoding of binaries
-            case STRING:  return JsonBuilder.encode(scalar.getString());
-            case NULL:    return "null";
+    private static String encode(CoreValue value) {
+        switch (value.getType()) {
+            // TODO: deal with all property types.
+            case PropertyType.BOOLEAN: return JsonBuilder.encode(value.getBoolean());
+            case PropertyType.LONG:    return JsonBuilder.encode(value.getLong());
+            case PropertyType.DOUBLE:  return JsonBuilder.encode(value.getDouble());
+            case PropertyType.BINARY:  return null; // TODO implement encoding of binaries
+            case PropertyType.STRING:  return JsonBuilder.encode(value.getString());
+            default: return JsonBuilder.encode(value.getString());
+            //case NULL:    return "null"; // TODO
         }
-        throw new IllegalStateException("unreachable");  // Make javac happy
     }
 
-    private static String encode(Iterable<Scalar> scalars) {
+    private static String encode(Iterable<CoreValue> values) {
         StringBuilder sb = new StringBuilder();
         sb.append('[');
-        for (Scalar scalar : scalars) {
-            sb.append(encode(scalar));
+        for (CoreValue cv : values) {
+            sb.append(encode(cv));
             sb.append(',');
         }
         if (sb.length() > 1) {
@@ -200,12 +202,12 @@ public class KernelRoot implements Root {
         }
 
         @Override
-        public void setProperty(KernelTree tree, String name, Scalar value) {
+        public void setProperty(KernelTree tree, String name, CoreValue value) {
             jsop.append("^\"").append(path(tree, name)).append("\":").append(encode(value));
         }
 
         @Override
-        public void setProperty(KernelTree tree, String name, List<Scalar> values) {
+        public void setProperty(KernelTree tree, String name, List<CoreValue> values) {
             jsop.append("^\"").append(path(tree, name)).append("\":").append(encode(values));
         }
 
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelTree.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelTree.java
index 40e1e7892d..7ed11bbe9a 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelTree.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/KernelTree.java
@@ -18,9 +18,9 @@
  */
 package org.apache.jackrabbit.oak.kernel;
 
+import org.apache.jackrabbit.oak.api.CoreValue;
 import org.apache.jackrabbit.oak.api.Tree;
 import org.apache.jackrabbit.oak.api.PropertyState;
-import org.apache.jackrabbit.oak.api.Scalar;
 import org.apache.jackrabbit.oak.util.Function1;
 import org.apache.jackrabbit.oak.util.Iterators;
 import org.apache.jackrabbit.oak.util.PagedIterator;
@@ -100,7 +100,7 @@ public class KernelTree implements Tree {
          * @param name  name of the property
          * @param value  value of the property
          */
-        void setProperty(KernelTree tree, String name, Scalar value);
+        void setProperty(KernelTree tree, String name, CoreValue value);
 
         /**
          * The property of the given {@code name} and {@code values} has been set.
@@ -108,7 +108,7 @@ public class KernelTree implements Tree {
          * @param name  name of the property
          * @param values  values of the property
          */
-        void setProperty(KernelTree tree, String name, List<Scalar> values);
+        void setProperty(KernelTree tree, String name, List<CoreValue> values);
 
         /**
          * The property of the given {@code name} has been removed.
@@ -441,7 +441,7 @@ public class KernelTree implements Tree {
     }
 
     @Override
-    public void setProperty(String name, Scalar value) {
+    public void setProperty(String name, CoreValue value) {
         PropertyState propertyState = new KernelPropertyState(name, value);
         setProperty(propertyState);
         if (listener != null) {
@@ -450,7 +450,7 @@ public class KernelTree implements Tree {
     }
 
     @Override
-    public void setProperty(String name, List<Scalar> values) {
+    public void setProperty(String name, List<CoreValue> values) {
         PropertyState propertyState = new KernelPropertyState(name, values);
         setProperty(propertyState);
         if (listener != null) {
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/ScalarImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/ScalarImpl.java
index 6c7af55c1c..5e71a1f9f6 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/ScalarImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/kernel/ScalarImpl.java
@@ -23,6 +23,9 @@ import java.util.concurrent.Callable;
 
 import org.apache.jackrabbit.oak.api.Scalar;
 
+/**
+ * TODO: remove if really not needed any more
+ */
 public abstract class ScalarImpl implements Scalar {
 
     private static final NullScalar NULL_SCALAR = new NullScalar();
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/type/TypeValidator.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/type/TypeValidator.java
index 345260501b..e9385a7f9c 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/type/TypeValidator.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/type/TypeValidator.java
@@ -20,8 +20,8 @@ import java.util.Collections;
 import java.util.Set;
 
 import org.apache.jackrabbit.oak.api.CommitFailedException;
+import org.apache.jackrabbit.oak.api.CoreValue;
 import org.apache.jackrabbit.oak.api.PropertyState;
-import org.apache.jackrabbit.oak.api.Scalar;
 import org.apache.jackrabbit.oak.kernel.NodeState;
 import org.apache.jackrabbit.oak.kernel.Validator;
 
@@ -35,14 +35,14 @@ class TypeValidator implements Validator {
 
     private void checkTypeExists(PropertyState after)
             throws CommitFailedException {
-        Iterable<Scalar> scalars = Collections.emptyList();
+        Iterable<CoreValue> coreValues = Collections.emptyList();
         if ("jcr:primaryType".equals(after.getName())) {
-            scalars = Collections.singletonList(after.getScalar());
+            coreValues = Collections.singletonList(after.getValue());
         } else if ("jcr:mixinTypes".equals(after.getName())) {
-            scalars = after.getArray();
+            coreValues = after.getValues();
         }
-        for (Scalar scalar : scalars) {
-            String value = scalar.getString();
+        for (CoreValue cv : coreValues) {
+            String value = cv.getString();
             if (!types.contains(value)) {
                 throw new CommitFailedException("Unknown node type: " + value);
             }
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/AbstractOakTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/AbstractOakTest.java
new file mode 100644
index 0000000000..da41157e5b
--- /dev/null
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/AbstractOakTest.java
@@ -0,0 +1,52 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.jackrabbit.oak.kernel;
+
+import org.apache.jackrabbit.mk.api.MicroKernel;
+import org.apache.jackrabbit.mk.simple.SimpleKernelImpl;
+import org.apache.jackrabbit.oak.api.CoreValueFactory;
+import org.apache.jackrabbit.oak.core.CoreValueFactoryImpl;
+import org.junit.Before;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+
+/**
+ * AbstractOakTest...
+ */
+public abstract class AbstractOakTest {
+
+    /**
+     * logger instance
+     */
+    private static final Logger log = LoggerFactory.getLogger(AbstractOakTest.class);
+
+    // TODO: use regular oak-repo setup
+    protected MicroKernel microKernel;
+    protected CoreValueFactory valueFactory;
+
+    protected KernelNodeState state;
+
+    @Before
+    public void setUp() {
+        microKernel = new SimpleKernelImpl("mem:" + getClass().getName());
+        valueFactory = new CoreValueFactoryImpl(microKernel);
+
+        state = createInitialState();
+    }
+
+    abstract KernelNodeState createInitialState();
+}
\ No newline at end of file
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/KernelNodeStateTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/KernelNodeStateTest.java
index af5a56cff5..4cd99a4c64 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/KernelNodeStateTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/KernelNodeStateTest.java
@@ -18,35 +18,29 @@
  */
 package org.apache.jackrabbit.oak.kernel;
 
-import static junit.framework.Assert.assertEquals;
-import static junit.framework.Assert.assertFalse;
-import static junit.framework.Assert.assertNotNull;
-import static junit.framework.Assert.assertNull;
+import org.apache.jackrabbit.oak.api.PropertyState;
+import org.junit.Test;
 
 import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.Collections;
 import java.util.List;
 
-import org.apache.jackrabbit.mk.api.MicroKernel;
-import org.apache.jackrabbit.mk.simple.SimpleKernelImpl;
-import org.apache.jackrabbit.oak.api.PropertyState;
-import org.junit.Before;
-import org.junit.Test;
-
-public class KernelNodeStateTest {
+import static junit.framework.Assert.assertEquals;
+import static junit.framework.Assert.assertFalse;
+import static junit.framework.Assert.assertNotNull;
+import static junit.framework.Assert.assertNull;
 
-    private NodeState state;
+public class KernelNodeStateTest extends AbstractOakTest {
 
-    @Before
-    public void setUp() {
-        MicroKernel kernel = new SimpleKernelImpl("mem:KernelNodeStateTest");
+    @Override
+    KernelNodeState createInitialState() {
         String jsop =
                 "+\"test\":{\"a\":1,\"b\":2,\"c\":3,"
                 + "\"x\":{},\"y\":{},\"z\":{}}";
-        String revision = kernel.commit(
-                "/", jsop, kernel.getHeadRevision(), "test data");
-        state = new KernelNodeState(kernel, "/test", revision);
+        String revision = microKernel.commit(
+                "/", jsop, microKernel.getHeadRevision(), "test data");
+        return new KernelNodeState(microKernel, valueFactory, "/test", revision);
     }
 
     @Test
@@ -57,11 +51,11 @@ public class KernelNodeStateTest {
     @Test
     public void testGetProperty() {
         assertEquals("a", state.getProperty("a").getName());
-        assertEquals(1, state.getProperty("a").getScalar().getLong());
+        assertEquals(1, state.getProperty("a").getValue().getLong());
         assertEquals("b", state.getProperty("b").getName());
-        assertEquals(2, state.getProperty("b").getScalar().getLong());
+        assertEquals(2, state.getProperty("b").getValue().getLong());
         assertEquals("c", state.getProperty("c").getName());
-        assertEquals(3, state.getProperty("c").getScalar().getLong());
+        assertEquals(3, state.getProperty("c").getValue().getLong());
         assertNull(state.getProperty("x"));
     }
 
@@ -71,7 +65,7 @@ public class KernelNodeStateTest {
         List<Long> values = new ArrayList<Long>();
         for (PropertyState property : state.getProperties()) {
             names.add(property.getName());
-            values.add(property.getScalar().getLong());
+            values.add(property.getValue().getLong());
         }
         Collections.sort(names);
         Collections.sort(values);
@@ -128,5 +122,4 @@ public class KernelNodeStateTest {
         // Zero count
         assertFalse(state.getChildNodeEntries(0, 0).iterator().hasNext());
     }
-
 }
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/KernelRootFuzzIT.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/KernelRootFuzzIT.java
index fb8e3e52d9..5ea9c3ced2 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/KernelRootFuzzIT.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/KernelRootFuzzIT.java
@@ -21,9 +21,11 @@ package org.apache.jackrabbit.oak.kernel;
 import org.apache.jackrabbit.mk.api.MicroKernel;
 import org.apache.jackrabbit.mk.simple.SimpleKernelImpl;
 import org.apache.jackrabbit.mk.util.PathUtils;
+import org.apache.jackrabbit.oak.api.CoreValue;
+import org.apache.jackrabbit.oak.api.CoreValueFactory;
 import org.apache.jackrabbit.oak.api.PropertyState;
-import org.apache.jackrabbit.oak.api.Scalar;
 import org.apache.jackrabbit.oak.api.Tree;
+import org.apache.jackrabbit.oak.core.CoreValueFactoryImpl;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.RunWith;
@@ -62,6 +64,8 @@ public class KernelRootFuzzIT {
 
     private int counter;
 
+    private CoreValueFactory vf;
+
     @Parameters
     public static List<Object[]> seeds() {
         // todo use random sees, log seed, provide means to start with specific seed
@@ -83,12 +87,13 @@ public class KernelRootFuzzIT {
         counter = 0;
 
         MicroKernel mk1 = new SimpleKernelImpl("mem:");
-        store1 = new KernelNodeStore(mk1);
+        vf = new CoreValueFactoryImpl(mk1);
+        store1 = new KernelNodeStore(mk1, vf);
         mk1.commit("", "+\"/test\":{} +\"/test/root\":{}", mk1.getHeadRevision(), "");
         root1 = new KernelRoot(store1, "test");
 
         MicroKernel mk2 = new SimpleKernelImpl("mem:");
-        store2 = new KernelNodeStore(mk2);
+        store2 = new KernelNodeStore(mk2, vf);
         mk2.commit("", "+\"/test\":{} +\"/test/root\":{}", mk2.getHeadRevision(), "");
         root2 = new KernelRoot(store2, "test");
     }
@@ -221,9 +226,9 @@ public class KernelRootFuzzIT {
         static class SetProperty extends Operation {
             private final String parentPath;
             private String propertyName;
-            private Scalar propertyValue;
+            private CoreValue propertyValue;
 
-            SetProperty(String parentPath, String name, Scalar value) {
+            SetProperty(String parentPath, String name, CoreValue value) {
                 this.parentPath = parentPath;
                 this.propertyName = name;
                 this.propertyValue = value;
@@ -344,7 +349,7 @@ public class KernelRootFuzzIT {
     private Operation createAddProperty() {
         String parent = chooseNodePath();
         String name = createPropertyName();
-        Scalar value = createValue();
+        CoreValue value = createValue();
         return new SetProperty(parent, name, value);
     }
 
@@ -353,7 +358,7 @@ public class KernelRootFuzzIT {
         if (path == null) {
             return null;
         }
-        Scalar value = createValue();
+        CoreValue value = createValue();
         return new SetProperty(PathUtils.getParentPath(path), PathUtils.getName(path), value);
     }
 
@@ -414,8 +419,8 @@ public class KernelRootFuzzIT {
         return null;
     }
 
-    private Scalar createValue() {
-        return ScalarImpl.stringScalar("V" + counter++);
+    private CoreValue createValue() {
+        return vf.createValue("V" + counter++);
     }
 
     private static void checkEqual(Tree tree1, Tree tree2) {
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/KernelRootTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/KernelRootTest.java
index c678b27b2e..4b52c1195c 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/KernelRootTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/KernelRootTest.java
@@ -18,15 +18,14 @@
  */
 package org.apache.jackrabbit.oak.kernel;
 
-import org.apache.jackrabbit.mk.api.MicroKernel;
-import org.apache.jackrabbit.mk.simple.SimpleKernelImpl;
 import org.apache.jackrabbit.oak.api.CommitFailedException;
+import org.apache.jackrabbit.oak.api.CoreValue;
 import org.apache.jackrabbit.oak.api.PropertyState;
-import org.apache.jackrabbit.oak.api.Scalar;
 import org.apache.jackrabbit.oak.api.Tree;
 import org.junit.Before;
 import org.junit.Test;
 
+import javax.jcr.PropertyType;
 import java.util.Collections;
 import java.util.HashMap;
 import java.util.HashSet;
@@ -39,17 +38,23 @@ import static org.junit.Assert.assertNotNull;
 import static org.junit.Assert.assertNull;
 import static org.junit.Assert.assertTrue;
 
-public class KernelRootTest {
+public class KernelRootTest extends AbstractOakTest {
 
-    private final MicroKernel microkernel = new SimpleKernelImpl("mem:");
-    private final KernelNodeStore store = new KernelNodeStore(microkernel);
+    private KernelNodeStore store;
 
     @Before
     public void setUp() {
+        super.setUp();
+        store = new KernelNodeStore(microKernel, valueFactory);
+    }
+
+    @Override
+    KernelNodeState createInitialState() {
         String jsop =
                 "+\"test\":{\"a\":1,\"b\":2,\"c\":3,"
                         + "\"x\":{},\"y\":{},\"z\":{}}";
-        microkernel.commit("/", jsop, microkernel.getHeadRevision(), "test data");
+        String revision = microKernel.commit("/", jsop, microKernel.getHeadRevision(), "test data");
+        return new KernelNodeState(microKernel, valueFactory, "/test", revision);
     }
 
     @Test
@@ -75,8 +80,8 @@ public class KernelRootTest {
         propertyState = tree.getProperty("a");
         assertNotNull(propertyState);
         assertFalse(propertyState.isArray());
-        assertEquals(Scalar.Type.LONG, propertyState.getScalar().getType());
-        assertEquals(1, propertyState.getScalar().getLong());
+        assertEquals(PropertyType.LONG, propertyState.getValue().getType());
+        assertEquals(1, propertyState.getValue().getLong());
     }
 
     @Test
@@ -102,17 +107,17 @@ public class KernelRootTest {
         KernelRoot root = new KernelRoot(store, "test");
         Tree tree = root.getTree("/");
 
-        Map<String, Scalar> expectedProperties = new HashMap<String, Scalar>();
-        expectedProperties.put("a", ScalarImpl.longScalar(1));
-        expectedProperties.put("b", ScalarImpl.longScalar(2));
-        expectedProperties.put("c", ScalarImpl.longScalar(3));
+        Map<String, CoreValue> expectedProperties = new HashMap<String, CoreValue>();
+        expectedProperties.put("a", valueFactory.createValue(1));
+        expectedProperties.put("b", valueFactory.createValue(2));
+        expectedProperties.put("c", valueFactory.createValue(3));
 
         Iterable<PropertyState> properties = tree.getProperties();
         for (PropertyState property : properties) {
-            Scalar value = expectedProperties.remove(property.getName());
+            CoreValue value = expectedProperties.remove(property.getName());
             assertNotNull(value);
             assertFalse(property.isArray());
-            assertEquals(value, property.getScalar());
+            assertEquals(value, property.getValue());
         }
 
         assertTrue(expectedProperties.isEmpty());
@@ -175,12 +180,12 @@ public class KernelRootTest {
         Tree tree = root.getTree("/");
 
         assertFalse(tree.hasProperty("new"));
-        Scalar value = ScalarImpl.stringScalar("value");
+        CoreValue value = valueFactory.createValue("value");
         tree.setProperty("new", value);
         PropertyState property = tree.getProperty("new");
         assertNotNull(property);
         assertEquals("new", property.getName());
-        assertEquals(value, property.getScalar());
+        assertEquals(value, property.getValue());
 
         root.commit();
         tree = root.getTree("/");
@@ -188,7 +193,7 @@ public class KernelRootTest {
         property = tree.getProperty("new");
         assertNotNull(property);
         assertEquals("new", property.getName());
-        assertEquals(value, property.getScalar());
+        assertEquals(value, property.getValue());
     }
 
     @Test
@@ -312,7 +317,7 @@ public class KernelRootTest {
 
         assertEquals(3, tree.getPropertyCount());
 
-        Scalar value = ScalarImpl.stringScalar("foo");
+        CoreValue value = valueFactory.createValue("foo");
         tree.setProperty("a", value);
         assertEquals(3, tree.getPropertyCount());
 
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/LargeKernelNodeStateTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/LargeKernelNodeStateTest.java
index 40e93c34ad..b85b91245d 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/LargeKernelNodeStateTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/kernel/LargeKernelNodeStateTest.java
@@ -18,34 +18,27 @@
  */
 package org.apache.jackrabbit.oak.kernel;
 
+import org.junit.Test;
+
 import static junit.framework.Assert.assertEquals;
 import static junit.framework.Assert.assertFalse;
 import static junit.framework.Assert.assertNotNull;
 import static junit.framework.Assert.assertNull;
 
-import org.apache.jackrabbit.mk.api.MicroKernel;
-import org.apache.jackrabbit.mk.simple.SimpleKernelImpl;
-import org.junit.Before;
-import org.junit.Test;
-
-public class LargeKernelNodeStateTest {
+public class LargeKernelNodeStateTest extends AbstractOakTest {
 
     private final int N = KernelNodeState.MAX_CHILD_NODE_NAMES;
 
-    private NodeState state;
-
-    @Before
-    public void setUp() {
-        MicroKernel kernel =
-                new SimpleKernelImpl("mem:LargeKernelNodeStateTest");
+    @Override
+    KernelNodeState createInitialState() {
         StringBuilder jsop = new StringBuilder("+\"test\":{\"a\":1");
         for (int i = 0; i <= N; i++) {
             jsop.append(",\"x" + i + "\":{}");
         }
-        jsop.append("}");
-        String revision = kernel.commit(
-                "/", jsop.toString(), kernel.getHeadRevision(), "test data");
-        state = new KernelNodeState(kernel, "/test", revision);
+        jsop.append('}');
+        String revision = microKernel.commit(
+                "/", jsop.toString(), microKernel.getHeadRevision(), "test data");
+        return new KernelNodeState(microKernel, valueFactory, "/test", revision);
     }
 
     @Test
