diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/security/authentication/user/LoginModuleImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/security/authentication/user/LoginModuleImpl.java
index 7b6923e6a1..9d6feab604 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/security/authentication/user/LoginModuleImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/security/authentication/user/LoginModuleImpl.java
@@ -139,6 +139,10 @@ public final class LoginModuleImpl extends AbstractLoginModule {
             log.debug("Adding login name to shared state.");
             //noinspection unchecked
             sharedState.put(SHARED_KEY_LOGIN_NAME, userId);
+        } else {
+            // ensure that we don't commit (OAK-2998, OAK-3032)
+            credentials = null;
+            userId = null;
         }
         return success;
     }
