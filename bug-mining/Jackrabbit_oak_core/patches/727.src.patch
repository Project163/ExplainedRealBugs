diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/file/FileStore.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/file/FileStore.java
index d37f648710..25269bee37 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/file/FileStore.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/file/FileStore.java
@@ -234,8 +234,10 @@ public class FileStore implements SegmentStore {
             }
         }
 
-        for (Segment segment : segments.asMap().values().toArray(new Segment[0])) {
-            segment.dropOldCacheEntries();
+        if (segments != null) {
+            for (Segment segment : segments.asMap().values().toArray(new Segment[0])) {
+                segment.dropOldCacheEntries();
+            }
         }
     }
 
