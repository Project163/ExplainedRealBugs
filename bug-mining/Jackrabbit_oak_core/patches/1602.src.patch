diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentNodeState.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentNodeState.java
index abdb804ae5..24b3f191b1 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentNodeState.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentNodeState.java
@@ -429,7 +429,7 @@ public class DocumentNodeState extends AbstractDocumentNodeState implements Cach
                 + rootRevision.getMemory()
                 + estimateMemoryUsage(path);
         // rough approximation for properties
-        for (Map.Entry<String, PropertyState> entry : properties.entrySet()) {
+        for (Map.Entry<String, PropertyState> entry : bundlingContext.getAllProperties().entrySet()) {
             // name
             size += estimateMemoryUsage(entry.getKey());
             PropertyState propState = entry.getValue();
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/document/bundlor/DocumentBundlingTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/document/bundlor/DocumentBundlingTest.java
index 0979cbe1ff..e21e9182d5 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/document/bundlor/DocumentBundlingTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/document/bundlor/DocumentBundlingTest.java
@@ -74,13 +74,14 @@ import static org.apache.jackrabbit.oak.plugins.document.bundlor.DocumentBundlor
 import static org.apache.jackrabbit.oak.plugins.memory.EmptyNodeState.EMPTY_NODE;
 import static org.apache.jackrabbit.oak.spi.state.NodeStateUtils.getNode;
 import static org.hamcrest.CoreMatchers.hasItems;
+import static org.hamcrest.Matchers.greaterThan;
+import static org.hamcrest.Matchers.is;
 import static org.junit.Assert.assertEquals;
 import static org.junit.Assert.assertFalse;
 import static org.junit.Assert.assertNotNull;
 import static org.junit.Assert.assertNull;
 import static org.junit.Assert.assertThat;
 import static org.junit.Assert.assertTrue;
-import static org.junit.Assert.fail;
 
 public class DocumentBundlingTest {
     @Rule
@@ -154,6 +155,31 @@ public class DocumentBundlingTest {
         AssertingDiff.assertEquals(fileNode.getNodeState(), dns.fromExternalChange());
     }
 
+    @Test
+    public void memory() throws Exception{
+        NodeBuilder builder = store.getRoot().builder();
+        NodeBuilder bundledFileNode = newNode("nt:file");
+        bundledFileNode.child("jcr:content").setProperty("jcr:data", "foo");
+        builder.child("test").setChildNode("book.jpg", bundledFileNode.getNodeState());
+
+        //Create a non bundled NodeState structure nt:File vs nt:file
+        NodeBuilder nonBundledFileNode = newNode("nt:File");
+        nonBundledFileNode.child("jcr:content").setProperty("jcr:data", "foo");
+        builder.child("test").setChildNode("book2.jpg", nonBundledFileNode.getNodeState());
+        merge(builder);
+
+        NodeState root = store.getRoot();
+        DocumentNodeState bundledFile = asDocumentState(getNode(root, "/test/book.jpg"));
+        DocumentNodeState nonBundledFile = asDocumentState(getNode(root, "/test/book2.jpg"));
+        DocumentNodeState nonBundledContent = asDocumentState(getNode(root, "/test/book2.jpg/jcr:content"));
+
+        int nonBundledMem = nonBundledFile.getMemory() + nonBundledContent.getMemory();
+        int bundledMem = bundledFile.getMemory();
+
+        assertEquals(1386, bundledMem);
+        assertThat(bundledMem, is(greaterThan(nonBundledMem)));
+    }
+
     @Test
     public void bundlorUtilsIsBundledMethods() throws Exception{
         NodeBuilder builder = store.getRoot().builder();
