diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/xpath/XPathToSQL2Converter.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/xpath/XPathToSQL2Converter.java
index 9bfbd2d5e6..d64d7cf459 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/xpath/XPathToSQL2Converter.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/xpath/XPathToSQL2Converter.java
@@ -162,6 +162,10 @@ public class XPathToSQL2Converter {
             } else if (readIf("/")) {
                 // "//" was read
                 pathPattern += "%";
+                if (currentSelector.isDescendant) {
+                    // the query started with "//", and now "//" was read
+                    nextSelector(true);
+                }
                 currentSelector.isDescendant = true;
             } else {
                 // the token "/" was read
@@ -169,6 +173,10 @@ public class XPathToSQL2Converter {
                 if (startOfQuery) {
                     currentSelector.path = "/";
                 } else {
+                    if (currentSelector.isDescendant) {
+                        // the query started with "//", and now "/" was read
+                        nextSelector(true);
+                    }
                     currentSelector.isChild = true;
                 }
             }
diff --git a/oak-core/src/test/resources/org/apache/jackrabbit/oak/query/xpath.txt b/oak-core/src/test/resources/org/apache/jackrabbit/oak/query/xpath.txt
index a8fc1ca441..cb827aa8a8 100644
--- a/oak-core/src/test/resources/org/apache/jackrabbit/oak/query/xpath.txt
+++ b/oak-core/src/test/resources/org/apache/jackrabbit/oak/query/xpath.txt
@@ -24,6 +24,22 @@
 # * new tests are typically be added on top, after the syntax docs
 # * use ascii character only
 
+# OAK-4376
+
+xpath2sql //element(*, oak:QueryIndexDefinition)/*
+select b.[jcr:path] as [jcr:path], b.[jcr:score] as [jcr:score], b.*
+  from [oak:QueryIndexDefinition] as a
+  inner join [nt:base] as b
+  on ischildnode(b, a)
+  /* xpath ... */
+
+xpath2sql //element(*, oak:QueryIndexDefinition)//*
+select b.[jcr:path] as [jcr:path], b.[jcr:score] as [jcr:score], b.*
+  from [oak:QueryIndexDefinition] as a
+  inner join [nt:base] as b
+  on isdescendantnode(b, a)
+  /* xpath ... */
+
 # nested conditions are converted to union
 
 xpath2sql /jcr:root/test//element(*, nt:unstructured)[
