diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/QueryImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/QueryImpl.java
index 839169f57c..95e5ecf993 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/QueryImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/QueryImpl.java
@@ -1026,12 +1026,13 @@ public class QueryImpl implements Query {
                     double c = p.getCostPerExecution() + entryCount * p.getCostPerEntry();
                     if (c < cost) {
                         cost = c;
-                        if (p.getPlanName() != null) {
-                            indexName += "[" + p.getPlanName() + "]";
-                        }
                         indexPlan = p;
                     }
                 }
+
+                if (indexPlan != null && indexPlan.getPlanName() != null) {
+                    indexName += "[" + indexPlan.getPlanName() + "]";
+                }
             } else {
                 cost = index.getCost(filter, rootState);
             }
