diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/Commit.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/Commit.java
index 3de3221ca1..97ed2c6cd6 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/Commit.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/Commit.java
@@ -179,9 +179,12 @@ public class Commit {
                 success = true;
             } finally {
                 if (!success) {
-                    b.removeCommit(rev.asBranchRevision());
-                    if (!b.hasCommits()) {
-                        nodeStore.getBranches().remove(b);
+                    Branch branch = getBranch();
+                    if (branch != null) {
+                        branch.removeCommit(rev.asBranchRevision());
+                        if (!branch.hasCommits()) {
+                            nodeStore.getBranches().remove(branch);
+                        }
                     }
                 }
             }
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/document/CommitTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/document/CommitTest.java
index afc1adf514..4250ba299a 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/document/CommitTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/document/CommitTest.java
@@ -25,6 +25,7 @@ import org.apache.jackrabbit.oak.spi.state.NodeBuilder;
 import org.junit.Rule;
 import org.junit.Test;
 
+import static org.apache.jackrabbit.oak.plugins.memory.EmptyNodeState.EMPTY_NODE;
 import static org.junit.Assert.assertEquals;
 import static org.junit.Assert.assertTrue;
 import static org.junit.Assert.fail;
@@ -109,4 +110,27 @@ public class CommitTest {
             ns.canceled(c);
         }
     }
+
+    // OAK-4894
+    @Test
+    public void branchCommitFails() throws Exception {
+        // prepare node store
+        DocumentNodeStore ns = builderProvider.newBuilder().getNodeStore();
+
+        // this branch commit must fail with a DocumentStoreException
+        Commit c = ns.newCommit(ns.getHeadRevision().asBranchRevision(ns.getClusterId()), null);
+        try {
+            c.removeNode("/foo", EMPTY_NODE);
+            try {
+                c.apply();
+                fail("commit must fail");
+            } catch (DocumentStoreException e) {
+                // expected
+                assertTrue("Unexpected exception message: " + e.getMessage(),
+                        e.getMessage().contains("does not exist"));
+            }
+        } finally {
+            ns.canceled(c);
+        }
+    }
 }
