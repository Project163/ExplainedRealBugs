diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentNodeState.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentNodeState.java
index ca22cab680..eefc447458 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentNodeState.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentNodeState.java
@@ -219,10 +219,12 @@ public class SegmentNodeState extends Record implements NodeState {
         Template template = getTemplate();
         if (JCR_PRIMARYTYPE.equals(name)) {
             PropertyState primary = template.getPrimaryType();
-            if (type == NAME) {
-                return primary.getValue(NAME);
-            } else if (primary != null) {
-                return null;
+            if (primary != null) {
+                if (type == NAME) {
+                    return primary.getValue(NAME);
+                } else {
+                    return null;
+                }
             }
         } else if (JCR_MIXINTYPES.equals(name)
                 && template.getMixinTypes() != null) {
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/security/authorization/permission/PermissionHook.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/security/authorization/permission/PermissionHook.java
index d96d234db2..57618dc17d 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/security/authorization/permission/PermissionHook.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/security/authorization/permission/PermissionHook.java
@@ -92,7 +92,7 @@ public class PermissionHook implements PostValidationHook, AccessControlConstant
         NodeBuilder rootAfter = after.builder();
 
         permissionRoot = getPermissionRoot(rootAfter);
-        bitsProvider = new PrivilegeBitsProvider(new ImmutableRoot(before));
+        bitsProvider = new PrivilegeBitsProvider(new ImmutableRoot(after));
 
         isACL = new TypePredicate(after, NT_REP_ACL);
         isACE = new TypePredicate(after, NT_REP_ACE);
