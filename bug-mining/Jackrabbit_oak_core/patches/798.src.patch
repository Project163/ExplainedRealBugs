diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/query/QueryUtil.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/query/QueryUtil.java
index f4c085655c..2cb62e00b1 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/query/QueryUtil.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/query/QueryUtil.java
@@ -22,6 +22,7 @@ import javax.jcr.RepositoryException;
 import javax.jcr.Value;
 
 import org.apache.jackrabbit.api.security.user.QueryBuilder;
+import org.apache.jackrabbit.oak.namepath.NamePathMapper;
 import org.apache.jackrabbit.oak.spi.security.ConfigurationParameters;
 import org.apache.jackrabbit.oak.spi.security.user.AuthorizableType;
 import org.apache.jackrabbit.oak.spi.security.user.UserConstants;
@@ -82,7 +83,7 @@ public final class QueryUtil {
      * @return escaped string
      */
     @Nonnull
-    public static String escapeNodeName(String string) {
+    public static String escapeNodeName(@Nonnull String string) {
         StringBuilder result = new StringBuilder();
 
         int k = 0;
@@ -107,11 +108,12 @@ public final class QueryUtil {
     }
 
     @Nonnull
-    public static String format(Value value) throws RepositoryException {
+    public static String format(@Nonnull Value value) throws RepositoryException {
+        String s;
         switch (value.getType()) {
             case PropertyType.STRING:
             case PropertyType.BOOLEAN:
-                return '\'' + value.getString() + '\'';
+                return '\'' + QueryUtil.escapeForQuery(value.getString()) + '\'';
 
             case PropertyType.LONG:
             case PropertyType.DOUBLE:
@@ -126,7 +128,12 @@ public final class QueryUtil {
     }
 
     @Nonnull
-    public static String escapeForQuery(String value) {
+    public static String escapeForQuery(@Nonnull String oakName, @Nonnull NamePathMapper namePathMapper) {
+        return escapeForQuery(namePathMapper.getJcrName(oakName));
+    }
+
+    @Nonnull
+    public static String escapeForQuery(@Nonnull String value) {
         StringBuilder ret = new StringBuilder();
         for (int i = 0; i < value.length(); i++) {
             char c = value.charAt(i);
@@ -142,7 +149,7 @@ public final class QueryUtil {
     }
 
     @Nonnull
-    public static RelationOp getCollation(QueryBuilder.Direction direction) throws RepositoryException {
+    public static RelationOp getCollation(@Nonnull QueryBuilder.Direction direction) throws RepositoryException {
         switch (direction) {
             case ASCENDING:
                 return RelationOp.GT;
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/query/XPathConditionVisitor.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/query/XPathConditionVisitor.java
index 370a109ecd..702b006506 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/query/XPathConditionVisitor.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/query/XPathConditionVisitor.java
@@ -47,9 +47,9 @@ class XPathConditionVisitor implements ConditionVisitor {
     public void visit(Condition.Node condition) throws RepositoryException {
         statement.append('(')
                 .append("jcr:like(@")
-                .append(namePathMapper.getJcrName(UserConstants.REP_PRINCIPAL_NAME))
+                .append(QueryUtil.escapeForQuery(UserConstants.REP_PRINCIPAL_NAME, namePathMapper))
                 .append(",'")
-                .append(condition.getPattern())
+                .append(QueryUtil.escapeForQuery(condition.getPattern()))
                 .append("')")
                 .append(" or ")
                 .append("jcr:like(fn:name(),'")
@@ -62,15 +62,15 @@ class XPathConditionVisitor implements ConditionVisitor {
     public void visit(Condition.Property condition) throws RepositoryException {
         RelationOp relOp = condition.getOp();
         if (relOp == RelationOp.EX) {
-            statement.append(condition.getRelPath());
+            statement.append(QueryUtil.escapeForQuery(condition.getRelPath()));
         } else if (relOp == RelationOp.LIKE) {
             statement.append("jcr:like(")
-                    .append(condition.getRelPath())
+                    .append(QueryUtil.escapeForQuery(condition.getRelPath()))
                     .append(",'")
-                    .append(condition.getPattern())
+                    .append(QueryUtil.escapeForQuery(condition.getPattern()))
                     .append("')");
         } else {
-            statement.append(condition.getRelPath())
+            statement.append(QueryUtil.escapeForQuery(condition.getRelPath()))
                     .append(condition.getOp().getOp())
                     .append(QueryUtil.format(condition.getValue()));
         }
@@ -79,9 +79,9 @@ class XPathConditionVisitor implements ConditionVisitor {
     @Override
     public void visit(Condition.Contains condition) {
         statement.append("jcr:contains(")
-                .append(condition.getRelPath())
+                .append(QueryUtil.escapeForQuery(condition.getRelPath()))
                 .append(",'")
-                .append(condition.getSearchExpr())
+                .append(QueryUtil.escapeForQuery(condition.getSearchExpr()))
                 .append("')");
     }
 
@@ -97,15 +97,15 @@ class XPathConditionVisitor implements ConditionVisitor {
         }
         if (isAdmin) {
             statement.append('@')
-                    .append(namePathMapper.getJcrName(JcrConstants.JCR_PRIMARYTYPE))
+                    .append(QueryUtil.escapeForQuery(JcrConstants.JCR_PRIMARYTYPE, namePathMapper))
                     .append("='")
-                    .append(namePathMapper.getJcrName(UserConstants.NT_REP_USER))
+                    .append(QueryUtil.escapeForQuery(UserConstants.NT_REP_USER, namePathMapper))
                     .append('\'');
         } else {
             statement.append('@')
-                    .append(namePathMapper.getJcrName(UserConstants.REP_IMPERSONATORS))
+                    .append(QueryUtil.escapeForQuery(UserConstants.REP_IMPERSONATORS, namePathMapper))
                     .append("='")
-                    .append(condition.getName())
+                    .append(QueryUtil.escapeForQuery(condition.getName()))
                     .append('\'');
         }
     }
