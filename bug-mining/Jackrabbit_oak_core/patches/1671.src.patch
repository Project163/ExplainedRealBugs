diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/util/Utils.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/util/Utils.java
index 4808cb3a39..b2e86bc0c1 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/util/Utils.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/util/Utils.java
@@ -309,7 +309,7 @@ public class Utils {
     
     public static boolean isIdFromLongPath(String id) {
         int index = id.indexOf(':');
-        return id.charAt(index + 1) == 'h';
+        return index != -1 && index < id.length() - 1 && id.charAt(index + 1) == 'h';
     }
 
     public static String getPathFromId(String id) {
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/document/util/UtilsTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/document/util/UtilsTest.java
index 7f9f984c14..69e3b730fc 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/document/util/UtilsTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/document/util/UtilsTest.java
@@ -284,4 +284,18 @@ public class UtilsTest {
         Utils.alignWithExternalRevisions(doc, c, 1);
         assertThat(c.getTime(), is(greaterThan(lastRev2.getTimestamp())));
     }
+
+    @Test
+    public void isIdFromLongPath() {
+        String path = "/test";
+        while (!Utils.isLongPath(path)) {
+            path += path;
+        }
+        String idFromLongPath = Utils.getIdFromPath(path);
+        assertTrue(Utils.isIdFromLongPath(idFromLongPath));
+        assertFalse(Utils.isIdFromLongPath("foo"));
+        assertFalse(Utils.isIdFromLongPath(NodeDocument.MIN_ID_VALUE));
+        assertFalse(Utils.isIdFromLongPath(NodeDocument.MAX_ID_VALUE));
+        assertFalse(Utils.isIdFromLongPath(":"));
+    }
 }
