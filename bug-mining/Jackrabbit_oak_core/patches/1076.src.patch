diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/UserValidator.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/UserValidator.java
index 4b56832ff7..d41c5952c3 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/UserValidator.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/security/user/UserValidator.java
@@ -102,6 +102,10 @@ class UserValidator extends DefaultValidator implements UserConstants {
                 String msg = "Invalid jcr:uuid for authorizable " + parentAfter.getName();
                 throw constraintViolation(23, msg);
             }
+        } else if (JcrConstants.JCR_PRIMARYTYPE.equals(name)) {
+            // if primary type changed to authorizable type -> need to perform
+            // validation as if a new authorizable node had been added
+            validateAuthorizable(parentAfter, UserUtil.getType(after.getValue(Type.STRING)));
         }
 
         if (isUser(parentBefore) && REP_PASSWORD.equals(name) && PasswordUtil.isPlainTextPassword(after.getValue(Type.STRING))) {
@@ -134,30 +138,7 @@ class UserValidator extends DefaultValidator implements UserConstants {
     public Validator childNodeAdded(String name, NodeState after) throws CommitFailedException {
         Tree tree = checkNotNull(parentAfter.getChild(name));
 
-        AuthorizableType type = UserUtil.getType(tree);
-        boolean isSystemUser = (type == AuthorizableType.USER) && UserUtil.isSystemUser(tree);
-        String authRoot = UserUtil.getAuthorizableRootPath(provider.getConfig(), type);
-        if (isSystemUser) {
-            String sysRelPath = provider.getConfig().getConfigValue(PARAM_SYSTEM_RELATIVE_PATH, DEFAULT_SYSTEM_RELATIVE_PATH);
-            authRoot = authRoot + '/' + sysRelPath;
-        }
-        if (authRoot != null) {
-            assertHierarchy(tree, authRoot);
-            // assert rep:principalName is present (that should actually by covered
-            // by node type validator)
-            if (TreeUtil.getString(tree, REP_PRINCIPAL_NAME) == null) {
-                throw constraintViolation(26, "Mandatory property rep:principalName missing.");
-            }
-
-            if (isSystemUser) {
-                if (TreeUtil.getString(tree, REP_PASSWORD) != null) {
-                    throw constraintViolation(27, "Attempt to set password with system user.");
-                }
-                if (tree.hasChild(REP_PWD)) {
-                    throw constraintViolation(28, "Attempt to add rep:pwd node to a system user.");
-                }
-            }
-        }
+        validateAuthorizable(tree, UserUtil.getType(tree));
         return new VisibleValidator(new UserValidator(null, tree, provider), true, true);
     }
 
@@ -206,6 +187,32 @@ class UserValidator extends DefaultValidator implements UserConstants {
         }
     }
 
+    private void validateAuthorizable(@Nonnull Tree tree, @Nonnull AuthorizableType type) throws CommitFailedException {
+        boolean isSystemUser = (type == AuthorizableType.USER) && UserUtil.isSystemUser(tree);
+        String authRoot = UserUtil.getAuthorizableRootPath(provider.getConfig(), type);
+        if (isSystemUser) {
+            String sysRelPath = provider.getConfig().getConfigValue(PARAM_SYSTEM_RELATIVE_PATH, DEFAULT_SYSTEM_RELATIVE_PATH);
+            authRoot = authRoot + '/' + sysRelPath;
+        }
+        if (authRoot != null) {
+            assertHierarchy(tree, authRoot);
+            // assert rep:principalName is present (that should actually by covered
+            // by node type validator)
+            if (TreeUtil.getString(tree, REP_PRINCIPAL_NAME) == null) {
+                throw constraintViolation(26, "Mandatory property rep:principalName missing.");
+            }
+
+            if (isSystemUser) {
+                if (TreeUtil.getString(tree, REP_PASSWORD) != null) {
+                    throw constraintViolation(27, "Attempt to set password with system user.");
+                }
+                if (tree.hasChild(REP_PWD)) {
+                    throw constraintViolation(28, "Attempt to add rep:pwd node to a system user.");
+                }
+            }
+        }
+    }
+
     private static boolean isValidUUID(@Nonnull Tree parent, @Nonnull String uuid) {
         String id = UserUtil.getAuthorizableId(parent);
         return id != null && uuid.equals(UserProvider.getContentID(id));
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/security/user/util/UserUtil.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/security/user/util/UserUtil.java
index ec85d4ec58..5cf0bde811 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/security/user/util/UserUtil.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/security/user/util/UserUtil.java
@@ -71,12 +71,17 @@ public final class UserUtil implements UserConstants {
     @CheckForNull
     public static AuthorizableType getType(@Nonnull Tree authorizableNode) {
         String ntName = TreeUtil.getPrimaryTypeName(authorizableNode);
-        if (ntName != null) {
-            if (NT_REP_GROUP.equals(ntName)) {
+        return getType(ntName);
+    }
+
+    @CheckForNull
+    public static AuthorizableType getType(@CheckForNull String primaryTypeName) {
+        if (primaryTypeName != null) {
+            if (NT_REP_GROUP.equals(primaryTypeName)) {
                 return AuthorizableType.GROUP;
-            } else if (NT_REP_USER.equals(ntName)) {
+            } else if (NT_REP_USER.equals(primaryTypeName)) {
                 return AuthorizableType.USER;
-            } else if (NT_REP_SYSTEM_USER.equals(ntName)) {
+            } else if (NT_REP_SYSTEM_USER.equals(primaryTypeName)) {
                 return AuthorizableType.USER;
             }
         }
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/security/user/UserValidatorTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/security/user/UserValidatorTest.java
index 54db8bab8e..5538356d8f 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/security/user/UserValidatorTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/security/user/UserValidatorTest.java
@@ -33,13 +33,16 @@ import org.apache.jackrabbit.oak.api.CommitFailedException;
 import org.apache.jackrabbit.oak.api.PropertyState;
 import org.apache.jackrabbit.oak.api.Tree;
 import org.apache.jackrabbit.oak.api.Type;
+import org.apache.jackrabbit.oak.plugins.identifier.IdentifierManager;
 import org.apache.jackrabbit.oak.plugins.memory.PropertyStates;
 import org.apache.jackrabbit.oak.spi.security.ConfigurationParameters;
 import org.apache.jackrabbit.oak.spi.security.user.UserConstants;
+import org.apache.jackrabbit.oak.util.NodeUtil;
 import org.apache.jackrabbit.util.Text;
 import org.junit.Before;
 import org.junit.Test;
 
+import static org.junit.Assert.assertEquals;
 import static org.junit.Assert.assertFalse;
 import static org.junit.Assert.fail;
 
@@ -329,6 +332,49 @@ public class UserValidatorTest extends AbstractSecurityTest implements UserConst
         }
     }
 
+    @Test
+    public void testCreateNestedUser() throws Exception {
+        Tree userTree = root.getTree(getTestUser().getPath());
+        NodeUtil userNode = new NodeUtil(userTree);
+        NodeUtil profile = userNode.addChild("profile", JcrConstants.NT_UNSTRUCTURED);
+        NodeUtil nested = profile.addChild("nested", UserConstants.NT_REP_USER);
+        nested.setString(UserConstants.REP_PRINCIPAL_NAME, "nested");
+        nested.setString(UserConstants.REP_AUTHORIZABLE_ID, "nested");
+        nested.setString(JcrConstants.JCR_UUID, IdentifierManager.generateUUID("nested"));
+        try {
+            root.commit();
+            fail("Creating nested users must be detected.");
+        } catch (CommitFailedException e) {
+            // success
+            assertEquals(29, e.getCode());
+        } finally {
+            root.refresh();
+        }
+    }
+
+    @Test
+    public void testCreateNestedUser2Steps() throws Exception {
+        Tree userTree = root.getTree(getTestUser().getPath());
+        NodeUtil userNode = new NodeUtil(userTree);
+        NodeUtil profile = userNode.addChild("profile", JcrConstants.NT_UNSTRUCTURED);
+        NodeUtil nested = profile.addChild("nested", JcrConstants.NT_UNSTRUCTURED);
+        nested.setString(UserConstants.REP_PRINCIPAL_NAME, "nested");
+        nested.setString(UserConstants.REP_AUTHORIZABLE_ID, "nested");
+        nested.setString(JcrConstants.JCR_UUID, IdentifierManager.generateUUID("nested"));
+        root.commit();
+
+        try {
+            nested.setString(JcrConstants.JCR_PRIMARYTYPE, UserConstants.NT_REP_USER);
+            root.commit();
+            fail("Creating nested users must be detected.");
+        } catch (CommitFailedException e) {
+            // success
+            assertEquals(29, e.getCode());
+        } finally {
+            root.refresh();
+        }
+    }
+
     private ConfigurationParameters getConfig() {
         return getUserConfiguration().getParameters();
     }
