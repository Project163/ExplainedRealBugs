diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/ReadOnlyVersionManager.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/ReadOnlyVersionManager.java
index 25301060cb..35550f95b3 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/ReadOnlyVersionManager.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/ReadOnlyVersionManager.java
@@ -111,6 +111,17 @@ public abstract class ReadOnlyVersionManager {
         return TreeUtil.getTree(getVersionStorage(), getVersionHistoryPath(uuid));
     }
 
+    /**
+     * Returns the version tree with the given uuid.
+     *
+     * @param uuid the uuid of the version tree.
+     * @return the version tree or {@code null} if there is none.
+     */
+    @CheckForNull
+    public Tree getVersion(@Nonnull String uuid) {
+        return getIdentifierManager().getTree(uuid);
+    }
+
     /**
      * Returns the path of the version history for the given {@code uuid}.
      * The returned path is relative to the version storage tree as returned
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/ReadWriteVersionManager.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/ReadWriteVersionManager.java
index d37507df84..7aecf4ab76 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/ReadWriteVersionManager.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/ReadWriteVersionManager.java
@@ -71,7 +71,8 @@ import static org.apache.jackrabbit.oak.plugins.version.VersionConstants.REP_VER
 import static org.apache.jackrabbit.oak.plugins.version.VersionConstants.VERSION_STORE_PATH;
 
 /**
- * TODO document
+ * Extends the {@link ReadOnlyVersionManager} with methods to modify the
+ * version store.
  */
 class ReadWriteVersionManager extends ReadOnlyVersionManager {
 
@@ -214,8 +215,7 @@ class ReadWriteVersionManager extends ReadOnlyVersionManager {
     public void checkout(NodeBuilder versionable) {
         versionable.setProperty(JCR_ISCHECKEDOUT, true, Type.BOOLEAN);
         PropertyState baseVersion = versionable.getProperty(JCR_BASEVERSION);
-        List<String> predecessors = Collections.singletonList(
-                baseVersion.getValue(Type.REFERENCE));
+        List<String> predecessors = Collections.singletonList(baseVersion.getValue(Type.REFERENCE));
         versionable.setProperty(JCR_PREDECESSORS, predecessors, Type.REFERENCES);
     }
 
@@ -281,39 +281,6 @@ class ReadWriteVersionManager extends ReadOnlyVersionManager {
         restore(versionable, uuidFromNode(version), selector);
     }
 
-    /**
-     * Adds a version label to the jcr:versionLabels node of the referenced
-     * version history.
-     *
-     * @param historyRelPath relative path from the jcr:versionStorage node to
-     *                       the version history node.
-     * @param label          the version label.
-     * @param versionName    the name of the version.
-     * @throws CommitFailedException if there is no such version history or if
-     * there is already a label with the given name or if the given version name
-     * is invalid.
-     */
-    public void addVersionLabel(@Nonnull String historyRelPath,
-                                @Nonnull String label,
-                                @Nonnull String versionName)
-           throws CommitFailedException {
-        NodeBuilder labels = getVersionLabelsFor(checkNotNull(historyRelPath));
-        if (labels.hasProperty(checkNotNull(label))) {
-            throw new CommitFailedException(CommitFailedException.LABEL_EXISTS,
-                    VersionExceptionCode.LABEL_EXISTS.ordinal(),
-                    "Version label " + label + " already exists on this version history");
-        }
-        NodeBuilder history = resolve(versionStorageNode, historyRelPath);
-        if (checkNotNull(versionName).equals(JCR_ROOTVERSION)
-                || !history.hasChildNode(checkNotNull(versionName))) {
-            throw new CommitFailedException(CommitFailedException.VERSION,
-                    VersionExceptionCode.NO_SUCH_VERSION.ordinal(),
-                    "Not a valid version on this history: " + versionName);
-        }
-        String uuid = uuidFromNode(history.getChildNode(versionName));
-        labels.setProperty(label, uuid, Type.REFERENCE);
-    }
-
     /**
      * Removes a version label from the jcr:versionLabels node of the referenced
      * version history.
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/Utils.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/Utils.java
index 56031d83a5..f2e972d845 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/Utils.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/Utils.java
@@ -21,11 +21,14 @@ package org.apache.jackrabbit.oak.plugins.version;
 import static com.google.common.base.Preconditions.checkNotNull;
 import static org.apache.jackrabbit.JcrConstants.JCR_PRIMARYTYPE;
 import static org.apache.jackrabbit.JcrConstants.JCR_UUID;
+import static org.apache.jackrabbit.oak.api.CommitFailedException.CONSTRAINT;
 
 import javax.annotation.Nonnull;
 
+import org.apache.jackrabbit.oak.api.CommitFailedException;
 import org.apache.jackrabbit.oak.api.PropertyState;
 import org.apache.jackrabbit.oak.api.Type;
+import org.apache.jackrabbit.oak.commons.PathUtils;
 import org.apache.jackrabbit.oak.spi.state.NodeBuilder;
 
 /**
@@ -70,4 +73,9 @@ public final class Utils {
         }
         return primaryType;
     }
+
+    static <T> T throwProtected(String path) throws CommitFailedException {
+        throw new CommitFailedException(CONSTRAINT, 100,
+                "Item is protected: " + path);
+    }
 }
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/VersionConstants.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/VersionConstants.java
index 2d0a299854..ab357b5ad8 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/VersionConstants.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/VersionConstants.java
@@ -57,21 +57,6 @@ public interface VersionConstants extends JcrConstants {
      */
     String MIX_REP_VERSIONABLE_PATHS = "rep:VersionablePaths";
 
-    /**
-     * Version operation property name to add version labels.
-     */
-    String REP_ADD_VERSION_LABELS = "rep:addVersionLabels";
-
-    /**
-     * Version operation property name to remove version labels.
-     */
-    String REP_REMOVE_VERSION_LABELS = "rep:removeVersionLabels";
-
-    /**
-     * Version operation property name to remove version(s).
-     */
-    String REP_REMOVE_VERSION = "rep:removeVersion";
-
     /**
      * Prefix of the jcr:baseVersion value for a restore.
      */
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/VersionEditorProvider.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/VersionEditorProvider.java
index 6cecb9c5bc..e09e60934d 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/VersionEditorProvider.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/VersionEditorProvider.java
@@ -22,6 +22,7 @@ import org.apache.jackrabbit.oak.spi.commit.CommitInfo;
 import org.apache.jackrabbit.oak.spi.commit.CompositeEditor;
 import org.apache.jackrabbit.oak.spi.commit.Editor;
 import org.apache.jackrabbit.oak.spi.commit.EditorProvider;
+import org.apache.jackrabbit.oak.spi.commit.SubtreeEditor;
 import org.apache.jackrabbit.oak.spi.commit.VisibleEditor;
 import org.apache.jackrabbit.oak.spi.state.NodeBuilder;
 import org.apache.jackrabbit.oak.spi.state.NodeState;
@@ -47,7 +48,9 @@ public class VersionEditorProvider implements EditorProvider {
         NodeBuilder versionStorage = system.child(JCR_VERSIONSTORAGE);
         return new VisibleEditor(new CompositeEditor(
                 new VersionEditor(versionStorage, builder, info),
-                new VersionStorageEditor(versionStorage, builder)));
+                new SubtreeEditor(
+                        new VersionStorageEditor(versionStorage, builder),
+                            JCR_SYSTEM, JCR_VERSIONSTORAGE)));
     }
 
 }
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/VersionLabelsEditor.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/VersionLabelsEditor.java
new file mode 100644
index 0000000000..cc90823af5
--- /dev/null
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/VersionLabelsEditor.java
@@ -0,0 +1,97 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.jackrabbit.oak.plugins.version;
+
+import org.apache.jackrabbit.oak.api.CommitFailedException;
+import org.apache.jackrabbit.oak.api.PropertyState;
+import org.apache.jackrabbit.oak.api.Tree;
+import org.apache.jackrabbit.oak.api.Type;
+import org.apache.jackrabbit.oak.commons.PathUtils;
+import org.apache.jackrabbit.oak.spi.commit.DefaultEditor;
+import org.apache.jackrabbit.oak.spi.commit.Editor;
+import org.apache.jackrabbit.oak.spi.state.NodeState;
+
+import static org.apache.jackrabbit.JcrConstants.JCR_ROOTVERSION;
+import static org.apache.jackrabbit.oak.api.CommitFailedException.CONSTRAINT;
+import static org.apache.jackrabbit.oak.plugins.version.Utils.throwProtected;
+
+/**
+ * Validates changes on jcr:versionLabels nodes in the version storage.
+ */
+class VersionLabelsEditor extends DefaultEditor {
+
+    private final String path;
+    private final ReadWriteVersionManager vMgr;
+
+    VersionLabelsEditor(String labelsPath,
+                        ReadWriteVersionManager versionManager) {
+        this.path = labelsPath;
+        this.vMgr = versionManager;
+    }
+
+    @Override
+    public void propertyAdded(PropertyState after)
+            throws CommitFailedException {
+        validateLabel(after);
+    }
+
+    @Override
+    public void propertyChanged(PropertyState before, PropertyState after)
+            throws CommitFailedException {
+        validateLabel(after);
+    }
+
+    @Override
+    public Editor childNodeAdded(String name, NodeState after)
+            throws CommitFailedException {
+        return throwProtected(PathUtils.concat(path, name));
+    }
+
+    @Override
+    public Editor childNodeChanged(String name,
+                                   NodeState before,
+                                   NodeState after)
+            throws CommitFailedException {
+        return throwProtected(PathUtils.concat(path, name));
+    }
+
+    @Override
+    public Editor childNodeDeleted(String name, NodeState before)
+            throws CommitFailedException {
+        return throwProtected(PathUtils.concat(path, name));
+    }
+
+    //-----------------------< internal >---------------------------------------
+
+    private void validateLabel(PropertyState label)
+            throws CommitFailedException {
+        String identifier = label.getValue(Type.REFERENCE);
+        Tree version = vMgr.getVersion(identifier);
+        if (version == null) {
+            throw new CommitFailedException(CONSTRAINT, 0,
+                    "Version label references unknown node");
+        }
+        String parent = PathUtils.getAncestorPath(path, 1);
+        String versionName = version.getName();
+        if (versionName.equals(JCR_ROOTVERSION)
+                || !PathUtils.isAncestor(parent, version.getPath())) {
+            throw new CommitFailedException(CommitFailedException.VERSION,
+                    VersionExceptionCode.NO_SUCH_VERSION.ordinal(),
+                    "Not a valid version on this history: " + versionName);
+        }
+    }
+}
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/VersionStorageEditor.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/VersionStorageEditor.java
index 821c54a6d6..6eb411d91d 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/VersionStorageEditor.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/version/VersionStorageEditor.java
@@ -16,89 +16,52 @@
  */
 package org.apache.jackrabbit.oak.plugins.version;
 
-import java.util.Arrays;
-import java.util.List;
-import java.util.SortedMap;
-
 import javax.annotation.Nonnull;
 
 import org.apache.jackrabbit.oak.api.CommitFailedException;
 import org.apache.jackrabbit.oak.api.PropertyState;
-import org.apache.jackrabbit.oak.api.Type;
-import org.apache.jackrabbit.oak.commons.PathUtils;
 import org.apache.jackrabbit.oak.spi.commit.DefaultEditor;
 import org.apache.jackrabbit.oak.spi.commit.Editor;
 import org.apache.jackrabbit.oak.spi.state.NodeBuilder;
 import org.apache.jackrabbit.oak.spi.state.NodeState;
 
-import com.google.common.collect.Lists;
-import com.google.common.collect.Maps;
-
-import static com.google.common.base.Preconditions.checkArgument;
 import static com.google.common.base.Preconditions.checkNotNull;
-import static org.apache.jackrabbit.JcrConstants.JCR_SYSTEM;
+import static org.apache.jackrabbit.JcrConstants.JCR_PRIMARYTYPE;
 import static org.apache.jackrabbit.JcrConstants.JCR_VERSIONLABELS;
-import static org.apache.jackrabbit.JcrConstants.JCR_VERSIONSTORAGE;
-import static org.apache.jackrabbit.oak.plugins.version.VersionConstants.REP_ADD_VERSION_LABELS;
-import static org.apache.jackrabbit.oak.plugins.version.VersionConstants.REP_REMOVE_VERSION;
-import static org.apache.jackrabbit.oak.plugins.version.VersionConstants.REP_REMOVE_VERSION_LABELS;
+import static org.apache.jackrabbit.oak.commons.PathUtils.concat;
+import static org.apache.jackrabbit.oak.commons.PathUtils.getDepth;
+import static org.apache.jackrabbit.oak.commons.PathUtils.relativize;
+import static org.apache.jackrabbit.oak.plugins.version.VersionConstants.VERSION_NODE_TYPE_NAMES;
+import static org.apache.jackrabbit.oak.plugins.version.VersionConstants.VERSION_STORE_NT_NAMES;
+import static org.apache.jackrabbit.oak.plugins.version.VersionConstants.VERSION_STORE_PATH;
 
 /**
- * Implements an editor watching for well known properties on the
- * /jcr:system/jcr:versionStorage node to trigger version operations (like
- * adding/removing labels or removing versions) on the protected version storage
- * tree.
- * <p>
- * This editor supports the following operations:
- * <ul>
- * <li>{@link VersionConstants#REP_ADD_VERSION_LABELS}: adds version labels to
- * existing version histories. The property is multi-valued and each value is a
- * PATH, which looks like this:
- * {@code &lt;version-history-path>/jcr:versionLabels/&lt;version-label>/&lt;version-name>}.
- * The {@code version-history-path} is a relative path to the version
- * history node starting at the /jcr:system/jcr:versionStorage node.
- * An attempt to add a version label that already exists will result in a
- * {@link CommitFailedException}. </li>
- * <li>{@link VersionConstants#REP_REMOVE_VERSION_LABELS}: removes version labels from
- * existing version histories. The property is multi-valued and each value is a
- * PATH, which looks like this:
- * {@code &lt;version-history-path>/jcr:versionLabels/&lt;version-label>/&lt;version-name>}.
- * The {@code version-history-path} is a relative path to the version
- * history node starting at the /jcr:system/jcr:versionStorage node. The
- * {@code &lt;version-name>} part is ignored when labels are removed and
- * can be anything, though it must be a valid JCR/Oak name.
- * An attempt to remove a version label, which does not exist, will result in a
- * {@link CommitFailedException}. </li>
- * <li>{@link VersionConstants#REP_REMOVE_VERSION}: : removes a version from
- * existing version histories, the associated labels and fixes the version tree.
- * The property is multi-valued and each value is a
- * PATH, which looks like this:
- * {@code &lt;version-history-path>/&lt;version-name>}.
- * The {@code version-history-path} is a relative path to the version
- * history node starting at the /jcr:system/jcr:versionStorage node.</li>
- * </ul>
+ * Validates changes on the version store.
  */
 class VersionStorageEditor extends DefaultEditor {
 
+    private static final int VERSION_HISTORY_DEPTH = 6;
+
     private final NodeBuilder versionStorageNode;
     private final NodeBuilder workspaceRoot;
+    private final NodeBuilder builder;
+    private final String path;
     private ReadWriteVersionManager vMgr;
-    private final List<String> pathRemainder;
-
-    private final SortedMap<Integer, Operation> operations = Maps.newTreeMap();
 
     VersionStorageEditor(@Nonnull NodeBuilder versionStorageNode,
                          @Nonnull NodeBuilder workspaceRoot) {
-        this(versionStorageNode, workspaceRoot,
-                Arrays.asList(JCR_SYSTEM, JCR_VERSIONSTORAGE));
+        this(versionStorageNode, workspaceRoot, versionStorageNode,
+                VERSION_STORE_PATH);
     }
 
     private VersionStorageEditor(@Nonnull NodeBuilder versionStorageNode,
-                         @Nonnull NodeBuilder workspaceRoot,
-                         @Nonnull List<String> pathRemainder) {
-        this.versionStorageNode = versionStorageNode;
-        this.workspaceRoot = workspaceRoot;
-        this.pathRemainder = checkNotNull(pathRemainder);
+                                 @Nonnull NodeBuilder workspaceRoot,
+                                 @Nonnull NodeBuilder builder,
+                                 @Nonnull String path) {
+        this.versionStorageNode = checkNotNull(versionStorageNode);
+        this.workspaceRoot = checkNotNull(workspaceRoot);
+        this.builder = checkNotNull(builder);
+        this.path = checkNotNull(path);
     }
 
     @Override
@@ -106,144 +69,92 @@ class VersionStorageEditor extends DefaultEditor {
                                    NodeState before,
                                    NodeState after)
             throws CommitFailedException {
-        if (pathRemainder.isEmpty()) {
-            return null;
+        int d = getDepth(path);
+        String p = concat(path, name);
+        if (d == VERSION_HISTORY_DEPTH
+                && name.equals(JCR_VERSIONLABELS)) {
+            return new VersionLabelsEditor(p, getVersionManager());
         }
-        if (pathRemainder.get(0).equals(name)) {
-            return new VersionStorageEditor(versionStorageNode, workspaceRoot,
-                    pathRemainder.subList(1, pathRemainder.size()));
-        } else {
+        if (d < VERSION_HISTORY_DEPTH && !isVersionStorageNode(after)) {
             return null;
         }
+        return new VersionStorageEditor(versionStorageNode, workspaceRoot,
+                builder.child(name), p);
     }
 
     @Override
-    public void propertyAdded(PropertyState after)
+    public Editor childNodeAdded(String name, NodeState after)
             throws CommitFailedException {
-        String name = after.getName();
-        if (REP_REMOVE_VERSION_LABELS.equals(name)) {
-            operations.put(1, new RemoveVersionLabels(after.getValue(Type.PATHS)));
-            versionStorageNode.removeProperty(name);
-        } else if (REP_ADD_VERSION_LABELS.equals(name)) {
-            operations.put(2, new AddVersionLabels(after.getValue(Type.PATHS)));
-            versionStorageNode.removeProperty(name);
-        } else if (REP_REMOVE_VERSION.equals(name)) {
-            operations.put(3, new RemoveVersion(after.getValue(Type.PATHS)));
-            versionStorageNode.removeProperty(name);
+        int d = getDepth(path);
+        // allow child nodes under version storage node, unless an attempt
+        // is made to create rep:versionStorage nodes manually.
+        if (d == getDepth(VERSION_STORE_PATH) &&
+                !isVersionStorageNode(after)) {
+            return null;
         }
+        return throwProtected(name);
     }
 
     @Override
-    public void leave(NodeState before, NodeState after)
+    public Editor childNodeDeleted(String name, NodeState before)
             throws CommitFailedException {
-        for (Operation op : operations.values()) {
-            op.perform();
+        int d = getDepth(path);
+        if (d == VERSION_HISTORY_DEPTH) {
+            // restore version on builder
+            builder.setChildNode(name, before);
+            String relPath = relativize(VERSION_STORE_PATH, concat(path, name));
+            // let version manager remove it properly
+            getVersionManager().removeVersion(relPath);
+            return null;
+        } else if (isVersionStorageNode(before) || d > VERSION_HISTORY_DEPTH) {
+            throwProtected(name);
         }
+        return null;
     }
 
-    //-------------------------< internal >-------------------------------------
-
-    private ReadWriteVersionManager getVersionManager() {
-        if (vMgr == null) {
-            vMgr = new ReadWriteVersionManager(versionStorageNode, workspaceRoot);
+    @Override
+    public void propertyAdded(PropertyState after)
+            throws CommitFailedException {
+        if (getDepth(path) < VERSION_HISTORY_DEPTH) {
+            return;
         }
-        return vMgr;
+        throwProtected(after.getName());
     }
 
-    interface Operation {
-
-        void perform() throws CommitFailedException;
-    }
-
-    private class AddVersionLabels implements Operation {
-
-        private Iterable<String> labelPaths;
-
-        public AddVersionLabels(Iterable<String> labelPaths) {
-            this.labelPaths = labelPaths;
-        }
-
-        @Override
-        public void perform() throws CommitFailedException {
-            for (String s : labelPaths) {
-                VersionLabel label = new VersionLabel(s);
-                getVersionManager().addVersionLabel(label.versionHistoryPath, label.label, label.versionName);
-            }
+    @Override
+    public void propertyChanged(PropertyState before, PropertyState after)
+            throws CommitFailedException {
+        if (getDepth(path) < VERSION_HISTORY_DEPTH) {
+            return;
         }
+        throwProtected(before.getName());
     }
 
-    private class RemoveVersionLabels implements Operation {
-
-        private Iterable<String> labelPaths;
-
-        public RemoveVersionLabels(Iterable<String> labelPaths) {
-            this.labelPaths = labelPaths;
-        }
-
-        @Override
-        public void perform() throws CommitFailedException {
-            for (String s : labelPaths) {
-                VersionLabel label = new VersionLabel(s);
-                getVersionManager().removeVersionLabel(label.versionHistoryPath, label.label);
-            }
+    @Override
+    public void propertyDeleted(PropertyState before)
+            throws CommitFailedException {
+        if (getDepth(path) < VERSION_HISTORY_DEPTH) {
+            return;
         }
+        throwProtected(before.getName());
     }
 
-    private class RemoveVersion implements Operation {
-
-        private final Iterable<String> versionPaths;
+    //-------------------------< internal >-------------------------------------
 
-        private RemoveVersion(@Nonnull Iterable<String> versionPaths) {
-            this.versionPaths = versionPaths;
-        }
+    private static boolean isVersionStorageNode(NodeState state) {
+        String ntName = state.getName(JCR_PRIMARYTYPE);
+        return VERSION_STORE_NT_NAMES.contains(ntName)
+                || VERSION_NODE_TYPE_NAMES.contains(ntName);
+    }
 
-        @Override
-        public void perform() throws CommitFailedException {
-            for (String path : versionPaths) {
-                getVersionManager().removeVersion(path);
-            }
+    private ReadWriteVersionManager getVersionManager() {
+        if (vMgr == null) {
+            vMgr = new ReadWriteVersionManager(versionStorageNode, workspaceRoot);
         }
+        return vMgr;
     }
 
-    private static class VersionLabel {
-
-        private final String versionHistoryPath;
-
-        private final String label;
-
-        private final String versionName;
-
-        /**
-         * @param path a label path as defined in the constructor of
-         * {@link VersionStorageEditor}.
-         * @throws IllegalArgumentException if the path is malformed
-         */
-        VersionLabel(@Nonnull String path) throws IllegalArgumentException {
-            checkArgument(!PathUtils.isAbsolute(checkNotNull(path)),
-                    "Version label path must be relative");
-            List<String> elements = Lists.newArrayList(PathUtils.elements(path));
-            // length of the path must be 7:
-            // intermediate versionstorage nodes : 3
-            // version history node : 1
-            // jcr:versionLabels : 1
-            // version label : 1
-            // version name : 1
-            if (elements.size() != 7) {
-                throw new IllegalArgumentException(
-                        "Invalid version label path: " + path);
-            }
-            StringBuilder builder = new StringBuilder();
-            String slash = "";
-            for (String element : elements.subList(0, 4)) {
-                builder.append(slash);
-                builder.append(element);
-                slash = "/";
-            }
-            versionHistoryPath = builder.toString();
-            checkArgument(elements.get(4).equals(JCR_VERSIONLABELS),
-                    "Invalid version label path: " + path);
-            label = elements.get(5);
-            versionName = elements.get(6);
-        }
+    private Editor throwProtected(String name) throws CommitFailedException {
+        return Utils.throwProtected(concat(path, name));
     }
 }
