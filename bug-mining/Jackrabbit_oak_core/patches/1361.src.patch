diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/PersistedCompactionMap.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/PersistedCompactionMap.java
index ae5c14b0af..51a065b3c0 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/PersistedCompactionMap.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/PersistedCompactionMap.java
@@ -229,9 +229,9 @@ public class PersistedCompactionMap implements PartialCompactionMap {
                     ", baseId=" + previousBaseId + '}';
             writer.writeString(mapInfo);
             writer.flush();
-            recent.clear();
         }
 
+        recent.clear();
         if (recordCount == 0) {
             entries = null;
         }
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/segment/CompactionMapTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/segment/CompactionMapTest.java
index 434eace95c..4716b65bb2 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/segment/CompactionMapTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/segment/CompactionMapTest.java
@@ -46,7 +46,6 @@ import javax.annotation.Nonnull;
 import com.google.common.collect.ImmutableList;
 import org.apache.jackrabbit.oak.plugins.segment.file.FileStore;
 import org.junit.After;
-import org.junit.Ignore;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.junit.runners.Parameterized;
@@ -213,7 +212,6 @@ public class CompactionMapTest {
      * See OAK-3511
      */
     @Test
-    @Ignore("OAK-3511")  // FIXME OAK-3511
     public void removeRecentKey() {
         compactionMap1.compress();
 
