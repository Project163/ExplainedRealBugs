diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/commit/BackgroundObserver.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/commit/BackgroundObserver.java
index 5b7d120f60..1a82959ac1 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/commit/BackgroundObserver.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/commit/BackgroundObserver.java
@@ -324,17 +324,16 @@ public class BackgroundObserver implements Observer, Closeable {
      * @throws InterruptedException **/
     boolean waitUntilStopped(int timeout, TimeUnit unit) throws InterruptedException {
         long done = System.currentTimeMillis() + unit.toMillis(timeout);
-        boolean added;
-        synchronized(this) {
-            added = queue.offer(STOP);
-            currentTask.onComplete(completionHandler);
-        }
+        boolean added = false;
         while(done > System.currentTimeMillis()) {
             synchronized(this) {
                 if (!added) {
                     added = queue.offer(STOP);
+                    if (added) {
+                        currentTask.onComplete(completionHandler);
+                    }
                 }
-                if (queue.size() == 0 || (queue.size() == 1 && queue.peek() == STOP)) {
+                if (added && queue.size() == 0) {
                     return true;
                 }
                 wait(1);
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/spi/commit/BackgroundObserverTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/spi/commit/BackgroundObserverTest.java
index a729131f0a..803335d226 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/spi/commit/BackgroundObserverTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/spi/commit/BackgroundObserverTest.java
@@ -37,7 +37,6 @@ import java.util.concurrent.ExecutorService;
 import java.util.concurrent.TimeUnit;
 
 import javax.annotation.Nonnull;
-import javax.annotation.Nullable;
 
 import org.apache.jackrabbit.oak.api.Type;
 import org.apache.jackrabbit.oak.plugins.observation.Filter;
@@ -161,7 +160,7 @@ public class BackgroundObserverTest {
 
     class Recorder implements FilteringAwareObserver {
 
-        List<Pair> includedChanges = new LinkedList<Pair>();
+        List<Pair> includedChanges = Collections.synchronizedList(new LinkedList<Pair>());
         private boolean pause;
         private boolean pausing;
 
@@ -397,6 +396,7 @@ public class BackgroundObserverTest {
         for (int i = 100; i < 10000; i += 50) {
             doTestExcludeSomeCommits(i, executor);
         }
+        executor.shutdownNow();
     }
 
     private void doTestExcludeSomeCommits(int cnt, Executor executor) throws Exception {
