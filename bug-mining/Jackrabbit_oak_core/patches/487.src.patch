diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/QueryImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/QueryImpl.java
index 89932648c3..2bcaac34ae 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/QueryImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/QueryImpl.java
@@ -605,14 +605,23 @@ public class QueryImpl implements Query {
     }
 
     /**
-     * Validate a path is syntactically correct.
+     * Validate the path is syntactically correct, and convert it to an Oak
+     * internal path (including namespace remapping if needed).
      * 
-     * @param path the path to validate
+     * @param path the path
+     * @return the the converted path
      */
-    public void validatePath(String path) {
+    public String getOakPath(String path) {
+        if (path == null) {
+            return null;
+        }
         if (!JcrPathParser.validate(path)) {
             throw new IllegalArgumentException("Invalid path: " + path);
         }
+        if (namePathMapper == null) {
+            return path;
+        }
+        return namePathMapper.getOakPath(path);
     }
 
     @Override
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/AstElement.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/AstElement.java
index bf63ad0d3b..88e5c39ba1 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/AstElement.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/AstElement.java
@@ -18,8 +18,11 @@
  */
 package org.apache.jackrabbit.oak.query.ast;
 
+import org.apache.jackrabbit.oak.api.PropertyValue;
 import org.apache.jackrabbit.oak.api.Tree;
+import org.apache.jackrabbit.oak.commons.PathUtils;
 import org.apache.jackrabbit.oak.query.QueryImpl;
+import org.apache.jackrabbit.oak.spi.query.PropertyValues;
 
 /**
  * The base class for all abstract syntax tree nodes.
@@ -47,6 +50,40 @@ abstract class AstElement {
     public void setQuery(QueryImpl query) {
         this.query = query;
     }
+    
+    /**
+     * Normalize the property name (including namespace remapping).
+     *
+     * @param propertyName the property name to normalize
+     * @return the normalized property name
+     */
+    protected String normalizePropertyName(String propertyName) {
+        // TODO normalize the path (remove superfluous ".." and "." 
+        // where possible)
+        if (query == null) {
+            return propertyName;
+        }
+        if (propertyName == null) {
+            return null;
+        }
+        int slash = propertyName.indexOf('/');
+        if (slash < 0) {
+            return normalizeNonRelativePropertyName(propertyName);
+        }
+        // relative properties
+        String relativePath = PathUtils.getParentPath(propertyName);
+        relativePath = query.getOakPath(relativePath);
+        propertyName = PathUtils.getName(propertyName);
+        propertyName = normalizeNonRelativePropertyName(propertyName);
+        return PathUtils.concat(relativePath, propertyName);
+    }
+    
+    private String normalizeNonRelativePropertyName(String propertyName) {
+        if (propertyName.equals("*")) {
+            return propertyName;
+        }
+        return query.getOakPath(propertyName);
+    }
 
     /**
      * Validate and normalize the path.
@@ -54,12 +91,24 @@ abstract class AstElement {
      * @param path the path to validate
      * @return the validated and normalized path
      */
-    protected String validateAndNormalizePath(String path) {
-        // TODO normalize the path (remove superfluous ".." and "." where possible)
-        // possibly using
-        //  PropertyValues.getOakPath(name, query.getNamePathMapper());
-        query.validatePath(path);
-        return path;
+    protected String normalizePath(String path) {
+        // TODO normalize the path (remove superfluous ".." and "." 
+        // where possible)
+        if (query == null) {
+            return path;
+        }
+        return query.getOakPath(path);
+    }
+    
+    protected PropertyValue convertValueToType(PropertyValue v, PropertyValue targetType) {
+        if (targetType.count() == 0) {
+            return v;
+        }
+        int type = targetType.getType().tag();
+        if (v.getType().tag() == type) {
+            return v;
+        }
+        return PropertyValues.convert(v, type, query.getNamePathMapper());
     }
 
     /**
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/ChildNodeImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/ChildNodeImpl.java
index 32a9b34718..3c51585d81 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/ChildNodeImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/ChildNodeImpl.java
@@ -79,13 +79,17 @@ public class ChildNodeImpl extends ConstraintImpl {
         }
         // the parent of the root is the root,
         // so we need to special case this
-        return !PathUtils.denotesRoot(local) && PathUtils.getParentPath(local).equals(parentPath);
+        if (PathUtils.denotesRoot(local)) {
+            return false;
+        }
+        String path = normalizePath(parentPath);
+        return PathUtils.getParentPath(local).equals(path);
     }
 
     @Override
     public void restrict(FilterImpl f) {
         if (selector == f.getSelector()) {
-            String path = validateAndNormalizePath(parentPath);
+            String path = normalizePath(parentPath);
             f.restrictPath(path, Filter.PathRestriction.DIRECT_CHILDREN);
         }
     }
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/ComparisonImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/ComparisonImpl.java
index d3fd401c6b..8376af55b8 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/ComparisonImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/ComparisonImpl.java
@@ -56,13 +56,6 @@ public class ComparisonImpl extends ConstraintImpl {
     public StaticOperandImpl getOperand2() {
         return operand2;
     }
-
-    public static int getType(PropertyValue p, int ifUnknown) {
-        if (p.count() > 0) {
-            return p.getType().tag();
-        }
-        return ifUnknown;
-    }
     
     @Override
     public Set<PropertyExistenceImpl> getPropertyExistenceConditions() {
@@ -100,12 +93,9 @@ public class ComparisonImpl extends ConstraintImpl {
             // even for "null <> 'x'" (same as in SQL) 
             return false;
         }
-        int v1Type = getType(p1, p2.getType().tag());
-        if (v1Type != p2.getType().tag()) {
-            // "the value of operand2 is converted to the
-            // property type of the value of operand1"
-            p2 = PropertyValues.convert(p2, v1Type, query.getNamePathMapper());
-        }
+        // "the value of operand2 is converted to the
+        // property type of the value of operand1"
+        p2 = convertValueToType(p2, p1);
         return evaluate(p1, p2);
     }
 
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/DescendantNodeImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/DescendantNodeImpl.java
index b6baf493c0..8af861f721 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/DescendantNodeImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/DescendantNodeImpl.java
@@ -61,7 +61,7 @@ public class DescendantNodeImpl extends ConstraintImpl {
         if (p == null) {
             return false;
         }
-        String path = validateAndNormalizePath(ancestorPath);
+        String path = normalizePath(ancestorPath);
         if (path == null) {
             return false;
         }
@@ -86,7 +86,7 @@ public class DescendantNodeImpl extends ConstraintImpl {
     @Override
     public void restrict(FilterImpl f) {
         if (f.getSelector() == selector) {
-            String path = validateAndNormalizePath(ancestorPath);
+            String path = normalizePath(ancestorPath);
             f.restrictPath(path, Filter.PathRestriction.ALL_CHILDREN);
         }
     }
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/DynamicOperandImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/DynamicOperandImpl.java
index 9040a1e9e5..e9cda39cdc 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/DynamicOperandImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/DynamicOperandImpl.java
@@ -80,7 +80,7 @@ public abstract class DynamicOperandImpl extends AstElement {
     public int hashCode() {
         return toString().hashCode();
     }
-
+    
     public abstract DynamicOperandImpl createCopy();
 
 }
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/EquiJoinConditionImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/EquiJoinConditionImpl.java
index 588c5aa294..5f16adae0b 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/EquiJoinConditionImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/EquiJoinConditionImpl.java
@@ -74,17 +74,13 @@ public class EquiJoinConditionImpl extends JoinConditionImpl {
         }
         // TODO what is the expected result of an equi join for multi-valued properties?
         if (!p1.isArray() && p2.isArray()) {
-            if (p1.getType().tag() != p2.getType().tag()) {
-                p1 = PropertyValues.convert(p1, p2.getType().tag(), query.getNamePathMapper());
-            }
+            p1 = convertValueToType(p1, p2);
             if (p1 != null && PropertyValues.match(p1, p2)) {
                 return true;
             }
             return false;
         } else if (p1.isArray() && !p2.isArray()) {
-            if (p1.getType().tag() != p2.getType().tag()) {
-                p2 = PropertyValues.convert(p2, p1.getType().tag(), query.getNamePathMapper());
-            }
+            p2 = convertValueToType(p2, p1);
             if (p2 != null && PropertyValues.match(p1, p2)) {
                 return true;
             }
@@ -109,7 +105,8 @@ public class EquiJoinConditionImpl extends JoinConditionImpl {
                 }
             }
             // always set the condition, even if unkown ( -> is not null)
-            f.restrictProperty(property1Name, Operator.EQUAL, p2);
+            String p1n = normalizePropertyName(property1Name);
+            f.restrictProperty(p1n, Operator.EQUAL, p2);
         }
         if (f.getSelector() == selector2) {
             PropertyValue p1 = selector1.currentProperty(property1Name);
@@ -125,7 +122,8 @@ public class EquiJoinConditionImpl extends JoinConditionImpl {
                 }
             }
             // always set the condition, even if unkown ( -> is not null)
-            f.restrictProperty(property2Name, Operator.EQUAL, p1);
+            String p2n = normalizePropertyName(property2Name);
+            f.restrictProperty(p2n, Operator.EQUAL, p1);
         }
     }
 
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/FullTextSearchImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/FullTextSearchImpl.java
index 2cf9cef7db..ea98866f6c 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/FullTextSearchImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/FullTextSearchImpl.java
@@ -96,16 +96,14 @@ public class FullTextSearchImpl extends ConstraintImpl {
         builder.append("contains(");
         builder.append(quote(selectorName));
         builder.append('.');
-        String propertyName = this.propertyName;
-        if (propertyName == null) {
-            propertyName = "*";
+        String pn = propertyName;
+        if (pn == null) {
+            pn = "*";
         }
-        
         if (relativePath != null) {
-            propertyName = relativePath + "/" + propertyName;
+            pn = relativePath + "/" + pn;
         }
-        
-        builder.append(quote(propertyName));
+        builder.append(quote(pn));
         builder.append(", ");
         builder.append(getFullTextSearchExpression());
         builder.append(')');
@@ -140,7 +138,8 @@ public class FullTextSearchImpl extends ConstraintImpl {
                 }
                 p = PathUtils.concat(relativePath, p);
             }
-            return FullTextParser.parse(p, v.getValue(Type.STRING));
+            String p2 = normalizePropertyName(p);
+            return FullTextParser.parse(p2, v.getValue(Type.STRING));
         } catch (ParseException e) {
             throw new IllegalArgumentException("Invalid expression: " + fullTextSearchExpression, e);
         }
@@ -189,7 +188,8 @@ public class FullTextSearchImpl extends ConstraintImpl {
                         PropertyValues.newString(PathUtils.getName(path)));
             }
             if (relativePath != null) {
-                path = PathUtils.concat(path, relativePath);
+                String rp = normalizePath(relativePath);
+                path = PathUtils.concat(path, rp);
             }
 
             Tree tree = getTree(path);
@@ -198,7 +198,8 @@ public class FullTextSearchImpl extends ConstraintImpl {
             }
 
             if (propertyName != null) {
-                PropertyState p = tree.getProperty(propertyName);
+                String pn = normalizePropertyName(propertyName);
+                PropertyState p = tree.getProperty(pn);
                 if (p == null) {
                     return false;
                 }
@@ -230,7 +231,8 @@ public class FullTextSearchImpl extends ConstraintImpl {
     public void restrict(FilterImpl f) {
         if (propertyName != null) {
             if (f.getSelector() == selector) {
-                f.restrictProperty(propertyName, Operator.NOT_EQUAL, null);
+                String pn = normalizePropertyName(propertyName);
+                f.restrictProperty(pn, Operator.NOT_EQUAL, null);
             }
         }
         f.restrictFulltextCondition(fullTextSearchExpression.currentValue().getValue(Type.STRING));
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/FullTextSearchScoreImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/FullTextSearchScoreImpl.java
index 731f0a08cd..4f1182d185 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/FullTextSearchScoreImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/FullTextSearchScoreImpl.java
@@ -63,7 +63,7 @@ public class FullTextSearchScoreImpl extends DynamicOperandImpl {
 
     @Override
     public PropertyValue currentProperty() {
-        PropertyValue p = selector.currentProperty(QueryImpl.JCR_SCORE);
+        PropertyValue p = selector.currentOakProperty(QueryImpl.JCR_SCORE);
         if (p == null) {
             // TODO if score() is not supported by the index, use the value 0.0?
             return PropertyValues.newDouble(0.0);
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/InImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/InImpl.java
index 9e27762241..09bb3c73f4 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/InImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/InImpl.java
@@ -87,12 +87,9 @@ public class InImpl extends ConstraintImpl {
                 // if the property doesn't exist, the result is false
                 continue;
             }
-            int v1Type = ComparisonImpl.getType(p1, p2.getType().tag());
-            if (v1Type != p2.getType().tag()) {
-                // "the value of operand2 is converted to the
-                // property type of the value of operand1"
-                p2 = PropertyValues.convert(p2, v1Type, query.getNamePathMapper());
-            }
+            // "the value of operand2 is converted to the
+            // property type of the value of operand1"
+            p2 = convertValueToType(p2, p1);
             if (PropertyValues.match(p1, p2)) {
                 return true;
             }
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/LengthImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/LengthImpl.java
index e3356db8f1..fc92ec2743 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/LengthImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/LengthImpl.java
@@ -68,6 +68,7 @@ public class LengthImpl extends DynamicOperandImpl {
         if (p == null) {
             return null;
         }
+        // TODO namespace remapping?
         if (!p.isArray()) {
             long length = p.size();
             return PropertyValues.newLong(length);
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/LiteralImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/LiteralImpl.java
index d73acd920a..b40dd832fe 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/LiteralImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/LiteralImpl.java
@@ -58,6 +58,7 @@ public class LiteralImpl extends StaticOperandImpl {
 
     @Override
     PropertyValue currentValue() {
+        // TODO namespace remapping?
         return value;
     }
     
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/NodeLocalNameImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/NodeLocalNameImpl.java
index 4e6ac36e4e..a2e3c8f39c 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/NodeLocalNameImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/NodeLocalNameImpl.java
@@ -71,6 +71,7 @@ public class NodeLocalNameImpl extends DynamicOperandImpl {
         int colon = name.indexOf(':');
         // TODO LOCALNAME: evaluation of local name might not be correct
         String localName = colon < 0 ? name : name.substring(colon + 1);
+        // TODO reverse namespace remapping?
         return PropertyValues.newString(localName);
     }
 
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/NodeNameImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/NodeNameImpl.java
index da547c0d74..d2e042169d 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/NodeNameImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/NodeNameImpl.java
@@ -77,6 +77,7 @@ public class NodeNameImpl extends DynamicOperandImpl {
     public PropertyValue currentProperty() {
         String path = selector.currentPath();
         String name = PathUtils.getName(path);
+        // TODO reverse namespace remapping?
         return PropertyValues.newName(name);
     }
 
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/PropertyExistenceImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/PropertyExistenceImpl.java
index bad717107e..08c3d3fe11 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/PropertyExistenceImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/PropertyExistenceImpl.java
@@ -81,7 +81,8 @@ public class PropertyExistenceImpl extends ConstraintImpl {
     @Override
     public void restrict(FilterImpl f) {
         if (f.getSelector() == selector) {
-            f.restrictProperty(propertyName, Operator.NOT_EQUAL, null);
+            String pn = normalizePropertyName(propertyName);
+            f.restrictProperty(pn, Operator.NOT_EQUAL, null);
         }
     }
 
@@ -94,8 +95,9 @@ public class PropertyExistenceImpl extends ConstraintImpl {
     
     @Override
     public int hashCode() {
+        String pn = normalizePropertyName(propertyName);
         return ((selectorName == null) ? 0 : selectorName.hashCode()) * 31 +
-                ((propertyName == null) ? 0 : propertyName.hashCode());
+                ((pn == null) ? 0 : pn.hashCode());
     }
 
     @Override
@@ -106,8 +108,12 @@ public class PropertyExistenceImpl extends ConstraintImpl {
             return false;
         }
         PropertyExistenceImpl other = (PropertyExistenceImpl) obj;
-        return equalsStrings(selectorName, other.selectorName) &&
-                equalsStrings(propertyName, other.propertyName);
+        if (!equalsStrings(selectorName, other.selectorName)) {
+            return false;
+        }
+        String pn = normalizePropertyName(propertyName);
+        String pn2 = normalizePropertyName(other.propertyName);
+        return equalsStrings(pn, pn2);
     }
     
     private static boolean equalsStrings(String a, String b) {
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/PropertyInexistenceImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/PropertyInexistenceImpl.java
index 1edf613594..9c7e6c1124 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/PropertyInexistenceImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/PropertyInexistenceImpl.java
@@ -51,16 +51,17 @@ public class PropertyInexistenceImpl extends ConstraintImpl {
 
     @Override
     public boolean evaluate() {
-        boolean relative = propertyName.indexOf('/') >= 0;
-        if (!relative) {
+        boolean isRelative = propertyName.indexOf('/') >= 0;
+        if (!isRelative) {
             return selector.currentProperty(propertyName) == null;
         }
         Tree t = selector.currentTree();
         if (t == null) {
             return true;
         }
-        String relativePath = PathUtils.getParentPath(propertyName);
-        String name = PathUtils.getName(propertyName);
+        String pn = normalizePath(propertyName);
+        String relativePath = PathUtils.getParentPath(pn);
+        String name = PathUtils.getName(pn);
         for (String p : PathUtils.elements(relativePath)) {
             if (t == null || !t.exists()) {
                 return false;
@@ -140,8 +141,9 @@ public class PropertyInexistenceImpl extends ConstraintImpl {
     
     @Override
     public int hashCode() {
+        String pn = normalizePropertyName(propertyName);
         return ((selectorName == null) ? 0 : selectorName.hashCode()) * 31 +
-                ((propertyName == null) ? 0 : propertyName.hashCode());
+                ((pn == null) ? 0 : pn.hashCode());
     }
 
     @Override
@@ -152,8 +154,12 @@ public class PropertyInexistenceImpl extends ConstraintImpl {
             return false;
         }
         PropertyInexistenceImpl other = (PropertyInexistenceImpl) obj;
-        return equalsStrings(selectorName, other.selectorName) &&
-                equalsStrings(propertyName, other.propertyName);
+        if (!equalsStrings(selectorName, other.selectorName)) {
+            return false;
+        }
+        String pn = normalizePropertyName(propertyName);
+        String pn2 = normalizePropertyName(other.propertyName);
+        return equalsStrings(pn, pn2);
     }
     
     private static boolean equalsStrings(String a, String b) {
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/PropertyValueImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/PropertyValueImpl.java
index 5739b7c1f8..83cb9f0a9c 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/PropertyValueImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/PropertyValueImpl.java
@@ -118,10 +118,11 @@ public class PropertyValueImpl extends DynamicOperandImpl {
         }
         if (!asterisk) {
             String name = PathUtils.getName(propertyName);
-            if (!tree.hasProperty(name)) {
+            name = normalizePropertyName(name);
+            PropertyState p = tree.getProperty(name);
+            if (p == null) {
                 return null;
             }
-            PropertyState p = tree.getProperty(name);
             return matchesPropertyType(p) ? PropertyValues.create(p) : null;
         }
         // asterisk - create a multi-value property
@@ -171,9 +172,10 @@ public class PropertyValueImpl extends DynamicOperandImpl {
                 // not supported
                 return;
             }
-            f.restrictProperty(propertyName, operator, v);
+            String pn = normalizePropertyName(propertyName);            
+            f.restrictProperty(pn, operator, v);
             if (propertyType != PropertyType.UNDEFINED) {
-                f.restrictPropertyType(propertyName, operator, propertyType);
+                f.restrictPropertyType(pn, operator, propertyType);
             }
         }
     }
@@ -181,7 +183,8 @@ public class PropertyValueImpl extends DynamicOperandImpl {
     @Override
     public void restrictList(FilterImpl f, List<PropertyValue> list) {
         if (f.getSelector() == selector) {
-            f.restrictPropertyAsList(propertyName, list);
+            String pn = normalizePropertyName(propertyName);            
+            f.restrictPropertyAsList(pn, list);
         }
     }
 
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SameNodeImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SameNodeImpl.java
index 45b425065b..e7bf94f113 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SameNodeImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SameNodeImpl.java
@@ -41,8 +41,7 @@ public class SameNodeImpl extends ConstraintImpl {
 
     @Override
     public boolean evaluate() {
-        String p = validateAndNormalizePath(path);
-        // TODO normalize paths
+        String p = normalizePath(path);
         return selector.currentPath().equals(p);
     }
     
@@ -79,10 +78,9 @@ public class SameNodeImpl extends ConstraintImpl {
     @Override
     public void restrict(FilterImpl f) {
         if (f.getSelector() == selector) {
-            String p = validateAndNormalizePath(path);
+            String p = normalizePath(path);
             f.restrictPath(p, Filter.PathRestriction.EXACT);
         }
-        // TODO validate absolute path
     }
 
     @Override
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SameNodeJoinConditionImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SameNodeJoinConditionImpl.java
index 550466251d..44bc76e251 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SameNodeJoinConditionImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SameNodeJoinConditionImpl.java
@@ -69,11 +69,11 @@ public class SameNodeJoinConditionImpl extends JoinConditionImpl {
     public boolean evaluate() {
         String p1 = selector1.currentPath();
         String p2 = selector2.currentPath();
-        // TODO normalize paths; support more complex relative path (".." and so on)
         if (selector2Path.equals(".")) {
             return p1.equals(p2);
         }
-        String p = PathUtils.concat(p2, selector2Path);
+        String pn = normalizePath(selector2Path);
+        String p = PathUtils.concat(p2, pn);
         return p.equals(p1);
     }
 
@@ -90,8 +90,8 @@ public class SameNodeJoinConditionImpl extends JoinConditionImpl {
                 if (selector2Path.equals(".")) {
                     f.restrictPath(p2, Filter.PathRestriction.EXACT);
                 } else {
-                    // TODO normalize paths; support more complex relative path (".." and so on)
-                    String p = PathUtils.concat(p2, selector2Path);
+                    String pn = normalizePath(selector2Path);
+                    String p = PathUtils.concat(p2, pn);
                     f.restrictPath(p, Filter.PathRestriction.EXACT);
                 }
             }
@@ -106,8 +106,6 @@ public class SameNodeJoinConditionImpl extends JoinConditionImpl {
             if (p1 != null) {
                 if (selector2Path.equals(".")) {
                     f.restrictPath(p1, Filter.PathRestriction.EXACT);
-                } else {
-                    // TODO normalize paths; support relative path (".." and so on)
                 }
             }
         }
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SelectorImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SelectorImpl.java
index e1b7f68a2b..196edbe0fa 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SelectorImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SelectorImpl.java
@@ -74,17 +74,19 @@ public class SelectorImpl extends SourceImpl {
     private final boolean matchesAllTypes;
 
     /**
-     * all of the matching supertypes, or empty if the {@link #matchesAllTypes} flag is set
+     * All of the matching supertypes, or empty if the {@link #matchesAllTypes}
+     * flag is set
      */
     private final Set<String> supertypes;
 
     /**
-     * all of the matching primary subtypes, or empty if the {@link #matchesAllTypes} flag is set
+     * All of the matching primary subtypes, or empty if the
+     * {@link #matchesAllTypes} flag is set
      */
     private final Set<String> primaryTypes;
 
     /**
-     * all of the matching mixin types, or empty if the {@link #matchesAllTypes}
+     * All of the matching mixin types, or empty if the {@link #matchesAllTypes}
      * flag is set
      */
     private final Set<String> mixinTypes;
@@ -333,7 +335,7 @@ public class SelectorImpl extends SourceImpl {
     }
 
     /**
-     * Get the current absolute path (including workspace name)
+     * Get the current absolute Oak path (normalized).
      *
      * @return the path
      */
@@ -349,7 +351,18 @@ public class SelectorImpl extends SourceImpl {
         return getTree(path);
     }
 
+    /**
+     * The value for the given selector for the current node.
+     * 
+     * @param propertyName the JCR (not normalized) property name
+     * @return the property value
+     */
     public PropertyValue currentProperty(String propertyName) {
+        String pn = normalizePropertyName(propertyName);
+        return currentOakProperty(pn);
+    }
+    
+    public PropertyValue currentOakProperty(String propertyName) {
         boolean relative = propertyName.indexOf('/') >= 0;
         Tree t = currentTree();
         if (relative) {
