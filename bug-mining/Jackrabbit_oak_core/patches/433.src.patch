diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/aggregate/AggregateIndex.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/aggregate/AggregateIndex.java
index aa516250cc..ca575cedee 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/aggregate/AggregateIndex.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/aggregate/AggregateIndex.java
@@ -16,11 +16,19 @@
  */
 package org.apache.jackrabbit.oak.plugins.index.aggregate;
 
+import java.util.ArrayList;
 import java.util.HashSet;
 import java.util.Iterator;
 import java.util.NoSuchElementException;
 import java.util.Set;
-
+import java.util.concurrent.atomic.AtomicReference;
+
+import org.apache.jackrabbit.oak.commons.PathUtils;
+import org.apache.jackrabbit.oak.query.fulltext.FullTextAnd;
+import org.apache.jackrabbit.oak.query.fulltext.FullTextExpression;
+import org.apache.jackrabbit.oak.query.fulltext.FullTextOr;
+import org.apache.jackrabbit.oak.query.fulltext.FullTextTerm;
+import org.apache.jackrabbit.oak.query.fulltext.FullTextVisitor;
 import org.apache.jackrabbit.oak.query.index.FilterImpl;
 import org.apache.jackrabbit.oak.query.index.IndexRowImpl;
 import org.apache.jackrabbit.oak.spi.query.Cursor;
@@ -30,9 +38,7 @@ import org.apache.jackrabbit.oak.spi.query.IndexRow;
 import org.apache.jackrabbit.oak.spi.query.QueryIndex.FulltextQueryIndex;
 import org.apache.jackrabbit.oak.spi.state.NodeState;
 
-import com.google.common.base.Predicate;
 import com.google.common.base.Predicates;
-import com.google.common.collect.ImmutableSet;
 import com.google.common.collect.Iterators;
 
 /**
@@ -70,9 +76,61 @@ public class AggregateIndex implements FulltextQueryIndex {
         FilterImpl f = new FilterImpl(filter);
         // disables node type checks for now
         f.setMatchesAllTypes(true);
+
+        // TODO OAK-828
+        // FullTextExpression constraint = filter.getFullTextConstraint();
+        // constraint = getFlatConstraint(constraint);
+        // f.setFullTextConstraint(constraint);
+
         return f;
     }
 
+    static FullTextExpression getFlatConstraint(
+            FullTextExpression constraint) {
+        if (constraint == null) {
+            return null;
+        }
+        final AtomicReference<FullTextExpression> result = new AtomicReference<FullTextExpression>();
+        constraint.accept(new FullTextVisitor() {
+            
+            @Override
+            public boolean visit(FullTextTerm term) {
+                String p = term.getPropertyName();
+                if (p != null) {
+                    if (PathUtils.getDepth(p) > 1) {
+                        // remove indirection
+                        String name = PathUtils.getName(p);
+                        term = new FullTextTerm(name, term);
+                    }
+                }
+                result.set(term);
+                return true;
+            }
+
+            @Override
+            public boolean visit(FullTextAnd and) {
+                ArrayList<FullTextExpression> list = new ArrayList<FullTextExpression>();
+                for (FullTextExpression e : and.list) {
+                    list.add(getFlatConstraint(e));
+                }
+                result.set(new FullTextAnd(list));
+                return true;
+            }
+
+            @Override
+            public boolean visit(FullTextOr or) {
+                ArrayList<FullTextExpression> list = new ArrayList<FullTextExpression>();
+                for (FullTextExpression e : or.list) {
+                    list.add(getFlatConstraint(e));
+                }
+                result.set(new FullTextOr(list));
+                return true;
+            }
+            
+        });
+        return result.get();
+    }
+
     @Override
     public String getPlan(Filter filter, NodeState rootState) {
         if (baseIndex == null) {
@@ -148,7 +206,7 @@ public class AggregateIndex implements FulltextQueryIndex {
                 IndexRow row = cursor.next();
                 String path = row.getPath();
                 aggregates = Iterators.filter(Iterators.concat(
-                        ImmutableSet.of(path).iterator(),
+                        Iterators.singletonIterator(path),
                         aggregator.getParents(rootState, path)), Predicates
                         .not(Predicates.in(seenPaths)));
                 fetchNext();
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/nodetype/NodeTypeIndex.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/nodetype/NodeTypeIndex.java
index 70f27e8519..8ffa57bc8f 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/nodetype/NodeTypeIndex.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/nodetype/NodeTypeIndex.java
@@ -37,6 +37,7 @@ class NodeTypeIndex implements QueryIndex, JcrConstants {
 
     @Override
     public double getCost(Filter filter, NodeState root) {
+        // TODO don't call getCost for such queries
         if (filter.getFullTextConstraint() != null) {
             // not an appropriate index for full-text search
             return Double.POSITIVE_INFINITY;
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/property/PropertyIndex.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/property/PropertyIndex.java
index c90ca361c6..f7fd241e6a 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/property/PropertyIndex.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/property/PropertyIndex.java
@@ -122,6 +122,7 @@ class PropertyIndex implements QueryIndex {
 
     @Override
     public double getCost(Filter filter, NodeState root) {
+        // TODO don't call getCost for such queries
         if (filter.getFullTextConstraint() != null) {
             // not an appropriate index for full-text search
             return Double.POSITIVE_INFINITY;
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/fulltext/FullTextTerm.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/fulltext/FullTextTerm.java
index 85fb2568b1..2d33a2964c 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/fulltext/FullTextTerm.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/fulltext/FullTextTerm.java
@@ -29,6 +29,15 @@ public class FullTextTerm extends FullTextExpression {
     private final String boost;
     private final LikePattern like;
 
+    public FullTextTerm(String propertyName, FullTextTerm copy) {
+        this.propertyName = propertyName;
+        this.not = copy.not;
+        this.text = copy.text;
+        this.filteredText = copy.filteredText;
+        this.boost = copy.boost;
+        this.like = copy.like;
+    }    
+
     public FullTextTerm(String propertyName, String text, boolean not, boolean escaped, String boost) {
         this.propertyName = propertyName;
         this.text = text;
