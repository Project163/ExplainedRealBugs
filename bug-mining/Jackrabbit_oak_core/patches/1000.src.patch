diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/IndexUpdate.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/IndexUpdate.java
index cc779851b9..78cc37e31c 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/IndexUpdate.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/IndexUpdate.java
@@ -28,6 +28,9 @@ import static org.apache.jackrabbit.oak.plugins.index.IndexConstants.REINDEX_ASY
 import static org.apache.jackrabbit.oak.plugins.index.IndexConstants.REINDEX_PROPERTY_NAME;
 import static org.apache.jackrabbit.oak.plugins.index.IndexConstants.TYPE_PROPERTY_NAME;
 import static org.apache.jackrabbit.oak.plugins.memory.EmptyNodeState.MISSING_NODE;
+import static org.apache.jackrabbit.oak.spi.commit.CompositeEditor.compose;
+import static org.apache.jackrabbit.oak.spi.commit.EditorDiff.process;
+import static org.apache.jackrabbit.oak.spi.commit.VisibleEditor.wrap;
 
 import java.util.HashMap;
 import java.util.List;
@@ -39,16 +42,14 @@ import javax.annotation.Nonnull;
 
 import org.apache.jackrabbit.oak.api.CommitFailedException;
 import org.apache.jackrabbit.oak.api.PropertyState;
-import org.apache.jackrabbit.oak.spi.commit.CompositeEditor;
 import org.apache.jackrabbit.oak.spi.commit.Editor;
-import org.apache.jackrabbit.oak.spi.commit.EditorDiff;
 import org.apache.jackrabbit.oak.spi.state.NodeBuilder;
 import org.apache.jackrabbit.oak.spi.state.NodeState;
-
-import com.google.common.base.Objects;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
+import com.google.common.base.Objects;
+
 public class IndexUpdate implements Editor {
     private final Logger log = LoggerFactory.getLogger(getClass());
 
@@ -118,8 +119,8 @@ public class IndexUpdate implements Editor {
         }
 
         // no-op when reindex is empty
-        CommitFailedException exception = EditorDiff.process(
-                CompositeEditor.compose(reindex.values()), MISSING_NODE, after);
+        CommitFailedException exception = process(
+                wrap(compose(reindex.values())), MISSING_NODE, after);
         if (exception != null) {
             throw exception;
         }
@@ -231,7 +232,7 @@ public class IndexUpdate implements Editor {
                 children.add(child);
             }
         }
-        return CompositeEditor.compose(children);
+        return compose(children);
     }
 
     @Override @Nonnull
@@ -246,7 +247,7 @@ public class IndexUpdate implements Editor {
                 children.add(child);
             }
         }
-        return CompositeEditor.compose(children);
+        return compose(children);
     }
 
     @Override @CheckForNull
@@ -259,7 +260,7 @@ public class IndexUpdate implements Editor {
                 children.add(child);
             }
         }
-        return CompositeEditor.compose(children);
+        return compose(children);
     }
 
     protected Set<String> getReindexedDefinitions() {
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/index/IndexUpdateTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/index/IndexUpdateTest.java
index 27c5c106a8..b53429b199 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/index/IndexUpdateTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/index/IndexUpdateTest.java
@@ -35,6 +35,7 @@ import org.apache.jackrabbit.oak.api.PropertyState;
 import org.apache.jackrabbit.oak.api.Type;
 import org.apache.jackrabbit.oak.plugins.index.property.PropertyIndexEditorProvider;
 import org.apache.jackrabbit.oak.plugins.index.property.PropertyIndexLookup;
+import org.apache.jackrabbit.oak.plugins.memory.EmptyNodeState;
 import org.apache.jackrabbit.oak.query.QueryEngineSettings;
 import org.apache.jackrabbit.oak.query.ast.SelectorImpl;
 import org.apache.jackrabbit.oak.query.index.FilterImpl;
@@ -205,6 +206,38 @@ public class IndexUpdateTest {
         assertEquals(ImmutableSet.of("testRoot"), find(lookup, "foo", "abc"));
     }
 
+    @Test
+    public void testReindexHidden() throws Exception {
+        NodeState before = EmptyNodeState.EMPTY_NODE;
+        NodeBuilder builder = before.builder();
+        builder.child(":testRoot").setProperty("foo", "abc");
+        createIndexDefinition(builder.child(INDEX_DEFINITIONS_NAME),
+                "rootIndex", false, false, ImmutableSet.of("foo"), null);
+        NodeState after = builder.getNodeState();
+        NodeState indexed = HOOK.processCommit(before, after, CommitInfo.EMPTY);
+
+        // first check that the index content nodes exist
+        NodeState ns = checkPathExists(indexed, INDEX_DEFINITIONS_NAME,
+                "rootIndex");
+        NodeState index = checkPathExists(ns, INDEX_CONTENT_NODE_NAME);
+        PropertyState ps = ns.getProperty(REINDEX_PROPERTY_NAME);
+        assertNotNull(ps);
+        assertFalse(ps.getValue(Type.BOOLEAN));
+        assertFalse(index.getChildNodeCount(1) > 0);
+
+        before = indexed;
+        builder = before.builder();
+        builder.child(INDEX_DEFINITIONS_NAME).child("rootIndex")
+                .setProperty("reindex", true);
+        after = builder.getNodeState();
+        indexed = HOOK.processCommit(before, after, CommitInfo.EMPTY);
+        index = checkPathExists(ns, INDEX_CONTENT_NODE_NAME);
+        ps = ns.getProperty(REINDEX_PROPERTY_NAME);
+        assertNotNull(ps);
+        assertFalse(ps.getValue(Type.BOOLEAN));
+        assertFalse(index.getChildNodeCount(1) > 0);
+    }
+
     @Test
     public void testIndexDefinitions() throws Exception {
         createIndexDefinition(builder.child(INDEX_DEFINITIONS_NAME),
