diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentNodeStoreService.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentNodeStoreService.java
index 4e804c9b79..0ae57d8a22 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentNodeStoreService.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/DocumentNodeStoreService.java
@@ -155,6 +155,7 @@ public class DocumentNodeStoreService {
     private static final long DEFAULT_MAX_REPLICATION_LAG = TimeUnit.HOURS.toSeconds(6);
     public static final String PROP_REPLICATION_LAG = "maxReplicationLagInSecs";
     private long maxReplicationLagInSecs = DEFAULT_MAX_REPLICATION_LAG;
+    private boolean customBlobStore;
 
     @Activate
     protected void activate(ComponentContext context, Map<String, ?> config) throws Exception {
@@ -164,9 +165,9 @@ public class DocumentNodeStoreService {
         executor.start(whiteboard);
         this.maxReplicationLagInSecs = PropertiesUtil.toLong(config.get(PROP_REPLICATION_LAG),
                 DEFAULT_MAX_REPLICATION_LAG);
+        this.customBlobStore = PropertiesUtil.toBoolean(prop(CUSTOM_BLOB_STORE), false);
 
-        if (blobStore == null &&
-                PropertiesUtil.toBoolean(prop(CUSTOM_BLOB_STORE), false)) {
+        if (blobStore == null && customBlobStore) {
             log.info("BlobStore use enabled. DocumentNodeStoreService would be initialized when "
                     + "BlobStore would be available");
         } else {
@@ -194,7 +195,7 @@ public class DocumentNodeStoreService {
                 offHeapCacheSize(offHeapCache * MB);
 
         //Set blobstore before setting the DB
-        if (blobStore != null) {
+        if (blobStore != null && customBlobStore) {
             mkBuilder.setBlobStore(blobStore);
         }
 
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentNodeStoreService.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentNodeStoreService.java
index 5078d1f584..88f70f340c 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentNodeStoreService.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentNodeStoreService.java
@@ -101,6 +101,7 @@ public class SegmentNodeStoreService extends ProxyNodeStore
     private Registration revisionGCRegistration;
     private Registration blobGCRegistration;
     private WhiteboardExecutor executor;
+    private boolean customBlobStore;
 
     @Override
     protected synchronized SegmentNodeStore getNodeStore() {
@@ -111,9 +112,9 @@ public class SegmentNodeStoreService extends ProxyNodeStore
     @Activate
     private void activate(ComponentContext context) throws IOException {
         this.context = context;
+        this.customBlobStore = Boolean.parseBoolean(lookup(context, CUSTOM_BLOB_STORE));
 
-        if(blobStore == null &&
-                Boolean.parseBoolean(lookup(context, CUSTOM_BLOB_STORE))){
+        if(blobStore == null && customBlobStore){
             log.info("BlobStore use enabled. SegmentNodeStore would be initialized when BlobStore would be available");
         }else{
             registerNodeStore();
@@ -148,10 +149,18 @@ public class SegmentNodeStoreService extends ProxyNodeStore
             size = System.getProperty(SIZE, "256");
         }
 
-        store = new FileStore(
-                blobStore,
-                new File(directory),
-                Integer.parseInt(size), "64".equals(mode));
+        boolean memoryMapping = "64".equals(mode);
+        if (customBlobStore) {
+            store = new FileStore(
+                    blobStore,
+                    new File(directory),
+                    Integer.parseInt(size), memoryMapping);
+        } else {
+            store = new FileStore(
+                    new File(directory),
+                    Integer.parseInt(size), memoryMapping);
+        }
+
 
         delegate = new SegmentNodeStore(store);
         observerTracker = new ObserverTracker(delegate);
@@ -174,13 +183,13 @@ public class SegmentNodeStoreService extends ProxyNodeStore
         revisionGCRegistration = registerMBean(whiteboard, RevisionGCMBean.class, revisionGC,
                 RevisionGCMBean.TYPE, "Segment node store revision garbage collection");
 
-        if (blobStore instanceof GarbageCollectableBlobStore) {
+        if (store.getBlobStore() instanceof GarbageCollectableBlobStore) {
             BlobGarbageCollector gc = new BlobGarbageCollector() {
                 @Override
                 public void collectGarbage() throws Exception {
                     MarkSweepGarbageCollector gc = new MarkSweepGarbageCollector(
                             new SegmentBlobReferenceRetriever(store.getTracker()),
-                            (GarbageCollectableBlobStore) blobStore,
+                            (GarbageCollectableBlobStore) store.getBlobStore(),
                             executor);
                     gc.collectGarbage();
                 }
