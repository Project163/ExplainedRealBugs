diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/nodetype/write/NodeTypeRegistryTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/nodetype/write/NodeTypeRegistryTest.java
index 9b93e4bc84..1d82fe0d9c 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/nodetype/write/NodeTypeRegistryTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/plugins/nodetype/write/NodeTypeRegistryTest.java
@@ -19,6 +19,7 @@ package org.apache.jackrabbit.oak.plugins.nodetype.write;
 import static com.google.common.base.Preconditions.checkArgument;
 import static com.google.common.base.Preconditions.checkNotNull;
 import static com.google.common.collect.ImmutableList.of;
+import static java.nio.charset.StandardCharsets.UTF_8;
 import static org.apache.jackrabbit.JcrConstants.JCR_MIXINTYPES;
 import static org.apache.jackrabbit.JcrConstants.JCR_PRIMARYTYPE;
 import static org.apache.jackrabbit.JcrConstants.NT_FOLDER;
@@ -38,12 +39,23 @@ import static org.apache.jackrabbit.oak.plugins.nodetype.NodeTypeConstants.MIX_I
 import java.io.Closeable;
 import java.io.IOException;
 import java.io.InputStream;
+import java.io.InputStreamReader;
+import java.util.List;
 
 import javax.annotation.Nonnull;
+import javax.jcr.NamespaceRegistry;
 import javax.jcr.NoSuchWorkspaceException;
+import javax.jcr.ValueFactory;
+import javax.jcr.nodetype.NodeTypeDefinition;
+import javax.jcr.nodetype.NodeTypeManager;
+import javax.jcr.nodetype.NodeTypeTemplate;
 import javax.security.auth.login.LoginException;
 
 import com.google.common.base.Strings;
+
+import org.apache.jackrabbit.commons.cnd.CompactNodeTypeDefReader;
+import org.apache.jackrabbit.commons.cnd.DefinitionBuilderFactory;
+import org.apache.jackrabbit.commons.cnd.TemplateBuilderFactory;
 import org.apache.jackrabbit.oak.InitialContent;
 import org.apache.jackrabbit.oak.Oak;
 import org.apache.jackrabbit.oak.api.CommitFailedException;
@@ -52,14 +64,20 @@ import org.apache.jackrabbit.oak.api.ContentSession;
 import org.apache.jackrabbit.oak.api.Root;
 import org.apache.jackrabbit.oak.api.Tree;
 import org.apache.jackrabbit.oak.api.Type;
+import org.apache.jackrabbit.oak.namepath.GlobalNameMapper;
+import org.apache.jackrabbit.oak.namepath.NamePathMapperImpl;
+import org.apache.jackrabbit.oak.plugins.name.ReadOnlyNamespaceRegistry;
+import org.apache.jackrabbit.oak.plugins.nodetype.NodeTypeDefDiff;
+import org.apache.jackrabbit.oak.plugins.nodetype.ReadOnlyNodeTypeManager;
 import org.apache.jackrabbit.oak.plugins.nodetype.TypeEditorProvider;
+import org.apache.jackrabbit.oak.plugins.value.jcr.ValueFactoryImpl;
 import org.apache.jackrabbit.oak.spi.security.OpenSecurityProvider;
 import org.apache.jackrabbit.oak.plugins.tree.TreeUtil;
 import org.junit.After;
 import org.junit.Before;
+import org.junit.Ignore;
 import org.junit.Test;
 
-
 import static org.junit.Assert.assertFalse;
 import static org.junit.Assert.assertTrue;
 
@@ -153,4 +171,58 @@ public class NodeTypeRegistryTest {
         assertTrue(test2.getChild(JCR_CONTENT).hasProperty(JCR_UUID));
 
     }
+
+    @Ignore("OAK-6440")
+    @Test
+    public void registerNodeType() throws Exception {
+        registerNodeType(root, "oak6440-1.cnd");
+        NodeTypeManager readOnlyNtMgr = new ReadOnlyNodeTypeManager() {
+            private Root r = session.getLatestRoot();
+            @Override
+            protected Tree getTypes() {
+                return r.getTree(NODE_TYPES_PATH);
+            }
+        };
+        NodeTypeManager ntMgr = new ReadWriteNodeTypeManager() {
+            @Override
+            protected Tree getTypes() {
+                return root.getTree(NODE_TYPES_PATH);
+            }
+
+            @Nonnull
+            @Override
+            protected Root getWriteRoot() {
+                return root;
+            }
+        };
+        ValueFactory valueFactory = new ValueFactoryImpl(
+                root, new NamePathMapperImpl(new GlobalNameMapper(root)));
+        NamespaceRegistry nsRegistry = new ReadOnlyNamespaceRegistry(root);
+        DefinitionBuilderFactory<NodeTypeTemplate, NamespaceRegistry> factory
+                = new TemplateBuilderFactory(ntMgr, valueFactory, nsRegistry);
+        InputStream in = NodeTypeRegistryTest.class.getResourceAsStream("oak6440-2.cnd");
+        List<NodeTypeTemplate> templates;
+        try {
+            CompactNodeTypeDefReader<NodeTypeTemplate, NamespaceRegistry> reader
+                    = new CompactNodeTypeDefReader<NodeTypeTemplate, NamespaceRegistry>(
+                            new InputStreamReader(in, UTF_8), "oak6440-2.cnd", factory);
+            templates = reader.getNodeTypeDefinitions();
+        } finally {
+            in.close();
+        }
+        for (NodeTypeTemplate t : templates) {
+            NodeTypeTemplateImpl template;
+            if (t instanceof NodeTypeTemplateImpl) {
+                template = (NodeTypeTemplateImpl) t;
+            } else {
+                template = new NodeTypeTemplateImpl(new GlobalNameMapper(root), t);
+            }
+            template.writeTo(root.getTree(NODE_TYPES_PATH), true);
+        }
+        NodeTypeDefinition beforeDef = readOnlyNtMgr.getNodeType("foo");
+        NodeTypeDefinition afterDef = ntMgr.getNodeType("foo");
+
+        NodeTypeDefDiff diff = NodeTypeDefDiff.create(beforeDef, afterDef);
+        assertFalse(diff.isMajor());
+    }
 }
