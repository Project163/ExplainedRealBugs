diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentNodeStore.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentNodeStore.java
index a6f003417d..f59581e329 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentNodeStore.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentNodeStore.java
@@ -151,6 +151,9 @@ public class SegmentNodeStore implements NodeStore, Observable {
         } catch (InterruptedException e) {
             throw new CommitFailedException(
                     "Segment", 2, "Merge interrupted", e);
+        } catch (SegmentOverflowException e) {
+            throw new CommitFailedException(
+                    "Segment", 3, "Merge failed", e);
         }
     }
 
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentOverflowException.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentOverflowException.java
new file mode 100644
index 0000000000..1026c6967d
--- /dev/null
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentOverflowException.java
@@ -0,0 +1,42 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *   http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing,
+ * software distributed under the License is distributed on an
+ * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+ * KIND, either express or implied.  See the License for the
+ * specific language governing permissions and limitations
+ * under the License.
+ */
+
+package org.apache.jackrabbit.oak.plugins.segment;
+
+/**
+ * This exception is thrown by the Segment MicroKernel when an internal
+ * limit is exceeded such as too many segment references. Clients should
+ * only ever see this exception as the cause of a
+ * {@link org.apache.jackrabbit.oak.api.CommitFailedException CommitFailedException}.
+ */
+public class SegmentOverflowException extends RuntimeException {
+
+    public SegmentOverflowException(String message) {
+        super(message);
+    }
+
+    public SegmentOverflowException(String message, Throwable cause) {
+        super(message, cause);
+    }
+
+    public SegmentOverflowException(Throwable cause) {
+        super(cause);
+    }
+
+}
diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentWriter.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentWriter.java
index e86374a72b..3867cecc50 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentWriter.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentWriter.java
@@ -37,6 +37,7 @@ import static org.apache.jackrabbit.oak.api.Type.NAMES;
 import static org.apache.jackrabbit.oak.plugins.segment.MapRecord.BUCKETS_PER_LEVEL;
 import static org.apache.jackrabbit.oak.plugins.segment.Segment.MAX_SEGMENT_SIZE;
 import static org.apache.jackrabbit.oak.plugins.segment.Segment.RECORD_ID_BYTES;
+import static org.apache.jackrabbit.oak.plugins.segment.Segment.SEGMENT_REFERENCE_LIMIT;
 
 import java.io.ByteArrayInputStream;
 import java.io.IOException;
@@ -340,7 +341,10 @@ public class SegmentWriter {
 
     private synchronized int getSegmentRef(SegmentId segmentId) {
         int refcount = segment.getRefCount();
-        checkState(refcount < 256, "Segment cannot have more than 255 references", segment.getSegmentId());
+        if (refcount > SEGMENT_REFERENCE_LIMIT) {
+          throw new SegmentOverflowException(
+                  "Segment cannot have more than 255 references " + segment.getSegmentId());
+        }
         for (int index = 0; index < refcount; index++) {
             if (segmentId == segment.getRefId(index)) {
                 return index;
