<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:43:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1674] Node isNew() is false in case the node is removed and added in same commit</title>
                <link>https://issues.apache.org/jira/browse/OAK-1674</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;When you remove a Node /path/a transiently and add one add /path/a again.&lt;br/&gt;
The transiently added Node isNew() check will be false.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;root.getNode(name).remove();
Node newNode = root.addNode(name);
nowNode.isNew() =&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The API says&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Returns true if this is a new item, meaning that it exists only in transient storage on the Session and has not yet been saved. Within a transaction, isNew on an Item may return false (because the item has been saved) even if that Item is not in persistent storage (because the transaction has not yet been committed)....&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12706423">OAK-1674</key>
            <summary>Node isNew() is false in case the node is removed and added in same commit</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mduerig">Michael D&#252;rig</assignee>
                                    <reporter username="chkeller">Christan Keller</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Apr 2014 13:59:14 +0000</created>
                <updated>Mon, 6 Oct 2014 04:09:13 +0000</updated>
                            <resolved>Sun, 6 Apr 2014 13:44:38 +0000</resolved>
                                    <version>0.19</version>
                                    <fixVersion>1.1.0</fixVersion>
                                    <component>jcr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13960087" author="mduerig" created="Fri, 4 Apr 2014 16:13:13 +0000"  >&lt;p&gt;Added test cases at &lt;a href=&quot;http://svn.apache.org/r1584781&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1584781&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13960095" author="mduerig" created="Fri, 4 Apr 2014 16:21:20 +0000"  >&lt;p&gt;I think the fix should be &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;===================================================================
--- oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/tree/AbstractTree.java	(revision 356e78fa6b0e9ce20cc2ed9668f248669ee698eb)
+++ oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/tree/AbstractTree.java	(revision )
@@ -204,7 +204,7 @@
 
     @Override
     &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Status getStatus() {
-        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nodeBuilder.isNew()) {
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nodeBuilder.isNew() || nodeBuilder.isReplaced()) {
             &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; NEW;
         } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nodeBuilder.isModified()) {
             &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; MODIFIED;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;however with this I get other test failures for the SegmentMK fixture in &lt;tt&gt;MutableTreeTest&lt;/tt&gt; and &lt;tt&gt;RepositoryTest&lt;/tt&gt;. These are probably related to the following also failing:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        NodeBuilder root = base.builder();
        NodeBuilder x = root.getChildNode(&lt;span class=&quot;code-quote&quot;&gt;&quot;x&quot;&lt;/span&gt;);
        x.setChildNode(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;&quot;&lt;/span&gt;);
        assertFalse(x.isReplaced());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems the implementation of &lt;tt&gt;isReplaced&lt;/tt&gt; does not interact correctly with &lt;tt&gt;ModifiedNodeState#unwrap&lt;/tt&gt;: it causes the base states of &lt;tt&gt;MemoryNodeBuilder&lt;/tt&gt; and &lt;tt&gt;MutableNodeState&lt;/tt&gt; to become different whereas &lt;tt&gt;isReplaced&lt;/tt&gt; compares those base states to determine whether a replacement has taken place. &lt;/p&gt;</comment>
                            <comment id="13961411" author="mduerig" created="Sun, 6 Apr 2014 13:44:38 +0000"  >&lt;p&gt;Fixed at &lt;a href=&quot;http://svn.apache.org/r1585305&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1585305&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14159903" author="amitjain" created="Mon, 6 Oct 2014 04:09:13 +0000"  >&lt;p&gt;Bulk close for 1.1.0&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12706841">OAK-1681</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12638478" name="Issue.java" size="2067" author="chkeller" created="Thu, 3 Apr 2014 14:00:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384746</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ua6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385013</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>