<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:51:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-5193] Version tree may become inconsistent after removing a version</title>
                <link>https://issues.apache.org/jira/browse/OAK-5193</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;When a version is removed, its predecessors and successors are connected together, to keep the version tree consistent. However, if the removed version predecessor has its own successors, they are replaced with the removed version successors. Similarly, if the removed version successor has its own predecessors, they&apos;ll be replaced with the removed version predecessors.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12841277/12841277_version-histories.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;They should be merged together, instead.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13024412">OAK-5193</key>
            <summary>Version tree may become inconsistent after removing a version</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tomek.rekawek">Tomek R&#281;kawek</assignee>
                                    <reporter username="tomek.rekawek">Tomek R&#281;kawek</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Nov 2016 12:13:54 +0000</created>
                <updated>Wed, 8 Sep 2021 14:41:12 +0000</updated>
                            <resolved>Thu, 1 Dec 2016 12:12:26 +0000</resolved>
                                    <version>1.0.35</version>
                    <version>1.2.21</version>
                    <version>1.4.10</version>
                    <version>1.5.14</version>
                                    <fixVersion>1.0.36</fixVersion>
                    <fixVersion>1.2.22</fixVersion>
                    <fixVersion>1.4.11</fixVersion>
                    <fixVersion>1.5.15</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>jcr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15711813" author="tomek.rekawek" created="Thu, 1 Dec 2016 12:11:50 +0000"  >&lt;p&gt;Fixed:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;for 1.5 in &lt;a href=&quot;https://svn.apache.org/r1772179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1772179&lt;/a&gt;,&lt;/li&gt;
	&lt;li&gt;for 1.4 in &lt;a href=&quot;https://svn.apache.org/r1772180&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1772180&lt;/a&gt;,&lt;/li&gt;
	&lt;li&gt;for 1.2 in &lt;a href=&quot;https://svn.apache.org/r1772181&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1772181&lt;/a&gt;,&lt;/li&gt;
	&lt;li&gt;for 1.0 in &lt;a href=&quot;https://svn.apache.org/r1772183&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1772183&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15742113" author="edivad" created="Mon, 12 Dec 2016 14:36:33 +0000"  >&lt;p&gt;Bulk close for 1.5.15&lt;/p&gt;</comment>
                            <comment id="15744908" author="tomek.rekawek" created="Tue, 13 Dec 2016 11:18:40 +0000"  >&lt;p&gt;Attached a script that fixes the version histories corrupted by this bug. It&apos;s still required to update Oak, so the version storage won&apos;t be corrupted again.&lt;/p&gt;

&lt;p&gt;Usage:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java -jar oak-run-*.jar console repository/segmentstore &quot;:load OAK-5193-fix.groovy&quot; | tee script.log
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15987770" author="akhoury" created="Thu, 27 Apr 2017 21:50:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tomek.rekawek&quot; class=&quot;user-hover&quot; rel=&quot;tomek.rekawek&quot;&gt;tomek.rekawek&lt;/a&gt; I used this script to fix an Oak repository and ran into a bug that caused this error [1].  decreaseVersion was even being called when the version had no &quot;.&quot;.  I have updated the script to fix this bug &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12865431/12865431_OAK-5193-fix-v2.groovy&quot; title=&quot;OAK-5193-fix-v2.groovy attached to OAK-5193&quot;&gt;OAK-5193-fix-v2.groovy&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;[1]&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;alidating SegmentNodeBuilder{path=/jcr:system/jcr:versionStorage/67/2e/04/672e040d-38a7-4b89-bc90-b86ac56fc537}
java.lang.ArrayIndexOutOfBoundsException: Negative array index [-1] too large for array size 0
at org.codehaus.groovy.runtime.dgmimpl.arrays.ArrayMetaMethod.normaliseIndex(ArrayMetaMethod.java:34)
at org.codehaus.groovy.runtime.dgmimpl.arrays.ObjectArrayGetAtMetaMethod$MyPojoMetaMethodSite.call(ObjectArrayGetAtMetaMethod.java:57)
at Oak5193Fixer.decreaseVersion(groovysh_evaluate:130)
at Oak5193Fixer$decreaseVersion$5.callStatic(Unknown Source)
at Oak5193Fixer.closestVersion(groovysh_evaluate:116)
at Oak5193Fixer$closestVersion$4.callStatic(Unknown Source)
at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCallStatic(CallSiteArray.java:53)
at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callStatic(AbstractCallSite.java:157)
at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callStatic(AbstractCallSite.java:169)
at Oak5193Fixer.fixInvalidPredecessor(groovysh_evaluate:58)
at Oak5193Fixer.this$2$fixInvalidPredecessor(groovysh_evaluate)
at Oak5193Fixer$this$2$fixInvalidPredecessor$3.callCurrent(Unknown Source)
at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCallCurrent(CallSiteArray.java:49)
at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callCurrent(AbstractCallSite.java:133)
at Oak5193Fixer.fixVersionHistory(groovysh_evaluate:40)
at Oak5193Fixer.this$2$fixVersionHistory(groovysh_evaluate)
at Oak5193Fixer$this$2$fixVersionHistory$1.callCurrent(Unknown Source)
at Oak5193Fixer.traverse(groovysh_evaluate:19)
at Oak5193Fixer.this$2$traverse(groovysh_evaluate)
at Oak5193Fixer$this$2$traverse$0.callCurrent(Unknown Source)
at Oak5193Fixer.traverse(groovysh_evaluate:21)
at Oak5193Fixer.this$2$traverse(groovysh_evaluate)
at Oak5193Fixer$this$2$traverse$0.callCurrent(Unknown Source)
at Oak5193Fixer.traverse(groovysh_evaluate:21)
at Oak5193Fixer.this$2$traverse(groovysh_evaluate)
at Oak5193Fixer$this$2$traverse$0.callCurrent(Unknown Source)
at Oak5193Fixer.traverse(groovysh_evaluate:21)
at Oak5193Fixer.this$2$traverse(groovysh_evaluate)
at Oak5193Fixer$this$2$traverse$0.callCurrent(Unknown Source)
at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCallCurrent(CallSiteArray.java:49)
at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callCurrent(AbstractCallSite.java:133)
at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callCurrent(AbstractCallSite.java:141)
at Oak5193Fixer.traverse(groovysh_evaluate:13)
at Oak5193Fixer.this$2$traverse(groovysh_evaluate)
at Oak5193Fixer$this$2$traverse.call(Unknown Source)
at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCall(CallSiteArray.java:45)
at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:108)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17042302" author="mchester" created="Sat, 22 Feb 2020 00:37:33 +0000"  >&lt;p&gt;Is this script expected to work on AEM 6.5 with Oak 1.10.2?&#160; It appears to not work, and only outputs the Oak-run run modes in the log file.&lt;/p&gt;

&lt;p&gt;I have this issue with running Version Purge, and this is the only information I can find on it.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="17042304" author="akhoury" created="Sat, 22 Feb 2020 00:40:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mchester&quot; class=&quot;user-hover&quot; rel=&quot;mchester&quot;&gt;mchester&lt;/a&gt; an updated version of the script and detailed instructions can be found here:&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/andrewmkhoury/533e9b4424f622c4f889061c4faffb57&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/andrewmkhoury/533e9b4424f622c4f889061c4faffb57&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Those instructions would help you get past most types of version issues.&lt;/p&gt;</comment>
                            <comment id="17042319" author="mchester" created="Sat, 22 Feb 2020 01:14:20 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akhoury&quot; class=&quot;user-hover&quot; rel=&quot;akhoury&quot;&gt;akhoury&lt;/a&gt;!&#160; That did the trick.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13400009">OAK-9567</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12865431" name="OAK-5193-fix-v2.groovy" size="12822" author="akhoury" created="Thu, 27 Apr 2017 21:50:38 +0000"/>
                            <attachment id="12935567" name="OAK-5193-fix-v4.groovy" size="12659" author="smatsch" created="Tue, 14 Aug 2018 15:43:52 +0000"/>
                            <attachment id="12958052" name="OAK-5193-fix-v5.groovy" size="12408" author="wunsch" created="Fri, 8 Feb 2019 12:32:39 +0000"/>
                            <attachment id="12842976" name="OAK-5193-fix.groovy" size="12430" author="tomek.rekawek" created="Tue, 13 Dec 2016 11:18:40 +0000"/>
                            <attachment id="12841277" name="version-histories.png" size="16973" author="tomek.rekawek" created="Thu, 1 Dec 2016 11:55:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 38 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36ylb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>