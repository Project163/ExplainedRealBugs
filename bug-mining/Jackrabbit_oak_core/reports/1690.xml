<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:52:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-6149] AtomicCounter fails with LuceneIndexEditorProvider</title>
                <link>https://issues.apache.org/jira/browse/OAK-6149</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The AtomicCounter fails to consolidate the value when running on DocumentNodeStore with lucene indexes.&lt;/p&gt;

&lt;p&gt;The task scheduled by the &lt;tt&gt;AtomicCounterEditor&lt;/tt&gt; fails with:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;02.05.2017 13:42:14.923 *WARN* [atomic-counter-3] org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditorProvider No CommitContext found for commit
java.lang.Exception: null
	at org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditorProvider.getIndexEditor(LuceneIndexEditorProvider.java:133)
	at org.apache.jackrabbit.oak.plugins.index.CompositeIndexEditorProvider.getIndexEditor(CompositeIndexEditorProvider.java:74)
	at org.apache.jackrabbit.oak.spi.whiteboard.WhiteboardIndexEditorProvider.getIndexEditor(WhiteboardIndexEditorProvider.java:52)
	at org.apache.jackrabbit.oak.plugins.index.IndexUpdate.collectIndexEditors(IndexUpdate.java:240)
	at org.apache.jackrabbit.oak.plugins.index.IndexUpdate.enter(IndexUpdate.java:160)
	at org.apache.jackrabbit.oak.spi.commit.VisibleEditor.enter(VisibleEditor.java:57)
	at org.apache.jackrabbit.oak.spi.commit.CompositeEditor.enter(CompositeEditor.java:66)
	at org.apache.jackrabbit.oak.spi.commit.EditorDiff.process(EditorDiff.java:49)
	at org.apache.jackrabbit.oak.spi.commit.EditorHook.processCommit(EditorHook.java:54)
	at org.apache.jackrabbit.oak.spi.commit.CompositeHook.processCommit(CompositeHook.java:61)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreBranch$InMemory.merge(DocumentNodeStoreBranch.java:511)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreBranch.merge0(DocumentNodeStoreBranch.java:185)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreBranch.merge(DocumentNodeStoreBranch.java:119)
	at org.apache.jackrabbit.oak.plugins.document.DocumentRootBuilder.merge(DocumentRootBuilder.java:167)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStore.merge(DocumentNodeStore.java:1694)
	at org.apache.jackrabbit.oak.plugins.atomic.AtomicCounterEditor$ConsolidatorTask.call(AtomicCounterEditor.java:410)
	at org.apache.jackrabbit.oak.plugins.atomic.AtomicCounterEditor$ConsolidatorTask.call(AtomicCounterEditor.java:335)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Oak 1.6.1 with DocumentNodeStore on MongoDB 3.2.x&lt;/p&gt;</environment>
        <key id="13068412">OAK-6149</key>
            <summary>AtomicCounter fails with LuceneIndexEditorProvider</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="mreutegg">Marcel Reutegger</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 May 2017 12:49:06 +0000</created>
                <updated>Tue, 30 May 2017 08:38:35 +0000</updated>
                            <resolved>Wed, 3 May 2017 08:45:22 +0000</resolved>
                                    <version>1.6.0</version>
                                    <fixVersion>1.7.0</fixVersion>
                    <fixVersion>1.6.2</fixVersion>
                    <fixVersion>1.8.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15994264" author="chetanm" created="Wed, 3 May 2017 04:28:24 +0000"  >&lt;p&gt;This is just a warn logging and it should not cause the call to fail as such. The warning was meant to identify code paths which do not set CommitContext as part of CommitInfo and looks like commit done by AtomicCounterEditor does not include that. The exception trace logged was meant to identify such code paths&lt;/p&gt;</comment>
                            <comment id="15994338" author="mreutegg" created="Wed, 3 May 2017 06:28:06 +0000"  >&lt;p&gt;Unfortunately, it does fail. The next message in the log is:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;02.05.2017 13:42:14.924 *DEBUG* [atomic-counter-3] org.apache.jackrabbit.oak.plugins.atomic.AtomicCounterEditor [5a97015f-6294-4d32-9057-81d91617a818] caught Exception. Rescheduling. OakIndexUpdate0001: Missing index provider detected for type [lucene] on index [/oak:index/authorizables]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15994371" author="chetanm" created="Wed, 3 May 2017 07:00:46 +0000"  >&lt;p&gt;Okie then it looks like the CommitHook used for that commit is using an incomplete list of IndexEditors. Probably the commit hook in AtomicCounterEditor should be more precise and not use IndexUpdate &lt;/p&gt;</comment>
                            <comment id="15994372" author="mreutegg" created="Wed, 3 May 2017 07:01:25 +0000"  >&lt;p&gt;Added an ignored test: &lt;a href=&quot;http://svn.apache.org/r1793618&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1793618&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15994378" author="mreutegg" created="Wed, 3 May 2017 07:05:04 +0000"  >&lt;p&gt;IIUC the &lt;tt&gt;AtomicCounterEditor&lt;/tt&gt; should use the same commit hook in the consolidation tasks as in regular commits. It looks up the hook on the whiteboard. Above test passes when the consolidation task calls merge() with a &lt;tt&gt;CommitInfo&lt;/tt&gt; that has a &lt;tt&gt;CommitContext&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15994383" author="mreutegg" created="Wed, 3 May 2017 07:08:46 +0000"  >&lt;p&gt;Attached a proposed fix.&lt;/p&gt;</comment>
                            <comment id="15994448" author="chetanm" created="Wed, 3 May 2017 08:07:46 +0000"  >&lt;p&gt;Patch looks fine. &lt;/p&gt;

&lt;p&gt;Okie now realized that it was returning null when CommitContext was not found and that lead to indexing failure as no editor was found for type &quot;lucene&quot;. With the patch this would be addressed&lt;/p&gt;</comment>
                            <comment id="15994482" author="mreutegg" created="Wed, 3 May 2017 08:45:22 +0000"  >&lt;p&gt;Fixed in trunk: &lt;a href=&quot;http://svn.apache.org/r1793627&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1793627&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15994594" author="mreutegg" created="Wed, 3 May 2017 09:53:29 +0000"  >&lt;p&gt;I would like to merge this fix into the 1.6 branch. The fix is simple and I consider the risk as low. Without this fix, the atomic counter cannot be used in combination with Lucene based indexes that are configured with either &apos;nrt&apos; or &apos;sync&apos; mode.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt;, WDYT?&lt;/p&gt;</comment>
                            <comment id="15994662" author="chetanm" created="Wed, 3 May 2017 11:03:42 +0000"  >&lt;p&gt;+1 to backport&lt;/p&gt;</comment>
                            <comment id="15994674" author="edivad" created="Wed, 3 May 2017 11:11:01 +0000"  >&lt;p&gt;+1 for backport&lt;/p&gt;</comment>
                            <comment id="15994680" author="mreutegg" created="Wed, 3 May 2017 11:17:03 +0000"  >&lt;p&gt;Merged into 1.6 branch: &lt;a href=&quot;http://svn.apache.org/r1793638&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1793638&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15994719" author="edivad" created="Wed, 3 May 2017 12:02:56 +0000"  >&lt;p&gt;minor note. Maybe we can reuse the &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-commons/src/main/java/org/apache/jackrabbit/oak/commons/concurrent/ExecutorCloser.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ExecutorCloser&lt;/a&gt; for shutting down in the test.&lt;/p&gt;</comment>
                            <comment id="16028983" author="edivad" created="Tue, 30 May 2017 08:38:35 +0000"  >&lt;p&gt;Bulk close for 1.7.0&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12866134" name="OAK-6149.patch" size="3067" author="mreutegg" created="Wed, 3 May 2017 07:08:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 24 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ed47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>