<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:53:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-6463] Property index update fails in composite NodeStore setup</title>
                <link>https://issues.apache.org/jira/browse/OAK-6463</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;In a CompositeNodeStore setup involving 1 read only mount a commit involving update of property index may fail even if the commit does not update content under read only paths&lt;/p&gt;</description>
                <environment></environment>
        <key id="13087887">OAK-6463</key>
            <summary>Property index update fails in composite NodeStore setup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chetanm">Chetan Mehrotra</assignee>
                                    <reporter username="chetanm">Chetan Mehrotra</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Jul 2017 09:02:37 +0000</created>
                <updated>Tue, 12 Jun 2018 19:41:47 +0000</updated>
                            <resolved>Tue, 18 Jul 2017 12:43:25 +0000</resolved>
                                                    <fixVersion>1.7.4</fixVersion>
                    <fixVersion>1.8.0</fixVersion>
                                    <component>composite</component>
                    <component>property-index</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16091343" author="chetanm" created="Tue, 18 Jul 2017 09:34:53 +0000"  >&lt;p&gt;Added ignored tests with 1802261,1802256&lt;/p&gt;</comment>
                            <comment id="16091378" author="chetanm" created="Tue, 18 Jul 2017 10:11:57 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12877775/12877775_OAK-6463-v1.patch&quot; title=&quot;OAK-6463-v1.patch attached to OAK-6463&quot;&gt;patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; for the same. &lt;/p&gt;

&lt;p&gt;Issue here was that for any property index update PropertyIndexEditor had to initialize NodeBuilder for all IndexStoreStrategy (which are 1 per mount). Now if the index did not had entries for private mount at setup time (when writes to it were allowed) then later this cases issue as on update the editor would try to eagerly initialize the NodeBuilder for :oak:mount-&amp;lt;&amp;gt;-index node even if no updates need to be done under that.&lt;/p&gt;

&lt;p&gt;This patch fixes this by using a lazy builder i.e. use Supplier&amp;lt;NodeBuilder&amp;gt; where NodeBuilder is constructed on demand. With this a mount related index node is not created for normal index updates.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stillalex&quot; class=&quot;user-hover&quot; rel=&quot;stillalex&quot;&gt;stillalex&lt;/a&gt; Please review!&lt;/p&gt;</comment>
                            <comment id="16091471" author="alex.parvulescu" created="Tue, 18 Jul 2017 12:15:34 +0000"  >&lt;p&gt;very interesting fix! I&apos;m wondering if the &apos;index&apos; supplier should not be wrapped into a &lt;tt&gt;Suppliers.memoize&lt;/tt&gt; call so you&apos;d get the same &lt;tt&gt;NodeBuilder&lt;/tt&gt; instance on each &lt;tt&gt;.get()&lt;/tt&gt; call. In the current form it will return a new builder on each call and while it will still probably work, I&apos;m a bit worried about the perf impact.&lt;/p&gt;</comment>
                            <comment id="16091504" author="chetanm" created="Tue, 18 Jul 2017 12:43:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m wondering if the &apos;index&apos; supplier should not be wrapped into a Suppliers.memoize call so you&apos;d get the same NodeBuilder instance on each .get() call&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Makes sense.&lt;/p&gt;

&lt;p&gt;Applied a modified patch which uses memoize supplier with r1802288&lt;/p&gt;</comment>
                            <comment id="16098349" author="edivad" created="Mon, 24 Jul 2017 13:16:13 +0000"  >&lt;p&gt;Bulk close for 1.7.4&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13165658">OAK-7540</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12877775" name="OAK-6463-v1.patch" size="15602" author="chetanm" created="Tue, 18 Jul 2017 10:03:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 16 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hnfb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>