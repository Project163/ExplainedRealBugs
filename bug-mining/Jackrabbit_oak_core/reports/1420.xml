<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:50:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2592] Commit does not ensure w:majority</title>
                <link>https://issues.apache.org/jira/browse/OAK-2592</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The MongoDocumentStore uses &lt;tt&gt;findAndModify()&lt;/tt&gt; to commit a transaction. This operation does not allow an application specified write concern and always uses the MongoDB default write concern &lt;tt&gt;Acknowledged&lt;/tt&gt;. This means a commit may not make it to a majority of a replica set when the primary fails. From a MongoDocumentStore perspective it may appear as if a write was successful and later reverted. See also the test in &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1641&quot; title=&quot;Mongo: Un-/CheckedExecutionException on replica-primary crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1641&quot;&gt;&lt;del&gt;OAK-1641&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;To fix this, we&apos;d probably have to change the MongoDocumentStore to avoid &lt;tt&gt;findAndModify()&lt;/tt&gt; and use &lt;tt&gt;update()&lt;/tt&gt; instead.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12780441">OAK-2592</key>
            <summary>Commit does not ensure w:majority</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="mreutegg">Marcel Reutegger</reporter>
                        <labels>
                            <label>resilience</label>
                    </labels>
                <created>Mon, 9 Mar 2015 09:38:12 +0000</created>
                <updated>Tue, 16 Feb 2021 09:53:21 +0000</updated>
                            <resolved>Thu, 7 Jan 2016 10:05:51 +0000</resolved>
                                    <version>1.0</version>
                    <version>1.2</version>
                                    <fixVersion>1.3.14</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>core</component>
                    <component>mongomk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14946773" author="mreutegg" created="Wed, 7 Oct 2015 12:32:03 +0000"  >&lt;p&gt;MongoDB 3.2 will support a write concern for findAndModify(): &lt;a href=&quot;https://jira.mongodb.org/browse/SERVER-6558&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jira.mongodb.org/browse/SERVER-6558&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Java driver support is still pending: &lt;a href=&quot;https://jira.mongodb.org/browse/JAVA-908&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jira.mongodb.org/browse/JAVA-908&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m wondering if it is worth the effort to change the implementation in Oak now, when this will be supported by MongoDB soon.&lt;/p&gt;</comment>
                            <comment id="14966803" author="mreutegg" created="Wed, 21 Oct 2015 13:26:56 +0000"  >&lt;p&gt;I see the following alternatives to findAndModify():&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;First ensure the document is cached and then perform a conditional update() on the modCount. If it fails, repeat until it succeeds. This option does not work well, when there are concurrent updates from multiple cluster nodes on the same document and we may run into a liveness problem.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Perform an unconditional update and then read the document from MongoDB. Create a before document by applying the reverse operation on the document. The document may be slightly different from what findAndModify() returns. The assumed _modCount may not exactly match the state of the document before the update was applied. Between the update and the read operation another update from another cluster node may slip in and update the _modCount. This wouldn&apos;t be a problem, because _modCount is an implementation detail of the MongoDocumentStore. There&apos;s another problem, though. Some operations cannot be reverted. Setting a top level property in a document overwrites the previous value. At least for the final update on the commit root document, this wouldn&apos;t be a problem. The only top level property changed by such a update is _modified (in addition to the _modCount).&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15087152" author="mreutegg" created="Thu, 7 Jan 2016 10:05:51 +0000"  >&lt;p&gt;Updated MongoDB Java Driver to 2.14.0. This version supports MongoDB 3.2 and sends the write concern for findAndModify if the server is 3.2 or higher.&lt;/p&gt;

&lt;p&gt;This means the fix for this issue also requires running on MongoDB 3.2 or higher.&lt;/p&gt;

&lt;p&gt;Done in trunk: &lt;a href=&quot;http://svn.apache.org/r1723502&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1723502&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15112146" author="edivad" created="Fri, 22 Jan 2016 09:21:07 +0000"  >&lt;p&gt;Bulk close for 1.3.14&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12696528">OAK-1453</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12908135">OAK-3554</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>OAK-3270</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 43 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1smf7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>