<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:49:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-3513] Session save going through despite repository being shutdown causing reindex flag to reset</title>
                <link>https://issues.apache.org/jira/browse/OAK-3513</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;In some scenarios it can happen then repository instance has been shutdown and removed from OSGi service registry but NodeStore is still active. In such case if any thread has access to a JCR session instance then any commit done via that session would still go through.&lt;/p&gt;

&lt;p&gt;This causes issues as upon repository shutdown the whiteboard based trackers would have lost any editor, validators and hence such commit can lead to invalid data being committed. &lt;/p&gt;

&lt;p&gt;Also in some cases it can lead to reindex flag for various sync indexes getting reset to true as backing index editors are not present during the commit&lt;/p&gt;</description>
                <environment></environment>
        <key id="12904482">OAK-3513</key>
            <summary>Session save going through despite repository being shutdown causing reindex flag to reset</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chetanm">Chetan Mehrotra</assignee>
                                    <reporter username="chetanm">Chetan Mehrotra</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Oct 2015 09:39:34 +0000</created>
                <updated>Wed, 2 Mar 2016 14:44:34 +0000</updated>
                            <resolved>Wed, 14 Oct 2015 09:02:00 +0000</resolved>
                                                    <fixVersion>1.0.23</fixVersion>
                    <fixVersion>1.2.8</fixVersion>
                    <fixVersion>1.3.9</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14954728" author="chetanm" created="Tue, 13 Oct 2015 09:53:46 +0000"  >&lt;p&gt;Added ignored testcase with 1708315&lt;/p&gt;</comment>
                            <comment id="14954730" author="chetanm" created="Tue, 13 Oct 2015 09:55:07 +0000"  >&lt;p&gt;One simple way to fix this would be to add a CommitHook while constructing the Oak instance which checks if repository is shutdown or not before allowing the commit&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alexparvulescu&quot; class=&quot;user-hover&quot; rel=&quot;alexparvulescu&quot;&gt;alexparvulescu&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt; Thoughts?&lt;/p&gt;</comment>
                            <comment id="14954789" author="chetanm" created="Tue, 13 Oct 2015 11:14:44 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12766312/12766312_OAK-3513-1.patch&quot; title=&quot;OAK-3513-1.patch attached to OAK-3513&quot;&gt;patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; for the same. With this we just have to ensure that various trackers are shutdown &lt;b&gt;after&lt;/b&gt; repository got closed&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alexparvulescu&quot; class=&quot;user-hover&quot; rel=&quot;alexparvulescu&quot;&gt;alexparvulescu&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt; Can you have a look&lt;/p&gt;</comment>
                            <comment id="14954825" author="alex.parvulescu" created="Tue, 13 Oct 2015 12:04:30 +0000"  >&lt;p&gt;looks good&lt;/p&gt;</comment>
                            <comment id="14955059" author="mduerig" created="Tue, 13 Oct 2015 14:51:37 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14956483" author="ianeboston" created="Wed, 14 Oct 2015 08:19:32 +0000"  >&lt;p&gt;The patch fixes this issue, but does not eliminate the impact of the reindex flag if, for whatever reason, it is persisted into the repository. Since that flag being persisted to the repository, makes the repository unavailable, perhaps that should be eliminated ?&lt;/p&gt;

&lt;p&gt;It is valid to argue that the flag will never be persisted to the repository if the risk of that happening is absolutely zero, but that was argued before this issue was opened, evidenced by the code that set the flag.&lt;/p&gt;

&lt;p&gt;Should the commit hook that intercepts the flag and performs reindexing ever fail for whatever reason, the flag will get committed. imvho it would be better to check the NodeBuilder before and after to make certain the flag when true, is not true in the repository, as that is afaict the real desired behaviour of re-indexing.&lt;/p&gt;</comment>
                            <comment id="14956513" author="chetanm" created="Wed, 14 Oct 2015 09:00:20 +0000"  >&lt;p&gt;Thats a valid concern and I suggest that we followup on that in the issue you opened earlier &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3512&quot; title=&quot;Synchronous index rebuilds can be performed by all commits once the reindex propery is true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3512&quot;&gt;&lt;del&gt;OAK-3512&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14956517" author="chetanm" created="Wed, 14 Oct 2015 09:02:00 +0000"  >&lt;p&gt;Applied the patch&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk - 1708546&lt;/li&gt;
	&lt;li&gt;1.0 - 1708547 (just merged the fix and not testcase as oak-pojosr is qute old there)&lt;/li&gt;
	&lt;li&gt;1.2 -  1708562 - Had to port quite a few changes from oak-pojosr to get testcase run&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14982389" author="edivad" created="Fri, 30 Oct 2015 11:22:54 +0000"  >&lt;p&gt;Bulk close for 1.3.9&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12862302">OAK-3366</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12766312" name="OAK-3513-1.patch" size="3126" author="chetanm" created="Tue, 13 Oct 2015 11:14:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 3 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mxtr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>