<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:44:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1892] OrderedIndexConcurrentClusterIT takes too long</title>
                <link>https://issues.apache.org/jira/browse/OAK-1892</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The OrderedIndexConcurrentClusterIT takes too long and times out on travis. See e.g. &lt;a href=&quot;https://travis-ci.org/apache/jackrabbit-oak/builds/27445383&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/apache/jackrabbit-oak/builds/27445383&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;trunk and 1.0 branch&lt;/p&gt;</environment>
        <key id="12721348">OAK-1892</key>
            <summary>OrderedIndexConcurrentClusterIT takes too long</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="edivad">Davide Giannella</assignee>
                                    <reporter username="mreutegg">Marcel Reutegger</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Jun 2014 06:52:17 +0000</created>
                <updated>Mon, 6 Oct 2014 04:09:24 +0000</updated>
                            <resolved>Tue, 19 Aug 2014 06:20:20 +0000</resolved>
                                                    <fixVersion>1.1.0</fixVersion>
                                    <component>jcr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14032156" author="mreutegg" created="Mon, 16 Jun 2014 06:54:46 +0000"  >&lt;p&gt;Disabled test for now in &lt;a href=&quot;http://svn.apache.org/r1602809&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1602809&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14032162" author="mreutegg" created="Mon, 16 Jun 2014 07:01:13 +0000"  >&lt;p&gt;Also disabled in 1.0 branch: &lt;a href=&quot;http://svn.apache.org/r1602811&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1602811&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14032493" author="jukkaz" created="Mon, 16 Jun 2014 14:49:59 +0000"  >&lt;p&gt;BTW, I&apos;m also seeing very slow progress when indexing larger amounts of content. Updating the ordered index appears to be much slower than updating the Lucene index, including text extraction, which seems troublesome.&lt;/p&gt;</comment>
                            <comment id="14035615" author="mreutegg" created="Wed, 18 Jun 2014 12:00:56 +0000"  >&lt;p&gt;I also noticed slow progress. A typical stack trace looks like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;pool-9-thread-3&quot; prio=5 tid=7f80550a3800 nid=0x123c4a000 runnable [123c48000]
   java.lang.Thread.State: RUNNABLE
	at java.util.regex.Pattern$Start.match(Pattern.java:3055)
	at java.util.regex.Matcher.search(Matcher.java:1105)
	at java.util.regex.Matcher.find(Matcher.java:535)
	at java.util.regex.Matcher.replaceAll(Matcher.java:809)
	at java.lang.String.replaceAll(String.java:2189)
	at org.apache.jackrabbit.oak.plugins.index.property.strategy.OrderedContentMirrorStoreStrategy.convert(OrderedContentMirrorStoreStrategy.java:337)
	at org.apache.jackrabbit.oak.plugins.index.property.strategy.OrderedContentMirrorStoreStrategy.access$000(OrderedContentMirrorStoreStrategy.java:65)
	at org.apache.jackrabbit.oak.plugins.index.property.strategy.OrderedContentMirrorStoreStrategy$PredicateGreaterThan.apply(OrderedContentMirrorStoreStrategy.java:842)
	at org.apache.jackrabbit.oak.plugins.index.property.strategy.OrderedContentMirrorStoreStrategy$PredicateGreaterThan.apply(OrderedContentMirrorStoreStrategy.java:825)
	at org.apache.jackrabbit.oak.plugins.index.property.strategy.OrderedContentMirrorStoreStrategy.seek(OrderedContentMirrorStoreStrategy.java:783)
	at org.apache.jackrabbit.oak.plugins.index.property.strategy.OrderedContentMirrorStoreStrategy.fetchKeyNode(OrderedContentMirrorStoreStrategy.java:127)
	at org.apache.jackrabbit.oak.plugins.index.property.strategy.ContentMirrorStoreStrategy.insert(ContentMirrorStoreStrategy.java:109)
	at org.apache.jackrabbit.oak.plugins.index.property.strategy.ContentMirrorStoreStrategy.update(ContentMirrorStoreStrategy.java:80)
	at org.apache.jackrabbit.oak.plugins.index.property.PropertyIndexEditor.leave(PropertyIndexEditor.java:261)
	at org.apache.jackrabbit.oak.plugins.index.property.OrderedPropertyIndexEditor.leave(OrderedPropertyIndexEditor.java:42)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14049901" author="edivad" created="Wed, 2 Jul 2014 13:33:03 +0000"  >&lt;p&gt;Committed in &lt;a href=&quot;http://svn.apache.org/r1607362&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1607362&lt;/a&gt; an average of 17-18%&lt;br/&gt;
improve on insert after code clean-up based on running&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java -Xmx2048m -Dprofile=false -Druntime=60 -Dwarmup=30 \
    -Dlogback.configurationFile=logback-benchmark.xml \
    -Doak.queryLimitInMemory=100000 -DpreAddedNodes=0 \
    -DnodesPerIteration=100 -jar oak-run-1.1-SNAPSHOT.jar benchmark \
    --concurrency 1 --runAsAdmin false --report false \
    --randomUser true OrderedIndexInsertOrderedPropertyTest Oak-Tar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;by replacing &lt;tt&gt;nodesPerIteration&lt;/tt&gt; with the number of nodes to be&lt;br/&gt;
added. Below the results with in brackets the number of nodes.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Before

# OrderedIndexInsertOrderedP       C     min     10%     50%     90%     max       N
(100)   Oak-Tar                    1      34      35      37      39      49    1470
(1000)  Oak-Tar                    1     434     442     454     494     537     127
(10000) Oak-Tar                    1    5173    5209    5427    5521    5524      11

After

# OrderedIndexInsertOrderedP       C     min     10%     50%     90%     max       N
(100)   Oak-Tar                    1      29      30      31      36     180    1675
(1000)  Oak-Tar                    1     360     364     372     396     446     156
(10000) Oak-Tar                    1    3902    3907    3957    4151    4333      15
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Attaching a digested version of the results (CSV file) with the two&lt;br/&gt;
main commits. The last line is the one committed.&lt;/p&gt;
</comment>
                            <comment id="14057346" author="mduerig" created="Thu, 10 Jul 2014 10:33:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;Committed in &lt;a href=&quot;http://svn.apache.org/r1607362&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1607362&lt;/a&gt; an average of 17-18% improve on insert after code clean-up based on running&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Trying this out with a big content package install I&apos;ve seen a lot of time spent in &lt;tt&gt;OrderedContentMirrorStoreStrategy&lt;/tt&gt; and the process running for more then half an hour (at which point I lost patience). The problem is caused by the many calls to &lt;tt&gt;NodeBuilder#getNodeState&lt;/tt&gt;. That call is not particular efficient as it caused a fresh snapshot of the current builder state to be taken every time. It is particular costly if there are many changes to the builder. &lt;/p&gt;</comment>
                            <comment id="14061911" author="edivad" created="Tue, 15 Jul 2014 10:12:56 +0000"  >&lt;p&gt;committed in &lt;a href=&quot;http://svn.apache.org/r1610634&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1610634&lt;/a&gt; an average of 130%&lt;br/&gt;
improvements for inserts ranging between 100 and 1M index&lt;br/&gt;
keys. Details in the attached PDF: &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1892&quot; title=&quot;OrderedIndexConcurrentClusterIT takes too long&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1892&quot;&gt;&lt;del&gt;OAK-1892&lt;/del&gt;&lt;/a&gt;-inserts.pdf.&lt;/p&gt;</comment>
                            <comment id="14063299" author="edivad" created="Wed, 16 Jul 2014 08:55:15 +0000"  >&lt;p&gt;Merged r1607362 and r1610634 into 1.0 branch at &lt;a href=&quot;http://svn.apache.org/r1610939&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1610939&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14073155" author="mreutegg" created="Thu, 24 Jul 2014 12:22:02 +0000"  >&lt;p&gt;Unscheduling from 1.0.3 release. The improvements so far for this issue are tracked with &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1991&quot; title=&quot;Optimize access to OrderedPropertyIndex&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1991&quot;&gt;&lt;del&gt;OAK-1991&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14074206" author="edivad" created="Fri, 25 Jul 2014 08:36:40 +0000"  >&lt;p&gt;Re-enabled the test in &lt;a href=&quot;http://svn.apache.org/r1613050&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1613050&lt;/a&gt; and so far the build is not timing out.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt; can we consider this resolved?&lt;/p&gt;</comment>
                            <comment id="14101916" author="mreutegg" created="Tue, 19 Aug 2014 06:20:20 +0000"  >&lt;p&gt;Looks good to me.&lt;/p&gt;</comment>
                            <comment id="14159941" author="amitjain" created="Mon, 6 Oct 2014 04:09:24 +0000"  >&lt;p&gt;Bulk close for 1.1.0&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12655735" name="OAK-1892 - Inserts.pdf" size="103248" author="edivad" created="Tue, 15 Jul 2014 10:12:56 +0000"/>
                            <attachment id="12653587" name="benchmarks - OAK-1892.csv" size="298" author="edivad" created="Wed, 2 Jul 2014 13:33:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>399544</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ws4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>399653</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>