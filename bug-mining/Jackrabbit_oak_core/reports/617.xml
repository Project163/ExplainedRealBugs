<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:41:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1094] CacheLIRS implementation incomplete</title>
                <link>https://issues.apache.org/jira/browse/OAK-1094</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The current CacheLIRS implementation is not complete and e.g. does not provide a write through ConcurrentMap view on &lt;tt&gt;asMap()&lt;/tt&gt;. For &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1088&quot; title=&quot;Thread safe MongoDocumentStore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1088&quot;&gt;&lt;del&gt;OAK-1088&lt;/del&gt;&lt;/a&gt; it would be good to have this implementation as it allows conditional and atomic updates of cache entries.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12673680">OAK-1094</key>
            <summary>CacheLIRS implementation incomplete</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="mreutegg">Marcel Reutegger</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Oct 2013 13:00:36 +0000</created>
                <updated>Mon, 27 Jan 2014 09:38:40 +0000</updated>
                            <resolved>Thu, 16 Jan 2014 13:49:17 +0000</resolved>
                                                    <fixVersion>0.15</fixVersion>
                                    <component>core</component>
                    <component>mongomk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13795192" author="mreutegg" created="Tue, 15 Oct 2013 13:47:14 +0000"  >&lt;p&gt;There are also a number of other methods currently not implemented. Therefore I converted this into a more generic issue.&lt;/p&gt;

&lt;p&gt;E.g. KernelNodeState.init() uses Cache.refresh() to re-calcuate the size of the cache entry. With CacheLIRS this is a NOP and probably breaks &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-643&quot; title=&quot;Very high memory usage with 6000 child nodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-643&quot;&gt;&lt;del&gt;OAK-643&lt;/del&gt;&lt;/a&gt; again. &lt;/p&gt;</comment>
                            <comment id="13864229" author="tmueller" created="Tue, 7 Jan 2014 13:28:54 +0000"  >&lt;p&gt;Revision 1556209: the most important method are now implemented (refresh, asMap). Some tests are also implemented (I took them from the H2 implementation). Some methods are not yet implemented or are (still) inefficient, and not all features are tested yet, so I leave this issue open for now. But it should no longer block using the cache in the MongoMK or elsewhere in Oak as far as I see.&lt;/p&gt;</comment>
                            <comment id="13865286" author="mreutegg" created="Wed, 8 Jan 2014 10:33:25 +0000"  >&lt;p&gt;It looks like this change may cause a NPE in KernelNodeStore Weigher. Below exception is from a test system running the oak benchmarks:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.NullPointerException
	at org.apache.jackrabbit.oak.kernel.KernelNodeStore$1.weigh(KernelNodeStore.java:85)
	at org.apache.jackrabbit.oak.kernel.KernelNodeStore$1.weigh(KernelNodeStore.java:82)
	at org.apache.jackrabbit.oak.cache.CacheLIRS.sizeOf(CacheLIRS.java:317)
	at org.apache.jackrabbit.oak.cache.CacheLIRS$Segment.refresh(CacheLIRS.java:935)
	at org.apache.jackrabbit.oak.cache.CacheLIRS.refresh(CacheLIRS.java:264)
	at org.apache.jackrabbit.oak.kernel.KernelNodeState.init(KernelNodeState.java:215)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the problem is that refresh may also be called for NodeStates, which are not present in the cache anymore. The CacheLIRS implementation will then pass null as the oldValue to the CacheLoader.reload() method. According to the contract oldValue must not be null.&lt;/p&gt;</comment>
                            <comment id="13865301" author="tmueller" created="Wed, 8 Jan 2014 10:51:52 +0000"  >&lt;p&gt;Thanks Marcel! I will take care of this and add a test case.&lt;/p&gt;</comment>
                            <comment id="13873403" author="tmueller" created="Thu, 16 Jan 2014 13:49:17 +0000"  >&lt;p&gt;Should be fixed in revision 1556495.&lt;/p&gt;</comment>
                            <comment id="13882692" author="alex.parvulescu" created="Mon, 27 Jan 2014 09:38:40 +0000"  >&lt;p&gt;bulk close for the 0.15 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353303</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1owvr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353596</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>