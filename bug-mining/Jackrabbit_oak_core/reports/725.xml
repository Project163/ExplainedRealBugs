<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:42:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1476] Hardcoded SecurityProvider implementation in oak-jcr Activator</title>
                <link>https://issues.apache.org/jira/browse/OAK-1476</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;the Activator in o.a.j.oak.jcr.jcr.osgi contains a hardcoded reference to the SecurityProviderImpl. This is obviously not the desired outcome of making the security part pluggable at runtime.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;jukkaz&lt;/a&gt;, since you are the author of the Activator, could you take a look at this again? &lt;/p&gt;</description>
                <environment></environment>
        <key id="12697636">OAK-1476</key>
            <summary>Hardcoded SecurityProvider implementation in oak-jcr Activator</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chetanm">Chetan Mehrotra</assignee>
                                    <reporter username="angela">Angela Schreiber</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Feb 2014 08:53:00 +0000</created>
                <updated>Mon, 24 Mar 2014 13:36:36 +0000</updated>
                            <resolved>Tue, 11 Mar 2014 07:50:37 +0000</resolved>
                                                    <fixVersion>0.19</fixVersion>
                                    <component>jcr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13914232" author="anchela" created="Thu, 27 Feb 2014 08:55:20 +0000"  >&lt;p&gt;in addition the buildSecurityConfig method add some adobe specific default values for the user mgt setup. what&apos;s the intention behind this?&lt;/p&gt;</comment>
                            <comment id="13923888" author="chetanm" created="Fri, 7 Mar 2014 14:00:33 +0000"  >&lt;p&gt;Patch to fix the issue.&lt;/p&gt;

&lt;p&gt;To remove the hardcoded SecurityConfiguration in activator I need to refactor the SecurityProvider. The way configuration is currently managed is very fragile in OSGi env. Instead the patch takes following approach&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;By default all dependent configuration in SecurityProvider are marked as otpional unary (or option multiple where required)&lt;/li&gt;
	&lt;li&gt;All the SecurityConfiguration components are now marked with ConfigurationPolicy to REQUIRED. So they would not be created unless specific configuration is provided for them&lt;/li&gt;
	&lt;li&gt;If user does not want to change the default config the SecurityProvider would get activated with defaults and would be then used by required components&lt;/li&gt;
	&lt;li&gt;if user wants to change some configuration then they need to follow steps under customizing config&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&lt;b&gt;Customizing Config&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;A) Create a configuration for Securityprovider with pid &lt;tt&gt;org.apache.jackrabbit.oak.security.SecurityProvider&lt;/tt&gt; and following content&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;authorizationConfiguration.cardinality.minimum=1
userConfiguration.cardinality.minimum=1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In above case we are changing the default configuration for &lt;tt&gt;authorizationConfiguration&lt;/tt&gt; and &lt;tt&gt;userConfiguration&lt;/tt&gt;. Here we utilize the new feature added in Declarative Service (&lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-4391&quot; title=&quot;[DS] R6/rfc190 Support &amp;lt;refname&amp;gt;.cardinality.minimum configuration property&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-4391&quot;&gt;&lt;del&gt;FELIX-4391&lt;/del&gt;&lt;/a&gt;) where a user can change the cardinality of the reference via configuration. In simple words through above config we change the requirement of &lt;tt&gt;userConfiguration&lt;/tt&gt; for SecurityProviderImpl from optional to mandatory. So untill &lt;tt&gt;UserConfiguration&lt;/tt&gt; service is not found SecurityProviderImpl would not be activated&lt;/p&gt;

&lt;p&gt;B) As second step user needs to create required config for components which it want to change. So here it must create config for &lt;tt&gt;org.apache.jackrabbit.oak.security.user.UserConfigurationImpl.config&lt;/tt&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;groupsPath=&quot;/home/groups&quot;
usersPath=&quot;/home/users&quot;
defaultDepth=&quot;1&quot;
importBehavior=&quot;besteffort&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Above setup ensures that SecurityProvider gets activated only after all default and overridden config are determined. And repository gets configured with a stable configuration &lt;/p&gt;

&lt;p&gt;&lt;b&gt;Changes done&lt;/b&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Removed the Activator from JCR and instead added a SCR based OakRepositoryFactory which does the job of registering the Repository service&lt;/li&gt;
	&lt;li&gt;Change the configuration policy for various security related configuration to REQUIRED (see above).&lt;/li&gt;
	&lt;li&gt;Change the references in SecurityProvider to optional multiple (see above)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;With this change the problem referred at &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; is also fixed and my testcase passes.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://markmail.org/thread/4lxpapeba3bk3d3k&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/thread/4lxpapeba3bk3d3k&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13923889" author="chetanm" created="Fri, 7 Mar 2014 14:01:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tripod&quot; class=&quot;user-hover&quot; rel=&quot;tripod&quot;&gt;tripod&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anchela&quot; class=&quot;user-hover&quot; rel=&quot;anchela&quot;&gt;anchela&lt;/a&gt; Can you review the patch&lt;/p&gt;</comment>
                            <comment id="13924155" author="tripod" created="Fri, 7 Mar 2014 18:22:04 +0000"  >&lt;p&gt;I don&apos;t think that is correct using OPTIONAL references in the security provider. The problem is, that the initial configurations set in the constructor) are only used in the non-osgi case. The SecurityProvider must not be available before all its configs are. otherwise the repository might start too early with the wrong config.&lt;/p&gt;

&lt;p&gt;Ultimately, I think we should get rid of the SecurityProvider, as it currently only acts merely as service registry for the security bits.&lt;/p&gt;</comment>
                            <comment id="13925223" author="chetanm" created="Sun, 9 Mar 2014 15:44:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;I don&apos;t think that is correct using OPTIONAL references in the security provider.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;As explained in &apos;Customizing Config&apos; section above the user can pre configure whether given config is optional or mandatory. The proposed approach ensures that SecurityProvider starts with a proper state and repository would never see wrong config&lt;/p&gt;

&lt;p&gt;Other option is that we make all references static and user must provide config files for all the security configurations. That I believe can be avoided with the approach suggested above&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Ultimately, I think we should get rid of the SecurityProvider, as it currently only acts merely as service registry for the security bits.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thats right. But before proposing patch for that (as thats bit bigger change) I would like to ensure that current setup works properly&lt;/p&gt;</comment>
                            <comment id="13925587" author="chetanm" created="Mon, 10 Mar 2014 09:29:12 +0000"  >&lt;p&gt;Updated patch which incorporates feedback from Tobi&lt;/p&gt;

&lt;p&gt;Key aspects&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;SecurityProvider now has required dependencies to all the security configuration components&lt;/li&gt;
	&lt;li&gt;If any config needs to be tweaked from default then it should be provisioned before Oak related bundles are started.&lt;/li&gt;
	&lt;li&gt;Moved the logic from Activator to RepositoryManager and made it to require configuration. This would allow users to use the default setup and also give them the choice to disable default setup and configure repository in custom mode&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13930067" author="chetanm" created="Tue, 11 Mar 2014 07:50:37 +0000"  >&lt;p&gt;Applied the patch with rev &lt;a href=&quot;http://svn.apache.org/r1576209&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1576209&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;To highlight one would need explicit config for PID &apos;org.apache.jackrabbit.oak.jcr.osgi.RepositoryManager&apos; for repository to be created as per default setup&lt;/p&gt;</comment>
                            <comment id="13945046" author="alex.parvulescu" created="Mon, 24 Mar 2014 13:36:36 +0000"  >&lt;p&gt;Bulk close for the 0.19 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12633654" name="OAK-1476-2.patch" size="26352" author="chetanm" created="Mon, 10 Mar 2014 09:29:12 +0000"/>
                            <attachment id="12633376" name="OAK-1476.patch" size="26661" author="chetanm" created="Fri, 7 Mar 2014 14:00:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>376110</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1st7z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>376406</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>