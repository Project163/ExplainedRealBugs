<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:48:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-3104] Version garbage collector doesn&apos;t collect a rolled back document if it was never deleted</title>
                <link>https://issues.apache.org/jira/browse/OAK-3104</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;If a commit gets rolled back it can leave (in case the document was never deleted explicitly) a document in a state like:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{
       &quot;_id&quot; : &quot;7:/etc/workflow/packages/2014/10/12/rep:ours&quot;,
       &quot;_deleted&quot; : {

       },
       &quot;_commitRoot&quot; : {

       },
       &quot;jcr:primaryType&quot; : {

       },
       &quot;_modified&quot; : NumberLong(1413126245),
       &quot;_children&quot; : true,
       &quot;_modCount&quot; : NumberLong(2)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the path is fairly busy, the document can get created naturally later and then follow the usual cycle. But, at times, such documents are ephemeral in nature and never re-used. In those cases, such documents can remain silently without getting collected.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12845197">OAK-3104</key>
            <summary>Version garbage collector doesn&apos;t collect a rolled back document if it was never deleted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="catholicon">Vikas Saurabh</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Jul 2015 07:34:34 +0000</created>
                <updated>Tue, 16 Feb 2021 09:52:38 +0000</updated>
                            <resolved>Tue, 21 Jul 2015 09:29:05 +0000</resolved>
                                    <version>1.0.17</version>
                    <version>1.2.2</version>
                    <version>1.3.3</version>
                                    <fixVersion>1.3.4</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>mongomk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14627665" author="catholicon" created="Wed, 15 Jul 2015 07:36:06 +0000"  >&lt;p&gt;As discussed with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt;, we should probably set_deletedOnce flag while rolling back. I&apos;d add a test and patch later.&lt;/p&gt;</comment>
                            <comment id="14633520" author="catholicon" created="Mon, 20 Jul 2015 12:31:54 +0000"  >&lt;p&gt;Attaching &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12746095/12746095_0001-OAK-3104-rollback-of-new-documents-should-mark-_dele.patch&quot; title=&quot;0001-OAK-3104-rollback-of-new-documents-should-mark-_dele.patch attached to OAK-3104&quot;&gt;0001*.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; which update &lt;tt&gt;UpdateOp.getReverseOperation&lt;/tt&gt; to set &lt;tt&gt;_deletedOnce&lt;/tt&gt; if original operation had &lt;tt&gt;isNew&lt;/tt&gt; set.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12746096/12746096_0002-OAK-3104-update-DocumentNodeStoreTest.rollback-to-as.patch&quot; title=&quot;0002-OAK-3104-update-DocumentNodeStoreTest.rollback-to-as.patch attached to OAK-3104&quot;&gt;0002*.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; is about updating &lt;tt&gt;DocumentNodeStoreTest.rollback&lt;/tt&gt; to assert &lt;tt&gt;_deletedOnce&lt;/tt&gt; is set correctly.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt;, can you please review these?&lt;/p&gt;</comment>
                            <comment id="14634754" author="mreutegg" created="Tue, 21 Jul 2015 08:24:11 +0000"  >&lt;p&gt;Thanks for the patches. I like the idea to set the &lt;tt&gt;_deletedOnce&lt;/tt&gt; flag based on &lt;tt&gt;isNew&lt;/tt&gt;, but I would rather not build it into &lt;tt&gt;UpdateOp.getReverseOperation&lt;/tt&gt;. This introduces a dependency from &lt;tt&gt;UpdateOp&lt;/tt&gt; to &lt;tt&gt;NodeDocument&lt;/tt&gt; and the &lt;tt&gt;NODES&lt;/tt&gt; collection. I think it would be better to set &lt;tt&gt;_deletedOnce&lt;/tt&gt; in &lt;tt&gt;Commit.rollback()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I also changed your test patch slightly. The node &lt;tt&gt;newNonConflictingNode&lt;/tt&gt; is never rolled back and the assertion text is therefore misleading. I also replaced &lt;tt&gt;doc.get(NodeDocument.DELETED_ONCE)&lt;/tt&gt; calls with &lt;tt&gt;doc.wasDeletedOnce()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=catholicon&quot; class=&quot;user-hover&quot; rel=&quot;catholicon&quot;&gt;catholicon&lt;/a&gt;, what do you think about my updated patch?&lt;/p&gt;</comment>
                            <comment id="14634792" author="catholicon" created="Tue, 21 Jul 2015 08:53:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt;, there are a couple of changes in NodeDocument which seem to be formatting change (apart from those for setDeletedOnce). Otherwise, this looks good.&lt;/p&gt;</comment>
                            <comment id="14634840" author="mreutegg" created="Tue, 21 Jul 2015 09:29:05 +0000"  >&lt;p&gt;You are right, my IDE must have re-formatted the code automatically.&lt;/p&gt;

&lt;p&gt;I committed the patch without those format changes to trunk: &lt;a href=&quot;http://svn.apache.org/r1692076&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1692076&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14706646" author="edivad" created="Fri, 21 Aug 2015 12:13:05 +0000"  >&lt;p&gt;Bulk close for 1.3.4&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12746095" name="0001-OAK-3104-rollback-of-new-documents-should-mark-_dele.patch" size="1300" author="catholicon" created="Mon, 20 Jul 2015 12:31:54 +0000"/>
                            <attachment id="12746096" name="0002-OAK-3104-update-DocumentNodeStoreTest.rollback-to-as.patch" size="4539" author="catholicon" created="Mon, 20 Jul 2015 12:31:54 +0000"/>
                            <attachment id="12746297" name="OAK-3104.patch" size="7532" author="mreutegg" created="Tue, 21 Jul 2015 08:24:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2h9tr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>