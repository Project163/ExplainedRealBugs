<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:47:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2811] Oak + data store: NPE in SegmentNodeStoreService.deactivate() leads to data store not shutting down properly</title>
                <link>https://issues.apache.org/jira/browse/OAK-2811</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;For some reason, on shutdown of a system, the &lt;tt&gt;observerTracker&lt;/tt&gt; in the SegmentNodeStoreService became null before deactivate() was called, leading to this NPE on &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/1.2/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentNodeStoreService.java#L404&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;line 404&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;24.04.2015 13:20:55.960 *ERROR* [FelixStartLevel] org.apache.jackrabbit.oak-core [org.apache.jackrabbit.oak.plugins.segment.SegmentNodeStoreService(87)] The deactivate method has thrown an exception (java.lang.NullPointerException)
java.lang.NullPointerException: null
	at org.apache.jackrabbit.oak.plugins.segment.SegmentNodeStoreService.deactivate(SegmentNodeStoreService.java:404)
	... just reflection and apache felix code on shutdown
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This in turn lead to the datastore not being closed (&lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/1.2/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/segment/SegmentNodeStoreService.java#L408&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4 lines later&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;In our case we used the CachingDataStore, which relies on close() being called, if not it triggers &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-3873&quot; title=&quot;CachingDataStore not safe against crashes, corrupted uploads file will prevent system startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JCR-3873&quot;&gt;&lt;del&gt;JCR-3873&lt;/del&gt;&lt;/a&gt;, which prevents the system from starting up again.&lt;/p&gt;

&lt;p&gt;In any case, the NPE should be guarded.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12823926">OAK-2811</key>
            <summary>Oak + data store: NPE in SegmentNodeStoreService.deactivate() leads to data store not shutting down properly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stillalex">Alex Deparvu</assignee>
                                    <reporter username="alexander.klimetschek">Alexander Klimetschek</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Apr 2015 22:52:09 +0000</created>
                <updated>Thu, 9 Jun 2016 15:24:27 +0000</updated>
                            <resolved>Tue, 28 Apr 2015 15:18:32 +0000</resolved>
                                    <version>1.2</version>
                                    <fixVersion>1.2.2</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>segmentmk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14513866" author="alex.parvulescu" created="Mon, 27 Apr 2015 10:24:27 +0000"  >&lt;p&gt;one way the _ observerTracker_ would be null is if the SegmentNodeStoreService has the &lt;em&gt;customBlob&lt;/em&gt; flag set, and because the specific service is not available yet, the &lt;em&gt;#registerNodeStore&lt;/em&gt; was not been called yet when the &lt;em&gt;#deactivate&lt;/em&gt; call happens. so I agree we need NPE guards here.&lt;br/&gt;
this being said, I think the store will also be null at this point so I don&apos;t see how it would help this situation (the &lt;em&gt;store.close&lt;/em&gt; call will not happen).&lt;/p&gt;</comment>
                            <comment id="14513868" author="alex.parvulescu" created="Mon, 27 Apr 2015 10:26:56 +0000"  >&lt;p&gt;fixed on trunk with &lt;a href=&quot;http://svn.apache.org/r1676237&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1676237&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14513869" author="alex.parvulescu" created="Mon, 27 Apr 2015 10:27:50 +0000"  >&lt;p&gt;tentatively setting 1.2.2 version to be picked up for evaluation&lt;/p&gt;</comment>
                            <comment id="14517139" author="egli" created="Tue, 28 Apr 2015 14:56:24 +0000"  >&lt;p&gt;Looking at the simplicity (ie no side-effects to be expected) it sounds reasonable to include this in 1.2.2 too..&lt;/p&gt;</comment>
                            <comment id="14517183" author="alex.parvulescu" created="Tue, 28 Apr 2015 15:18:32 +0000"  >&lt;p&gt;merged to 1.2 with &lt;a href=&quot;http://svn.apache.org/r1676560&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1676560&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14526358" author="mreutegg" created="Mon, 4 May 2015 07:23:33 +0000"  >&lt;p&gt;Bulk close for 1.2.2 release&lt;/p&gt;</comment>
                            <comment id="15322691" author="alex.parvulescu" created="Thu, 9 Jun 2016 15:24:27 +0000"  >&lt;p&gt;linking to &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2401&quot; title=&quot;SegmentNodeStoreService prone to deadlocks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2401&quot;&gt;&lt;del&gt;OAK-2401&lt;/del&gt;&lt;/a&gt;, as the current changes have been backported to 1.0 branch as a part of &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2401&quot; title=&quot;SegmentNodeStoreService prone to deadlocks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2401&quot;&gt;&lt;del&gt;OAK-2401&lt;/del&gt;&lt;/a&gt; so technically this issue should have fix version &apos;1.0.17&apos; too.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12767690">OAK-2401</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2dqwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>