<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:44:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1921] Backup: &quot;Attempt to read external blob&quot; error</title>
                <link>https://issues.apache.org/jira/browse/OAK-1921</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;I tried to backup a segmentstore (with an external BlobStore) using&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java -mx8g -jar oak-run-1.0.2-SNAPSHOT.jar backup segmentstore s2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and got:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Attempt to read external blob with blobId
[c184d2a3f1dbc709004a45ae6c5df7624c2ae653#32768] without specifying BlobStore
  at org.apache.jackrabbit.oak.plugins.segment.SegmentBlob.getReference(SegmentBlob.java:118)
  at org.apache.jackrabbit.oak.plugins.segment.SegmentWriter.writeBlob(SegmentWriter.java:706)
  at org.apache.jackrabbit.oak.plugins.segment.SegmentWriter.writeProperty(SegmentWriter.java:808)
  at org.apache.jackrabbit.oak.plugins.segment.SegmentWriter.writeProperty(SegmentWriter.java:796)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are two options:&lt;/p&gt;

&lt;p&gt;1) Adjust the backup code to work like compaction does, i.e. leave&lt;br/&gt;
external blobs as-is and perhaps output a message that informs the&lt;br/&gt;
user about the need to use a different mechanism to back up the&lt;br/&gt;
BlobStore contents&lt;/p&gt;

&lt;p&gt;2) Add command line options for configuring the BlobStore to be used&lt;br/&gt;
for accessing external blobs.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12723876">OAK-1921</key>
            <summary>Backup: &quot;Attempt to read external blob&quot; error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stillalex">Alex Deparvu</assignee>
                                    <reporter username="thomasm">Thomas Mueller</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Jun 2014 14:01:04 +0000</created>
                <updated>Wed, 1 Oct 2014 13:11:20 +0000</updated>
                            <resolved>Tue, 8 Jul 2014 07:35:52 +0000</resolved>
                                    <version>1.0</version>
                    <version>1.0.1</version>
                    <version>1.0.2</version>
                                    <fixVersion>1.0.2</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>segmentmk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14047464" author="alex.parvulescu" created="Mon, 30 Jun 2014 08:20:07 +0000"  >&lt;p&gt;I&apos;m attaching a patch to make the backup (and restore) more generic. Starting with this patch we can also tweak the settings to include a BlobStore via the command line.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;jukkaz&lt;/a&gt; feedback needed.&lt;/p&gt;</comment>
                            <comment id="14047499" author="jukkaz" created="Mon, 30 Jun 2014 09:38:18 +0000"  >&lt;p&gt;+1 Patch looks good.&lt;/p&gt;</comment>
                            <comment id="14047926" author="alex.parvulescu" created="Mon, 30 Jun 2014 18:14:57 +0000"  >&lt;p&gt;attached proposed patch for the main issue. I&apos;ve introduced a diff class that is binary aware, heavily based on the compaction code.&lt;/p&gt;

&lt;p&gt;I&apos;ve tested this against a repo that has an external store and the reported issue does&apos;t reproduce, but I did not add any unit tests (the setup would be quite complicated I guess).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;jukkaz&lt;/a&gt; feedback needed, as usual &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14051055" author="jukkaz" created="Thu, 3 Jul 2014 04:28:52 +0000"  >&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1932&quot; title=&quot;TarMK compaction can create mixed segments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1932&quot;&gt;&lt;del&gt;OAK-1932&lt;/del&gt;&lt;/a&gt; I adjusted the compaction code so that it can use different SegmentWriter than the normal one. That should make it easier to directly reuse the compaction code for this purpose instead of having to maintain a separate copy of mostly the same functionality.&lt;/p&gt;</comment>
                            <comment id="14051464" author="alex.parvulescu" created="Thu, 3 Jul 2014 14:05:06 +0000"  >&lt;p&gt;right, I&apos;m looking at changing the code: I&apos;m thinking to run compaction using the head state of one store against the backup store. it just might work &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Unfortunately, I&apos;ve ran into an issue with the compaction dropping content, see comment on &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1932&quot; title=&quot;TarMK compaction can create mixed segments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1932&quot;&gt;&lt;del&gt;OAK-1932&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14051516" author="alex.parvulescu" created="Thu, 3 Jul 2014 14:39:42 +0000"  >&lt;p&gt;attaching a first attempt at the compaction based backup.&lt;br/&gt;
the tests pass but running against a real repo throws an &lt;em&gt;IllegalStateException: Segment 3c9be9ae-5281-487a-af25-575f71b5bac1 not found&lt;/em&gt;, not yet sure why.&lt;/p&gt;</comment>
                            <comment id="14051594" author="alex.parvulescu" created="Thu, 3 Jul 2014 15:39:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;IllegalStateException&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;never mind, the patch works fine, I had a broken repo. I&apos;m now looking into the #restore bits&lt;/p&gt;</comment>
                            <comment id="14051878" author="alex.parvulescu" created="Thu, 3 Jul 2014 20:23:14 +0000"  >&lt;p&gt;fixed in trunk with &lt;a href=&quot;http://svn.apache.org/r1607737&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1607737&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1946&quot; title=&quot;Restore: &amp;quot;Attempt to read external blob&amp;quot; error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1946&quot;&gt;&lt;del&gt;OAK-1946&lt;/del&gt;&lt;/a&gt; for the restore code, to not block this issue any more.&lt;/p&gt;</comment>
                            <comment id="14051893" author="alex.parvulescu" created="Thu, 3 Jul 2014 20:39:46 +0000"  >&lt;p&gt;linking to &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1932&quot; title=&quot;TarMK compaction can create mixed segments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1932&quot;&gt;&lt;del&gt;OAK-1932&lt;/del&gt;&lt;/a&gt; to make sure this still works after that issue is fixed, and I still need to merge it to 1.0 once everything settles down.&lt;/p&gt;</comment>
                            <comment id="14054610" author="alex.parvulescu" created="Tue, 8 Jul 2014 07:35:52 +0000"  >&lt;p&gt;merged to 1.0 branch with &lt;a href=&quot;http://svn.apache.org/r1608683&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1608683&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12724529">OAK-1932</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12653840" name="FileStoreBackup.java.patch" size="2913" author="stillalex" created="Thu, 3 Jul 2014 14:39:42 +0000"/>
                            <attachment id="12653114" name="OAK-1921-generic-backup.patch" size="7307" author="stillalex" created="Mon, 30 Jun 2014 08:20:07 +0000"/>
                            <attachment id="12653197" name="OAK-1921.patch" size="13675" author="stillalex" created="Mon, 30 Jun 2014 18:14:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>402061</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 19 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1x7d3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>402127</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>