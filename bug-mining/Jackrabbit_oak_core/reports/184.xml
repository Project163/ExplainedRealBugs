<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:36:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-420] Query: Lucene index problem with isdescendantnode</title>
                <link>https://issues.apache.org/jira/browse/OAK-420</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Using isdescendantnode seems to be problematic with the Lucene index currently.&lt;br/&gt;
Adding isdescendantnode to some of the queries in sql2.txt and sql2_measure.txt works for&lt;br/&gt;
other index implementations, but breaks the LuceneIndexQueryTest.&lt;/p&gt;

&lt;p&gt;I believe the problem is isdescendantnode, but I&apos;m not completely sure.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12614496">OAK-420</key>
            <summary>Query: Lucene index problem with isdescendantnode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stillalex">Alex Deparvu</assignee>
                                    <reporter username="thomasm">Thomas Mueller</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Nov 2012 11:17:33 +0000</created>
                <updated>Mon, 20 Apr 2015 07:30:35 +0000</updated>
                            <resolved>Tue, 29 Jan 2013 16:19:05 +0000</resolved>
                                                    <fixVersion>0.7</fixVersion>
                                    <component>lucene</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13489367" author="tmueller" created="Fri, 2 Nov 2012 11:24:57 +0000"  >&lt;p&gt;Changed sql2.txt and sql2_measure.txt, and temporarily disabled those in LuceneIndexQueryTest in revision 1404926.&lt;/p&gt;
</comment>
                            <comment id="13495406" author="alex.parvulescu" created="Mon, 12 Nov 2012 16:49:19 +0000"  >&lt;p&gt;The problem here is that the lucene index can&apos;t express an &lt;tt&gt;ischildnode&lt;/tt&gt; condition correctly, everyting is treated as an &lt;tt&gt;isdescendantnode&lt;/tt&gt;&lt;br/&gt;
see fixme in the code &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;. &lt;/p&gt;

&lt;p&gt;Basically the path constraint is transformed into a &lt;tt&gt;path/*&lt;/tt&gt; in both cases, which matches direct children: &lt;tt&gt;path/foo&lt;/tt&gt; as well as descendant nodes: &lt;tt&gt;path/foo/bar&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;ve added a dedicated test for this, but there is no fix yet &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. I&apos;m not really sure what the most efficient solution is yet.&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://svn.apache.org/viewvc/jackrabbit/oak/trunk/oak-lucene/src/main/java/org/apache/jackrabbit/oak/plugins/index/lucene/LuceneIndex.java?view=markup#l202&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/jackrabbit/oak/trunk/oak-lucene/src/main/java/org/apache/jackrabbit/oak/plugins/index/lucene/LuceneIndex.java?view=markup#l202&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://svn.apache.org/viewvc/jackrabbit/oak/trunk/oak-lucene/src/test/java/org/apache/jackrabbit/oak/plugins/index/lucene/LuceneIndexQueryTest.java?view=markup#l100&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/jackrabbit/oak/trunk/oak-lucene/src/test/java/org/apache/jackrabbit/oak/plugins/index/lucene/LuceneIndexQueryTest.java?view=markup#l100&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13546950" author="alex.parvulescu" created="Tue, 8 Jan 2013 15:42:50 +0000"  >&lt;p&gt;it appears that the problem magically solved itself in the meantime. the sql2 test now fails because of an &quot;explain&quot; test that is included in the &quot;sql2&quot; test suite:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;explain select b.[jcr:path] as [jcr:path], b.[jcr:score] as [jcr:score], b.* from [nt:base] as a &lt;span class=&quot;code-keyword&quot;&gt;inner&lt;/span&gt; join [nt:base] as b on ischildnode(a, b) where name(a) = &lt;span class=&quot;code-quote&quot;&gt;&apos;yes&apos;&lt;/span&gt; and isdescendantnode(a, &lt;span class=&quot;code-quote&quot;&gt;&apos;/test&apos;&lt;/span&gt;) and b.[x] is not &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
[nt:base] as [a] &lt;span class=&quot;code-comment&quot;&gt;/* :path:/test/* where (name([a]) = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&apos;yes&apos;&lt;/span&gt; as string)) and (isdescendantnode([a], [/test])) */&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;inner&lt;/span&gt; join [nt:base] as [b] &lt;span class=&quot;code-comment&quot;&gt;/* x:{* TO *} where [b].[x] is not &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; */&lt;/span&gt; on ischildnode([a], [b])
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;-&amp;gt; :path:/test/* is the culprit&lt;/p&gt;

&lt;p&gt;maybe we can move the explain test to the &quot;explain&quot; suite so that I can reenable the lucene sql2 tests.&lt;/p&gt;</comment>
                            <comment id="13547733" author="tmueller" created="Wed, 9 Jan 2013 07:47:12 +0000"  >&lt;p&gt;&amp;gt; the problem magically solved itself in the meantime&lt;/p&gt;

&lt;p&gt;Self-healing code &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&amp;gt; maybe we can move the explain test to the &quot;explain&quot; suite&lt;/p&gt;

&lt;p&gt;Yes, the sql2 test should not contain &quot;explain&quot; statements.&lt;/p&gt;</comment>
                            <comment id="13548489" author="tmueller" created="Wed, 9 Jan 2013 13:12:15 +0000"  >&lt;p&gt;Revision 1430839: moved &quot;explain&quot; statement.&lt;/p&gt;</comment>
                            <comment id="13565488" author="alex.parvulescu" created="Tue, 29 Jan 2013 16:19:05 +0000"  >&lt;p&gt;I re-enabled the tests for the lucene index impl&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253971</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0edrb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>81991</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>