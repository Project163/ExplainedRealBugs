<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:46:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2226] Aggregate Lucene no results for multiple jcr:contains</title>
                <link>https://issues.apache.org/jira/browse/OAK-2226</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;When running queries like &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;/jcr:root/content&lt;span class=&quot;code-comment&quot;&gt;//element(*, nt:unstructured)[
&lt;/span&gt;(jcr:contains(., &lt;span class=&quot;code-quote&quot;&gt;&apos;mountain&apos;&lt;/span&gt;))
and (jcr:contains(jcr:content/metadata/@format, &lt;span class=&quot;code-quote&quot;&gt;&apos;image&apos;&lt;/span&gt;))]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Lucene does not return any node&lt;/p&gt;</description>
                <environment></environment>
        <key id="12749774">OAK-2226</key>
            <summary>Aggregate Lucene no results for multiple jcr:contains</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chetanm">Chetan Mehrotra</assignee>
                                    <reporter username="edivad">Davide Giannella</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Oct 2014 13:44:27 +0000</created>
                <updated>Tue, 8 Oct 2019 15:22:15 +0000</updated>
                            <resolved>Wed, 29 Oct 2014 15:23:29 +0000</resolved>
                                    <version>1.1.1</version>
                                    <fixVersion>1.0.8</fixVersion>
                    <fixVersion>1.1.2</fixVersion>
                                    <component>lucene</component>
                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14179907" author="edivad" created="Wed, 22 Oct 2014 13:48:23 +0000"  >&lt;p&gt;Attaching &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12676566/12676566_OAK-2226.test.patch&quot; title=&quot;OAK-2226.test.patch attached to OAK-2226&quot;&gt;OAK-2226.test.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; to reproduce the case&lt;/p&gt;</comment>
                            <comment id="14185140" author="tmueller" created="Mon, 27 Oct 2014 13:54:53 +0000"  >&lt;p&gt;I think the test case is incorrect. It should be&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;expected.setProperty(&quot;title&quot;, &quot;Lorem mountain ipsum&quot;, STRING);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;instead of&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;node.setProperty(&quot;title&quot;, &quot;Lorem mountain ipsum&quot;, STRING);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14185156" author="tmueller" created="Mon, 27 Oct 2014 14:10:16 +0000"  >&lt;p&gt;With the changed test case, the test succeeds with both trunk and 1.0 branch for me.&lt;/p&gt;</comment>
                            <comment id="14185162" author="chetanm" created="Mon, 27 Oct 2014 14:14:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=edivad&quot; class=&quot;user-hover&quot; rel=&quot;edivad&quot;&gt;edivad&lt;/a&gt; The testcase fails for me on both trunk and branch. So I do not think its a regression introduced with recent changes done in Lucene index. Also with change proposed by Thomas the testcase passes on both.&lt;/p&gt;

&lt;p&gt;Can you have a look at the test?&lt;/p&gt;</comment>
                            <comment id="14185288" author="edivad" created="Mon, 27 Oct 2014 16:08:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt; you&apos;re right. I was not convinced of the test&lt;br/&gt;
as well and had on my agenda to give a deeper look today.&lt;/p&gt;

&lt;p&gt;In &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12677321/12677321_OAK-2226.test-r2.patch&quot; title=&quot;OAK-2226.test-r2.patch attached to OAK-2226&quot;&gt;OAK-2226.test-r2.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; there&apos;s a unit test that reproduce a very&lt;br/&gt;
very close situation as where I saw the error happening and it&lt;br/&gt;
&lt;b&gt;doesn&apos;t fail&lt;/b&gt; on trunk.&lt;/p&gt;

&lt;p&gt;I&apos;ll continue my investigation.&lt;/p&gt;
</comment>
                            <comment id="14188191" author="edivad" created="Wed, 29 Oct 2014 09:53:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt; I&apos;m attaching &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12677858/12677858_OAK-2226.test-r3.patch&quot; title=&quot;OAK-2226.test-r3.patch attached to OAK-2226&quot;&gt;OAK-2226.test-r3.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; a new&lt;br/&gt;
version of the test case that now fails.&lt;/p&gt;

&lt;p&gt;It was not failing before as the issue introduced is on the cost&lt;br/&gt;
calculation and the test was before using the&lt;br/&gt;
&lt;tt&gt;LowcostLuceneIndexProvide&lt;/tt&gt;.&lt;/p&gt;
</comment>
                            <comment id="14188223" author="tmueller" created="Wed, 29 Oct 2014 10:39:09 +0000"  >&lt;p&gt;A patch for the AggregateIndex. There is still a TODO in the code: the LucenePropertyIndex must not be wrapped by the AggregateIndex.&lt;/p&gt;</comment>
                            <comment id="14188226" author="tmueller" created="Wed, 29 Oct 2014 10:46:05 +0000"  >&lt;p&gt;With my patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2226&quot; title=&quot;Aggregate Lucene no results for multiple jcr:contains&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2226&quot;&gt;&lt;del&gt;OAK-2226&lt;/del&gt;&lt;/a&gt;-AggregateIndex-trunk.patch), the new test (&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2226&quot; title=&quot;Aggregate Lucene no results for multiple jcr:contains&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2226&quot;&gt;&lt;del&gt;OAK-2226&lt;/del&gt;&lt;/a&gt;.test-r3.patch) works for me.&lt;/p&gt;

&lt;p&gt;The open issue is not to wrap the LucenePropertyIndex, and then remove the old test and the hack (&quot;if (baseIndex.getClass().toString().indexOf(&quot;LucenePropertyIndex&quot;) &amp;gt;= 0)&quot;) in my patch. And re-test &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="14188229" author="edivad" created="Wed, 29 Oct 2014 10:50:35 +0000"  >&lt;p&gt;Committed an @Ignore test case in trunk @ &lt;a href=&quot;http://svn.apache.org/r1635094&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1635094&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14188230" author="tmueller" created="Wed, 29 Oct 2014 10:51:09 +0000"  >&lt;p&gt;The LucenePropertyIndex is still wrapped, in AggregateIndexProvider. I think it makes sense to (for now, at least) not make it implement the AdvanceFulltextQueryIndex but just the AdvanceQueryIndex. That should resolve the issue.&lt;/p&gt;</comment>
                            <comment id="14188294" author="tmueller" created="Wed, 29 Oct 2014 12:17:13 +0000"  >&lt;p&gt;Fixed in revision 1635108 (trunk) - the test case is now enabled&lt;/p&gt;</comment>
                            <comment id="14188444" author="tmueller" created="Wed, 29 Oct 2014 15:22:45 +0000"  >&lt;p&gt;Revision 1635175&lt;br/&gt;
Added the test case to the 1.0 branch, so we don&apos;t accidentally break it there.&lt;br/&gt;
I also had to add the NodeTypeRegistry&lt;/p&gt;</comment>
                            <comment id="14188445" author="tmueller" created="Wed, 29 Oct 2014 15:23:29 +0000"  >&lt;p&gt;I consider this fixed now.&lt;/p&gt;</comment>
                            <comment id="14188460" author="edivad" created="Wed, 29 Oct 2014 15:38:25 +0000"  >&lt;p&gt;I manually tested it on my end with the full end use case and it passes. I consider it fixed as well.&lt;/p&gt;</comment>
                            <comment id="14191284" author="chetanm" created="Fri, 31 Oct 2014 03:45:06 +0000"  >&lt;p&gt;Merged the fix to 1.0 in &lt;a href=&quot;http://svn.apache.org/r1635662&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1635662&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14195906" author="alex.parvulescu" created="Tue, 4 Nov 2014 08:54:35 +0000"  >&lt;p&gt;Bulk close for 1.0.8&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12743227">OAK-2119</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12677867" name="OAK-2226-AggregateIndex-trunk.patch" size="27179" author="thomasm" created="Wed, 29 Oct 2014 10:39:09 +0000"/>
                            <attachment id="12677321" name="OAK-2226.test-r2.patch" size="12472" author="edivad" created="Mon, 27 Oct 2014 16:08:40 +0000"/>
                            <attachment id="12677858" name="OAK-2226.test-r3.patch" size="12458" author="edivad" created="Wed, 29 Oct 2014 09:53:06 +0000"/>
                            <attachment id="12676566" name="OAK-2226.test.patch" size="2706" author="edivad" created="Thu, 23 Oct 2014 11:01:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21g4n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>