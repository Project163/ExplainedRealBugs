<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:49:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-3499] Test failures when there is no network interface</title>
                <link>https://issues.apache.org/jira/browse/OAK-3499</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;There are test failures when no network interface is available.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Tests in error: 
  purge(org.apache.jackrabbit.oak.plugins.document.CollisionTest): Configured cluster node id 1 already in use: 
  inactiveClusterId(org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreTest): Configured cluster node id 2 already in use: 
  purgeUnmergedBranch(org.apache.jackrabbit.oak.plugins.document.UnmergedBranchTest): Configured cluster node id 1 already in use: 

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m quite confident these used to work before.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reschke&quot; class=&quot;user-hover&quot; rel=&quot;reschke&quot;&gt;reschke&lt;/a&gt;, could this be caused by recent changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3449&quot; title=&quot;DocumentNodeStore support for predefined clusterIds should use ClusterNodeInfos&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3449&quot;&gt;&lt;del&gt;OAK-3449&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12903449">OAK-3499</key>
            <summary>Test failures when there is no network interface</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reschke">Julian Reschke</assignee>
                                    <reporter username="mreutegg">Marcel Reutegger</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Oct 2015 18:59:14 +0000</created>
                <updated>Wed, 2 Mar 2016 14:54:49 +0000</updated>
                            <resolved>Thu, 29 Oct 2015 15:52:27 +0000</resolved>
                                    <version>1.3.8</version>
                                    <fixVersion>1.2.8</fixVersion>
                    <fixVersion>1.3.10</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>core</component>
                    <component>mongomk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14949303" author="reschke" created="Thu, 8 Oct 2015 20:10:11 +0000"  >&lt;p&gt;Potentially. I removed the case where an empty network id (byte&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;) was considered a unique identifier... Who can I repro this?&lt;/p&gt;</comment>
                            <comment id="14962946" author="mreutegg" created="Mon, 19 Oct 2015 07:11:47 +0000"  >&lt;p&gt;I&apos;m able to reproduce this on a MacBook without network connectivity. I can run&lt;br/&gt;
the test again with DEBUG enabled if you think this is helpful.&lt;/p&gt;</comment>
                            <comment id="14962956" author="reschke" created="Mon, 19 Oct 2015 07:23:18 +0000"  >&lt;p&gt;Yes, DEBUG would be helpful to see what machineID actually gets used.&lt;/p&gt;</comment>
                            <comment id="14976114" author="mreutegg" created="Tue, 27 Oct 2015 09:54:50 +0000"  >&lt;p&gt;I ran CollisionTest again with ClusterNodeInfo set to DEBUG and no network connectivity. The log output is:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;10:51:13.049 DEBUG [main] ClusterNodeInfo.java:822          getMachineId(): discovered addresses: [] []
10:51:13.143 INFO  [main] DocumentNodeStore.java:540        Initialized DocumentNodeStore with clusterNodeId: 1 (id: 1, startTime: 1445939473064, machineId: random:297454f8-8691-48f8-bcf1-81831206d87d, instanceId: /Users/mreutegg/devel/apache/oak/trunk/oak-core, pid: 24190, uuid: 4b364641-cbf0-4212-a701-f63c8ebd886a, readWriteMode: null, state: NONE, revLock: NONE, oakVersion: SNAPSHOT)
10:51:13.145 INFO  [main] DocumentNodeStore.java:540        Initialized DocumentNodeStore with clusterNodeId: 2 (id: 2, startTime: 1445939473143, machineId: random:297454f8-8691-48f8-bcf1-81831206d87d, instanceId: /Users/mreutegg/devel/apache/oak/trunk/oak-core, pid: 24190, uuid: 911fb138-9077-46eb-873c-f11783970c4d, readWriteMode: null, state: NONE, revLock: NONE, oakVersion: SNAPSHOT)
10:51:13.163 INFO  [main] DocumentNodeStore.java:552        Starting disposal of DocumentNodeStore with clusterNodeId: 1 (id: 1, startTime: 1445939473064, machineId: random:297454f8-8691-48f8-bcf1-81831206d87d, instanceId: /Users/mreutegg/devel/apache/oak/trunk/oak-core, pid: 24190, uuid: 4b364641-cbf0-4212-a701-f63c8ebd886a, readWriteMode: null, state: NONE, revLock: NONE, oakVersion: SNAPSHOT)
10:51:13.164 INFO  [main] DocumentNodeStore.java:609        Disposed DocumentNodeStore with clusterNodeId: 1
10:51:13.165 DEBUG [main] ClusterNodeInfo.java:463          Cleaned up cluster node info for clusterNodeId 1 [machineId: random:297454f8-8691-48f8-bcf1-81831206d87d, leaseEnd: n/a]
10:51:13.165 INFO  [main] DocumentNodeStore.java:552        Starting disposal of DocumentNodeStore with clusterNodeId: 1 (id: 1, startTime: 1445939473064, machineId: random:297454f8-8691-48f8-bcf1-81831206d87d, instanceId: /Users/mreutegg/devel/apache/oak/trunk/oak-core, pid: 24190, uuid: 4b364641-cbf0-4212-a701-f63c8ebd886a, readWriteMode: null, state: NONE, revLock: NONE, oakVersion: SNAPSHOT)
10:51:13.165 INFO  [main] DocumentNodeStore.java:552        Starting disposal of DocumentNodeStore with clusterNodeId: 2 (id: 2, startTime: 1445939473143, machineId: random:297454f8-8691-48f8-bcf1-81831206d87d, instanceId: /Users/mreutegg/devel/apache/oak/trunk/oak-core, pid: 24190, uuid: 911fb138-9077-46eb-873c-f11783970c4d, readWriteMode: null, state: NONE, revLock: NONE, oakVersion: SNAPSHOT)
10:51:13.166 INFO  [main] DocumentNodeStore.java:609        Disposed DocumentNodeStore with clusterNodeId: 2
10:51:13.167 INFO  [main] UnmergedBranches.java:92          Purged [1] uncommitted branch revision entries
10:51:13.167 INFO  [main] UnmergedBranches.java:96          Purged [1] collision markers
10:51:13.168 INFO  [main] DocumentNodeStore.java:540        Initialized DocumentNodeStore with clusterNodeId: 1 (id: 1, startTime: 1445939473166, machineId: random:297454f8-8691-48f8-bcf1-81831206d87d, instanceId: /Users/mreutegg/devel/apache/oak/trunk/oak-core, pid: 24190, uuid: ec8b1c17-5be6-49ca-bc2c-5eaa34f5df5b, readWriteMode: null, state: NONE, revLock: NONE, oakVersion: SNAPSHOT)
10:51:13.168 INFO  [main] DocumentNodeStore.java:552        Starting disposal of DocumentNodeStore with clusterNodeId: 1 (id: 1, startTime: 1445939473166, machineId: random:297454f8-8691-48f8-bcf1-81831206d87d, instanceId: /Users/mreutegg/devel/apache/oak/trunk/oak-core, pid: 24190, uuid: ec8b1c17-5be6-49ca-bc2c-5eaa34f5df5b, readWriteMode: null, state: NONE, revLock: NONE, oakVersion: SNAPSHOT)
10:51:13.169 INFO  [main] DocumentNodeStore.java:609        Disposed DocumentNodeStore with clusterNodeId: 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The exception from the test:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;purge(org.apache.jackrabbit.oak.plugins.document.CollisionTest)  Time elapsed: 0.419 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
org.apache.jackrabbit.oak.plugins.document.DocumentStoreException: Configured cluster node id 1 already in use: 
	at org.apache.jackrabbit.oak.plugins.document.ClusterNodeInfo.createInstance(ClusterNodeInfo.java:490)
	at org.apache.jackrabbit.oak.plugins.document.ClusterNodeInfo.getInstance(ClusterNodeInfo.java:377)
	at org.apache.jackrabbit.oak.plugins.document.ClusterNodeInfo.getInstance(ClusterNodeInfo.java:338)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStore.&amp;lt;init&amp;gt;(DocumentNodeStore.java:431)
	at org.apache.jackrabbit.oak.plugins.document.DocumentMK$Builder.getNodeStore(DocumentMK.java:659)
	at org.apache.jackrabbit.oak.plugins.document.DocumentMKBuilderProvider$DisposingDocumentMKBuilder.getNodeStore(DocumentMKBuilderProvider.java:73)
	at org.apache.jackrabbit.oak.plugins.document.DocumentMK.&amp;lt;init&amp;gt;(DocumentMK.java:121)
	at org.apache.jackrabbit.oak.plugins.document.DocumentMK$Builder.open(DocumentMK.java:881)
	at org.apache.jackrabbit.oak.plugins.document.CollisionTest.purge(CollisionTest.java:55)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14976470" author="reschke" created="Tue, 27 Oct 2015 14:27:37 +0000"  >&lt;p&gt;Yup, can be reproduced by commenting out the code that finds hardware interfaces.&lt;/p&gt;

&lt;p&gt;What happens here is that in that case, when the DocumentNodeStore (setClusterId(1)) is initialized the second time, it won&apos;t be able to re-use the existing ClusterNodeInfo, as the machineId (set to a random UUID) does not match. That was indeed intentional.&lt;/p&gt;

&lt;p&gt;We probably need to tune the test case in some way. &lt;/p&gt;</comment>
                            <comment id="14976566" author="mreutegg" created="Tue, 27 Oct 2015 15:31:08 +0000"  >&lt;p&gt;But isn&apos;t this rather strange behaviour? The DocumentNodeStore is disposed, which means the clusterId is not in use anymore. There is no lease on the clusterId. AFAICS, the entry is even cleaned up in &lt;tt&gt;ClusterNodeInfo.createInstance()&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14976568" author="mreutegg" created="Tue, 27 Oct 2015 15:32:33 +0000"  >&lt;p&gt;Maybe we should remove such entries on DocumentNodeStore.dispose()?&lt;/p&gt;</comment>
                            <comment id="14976572" author="reschke" created="Tue, 27 Oct 2015 15:33:35 +0000"  >&lt;p&gt;With random IDs? Might be a plan. Good idea.&lt;/p&gt;</comment>
                            <comment id="14976583" author="mreutegg" created="Tue, 27 Oct 2015 15:41:16 +0000"  >&lt;p&gt;Yes, just those with random IDs.&lt;/p&gt;</comment>
                            <comment id="14978338" author="reschke" created="Wed, 28 Oct 2015 12:37:16 +0000"  >&lt;p&gt;This patch (1) introduces a system property through which a specific hardware address (or the lack of) can be simulated and (2) changes the cluster node lookup code to skip entries that are going to be deleted (because using random IDs and being expired).&lt;/p&gt;

&lt;p&gt;With these changes the three tests pass even if no hardware address is available, however &lt;tt&gt;LastRevRecoveryRandomizedIT&lt;/tt&gt; fails; it assumes that LastRevRecovery is run, however it doesn&apos;t as the cluster node info document gets deleted and re-created.&lt;/p&gt;</comment>
                            <comment id="14980483" author="mreutegg" created="Thu, 29 Oct 2015 14:13:31 +0000"  >&lt;p&gt;Discussed this issue with Julian and we concluded the current behaviour of deleting ClusterNodeInfo with a UUID and expired lease is actually incorrect. This prevents recovery from running for this ClusterNodeInfo, which is exactly why LastRevRecoveryRandomizedIT fails.&lt;/p&gt;

&lt;p&gt;The implementation should only delete a ClusterNodeInfo with a UUID when the there is no lease at all on it.&lt;/p&gt;</comment>
                            <comment id="14980665" author="reschke" created="Thu, 29 Oct 2015 15:52:27 +0000"  >&lt;p&gt;trunk: &lt;a href=&quot;http://svn.apache.org/r1711296&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1711296&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14980710" author="mreutegg" created="Thu, 29 Oct 2015 16:18:30 +0000"  >&lt;p&gt;Adjusted fix version to 1.3.10. There&apos;s an ongoing vote for 1.3.9.&lt;/p&gt;</comment>
                            <comment id="14991653" author="reschke" created="Thu, 5 Nov 2015 13:32:08 +0000"  >&lt;p&gt;1.2: &lt;a href=&quot;http://svn.apache.org/r1712760&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1712760&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15002114" author="edivad" created="Thu, 12 Nov 2015 13:54:35 +0000"  >&lt;p&gt;Bulk close for 1.3.10&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12896376">OAK-3449</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12769271" name="OAK-3499.diff" size="4374" author="reschke" created="Wed, 28 Oct 2015 12:37:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 1 week, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mrn3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>