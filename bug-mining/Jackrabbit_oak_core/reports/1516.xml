<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:51:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-4518] ConcurrentAddReferenceTest fails occasionally (remove docChildrenCache)</title>
                <link>https://issues.apache.org/jira/browse/OAK-4518</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Occasional test failures have already been reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1472&quot; title=&quot;ConcurrentAddReferenceTest#addReferences still fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1472&quot;&gt;&lt;del&gt;OAK-1472&lt;/del&gt;&lt;/a&gt;, but it still fails every now and &lt;a href=&quot;https://travis-ci.org/apache/jackrabbit-oak/builds/140501786&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;then&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12984801">OAK-4518</key>
            <summary>ConcurrentAddReferenceTest fails occasionally (remove docChildrenCache)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="mreutegg">Marcel Reutegger</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Jun 2016 08:12:14 +0000</created>
                <updated>Thu, 20 Sep 2018 12:21:18 +0000</updated>
                            <resolved>Wed, 20 Jul 2016 10:41:49 +0000</resolved>
                                    <version>1.0</version>
                    <version>1.2</version>
                    <version>1.4</version>
                                    <fixVersion>1.5.6</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                    <fixVersion>1.0.40</fixVersion>
                    <fixVersion>1.4.19</fixVersion>
                    <fixVersion>1.2.28</fixVersion>
                                    <component>core</component>
                    <component>documentmk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15354788" author="mreutegg" created="Wed, 29 Jun 2016 08:32:17 +0000"  >&lt;p&gt;I&apos;m able to reproduce the issue rather frequently on MongoDB and RDB with tests based on the original one and BMUnit (byteman). Unfortunately byteman is LGPL and we can&apos;t include the test. Maybe it is not actually the random sleeps injected into the code, but rather the additional calls that are sufficient to trigger the issue more frequently.&lt;/p&gt;</comment>
                            <comment id="15354866" author="chetanm" created="Wed, 29 Jun 2016 09:23:08 +0000"  >&lt;p&gt;Liked the use of bytecode manipulation to create timing scenarios! &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Unfortunately byteman is LGPL and we can&apos;t include the test&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thats bad&lt;/p&gt;</comment>
                            <comment id="15355353" author="mreutegg" created="Wed, 29 Jun 2016 14:45:57 +0000"  >&lt;p&gt;Added a test that fails more reliably (currently ignored): &lt;a href=&quot;http://svn.apache.org/r1750656&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1750656&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15356913" author="mreutegg" created="Thu, 30 Jun 2016 11:08:38 +0000"  >&lt;p&gt;The problem is caused by the &lt;tt&gt;docChildrenCache&lt;/tt&gt; in &lt;tt&gt;DocumentNodeStore&lt;/tt&gt;. The cache is populated by commits when they exit the commit queue (this is serialized) and when child nodes are queried. Those two usages are not properly synchronized and it may happen that a query puts stale data into the cache.&lt;/p&gt;

&lt;p&gt;It would be best to remove this cache entirely. In contrast to other caches, this one is not revision based and hard to maintain. Instead the DocumentNodeStore must try to reduce queries for child nodes. There is already an open issue for this: &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1322&quot; title=&quot;Reduce calls to MongoDB&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1322&quot;&gt;&lt;del&gt;OAK-1322&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15356972" author="chetanm" created="Thu, 30 Jun 2016 12:03:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;It would be best to remove this cache entirely. In contrast to other caches, this one is not revision based and hard to maintain.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1. This cache also has poor hit ratio in many of the setups I have seen.&lt;/p&gt;</comment>
                            <comment id="15385656" author="mreutegg" created="Wed, 20 Jul 2016 10:41:50 +0000"  >&lt;p&gt;Removed the docChildrenCache and enabled the additional test.&lt;/p&gt;

&lt;p&gt;Fixed in trunk: &lt;a href=&quot;http://svn.apache.org/r1753481&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1753481&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15391319" author="amitjain" created="Mon, 25 Jul 2016 04:17:20 +0000"  >&lt;p&gt;Bulk Close 1.5.6&lt;/p&gt;</comment>
                            <comment id="16262890" author="mreutegg" created="Wed, 22 Nov 2017 16:35:33 +0000"  >&lt;p&gt;Merged into branches:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;1.4: &lt;a href=&quot;http://svn.apache.org/r1816067&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1816067&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;1.2: &lt;a href=&quot;http://svn.apache.org/r1816107&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1816107&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;1.0: &lt;a href=&quot;http://svn.apache.org/r1816115&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1816115&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12697411">OAK-1472</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12913682">OAK-3646</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12688733">OAK-1322</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12814618" name="OAK-4518-test.patch" size="9852" author="mreutegg" created="Wed, 29 Jun 2016 08:32:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 51 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30at3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>