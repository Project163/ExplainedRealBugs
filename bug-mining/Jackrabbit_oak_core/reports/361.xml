<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:38:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-898] Session#move with a fresh session doesn&apos;t work properly</title>
                <link>https://issues.apache.org/jira/browse/OAK-898</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The scenario is as follows: create a node, then try to move it using a new session.&lt;/p&gt;

&lt;p&gt;Will attach a test case.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12657276">OAK-898</key>
            <summary>Session#move with a fresh session doesn&apos;t work properly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mduerig">Michael D&#252;rig</assignee>
                                    <reporter username="stillalex">Alex Deparvu</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Jul 2013 14:57:42 +0000</created>
                <updated>Fri, 20 Sep 2013 07:01:47 +0000</updated>
                            <resolved>Fri, 12 Jul 2013 21:06:27 +0000</resolved>
                                                    <fixVersion>0.9</fixVersion>
                                    <component>jcr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13705893" author="alex.parvulescu" created="Thu, 11 Jul 2013 15:02:48 +0000"  >&lt;p&gt;I pushed the test showing the issue (ignored currently) with rev &lt;a href=&quot;http://svn.apache.org/r1502240&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1502240&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13705939" author="jukkaz" created="Thu, 11 Jul 2013 15:55:41 +0000"  >&lt;p&gt;Looking at the test case, a &lt;tt&gt;node1.getSession().refresh()&lt;/tt&gt; call seems to be missing. Note that with Oak sessions are based on snapshots of the repository state, so a refresh, either explicit or implicit (triggered for example by the auto-refresh feature), is needed for changes from another session to become visible. Also, we currently only track moves within a single session, so in this case &lt;tt&gt;node1&lt;/tt&gt; would actually become invalid after the refresh.&lt;/p&gt;</comment>
                            <comment id="13706194" author="mduerig" created="Thu, 11 Jul 2013 20:32:42 +0000"  >&lt;p&gt;Jukka is right here, I didn&apos;t realise this before. &lt;/p&gt;

&lt;p&gt;The expectation encoded in the test case is apparently what the Sling PostServlet expects (personal communication with Alex, correct me when I got this wrong). &lt;/p&gt;</comment>
                            <comment id="13706774" author="alex.parvulescu" created="Fri, 12 Jul 2013 08:00:09 +0000"  >&lt;p&gt;makes sense, I&apos;ve tweaked the test to make it closer to what happens behind the scenes in my failing scenario: removed the failing assert (as Jukka mentioned it was not an issue), and added a getNode call with a new session which fails with a &lt;em&gt;PathNotFoundException&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Worth to mention that the failure I see is based on the &lt;em&gt;@MoveFrom&lt;/em&gt; functionality from the sling post servlet, and I think all the steps outlined in the provided test are done via http POST calls using new sessions, that&apos;s why I&apos;m having a bit of a hard time reproducing this in a pure oak environment.&lt;br/&gt;
For reference, here are some sling integration tests that cover these bits.&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://svn.apache.org/viewvc/sling/trunk/launchpad/integration-tests/src/main/java/org/apache/sling/launchpad/webapp/integrationtest/servlets/post/PostServletAtMoveTest.java?view=markup#l37&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/sling/trunk/launchpad/integration-tests/src/main/java/org/apache/sling/launchpad/webapp/integrationtest/servlets/post/PostServletAtMoveTest.java?view=markup#l37&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13706810" author="alex.parvulescu" created="Fri, 12 Jul 2013 09:16:30 +0000"  >&lt;p&gt;as discussed with Michael offline, the latest version of the test is lacking a #save call after the move. &lt;br/&gt;
I&apos;m unsure at which point in the http post call the save happens, so I cannot yet fully reproduce the failing move test.&lt;/p&gt;

&lt;p&gt;I&apos;ll try to find more info on this topic.&lt;/p&gt;</comment>
                            <comment id="13707254" author="alex.parvulescu" created="Fri, 12 Jul 2013 19:04:45 +0000"  >&lt;p&gt;I think I have more info. I tracked down the missing #save call in sling &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;.&lt;br/&gt;
It turns out the #save call is conditioned by a #hasPendingChanges check, to which oak returns false.&lt;/p&gt;

&lt;p&gt;I have updated the test to reflect this latest details.&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://svn.apache.org/viewvc/sling/trunk/bundles/jcr/resource/src/main/java/org/apache/sling/jcr/resource/internal/helper/jcr/JcrResourceProvider.java?view=markup#l522&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/sling/trunk/bundles/jcr/resource/src/main/java/org/apache/sling/jcr/resource/internal/helper/jcr/JcrResourceProvider.java?view=markup#l522&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13707264" author="alex.parvulescu" created="Fri, 12 Jul 2013 19:07:51 +0000"  >&lt;p&gt;fyi I quickly checked, jackrabbit returns true on the #hasPendingChanges call&lt;/p&gt;</comment>
                            <comment id="13707353" author="mduerig" created="Fri, 12 Jul 2013 20:48:36 +0000"  >&lt;p&gt;Good catch. It seems &lt;tt&gt;Root.move&lt;/tt&gt; doesn&apos;t touch the pending changes state. I&apos;ll have a look.&lt;/p&gt;</comment>
                            <comment id="13707374" author="mduerig" created="Fri, 12 Jul 2013 21:06:27 +0000"  >&lt;p&gt;Fixed at revision 1502689. Thanks for hunting this one down Alex!&lt;/p&gt;</comment>
                            <comment id="13772819" author="alex.parvulescu" created="Fri, 20 Sep 2013 07:01:47 +0000"  >&lt;p&gt;Bulk close for the 0.9 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>337498</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1m7pb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>337821</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>