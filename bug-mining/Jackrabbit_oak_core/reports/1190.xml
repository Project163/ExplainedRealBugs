<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:47:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2720] Misleading traversal warning message while performing query</title>
                <link>https://issues.apache.org/jira/browse/OAK-2720</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Currently &lt;tt&gt;ContentMirrorStoreStrategy&lt;/tt&gt; logs a traversal warning if the property index performs node traversal of more than 10000 (default). &lt;/p&gt;

&lt;p&gt;The intention here being to warn the end user that traversing so many nodes would cause performance issue. Traversal in itself might happen due to many reason like&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Query not using right index. If the query has two property restriction and one of them is more broad while other is more selective and index is defined only for first then more traversal would be performed. The warning should help the user to create a new index for second property&lt;/li&gt;
	&lt;li&gt;Caller is fetching way more result - Query might end with say 50k result and caller is reading all. Such warning would help user to probably go for pagination&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;So above are valid cases. However currently warning is also seen even if end result set is small say 100 but indexed paths are deep. As &lt;tt&gt;ContentMirrorStoreStrategy&lt;/tt&gt; mirrors the path structure the current counting logic also counts the intermediate traversals. This warning is then misleading as how this internal structure is created is an implementation details of index which end user does not have any control. This leaves following options&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Use different storage strategy which is more efficient in storage&lt;/li&gt;
	&lt;li&gt;Do not count the intermediate nodes traversed within index path and instead only count the matching node&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="12818800">OAK-2720</key>
            <summary>Misleading traversal warning message while performing query</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chetanm">Chetan Mehrotra</assignee>
                                    <reporter username="chetanm">Chetan Mehrotra</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Apr 2015 05:09:37 +0000</created>
                <updated>Tue, 8 Oct 2019 15:22:10 +0000</updated>
                            <resolved>Tue, 7 Apr 2015 10:40:31 +0000</resolved>
                                                    <fixVersion>1.0.13</fixVersion>
                    <fixVersion>1.2</fixVersion>
                                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14482610" author="chetanm" created="Tue, 7 Apr 2015 05:14:56 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12723540/12723540_OAK-2720.patch&quot; title=&quot;OAK-2720.patch attached to OAK-2720&quot;&gt;patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; with a testcase and potential fix which takes the approach #2 above&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; Can you have a look. Possibly we can include it in 1.2?&lt;/p&gt;
</comment>
                            <comment id="14482703" author="tmueller" created="Tue, 7 Apr 2015 06:53:22 +0000"  >&lt;p&gt;The patch looks good to me. The risk is very low, so I&apos;m OK to include it for Oak 1.2.&lt;/p&gt;

&lt;p&gt;&amp;gt; of more than 10000 (default).&lt;/p&gt;

&lt;p&gt;Yes, it&apos;s true. I thought the warning is at 1&apos;000, but you are right, it&apos;s at 10&apos;000 (see the patch).&lt;/p&gt;

&lt;p&gt;&amp;gt; even if end result set is small say 100 but indexed paths are deep&lt;/p&gt;

&lt;p&gt;Are you sure? If the limit is at 10&apos;000, then with 100 entries the paths would need to be extremely deep (100 on average, per node).&lt;/p&gt;
</comment>
                            <comment id="14482723" author="chetanm" created="Tue, 7 Apr 2015 07:10:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;Are you sure? If the limit is at 10&apos;000, then with 100 entries the paths would need to be extremely deep (100 on average, per node).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed this is more like a test scenario to illustrate the problem. But in some case the path become really deep! Would apply the patch then&lt;/p&gt;</comment>
                            <comment id="14482831" author="mreutegg" created="Tue, 7 Apr 2015 09:05:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt;, assigning this issue to you because you created the patch and mentioned you want to apply it.&lt;/p&gt;</comment>
                            <comment id="14482975" author="chetanm" created="Tue, 7 Apr 2015 10:40:31 +0000"  >&lt;p&gt;Done and also merged to 1.0 branch&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk - &lt;a href=&quot;http://svn.apache.org/r1671787&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1671787&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;1.0 - &lt;a href=&quot;http://svn.apache.org/r1671793&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1671793&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Also updated the log message to include traversal count within index nodes&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Traversed 10000 nodes (110001 index entries) using index foo with filter Filter(query=SELECT * FROM &lt;span class=&quot;error&quot;&gt;&amp;#91;nt:base&amp;#93;&lt;/span&gt;, path=*)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Also merged &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2224&quot; title=&quot;Increase the threshold for warning in PathIterator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2224&quot;&gt;&lt;del&gt;OAK-2224&lt;/del&gt;&lt;/a&gt; to 1.0 to increase the threshold to 10000 to reduce the noise&lt;/p&gt;</comment>
                            <comment id="14492022" author="mreutegg" created="Mon, 13 Apr 2015 07:38:49 +0000"  >&lt;p&gt;Bulk close for 1.2 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12723540" name="OAK-2720.patch" size="7759" author="chetanm" created="Tue, 7 Apr 2015 05:14:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 31 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cvxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>