<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:41:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1374] Async indexer fails on the SegmentMK</title>
                <link>https://issues.apache.org/jira/browse/OAK-1374</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;On bigger installs (read CQ) I see the following error in the async indexer.&lt;br/&gt;
It looks like it&apos;s related to reading binaries somehow.&lt;br/&gt;
It doesn&apos;t appear to affect unit tests though.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;30.01.2014 11:23:32.115 *ERROR* [pool-8-thread-3] org.apache.sling.commons.scheduler.impl.QuartzScheduler Exception during job execution of org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate@13ba2bd : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
java.lang.IllegalStateException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at com.google.common.base.Preconditions.checkState(Preconditions.java:134) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.segment.Segment.pos(Segment.java:199) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.segment.Segment.readByte(Segment.java:240) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.segment.SegmentBlob.getNewStream(SegmentBlob.java:49) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.index.lucene.OakDirectory$OakIndexFile.loadBlob(OakDirectory.java:172) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.index.lucene.OakDirectory$OakIndexFile.readBytes(OakDirectory.java:218) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.index.lucene.OakDirectory$OakIndexInput.readBytes(OakDirectory.java:297) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.index.lucene.OakDirectory$OakIndexInput.readByte(OakDirectory.java:303) ~[na:na]
	at org.apache.lucene.store.DataInput.readInt(DataInput.java:84) ~[na:na]
	at org.apache.lucene.codecs.CodecUtil.checkHeader(CodecUtil.java:126) ~[na:na]
	at org.apache.lucene.codecs.lucene41.Lucene41PostingsReader.&amp;lt;init&amp;gt;(Lucene41PostingsReader.java:83) ~[na:na]
	at org.apache.lucene.codecs.lucene41.Lucene41PostingsFormat.fieldsProducer(Lucene41PostingsFormat.java:430) ~[na:na]
	at org.apache.lucene.codecs.perfield.PerFieldPostingsFormat$FieldsReader.&amp;lt;init&amp;gt;(PerFieldPostingsFormat.java:194) ~[na:na]
	at org.apache.lucene.codecs.perfield.PerFieldPostingsFormat.fieldsProducer(PerFieldPostingsFormat.java:233) ~[na:na]
	at org.apache.lucene.index.SegmentCoreReaders.&amp;lt;init&amp;gt;(SegmentCoreReaders.java:127) ~[na:na]
	at org.apache.lucene.index.SegmentReader.&amp;lt;init&amp;gt;(SegmentReader.java:56) ~[na:na]
	at org.apache.lucene.index.ReadersAndLiveDocs.getReader(ReadersAndLiveDocs.java:121) ~[na:na]
	at org.apache.lucene.index.BufferedDeletesStream.applyDeletes(BufferedDeletesStream.java:269) ~[na:na]
	at org.apache.lucene.index.IndexWriter.applyAllDeletes(IndexWriter.java:2973) ~[na:na]
	at org.apache.lucene.index.IndexWriter.maybeApplyDeletes(IndexWriter.java:2964) ~[na:na]
	at org.apache.lucene.index.IndexWriter.doFlush(IndexWriter.java:2937) ~[na:na]
	at org.apache.lucene.index.IndexWriter.flush(IndexWriter.java:2906) ~[na:na]
	at org.apache.lucene.index.IndexWriter.closeInternal(IndexWriter.java:940) ~[na:na]
	at org.apache.lucene.index.IndexWriter.close(IndexWriter.java:895) ~[na:na]
	at org.apache.lucene.index.IndexWriter.close(IndexWriter.java:857) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditorContext.closeWriter(LuceneIndexEditorContext.java:161) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditor.leave(LuceneIndexEditor.java:117) ~[na:na]
	at org.apache.jackrabbit.oak.spi.commit.VisibleEditor.leave(VisibleEditor.java:64) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.index.IndexUpdate.leave(IndexUpdate.java:135) ~[na:na]
	at org.apache.jackrabbit.oak.spi.commit.EditorDiff.process(EditorDiff.java:56) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate.run(AsyncIndexUpdate.java:143) ~[na:na]
	at org.apache.sling.commons.scheduler.impl.QuartzJobExecutor.execute(QuartzJobExecutor.java:105) ~[org.apache.sling.commons.scheduler-2.4.2.jar:na]
	at org.quartz.core.JobRunShell.run(JobRunShell.java:207) [org.apache.sling.commons.scheduler-2.4.2.jar:na]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) [na:1.7.0_40]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_40]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:724) [na:1.7.0_40]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12692309">OAK-1374</key>
            <summary>Async indexer fails on the SegmentMK</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stillalex">Alex Deparvu</assignee>
                                    <reporter username="stillalex">Alex Deparvu</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Jan 2014 16:01:27 +0000</created>
                <updated>Mon, 20 Apr 2015 07:30:33 +0000</updated>
                            <resolved>Tue, 4 Feb 2014 15:26:39 +0000</resolved>
                                                    <fixVersion>0.16</fixVersion>
                                    <component>lucene</component>
                    <component>segmentmk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13889372" author="alex.parvulescu" created="Mon, 3 Feb 2014 10:37:45 +0000"  >&lt;p&gt;this is also affecting the search, not just the indexing.&lt;/p&gt;

&lt;p&gt;More info on the check failure for this scenario: offset = 225728, data.limit = 24028, pos = -12388, data.position = 0, length is 1 (as it is the #readByte method that fails).&lt;/p&gt;</comment>
                            <comment id="13890696" author="alex.parvulescu" created="Tue, 4 Feb 2014 13:55:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;jukkaz&lt;/a&gt; maybe you can add some ideas here?&lt;/p&gt;</comment>
                            <comment id="13890731" author="jukkaz" created="Tue, 4 Feb 2014 14:42:38 +0000"  >&lt;p&gt;Looks like a regression from &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1333&quot; title=&quot;SegmentMK: Support for Blobs in external storage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1333&quot;&gt;&lt;del&gt;OAK-1333&lt;/del&gt;&lt;/a&gt;. I&apos;ll double-check the changes.&lt;/p&gt;</comment>
                            <comment id="13890757" author="jukkaz" created="Tue, 4 Feb 2014 15:10:35 +0000"  >&lt;p&gt;Possible fix in r1564333. I&apos;ll see if I can add a test case based on the suspected cause (blob value in a different segment than the property record).&lt;/p&gt;</comment>
                            <comment id="13890763" author="alex.parvulescu" created="Tue, 4 Feb 2014 15:26:39 +0000"  >&lt;p&gt;things are looking really good thanks Jukka!&lt;/p&gt;</comment>
                            <comment id="13890809" author="jukkaz" created="Tue, 4 Feb 2014 16:23:23 +0000"  >&lt;p&gt;Great! I also added a test case that shows how this failed before the above fix.&lt;/p&gt;</comment>
                            <comment id="13896551" author="alex.parvulescu" created="Mon, 10 Feb 2014 13:51:28 +0000"  >&lt;p&gt;bulk close for the 0.16 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>370904</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rx9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>371209</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>