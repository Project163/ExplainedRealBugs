<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:54:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-10985] Index definition with a property rule having valueExcludedPrefixes not getting considered for like condition on that property</title>
                <link>https://issues.apache.org/jira/browse/OAK-10985</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Problems seems to be due to the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-9481&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/OAK-9481&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Consider an index definition&#160;&lt;/p&gt;

&lt;p&gt;testIndex {&lt;/p&gt;

&lt;p&gt;.&lt;/p&gt;

&lt;p&gt;.&lt;/p&gt;

&lt;p&gt;.&lt;br/&gt;
&quot;properties&quot;: {&lt;br/&gt;
&quot;jcr:primaryType&quot;: &quot;nt:unstructured&quot;,&lt;br/&gt;
&quot;foo&quot;: &lt;/p&gt;
{
&quot;propertyIndex&quot;: true,
&quot;jcr:primaryType&quot;: &quot;nt:unstructured&quot;
}
&lt;p&gt;,&lt;br/&gt;
&quot;bar&quot;: &lt;/p&gt;
{
&quot;propertyIndex&quot;: true,
&quot;jcr:primaryType&quot;: &quot;nt:unstructured&quot;,
&quot;valueExcludePrefixes&quot;: [&quot;temp&quot;]
}
&lt;p&gt;}&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;A query like&#160;&lt;br/&gt;
select * from &lt;span class=&quot;error&quot;&gt;&amp;#91;nt:base&amp;#93;&lt;/span&gt; AS &lt;span class=&quot;error&quot;&gt;&amp;#91;a&amp;#93;&lt;/span&gt; where &lt;span class=&quot;error&quot;&gt;&amp;#91;a&amp;#93;&lt;/span&gt;.&lt;span class=&quot;error&quot;&gt;&amp;#91;foo&amp;#93;&lt;/span&gt; like &apos;xyz%&apos;)  &lt;br/&gt;
picks up testIndex&lt;/p&gt;

&lt;p&gt;but&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select * from [nt:base] AS [a] where [a].[bar] like &lt;span class=&quot;code-quote&quot;&gt;&apos;xyz%&apos;&lt;/span&gt;)&#160;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;doesn&apos;t.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13587204">OAK-10985</key>
            <summary>Index definition with a property rule having valueExcludedPrefixes not getting considered for like condition on that property</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ngupta">Nitin Gupta</assignee>
                                    <reporter username="ngupta">Nitin Gupta</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Jul 2024 13:50:53 +0000</created>
                <updated>Tue, 1 Apr 2025 12:06:13 +0000</updated>
                            <resolved>Mon, 12 Aug 2024 10:04:24 +0000</resolved>
                                                    <fixVersion>1.22.21</fixVersion>
                    <fixVersion>1.68.0</fixVersion>
                                    <component>core</component>
                    <component>lucene</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17870981" author="nitigup" created="Mon, 5 Aug 2024 08:42:35 +0000"  >&lt;p&gt;failing test added here &lt;a href=&quot;https://github.com/nit0906/jackrabbit-oak/commit/ed61f1c3628affb3b8b01dceef1969719ea9d789&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/nit0906/jackrabbit-oak/commit/ed61f1c3628affb3b8b01dceef1969719ea9d789&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17871839" author="nitigup" created="Thu, 8 Aug 2024 03:49:47 +0000"  >&lt;p&gt;Analysis -&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
valueExcludedPrefixes is a pretty old feature added via&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-4637In&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/OAK-4637In&lt;/a&gt; the current problem, when executing a query like&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select * from [nt:base] AS [a] where [a].[bar] like &lt;span class=&quot;code-quote&quot;&gt;&apos;xyz%&apos;&lt;/span&gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;why correct index is not picked up -&lt;/p&gt;

&lt;p&gt;because FulltextIndexPlanner.getPlanBuilder returns null (and hence ntBaseLucene is never even considered.)This is because - # &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-search/src/main/java/org/apache/jackrabbit/oak/plugins/index/search/spi/query/FulltextIndexPlanner.java#L253&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-search/src/main/java/org/apache/jackrabbit/oak/plugins/index/search/spi/query/FulltextIndexPlanner.java#L253&lt;/a&gt;&#160;-&amp;gt; this is true and sling:resourceType never gets added to indexedProps list which later on leads to planBuilder getting returned as null&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Main issue here is matchesValuePattern returns false&lt;/li&gt;
	&lt;li&gt;This is because&#160;&lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-search/src/main/java/org/apache/jackrabbit/oak/plugins/index/search/spi/query/FulltextIndexPlanner.java#L381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-search/src/main/java/org/apache/jackrabbit/oak/plugins/index/search/spi/query/FulltextIndexPlanner.java#L381&lt;/a&gt;&#160;returns a null prefix and hence pd.valuePattern.matchesPrefix(prefix) returns false.&lt;/li&gt;
	&lt;li&gt;Null prefix is returned because of the check here&#160;&lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/property/ValuePatternUtil.java#L48&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/property/ValuePatternUtil.java#L48&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Earlier this used to work because&#160;&lt;tt&gt;like&lt;/tt&gt;&#160;queries were treated as range queries and&#160;&lt;tt&gt;isLike&lt;/tt&gt;&#160;was false but after the changes for&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-9481&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/OAK-9481&lt;/a&gt;&#160; , the query gets treated as&#160;&lt;tt&gt;like&lt;/tt&gt;&#160;query and&#160;&lt;tt&gt;isLike&lt;/tt&gt;&#160;is true.&lt;br/&gt;
&#160;&lt;br/&gt;
&#160;&lt;br/&gt;
Another point to note is that even without the changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-9481&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/OAK-9481&lt;/a&gt;, queries with greater than, less than etc restrictions will also not work on properties with valueExcludePrefixes.&lt;br/&gt;
&#160;&lt;br/&gt;
For instance,&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select * from [nt:base] AS [a] where [a].[bar] &amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;xyz&apos;&lt;/span&gt; 
select * from [nt:base] AS [a] where [a].[bar] &amp;lt; &lt;span class=&quot;code-quote&quot;&gt;&apos;xyz&apos;&lt;/span&gt; 
select * from [nt:base] AS [a] where [a].[bar] &amp;gt;= &lt;span class=&quot;code-quote&quot;&gt;&apos;xyz&apos;&lt;/span&gt; 
select * from [nt:base] AS [a] where [a].[bar] &amp;lt;= &lt;span class=&quot;code-quote&quot;&gt;&apos;xyz&apos;&lt;/span&gt;
select * from [nt:base] AS [a] where [a].[bar] &amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;abc&apos;&lt;/span&gt; and [a].[bar] &amp;lt; &lt;span class=&quot;code-quote&quot;&gt;&apos;xyz&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;will also not work if the bar property has valueExlucedPrefixes defined.This is because of the check here&#160;&lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/property/ValuePatternUtil.java#L66&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-core/src/main/java/org/apa[&#8230;]che/jackrabbit/oak/plugins/index/property/ValuePatternUtil.java&lt;/a&gt;&#160;, where either first or last will always be false for above queries.&lt;br/&gt;
&#160;&lt;br/&gt;
However something like&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select * from [nt:base] AS [a] where [a].[bar] &amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;abc0&apos;&lt;/span&gt; and [a].[bar] &amp;lt; &lt;span class=&quot;code-quote&quot;&gt;&apos;abc10&apos;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;would work.&lt;/p&gt;</comment>
                            <comment id="17872820" author="nitigup" created="Mon, 12 Aug 2024 09:01:56 +0000"  >&lt;p&gt;PR - &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/pull/1636&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/pull/1636&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;kept the changes to minimum by fixing only the like condition which stopped working post changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-9481&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/OAK-9481&lt;/a&gt; .&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17878587" author="reschke" created="Mon, 2 Sep 2024 14:16:00 +0000"  >&lt;p&gt;trunk: (1.68.0) &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/commit/21eed91cc05bb7bc731deff76514c9b06b0d5dbc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;21eed91cc0&lt;/a&gt;&lt;br/&gt;
1.22: &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/commit/0d3d30e6cafefa8b5d219842089a30be7040b27c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;0d3d30e6ca&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 9 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1qkvs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>