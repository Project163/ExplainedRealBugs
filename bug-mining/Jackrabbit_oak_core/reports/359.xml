<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:38:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-893] MongoMK may fail with MicroKernelException under concurrent commits</title>
                <link>https://issues.apache.org/jira/browse/OAK-893</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Under concurrent commits (with branches) it may happen that MongoMK fails with a MicroKernelException, even if the commits are non-conflicting. I&apos;ll add a test case...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12656850">OAK-893</key>
            <summary>MongoMK may fail with MicroKernelException under concurrent commits</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="mreutegg">Marcel Reutegger</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Jul 2013 12:15:23 +0000</created>
                <updated>Fri, 20 Sep 2013 07:01:45 +0000</updated>
                            <resolved>Thu, 11 Jul 2013 12:40:48 +0000</resolved>
                                    <version>0.8</version>
                                    <fixVersion>0.9</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13703208" author="mreutegg" created="Tue, 9 Jul 2013 12:26:09 +0000"  >&lt;p&gt;Test added in &lt;a href=&quot;http://svn.apache.org/r1501218&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1501218&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13704624" author="mreutegg" created="Wed, 10 Jul 2013 14:46:03 +0000"  >&lt;p&gt;It looks like this is caused by inconsistent reads from rebased branches. I added a simple (ignored) test to illustrate what I think is the root cause for this issue: &lt;a href=&quot;http://svn.apache.org/r1501780&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1501780&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13705546" author="mreutegg" created="Thu, 11 Jul 2013 07:11:03 +0000"  >&lt;p&gt;To give some more details on what&apos;s happening when the commit fails: when oak-jcr saves a change, the sequence of operations usually is: 1) rebase the current branch to the most recent state, 2) push down pending changes into the branch, 4) run the commit hook with the base of the branch and the current head of the branch, 5) merge the branch.&lt;/p&gt;

&lt;p&gt;For this process to work reliably, the branch states must be stable. Otherwise the commit hook will try to process changes from other commits that sneaked in. This is the case with the first test added for this issue.&lt;/p&gt;</comment>
                            <comment id="13705564" author="mreutegg" created="Thu, 11 Jul 2013 07:41:03 +0000"  >&lt;p&gt;The root cause for this issue is how branch commits are later merged back and made visible to other readers. Branch commits are assigned regular revisions, which are timestamp based, but they only become visible to other readers once the branch is merged. This means when a branch is merged its commits look as if they happened in the past and suddenly appeared.&lt;/p&gt;</comment>
                            <comment id="13705762" author="mreutegg" created="Thu, 11 Jul 2013 12:40:48 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;http://svn.apache.org/r1502207&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1502207&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Branch commits still get regular revisions as before, but on merge the branch commits are not published like regular commits. Previously, branch commits were published on the root node in the _revisions map like this:&lt;/p&gt;

&lt;p&gt;_revisions.r13fcdb25a84-0-1 : &quot;true&quot;&lt;/p&gt;

&lt;p&gt;This meant, revision r13fcdb25a84-0-1 is committed and readers are able to read if their read revision is equal or newer than r13fcdb25a84-0-1. The problem with this approach was that r13fcdb25a84-0-1 was older than the merge revision.&lt;/p&gt;

&lt;p&gt;Now, branch commits are published with the merge commit revision:&lt;/p&gt;

&lt;p&gt;_revisions.r13fcdb25a84-0-1 : &quot;c-r13fcdb541b4-0-1&quot;&lt;/p&gt;

&lt;p&gt;This means revision r13fcdb25a84-0-1 is only visible from a reader with a read revision, which is at least r13fcdb541b4-0-1.&lt;/p&gt;

&lt;p&gt;Please note, that I also changed the format of a regular commit. Instead of &quot;true&quot;, a committed revision is now tagged with &quot;c&quot;.&lt;/p&gt;</comment>
                            <comment id="13772806" author="alex.parvulescu" created="Fri, 20 Sep 2013 07:01:45 +0000"  >&lt;p&gt;Bulk close for the 0.9 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>337073</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1m53b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>337396</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>