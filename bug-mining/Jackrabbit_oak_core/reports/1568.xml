<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:51:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-4403] Diff traversal in persisted branch commit traversing to unrelated paths</title>
                <link>https://issues.apache.org/jira/browse/OAK-4403</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt; With DocumentNodeStore when a commit involves a persisted branch the diff logic traverses to those paths which are not affected by the current commit. For e.g. in following flow&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Commit C1 (base rev R1) - Starts and modifies paths under /content. The number of changes done exceed the update.limit and hence the in memory branch transitions to Persisted state&lt;/li&gt;
	&lt;li&gt;Before C1 commits another commit C2 starts and modified paths under /etc and /var&lt;/li&gt;
	&lt;li&gt;C2 commits (before C1). Head revision R2&lt;/li&gt;
	&lt;li&gt;C1 commits and perform the merge. Revision moves to R3&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Now at #4 the merge would trigger a diff which should normally traverse and perform diff for those paths which are modified by C1. However currently it seems to also perform diff on all those paths which have been modified after R1 and R3. In doing so it would traverse the complete sub trees of such paths. Note that functionally the end result is same just that too many extra nodes are read which would put load on system&lt;/p&gt;

&lt;p&gt;If the number of changes are reduced such that persisted branch is not created then diff only reads those parts which are modified by the current commit.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12973297">OAK-4403</key>
            <summary>Diff traversal in persisted branch commit traversing to unrelated paths</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="chetanm">Chetan Mehrotra</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 May 2016 04:34:12 +0000</created>
                <updated>Mon, 14 Nov 2016 11:35:15 +0000</updated>
                            <resolved>Mon, 7 Nov 2016 09:49:53 +0000</resolved>
                                                    <fixVersion>1.5.13</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>documentmk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15303468" author="chetanm" created="Fri, 27 May 2016 04:38:25 +0000"  >&lt;p&gt;Added ignored test with &lt;a href=&quot;http://svn.apache.org/r1745708&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;1745708&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15574250" author="chetanm" created="Fri, 14 Oct 2016 05:26:47 +0000"  >&lt;p&gt;Setting a fix version to ensure that we look into this issue sooner for 1.6&lt;/p&gt;</comment>
                            <comment id="15643657" author="mreutegg" created="Mon, 7 Nov 2016 09:49:53 +0000"  >&lt;p&gt;I think the test is too strict because it tracks find calls of /etc even if the merge simply reads the children of the root node. I modified the test to check if the merge really traverses into other changes and then it runs successfully.&lt;/p&gt;

&lt;p&gt;Updated the test in trunk: &lt;a href=&quot;http://svn.apache.org/r1768469&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1768469&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15643813" author="chetanm" created="Mon, 7 Nov 2016 10:42:59 +0000"  >&lt;p&gt;I test the test on trunk and 1.4 and it passes fine. However it fails on 1.2 branch. So looks like bug exist on previous branches &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.AssertionError: 
Expected: not a collection containing &quot;/etc/x&quot;
     but: was &amp;lt;[/etc, /content, /etc/z, /etc/x, /etc/y, /var/x, /content/b, /content/a, /content/e, /, /var]&amp;gt;
Expected :not a collection containing &quot;/etc/x&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15643824" author="mreutegg" created="Mon, 7 Nov 2016 10:47:22 +0000"  >&lt;p&gt;The issue was most likely fixed with &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-4528&quot; title=&quot;diff calculation in DocumentNodeStore should try to re-use journal info on diff cache miss&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-4528&quot;&gt;&lt;del&gt;OAK-4528&lt;/del&gt;&lt;/a&gt; (backported to 1.4 as well).&lt;/p&gt;</comment>
                            <comment id="15646429" author="chetanm" created="Tue, 8 Nov 2016 04:11:05 +0000"  >&lt;p&gt;Yes as test fails on trunk also if &quot;oak.disableJournalDiff&quot; is set to true. So bug still exists in diffImpl logic. Given that persisted branch should not be very old journal should be sufficient to handle the usecase. &lt;/p&gt;

&lt;p&gt;However we should still address the bug in fallback diff logic&lt;/p&gt;</comment>
                            <comment id="15646435" author="catholicon" created="Tue, 8 Nov 2016 04:14:01 +0000"  >&lt;p&gt;One case where this &quot;might&quot; become bad is if async index is failing for 6 hours (past journal lifetime) and we hit a persisted commit in the mean time. Then next successful async index cycle might traverse all sort of paths.&lt;/p&gt;</comment>
                            <comment id="15646768" author="mreutegg" created="Tue, 8 Nov 2016 07:24:43 +0000"  >&lt;p&gt;I don&apos;t think that&apos;s a problem, because the async index update would anyway want to index all those changes.&lt;/p&gt;</comment>
                            <comment id="15646775" author="mreutegg" created="Tue, 8 Nov 2016 07:29:04 +0000"  >&lt;p&gt;Furthermore, as of &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-4553&quot; title=&quot;Retain journal entries for valid checkpoints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-4553&quot;&gt;&lt;del&gt;OAK-4553&lt;/del&gt;&lt;/a&gt; the journal is retained up to the oldest valid checkpoint.&lt;/p&gt;</comment>
                            <comment id="15647097" author="catholicon" created="Tue, 8 Nov 2016 09:57:01 +0000"  >&lt;p&gt;Ah... ok, didn&apos;t realize that.&lt;/p&gt;</comment>
                            <comment id="15647349" author="catholicon" created="Tue, 8 Nov 2016 11:58:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt;, may be we can have another test with disabled journal and unschedule this issue. I mean we do have an issue in fallback logic but with increased usage of journal fallback isn&apos;t that relevant anymore. I think &quot;Not A Problem&quot; doesn&apos;t represent the correct scenario.&lt;/p&gt;</comment>
                            <comment id="15647492" author="chetanm" created="Tue, 8 Nov 2016 12:55:43 +0000"  >&lt;p&gt;Makes sense. Lets open a new issue&lt;/p&gt;</comment>
                            <comment id="15647793" author="catholicon" created="Tue, 8 Nov 2016 15:07:37 +0000"  >&lt;p&gt;Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-5086&quot; title=&quot;Some tests in NodeStoreDiffTests fail when oak.disableJournalDiff is set to true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-5086&quot;&gt;OAK-5086&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15663624" author="edivad" created="Mon, 14 Nov 2016 11:35:15 +0000"  >&lt;p&gt;Bulk close for 1.5.13&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13019236">OAK-5086</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ykw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>