<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:37:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-510] Multivalued properties with array size 0 forget their type</title>
                <link>https://issues.apache.org/jira/browse/OAK-510</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;thought i remember that i have seen a related TODO or issue before, i&lt;br/&gt;
couldn&apos;t find it any more... sorry for that.&lt;/p&gt;

&lt;p&gt;while cleaning up the node type code i found that one FIXME in the &lt;br/&gt;
ReadOnlyNodeTypeManager related to definition generation was only needed&lt;br/&gt;
because the TypeValidator failed upon validation of an empty jcr:supertypes&lt;br/&gt;
definition. not storing the super types if none has be declared solved the&lt;br/&gt;
problem for the time being.&lt;/p&gt;

&lt;p&gt;however, it seems to me that the underlying problem is in a completely&lt;br/&gt;
different area: namely that mv properties with an empty value array&lt;br/&gt;
forget their type.&lt;/p&gt;

&lt;p&gt;this can be verified with the following test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void addEmptyMultiValueName() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; RepositoryException {
        Node parentNode = getNode(TEST_PATH);
        Value[] values = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Value[0];

        parentNode.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;multi name&quot;&lt;/span&gt;, values);
        parentNode.getSession().save();

        Session session2 = createAnonymousSession();
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            Property property = session2.getProperty(TEST_PATH + &lt;span class=&quot;code-quote&quot;&gt;&quot;/multi name&quot;&lt;/span&gt;);
            assertTrue(property.isMultiple());
            assertEquals(PropertyType.NAME, property.getType());
            Value[] values2 = property.getValues();
            assertEquals(values.length, values2.length);
            assertEquals(values[0], values2[0]);
            assertEquals(values[1], values2[1]);
        } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
            session2.logout();
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12623598">OAK-510</key>
            <summary>Multivalued properties with array size 0 forget their type</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="angela">Angela Schreiber</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Dec 2012 18:02:17 +0000</created>
                <updated>Wed, 4 Jun 2014 09:00:49 +0000</updated>
                            <resolved>Wed, 22 May 2013 06:23:03 +0000</resolved>
                                                    <fixVersion>0.8</fixVersion>
                                    <component>core</component>
                    <component>jcr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13530880" author="mduerig" created="Thu, 13 Dec 2012 10:35:47 +0000"  >&lt;p&gt;The last time this came up (can&apos;t find the reference neither) defaulting to string in this case was considered good enough. &lt;/p&gt;</comment>
                            <comment id="13530981" author="anchela" created="Thu, 13 Dec 2012 13:06:53 +0000"  >&lt;p&gt;well, that&apos;s actually not the case. now that we have type validators&lt;br/&gt;
in place the type might be required for the verification and i would definitely&lt;br/&gt;
prefer to remember the value type than adding hacks and todos in other&lt;br/&gt;
places (like the node type manager) that are keep hiding these kind of &lt;br/&gt;
issues and will cause troubles along the line.&lt;/p&gt;</comment>
                            <comment id="13656992" author="anchela" created="Tue, 14 May 2013 12:07:54 +0000"  >&lt;p&gt;see &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-815&quot; title=&quot;Wrong type for empty multi-valued property&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-815&quot;&gt;&lt;del&gt;OAK-815&lt;/del&gt;&lt;/a&gt; for a patch proposed by jukka.&lt;/p&gt;</comment>
                            <comment id="13658307" author="jukkaz" created="Wed, 15 May 2013 12:37:00 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;http://svn.apache.org/r1482792&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1482792&lt;/a&gt; with an improved version of the patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-815&quot; title=&quot;Wrong type for empty multi-valued property&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-815&quot;&gt;&lt;del&gt;OAK-815&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13663100" author="mduerig" created="Tue, 21 May 2013 16:39:43 +0000"  >&lt;p&gt;Reopening since &lt;tt&gt;org.apache.jackrabbit.oak.jcr.RepositoryTest#addEmptyMultiValueName&lt;/tt&gt; still fails. &lt;/p&gt;</comment>
                            <comment id="13663841" author="jukkaz" created="Wed, 22 May 2013 06:23:03 +0000"  >&lt;p&gt;Good point. The problem was in oak-jcr where type information would get lost before changes were passed down the stack. Fixed in &lt;a href=&quot;http://svn.apache.org/r1485078&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1485078&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>297316</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 26 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14nuf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>235328</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>