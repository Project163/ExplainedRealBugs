<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:52:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-3328] checked-in state should only affect properties with OPV!=IGNORE</title>
                <link>https://issues.apache.org/jira/browse/OAK-3328</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;We currently (as of &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3310&quot; title=&quot;Write operations on Property do not check checked-out state of Node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3310&quot;&gt;&lt;del&gt;OAK-3310&lt;/del&gt;&lt;/a&gt;) protect all properties from changes when the node is checked-in. According to the spec (&lt;a href=&quot;http://www.day.com/specs/jcr/2.0/15_Versioning.html#15.2.2%20Read-Only%20on%20Check-In&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.day.com/specs/jcr/2.0/15_Versioning.html#15.2.2%20Read-Only%20on%20Check-In&lt;/a&gt;), this should only be the case when on-parent-version is != &quot;IGNORE&quot;.&lt;/p&gt;

&lt;p&gt;(It seems this doesn&apos;t have TCK coverage)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12861016">OAK-3328</key>
            <summary>checked-in state should only affect properties with OPV!=IGNORE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="reschke">Julian Reschke</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Sep 2015 13:54:50 +0000</created>
                <updated>Fri, 23 Dec 2016 04:37:09 +0000</updated>
                            <resolved>Wed, 14 Dec 2016 15:21:06 +0000</resolved>
                                                    <fixVersion>1.5.16</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>jcr</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15674020" author="iosonomarco" created="Thu, 17 Nov 2016 15:43:07 +0000"  >&lt;p&gt;Hi all,&lt;br/&gt;
i&apos;m using oak to implement a functionality that relies on this behaviour. Is there any plan to resolve this bug in the near future?&lt;br/&gt;
I also tried to find how to fix it, but I haven&apos;t been able to find a complete solution..&lt;/p&gt;

&lt;p&gt;thanks, Marco.&lt;/p&gt;</comment>
                            <comment id="15674072" author="mreutegg" created="Thu, 17 Nov 2016 16:03:29 +0000"  >&lt;p&gt;So far there was no pressing need to fix this. The patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3310&quot; title=&quot;Write operations on Property do not check checked-out state of Node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3310&quot;&gt;&lt;del&gt;OAK-3310&lt;/del&gt;&lt;/a&gt; should give you a pretty good indication where the check would have to consider the OPV setting as well.&lt;/p&gt;</comment>
                            <comment id="15674325" author="iosonomarco" created="Thu, 17 Nov 2016 17:38:28 +0000"  >&lt;p&gt;Hi Marcel,&lt;br/&gt;
thanks for the hint. I did try to look at the patch and modify &lt;em&gt;checkPrecondition&lt;/em&gt; method. I was able to modify the property but i still get an error when trying to save the session.&lt;/p&gt;

&lt;p&gt;It fails inside the class &lt;em&gt;VersionEditor&lt;/em&gt; because of this check:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void propertyChanged(PropertyState before, PropertyState after) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; CommitFailedException {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(!&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isVersionable()) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(!&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isVersionProperty(after) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isReadOnly) {
                throwCheckedIn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot change property &quot;&lt;/span&gt; + after.getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot; on checked in node&quot;&lt;/span&gt;);
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is possible to extract the NodeDefinition from the NodeState (to check weather the node has the &quot;IGNORE&quot; property or not)? I tried but I don&apos;t seem to find a way to do it.&lt;br/&gt;
This way i can modify the method that defines the value for the &lt;em&gt;isReadOnly&lt;/em&gt; property. By the way, is that the right thing to do?&lt;/p&gt;

&lt;p&gt;Marco.&lt;/p&gt;</comment>
                            <comment id="15683030" author="mreutegg" created="Mon, 21 Nov 2016 09:43:57 +0000"  >&lt;p&gt;Yes, this is the right place for the change. Have a look at VersionableState.getOPV(). There are two variants, one for child nodes and one for properties. It uses a ReadOnlyNodeTypeManager to get the flag. I&apos;d say something similar should work for the VersionEditor as well.&lt;/p&gt;</comment>
                            <comment id="15686332" author="iosonomarco" created="Tue, 22 Nov 2016 10:31:32 +0000"  >&lt;p&gt;Hi Marcel,&#8232;I think I&apos;ve got a solution for the bug with the relative tests. I&apos;ve attached it to the issue, is it ok? What should I do to propose it?&#8232;&lt;br/&gt;
Let me know if the solution looks ok for you guys.&lt;/p&gt;

&lt;p&gt;thanks, Marco.&lt;/p&gt;</comment>
                            <comment id="15686380" author="iosonomarco" created="Tue, 22 Nov 2016 10:54:37 +0000"  >&lt;p&gt;Sorry, I had to modify the patch file because my editor changed the formatting style.&lt;/p&gt;</comment>
                            <comment id="15686670" author="mreutegg" created="Tue, 22 Nov 2016 12:53:34 +0000"  >&lt;p&gt;Marco, thanks for the patch. The tests look good, but other classes contain a lot of unrelated changes, which makes it difficult to identify the changes you actually propose. Can you please attach a patch with only the required changes?&lt;/p&gt;</comment>
                            <comment id="15686755" author="iosonomarco" created="Tue, 22 Nov 2016 13:25:52 +0000"  >&lt;p&gt;Sorry, i thought i had restored the format for all the files. Now it should be ok.&lt;/p&gt;</comment>
                            <comment id="15745594" author="iosonomarco" created="Tue, 13 Dec 2016 16:49:27 +0000"  >&lt;p&gt;Hi Marcel,&lt;br/&gt;
do you know, more less, how long does it take to know if the patch is accepted or rejected?&lt;/p&gt;

&lt;p&gt;thanks, Marco.&lt;/p&gt;</comment>
                            <comment id="15748604" author="mreutegg" created="Wed, 14 Dec 2016 15:21:06 +0000"  >&lt;p&gt;Patch looks good. I moved the OPV ignore check in NodeImpl.isCheckedOut() to VersionManagerImpl.isCheckedOut() for consistency. Both implementations should behave the same. Added a test to OpvIgnoreTest for the same.&lt;/p&gt;

&lt;p&gt;Applied to trunk: &lt;a href=&quot;http://svn.apache.org/r1774264&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1774264&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks again!&lt;/p&gt;</comment>
                            <comment id="15771903" author="amitjain" created="Fri, 23 Dec 2016 04:37:09 +0000"  >&lt;p&gt;Bulk close Oak 1.5.16&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12859622">OAK-3310</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12840023" name="proposed_fix_for_OAK_3328-updated.patch" size="17509" author="iosonomarco" created="Tue, 22 Nov 2016 13:25:52 +0000"/>
                            <attachment id="12840004" name="proposed_fix_for_OAK_3328.patch" size="38011" author="iosonomarco" created="Tue, 22 Nov 2016 10:54:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 47 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jnif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>