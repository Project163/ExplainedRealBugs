<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:51:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-4705] Fulltext parser doesn&apos;t allow stand-alone hyphen in search expression</title>
                <link>https://issues.apache.org/jira/browse/OAK-4705</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Afaics, the fulltext grammar &lt;a href=&quot;https://docs.adobe.com/content/docs/en/spec/jcr/2.0/6_Query.html#6.7.19%20FullTextSearch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;spec&lt;/a&gt; [0] allows a stand-alone hyphen to be a simple word.&lt;/p&gt;

&lt;p&gt;So, it seems all of these are valid:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;tt&gt;A - B&lt;/tt&gt; //hyphen being a separate word&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;A -&lt;/tt&gt; //hyphen being a separate word at the end&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;A -B&lt;/tt&gt; //hyphen working as negation operator on &lt;tt&gt;B&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;A -&quot;B C&quot;&lt;/tt&gt; //hyphen working as negation operator on &lt;tt&gt;&quot;B C&quot;&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Currently, case 1 and 2 are treated as invalid.&lt;/p&gt;

&lt;p&gt;[0]: &lt;a href=&quot;https://docs.adobe.com/content/docs/en/spec/jcr/2.0/6_Query.html#6.7.19%20FullTextSearch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.adobe.com/content/docs/en/spec/jcr/2.0/6_Query.html#6.7.19%20FullTextSearch&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13000008">OAK-4705</key>
            <summary>Fulltext parser doesn&apos;t allow stand-alone hyphen in search expression</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="catholicon">Vikas Saurabh</assignee>
                                    <reporter username="catholicon">Vikas Saurabh</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Aug 2016 13:23:03 +0000</created>
                <updated>Tue, 8 Oct 2019 15:21:53 +0000</updated>
                            <resolved>Sat, 10 Sep 2016 13:53:55 +0000</resolved>
                                                    <fixVersion>1.5.10</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15436846" author="catholicon" created="Thu, 25 Aug 2016 13:25:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt;, can you please review the description? To me, the fix looks like:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/fulltext/FullTextParser.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/fulltext/FullTextParser.java
index 1827d72..95d8336 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/fulltext/FullTextParser.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/fulltext/FullTextParser.java
@@ -85,10 +85,8 @@ public class FullTextParser {
         boolean not = false;
         StringBuilder buff = new StringBuilder();
         char c = text.charAt(parseIndex);
-        if (c == &apos;-&apos;) {
-            if (++parseIndex &amp;gt;= text.length()) {
-                throw getSyntaxError(&quot;term&quot;);
-            }
+        if (c == &apos;-&apos; &amp;amp;&amp;amp; parseIndex &amp;lt; text.length() - 1 &amp;amp;&amp;amp; text.charAt(parseIndex+1) != &apos; &apos;) {
+            c = text.charAt(++parseIndex);
             not = true;
         }
         boolean escaped = false;
diff --git a/oak-core/src/test/java/org/apache/jackrabbit/oak/query/ast/FullTextTest.java b/oak-core/src/test/java/org/apache/jackrabbit/oak/query/ast/FullTextTest.java
index fdc3f68..91b6a06 100644
--- a/oak-core/src/test/java/org/apache/jackrabbit/oak/query/ast/FullTextTest.java
+++ b/oak-core/src/test/java/org/apache/jackrabbit/oak/query/ast/FullTextTest.java
@@ -66,6 +66,16 @@ public class FullTextTest {

     @Test
     public void not() throws ParseException {
+        assertTrue(test(&quot;hello - world&quot;, &quot;hello - world&quot;));
+        assertTrue(test(&quot;hello - \&quot;wonderful world\&quot;&quot;, &quot;hello - wonderful world&quot;));
+        assertEquals(&quot;\&quot;hello\&quot; -\&quot;wonderful world\&quot;&quot;, convertPattern(&quot;hello -\&quot;wonderful world\&quot;&quot;));
+        assertTrue(test(&quot;hello -\&quot;wonderful world\&quot;&quot;, &quot;hello&quot;));
+        assertTrue(test(&quot;hello -\&quot;wonderful world\&quot;&quot;, &quot;hello wonderful&quot;));
+        assertTrue(test(&quot;hello -\&quot;wonderful world\&quot;&quot;, &quot;hello world&quot;));
+        assertFalse(test(&quot;hello -\&quot;wonderful world\&quot;&quot;, &quot;hello wonderful world&quot;));
+        assertFalse(test(&quot;hello -\&quot;wonderful world\&quot;&quot;, &quot;wonderful world&quot;));
+        assertTrue(test(&quot;hello \&quot;-wonderful world\&quot;&quot;, &quot;hello this beautiful -wonderful world&quot;));
+        assertTrue(test(&quot;hello -&quot;, &quot;hello -&quot;));
         assertEquals(&quot;\&quot;hello\&quot; -\&quot;world\&quot;&quot;, convertPattern(&quot;hello -world&quot;));
         assertTrue(test(&quot;hello -world&quot;, &quot;hello&quot;));
         assertFalse(test(&quot;hello -world&quot;, &quot;hello world&quot;));
@@ -107,8 +117,6 @@ public class FullTextTest {
         testInvalid(&quot;&quot;, &quot;(*); expected: term&quot;);
         testInvalid(&quot;x OR &quot;, &quot;x OR(*); expected: term&quot;);
         testInvalid(&quot;\&quot;&quot;, &quot;(*)\&quot;; expected: double quote&quot;);
-        testInvalid(&quot;-&quot;, &quot;(*)-; expected: term&quot;);
-        testInvalid(&quot;- x&quot;, &quot;- (*)x; expected: term&quot;);
         testInvalid(&quot;\\&quot;, &quot;(*)\\; expected: escaped char&quot;);
         testInvalid(&quot;\&quot;\\&quot;, &quot;\&quot;(*)\\; expected: escaped char&quot;);
         testInvalid(&quot;\&quot;x\&quot;y&quot;, &quot;\&quot;x\&quot;(*)y; expected: space&quot;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Do note, that even without this issue it seemed that hyphen followed by quoted string wasn&apos;t really doing the right this (even without this issue) - fixed that too &lt;tt&gt;+            c = text.charAt(++parseIndex);&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15458535" author="tmueller" created="Fri, 2 Sep 2016 13:32:35 +0000"  >&lt;p&gt;&amp;gt; that hyphen followed by quoted string wasn&apos;t really doing the right this&lt;/p&gt;

&lt;p&gt;You are right! There were not enough tests.&lt;/p&gt;

&lt;p&gt;Your patch looks fine, but I would add even more tests, see my patch below. I wonder whether it would be better to support &quot; &amp;#45;&quot;  (space before term: currently illegal), and whether it&apos;s a good idea to sort entries (&quot;hello &amp;#45; world&quot; becomes &quot;- hello world&quot;) and make them unique (&quot;test test&quot; becomes &quot;test&quot;).&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Index: src/main/java/org/apache/jackrabbit/oak/query/fulltext/FullTextParser.java
===================================================================
--- src/main/java/org/apache/jackrabbit/oak/query/fulltext/FullTextParser.java	(revision 1755600)
+++ src/main/java/org/apache/jackrabbit/oak/query/fulltext/FullTextParser.java	(working copy)
@@ -85,10 +85,9 @@
         boolean not = false;
         StringBuilder buff = new StringBuilder();
         char c = text.charAt(parseIndex);
-        if (c == &apos;-&apos;) {
-            if (++parseIndex &amp;gt;= text.length()) {
-                throw getSyntaxError(&quot;term&quot;);
-            }
+        if (c == &apos;-&apos; &amp;amp;&amp;amp; parseIndex &amp;lt; text.length() - 1 &amp;amp;&amp;amp;
+                text.charAt(parseIndex + 1) != &apos; &apos;) {
+            c = text.charAt(++parseIndex);
             not = true;
         }
         boolean escaped = false;
Index: src/test/java/org/apache/jackrabbit/oak/query/ast/FullTextTest.java
===================================================================
--- src/test/java/org/apache/jackrabbit/oak/query/ast/FullTextTest.java	(revision 1755600)
+++ src/test/java/org/apache/jackrabbit/oak/query/ast/FullTextTest.java	(working copy)
@@ -54,6 +54,7 @@
         assertFalse(test(&quot;hello world&quot;, &quot;world&quot;));
         assertTrue(test(&quot;hello world&quot;, &quot;world hello&quot;));
         assertTrue(test(&quot;hello world &quot;, &quot;hello world&quot;));
+        assertEquals(&quot;\&quot;hello\&quot;&quot;, convertPattern(&quot;hello hello&quot;));
     }
 
     @Test
@@ -63,9 +64,35 @@
         assertTrue(test(&quot;hello OR world&quot;, &quot;world&quot;));
         assertFalse(test(&quot;hello OR world&quot;, &quot;hi&quot;));
     }
+    
+    @Test
+    public void minusLiteral() throws ParseException {
+        assertEquals(&quot;\&quot;-\&quot;&quot;, convertPattern(&quot;-&quot;));
+        assertEquals(&quot;\&quot;-\&quot;&quot;, convertPattern(&quot;- &quot;));
+        assertEquals(&quot;\&quot;-\&quot;&quot;, convertPattern(&quot;- -&quot;));
+        assertEquals(&quot;\&quot;-\&quot; \&quot;hello\&quot;&quot;, convertPattern(&quot;- hello&quot;));
+        assertEquals(&quot;\&quot;-\&quot; \&quot;hello\&quot; \&quot;world\&quot;&quot;, convertPattern(&quot;hello - world&quot;));
+        assertEquals(&quot;\&quot;-\&quot; \&quot;hello\&quot; \&quot;world\&quot;&quot;, convertPattern(&quot;hello  -  world&quot;));
+        assertEquals(&quot;\&quot;-\&quot; \&quot;hello\&quot;&quot;, convertPattern(&quot;hello -&quot;));
+             
+        assertTrue(test(&quot;-&quot;, &quot;hello - world&quot;));
+        assertTrue(test(&quot;- &quot;, &quot;hello - world&quot;));
+        assertTrue(test(&quot;- -&quot;, &quot;hello - world&quot;));
+        assertTrue(test(&quot;- hello&quot;, &quot;hello - world&quot;));
+        assertTrue(test(&quot;hello - world&quot;, &quot;hello - world&quot;));
+        assertTrue(test(&quot;hello - \&quot;wonderful world\&quot;&quot;, &quot;hello - wonderful world&quot;));
+        assertTrue(test(&quot;hello -&quot;, &quot;hello -&quot;));
+    }
 
     @Test
     public void not() throws ParseException {
+        assertEquals(&quot;\&quot;hello\&quot; -\&quot;wonderful world\&quot;&quot;, convertPattern(&quot;hello -\&quot;wonderful world\&quot;&quot;));
+        assertTrue(test(&quot;hello -\&quot;wonderful world\&quot;&quot;, &quot;hello&quot;));
+        assertTrue(test(&quot;hello -\&quot;wonderful world\&quot;&quot;, &quot;hello wonderful&quot;));
+        assertTrue(test(&quot;hello -\&quot;wonderful world\&quot;&quot;, &quot;hello world&quot;));
+        assertFalse(test(&quot;hello -\&quot;wonderful world\&quot;&quot;, &quot;hello wonderful world&quot;));
+        assertFalse(test(&quot;hello -\&quot;wonderful world\&quot;&quot;, &quot;wonderful world&quot;));
+        assertTrue(test(&quot;hello \&quot;-wonderful world\&quot;&quot;, &quot;hello this beautiful -wonderful world&quot;));
         assertEquals(&quot;\&quot;hello\&quot; -\&quot;world\&quot;&quot;, convertPattern(&quot;hello -world&quot;));
         assertTrue(test(&quot;hello -world&quot;, &quot;hello&quot;));
         assertFalse(test(&quot;hello -world&quot;, &quot;hello world&quot;));
@@ -105,10 +132,10 @@
     @Test
     public void invalid() throws ParseException {
         testInvalid(&quot;&quot;, &quot;(*); expected: term&quot;);
+        testInvalid(&quot; x&quot;, &quot; (*)x; expected: term&quot;);
+        testInvalid(&quot; -&quot;, &quot; (*)-; expected: term&quot;);
         testInvalid(&quot;x OR &quot;, &quot;x OR(*); expected: term&quot;);
         testInvalid(&quot;\&quot;&quot;, &quot;(*)\&quot;; expected: double quote&quot;);
-        testInvalid(&quot;-&quot;, &quot;(*)-; expected: term&quot;);
-        testInvalid(&quot;- x&quot;, &quot;- (*)x; expected: term&quot;);
         testInvalid(&quot;\\&quot;, &quot;(*)\\; expected: escaped char&quot;);
         testInvalid(&quot;\&quot;\\&quot;, &quot;\&quot;(*)\\; expected: escaped char&quot;);
         testInvalid(&quot;\&quot;x\&quot;y&quot;, &quot;\&quot;x\&quot;(*)y; expected: space&quot;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15458640" author="catholicon" created="Fri, 2 Sep 2016 14:12:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;whether it would be better to support &quot; -&quot; (space before term: currently illegal)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree that this should be legal. I&apos;d work for this too.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;whether it&apos;s a good idea to sort entries (&quot;hello - world&quot; becomes &quot;- hello world&quot;) and make them unique (&quot;test test&quot; becomes &quot;test&quot;).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think parser shouldn&apos;t play with ordering .. but I can see the rational that it allows consumer of parsed output to potentially have forward seeks in their dictionaries. Otoh, I think making unique or not shouldn&apos;t be parsers&apos;s concern at all.&lt;br/&gt;
I&apos;d open a new issue to follow up on these aspects.&lt;/p&gt;</comment>
                            <comment id="15479837" author="catholicon" created="Sat, 10 Sep 2016 13:53:56 +0000"  >&lt;p&gt;Fixed hyphen in &lt;a href=&quot;https://svn.apache.org/r1760168&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1760168&lt;/a&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt;, I&apos;ve used your patch but removed the added invalid tests which were essentially about leading spaces - which, imo, should be supported... I&apos;d open a new issue for that.&lt;/p&gt;</comment>
                            <comment id="15479871" author="catholicon" created="Sat, 10 Sep 2016 14:10:54 +0000"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;whether it would be better to support &quot; -&quot; (space before term: currently illegal)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I agree that this should be legal. I&apos;d work for this too.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-4786&quot; title=&quot;Fulltext parser should support leading white-spaces&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-4786&quot;&gt;OAK-4786&lt;/a&gt; for this.&lt;/p&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;whether it&apos;s a good idea to sort entries (&quot;hello - world&quot; becomes &quot;- hello world&quot;) and make them unique (&quot;test test&quot; becomes &quot;test&quot;).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think parser shouldn&apos;t play with ordering .. but I can see the rational that it allows consumer of parsed output to potentially have forward seeks in their dictionaries. Otoh, I think making unique or not shouldn&apos;t be parsers&apos;s concern at all.&lt;br/&gt;
I&apos;d open a new issue to follow up on these aspects.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-4788&quot; title=&quot;Fulltext parser sorts and unique-s parsed terms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-4788&quot;&gt;&lt;del&gt;OAK-4788&lt;/del&gt;&lt;/a&gt; for this.&lt;/p&gt;</comment>
                            <comment id="15502990" author="edivad" created="Mon, 19 Sep 2016 10:11:29 +0000"  >&lt;p&gt;bulk close for 1.5.10&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13004070">OAK-4786</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13004071">OAK-4787</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13004072">OAK-4788</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32s8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>