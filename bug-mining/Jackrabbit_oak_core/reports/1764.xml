<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:53:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-6950] Active deletion can delete blobs from a shared datastore when a clone setup is created</title>
                <link>https://issues.apache.org/jira/browse/OAK-6950</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;It&apos;s a common scenario have multiple seg-tar instance to load balance. These instance often share the data-store.&lt;/p&gt;

&lt;p&gt;Provisioning of such instance is often done by preare one instance and clone new ones from this instance.&lt;/p&gt;

&lt;p&gt;In such cases, index files while were live at the time of cloning can be collected by one instance while still being required by the other.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13118769">OAK-6950</key>
            <summary>Active deletion can delete blobs from a shared datastore when a clone setup is created</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="catholicon">Vikas Saurabh</assignee>
                                    <reporter username="catholicon">Vikas Saurabh</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Nov 2017 01:46:09 +0000</created>
                <updated>Thu, 3 Jan 2019 15:07:11 +0000</updated>
                            <resolved>Sun, 17 Dec 2017 23:13:03 +0000</resolved>
                                                    <fixVersion>1.7.14</fixVersion>
                    <fixVersion>1.8.0</fixVersion>
                                    <component>lucene</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16290190" author="catholicon" created="Thu, 14 Dec 2017 01:24:44 +0000"  >&lt;p&gt;Attaching wip &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12901974/12901974_OAK-6950.wip.1.patch&quot; title=&quot;OAK-6950.wip.1.patch attached to OAK-6950&quot;&gt;patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;Basic implementation is done. Left to do:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;tests specifically more IT types checking usual behavior and of course cloned setup with shared DS scenarios&lt;/li&gt;
	&lt;li&gt;refactor including renames of some weirdly worded names&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The idea of implementation is basically before clone one must indicate the intent to the repository using some jmx method (currently named &lt;tt&gt;dontCollectCurrentAndPauseMarkingDeletedBlobs&lt;/tt&gt; ). Once that method is called, all index files at head state get flagged as unsafe to be actively deleted. Along with that, we would keep an in-memory flag so that new index files also get flagged as unsafe for active deletion. There is another jmx method to reset this in-mem flag (currently named &lt;tt&gt;resumeMarkingDeletedBlobs&lt;/tt&gt;) which should be invoked after repository has been cloned.&lt;/p&gt;

&lt;p&gt;The method above doesn&apos;t require shutting down the original instance. Although, if setup is restarted anyway, then the in-memory flag would get reset - so, that should work too .... invoking jmx would still be required before cloning anyway btw.&lt;/p&gt;</comment>
                            <comment id="16294396" author="catholicon" created="Sun, 17 Dec 2017 23:13:03 +0000"  >&lt;p&gt;Fixed on trunk at &lt;a href=&quot;https://svn.apache.org/r1818521&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1818521&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12823773">OAK-2808</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13207255">OAK-7968</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12901974" name="OAK-6950.wip.1.patch" size="30201" author="catholicon" created="Thu, 14 Dec 2017 01:18:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 47 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mulb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>