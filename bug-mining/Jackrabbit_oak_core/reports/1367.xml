<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:49:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-3551] Failing version restore tests</title>
                <link>https://issues.apache.org/jira/browse/OAK-3551</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;as mentioned on dl-dev&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Tests in error: 
  testRestoreChild1(org.apache.jackrabbit.test.api.version.RestoreTest): org.apache.jackrabbit.oak.api.CommitFailedException: OakConstraint0022: /testroot/versionableNodeName1/child1[[test:versionable]]: Mandatory property jcr:versionHistory can not be removed
  testRestoreChild1Jcr2_2(org.apache.jackrabbit.test.api.version.RestoreTest): org.apache.jackrabbit.oak.api.CommitFailedException: OakConstraint0022: /testroot/versionableNodeName1/child1[[test:versionable]]: Mandatory property jcr:versionHistory can not be removed
  testRestoreChild1Jcr2_3(org.apache.jackrabbit.test.api.version.RestoreTest): org.apache.jackrabbit.oak.api.CommitFailedException: OakConstraint0022: /testroot/versionableNodeName1/child1[[test:versionable]]: Mandatory property jcr:versionHistory can not be removed
  testRestoreChild1Jcr2_4(org.apache.jackrabbit.test.api.version.RestoreTest): org.apache.jackrabbit.oak.api.CommitFailedException: OakConstraint0022: /testroot/versionableNodeName1/child1[[test:versionable]]: Mandatory property jcr:versionHistory can not be removed
  testRestoreChild1Jcr2(org.apache.jackrabbit.test.api.version.RestoreTest): org.apache.jackrabbit.oak.api.CommitFailedException: OakConstraint0022: /testroot/versionableNodeName1/child1[[test:versionable]]: Mandatory property jcr:versionHistory can not be removed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;one stacktrace sample:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;testRestoreChild1Jcr2(org.apache.jackrabbit.test.api.version.RestoreTest)  Time elapsed: 0.019 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
javax.jcr.RepositoryException: org.apache.jackrabbit.oak.api.CommitFailedException: OakConstraint0022: /testroot/versionableNodeName1/child1[[test:versionable]]: Mandatory property jcr:versionHistory can not be removed
	at org.apache.jackrabbit.oak.jcr.version.VersionManagerImpl$2.performVoid(VersionManagerImpl.java:204)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.performVoid(SessionDelegate.java:273)
	at org.apache.jackrabbit.oak.jcr.version.VersionManagerImpl.restore(VersionManagerImpl.java:168)
	at org.apache.jackrabbit.oak.jcr.version.VersionManagerImpl.restore(VersionManagerImpl.java:149)
	at org.apache.jackrabbit.test.api.version.RestoreTest.testRestoreChild1Jcr2(RestoreTest.java:856)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at junit.framework.TestCase.runTest(TestCase.java:176)
	at junit.framework.TestCase.runBare(TestCase.java:141)
	at junit.framework.TestResult$1.protect(TestResult.java:122)
	at junit.framework.TestResult.runProtected(TestResult.java:142)
	at junit.framework.TestResult.run(TestResult.java:125)
	at junit.framework.TestCase.run(TestCase.java:129)
	at org.apache.jackrabbit.test.AbstractJCRTest.run(AbstractJCRTest.java:464)
	at junit.framework.TestSuite.runTest(TestSuite.java:252)
	at junit.framework.TestSuite.run(TestSuite.java:247)
	at junit.framework.TestSuite.runTest(TestSuite.java:252)
	at junit.framework.TestSuite.run(TestSuite.java:247)
	at junit.framework.TestSuite.runTest(TestSuite.java:252)
	at junit.framework.TestSuite.run(TestSuite.java:247)
	at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:86)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:252)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:141)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:112)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:189)
	at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:165)
	at org.apache.maven.surefire.booter.ProviderFactory.invokeProvider(ProviderFactory.java:85)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:115)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:75)
Caused by: org.apache.jackrabbit.oak.api.CommitFailedException: OakConstraint0022: /testroot/versionableNodeName1/child1[[test:versionable]]: Mandatory property jcr:versionHistory can not be removed
	at org.apache.jackrabbit.oak.plugins.nodetype.TypeEditor.constraintViolation(TypeEditor.java:149)
	at org.apache.jackrabbit.oak.plugins.nodetype.TypeEditor.propertyDeleted(TypeEditor.java:198)
	at org.apache.jackrabbit.oak.spi.commit.VisibleEditor.propertyDeleted(VisibleEditor.java:85)
	at org.apache.jackrabbit.oak.spi.commit.CompositeEditor.propertyDeleted(CompositeEditor.java:99)
	at org.apache.jackrabbit.oak.spi.commit.EditorDiff.propertyDeleted(EditorDiff.java:104)
	at org.apache.jackrabbit.oak.plugins.segment.SegmentNodeState.compareProperties(SegmentNodeState.java:594)
	at org.apache.jackrabbit.oak.plugins.segment.SegmentNodeState.compareAgainstBaseState(SegmentNodeState.java:491)
	at org.apache.jackrabbit.oak.spi.commit.EditorDiff.childNodeChanged(EditorDiff.java:148)
	at org.apache.jackrabbit.oak.plugins.segment.SegmentNodeState.compareAgainstBaseState(SegmentNodeState.java:531)
	at org.apache.jackrabbit.oak.spi.commit.EditorDiff.childNodeChanged(EditorDiff.java:148)
	at org.apache.jackrabbit.oak.plugins.segment.MapRecord.compare(MapRecord.java:418)
	at org.apache.jackrabbit.oak.plugins.segment.SegmentNodeState.compareAgainstBaseState(SegmentNodeState.java:583)
	at org.apache.jackrabbit.oak.spi.commit.EditorDiff.childNodeChanged(EditorDiff.java:148)
	at org.apache.jackrabbit.oak.plugins.segment.MapRecord.compare(MapRecord.java:418)
	at org.apache.jackrabbit.oak.plugins.segment.SegmentNodeState.compareAgainstBaseState(SegmentNodeState.java:583)
	at org.apache.jackrabbit.oak.spi.commit.EditorDiff.process(EditorDiff.java:52)
	at org.apache.jackrabbit.oak.spi.commit.EditorHook.processCommit(EditorHook.java:54)
	at org.apache.jackrabbit.oak.spi.commit.CompositeHook.processCommit(CompositeHook.java:61)
	at org.apache.jackrabbit.oak.spi.commit.CompositeHook.processCommit(CompositeHook.java:61)
	at org.apache.jackrabbit.oak.plugins.segment.SegmentNodeStore$Commit.prepare(SegmentNodeStore.java:443)
	at org.apache.jackrabbit.oak.plugins.segment.SegmentNodeStore$Commit.optimisticMerge(SegmentNodeStore.java:474)
	at org.apache.jackrabbit.oak.plugins.segment.SegmentNodeStore$Commit.execute(SegmentNodeStore.java:530)
	at org.apache.jackrabbit.oak.plugins.segment.SegmentNodeStore.merge(SegmentNodeStore.java:208)
	at org.apache.jackrabbit.oak.core.MutableRoot.commit(MutableRoot.java:247)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.commit(SessionDelegate.java:346)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.commit(SessionDelegate.java:359)
	at org.apache.jackrabbit.oak.jcr.version.VersionManagerImpl$2.performVoid(VersionManagerImpl.java:201)
	... 34 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12907883">OAK-3551</key>
            <summary>Failing version restore tests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="stillalex">Alex Deparvu</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Oct 2015 11:21:43 +0000</created>
                <updated>Wed, 2 Mar 2016 14:47:55 +0000</updated>
                            <resolved>Mon, 26 Oct 2015 20:42:42 +0000</resolved>
                                                    <fixVersion>1.3.9</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>jcr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14974050" author="alex.parvulescu" created="Mon, 26 Oct 2015 11:22:06 +0000"  >&lt;p&gt;probably related to &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3541&quot; title=&quot;VersionableState.copy doesn&amp;#39;t respect OPV flag in the subtree&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3541&quot;&gt;&lt;del&gt;OAK-3541&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14974301" author="anchela" created="Mon, 26 Oct 2015 14:37:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alex.parvulescu&quot; class=&quot;user-hover&quot; rel=&quot;alex.parvulescu&quot;&gt;alex.parvulescu&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt;, i added more tests to verify my fix of &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3541&quot; title=&quot;VersionableState.copy doesn&amp;#39;t respect OPV flag in the subtree&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3541&quot;&gt;&lt;del&gt;OAK-3541&lt;/del&gt;&lt;/a&gt; and resolved the issue. IMHO the OPV flags are now properly handled upon &lt;tt&gt;VersionManager.checkin&lt;/tt&gt; and compliant with the requirements of JSR 170/283; maybe the restore is broken in a similar way?&lt;/p&gt;</comment>
                            <comment id="14974344" author="edivad" created="Mon, 26 Oct 2015 15:03:04 +0000"  >&lt;p&gt;this is a blocker for the 1.3.9 release that is planned tomorrow. If this is not a regression I&apos;m for &lt;tt&gt;@Ignore&lt;/tt&gt; the tests and fix it properly for 1.3.10. On the other hand if it&apos;s a regression I would consider this a blocker.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anchela&quot; class=&quot;user-hover&quot; rel=&quot;anchela&quot;&gt;anchela&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alex.parvulescu&quot; class=&quot;user-hover&quot; rel=&quot;alex.parvulescu&quot;&gt;alex.parvulescu&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt; what do you think?&lt;/p&gt;</comment>
                            <comment id="14974369" author="mreutegg" created="Mon, 26 Oct 2015 15:20:16 +0000"  >&lt;p&gt;I consider this a blocker for the release. The test used to work fine before &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3541&quot; title=&quot;VersionableState.copy doesn&amp;#39;t respect OPV flag in the subtree&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3541&quot;&gt;&lt;del&gt;OAK-3541&lt;/del&gt;&lt;/a&gt;. I&apos;m currently investigating why it fails with those recent changes.&lt;/p&gt;</comment>
                            <comment id="14974911" author="mreutegg" created="Mon, 26 Oct 2015 19:59:39 +0000"  >&lt;p&gt;I think the issue is with how the checkin method treats the case where OPV says COPY and the child node is mix:versionable. This is somewhat contradictory. Before &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3541&quot; title=&quot;VersionableState.copy doesn&amp;#39;t respect OPV flag in the subtree&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3541&quot;&gt;&lt;del&gt;OAK-3541&lt;/del&gt;&lt;/a&gt;, the checkin would favour the OPV setting and copy the version related property to the frozen node. Now the checkin ignores version related properties and on restore the TypeEditor complains about missing mandatory properties.&lt;/p&gt;

&lt;p&gt;I read the relevant part of the spec again and in &apos;&lt;a href=&quot;http://www.day.com/specs/jcr/2.0/3_Repository_Model.html#3.13.9 Versionable State&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.13.9 Versionable State&lt;/a&gt;&apos; it says:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;5. For each child node C of N where
     * C has an OPV of COPY,
a copy of the entire subgraph rooted at C (regardless of the OPV values of the sub-items) is 
added to the frozen node, preserving the name of C and the names and values of all its sub-items.
In a repository that supports orderable child nodes, the relative ordering of the set of child nodes C 
that are copied to the frozen node is preserved. As is the ordering within the subgraph of each of 
these child nodes C.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To me this sounds like the previous behaviour was according to the spec, even though I think the intention of &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3541&quot; title=&quot;VersionableState.copy doesn&amp;#39;t respect OPV flag in the subtree&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3541&quot;&gt;&lt;del&gt;OAK-3541&lt;/del&gt;&lt;/a&gt; is reasonable as well. Maybe we should implement a compromise. When C has OPV of COPY, copy the subgraph rooted at C but only items that have OPV COPY or VERSION. Fail the checkin on ABORT and ignore items with IGNORE.&lt;/p&gt;</comment>
                            <comment id="14975006" author="mreutegg" created="Mon, 26 Oct 2015 20:42:42 +0000"  >&lt;p&gt;Fixed in trunk as described in the previous comment: &lt;a href=&quot;http://svn.apache.org/r1710690&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1710690&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14982417" author="edivad" created="Fri, 30 Oct 2015 11:23:00 +0000"  >&lt;p&gt;Bulk close for 1.3.9&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12907100">OAK-3541</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 3 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2nimv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>