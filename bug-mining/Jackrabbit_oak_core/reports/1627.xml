<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:52:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-5416] Async reindex of a sync property does&apos;t release created checkpoint</title>
                <link>https://issues.apache.org/jira/browse/OAK-5416</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Async reindex of a property index creates a checkpoint to use as a reference, but it fails to clean it up when done. In the usual reindexing scenario the async indexer needs to keep the created checkpoint as a reference for subsequent runs, but this is a &apos;one off&apos; case, so cleanup of this reference checkpoint must also happen at the end of the cycle.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13032554">OAK-5416</key>
            <summary>Async reindex of a sync property does&apos;t release created checkpoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stillalex">Alex Deparvu</assignee>
                                    <reporter username="stillalex">Alex Deparvu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Jan 2017 14:09:54 +0000</created>
                <updated>Mon, 13 Sep 2021 09:48:43 +0000</updated>
                            <resolved>Fri, 13 Jan 2017 15:45:53 +0000</resolved>
                                                    <fixVersion>1.5.18</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15804614" author="alex.parvulescu" created="Fri, 6 Jan 2017 14:11:13 +0000"  >&lt;p&gt;proposed patch. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt; thoughts?&lt;/p&gt;</comment>
                            <comment id="15804863" author="alex.parvulescu" created="Fri, 6 Jan 2017 16:01:37 +0000"  >&lt;p&gt;attaching v2, a better version that also takes into account having no changes between 2 consecutive runs of the indexer (I had to disable an optimisation to allow proper finalization and cleanup of the async reindex).&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;edit&amp;#93;&lt;/span&gt; patch still needs more work, this version is somehow too eager to clean the checkpoints. I&apos;m going to continue on Monday. &lt;/p&gt;</comment>
                            <comment id="15811000" author="alex.parvulescu" created="Mon, 9 Jan 2017 08:08:37 +0000"  >&lt;p&gt;attaching v3. this also takes care of clearing the reference to the released checkpoint. I also tweaked some of the checkpoint cleanup log messages that did not include the &lt;tt&gt;name&lt;/tt&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt; feedback appreciated!&lt;/p&gt;</comment>
                            <comment id="15817702" author="chetanm" created="Wed, 11 Jan 2017 08:50:54 +0000"  >&lt;p&gt;Patch looks good. &lt;/p&gt;

&lt;p&gt;One more scenario - What is async index of property index fails and then admin for some reason did not proceed to do it again. In that case the checkpoint would be left. May be we can expose a method in &lt;tt&gt;PropertyIndexAsyncReindexMBean&lt;/tt&gt; to do cleanup. This would allow us to handle any such edge case&lt;/p&gt;</comment>
                            <comment id="15818049" author="alex.parvulescu" created="Wed, 11 Jan 2017 11:20:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;In that case the checkpoint would be left.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;that would not be the only problem though. &lt;tt&gt;async&lt;/tt&gt; property would also be left, which means the sync property index would never be updated. the only way to recover would be to remove the property and a full reindex, adding a manual checkpoint cleanup to this doesn&apos;t sound that much worse. but on the other hand providing this cleanup method would give the false sense o security that everything is ok, when it really isn&apos;t (see point about reindexing earlier).&lt;/p&gt;</comment>
                            <comment id="15821917" author="alex.parvulescu" created="Fri, 13 Jan 2017 15:45:53 +0000"  >&lt;p&gt;fixed with &lt;a href=&quot;http://svn.apache.org/viewvc?rev=1778620&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1778620&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I opted to not add any cleanup support. that can already be done via the CheckpointManager mbean, so I only updated the docs with what needs to be done in the case of a failed async reindex. If this does not suffice we can have another look at the resiliency aspect later.&lt;/p&gt;</comment>
                            <comment id="15834555" author="edivad" created="Mon, 23 Jan 2017 14:05:52 +0000"  >&lt;p&gt;Bulk close for 1.5.18&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12846030" name="OAK-5416-v2.patch" size="4111" author="stillalex" created="Fri, 6 Jan 2017 16:01:37 +0000"/>
                            <attachment id="12846273" name="OAK-5416-v3.patch" size="5397" author="stillalex" created="Mon, 9 Jan 2017 08:08:37 +0000"/>
                            <attachment id="12846017" name="OAK-5416.patch" size="3139" author="stillalex" created="Fri, 6 Jan 2017 14:11:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38ctb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>