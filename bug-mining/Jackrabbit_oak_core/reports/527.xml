<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:40:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-869] Runtime exception while adding node</title>
                <link>https://issues.apache.org/jira/browse/OAK-869</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Trying to add a node where the user has not read permission ends up in a runtime exception &lt;/p&gt;

&lt;p&gt;java.lang.IllegalStateException: This tree does not exist&lt;br/&gt;
	at com.google.common.base.Preconditions.checkState(Preconditions.java:149)&lt;br/&gt;
	at org.apache.jackrabbit.oak.core.TreeImpl.checkExists(TreeImpl.java:453)&lt;br/&gt;
	at org.apache.jackrabbit.oak.core.TreeImpl.setProperty(TreeImpl.java:347)&lt;br/&gt;
	at org.apache.jackrabbit.oak.jcr.delegate.NodeDelegate.internalAddChild(NodeDelegate.java:508)&lt;br/&gt;
	at org.apache.jackrabbit.oak.jcr.delegate.NodeDelegate.addChild(NodeDelegate.java:462)&lt;br/&gt;
	at org.apache.jackrabbit.oak.jcr.NodeImpl$5.perform(NodeImpl.java:256)&lt;br/&gt;
	at org.apache.jackrabbit.oak.jcr.NodeImpl$5.perform(NodeImpl.java:1)&lt;br/&gt;
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.perform(SessionDelegate.java:97)&lt;br/&gt;
	at org.apache.jackrabbit.oak.jcr.ItemImpl.perform(ItemImpl.java:95)&lt;br/&gt;
	at org.apache.jackrabbit.oak.jcr.NodeImpl.addNode(NodeImpl.java:217)&lt;br/&gt;
	at org.apache.jackrabbit.oak.jcr.NodeImpl.addNode(NodeImpl.java:203)&lt;br/&gt;
	at org.apache.jackrabbit.oak.benchmark.AddChildTest.runTest(AddChildTest.java:71)&lt;br/&gt;
	at org.apache.jackrabbit.oak.benchmark.AbstractTest.execute(AbstractTest.java:146)&lt;br/&gt;
	at org.apache.jackrabbit.oak.benchmark.AddChildTest.execute(AddChildTest.java:1)&lt;br/&gt;
	at org.apache.jackrabbit.oak.benchmark.AbstractTest.runTest(AbstractTest.java:115)&lt;br/&gt;
	at org.apache.jackrabbit.oak.benchmark.AbstractTest.run(AbstractTest.java:84)&lt;br/&gt;
	at org.apache.jackrabbit.oak.benchmark.AddChildTest.run(AddChildTest.java:1)&lt;br/&gt;
	at org.apache.jackrabbit.oak.benchmark.BenchmarkRunner.main(BenchmarkRunner.java:114)&lt;/p&gt;

&lt;p&gt;It would be better to have a checked excpetion instead e.g. javax.jcr.AccessDeniedException&lt;/p&gt;

&lt;p&gt;I will attach test to reproduce the issue&lt;/p&gt;</description>
                <environment></environment>
        <key id="12652622">OAK-869</key>
            <summary>Runtime exception while adding node</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="asanso">Antonio Sanso</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Jun 2013 11:47:47 +0000</created>
                <updated>Thu, 28 Nov 2013 14:34:15 +0000</updated>
                            <resolved>Fri, 22 Nov 2013 21:04:32 +0000</resolved>
                                                    <fixVersion>0.12</fixVersion>
                                    <component>jcr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13682358" author="mduerig" created="Thu, 13 Jun 2013 15:53:29 +0000"  >&lt;p&gt;I added a simplified test case at r1492716 &lt;/p&gt;</comment>
                            <comment id="13682412" author="mduerig" created="Thu, 13 Jun 2013 16:45:30 +0000"  >&lt;p&gt;The root cause for this is &lt;tt&gt;SecureNodeBuilder.setChildNode&lt;/tt&gt; overwriting the invisible child node with the new one but reusing the &lt;tt&gt;SecurityContext&lt;/tt&gt; of the old one. The subsequent call for setting the primary type property will then fail. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;jukkaz&lt;/a&gt; any idea how to best fix this?&lt;/p&gt;</comment>
                            <comment id="13683093" author="jukkaz" created="Fri, 14 Jun 2013 04:53:47 +0000"  >&lt;p&gt;See the TODO in &lt;tt&gt;SecureNodeBuilder.exists()&lt;/tt&gt;. All newly added transient content should I guess be visible to the client that added that content, regardless of any previous access controls. I didn&apos;t yet include the &lt;tt&gt;isNew()&lt;/tt&gt; check in the &lt;tt&gt;exist()&lt;/tt&gt; implementation given the other TODO in the &lt;tt&gt;isNew()&lt;/tt&gt; implementation.&lt;/p&gt;</comment>
                            <comment id="13716473" author="mduerig" created="Tue, 23 Jul 2013 15:19:08 +0000"  >&lt;p&gt;Turns out this is not about new items but rather about &apos;overlaid&apos; items that are not accessible. AFAICS we need to somehow keep track of those in &lt;tt&gt;SecureNodeBuilder&lt;/tt&gt;. &lt;/p&gt;</comment>
                            <comment id="13814051" author="anchela" created="Tue, 5 Nov 2013 17:10:12 +0000"  >&lt;p&gt;hasn&apos;t this issue been fixed in the mean time?&lt;/p&gt;</comment>
                            <comment id="13814056" author="mduerig" created="Tue, 5 Nov 2013 17:19:18 +0000"  >&lt;p&gt;It certainly seems so. At least &lt;tt&gt;org.apache.jackrabbit.oak.jcr.security.authorization.WriteTest#testWriteOnParentWithNoReadePriv&lt;/tt&gt; passes now for me. We should probably remove the &lt;tt&gt;@Ignore&lt;/tt&gt; and resolve this issue. &lt;/p&gt;</comment>
                            <comment id="13814066" author="anchela" created="Tue, 5 Nov 2013 17:38:56 +0000"  >&lt;p&gt;hm... it still fails, when removing it from the exclusion list in oak-jcr/pom.xml&lt;/p&gt;</comment>
                            <comment id="13819956" author="anchela" created="Tue, 12 Nov 2013 09:37:12 +0000"  >&lt;p&gt;i added a second test case to ShadowInvisibleContentTest which operates solely on oak api.&lt;/p&gt;</comment>
                            <comment id="13821386" author="anchela" created="Wed, 13 Nov 2013 14:45:43 +0000"  >&lt;p&gt;adding link to OAK_1178 as discussed during the oak meeting.&lt;/p&gt;</comment>
                            <comment id="13830306" author="jukkaz" created="Fri, 22 Nov 2013 21:02:38 +0000"  >&lt;p&gt;Committed an initial fix in revision 1544674. The idea is to use a new &lt;tt&gt;NodeBuilder.isReplaced()&lt;/tt&gt; predicate to check whether a method like &lt;tt&gt;setChildNode()&lt;/tt&gt; was used to replace the possibly read-protected base state.&lt;/p&gt;</comment>
                            <comment id="13830311" author="jukkaz" created="Fri, 22 Nov 2013 21:04:32 +0000"  >&lt;p&gt;Actually we can resolve this issue as Fixed since the exception is already taken care of and follow up in &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-928&quot; title=&quot;Read access is enforced on NEW items&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-928&quot;&gt;&lt;del&gt;OAK-928&lt;/del&gt;&lt;/a&gt; for the remaining bits (handling of new properties, etc.).&lt;/p&gt;</comment>
                            <comment id="13834884" author="alex.parvulescu" created="Thu, 28 Nov 2013 14:34:15 +0000"  >&lt;p&gt;bulk close for the 0.12 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12659328">OAK-928</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12679016">OAK-1178</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12587608" name="AddChildTest.java" size="2826" author="asanso" created="Thu, 13 Jun 2013 11:48:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332946</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 51 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lfpb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>333274</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>