<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:50:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-4085] Malformed node type definition when reregistered after upgrade </title>
                <link>https://issues.apache.org/jira/browse/OAK-4085</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;When a node type is reregistered after an upgrade from an earlier release, the resulting node type definition may be malformed. As noted in &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3584&quot; title=&quot;PathNotFoundException when reading child node and property definitions below nt root&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3584&quot;&gt;&lt;del&gt;OAK-3584&lt;/del&gt;&lt;/a&gt;, the node type representation in content was not compliant with JCR already before. As explained here the situation after an upgrade is even worse: &lt;a href=&quot;http://markmail.org/message/7kjkqlt3erbocpin&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/message/7kjkqlt3erbocpin&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12946512">OAK-4085</key>
            <summary>Malformed node type definition when reregistered after upgrade </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="mreutegg">Marcel Reutegger</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Mar 2016 10:59:22 +0000</created>
                <updated>Thu, 19 May 2016 08:01:31 +0000</updated>
                            <resolved>Mon, 7 Mar 2016 08:14:48 +0000</resolved>
                                    <version>1.3.10</version>
                                    <fixVersion>1.2.16</fixVersion>
                    <fixVersion>1.4</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                    <component>core</component>
                    <component>jcr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15177710" author="mreutegg" created="Thu, 3 Mar 2016 11:42:40 +0000"  >&lt;p&gt;The problem is with how &lt;tt&gt;NodeTypeTemplateImpl.writeItemDefinitions()&lt;/tt&gt; overwrites existing definition child nodes.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;            for (ItemDefinitionTemplate template : itemDefTemplates) {
                String name = nodeName(nodeName, index);
                tree = nodeTypeTree.getChild(name);
                if (!tree.exists()) {
                    tree = nodeTypeTree.addChild(name);
                    tree.setProperty(
                            JCR_PRIMARYTYPE, primaryTypeName, NAME);
                }
                template.writeTo(tree);
                index++;
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The sequence of child node names will be &apos;jcr:childNodeDefinition&apos;, &apos;jcr:childNodeDefinition&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;&apos;, &apos;jcr:childNodeDefinition&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt;&apos;, etc. This is correct from a JCR point of view, but will skip a &apos;jcr:childNodeDefinition&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&apos; child node from a previous Oak version.&lt;/p&gt;</comment>
                            <comment id="15177783" author="mreutegg" created="Thu, 3 Mar 2016 13:04:47 +0000"  >&lt;p&gt;Proposed fix. Manual upgrade tests show it works with these changes.&lt;/p&gt;</comment>
                            <comment id="15182732" author="mreutegg" created="Mon, 7 Mar 2016 08:14:48 +0000"  >&lt;p&gt;Simplified the fix based on Angela&apos;s comments and added an upgrade test to oak-jcr with a TarMK repository created with Oak 1.0.&lt;/p&gt;

&lt;p&gt;Fixed in trunk: &lt;a href=&quot;http://svn.apache.org/r1733875&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1733875&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15182770" author="mreutegg" created="Mon, 7 Mar 2016 08:57:35 +0000"  >&lt;p&gt;Merged into 1.4 branch: &lt;a href=&quot;http://svn.apache.org/r1733882&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1733882&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I will also update the release notes since the 1.4.0 release candidate was canceled.&lt;/p&gt;</comment>
                            <comment id="15182775" author="mreutegg" created="Mon, 7 Mar 2016 09:00:37 +0000"  >&lt;p&gt;Release notes updated: &lt;a href=&quot;http://svn.apache.org/r1733884&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1733884&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15189134" author="edivad" created="Thu, 10 Mar 2016 11:20:29 +0000"  >&lt;p&gt;Bulk close for 1.4.0&lt;/p&gt;</comment>
                            <comment id="15290658" author="tomek.rekawek" created="Thu, 19 May 2016 08:01:31 +0000"  >&lt;p&gt;Backported to 1.2 in &lt;a href=&quot;https://svn.apache.org/r1744527&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1744527&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12910315">OAK-3584</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12791163" name="OAK-4085.patch" size="1961" author="mreutegg" created="Thu, 3 Mar 2016 13:04:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 26 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u3cf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>