<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:35:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-421] NodeBuilder.reset might lead to inconsistent builder</title>
                <link>https://issues.apache.org/jira/browse/OAK-421</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The following test fails:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;NodeBuilder root = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MemoryNodeBuilder(BASE);
NodeBuilder x = root.child(&lt;span class=&quot;code-quote&quot;&gt;&quot;x&quot;&lt;/span&gt;);
NodeBuilder y = x.child(&lt;span class=&quot;code-quote&quot;&gt;&quot;y&quot;&lt;/span&gt;);

root.reset(BASE);
assertTrue(root.hasChildNode(&lt;span class=&quot;code-quote&quot;&gt;&quot;x&quot;&lt;/span&gt;));
assertFalse(x.hasChildNode(&lt;span class=&quot;code-quote&quot;&gt;&quot;y&quot;&lt;/span&gt;));  &lt;span class=&quot;code-comment&quot;&gt;// fails&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12614580">OAK-421</key>
            <summary>NodeBuilder.reset might lead to inconsistent builder</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mduerig">Michael D&#252;rig</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Nov 2012 22:03:30 +0000</created>
                <updated>Mon, 6 May 2013 15:48:56 +0000</updated>
                            <resolved>Tue, 6 Nov 2012 15:43:02 +0000</resolved>
                                                    <fixVersion>0.6</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13489786" author="mduerig" created="Fri, 2 Nov 2012 22:05:58 +0000"  >&lt;p&gt;The reason seems to be that &lt;tt&gt;MemoryNodeBuilder.reset&lt;/tt&gt; just increments the root revision. When this revision collides with that of another builder, the latter will not update its state on next access. &lt;/p&gt;</comment>
                            <comment id="13489787" author="mduerig" created="Fri, 2 Nov 2012 22:08:28 +0000"  >&lt;p&gt;Suggested fix. Please review.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;===================================================================
--- oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/memory/MemoryNodeBuilder.java	(revision f5731085dbd7249d8201f8f0080e4a9475af44e8)
+++ oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/memory/MemoryNodeBuilder.java	(revision )
@@ -265,7 +265,7 @@
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; == root) {
             baseState = checkNotNull(newBase);
             writeState = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MutableNodeState(baseState);
-            revision++;
+            revision = 0;
         } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
             &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot reset a non-root builder&quot;&lt;/span&gt;);
         }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13489793" author="mduerig" created="Fri, 2 Nov 2012 22:15:14 +0000"  >&lt;p&gt;I applied above fix in revision 1405182. Please review.&lt;/p&gt;</comment>
                            <comment id="13489828" author="mduerig" created="Fri, 2 Nov 2012 23:13:21 +0000"  >&lt;p&gt;After a second thought, setting the revision to zero on reset might also lead to conflicts. Incrementing it by 2 should do the trick however since the revisions of all builders are not more than 1 ahead of the root revision. &lt;/p&gt;</comment>
                            <comment id="13489832" author="mduerig" created="Fri, 2 Nov 2012 23:21:31 +0000"  >&lt;p&gt;Applied this change in revision 1405213. Please review &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13490555" author="jukkaz" created="Mon, 5 Nov 2012 10:34:47 +0000"  >&lt;p&gt;The +2 sounds a bit suspicious.&lt;/p&gt;

&lt;p&gt;I looked at this and it looks like the problem was rather in the write() method that would stop recursion up to the root when the first up-to-date builder was encountered. This is incorrect since in a write() all builders up to the root need to be updated to have the latest revision number.&lt;/p&gt;

&lt;p&gt;A fix is in &lt;a href=&quot;https://github.com/jukka/jackrabbit-oak/commit/e01558418008e41a94c44ea00494f6a939ed58a2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jukka/jackrabbit-oak/commit/e01558418008e41a94c44ea00494f6a939ed58a2&lt;/a&gt;. I&apos;ll commit it once I have svn working on the temporary laptop I have with me now.&lt;/p&gt;</comment>
                            <comment id="13491355" author="mduerig" created="Tue, 6 Nov 2012 10:08:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;The +2 sounds a bit suspicious.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s why I asked for a review &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I wasn&apos;t sure about &lt;tt&gt;write()&lt;/tt&gt; where the recursions stops early. I thought this to be some clever optimisation. &lt;/p&gt;</comment>
                            <comment id="13491544" author="mduerig" created="Tue, 6 Nov 2012 15:42:46 +0000"  >&lt;p&gt;In revision 1406185 I applied the patch from &lt;a href=&quot;https://github.com/jukka/jackrabbit-oak/commit/e01558418008e41a94c44ea00494f6a939ed58a2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jukka/jackrabbit-oak/commit/e01558418008e41a94c44ea00494f6a939ed58a2&lt;/a&gt;. This fixes the problem.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12614615">OAK-422</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>254996</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0eodj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>83711</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>