<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:41:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-938] UserManager does not honour session refresh settings</title>
                <link>https://issues.apache.org/jira/browse/OAK-938</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;When UserManager#getAuthorizable is used in a multiple sessions environment where a session creates an user and the other (already acquired) session tries to get the authorizable null is returned (even if the other session uses refresh-interval to 0)&lt;/p&gt;

&lt;p&gt;unit test to follow&lt;/p&gt;</description>
                <environment></environment>
        <key id="12661841">OAK-938</key>
            <summary>UserManager does not honour session refresh settings</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mduerig">Michael D&#252;rig</assignee>
                                    <reporter username="asanso">Antonio Sanso</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 Aug 2013 08:43:24 +0000</created>
                <updated>Tue, 12 Jan 2016 17:37:13 +0000</updated>
                            <resolved>Tue, 13 Aug 2013 15:15:13 +0000</resolved>
                                                    <fixVersion>0.9</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13729305" author="asanso" created="Mon, 5 Aug 2013 08:45:37 +0000"  >&lt;p&gt;attaching unit test&lt;/p&gt;</comment>
                            <comment id="13729315" author="asanso" created="Mon, 5 Aug 2013 08:56:26 +0000"  >&lt;p&gt;looks like org.apache.jackrabbit.oak.core.IdentifierManager holds an old Root revision acquired at initialization (UserInitializer#initialize)&lt;/p&gt;</comment>
                            <comment id="13729330" author="mduerig" created="Mon, 5 Aug 2013 09:15:57 +0000"  >&lt;p&gt;Thanks for the test case. I&apos;ll have a look. As an aside: please make sure not to use tabs for indention.&lt;/p&gt;</comment>
                            <comment id="13729494" author="asanso" created="Mon, 5 Aug 2013 13:19:41 +0000"  >&lt;p&gt;attaching proposed patch.&lt;br/&gt;
This should solve this particular occurrence of the issue.&lt;br/&gt;
I am afraid this problem might be a bit spread all over the place a SystemRoot is used e.g. for initialization&lt;/p&gt;</comment>
                            <comment id="13729579" author="mduerig" created="Mon, 5 Aug 2013 15:42:09 +0000"  >&lt;p&gt;The root cause of this is the &lt;tt&gt;IdentifierManger&lt;/tt&gt; being tied to the &lt;tt&gt;Root&lt;/tt&gt; (and its associated revision of the repository) that was passed to its constructor. That &lt;tt&gt;Root&lt;/tt&gt; instance doesn&apos;t honour the refresh setting passed to the session in the first place. Not sure yet how to best proceed here since the session refresh setting is applied at &lt;tt&gt;NodeDelegate&lt;/tt&gt; level an has no meaning at &lt;tt&gt;Root&lt;/tt&gt; level. &lt;/p&gt;
</comment>
                            <comment id="13729593" author="mduerig" created="Mon, 5 Aug 2013 16:01:09 +0000"  >&lt;p&gt;Applied &lt;tt&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-938&quot; title=&quot;UserManager does not honour session refresh settings&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-938&quot;&gt;&lt;del&gt;OAK-938&lt;/del&gt;&lt;/a&gt;-test-patch.txt&lt;/tt&gt; at revision 1510578.&lt;/p&gt;</comment>
                            <comment id="13730819" author="mduerig" created="Tue, 6 Aug 2013 14:30:02 +0000"  >&lt;p&gt;&lt;a href=&quot;http://markmail.org/message/lki4c6adm6si7er2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/message/lki4c6adm6si7er2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll start by implementing a &lt;tt&gt;UserManagerDelegate&lt;/tt&gt; in &lt;tt&gt;oak-jcr&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="13730900" author="jukkaz" created="Tue, 6 Aug 2013 16:19:55 +0000"  >&lt;p&gt;Re: &lt;tt&gt;UserManagerDelegate&lt;/tt&gt;; I think we should treat the existing &lt;tt&gt;UserManagerImpl&lt;/tt&gt; in the &lt;tt&gt;oak-core&lt;/tt&gt; plugin as the delegate class, since it already contains the actual implementation logic based on the lower-level Oak API. Thus what we&apos;d need is another &lt;tt&gt;UserManagerImpl&lt;/tt&gt; (or perhaps &lt;tt&gt;UserManagerWrapper&lt;/tt&gt;) in &lt;tt&gt;oak-jcr&lt;/tt&gt; that takes care of wrapping the relevant calls with &lt;tt&gt;SessionDelegate.perform()&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="13731023" author="mduerig" created="Tue, 6 Aug 2013 18:00:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think we should treat the existing UserManagerImpl in the oak-core plugin as the delegate class,...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I was thinking the same while tinkering around. In addition we could pass the root associated with the correct revision (i.e. the &quot;refreshed&quot;) root to &lt;tt&gt;SessionOperation.perform()&lt;/tt&gt;. That way the session related entities (e.g. &lt;tt&gt;UserManager&lt;/tt&gt;) implemented on top of &lt;tt&gt;Root&lt;/tt&gt; need not rely on side effects.&lt;/p&gt;</comment>
                            <comment id="13731937" author="mduerig" created="Wed, 7 Aug 2013 12:49:22 +0000"  >&lt;p&gt;Wrapping the &lt;tt&gt;UserManager&lt;/tt&gt; returned from &lt;tt&gt;SessionContext.getUserManager()&lt;/tt&gt; into one that wraps all its methods into a &lt;tt&gt;SessionOperation&lt;/tt&gt; makes the test pass as expected. However it cause the user and group related test cases to fail since &lt;tt&gt;UserImporter&lt;/tt&gt; casts to &lt;tt&gt;UserImporterImpl&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-945&quot; title=&quot;UserImporter should not cast UserManager to UserManagerImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-945&quot;&gt;&lt;del&gt;OAK-945&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13731984" author="mduerig" created="Wed, 7 Aug 2013 13:38:03 +0000"  >&lt;p&gt;Tentative fix at revision 1511302. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anchela&quot; class=&quot;user-hover&quot; rel=&quot;anchela&quot;&gt;anchela&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;jukkaz&lt;/a&gt; please review whether this is what you had in mind when we discussed this. I will then follow up with further tweaks:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;pass the refreshed root through &lt;tt&gt;SessionOperation.perform()&lt;/tt&gt; instead of relying on side effects,&lt;/li&gt;
	&lt;li&gt;leverage the precondition check facility of &lt;tt&gt;SessionOperation&lt;/tt&gt; for replacing &lt;tt&gt;UserManager.checkLive()&lt;/tt&gt;,&lt;/li&gt;
	&lt;li&gt;promote the anonymous &lt;tt&gt;UserManager&lt;/tt&gt; implementation in &lt;tt&gt;SessionContext&lt;/tt&gt; to a top level class and make &lt;tt&gt;UserManagerImpl&lt;/tt&gt; the delegate,&lt;/li&gt;
	&lt;li&gt;apply similar transformations to other affected areas (potential candidates: PrincipalManager, VersionManager, ACManager, PermissionProvider, ObservationManager,  and PrivilegeManager)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13732008" author="anchela" created="Wed, 7 Aug 2013 14:05:27 +0000"  >&lt;p&gt;why does the tentative fix contain modifications to the UserManagerImpl in oak-core? as far as i saw it was only&lt;br/&gt;
changing the order of the imports, thus unrelated to this issue, isn&apos;t it? if that&apos;s the case, please revert it to keep the revisions and issue references clean.&lt;/p&gt;

&lt;p&gt;as far as the modifications to SessionContext is concerned:&lt;br/&gt;
looks ok to me at first glace. indeed, i would rather avoid creating such a huge anonymous inner class and thus rather extract it to the security package. for proper separation i would avoid keeping it on the top level.&lt;/p&gt;

&lt;p&gt;as far as the other affected areas are concerned: i would suggest that we first get some more confidence that&lt;br/&gt;
it works as expected and doesn&apos;t have any other side effects before going ahead with all the others. &lt;/p&gt;</comment>
                            <comment id="13732019" author="mduerig" created="Wed, 7 Aug 2013 14:12:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;why does the tentative fix contain modifications to the UserManagerImpl in oak-core?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Refactoring accident. I could revert but as we all tend to have different settings of how imports are ordered this wont hold for long.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;anonymous inner class&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;See my previous comment. I&apos;ll follow up with that.&lt;/p&gt;</comment>
                            <comment id="13738341" author="mduerig" created="Tue, 13 Aug 2013 15:15:13 +0000"  >&lt;p&gt;Fixed at revision 1513521&lt;/p&gt;</comment>
                            <comment id="13772722" author="alex.parvulescu" created="Fri, 20 Sep 2013 07:01:29 +0000"  >&lt;p&gt;Bulk close for the 0.9 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12662362">OAK-945</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12663435">OAK-958</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12855856">OAK-3228</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12676317">OAK-1124</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12645616">OAK-803</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12596111" name="OAK-938-patch" size="827" author="asanso" created="Mon, 5 Aug 2013 13:19:41 +0000"/>
                            <attachment id="12596062" name="OAK-938-test-patch.txt" size="2061" author="asanso" created="Mon, 5 Aug 2013 08:45:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>341845</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1myef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>342151</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>