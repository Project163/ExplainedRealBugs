<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:48:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-3000] SimpleExcerptProvider causes OOM for some wildcard expressions</title>
                <link>https://issues.apache.org/jira/browse/OAK-3000</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;&lt;tt&gt;SimpleExcerptProvider&lt;/tt&gt; would cause OOM is the search expression involves wildcard in following form&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;fox *&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This causes an infinite loop leading to OOM&lt;/p&gt;</description>
                <environment></environment>
        <key id="12838376">OAK-3000</key>
            <summary>SimpleExcerptProvider causes OOM for some wildcard expressions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="chetanm">Chetan Mehrotra</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Jun 2015 04:24:26 +0000</created>
                <updated>Tue, 8 Oct 2019 15:22:16 +0000</updated>
                            <resolved>Wed, 17 Jun 2015 17:03:15 +0000</resolved>
                                                    <fixVersion>1.0.16</fixVersion>
                    <fixVersion>1.2.3</fixVersion>
                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14589278" author="chetanm" created="Wed, 17 Jun 2015 04:28:00 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12740068/12740068_OAK-3000.patch&quot; title=&quot;OAK-3000.patch attached to OAK-3000&quot;&gt;patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; with a testcase and potential fix&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alexparvulescu&quot; class=&quot;user-hover&quot; rel=&quot;alexparvulescu&quot;&gt;alexparvulescu&lt;/a&gt; Can you review&lt;/p&gt;</comment>
                            <comment id="14589442" author="tmueller" created="Wed, 17 Jun 2015 07:52:47 +0000"  >&lt;p&gt;For me, the new test &quot;highlightWithWildCard&quot; fails. It says:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.junit.ComparisonFailure: expected:
&amp;lt;&amp;lt;div&amp;gt;&amp;lt;span&amp;gt;[fox is &amp;lt;strong&amp;gt;jumping&amp;lt;/strong&amp;gt;]&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;gt; 
but was:
&amp;lt;&amp;lt;div&amp;gt;&amp;lt;span&amp;gt;[&amp;lt;strong&amp;gt;fox&amp;lt;/strong&amp;gt; is jumping]&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m not sure if the patch is correct. Debugging the code, it will try to highlight &quot;fox&quot; and then &quot;&amp;#42;&quot;. Highlighting &quot;fox&quot; works, but highlighting &quot;&amp;#42;&quot; would highlight the character &quot;&amp;#42;&quot;. But I don&apos;t think the wildcard character should be handled like this. I would expect it to be ignored:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    @Test
    public void highlightIgnoreStar() throws Exception {
        assertEquals(&quot;&amp;lt;div&amp;gt;&amp;lt;span&amp;gt;10 * 10&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&quot;,
                highlight(sb(&quot;10 * 10&quot;), of(&quot;fox *&quot;)));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A bit unexpected (I would call it a bug) is that you can highlight the intermediate HTML. That way, you can generate a strange, and very long result. For example, this results in a 300 KB &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/warning.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; long string:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;highlight(sb(&quot;abc&quot;), of(&quot;a &amp;lt; &amp;gt; o n st ng&amp;gt; ng on ong /&quot;)))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14589452" author="tmueller" created="Wed, 17 Jun 2015 08:04:25 +0000"  >&lt;p&gt;I guess to avoid out of memory, and to give more reasonable results, we should change the highlighter to use a BitField to remember which characters are to be highlighted, and then only in the final stage use &quot;&amp;lt;strong&amp;gt;&quot; &quot;&amp;lt;/strong&amp;gt;&quot; where applicable. I can come up with a patch for that.&lt;/p&gt;</comment>
                            <comment id="14589455" author="chetanm" created="Wed, 17 Jun 2015 08:07:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;I guess to avoid out of memory, and to give more reasonable results, we should change the highlighter to use a BitField to remember which characters are to be highlighted&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; I am not sure weather we should further invest in SimpleExcerptProvider. Instead we should switch to Lucene based highlighter which should be more feature rich and robust&lt;/p&gt;</comment>
                            <comment id="14589459" author="chetanm" created="Wed, 17 Jun 2015 08:09:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; The patch had a issue with test expectation. I have the updated the patch. Can you try with that&lt;/p&gt;</comment>
                            <comment id="14589704" author="tmueller" created="Wed, 17 Jun 2015 12:31:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3000&quot; title=&quot;SimpleExcerptProvider causes OOM for some wildcard expressions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3000&quot;&gt;&lt;del&gt;OAK-3000&lt;/del&gt;&lt;/a&gt;-b.patch&lt;/p&gt;

&lt;p&gt;This patch fixes all the known issues with the current code. OOM is no longer possible, and highlighting does not break apart if the search text contains pieces of the term &quot;&amp;lt;strong&amp;gt;&quot;. &lt;/p&gt;</comment>
                            <comment id="14589714" author="tmueller" created="Wed, 17 Jun 2015 12:35:50 +0000"  >&lt;p&gt;&amp;gt; I am not sure weather we should further invest in SimpleExcerptProvider&lt;/p&gt;

&lt;p&gt;Well, you already did... I think either we remove the broken code (but I guess that&apos;s not so easy), or we fix it so that it doesn&apos;t break apart with even trivial parameters (for example, highlighting the character &quot;s&quot;).&lt;/p&gt;</comment>
                            <comment id="14589796" author="tmueller" created="Wed, 17 Jun 2015 14:04:12 +0000"  >&lt;p&gt;Integration tests passed with my patch, I will commit it and then backport it (also run integration tests, so this will take some time).&lt;/p&gt;</comment>
                            <comment id="14589801" author="tmueller" created="Wed, 17 Jun 2015 14:09:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://svn.apache.org/r1686015&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1686015&lt;/a&gt; (trunk)&lt;/p&gt;</comment>
                            <comment id="14589857" author="tmueller" created="Wed, 17 Jun 2015 14:37:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://svn.apache.org/r1686021&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1686021&lt;/a&gt; (1.0 branch)&lt;/p&gt;</comment>
                            <comment id="14590091" author="tmueller" created="Wed, 17 Jun 2015 17:00:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://svn.apache.org/r1686076&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1686076&lt;/a&gt; (1.2 branch)&lt;/p&gt;</comment>
                            <comment id="14601179" author="edivad" created="Thu, 25 Jun 2015 13:32:31 +0000"  >&lt;p&gt;Bulk close for 1.3.1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12740099" name="OAK-3000-b.patch" size="6707" author="thomasm" created="Wed, 17 Jun 2015 12:31:31 +0000"/>
                            <attachment id="12740068" name="OAK-3000.patch" size="3460" author="chetanm" created="Wed, 17 Jun 2015 08:09:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 21 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2g507:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>