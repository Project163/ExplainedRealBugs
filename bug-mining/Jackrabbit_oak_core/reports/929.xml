<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:44:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1902] NodeTypeIndex is not conversative enough about its cost</title>
                <link>https://issues.apache.org/jira/browse/OAK-1902</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;NodeTypeIndexProvider derives its cost from PropertyIndexLookup. PropertyIndexLookup has a hardcoded maximum cost (which actually isn&apos;t a maximum cost, but is more the maximum number of nodes which will be read during cost calcuation).&lt;/p&gt;

&lt;p&gt;IMHO, these maximum costs should not be the same. In my experience with JCR-based applications, the number of matches for a particular node type is far greater than the number of matches for a regular property value.&lt;/p&gt;

&lt;p&gt;As a result, I would suggest that if the maximum cost is reached, a greater penalty should be applied to a node type index than a regular property index.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12722337">OAK-1902</key>
            <summary>NodeTypeIndex is not conversative enough about its cost</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="justinedelson">Justin Edelson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Jun 2014 20:48:14 +0000</created>
                <updated>Tue, 8 Oct 2019 15:22:18 +0000</updated>
                            <resolved>Mon, 23 Jun 2014 20:26:43 +0000</resolved>
                                    <version>1.0</version>
                    <version>1.0.1</version>
                                    <fixVersion>1.0.2</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14036786" author="justinedelson" created="Thu, 19 Jun 2014 01:15:40 +0000"  >&lt;p&gt;proposed patch which changes the penalty for node types from 1.1 to 1.6 and also makes it possible to configure this using OSGi configuration.&lt;/p&gt;</comment>
                            <comment id="14037190" author="tmueller" created="Thu, 19 Jun 2014 09:57:59 +0000"  >&lt;p&gt;We should probably ensure that by default, the node type index has a higher cost than a property index with, even for conditions of the type &quot;property is not null&quot;.&lt;/p&gt;

&lt;p&gt;I didn&apos;t fully review the patch yet, but what I read so far it looks good. It would be nice if there are additional tests on the JCR level.&lt;/p&gt;</comment>
                            <comment id="14040640" author="tmueller" created="Mon, 23 Jun 2014 11:26:35 +0000"  >&lt;p&gt;The patch is a bit too large for me to fully review right now.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=justinedelson&quot; class=&quot;user-hover&quot; rel=&quot;justinedelson&quot;&gt;justinedelson&lt;/a&gt;, is it still an issue if /oak:index/nodetype/entryCount is set to a very high value, for example 9223372036854776000?&lt;/p&gt;</comment>
                            <comment id="14040851" author="justinedelson" created="Mon, 23 Jun 2014 15:33:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; I could be wrong, but AFAICT, `entryCount` is not relevant here. That seems to only be used for &quot;is not null&quot; queries, where the `values` set is null. In the case of the nodetype index, `values` will never be null.&lt;/p&gt;</comment>
                            <comment id="14040952" author="tmueller" created="Mon, 23 Jun 2014 16:45:43 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=justinedelson&quot; class=&quot;user-hover&quot; rel=&quot;justinedelson&quot;&gt;justinedelson&lt;/a&gt;. I think the &quot;entryCount&quot; &lt;em&gt;should&lt;/em&gt; be used even if the &quot;values&quot; set is not null. The property index could for example assume there are 10000 values. Or that number could be configurable separately.&lt;/p&gt;

&lt;p&gt;First, I will try to write a test case for that.&lt;/p&gt;</comment>
                            <comment id="14041116" author="tmueller" created="Mon, 23 Jun 2014 18:43:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=justinedelson&quot; class=&quot;user-hover&quot; rel=&quot;justinedelson&quot;&gt;justinedelson&lt;/a&gt;, you are right, &quot;entryCount&quot; is not taken into account if the &quot;values&quot; is not null. I think it needs to be taken into account, and that&apos;s actually more urgent (as it affects property indexes as well). It also results in a smaller patch. I will also add a &quot;keyCount&quot; property so the number of keys can be set manually (default is 10&apos;000).&lt;/p&gt;</comment>
                            <comment id="14041117" author="tmueller" created="Mon, 23 Jun 2014 18:45:05 +0000"  >&lt;p&gt;Smaller patch, using the &quot;entryCount&quot; and (optionally) &quot;keyCount&quot; properties to manually set the cost.&lt;/p&gt;</comment>
                            <comment id="14041133" author="justinedelson" created="Mon, 23 Jun 2014 18:57:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; I&apos;m not seeing where these properties are set. Can you explain where this happens?&lt;/p&gt;</comment>
                            <comment id="14041203" author="tmueller" created="Mon, 23 Jun 2014 19:52:52 +0000"  >&lt;p&gt;(I just found out that the patch is not correct, I&apos;m working on it).&lt;/p&gt;

&lt;p&gt;The property &quot;entryCount&quot; is set for the &quot;nodetype&quot; index to Long.MAX_VALUE in /oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/nodetype/write/InitialContent.java&lt;/p&gt;

&lt;p&gt;The property &quot;keyCount&quot; is currently not used, but I&apos;d like to introduce it, so the number of keys of an index (in addition to the number of entries, which is used for &quot;is not null&quot;) can be set.&lt;/p&gt;</comment>
                            <comment id="14041213" author="tmueller" created="Mon, 23 Jun 2014 19:59:48 +0000"  >&lt;p&gt;New patch, including an improved test case.&lt;/p&gt;</comment>
                            <comment id="14041257" author="tmueller" created="Mon, 23 Jun 2014 20:26:43 +0000"  >&lt;p&gt;Revision 1604926 (trunk)&lt;br/&gt;
Revision 1604927 (1.0 branch)&lt;/p&gt;</comment>
                            <comment id="14041500" author="justinedelson" created="Mon, 23 Jun 2014 23:59:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; Could you explain the logic behind this line:&lt;/p&gt;

&lt;p&gt;&amp;gt; long keyCount = entryCount / 10000;&lt;/p&gt;

&lt;p&gt;Where does the number 10000 here come from?&lt;/p&gt;

&lt;p&gt;(as an aside, this class has a lot of &quot;magic numbers&quot; in it, something my patch tried to at least start to deal with)&lt;/p&gt;</comment>
                            <comment id="14041842" author="tmueller" created="Tue, 24 Jun 2014 08:00:48 +0000"  >&lt;p&gt;Yes, those magic numbers are really bad. Sorry I didn&apos;t document the number. The 10&apos;000 means, by default it is assumed that each key contains 10&apos;000 values. It needs to be about 10&apos;000 so that the nodetype index is used but not traversal, and a property index and not the nodetype index. Those are all &quot;rules&quot;, which we should avoid. We don&apos;t want a rule-based optimizer, we want a cost-based optimizer. But we can&apos;t actually estimate the cost currently. For that, we really need to solve &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1907&quot; title=&quot;Better cost estimates for traversal, property, and ordered indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1907&quot;&gt;&lt;del&gt;OAK-1907&lt;/del&gt;&lt;/a&gt;, so that the magic numbers, and the manual &quot;entryCount&quot; setting are no longer needed.&lt;/p&gt;

&lt;p&gt;The problem with your patch is that it&apos;s quite large, and didn&apos;t have special (JCR level) test case. Now we do have a test case, and of course we can look at the patch again. Should I create a new issue?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12652028" name="OAK-1902-b.patch" size="5499" author="thomasm" created="Mon, 23 Jun 2014 18:45:05 +0000"/>
                            <attachment id="12652046" name="OAK-1902-c.patch" size="5917" author="thomasm" created="Mon, 23 Jun 2014 19:59:48 +0000"/>
                            <attachment id="12651338" name="OAK-1902.patch" size="27070" author="justinedelson" created="Thu, 19 Jun 2014 01:20:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>400528</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 21 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1wy3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>400623</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>