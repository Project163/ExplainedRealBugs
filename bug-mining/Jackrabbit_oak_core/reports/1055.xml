<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:46:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2249] XPath: Query with mixed full-text, &quot;and&quot;, &quot;or&quot; conditions fails</title>
                <link>https://issues.apache.org/jira/browse/OAK-2249</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;When performing a query like &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        //element(*, test:Asset)[
            (
                jcr:contains(., &apos;summer&apos;)
                or
                jcr:content/metadata/@tags = &apos;namespace:season/summer&apos;
            ) and
                jcr:contains(jcr:content/metadata/@format, &apos;image&apos;)
            ]

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The Lucene/Aggregate returns as well nodes that does not match all the&lt;br/&gt;
criterias.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12752407">OAK-2249</key>
            <summary>XPath: Query with mixed full-text, &quot;and&quot;, &quot;or&quot; conditions fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="edivad">Davide Giannella</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Nov 2014 11:36:23 +0000</created>
                <updated>Fri, 20 Jan 2017 07:45:54 +0000</updated>
                            <resolved>Wed, 5 Nov 2014 15:12:01 +0000</resolved>
                                    <version>1.2</version>
                                    <fixVersion>1.0.9</fixVersion>
                    <fixVersion>1.1.2</fixVersion>
                                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14194467" author="edivad" created="Mon, 3 Nov 2014 11:39:03 +0000"  >&lt;p&gt;Attaching &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12678917/12678917_OAK-2249-test.patch&quot; title=&quot;OAK-2249-test.patch attached to OAK-2249&quot;&gt;OAK-2249-test.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; which reproduce the use case&lt;/p&gt;</comment>
                            <comment id="14194508" author="chetanm" created="Mon, 3 Nov 2014 12:47:06 +0000"  >&lt;p&gt;To check if its a regression due to recent changes done in oak-lucene I tried to run the test with 1.0 branch at rev &lt;a href=&quot;http://svn.apache.org/r1635175&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;1635175&lt;/a&gt; (uptill which Lucene changes done recently were not merged) and it fails there also.&lt;/p&gt;</comment>
                            <comment id="14194534" author="alex.parvulescu" created="Mon, 3 Nov 2014 13:42:21 +0000"  >&lt;p&gt;I ran into an interesting comment in the query engine parts &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;the full-text index can not be used for conditions of the form &quot;contains(a, &apos;x&apos;) or b=123&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;so this might be related more to the query engine rather than lucene+aggregates. can we rename the issue accordingly if this is the case?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/OrImpl.java#L154&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/OrImpl.java#L154&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14194541" author="tmueller" created="Mon, 3 Nov 2014 13:58:44 +0000"  >&lt;p&gt;So far I found one issue (which is not related to the &quot;or&quot;). It might or might not be the reason for the problem. The last condition: &quot;jcr:contains(jcr:content/metadata/@format, &apos;image&apos;)&quot; is internally converted to a filter condition of the form &quot;jcr:contains(jcr:content/metadata/@format, &apos;image&apos;) and @format is not null&quot;. This is not correct, as the path is missing in the last part (it should be &quot;jcr:content/metadata/@format is not null&quot;).&lt;/p&gt;</comment>
                            <comment id="14196192" author="tmueller" created="Tue, 4 Nov 2014 15:08:38 +0000"  >&lt;p&gt;I found a solution, it is to change the XPath-to-SQL converter to also convert full-text queries to union. There is a disadvantage that &quot;contains or contains&quot; queries are also unnecessarily converted to union, but I think that&apos;s not a major issue (anyway multiple Lucene queries are run for aggregation). Queries of the form &quot;contains(., &apos;x OR y&apos;)&quot; are not affected.&lt;/p&gt;

&lt;p&gt;One problem is a jackrabbit-core test that fails now, because the order of nodes is no longer the same: org.apache.jackrabbit.core.query.FulltextQueryTest#testMultipleOrExpressions. I will try to fix the test, but temporarily disable the test.&lt;/p&gt;

&lt;p&gt;There are other related issues: FullTextSearchImpl.restrict ignores the relative path. This is currently not an issue, but should be fixed anyway.&lt;/p&gt;

&lt;p&gt;Some minor related issues: ConcatCursor doesn&apos;t work if the list of cursors is empty. FilterImpl.toString misses a space.&lt;/p&gt;</comment>
                            <comment id="14198478" author="tmueller" created="Wed, 5 Nov 2014 15:11:54 +0000"  >&lt;p&gt;Committed in revision&lt;br/&gt;
1636890, 1636891, 1636892 (trunk)&lt;br/&gt;
1636893, 1636894, 1636895 (1.0 branch)&lt;/p&gt;</comment>
                            <comment id="14200220" author="edivad" created="Thu, 6 Nov 2014 14:30:06 +0000"  >&lt;p&gt;moving to fix 1.1.2 as not released yet.&lt;/p&gt;</comment>
                            <comment id="14204406" author="amitjain" created="Mon, 10 Nov 2014 05:49:42 +0000"  >&lt;p&gt;Bulk close for 1.1.2&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12678917" name="OAK-2249-test.patch" size="5265" author="edivad" created="Mon, 3 Nov 2014 11:39:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21w3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>