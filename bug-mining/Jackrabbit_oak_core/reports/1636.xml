<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:52:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-5528] leaseUpdateThread might be blocked by leaseUpdateCheck</title>
                <link>https://issues.apache.org/jira/browse/OAK-5528</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;&lt;font color=&quot;red&quot;&gt;&lt;br/&gt;
cloned from &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-5446&quot; title=&quot;leaseUpdateThread might be blocked by leaseUpdateCheck&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-5446&quot;&gt;OAK-5446&lt;/a&gt; due to internal JIRA issues&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;Fighting with cluster nodes losing their lease and shutting down oak-core in a cloud environment. For reasons unknown at this point in time, the whole process seems to skip about two minutes of real time.&lt;/p&gt;

&lt;p&gt;This is a situation from which oak currently does not recover. Code analysis shows that &lt;tt&gt;ClusterNodeInfo&lt;/tt&gt; is handed the &lt;tt&gt;LeaseCheckDocumentStoreWrapper&lt;/tt&gt; instance to use as store. This is fatal since any action the &lt;tt&gt;renewLease()&lt;/tt&gt; tries to do will first invoke the &lt;tt&gt;performLeaseCheck()&lt;/tt&gt;. The lease check will, when the &lt;tt&gt;FailureMargin&lt;/tt&gt; is reached, &lt;em&gt;stall the renewLease() thread&lt;/em&gt; for 5 retry attempts and then declare the lease to be lost.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;ClusterNodeInfo&lt;/tt&gt; should instead be using the &quot;real&quot; &lt;tt&gt;DocumentStore&lt;/tt&gt;, not the wrapped one, IMO.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13038191">OAK-5528</key>
            <summary>leaseUpdateThread might be blocked by leaseUpdateCheck</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reschke">Julian Reschke</assignee>
                                    <reporter username="stefan.eissing">Stefan Eissing</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Jan 2017 16:54:53 +0000</created>
                <updated>Tue, 16 Feb 2021 09:52:41 +0000</updated>
                            <resolved>Thu, 26 Jan 2017 17:03:34 +0000</resolved>
                                    <version>1.4</version>
                    <version>1.5.14</version>
                                    <fixVersion>1.4.15</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15840037" author="reschke" created="Thu, 26 Jan 2017 17:00:27 +0000"  >&lt;p&gt;Comments on the original issue&lt;/p&gt;</comment>
                            <comment id="15840041" author="reschke" created="Thu, 26 Jan 2017 17:01:31 +0000"  >&lt;p&gt;Export of original issue&lt;/p&gt;</comment>
                            <comment id="15842862" author="reschke" created="Fri, 27 Jan 2017 13:20:33 +0000"  >&lt;p&gt;FWIW: the coupling of leaseupdate and clusterupdate goes back to Oak 1.0 - so we probably should backport the relevant part of this change all the way back to 1.0.&lt;/p&gt;</comment>
                            <comment id="15936024" author="reschke" created="Wed, 22 Mar 2017 10:26:11 +0000"  >&lt;p&gt;We have this in 1.6 - &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefanegli&quot; class=&quot;user-hover&quot; rel=&quot;stefanegli&quot;&gt;stefanegli&lt;/a&gt; - any concerns about backporting to earlier branches?&lt;/p&gt;</comment>
                            <comment id="15936088" author="egli" created="Wed, 22 Mar 2017 10:39:15 +0000"  >&lt;p&gt;+1 for backporting&lt;/p&gt;</comment>
                            <comment id="15936094" author="mreutegg" created="Wed, 22 Mar 2017 10:44:12 +0000"  >&lt;p&gt;+1 in general. Are they any code dependencies that requires us to backport more changes?&lt;/p&gt;</comment>
                            <comment id="15940216" author="reschke" created="Fri, 24 Mar 2017 12:06:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;Are they any code dependencies that requires us to backport more changes?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good point. Turns out we should backport &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-4859&quot; title=&quot;Warn if lease update is invoked with large delay&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-4859&quot;&gt;&lt;del&gt;OAK-4859&lt;/del&gt;&lt;/a&gt; first; I&apos;ll assume I can go ahead with that as it only affects logging.&lt;/p&gt;

&lt;p&gt;Another tiny conflict is due to &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-4184&quot; title=&quot;DocumentNodeStore and DocumentMK.Builder should allow read-only mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-4184&quot;&gt;&lt;del&gt;OAK-4184&lt;/del&gt;&lt;/a&gt;, which I believe we do not want to backport?&lt;/p&gt;</comment>
                            <comment id="15940338" author="reschke" created="Fri, 24 Mar 2017 13:31:21 +0000"  >&lt;p&gt;trunk: &lt;a href=&quot;http://svn.apache.org/r1780424&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1780424&lt;/a&gt;&lt;br/&gt;
1.4: &lt;a href=&quot;http://svn.apache.org/r1788441&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1788441&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15942763" author="mreutegg" created="Mon, 27 Mar 2017 07:16:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;Another tiny conflict is due to &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-4184&quot; title=&quot;DocumentNodeStore and DocumentMK.Builder should allow read-only mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-4184&quot;&gt;&lt;del&gt;OAK-4184&lt;/del&gt;&lt;/a&gt;, which I believe we do not want to backport?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;d rather not backport. It is a new feature and introduces quite some changes.&lt;/p&gt;</comment>
                            <comment id="15958947" author="edivad" created="Thu, 6 Apr 2017 13:41:32 +0000"  >&lt;p&gt;bulk close 1.4.15&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                            <outwardlinks description="is a clone of">
                                        <issuelink>
            <issuekey id="13034225">OAK-5446</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12863840">OAK-3399</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13038113">OAK-5523</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12849527" name="OAK-5446-jr.diff" size="5044" author="reschke" created="Thu, 26 Jan 2017 16:54:54 +0000"/>
                            <attachment id="12849526" name="OAK-5446.diff" size="3853" author="reschke" created="Thu, 26 Jan 2017 16:54:54 +0000"/>
                            <attachment id="12849528" name="OAK-5446.testcase" size="4062" author="reschke" created="Thu, 26 Jan 2017 16:54:54 +0000"/>
                            <attachment id="12849529" name="OAK-5446.testcase.v3" size="5132" author="reschke" created="Thu, 26 Jan 2017 16:54:54 +0000"/>
                            <attachment id="12849533" name="OAK-5446.xml" size="25498" author="reschke" created="Thu, 26 Jan 2017 17:01:31 +0000"/>
                            <attachment id="12849532" name="[#OAK-5446] leaseUpdateThread might be blocked by leaseUpdateCheck.html" size="39542" author="reschke" created="Thu, 26 Jan 2017 17:00:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>OAK-3270</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 32 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3998n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>