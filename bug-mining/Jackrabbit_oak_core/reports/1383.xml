<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:49:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-3646] Inconsistent read of hierarchy </title>
                <link>https://issues.apache.org/jira/browse/OAK-3646</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;This is similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3388&quot; title=&quot;Inconsistent read in cluster with clock differences&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3388&quot;&gt;&lt;del&gt;OAK-3388&lt;/del&gt;&lt;/a&gt;, but about hierarchy information like which child nodes exist at a given revision of the parent node. This issue only occurs in a cluster.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12913682">OAK-3646</key>
            <summary>Inconsistent read of hierarchy </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="mreutegg">Marcel Reutegger</reporter>
                        <labels>
                            <label>resilience</label>
                    </labels>
                <created>Tue, 17 Nov 2015 12:35:04 +0000</created>
                <updated>Thu, 20 Sep 2018 12:19:54 +0000</updated>
                            <resolved>Thu, 7 Jan 2016 12:48:16 +0000</resolved>
                                    <version>1.0</version>
                    <version>1.2</version>
                                    <fixVersion>1.3.14</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>core</component>
                    <component>documentmk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15008638" author="mreutegg" created="Tue, 17 Nov 2015 13:35:26 +0000"  >&lt;p&gt;Added a test (currently ignored): &lt;a href=&quot;http://svn.apache.org/r1714773&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1714773&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15010950" author="mreutegg" created="Wed, 18 Nov 2015 13:14:08 +0000"  >&lt;p&gt;The issue happens when revisions of a change are purged from the RevisionComparator and the order of two revisions changes. With the revision comparator and delayed visibility of changes from other cluster nodes it frequently happens that a local revision L happens before a foreign revision F even though timestamp(F) &amp;lt; timestamp(L). The RevisionComparator maintains this visibility information for revisions no older than one hour.&lt;/p&gt;

&lt;p&gt;I think the only viable solution is to add this information to the &apos;readRevision&apos; of a node state. Right now a node state is identified by a path and a revision. In addition the key must also include the most recent visible revision from other cluster nodes. This way the information of the RevisionComparator is captured in the key and will survive the RevisionComparator purge.&lt;/p&gt;</comment>
                            <comment id="15011126" author="mreutegg" created="Wed, 18 Nov 2015 14:55:17 +0000"  >&lt;p&gt;Added another test similar to the previous one. This one creates child nodes and does not involve garbage collection: &lt;a href=&quot;http://svn.apache.org/r1715007&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1715007&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15026806" author="mreutegg" created="Wed, 25 Nov 2015 14:01:33 +0000"  >&lt;p&gt;I started to work on a fix that gets rid of the current RevisionComparator. Its use is the primary source of trouble because it does not provide a stable comparison of revisions across cluster nodes. Ordering of revisions with different clusterIds may change when one of the revision timestamps becomes older than one hour.&lt;/p&gt;

&lt;p&gt;As a replacement for the RevisionComparator I&apos;d like to introduce a RevisionVector. This is a replacement for Revision whenever the DocumentNodeStore reads a node state at a given &apos;revision&apos;. Instead of relying on additional information from the RevisionComparator, the RevisionVector already contains the information about what Revisions from other cluster nodes are visible at that time (local revision).&lt;/p&gt;

&lt;p&gt;E.g. given a RevisionVector [r7-0-1, r4-0-2] for the root node state on cluster node 1, this means this cluster nodes sees changes up to r4-0-2 from cluster node 2. Traversing down the tree will update the read revision vector according to _lastRev entries and explicit modifications on the document. Calculating a node state at some read revision vector does not need additional information to decide if a change is visible or not. It simply compares the revision with the revision vector to decide if the revision is visible or not.&lt;/p&gt;</comment>
                            <comment id="15028280" author="tmueller" created="Thu, 26 Nov 2015 06:53:59 +0000"  >&lt;p&gt;That sounds good to me. The RevisionComparator was my idea, and it was a bad idea.&lt;/p&gt;

&lt;p&gt;&amp;gt; It simply compares the revision with the revision vector to decide if the revision is visible or not.&lt;/p&gt;

&lt;p&gt;Correct me if I&apos;m wrong, the algorithm would be: for each revision in the document, get the upper bound revision from the RevisionVector, and compare it.&lt;/p&gt;

&lt;p&gt;Class name: what about RevisionHorizon? If it defines the line of what is visible.&lt;/p&gt;</comment>
                            <comment id="15028698" author="mreutegg" created="Thu, 26 Nov 2015 12:44:34 +0000"  >&lt;p&gt;The name RevisionVector is inspired by &lt;a href=&quot;https://en.wikipedia.org/wiki/Version_vector&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Version Vectors&lt;/a&gt;. A revision vector works very similar to a version vector. The third update rule is a bit different with revision vectors, because a revision is bound to the local clock. In Oak the third rule is implemented by &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3388&quot; title=&quot;Inconsistent read in cluster with clock differences&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3388&quot;&gt;&lt;del&gt;OAK-3388&lt;/del&gt;&lt;/a&gt; where the background read waits until the local clock is passed the most recent reported external _lastRev and the timestamp of the new head revision is therefore newer than the timestamps of the most recent visible external revisions.&lt;/p&gt;</comment>
                            <comment id="15044990" author="mreutegg" created="Mon, 7 Dec 2015 14:04:55 +0000"  >&lt;p&gt;A work-in-progress is available in a github branch: &lt;a href=&quot;https://github.com/mreutegg/jackrabbit-oak/tree/OAK-3646&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mreutegg/jackrabbit-oak/tree/OAK-3646&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15087310" author="mreutegg" created="Thu, 7 Jan 2016 12:48:16 +0000"  >&lt;p&gt;Applied current state of my work on the github branch to trunk: &lt;a href=&quot;http://svn.apache.org/r1723532&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1723532&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15087346" author="chetanm" created="Thu, 7 Jan 2016 13:21:16 +0000"  >&lt;p&gt;The big change finally arrived at the start of new year &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Quite a bit of stuff to go through!&lt;/p&gt;</comment>
                            <comment id="15112152" author="edivad" created="Fri, 22 Jan 2016 09:21:09 +0000"  >&lt;p&gt;Bulk close for 1.3.14&lt;/p&gt;</comment>
                            <comment id="15263723" author="reschke" created="Fri, 29 Apr 2016 08:10:26 +0000"  >&lt;p&gt;This is something that should go into earlier branches as well, right?&lt;/p&gt;</comment>
                            <comment id="15268197" author="mreutegg" created="Tue, 3 May 2016 06:37:45 +0000"  >&lt;p&gt;I&apos;d rather not backport this change. The fix is quite extensive and is therefore not easy to backport.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12916148">OAK-3678</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12937488">OAK-3995</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12932440">OAK-3897</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12984801">OAK-4518</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13006769">OAK-4840</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13131841">OAK-7176</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>OAK-3270</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2oi7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>