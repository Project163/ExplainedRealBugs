<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:43:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1757] Oak eats too many CPU cycles when idle</title>
                <link>https://issues.apache.org/jira/browse/OAK-1757</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;An idle Oak eats roughly 5% of my CPU cycles. &lt;/p&gt;

&lt;p&gt;This is caused by the &lt;tt&gt;Clock&lt;/tt&gt; implementations introduced at &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1575050&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1575050&lt;/a&gt;. Scheduling the fast clock to update its time every millisecond is quite expensive. Substituting for the simple clock reduces idle CPU usage to below 1%. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12709801">OAK-1757</key>
            <summary>Oak eats too many CPU cycles when idle</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mduerig">Michael D&#252;rig</assignee>
                                    <reporter username="mduerig">Michael D&#252;rig</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Apr 2014 16:23:25 +0000</created>
                <updated>Wed, 4 Jun 2014 10:16:50 +0000</updated>
                            <resolved>Thu, 24 Apr 2014 10:33:28 +0000</resolved>
                                                    <fixVersion>1.0</fixVersion>
                                    <component>jcr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13977053" author="jukkaz" created="Tue, 22 Apr 2014 17:00:04 +0000"  >&lt;p&gt;Related comments in &lt;a href=&quot;http://markmail.org/message/jhkvh2masdmvmlz6:&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/message/jhkvh2masdmvmlz6:&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&amp;gt; also, using a background task, that executes every MS is IMO a overhead.&lt;/p&gt;

&lt;p&gt;Yes, but since it&apos;s a background task it won&apos;t block any client code.&lt;br/&gt;
The CPU overhead is also pretty low, much lower than calling the same&lt;br/&gt;
currentTimeMillis()/nanoTime() methods repeatedly in each&lt;br/&gt;
SessionDelegate.perform(). If this overhead does show up in a&lt;br/&gt;
benchmark, reducing the execution frequency should be fine as it would&lt;br/&gt;
only further reduce the accuracy of the gathered timing statistics.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="13977098" author="jukkaz" created="Tue, 22 Apr 2014 17:40:59 +0000"  >&lt;p&gt;On my laptop (2 x i7-3840QM 2.80GHz) the CPU overhead is below 1%, unnoticeable among the background noise of the operating system.&lt;/p&gt;</comment>
                            <comment id="13977441" author="mduerig" created="Tue, 22 Apr 2014 21:13:32 +0000"  >&lt;p&gt;The actual CPU overhead seems to depend on the environment quite a bit. I&apos;ve seen everything between 4% and 10% and now you report 1%. This is confirmed by the fact that I didn&apos;t see much of this using a JVM profiler. Only when falling back to a system profiler on the JVM itself I started seeing the overhead of frequent thread scheduling. &lt;/p&gt;

&lt;p&gt;While I think 1% is certainly acceptable, 10% is IMO not. &lt;/p&gt;

&lt;p&gt;On a more general note the changes from &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1575050&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1575050&lt;/a&gt; are not that helpful for gathering correct sessions statistics. The 1ms resolution of the timer is too low as many of the operations take sub milliseconds to execute. &lt;/p&gt;</comment>
                            <comment id="13977494" author="jukkaz" created="Tue, 22 Apr 2014 21:45:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;The 1ms resolution of the timer is too low as many of the operations take sub milliseconds to execute.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The statistics are in any case aggregated over all session operations, so the granularity of individual measurements is not that significant as long as the average remains correct. That&apos;s also why I wouldn&apos;t mind reducing the clock update frequency from 1000Hz to something like 100Hz or even 50Hz.&lt;/p&gt;</comment>
                            <comment id="13977513" author="mduerig" created="Tue, 22 Apr 2014 21:55:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;so the granularity of individual measurements is not that significant &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I doubt this. This is a quantisation effect, which is inherently non linear. &lt;/p&gt;
</comment>
                            <comment id="13978032" author="mmarth" created="Wed, 23 Apr 2014 09:35:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt;, does&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;reducing the clock update frequency &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;resolve the issue for you?&lt;/p&gt;</comment>
                            <comment id="13978036" author="mduerig" created="Wed, 23 Apr 2014 09:44:59 +0000"  >&lt;p&gt;It reduces CPU load. But it makes the statistics (even more) inaccurate. See my previous comment re. the 1ms resolution. IMO we could as well switch the respective statistics off and rethink our approach here. &lt;/p&gt;</comment>
                            <comment id="13978381" author="jukkaz" created="Wed, 23 Apr 2014 16:16:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;This is a quantisation effect, which is inherently non linear.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right. My assumption here is that the start times of session operations have little correlation with the clock update frequency, which seems like a reasonable thing to assume or at least good enough for the purpose we&apos;re gathering the statistics for. And if the operation start times do correlate with the clock updates, then the measurement error is at most 1ms (or whatever our update frequency is) per operation, which is also still reasonable.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;switch the respective statistics off and rethink our approach here.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That would also work, though the currently collected statistics &lt;em&gt;are&lt;/em&gt; useful so we&apos;d need something that&apos;s at least roughly as good.&lt;/p&gt;</comment>
                            <comment id="13978568" author="jukkaz" created="Wed, 23 Apr 2014 18:23:04 +0000"  >&lt;p&gt;In revision 1589484 I added a &quot;fast.clock.interval&quot; system property that can be used to experiment with alternative update intervals. The default value is still 1ms, but changing that will be straightforward.&lt;/p&gt;</comment>
                            <comment id="13979537" author="mduerig" created="Thu, 24 Apr 2014 10:06:19 +0000"  >&lt;p&gt;Based on that assumption the errors average out over sufficient long time intervals. However, these intervals are 1s as e.g. the &lt;tt&gt;SESSION_WRITE_DURATION&lt;/tt&gt; is reset each second, which might be too short for sufficient accuracy. &lt;/p&gt;</comment>
                            <comment id="13979555" author="mduerig" created="Thu, 24 Apr 2014 10:33:28 +0000"  >&lt;p&gt;Fixed for 1.0 at &lt;a href=&quot;http://svn.apache.org/r1589660&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1589660&lt;/a&gt; by setting the default clock update frequency to 100Hz. This reduces CPU usage from 5% to around 1% on my machine. &lt;/p&gt;

&lt;p&gt;I left the default clock update frequency at 1kHz on the trunk because of the impact on the statistics, which we should address in a follow up issue. &lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1767&quot; title=&quot;Inaccurate values reported by RepositoryStatsMBean&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1767&quot;&gt;&lt;del&gt;OAK-1767&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13979936" author="jukkaz" created="Thu, 24 Apr 2014 16:40:03 +0000"  >&lt;p&gt;A minor update in revision 1589789 (merged to 1.0 in 1589791) removes the public &lt;tt&gt;DEFAULT_FAST_CLOCK_INTERVAL&lt;/tt&gt; constant by making &lt;tt&gt;FAST_CLOCK_INTERVAL&lt;/tt&gt; package-private and using it directly from the test case instead of recomputing the value based on the default.&lt;/p&gt;</comment>
                            <comment id="14017586" author="alex.parvulescu" created="Wed, 4 Jun 2014 10:16:50 +0000"  >&lt;p&gt;bulk close for the 1.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>388123</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 24 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1uuxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>388381</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>