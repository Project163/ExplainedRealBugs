<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:40:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1055] Occasional test failure in ObservationTest.observation()</title>
                <link>https://issues.apache.org/jira/browse/OAK-1055</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The test occasionally fails with&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Failed tests:
observation[1](org.apache.jackrabbit.oak.jcr.observation.ObservationTest):
Unexpected events: [EventImpl{type=8, jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/property&apos;&lt;/span&gt;,
userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;, identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node&apos;&lt;/span&gt;, info={}, date=0,
userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=16,
jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n1/p1&apos;&lt;/span&gt;, userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;,
identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n1&apos;&lt;/span&gt;, info={}, date=0, userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=4, jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n1/p2&apos;&lt;/span&gt;,
userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;, identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n1&apos;&lt;/span&gt;, info={}, date=0,
userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=2, jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n3&apos;&lt;/span&gt;,
userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;, identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n3&apos;&lt;/span&gt;, info={}, date=0,
userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=8,
jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n3/jcr:primaryType&apos;&lt;/span&gt;, userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;,
identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n3&apos;&lt;/span&gt;, info={}, date=0, userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=8, jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n3/p3&apos;&lt;/span&gt;,
userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;, identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n3&apos;&lt;/span&gt;, info={}, date=0,
userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=2, jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/{4}&apos;&lt;/span&gt;,
userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;, identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/{4}&apos;&lt;/span&gt;, info={}, date=0,
userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=8,
jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/{4}/jcr:primaryType&apos;&lt;/span&gt;, userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;,
identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/{4}&apos;&lt;/span&gt;, info={}, date=0, userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=1, jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n2&apos;&lt;/span&gt;,
userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;, identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n2&apos;&lt;/span&gt;, info={}, date=0,
userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=4,
jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n2/jcr:primaryType&apos;&lt;/span&gt;, userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;,
identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n2&apos;&lt;/span&gt;, info={}, date=0, userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=4, jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/property&apos;&lt;/span&gt;,
userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;, identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node&apos;&lt;/span&gt;, info={}, date=0,
userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=16,
jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n1/p1&apos;&lt;/span&gt;, userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;,
identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n1&apos;&lt;/span&gt;, info={}, date=0, userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=8, jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n1/p2&apos;&lt;/span&gt;,
userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;, identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n1&apos;&lt;/span&gt;, info={}, date=0,
userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=2, jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n2&apos;&lt;/span&gt;,
userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;, identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n2&apos;&lt;/span&gt;, info={}, date=0,
userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=8,
jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n2/jcr:primaryType&apos;&lt;/span&gt;, userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;,
identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n2&apos;&lt;/span&gt;, info={}, date=0, userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=1, jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n3&apos;&lt;/span&gt;,
userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;, identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n3&apos;&lt;/span&gt;, info={}, date=0,
userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=4,
jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n3/jcr:primaryType&apos;&lt;/span&gt;, userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;,
identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n3&apos;&lt;/span&gt;, info={}, date=0, userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=4, jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n3/p3&apos;&lt;/span&gt;,
userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;, identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/n3&apos;&lt;/span&gt;, info={}, date=0,
userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=1, jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/{4}&apos;&lt;/span&gt;,
userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;, identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/{4}&apos;&lt;/span&gt;, info={}, date=0,
userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}, EventImpl{type=4,
jcrPath=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/{4}/jcr:primaryType&apos;&lt;/span&gt;, userID=&lt;span class=&quot;code-quote&quot;&gt;&apos;oak:unknown&apos;&lt;/span&gt;,
identifier=&lt;span class=&quot;code-quote&quot;&gt;&apos;/test_node/{4}&apos;&lt;/span&gt;, info={}, date=0, userData=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
external=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As &lt;a href=&quot;http://markmail.org/message/lk3vrrcn5edib73d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;noted before &lt;/a&gt;  having &lt;tt&gt;external=true&lt;/tt&gt; and also the event types indicate that the events are being seen &quot;in reverse&quot; (i.e. reverse diffing of the node states involved). &lt;/p&gt;</description>
                <environment></environment>
        <key id="12671374">OAK-1055</key>
            <summary>Occasional test failure in ObservationTest.observation()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mduerig">Michael D&#252;rig</assignee>
                                    <reporter username="mduerig">Michael D&#252;rig</reporter>
                        <labels>
                            <label>observation</label>
                    </labels>
                <created>Mon, 30 Sep 2013 14:49:11 +0000</created>
                <updated>Wed, 14 Oct 2015 10:37:00 +0000</updated>
                            <resolved>Thu, 17 Oct 2013 10:02:34 +0000</resolved>
                                                    <fixVersion>0.11</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13783088" author="mduerig" created="Tue, 1 Oct 2013 16:15:11 +0000"  >&lt;p&gt;Turns out there is a race condition between reporting internal events (&lt;tt&gt;ChangeDispatche.contentChanged()&lt;/tt&gt;) and polling for external events (&lt;tt&gt;ChangeDispatcher.externalChange()&lt;/tt&gt;): the new root reported by the latter may be older than a new root set previously through the former. This is due to the changes being persisted outside the lock of &lt;tt&gt;ChangeDispatche.contentChanged()&lt;/tt&gt; and thus being visible inside &lt;tt&gt;ChangeDispatcher.externalChange()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;For the time being I think there is no harm in removing the polling for external events. I will open a follow up issue to track this in case we need it. &lt;/p&gt;</comment>
                            <comment id="13783097" author="mduerig" created="Tue, 1 Oct 2013 16:20:13 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1060&quot; title=&quot;Periodically poll for external events&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1060&quot;&gt;&lt;del&gt;OAK-1060&lt;/del&gt;&lt;/a&gt; for the follow up issue. &lt;/p&gt;</comment>
                            <comment id="13783100" author="mduerig" created="Tue, 1 Oct 2013 16:21:36 +0000"  >&lt;p&gt;Fixed at &lt;a href=&quot;http://svn.apache.org/r1528134&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1528134&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13783248" author="mduerig" created="Tue, 1 Oct 2013 19:29:32 +0000"  >&lt;p&gt;Reopening since this is only half way fixed yet. The same race actually exists between concurrent invocations of &lt;tt&gt;PostCommitHook.contentChanged()&lt;/tt&gt;. &lt;/p&gt;</comment>
                            <comment id="13783287" author="mduerig" created="Tue, 1 Oct 2013 20:12:10 +0000"  >&lt;p&gt;In a quick chat with Jukka, we discussed moving the &lt;tt&gt;PostCommitHook&lt;/tt&gt; from being passed as an argument to being owned by the &lt;tt&gt;NodeStore&lt;/tt&gt;. This makes it much easier to specify a contract that requires a linear sequence of node states to be passed to that hook. &lt;/p&gt;</comment>
                            <comment id="13783753" author="mduerig" created="Wed, 2 Oct 2013 08:59:16 +0000"  >&lt;p&gt;At &lt;a href=&quot;http://svn.apache.org/r1528371&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1528371&lt;/a&gt; I committed a temporary work around using explicit synchronisation to ensure &lt;tt&gt;Hook.contentChanged()&lt;/tt&gt; sees a monotone increasing sequence of node states. &lt;/p&gt;</comment>
                            <comment id="13796851" author="mduerig" created="Wed, 16 Oct 2013 14:54:39 +0000"  >&lt;p&gt;At &lt;a href=&quot;http://svn.apache.org/r1532782&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1532782&lt;/a&gt; I removed the &lt;tt&gt;PostCommitHook&lt;/tt&gt; from being passed as an argument to &lt;tt&gt;NodeStore&lt;/tt&gt; methods. Instead the various &lt;tt&gt;NodeStore&lt;/tt&gt; implementations might implement &lt;tt&gt;Observable&lt;/tt&gt; to indicate they support being observed. The actual implementation is delegated to &lt;tt&gt;ChangeDispatcher&lt;/tt&gt; which takes care of listener (un)registration. &lt;tt&gt;NodeStore&lt;/tt&gt; implementations report changes to the underlying persistent store by calling the respective methods on the &lt;tt&gt;ChangeDispatcher&lt;/tt&gt; as follows: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;      NodeState root = store.getRoot();
      branch.rebase();
      changeDispatcher.beforeCommit(root);
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
          NodeState head = branch.getHead();
          branch.merge();
          changeDispatcher.localCommit(head);
      } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
          changeDispatcher.afterCommit(store.getRoot());
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13796868" author="mduerig" created="Wed, 16 Oct 2013 15:09:25 +0000"  >&lt;p&gt;Fixed at &lt;a href=&quot;http://svn.apache.org/r1532782&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1532782&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13828797" author="alex.parvulescu" created="Thu, 21 Nov 2013 10:30:55 +0000"  >&lt;p&gt;bulk close for the 0.11 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>OAK-144</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>351080</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1oj73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>351372</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>