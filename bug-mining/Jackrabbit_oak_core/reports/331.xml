<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:38:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-842] Incorrect interaction of orderable child nodes with permission evaluation</title>
                <link>https://issues.apache.org/jira/browse/OAK-842</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Working on &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-813&quot; title=&quot;Removing a Node if the parent is not accessible&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-813&quot;&gt;&lt;del&gt;OAK-813&lt;/del&gt;&lt;/a&gt; revealed problems with the interaction of the current implementation of orderable nodes and access control:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;TreeImpl#getOrderedChildNames&lt;/tt&gt; returns all child names regardless whether they are accessible in the current session or not. This might cause errors further down the line like exposure of the existence of child nodes.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;TreeImpl.remove&lt;/tt&gt; doesn&apos;t (can&apos;t) update the child order property if the parent is not accessible.&lt;/li&gt;
&lt;/ul&gt;

</description>
                <environment></environment>
        <key id="12649124">OAK-842</key>
            <summary>Incorrect interaction of orderable child nodes with permission evaluation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mduerig">Michael D&#252;rig</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 May 2013 14:55:41 +0000</created>
                <updated>Thu, 27 Feb 2014 09:28:48 +0000</updated>
                            <resolved>Thu, 6 Feb 2014 16:13:18 +0000</resolved>
                                                    <fixVersion>0.17</fixVersion>
                                    <component>core</component>
                    <component>security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13665302" author="mreutegg" created="Thu, 23 May 2013 16:09:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;TreeImpl.remove doesn&apos;t (can&apos;t) update the child order property if the parent is not accessible.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Doesn&apos;t removing a child node require write access to the parent node? At least, that&apos;s what I think is the case in Jackrabbit 2.x.&lt;/p&gt;</comment>
                            <comment id="13665305" author="mduerig" created="Thu, 23 May 2013 16:13:18 +0000"  >&lt;p&gt;Apparently not. See &lt;tt&gt;WriteTest#testRemoveIfReadingParentIsDenied&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="13665323" author="mreutegg" created="Thu, 23 May 2013 16:30:34 +0000"  >&lt;p&gt;Hmm, the way I understand the test is, you do need write access to the parent, but not necessarly read access. Not very intuitive, but it looks like that&apos;s how it should be...&lt;/p&gt;</comment>
                            <comment id="13666731" author="mduerig" created="Fri, 24 May 2013 22:07:13 +0000"  >&lt;p&gt;Yes but in order to update the child order in the parent you need a reference to the parent which means you need to read the parent in the first place. &lt;br/&gt;
Note how this is different from deleting the child node in that test case. There a reference to the parent is not involved. &lt;/p&gt;</comment>
                            <comment id="13679381" author="mreutegg" created="Mon, 10 Jun 2013 08:35:03 +0000"  >&lt;p&gt;This indeed looks quite bad now, after we introduced SecureNodeState. There is&lt;br/&gt;
even more stuff broken than what is now annotated with FIXMEs in the code.&lt;br/&gt;
E.g. TreeImpl#updateChildOrder() assumes it has access to all child nodes&lt;br/&gt;
through the NodeBuilder.&lt;/p&gt;

&lt;p&gt;The only solution I see is to push the child order handling further down.&lt;br/&gt;
Remember the reasons for pushing it down from JCR to Oak? We said the&lt;br/&gt;
property must not be visible because it exposes information, which is&lt;br/&gt;
access controlled and would otherwise leak through. I think the same&lt;br/&gt;
applies here as well. Now that we handle access control on the NodeState&lt;br/&gt;
level, we have to move the child order handling as well.&lt;/p&gt;</comment>
                            <comment id="13679390" author="jukkaz" created="Mon, 10 Jun 2013 08:50:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;E.g. TreeImpl#updateChildOrder() assumes it has access to all child nodes through the NodeBuilder.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We could easily give TreeImpl also the raw NodeBuilder in addition to the SecureNodeBuilder instance. Methods like &lt;tt&gt;updateChildOrder()&lt;/tt&gt; can (/should) use the raw builder as long as they don&apos;t accidentally leak read-protected information to the client.&lt;/p&gt;</comment>
                            <comment id="13679417" author="mreutegg" created="Mon, 10 Jun 2013 10:20:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;We could easily give TreeImpl also the raw NodeBuilder in addition to the SecureNodeBuilder instance.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sounds good to me as well. It wasn&apos;t obvious to me how to get access to the raw NodeBuilder...&lt;/p&gt;</comment>
                            <comment id="13679431" author="jukkaz" created="Mon, 10 Jun 2013 11:11:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;It wasn&apos;t obvious to me how to get access to the raw NodeBuilder...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;tt&gt;RootImpl&lt;/tt&gt; has a reference to the raw root builder. It could pass that to the &lt;tt&gt;TreeImpl&lt;/tt&gt; constructor, so that &lt;tt&gt;TreeImpl&lt;/tt&gt; instances could keep track of both the secure and raw builder of the respective node.&lt;/p&gt;</comment>
                            <comment id="13679489" author="jukkaz" created="Mon, 10 Jun 2013 13:26:11 +0000"  >&lt;p&gt;An interesting alternative: We could declare that all such internal data should always be placed under an &quot;:internal&quot; child node. The normal access control checks wouldn&apos;t apply to it, but &lt;tt&gt;TreeImpl&lt;/tt&gt; and friends would always filter out client access to content under that subtree.&lt;/p&gt;</comment>
                            <comment id="13680326" author="mduerig" created="Tue, 11 Jun 2013 09:17:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;It wasn&apos;t obvious to me how to get access to the raw NodeBuilder...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Probably because this is only available since &lt;a href=&quot;http://svn.apache.org/r1489852&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1489852&lt;/a&gt;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;We could declare that all such internal data should always be placed under an &quot;:internal&quot; child node.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This would be a step towards resolving &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-753&quot; title=&quot;TreeImpl exposes hidden child trees&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-753&quot;&gt;&lt;del&gt;OAK-753&lt;/del&gt;&lt;/a&gt;: all items whose name start with a colon are internal to &lt;tt&gt;NodeState&lt;/tt&gt;. Except for :internal, which is internal to &lt;tt&gt;Tree&lt;/tt&gt;. Sound good to me.&lt;/p&gt;</comment>
                            <comment id="13893373" author="anchela" created="Thu, 6 Feb 2014 14:22:38 +0000"  >&lt;p&gt;i just stumbled over this issue again while working on &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-920&quot; title=&quot;Proper permission handling upon Workspace#copy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-920&quot;&gt;&lt;del&gt;OAK-920&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;to summarize (at least part of) the problem: Tree#getChildren() will for a tree with orderable children will &lt;b&gt;not&lt;/b&gt; filter out the non-accessible child but will instead return tree instances that don&apos;t exist.&lt;/p&gt;</comment>
                            <comment id="13893493" author="anchela" created="Thu, 6 Feb 2014 16:13:18 +0000"  >&lt;p&gt;Revision 1565319&lt;/p&gt;</comment>
                            <comment id="13914269" author="alex.parvulescu" created="Thu, 27 Feb 2014 09:28:48 +0000"  >&lt;p&gt;bulk close for the 0.17.1 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12624004">OAK-527</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>329451</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 38 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ku7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>329786</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>