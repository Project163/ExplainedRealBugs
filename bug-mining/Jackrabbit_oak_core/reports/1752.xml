<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:53:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-6876] IndexDisabler should not use NodeBuilder#isReplaced</title>
                <link>https://issues.apache.org/jira/browse/OAK-6876</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;&lt;tt&gt;IndexDisabler&lt;/tt&gt; currently uses NodeBuilder#isReplaced method to check if &quot;disableIndexesOnNextCycle&quot; is set in current flow or not. This is used to ensure that disabling is not done in same cycle as the one where reindexing was done.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        //Skip disabling for the cycle where reindexing just got completed
        if (idxBuilder.isReplaced(DISABLE_INDEXES_ON_NEXT_CYCLE)){
            return emptyList();
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This method though has issues as it would return true&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;If property is only modified. If property is added then it returns false&lt;/li&gt;
	&lt;li&gt;Even if the property is not added new it may return true if base state is different object. This happens to be case with SegmentNodeStore and not with others&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;As a fix we should check explicitly with base state instead of using this api&lt;/p&gt;</description>
                <environment></environment>
        <key id="13112508">OAK-6876</key>
            <summary>IndexDisabler should not use NodeBuilder#isReplaced</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chetanm">Chetan Mehrotra</assignee>
                                    <reporter username="chetanm">Chetan Mehrotra</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Oct 2017 08:16:01 +0000</created>
                <updated>Mon, 13 Nov 2017 13:55:28 +0000</updated>
                            <resolved>Fri, 27 Oct 2017 08:27:49 +0000</resolved>
                                                    <fixVersion>1.7.11</fixVersion>
                    <fixVersion>1.8.0</fixVersion>
                                    <component>indexing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16221928" author="chetanm" created="Fri, 27 Oct 2017 08:25:38 +0000"  >&lt;p&gt;Testcase below illustrates the difference in behaviour of NodeBuilder#isReplaced with different stores&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Index: oak-it/src/test/java/org/apache/jackrabbit/oak/api/NodeBuilderTest.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
&amp;lt;+&amp;gt;UTF-8
===================================================================
--- oak-it/src/test/java/org/apache/jackrabbit/oak/api/NodeBuilderTest.java	(revision )
+++ oak-it/src/test/java/org/apache/jackrabbit/oak/api/NodeBuilderTest.java	(revision )
@@ -0,0 +1,48 @@
+package org.apache.jackrabbit.oak.api;
+
+import org.apache.jackrabbit.oak.OakBaseTest;
+import org.apache.jackrabbit.oak.fixture.NodeStoreFixture;
+import org.apache.jackrabbit.oak.spi.commit.CommitInfo;
+import org.apache.jackrabbit.oak.spi.commit.EmptyHook;
+import org.apache.jackrabbit.oak.spi.state.NodeBuilder;
+import org.junit.Test;
+
+import static org.junit.Assert.assertFalse;
+
+public class NodeBuilderTest extends OakBaseTest {
+
+    public NodeBuilderTest(NodeStoreFixture fixture) {
+        super(fixture);
+    }
+
+    @Test
+    public void isReplacedBehaviour() throws Exception{
+        NodeBuilder nb = store.getRoot().builder();
+        nb.child(&quot;a&quot;).setProperty(&quot;foo&quot;, &quot;bar&quot;);
+
+        store.merge(nb, EmptyHook.INSTANCE, CommitInfo.EMPTY);
+
+        nb = store.getRoot().builder();
+        nb.child(&quot;a&quot;).child(&quot;b&quot;);
+        assertFalse(nb.getChildNode(&quot;a&quot;).isReplaced(&quot;foo&quot;));
+    }
+}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This test only fails for Segment. For others it passes&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt; Thoughts?&lt;/p&gt;

&lt;p&gt;Update - Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-6877&quot; title=&quot;NodeBuilder#isReplaced behaves incorrectly for SegmentNodeStore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-6877&quot;&gt;&lt;del&gt;OAK-6877&lt;/del&gt;&lt;/a&gt; to track this&lt;/p&gt;</comment>
                            <comment id="16221931" author="chetanm" created="Fri, 27 Oct 2017 08:27:34 +0000"  >&lt;p&gt;Change the logic with 1813481&lt;/p&gt;</comment>
                            <comment id="16249602" author="edivad" created="Mon, 13 Nov 2017 13:55:28 +0000"  >&lt;p&gt;Bulk close 1.7.11&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13112517">OAK-6877</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13108896">OAK-6820</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ls1b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>