<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:41:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1233] IllegalStateException in MergeSortedIterators</title>
                <link>https://issues.apache.org/jira/browse/OAK-1233</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;While running Oak in a two node clutser following exception is seen. It basically comes because the AsynchUpdate tries to update async-status concurrently&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;27.11.2013 17:56:35.507 *ERROR* [pool-5-thread-1] org.apache.sling.commons.scheduler.impl.QuartzScheduler Exception during job execution of org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate@fcf98c2 : com.google.common.util.concurrent.UncheckedExecutionException: java.lang.IllegalStateException: Revisioned values for property 1:/oak:index/async-status: First element of next iterator must be greater than previous iterator
com.google.common.util.concurrent.UncheckedExecutionException: com.google.common.util.concurrent.UncheckedExecutionException: java.lang.IllegalStateException: Revisioned values for property 1:/oak:index/async-status: First element of next iterator must be greater than previous iterator
	at com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2199) ~[na:na]
	at com.google.common.cache.LocalCache.get(LocalCache.java:3932) ~[na:na]
	at com.google.common.cache.LocalCache$LocalManualCache.get(LocalCache.java:4721) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.mongomk.MongoMK.diff(MongoMK.java:165) ~[na:na]
	at org.apache.jackrabbit.oak.kernel.KernelNodeState.compareAgainstBaseState(KernelNodeState.java:481) ~[na:na]
	at org.apache.jackrabbit.oak.spi.commit.EditorDiff.process(EditorDiff.java:52) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate.run(AsyncIndexUpdate.java:103) ~[na:na]
	at org.apache.sling.commons.scheduler.impl.QuartzJobExecutor.execute(QuartzJobExecutor.java:105) ~[org.apache.sling.commons.scheduler:2.4.2]
	at org.quartz.core.JobRunShell.run(JobRunShell.java:207) [org.apache.sling.commons.scheduler:2.4.2]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) [na:1.7.0_40]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_40]
	at java.lang.Thread.run(Thread.java:724) [na:1.7.0_40]
Caused by: com.google.common.util.concurrent.UncheckedExecutionException: java.lang.IllegalStateException: Revisioned values for property 1:/oak:index/async-status: First element of next iterator must be greater than previous iterator
	at com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2199) ~[na:na]
	at com.google.common.cache.LocalCache.get(LocalCache.java:3932) ~[na:na]
	at com.google.common.cache.LocalCache$LocalManualCache.get(LocalCache.java:4721) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.mongomk.MongoNodeStore.getNode(MongoNodeStore.java:507) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.mongomk.MongoMK.diffFewChildren(MongoMK.java:313) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.mongomk.MongoMK.diffImpl(MongoMK.java:229) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.mongomk.MongoMK$1.call(MongoMK.java:168) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.mongomk.MongoMK$1.call(MongoMK.java:165) ~[na:na]
	at com.google.common.cache.LocalCache$LocalManualCache$1.load(LocalCache.java:4724) ~[na:na]
	at com.google.common.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3522) ~[na:na]
	at com.google.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2315) ~[na:na]
	at com.google.common.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2278) ~[na:na]
	at com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2193) ~[na:na]
	... 11 common frames omitted
Caused by: java.lang.IllegalStateException: Revisioned values for property 1:/oak:index/async-status: First element of next iterator must be greater than previous iterator
	at org.apache.jackrabbit.oak.plugins.mongomk.util.MergeSortedIterators.fetchNextIterator(MergeSortedIterators.java:103) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.mongomk.util.MergeSortedIterators.next(MergeSortedIterators.java:85) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.mongomk.NodeDocument.getLatestValue(NodeDocument.java:1041) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.mongomk.NodeDocument.getNodeAtRevision(NodeDocument.java:456) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.mongomk.MongoNodeStore.readNode(MongoNodeStore.java:653) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.mongomk.MongoNodeStore.access$000(MongoNodeStore.java:80) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.mongomk.MongoNodeStore$2.call(MongoNodeStore.java:510) ~[na:na]
	at org.apache.jackrabbit.oak.plugins.mongomk.MongoNodeStore$2.call(MongoNodeStore.java:507) ~[na:na]
	at com.google.common.cache.LocalCache$LocalManualCache$1.load(LocalCache.java:4724) ~[na:na]
	at com.google.common.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3522) ~[na:na]
	at com.google.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2315) ~[na:na]
	at com.google.common.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2278) ~[na:na]
	at com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2193) ~[na:na]
	... 23 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12681562">OAK-1233</key>
            <summary>IllegalStateException in MergeSortedIterators</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="chetanm">Chetan Mehrotra</reporter>
                        <labels>
                            <label>cluster</label>
                    </labels>
                <created>Wed, 27 Nov 2013 12:45:23 +0000</created>
                <updated>Thu, 27 Feb 2014 15:25:45 +0000</updated>
                            <resolved>Thu, 9 Jan 2014 08:50:47 +0000</resolved>
                                    <version>0.12</version>
                                    <fixVersion>0.15</fixVersion>
                                    <component>mongomk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13833881" author="chetanm" created="Wed, 27 Nov 2013 15:42:17 +0000"  >&lt;p&gt;Attached is the dump of revisions found for property &lt;tt&gt;1:/oak:index/async-status&lt;/tt&gt;. There are two files&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;simple.txt - It has the Revision timestamps instead of string. The timestamp are baselined to the minimum time i.e. starts with 0. Helps to see the increase order in terms of time series&lt;/li&gt;
	&lt;li&gt;actual.txt - It has the actual revision strings&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13833883" author="chetanm" created="Wed, 27 Nov 2013 15:47:10 +0000"  >&lt;p&gt;The exception is found for following series of revisions where r14298e4548d-0-1 &amp;gt; r14298e4442a-0-2 or in terms of timestamp 7086361-0-1 &amp;gt; 7082166-0-2&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    final static String[][] TEST_DATA = {
            {
                    &quot;r14298e4442a-0-2&quot;,
                    &quot;r14298e443e5-0-2&quot;,
            },
            {
                    &quot;r14298e4548d-0-1&quot;
            },
    };
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looking for the revisions entries for above timestamps in the attached file show following details&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2:p/oak:index/r14298e45a64-0-2===&amp;gt;7087856
{ &quot;r14298e4442a-0-2&quot; , &quot;r14298e443e5-0-2&quot; , &quot;r14298e43aac-0-2&quot; , &quot;r14298e43a04-0-2&quot; , &quot;r14298e41db8-0-2&quot; ,
 &quot;r14298e40b53-0-2&quot; , &quot;r14298e4094f-0-2&quot; , &quot;r14298e3f701-0-2&quot; , &quot;r14298e3e2fa-0-2&quot; , &quot;r14298e3e23c-0-2&quot; ,
 &quot;r14298e3d83e-0-2&quot; , &quot;r14298e3d7be-0-2&quot; , &quot;r14298e3bc27-0-2&quot; , &quot;r14298e3a9b3-0-2&quot; , &quot;r14298e3a7a7-0-2&quot; ,
 &quot;r14298e3964a-0-2&quot; , &quot;r14298e39420-0-2&quot; , &quot;r14298e382ea-0-2&quot; , &quot;r14298e3809c-0-2&quot; , &quot;r14298e35b02-0-2&quot; ,
 &quot;r14298e35986-0-2&quot; , &quot;r14298e34640-0-2&quot; , &quot;r14298e345fc-0-2&quot; , &quot;r14298e33cb5-0-2&quot; , &quot;r14298e33c29-0-2&quot; ,
 &quot;r14298e320e3-0-2&quot; , &quot;r14298e2f97e-0-2&quot; , &quot;r14298e2d241-0-2&quot; , &quot;r14298e2d0ce-0-2&quot; , &quot;r14298e2bee9-0-2&quot; ,
 &quot;r14298e2aa03-0-2&quot; , &quot;r14298e2a9bc-0-2&quot; , &quot;r14298e29a47-0-2&quot; , &quot;r14298e282ef-0-2&quot; , &quot;r14298e282ac-0-2&quot; ,
 &quot;r14298e2792b-0-2&quot; , &quot;r14298e278a9-0-2&quot; , &quot;r14298e25c8a-0-2&quot; , &quot;r14298e24a23-0-2&quot; ,
},
2:p/oak:index/r14298e4548d-0-1===&amp;gt;7086361
{ &quot;r14298e4548d-0-1&quot; , &quot;r14298e4294d-0-1&quot; , &quot;r14298e41673-0-1&quot; , &quot;r14298e414a7-0-1&quot; , &quot;r14298e402ee-0-1&quot; ,
 &quot;r14298e40120-0-1&quot; , &quot;r14298e3ed95-0-1&quot; , &quot;r14298e3c83f-0-1&quot; , &quot;r14298e3b53b-0-1&quot; , &quot;r14298e3b2fd-0-1&quot; ,
 &quot;r14298e3a1fa-0-1&quot; , &quot;r14298e39f75-0-1&quot; , &quot;r14298e38e00-0-1&quot; , &quot;r14298e38bf0-0-1&quot; , &quot;r14298e37a5b-0-1&quot; ,
 &quot;r14298e37866-0-1&quot; , &quot;r14298e36737-0-1&quot; , &quot;r14298e364dd-0-1&quot; , &quot;r14298e351ee-0-1&quot; , &quot;r14298e35152-0-1&quot; ,
 &quot;r14298e32bdd-0-1&quot; , &quot;r14298e317db-0-1&quot; , &quot;r14298e316be-0-1&quot; , &quot;r14298e30afa-0-1&quot; , &quot;r14298e30a55-0-1&quot; ,
 &quot;r14298e2efac-0-1&quot; , &quot;r14298e2de47-0-1&quot; , &quot;r14298e2dc28-0-1&quot; , &quot;r14298e2caf0-0-1&quot; , &quot;r14298e2c8a0-0-1&quot; ,
 &quot;r14298e2b51a-0-1&quot; , &quot;r14298e2930a-0-1&quot; , &quot;r14298e268b4-0-1&quot; , &quot;r14298e2559f-0-1&quot; , &quot;r14298e2536d-0-1&quot; ,
},
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The corresponding entries in terms of numeric timestamp value&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2:p/oak:index/r14298e45a64-0-2===&amp;gt;7087856
{ &quot;7082166-0-2&quot; , &quot;7082097-0-2&quot; , &quot;7079736-0-2&quot; , &quot;7079568-0-2&quot; , &quot;7072324-0-2&quot; ,
 &quot;7067615-0-2&quot; , &quot;7067099-0-2&quot; , &quot;7062413-0-2&quot; , &quot;7057286-0-2&quot; , &quot;7057096-0-2&quot; ,
 &quot;7054538-0-2&quot; , &quot;7054410-0-2&quot; , &quot;7047347-0-2&quot; , &quot;7042623-0-2&quot; , &quot;7042099-0-2&quot; ,
 &quot;7037654-0-2&quot; , &quot;7037100-0-2&quot; , &quot;7032694-0-2&quot; , &quot;7032104-0-2&quot; , &quot;7022478-0-2&quot; ,
 &quot;7022098-0-2&quot; , &quot;7017164-0-2&quot; , &quot;7017096-0-2&quot; , &quot;7014721-0-2&quot; , &quot;7014581-0-2&quot; ,
 &quot;7007599-0-2&quot; , &quot;6997514-0-2&quot; , &quot;6987469-0-2&quot; , &quot;6987098-0-2&quot; , &quot;6982517-0-2&quot; ,
 &quot;6977167-0-2&quot; , &quot;6977096-0-2&quot; , &quot;6973139-0-2&quot; , &quot;6967163-0-2&quot; , &quot;6967096-0-2&quot; ,
 &quot;6964663-0-2&quot; , &quot;6964533-0-2&quot; , &quot;6957334-0-2&quot; , &quot;6952623-0-2&quot; ,
},
2:p/oak:index/r14298e4548d-0-1===&amp;gt;7086361
{ &quot;7086361-0-1&quot; , &quot;7075289-0-1&quot; , &quot;7070463-0-1&quot; , &quot;7070003-0-1&quot; , &quot;7065466-0-1&quot; ,
 &quot;7065004-0-1&quot; , &quot;7060001-0-1&quot; , &quot;7050443-0-1&quot; , &quot;7045575-0-1&quot; , &quot;7045001-0-1&quot; ,
 &quot;7040646-0-1&quot; , &quot;7040001-0-1&quot; , &quot;7035532-0-1&quot; , &quot;7035004-0-1&quot; , &quot;7030503-0-1&quot; ,
 &quot;7030002-0-1&quot; , &quot;7025603-0-1&quot; , &quot;7025001-0-1&quot; , &quot;7020154-0-1&quot; , &quot;7019998-0-1&quot; ,
 &quot;7010409-0-1&quot; , &quot;7005287-0-1&quot; , &quot;7005002-0-1&quot; , &quot;7001990-0-1&quot; , &quot;7001825-0-1&quot; ,
 &quot;6995000-0-1&quot; , &quot;6990547-0-1&quot; , &quot;6990004-0-1&quot; , &quot;6985596-0-1&quot; , &quot;6985004-0-1&quot; ,
 &quot;6980006-0-1&quot; , &quot;6971286-0-1&quot; , &quot;6960448-0-1&quot; , &quot;6955563-0-1&quot; , &quot;6955001-0-1&quot; ,
},
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13833901" author="chetanm" created="Wed, 27 Nov 2013 16:04:45 +0000"  >&lt;p&gt;First note that higher the numeric value means latest the revision is as the values here are based on zero&lt;/p&gt;

&lt;p&gt;So following things would have happened &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;On C1 document was split at rev r14298e45a64-0-2 (7087856) &lt;b&gt;BUT&lt;/b&gt; the highest revision for property async-status is actually 7082166-0-2&lt;/li&gt;
	&lt;li&gt;On C2 document split was done at r14298e4548d-0-1 and the highest rev is same&lt;/li&gt;
	&lt;li&gt;On Oak side when the previous revision list is sorted in NodeDocument#getPreviousRanges it puts the rev list corresponding to r14298e45a64 &lt;b&gt;before&lt;/b&gt; r14298e4548d. But actual entries within those two list do not confirm to the rule of _first element of the next iterator is greater&lt;br/&gt;
than the first element of the previous iterator_.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So as a fix we probably need to sort the list obtains in NodeDocument.getPrevisiousDocs&lt;/p&gt;</comment>
                            <comment id="13865190" author="mreutegg" created="Wed, 8 Jan 2014 08:15:04 +0000"  >&lt;p&gt;Added (ignored) test in &lt;a href=&quot;http://svn.apache.org/r1556462&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1556462&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13866446" author="mreutegg" created="Thu, 9 Jan 2014 08:50:47 +0000"  >&lt;p&gt;NodeDocument.getPreviousDocs() now returns the docs in the correct order.&lt;/p&gt;

&lt;p&gt;Fixed in &lt;a href=&quot;http://svn.apache.org/r1556761&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1556761&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13882701" author="alex.parvulescu" created="Mon, 27 Jan 2014 09:38:43 +0000"  >&lt;p&gt;bulk close for the 0.15 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="12697726">OAK-1479</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12680250">OAK-1204</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12616063" name="revisions.tar.gz" size="78447" author="chetanm" created="Wed, 27 Nov 2013 15:42:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>360826</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1q787:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>361125</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>