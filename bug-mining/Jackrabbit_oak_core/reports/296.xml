<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:37:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-766] TreeImpl#*Location: unable retrieve child location if access to parent is denied</title>
                <link>https://issues.apache.org/jira/browse/OAK-766</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;as a consequence of &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-709&quot; title=&quot;Consider moving permission evaluation to the node state level&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-709&quot;&gt;&lt;del&gt;OAK-709&lt;/del&gt;&lt;/a&gt; we now have an issue with the way&lt;br/&gt;
SessionDelegate and Root#getLocation access a node in the hierarchy&lt;br/&gt;
which has an ancestor which is not accessible.&lt;/p&gt;

&lt;p&gt;specifically RootImpl#getLocation will be served a NullLocation for the&lt;br/&gt;
first ancestor which is not accessible and consequently any accessible&lt;br/&gt;
child node cannot be accessed.&lt;/p&gt;

&lt;p&gt;in order to reproduce the issue you may:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;change AccessControlConfigurationImpl to use PermissionProviderImpl instead&lt;br/&gt;
  of the tmp solution&lt;/li&gt;
	&lt;li&gt;and run o.a.j.oak.jcr.security.authorization.ReadTest#testReadDenied&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12641627">OAK-766</key>
            <summary>TreeImpl#*Location: unable retrieve child location if access to parent is denied</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mduerig">Michael D&#252;rig</assignee>
                                    <reporter username="angela">Angela Schreiber</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Apr 2013 14:21:59 +0000</created>
                <updated>Tue, 21 May 2013 11:18:36 +0000</updated>
                            <resolved>Thu, 2 May 2013 15:39:37 +0000</resolved>
                                                    <fixVersion>0.7</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13627698" author="mduerig" created="Wed, 10 Apr 2013 11:46:45 +0000"  >&lt;p&gt;&lt;tt&gt;TreeLocation&lt;/tt&gt; was introduced to separate tree navigability from access control on the tree level. &lt;br/&gt;
If we move permission evaluation to the node state level, we should IMO get rid of &lt;tt&gt;TreeLocation&lt;/tt&gt; and its implementations. Instead we should leverage / extend the concept of iterability and existence of node states to meet the specific requirements here.&lt;/p&gt;
</comment>
                            <comment id="13627706" author="asanso" created="Wed, 10 Apr 2013 12:02:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt; what about the Root#getTree method though? &lt;br/&gt;
Currently has the same issue than the Root#getLocation.&lt;/p&gt;</comment>
                            <comment id="13627713" author="anchela" created="Wed, 10 Apr 2013 12:09:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt; the problem is that there is no way on the OAK api to navigate to a property if access&lt;br/&gt;
to the parent is not allowed. therefore it doesn&apos;t help dropping the TreeLocation if we don&apos;t&lt;br/&gt;
add an equivalent on the oak-api. this could be any of:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Root#getProperty(String absPath) in addition to the existing Root#getTree(absPath)&lt;/li&gt;
	&lt;li&gt;Tree#getProperty(String relativePath) and Tree#getTree(String relativePath)&lt;/li&gt;
	&lt;li&gt;...&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;i don&apos;t care too much how we make that available as long as we have it available&lt;br/&gt;
and respect our security requirements that a tree is not accessible if the corresponding&lt;br/&gt;
Node isn&apos;t.&lt;/p&gt;
</comment>
                            <comment id="13627719" author="asanso" created="Wed, 10 Apr 2013 12:16:29 +0000"  >&lt;p&gt;Attaching test case for oak-core that shows the issue.&lt;/p&gt;

&lt;p&gt;This will work when will be changed the AccessControlConfigurationImpl to use PermissionProviderImpl instead&lt;br/&gt;
of the tmp solution.&lt;/p&gt;</comment>
                            <comment id="13627767" author="mduerig" created="Wed, 10 Apr 2013 13:13:44 +0000"  >&lt;p&gt;This is caused by &lt;tt&gt;TreeImpl.internalGetChild&lt;/tt&gt; and &lt;tt&gt;TreeImpl.internalGetProperty&lt;/tt&gt; not seeing items any more due to access control being enforced at the underlying node state. &lt;/p&gt;</comment>
                            <comment id="13627780" author="mduerig" created="Wed, 10 Apr 2013 13:29:39 +0000"  >&lt;p&gt;I suggest to conceptually solve this in the same way it is done with &lt;tt&gt;NodeState&lt;/tt&gt;. That is adding the concept of iterability and existence to trees. This way you could navigate through a &quot;non existing&quot; tree to a child tree of a given name. &lt;/p&gt;

&lt;p&gt;Implementation wise this means however that we need to adjust node builder implementations to support this. See &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-781&quot; title=&quot;Clarify / fix effects of MISSING_NODE as base state of NodeBuilder&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-781&quot;&gt;&lt;del&gt;OAK-781&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13630023" author="anchela" created="Fri, 12 Apr 2013 12:50:21 +0000"  >&lt;p&gt;thanks a lot for the tests!&lt;br/&gt;
i added additional tests to also cover properties and committed it at revision 1467254 (including proper teardown in the base test class).&lt;/p&gt;</comment>
                            <comment id="13633972" author="anchela" created="Wed, 17 Apr 2013 12:13:57 +0000"  >&lt;p&gt;another possibility was to drop the SecureNodeState and check accessibility on TreeImpl.&lt;br/&gt;
in other words: let the TreeLocation operate on the un-checked NodeState and only perform&lt;br/&gt;
check for accessibility once the Tree/Property is really accessed.&lt;/p&gt;

&lt;p&gt;IMO we currently perform far to much accessibility checks while accessing items &lt;br/&gt;
in the hierarchy. for admin we can optimize this but for all regular users that&lt;br/&gt;
don&apos;t have read-access in the complete subtree this will lead to extra evaluation.&lt;/p&gt;</comment>
                            <comment id="13633977" author="jukkaz" created="Wed, 17 Apr 2013 12:21:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;another possibility was to drop the SecureNodeState and check accessibility on TreeImpl. in other words: let the TreeLocation operate on the un-checked NodeState and only perform check for accessibility once the Tree/Property is really accessed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If I understand correctly, that&apos;s the way Michael&apos;s proposal would also work: the check for accessibility would be done only when the Tree/Property is really accessed. That&apos;s the idea behind the &quot;exists()&quot; mechanism from &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-709&quot; title=&quot;Consider moving permission evaluation to the node state level&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-709&quot;&gt;&lt;del&gt;OAK-709&lt;/del&gt;&lt;/a&gt;; that we can traverse a path one element at a time without having to check for access rights on any of the intermediate nodes.&lt;/p&gt;</comment>
                            <comment id="13633982" author="anchela" created="Wed, 17 Apr 2013 12:28:32 +0000"  >&lt;p&gt;ok... but with the current implementation in &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-709&quot; title=&quot;Consider moving permission evaluation to the node state level&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-709&quot;&gt;&lt;del&gt;OAK-709&lt;/del&gt;&lt;/a&gt; the read status is calculated also for traversal, isn&apos;t it?&lt;/p&gt;</comment>
                            <comment id="13641888" author="mduerig" created="Thu, 25 Apr 2013 15:19:37 +0000"  >&lt;p&gt;There is a tentative fix for this in revision 1475819. All tests in &lt;tt&gt;evaluation.RootTest&lt;/tt&gt; pass now. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anchela&quot; class=&quot;user-hover&quot; rel=&quot;anchela&quot;&gt;anchela&lt;/a&gt; hopefully this will get you unblocked.&lt;/p&gt;

&lt;p&gt;Since we now (&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-781&quot; title=&quot;Clarify / fix effects of MISSING_NODE as base state of NodeBuilder&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-781&quot;&gt;&lt;del&gt;OAK-781&lt;/del&gt;&lt;/a&gt;) have the iterability end existence concept in the &lt;tt&gt;NodeBuilder&lt;/tt&gt; there are a couple of indirection to many in &lt;tt&gt;Tree&lt;/tt&gt; and &lt;tt&gt;TreeLocation&lt;/tt&gt;. Once &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-781&quot; title=&quot;Clarify / fix effects of MISSING_NODE as base state of NodeBuilder&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-781&quot;&gt;&lt;del&gt;OAK-781&lt;/del&gt;&lt;/a&gt; has stabilised I&apos;d like to address those and come up with a proper fix for this issue. So let&apos;s keep it open until then.&lt;/p&gt;</comment>
                            <comment id="13647636" author="mduerig" created="Thu, 2 May 2013 15:39:37 +0000"  >&lt;p&gt;This is now fixed with the changes from &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-798&quot; title=&quot;Review / refactor TreeImpl and related classes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-798&quot;&gt;&lt;del&gt;OAK-798&lt;/del&gt;&lt;/a&gt; at revision 1478403&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12637935">OAK-709</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12642905">OAK-781</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12644792">OAK-798</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12577992" name="OAK-766-patch.txt" size="9207" author="asanso" created="Wed, 10 Apr 2013 12:16:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>322043</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 29 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jkbr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>322388</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>