<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:43:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1076] XPath failures for typed properties</title>
                <link>https://issues.apache.org/jira/browse/OAK-1076</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;It looks like there are some failures in xpath queries that expect a match only on properties of a certain type (which is to be inferred from the query)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12672127">OAK-1076</key>
            <summary>XPath failures for typed properties</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="stillalex">Alex Deparvu</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Oct 2013 12:35:14 +0000</created>
                <updated>Tue, 8 Oct 2019 15:22:03 +0000</updated>
                            <resolved>Wed, 16 Apr 2014 12:27:53 +0000</resolved>
                                                    <fixVersion>1.0</fixVersion>
                                    <component>core</component>
                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13785041" author="alex.parvulescu" created="Thu, 3 Oct 2013 12:36:50 +0000"  >&lt;p&gt;attaching test case&lt;/p&gt;</comment>
                            <comment id="13965630" author="alex.parvulescu" created="Thu, 10 Apr 2014 18:07:36 +0000"  >&lt;p&gt;This is now about wildcards in the property constraint.&lt;/p&gt;

&lt;p&gt;If given a query like the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;/&lt;span class=&quot;code-comment&quot;&gt;/*[(*/&lt;/span&gt;@prop &amp;gt; 1)]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the query engine will transform the PropertyValue it into a multi property string and fallback to comparing strings instead of numerals.&lt;/p&gt;

&lt;p&gt;I&apos;m attaching a patch to address some of the issues around properly typing the value used to compare against, but looking at the way the current code works, it will not be possible to match on wildcards without transforming to string in some cases (left a TODO in the code).&lt;/p&gt;

&lt;p&gt;What I fixed is:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;in the case there is a single property match, return it with the initial type, if there are more than one properties, they will be merged into a multi-valued string property (old mechanism)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fixed an issue with the wildcard match in the case of a constraint of type &lt;em&gt;*/name&lt;/em&gt; where the query engine will return the good node (the parent) but also the child node that had the property.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; feedback needed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="13968176" author="tmueller" created="Mon, 14 Apr 2014 08:52:30 +0000"  >&lt;p&gt;I will need to debug this.&lt;/p&gt;

&lt;p&gt;Notes for self (not related to you comment or to your patch): the XPath query is converted to SQL-2, and then the filter is created from that as follows. The type (long) is preserved in the condition and filter.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;xpath2sql //*[(*/@prop &amp;gt; 1)]
select [jcr:path], [jcr:score], * from [nt:base] as a where [*/prop] &amp;gt; 1

explain select [jcr:path], [jcr:score], * from [nt:base] as a where [*/prop] &amp;gt; 1
[nt:base] as [a] /* traverse &quot;*&quot; where [a].[*/prop] &amp;gt; cast(&apos;1&apos; as long) */
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13969519" author="tmueller" created="Tue, 15 Apr 2014 13:08:24 +0000"  >&lt;p&gt;The patch looks good to me. I&apos;m currently writing more test cases, and I try to address the remaining TODO in the code (support for mixed type properties). It should be ready tomorrow.&lt;/p&gt;</comment>
                            <comment id="13969573" author="tmueller" created="Tue, 15 Apr 2014 14:16:54 +0000"  >&lt;p&gt;Slightly improved patch (not fully tested yet) - &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alex.parvulescu&quot; class=&quot;user-hover&quot; rel=&quot;alex.parvulescu&quot;&gt;alex.parvulescu&lt;/a&gt;, could you have a look please? I mainly changed SelectorImpl, support for data types other than String.&lt;/p&gt;</comment>
                            <comment id="13970613" author="tmueller" created="Wed, 16 Apr 2014 09:43:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alex.parvulescu&quot; class=&quot;user-hover&quot; rel=&quot;alex.parvulescu&quot;&gt;alex.parvulescu&lt;/a&gt;, please commit my patch or assign the issue back to me after you have reviewed it. Or if you don&apos;t have time to review, then also assign back to me.&lt;/p&gt;</comment>
                            <comment id="13970617" author="alex.parvulescu" created="Wed, 16 Apr 2014 09:52:35 +0000"  >&lt;p&gt;+1 for the patch, I think it looks good!&lt;/p&gt;</comment>
                            <comment id="13970724" author="tmueller" created="Wed, 16 Apr 2014 12:27:35 +0000"  >&lt;p&gt;Thanks Alex!&lt;/p&gt;

&lt;p&gt;Revision 1587882 (trunk)&lt;br/&gt;
Revision 1587890 (1.0 branch)&lt;/p&gt;</comment>
                            <comment id="13971700" author="jukkaz" created="Wed, 16 Apr 2014 17:31:43 +0000"  >&lt;p&gt;The &lt;tt&gt;testMultipleRelativeProperties()&lt;/tt&gt; test case fails on Java 8, most likely because child node ordering seems to affect the evaluation of the &lt;tt&gt;*/property&lt;/tt&gt; constraints (it shouldn&apos;t).&lt;/p&gt;</comment>
                            <comment id="13971742" author="jukkaz" created="Wed, 16 Apr 2014 18:00:15 +0000"  >&lt;p&gt;The attached patch fixes the evaluation of this and other multivalued comparisons.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure which one is the better approach here:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Apply the patch now for 1.0, even though it (correctly, I&apos;d argue) changes how some query constraints are evaluated and thus could have impact on existing clients.&lt;/li&gt;
	&lt;li&gt;File a new issue for this and mark it as a known issue for 1.0. Just disable the troublesome test case in 1.0 to allow the build to pass on Java 8.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="13971746" author="alex.parvulescu" created="Wed, 16 Apr 2014 18:03:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;File a new issue for this and mark it as a known issue for 1.0. Just disable the troublesome test case in 1.0 to allow the build to pass on Java 8.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1 we should not take out the fix.&lt;/p&gt;</comment>
                            <comment id="13971832" author="jukkaz" created="Wed, 16 Apr 2014 19:17:31 +0000"  >&lt;p&gt;OK, thanks for chiming in. I filed &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1739&quot; title=&quot;Incorrect handling of multivalued comparisons in queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1739&quot;&gt;&lt;del&gt;OAK-1739&lt;/del&gt;&lt;/a&gt; as the followup issue and disabled the troublesome test case for now both in trunk and in 1.0.&lt;/p&gt;</comment>
                            <comment id="14017559" author="alex.parvulescu" created="Wed, 4 Jun 2014 10:16:44 +0000"  >&lt;p&gt;bulk close for the 1.0 release&lt;/p&gt;</comment>
                            <comment id="14052442" author="alexander.klimetschek" created="Fri, 4 Jul 2014 13:31:23 +0000"  >&lt;p&gt;I still see the original problem that lead to the creation of this and &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1739&quot; title=&quot;Incorrect handling of multivalued comparisons in queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1739&quot;&gt;&lt;del&gt;OAK-1739&lt;/del&gt;&lt;/a&gt; with oak 1.0.0 and 1.0.1. Searching for ranges with &quot;&amp;gt;&quot; and &quot;&amp;lt;&quot; and a long literal finds double and decimal values in JCR as well. Similarly for double literals finding long &amp;amp; decimal, and both for multi-value as well. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12708873">OAK-1739</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12678932">OAK-1171</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12640511" name="0001-OAK-1076-XPath-failures-for-typed-properties.patch" size="4401" author="jukkaz" created="Wed, 16 Apr 2014 18:00:15 +0000"/>
                            <attachment id="12640276" name="OAK-1076-b.patch" size="9135" author="thomasm" created="Tue, 15 Apr 2014 14:16:54 +0000"/>
                            <attachment id="12639616" name="OAK-1076.patch" size="5347" author="stillalex" created="Thu, 10 Apr 2014 18:07:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>351753</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 20 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1onbj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352041</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>