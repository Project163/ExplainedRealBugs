<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:38:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-822] TypeEditor: Missing validation for mandatory items</title>
                <link>https://issues.apache.org/jira/browse/OAK-822</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Within TypeEditor#leave we check if there are missing mandatory items. &lt;br/&gt;
However, the validation is currently insufficient as it only checks if&lt;br/&gt;
items with the required names are present.&lt;/p&gt;

&lt;p&gt;for example:&lt;br/&gt;
a referenceable unstructured node that as a multivalued boolean &lt;br/&gt;
property named &quot;jcr:uuid&quot; would pass the validation even though that &lt;br/&gt;
property is not the jcr:uuid property defined by &quot;mix:referenceable&quot; &lt;br/&gt;
but rather a residual property which by coincidence has the same name.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12647725">OAK-822</key>
            <summary>TypeEditor: Missing validation for mandatory items</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="angela">Angela Schreiber</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 May 2013 11:27:17 +0000</created>
                <updated>Wed, 4 Jun 2014 09:00:48 +0000</updated>
                            <resolved>Fri, 17 May 2013 13:19:15 +0000</resolved>
                                                    <fixVersion>0.8</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13658256" author="jukkaz" created="Wed, 15 May 2013 11:37:36 +0000"  >&lt;p&gt;The validation is actually there, but due to a backwards compatibility issue with Jackrabbit, the validator in the described case would actually ends up choosing the residual undefined multi-valued property definition instead of the named jcr:uuid one. See &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-713&quot; title=&quot;Automatic property type conversion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-713&quot;&gt;&lt;del&gt;OAK-713&lt;/del&gt;&lt;/a&gt; for related discussion and a proposed solution.&lt;/p&gt;

&lt;p&gt;For the specific case of mandatory items I think we could force the validator to never fall back on residual item definitions, which should solve this issue already before we come to a better consensus on what to do in &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-713&quot; title=&quot;Automatic property type conversion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-713&quot;&gt;&lt;del&gt;OAK-713&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13658269" author="anchela" created="Wed, 15 May 2013 11:51:32 +0000"  >&lt;p&gt;really? at a first glance i saw that the method called for that matter (EffectiveType#findMissingMandatoryItems) only checks if the a property/node with the&lt;br/&gt;
mandatory name is present.&lt;/p&gt;

&lt;p&gt;i will provide a test case as soon as i am sure that i didn&apos;t break something.&lt;/p&gt;</comment>
                            <comment id="13658275" author="jukkaz" created="Wed, 15 May 2013 12:02:31 +0000"  >&lt;p&gt;Yes. The validation of items is done in the relevant &lt;tt&gt;propertyAdded()&lt;/tt&gt;, etc. methods. The &lt;tt&gt;leave()&lt;/tt&gt; method just checks that after whatever changes were made, the mandatory items are in place. This way we don&apos;t have to re-validate the types and contents of all mandatory items whenever there are any changes to a node.&lt;/p&gt;

&lt;p&gt;An even better way to do this would be to check the presence of all mandatory items in the &lt;tt&gt;childNodeAdded()&lt;/tt&gt; method when a node is first added, and then in &lt;tt&gt;propertyDeleted()&lt;/tt&gt; check that mandatory items are never removed. See the related TODO in &lt;tt&gt;enter()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;+1 to a test case &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13658284" author="anchela" created="Wed, 15 May 2013 12:13:36 +0000"  >&lt;p&gt;agreed... another alternative was to collected added/removed mandatory items as we look at the&lt;br/&gt;
definition in the various methods like propertyAdded and so forth and then pass this list to&lt;br/&gt;
EffectiveType#findMissingMandatoryItems.&lt;/p&gt;

&lt;p&gt;the initial test will just cover jcr:uuid (as i was working on &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-796&quot; title=&quot;PermissionValidator: proper check for jcr:uuid modifications.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-796&quot;&gt;&lt;del&gt;OAK-796&lt;/del&gt;&lt;/a&gt;)... but we should have&lt;br/&gt;
tests for mandatory nodes as well. probably we have to create custom node types for that.&lt;/p&gt;</comment>
                            <comment id="13658291" author="anchela" created="Wed, 15 May 2013 12:18:19 +0000"  >&lt;p&gt;test for jcr:uuid property that is a boolean property underneath an nt:unstructured node&lt;br/&gt;
committed at revision 1482783.&lt;/p&gt;</comment>
                            <comment id="13659420" author="jukkaz" created="Thu, 16 May 2013 10:32:43 +0000"  >&lt;p&gt;Fixed the above-mentioned specific case in revision 1483293.&lt;/p&gt;</comment>
                            <comment id="13660700" author="jukkaz" created="Fri, 17 May 2013 13:19:15 +0000"  >&lt;p&gt;I implemented the other mentioned improvements in followup commits and added a few extra unit tests. I guess we&apos;re done here, so resolving as fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328081</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1kltz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328425</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>