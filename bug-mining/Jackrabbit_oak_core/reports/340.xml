<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:38:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-851] Slowness while traversing a tree</title>
                <link>https://issues.apache.org/jira/browse/OAK-851</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;I have done some simple test on tree traversal and it seems that is really slow (specially compared with the Jackrabbit case).&lt;/p&gt;

&lt;p&gt;My scenario is a bit artificial but not so far away from reality.&lt;br/&gt;
I have a tree with a depth of 100 and I have tried to traverse it from root to leaf.&lt;/p&gt;

&lt;p&gt;This is the performance of oak&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;GetNodesTest                   min     10%     50%     90%     max       N&lt;br/&gt;
Oak-Memory                       980     999    1073    1160    1189      14&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;while Jackrabbit gives me &lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;GetNodesTest                   min     10%     50%     90%     max       N&lt;br/&gt;
Jackrabbit                         0       1       1       2      40   10187&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;As you see the performance difference is quite substantial.&lt;/p&gt;

&lt;p&gt;I have tried to nail down the source of sloweness but I could not find it. It seems more that the culprit is the huge amount of call to TreeImpl#reconnect.&lt;/p&gt;

&lt;p&gt;Just for completeness I have done a test on accessing directly the leaf rather than traverse and the performance are quite good (still not great though)....&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;GetNodesTest                   min     10%     50%     90%     max       N&lt;br/&gt;
Oak-Memory                        15      16      17      22      53     817&lt;/li&gt;
&lt;/ol&gt;


</description>
                <environment></environment>
        <key id="12650113">OAK-851</key>
            <summary>Slowness while traversing a tree</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="asanso">Antonio Sanso</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 May 2013 09:50:24 +0000</created>
                <updated>Fri, 20 Sep 2013 07:01:32 +0000</updated>
                            <resolved>Thu, 6 Jun 2013 17:06:14 +0000</resolved>
                                                    <fixVersion>0.9</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13670185" author="asanso" created="Thu, 30 May 2013 09:51:20 +0000"  >&lt;p&gt;attaching test case&lt;/p&gt;</comment>
                            <comment id="13670187" author="asanso" created="Thu, 30 May 2013 09:58:37 +0000"  >&lt;p&gt;attaching right test class&lt;/p&gt;</comment>
                            <comment id="13670194" author="jukkaz" created="Thu, 30 May 2013 10:06:52 +0000"  >&lt;p&gt;This is the same underlying issue I&apos;m referring to in &lt;a href=&quot;http://markmail.org/message/v2ydm5xksd25glm4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/message/v2ydm5xksd25glm4&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;m not exactly sure if reconnect() is just a leftover from the time when NodeBuilders couldn&apos;t properly track state across rebase/reset operations, or if it&apos;s needed for the transient move tracking discussed in &lt;a href=&quot;http://markmail.org/message/b6dcyae362akyogd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/message/b6dcyae362akyogd&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;If former, we should be able to drop the method entirely. If latter, it should be possible to execute the method only after a transient moves has occurred.&lt;/p&gt;</comment>
                            <comment id="13670197" author="mreutegg" created="Thu, 30 May 2013 10:14:08 +0000"  >&lt;p&gt;&amp;gt; execute the method only after a transient moves has occurred&lt;/p&gt;

&lt;p&gt;A while ago I noticed this as well and tried the attached changes. With the test I had in place (importing content) the speed up wasn&apos;t huge, but might be interesting to see how numbers change with Antonios test.&lt;/p&gt;</comment>
                            <comment id="13670202" author="mduerig" created="Thu, 30 May 2013 10:20:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;If former, we should be able to drop the method entirely...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s more of the latter (&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-664&quot; title=&quot;Track Tree instance across moves&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-664&quot;&gt;&lt;del&gt;OAK-664&lt;/del&gt;&lt;/a&gt;) combined with the requirements introduced by the former (&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-690&quot; title=&quot;Enforce and clarify Root contract wrt. invalid Tree instances&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-690&quot;&gt;&lt;del&gt;OAK-690&lt;/del&gt;&lt;/a&gt;). As Jukka mentioned, we should be able to optimise this case and avoid calls to &lt;tt&gt;reconnect()&lt;/tt&gt; when there was no move. &lt;/p&gt;</comment>
                            <comment id="13670208" author="asanso" created="Thu, 30 May 2013 10:22:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt;wow I am impressed.&lt;/p&gt;

&lt;p&gt;Test with patch applied&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;GetNodesTest                   min     10%     50%     90%     max       N&lt;br/&gt;
Oak-Memory                         7       7       8      11      80    1705&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13670226" author="mduerig" created="Thu, 30 May 2013 10:50:08 +0000"  >&lt;p&gt;Applied Marcel&apos;s patch at revison 1487812. Thanks, this was exactly what I had in mind.&lt;/p&gt;</comment>
                            <comment id="13677244" author="jukkaz" created="Thu, 6 Jun 2013 17:06:14 +0000"  >&lt;p&gt;Looks like we can mark this as resolved as the main bottleneck is gone.&lt;/p&gt;</comment>
                            <comment id="13772738" author="alex.parvulescu" created="Fri, 20 Sep 2013 07:01:32 +0000"  >&lt;p&gt;Bulk close for the 0.9 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12585387" name="GetNodesTest.java" size="2617" author="asanso" created="Thu, 30 May 2013 09:58:37 +0000"/>
                            <attachment id="12585390" name="less-reconnects.patch" size="1211" author="mreutegg" created="Thu, 30 May 2013 10:14:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>330440</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1l0b3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>330774</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>