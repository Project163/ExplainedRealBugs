<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:50:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-3672] discovery-lite should not set (cluster)Id for tarMk and mongoMk (was: SegmentDiscoveryLiteService does not persist clusterView.id)</title>
                <link>https://issues.apache.org/jira/browse/OAK-3672</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The discovery-lite-descriptor introduced with &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2844&quot; title=&quot;Introducing a simple document-based discovery-light service (to circumvent documentMk&amp;#39;s eventual consistency delays)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2844&quot;&gt;&lt;del&gt;OAK-2844&lt;/del&gt;&lt;/a&gt; has a property &lt;tt&gt;id&lt;/tt&gt; that uniquely and persistently identifies a cluster. However, the &lt;tt&gt;SegmentDiscoveryLiteService&lt;/tt&gt; creates this id upon each instance restart (by setting &lt;tt&gt;runtimeClusterId&lt;/tt&gt;).&lt;/p&gt;

&lt;p&gt;This should be fixed to have this &lt;tt&gt;id&lt;/tt&gt; persisted somehow.&lt;/p&gt;

&lt;p&gt;Note that the consequences of this id changing upon each restart is that the corresponding presumed-to-be-persistent &lt;tt&gt;ClusterView.id&lt;/tt&gt; of the discovery.oak will also change upon restart. Which is a violation of the discovery API and upper level applications might thus misbehave in this case.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12915718">OAK-3672</key>
            <summary>discovery-lite should not set (cluster)Id for tarMk and mongoMk (was: SegmentDiscoveryLiteService does not persist clusterView.id)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefanegli">Stefan Egli</assignee>
                                    <reporter username="stefanegli">Stefan Egli</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Nov 2015 08:45:07 +0000</created>
                <updated>Thu, 26 Sep 2019 11:40:55 +0000</updated>
                            <resolved>Mon, 1 Feb 2016 16:23:49 +0000</resolved>
                                    <version>1.3.10</version>
                                    <fixVersion>1.3.15</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>segmentmk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15024074" author="egli" created="Tue, 24 Nov 2015 09:19:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt; as you have originally reported &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-3195&quot; title=&quot;Provide a property to uniquely identify a Cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-3195&quot;&gt;&lt;del&gt;SLING-3195&lt;/del&gt;&lt;/a&gt;, can you please re-state the use cases which require a stable/persisted cluster identifier?&lt;/p&gt;</comment>
                            <comment id="15024095" author="egli" created="Tue, 24 Nov 2015 09:35:19 +0000"  >&lt;p&gt;possible ways to persist the clusterView.id include:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;store a properties file in the file system containing just this id&lt;/li&gt;
	&lt;li&gt;store a hidden property in the repository&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;problem with 1 is cold-standby which would have to propagate this to the standby node too&lt;br/&gt;
problem with 2 is usability when a user copies a repository that id would automatically come with the copy, thus you&apos;d have two clusters with the same id. to avoid this, the user would have to be educated how this could be deleted, which seems non-trivial if the property is stored in the repository&lt;/p&gt;</comment>
                            <comment id="15026200" author="chetanm" created="Wed, 25 Nov 2015 04:57:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;can you please re-state the use cases which require a stable/persisted cluster identifier?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;IIRC the usecase was around using a stable clusterId for issuing cookies. The clusterId was used to ensure that 2 different server running on same system should be able to distinguish the cookies issues by them. Also even after restart older cookies are honoured &lt;/p&gt;</comment>
                            <comment id="15026459" author="egli" created="Wed, 25 Nov 2015 09:05:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=asanso&quot; class=&quot;user-hover&quot; rel=&quot;asanso&quot;&gt;asanso&lt;/a&gt;, from your point of view though we no longer need the stable clusterId for the cookies, right?&lt;/p&gt;</comment>
                            <comment id="15026464" author="asanso" created="Wed, 25 Nov 2015 09:09:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefanegli&quot; class=&quot;user-hover&quot; rel=&quot;stefanegli&quot;&gt;stefanegli&lt;/a&gt; AFAIK OAK doesn&apos;t have any concept of cookies (but only Tokens) and the cluster id is not taken in consideration AFAIK. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anchela&quot; class=&quot;user-hover&quot; rel=&quot;anchela&quot;&gt;anchela&lt;/a&gt; might know better. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15026564" author="egli" created="Wed, 25 Nov 2015 10:23:06 +0000"  >&lt;p&gt;Discussed offline: higher level code does indeed rely on this clusterView.id to be persisted&lt;/p&gt;</comment>
                            <comment id="15028544" author="egli" created="Thu, 26 Nov 2015 10:54:02 +0000"  >&lt;p&gt;related to &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3529&quot; title=&quot;NodeStore API should expose an Instance ID&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3529&quot;&gt;&lt;del&gt;OAK-3529&lt;/del&gt;&lt;/a&gt; to some extend (there it&apos;s an instance id, here it&apos;s a cluster id - for a single-instance case, so we could use &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3529&quot; title=&quot;NodeStore API should expose an Instance ID&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3529&quot;&gt;&lt;del&gt;OAK-3529&lt;/del&gt;&lt;/a&gt;&apos;s id perhaps)&lt;/p&gt;</comment>
                            <comment id="15028548" author="egli" created="Thu, 26 Nov 2015 10:57:08 +0000"  >&lt;p&gt;see &lt;a href=&quot;http://oak.markmail.org/thread/r4o3evykrlafeimk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;discussion on list&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15029667" author="mduerig" created="Fri, 27 Nov 2015 09:29:43 +0000"  >&lt;p&gt;That one is an instance id that is not persisted and not guaranteed to be stable across restarts: its contract is: &quot;... will return a unique number per instance across the cluster. It will only make its best effort to preserve the same number across restarts but it must be unique across the cluster.&quot;&lt;/p&gt;

&lt;p&gt;The main reason for not making it stable across restarts where the troublesome semantics that go along with it: what about cloning/backing up/restoring a repository? &lt;/p&gt;</comment>
                            <comment id="15119160" author="egli" created="Wed, 27 Jan 2016 12:34:29 +0000"  >&lt;p&gt;As suggested on the list the way forward is to not set the id in the SegmentDiscoveryLiteService case as all and leave the responsibility of managing the clusterId to upper layers.&lt;br/&gt;
There&apos;s currently only one known upper layer and that&apos;s discovery.oak - and returning null for the id in the discovery-lite descriptor breaks discovery.oak.&lt;br/&gt;
Which means, a fix of &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3672&quot; title=&quot;discovery-lite should not set (cluster)Id for tarMk and mongoMk (was: SegmentDiscoveryLiteService does not persist clusterView.id)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3672&quot;&gt;&lt;del&gt;OAK-3672&lt;/del&gt;&lt;/a&gt; requires &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-5458&quot; title=&quot;support discovery-lite&amp;#39;s id==null (by managing the id in discovery.oak)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-5458&quot;&gt;&lt;del&gt;SLING-5458&lt;/del&gt;&lt;/a&gt; first.&lt;/p&gt;</comment>
                            <comment id="15119708" author="egli" created="Wed, 27 Jan 2016 16:30:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-5458&quot; title=&quot;support discovery-lite&amp;#39;s id==null (by managing the id in discovery.oak)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-5458&quot;&gt;&lt;del&gt;SLING-5458&lt;/del&gt;&lt;/a&gt; is in the Sling release process - expected to be publicly released not-before JAN-31 2pm UTC (edited: delayed by 1 day due to a regression causing a re-release)&lt;/p&gt;</comment>
                            <comment id="15126485" author="egli" created="Mon, 1 Feb 2016 16:23:49 +0000"  >&lt;p&gt;done in rev 1727965:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;both SegmentDiscoveryLiteService and DocumentDiscoveryLiteService no longer set the &apos;id&apos; property&lt;/li&gt;
	&lt;li&gt;upper layers thus need to be flexible enough to handle both cases (ie use it when it&apos;s set, set it themselves &apos;somehow&apos; when it&apos;s not)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12934415">SLING-5458</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12673454">SLING-3164</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12674773">SLING-3195</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12906167">OAK-3529</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 41 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rw6k:k</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>