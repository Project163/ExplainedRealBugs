<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:47:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2475] Query Filter looses property constraints for multiple and conditions for same property</title>
                <link>https://issues.apache.org/jira/browse/OAK-2475</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Current while evaluating a query like following where &lt;tt&gt;propa&lt;/tt&gt; is a multi value property&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select [jcr:path] from [nt:base] where propa = &lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt; and propa = &lt;span class=&quot;code-quote&quot;&gt;&apos;c&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Filter created by Query Engine only has one property restriction for &lt;em&gt;propa = &apos;a&apos;&lt;/em&gt;. This happens because FilterImpl uses a map to store the propertyRestrictions.&lt;/p&gt;

&lt;p&gt;Eventually query engine returns the right result as query engine evaluates both restrictions on the result set returned by index. However index does not get to know of other restrictions and would return more result than required.&lt;/p&gt;

&lt;p&gt;Expected - Filter gets access to all property restrictions. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12772369">OAK-2475</key>
            <summary>Query Filter looses property constraints for multiple and conditions for same property</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="chetanm">Chetan Mehrotra</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Feb 2015 13:46:00 +0000</created>
                <updated>Tue, 10 Mar 2015 10:46:02 +0000</updated>
                            <resolved>Fri, 13 Feb 2015 10:54:34 +0000</resolved>
                                                    <fixVersion>1.0.12</fixVersion>
                    <fixVersion>1.1.7</fixVersion>
                                    <component>query</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14307165" author="tmueller" created="Thu, 5 Feb 2015 12:51:13 +0000"  >&lt;p&gt;Changes in the API might not be needed. The class PropertyRestriction has String propertyName and PropertyValue first, last, and List&amp;lt;PropertyValue&amp;gt; list. A PropertyValue can be an scalar value, or a multi-value. For this case, if the data type is always the same, then first and last could be set to &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;a&amp;#39;, &amp;#39;c&amp;#39;&amp;#93;&lt;/span&gt;.&lt;/p&gt;</comment>
                            <comment id="14307190" author="chetanm" created="Thu, 5 Feb 2015 13:13:18 +0000"  >&lt;p&gt;A crude attempt using Multimap in FilterImpl. &lt;/p&gt;</comment>
                            <comment id="14307226" author="tmueller" created="Thu, 5 Feb 2015 13:54:29 +0000"  >&lt;p&gt;Also related are conditions of the form &quot;(p=1 or p=2) and (p=3 or p=4)&quot;&lt;/p&gt;</comment>
                            <comment id="14308879" author="tmueller" created="Fri, 6 Feb 2015 09:18:12 +0000"  >&lt;p&gt;New patch &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2475&quot; title=&quot;Query Filter looses property constraints for multiple and conditions for same property&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2475&quot;&gt;&lt;del&gt;OAK-2475&lt;/del&gt;&lt;/a&gt;-b.patch. It is based on Chetan&apos;s patch, but solves a few additional problems (bugfix in the ReferenceIndex, avoid duplicate restrictions). It is not &quot;perfect&quot; yet as restrictions of the type &quot;a=1 and a&amp;gt;=1&quot; are not folded into &quot;a=1&quot; as they were before, but I&apos;m not sure if that&apos;s important.&lt;/p&gt;</comment>
                            <comment id="14308887" author="tmueller" created="Fri, 6 Feb 2015 09:23:53 +0000"  >&lt;p&gt;The new patch also solves the problem above: &quot;(p=1 or p=2) and (p=3 or p=4)&quot; is converted to the following filter, but I think there is no test for that yet:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Filter(query=explain select * from [nt:base] where (p=1 or p=2) and (p=3 or p=4), path=*, property=[p=[in(1, 2), in(3, 4)]])
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14316174" author="tmueller" created="Wed, 11 Feb 2015 13:06:49 +0000"  >&lt;p&gt;I found a problem with the patch: restrictions on the property type are not correctly processed. For example the following (Oak-internal) query no longer uses the right index:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SELECT * FROM [nt:base] WHERE PROPERTY([rep:members], &apos;WeakReference&apos;) = $uuid 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m working on a new patch.&lt;/p&gt;</comment>
                            <comment id="14316188" author="tmueller" created="Wed, 11 Feb 2015 13:23:13 +0000"  >&lt;p&gt;New patch &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2475&quot; title=&quot;Query Filter looses property constraints for multiple and conditions for same property&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2475&quot;&gt;&lt;del&gt;OAK-2475&lt;/del&gt;&lt;/a&gt;-c.patch (against trunk). I only ran the regular unit tests so far.&lt;/p&gt;</comment>
                            <comment id="14319939" author="tmueller" created="Fri, 13 Feb 2015 10:53:58 +0000"  >&lt;p&gt;Revision 1659501 (trunk)&lt;br/&gt;
revision 1659502 (1.0 branch)&lt;/p&gt;</comment>
                            <comment id="14354670" author="mreutegg" created="Tue, 10 Mar 2015 10:46:02 +0000"  >&lt;p&gt;Bulk close for Oak 1.0.12.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12696999" name="OAK-2475-b.patch" size="22685" author="thomasm" created="Fri, 6 Feb 2015 09:18:12 +0000"/>
                            <attachment id="12698078" name="OAK-2475-c.patch" size="24260" author="thomasm" created="Wed, 11 Feb 2015 13:23:13 +0000"/>
                            <attachment id="12696756" name="OAK-2475-multimap.patch" size="3133" author="chetanm" created="Thu, 5 Feb 2015 13:13:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i256jz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>