<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:39:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-926] MongoMK: split documents when they are too large</title>
                <link>https://issues.apache.org/jira/browse/OAK-926</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Currently, the MongoMK stores all revisions of a node in the same document. Once there are many revisions, the document gets very large.&lt;/p&gt;

&lt;p&gt;The plan is to split the document when it gets big.&lt;/p&gt;

&lt;p&gt;It looks like this isn&apos;t just a &quot;nice to have&quot;, but also a problem for some use cases. Example stack trace:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;21.07.2013 12:35:47.554 *ERROR* ...
Caused by: java.lang.IllegalArgumentException: &lt;span class=&quot;code-quote&quot;&gt;&apos;ok&apos;&lt;/span&gt; should never be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;...
	at com.mongodb.CommandResult.ok(CommandResult.java:48)
	at com.mongodb.DBCollection.findAndModify(DBCollection.java:375)
	at org.apache.jackrabbit.oak.plugins.mongomk.MongoDocumentStore.findAndModify(MongoDocumentStore.java:302)
	... 32 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;at the same time in the MongoDB log:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Sun Jul 21 12:35:47.334 [conn7] warning: log line attempted (159k) over max size(10k), 
printing beginning and end ... 
Assertion: 10334:BSONObj size: 16795219 (0x53460001) is invalid. 
Size must be between 0 and 16793600(16MB) 
First element: :childOrder: { r1400279f22d-0-1: &lt;span class=&quot;code-quote&quot;&gt;&quot;[]&quot;&lt;/span&gt;, ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12659285">OAK-926</key>
            <summary>MongoMK: split documents when they are too large</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="thomasm">Thomas Mueller</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Jul 2013 08:41:59 +0000</created>
                <updated>Wed, 9 Oct 2013 15:29:38 +0000</updated>
                            <resolved>Wed, 18 Sep 2013 13:29:54 +0000</resolved>
                                                    <fixVersion>0.10</fixVersion>
                                    <component>mongomk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13722253" author="tmueller" created="Mon, 29 Jul 2013 08:16:10 +0000"  >&lt;p&gt;As a temporary solution, I will try to create a patch for the MongoMK to split documents that are larger than 512 KB, and truncate revisions that are older than 5 minutes. This is just temporary until the &quot;real&quot; fix is ready.&lt;/p&gt;</comment>
                            <comment id="13722267" author="tmueller" created="Mon, 29 Jul 2013 08:34:27 +0000"  >&lt;p&gt;Revision 1507970: Temporarily, truncate revisions that are older than 5 minutes if the document is larger than 512 KB&lt;/p&gt;</comment>
                            <comment id="13730505" author="mreutegg" created="Tue, 6 Aug 2013 08:19:45 +0000"  >&lt;p&gt;I think this may break the repository. In the simple case where an update is done on a single node and the commit root is on that node as well, the temporary solution should work well. You just loose changes of the node older than five minutes. But consider a commit over multiple nodes where the commit root node is not explicity modified. E.g. the root node often acts as the commit root even if it is not modified. Truncating these commit revisions after five minutes will make those changes disappear. Or am I misunderstanding your temporary solution?&lt;/p&gt;</comment>
                            <comment id="13730512" author="tmueller" created="Tue, 6 Aug 2013 08:34:20 +0000"  >&lt;p&gt;Marcel, I think you are right.&lt;/p&gt;

&lt;p&gt;To make it work, all revisions older than 5 minutes would need to be assumed as committed. Of course this also means we need to ensure there are no uncommitted revisions older than 5 minutes; meaning uncommitted revisions would need to be rolled back within 5 minutes using some kind of cleanup mechanism.&lt;/p&gt;</comment>
                            <comment id="13730581" author="tmueller" created="Tue, 6 Aug 2013 09:55:10 +0000"  >&lt;p&gt;Revision 1510891: assume old revisions as committed&lt;/p&gt;</comment>
                            <comment id="13739416" author="mreutegg" created="Wed, 14 Aug 2013 08:39:26 +0000"  >&lt;p&gt;I had to disable the temporary solution because the TCK tests fail with the MongoMK. Revision: 1513766&lt;/p&gt;</comment>
                            <comment id="13739430" author="mreutegg" created="Wed, 14 Aug 2013 08:58:17 +0000"  >&lt;p&gt;I will start working on a proper implementation.&lt;/p&gt;</comment>
                            <comment id="13770766" author="mreutegg" created="Wed, 18 Sep 2013 13:29:54 +0000"  >&lt;p&gt;Documents are now split when they reach a threshold of 32k and contain at least 1000 commits.&lt;/p&gt;

&lt;p&gt;Run time of TCK tests has already improved quite a bit, but there are still some performance bottleneck, which need to be addressed. However, these are unrelated to document splitting. I&apos;ll create separate issues.&lt;/p&gt;</comment>
                            <comment id="13790495" author="alex.parvulescu" created="Wed, 9 Oct 2013 15:29:38 +0000"  >&lt;p&gt;bulk close for 0.10 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>339478</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 6 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1mjwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>339798</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>