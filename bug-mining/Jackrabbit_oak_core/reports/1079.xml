<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:46:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2320] Wrong optimization for joins with ISDESCENDANTNODE conditions</title>
                <link>https://issues.apache.org/jira/browse/OAK-2320</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Joins with ISDESCENDANTNODE condition are incorrectly optimized when the join is executed in the reverse order: instead of a path condition of the form &quot;all parents&quot;, a path condition of the form &quot;parent&quot; is used. That means, the first selector only traverse the parent node, when the TraversingIndex is used, instead of all possible parent nodes. As of now, there is no path condition of the form &quot;all parents&quot;.&lt;/p&gt;

&lt;p&gt;This affects both SQL-2 and XPath queries.&lt;/p&gt;

&lt;p&gt;It is a problem if the join is reversed due to lower potential cost, which is so far seldom, and it looks like only in combination with the TraversingIndex. There are some existing tests that only fail when the new cost estimation is used (&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1907&quot; title=&quot;Better cost estimates for traversal, property, and ordered indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1907&quot;&gt;&lt;del&gt;OAK-1907&lt;/del&gt;&lt;/a&gt;). Still, it is theoretically possible that existing code is affected (even without &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1907&quot; title=&quot;Better cost estimates for traversal, property, and ordered indexes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1907&quot;&gt;&lt;del&gt;OAK-1907&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12759453">OAK-2320</key>
            <summary>Wrong optimization for joins with ISDESCENDANTNODE conditions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="thomasm">Thomas Mueller</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Dec 2014 15:37:10 +0000</created>
                <updated>Tue, 7 Apr 2015 20:23:00 +0000</updated>
                            <resolved>Mon, 8 Dec 2014 13:10:11 +0000</resolved>
                                    <version>1.0.8</version>
                    <version>1.1.2</version>
                                    <fixVersion>1.0.9</fixVersion>
                    <fixVersion>1.1.3</fixVersion>
                                    <component>core</component>
                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14234278" author="tmueller" created="Thu, 4 Dec 2014 15:39:18 +0000"  >&lt;p&gt;Patch (SVN is not available right now):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;--- src/main/java/org/apache/jackrabbit/oak/query/ast/DescendantNodeJoinConditionImpl.java	(revision 1643074)
+++ src/main/java/org/apache/jackrabbit/oak/query/ast/DescendantNodeJoinConditionImpl.java	(working copy)
@@ -67,14 +67,8 @@
     @Override
     public void restrict(FilterImpl f) {
         if (f.getSelector().equals(ancestorSelector)) {
-            String d = descendantSelector.currentPath();
-            if (d == null &amp;amp;&amp;amp; f.isPreparing() &amp;amp;&amp;amp; f.isPrepared(descendantSelector)) {
-                // during the prepare phase, if the selector is already
-                // prepared, then we would know the value
-                f.restrictPath(KNOWN_PARENT_PATH, Filter.PathRestriction.PARENT);
-            } else if (d != null) {
-                f.restrictPath(PathUtils.getParentPath(d), Filter.PathRestriction.PARENT);
-            }
+            // we ca not currently optimize this case,
+            // as we would need a path restriction of type &quot;ALL_PARENTS&quot;.
         }
         if (f.getSelector().equals(descendantSelector)) {
             String a = ancestorSelector.currentPath();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14237848" author="tmueller" created="Mon, 8 Dec 2014 13:08:06 +0000"  >&lt;p&gt;Revision 1643800 (trunk)&lt;/p&gt;</comment>
                            <comment id="14237850" author="tmueller" created="Mon, 8 Dec 2014 13:09:58 +0000"  >&lt;p&gt;Revision 1643804 (1.0 branch)&lt;/p&gt;</comment>
                            <comment id="14237892" author="edivad" created="Mon, 8 Dec 2014 14:20:49 +0000"  >&lt;p&gt;removed the fix version1.1.4 as 1.1.3 has not been released yet. This will therefore be included in 1.1.3&lt;/p&gt;</comment>
                            <comment id="14244362" author="edivad" created="Fri, 12 Dec 2014 16:06:21 +0000"  >&lt;p&gt;Bulk close for 1.1.3&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2327b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>