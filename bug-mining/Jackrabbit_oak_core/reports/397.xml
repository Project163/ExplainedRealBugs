<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:39:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-962] RootFuzzIT fails on MongoMK with seed -1091889749</title>
                <link>https://issues.apache.org/jira/browse/OAK-962</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Running FuzzRootIT with -DRootFuzzIT-with-mongo-mk=true -DRootFuzzIT-seed=-1091889749 results in&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.jackrabbit.mk.api.MicroKernelException: Exception committing -&lt;span class=&quot;code-quote&quot;&gt;&quot;/root/N6&quot;&lt;/span&gt;
-&lt;span class=&quot;code-quote&quot;&gt;&quot;/root/N11&quot;&lt;/span&gt;
^&lt;span class=&quot;code-quote&quot;&gt;&quot;/root/N4/P14&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;V15\&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;-&quot;&lt;/span&gt;/root/N4/N5&quot;

	at org.apache.jackrabbit.oak.plugins.mongomk.Commit.applyToDocumentStore(Commit.java:262)
	at org.apache.jackrabbit.oak.plugins.mongomk.Commit.prepare(Commit.java:144)
	at org.apache.jackrabbit.oak.plugins.mongomk.MongoMK.commit(MongoMK.java:1137)
	at org.apache.jackrabbit.oak.kernel.KernelNodeStoreBranch.persistTransientHead(KernelNodeStoreBranch.java:275)
	at org.apache.jackrabbit.oak.kernel.KernelNodeStoreBranch.setRoot(KernelNodeStoreBranch.java:93)
	at org.apache.jackrabbit.oak.core.AbstractRoot.purgePendingChanges(AbstractRoot.java:391)
	at org.apache.jackrabbit.oak.core.AbstractRoot.commit(AbstractRoot.java:239)
	at org.apache.jackrabbit.oak.core.RootFuzzIT.fuzzTest(RootFuzzIT.java:141)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:30)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:263)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:68)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:47)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:231)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:60)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:50)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:222)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:300)
	at org.junit.runners.Suite.runChild(Suite.java:128)
	at org.junit.runners.Suite.runChild(Suite.java:24)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:231)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:60)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:229)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:50)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:222)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:300)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:157)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:77)
	at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:195)
	at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:63)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at com.intellij.rt.execution.application.AppMain.main(AppMain.java:120)
Caused by: org.apache.jackrabbit.mk.api.MicroKernelException: The node /root/N6/N7 does not exist or is already deleted, before
r14082a1d9db-0-1; document:
{_commitRoot={r14082a1d986-0-1=0, r14082a1d996-1-1=0},
_deleted={r14082a1d986-0-1=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, r14082a1d996-1-1=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;},
_id=3:/root/N6/N7,
_modified=275316235},
revision order:
1:
 r14082a1d945-1-1:r14082a1d946-2-0

	at org.apache.jackrabbit.oak.plugins.mongomk.Commit.createOrUpdateNode(Commit.java:321)
	at org.apache.jackrabbit.oak.plugins.mongomk.Commit.applyToDocumentStore(Commit.java:246)
	... 43 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12663871">OAK-962</key>
            <summary>RootFuzzIT fails on MongoMK with seed -1091889749</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="mduerig">Michael D&#252;rig</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Aug 2013 15:30:04 +0000</created>
                <updated>Tue, 8 Oct 2019 15:21:37 +0000</updated>
                            <resolved>Tue, 20 Aug 2013 08:35:17 +0000</resolved>
                                                    <fixVersion>0.9</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13741082" author="mduerig" created="Thu, 15 Aug 2013 15:44:08 +0000"  >&lt;p&gt;The sequence of operation leading up to this error is&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1: rebase
2: +/root/N2:{}
3: -/root/N2
4: save
5: +/root/N3:{}
6: &amp;gt;/root/N3:/root/N4
7: +/root/N4/N5:{}
8: +/root/N6:{}
9: +/root/N6/N7:{}
10: rebase
11: ^/root/P8:V9
12: rebase
13: save
14: +/root/N4/N5/N10:{}
15: +/root/N11:{}
16: &amp;gt;/root/N6/N7:/root/N4/N12
17: -/root/N4/N5
18: +/root/N6/N13:{}
19: -/root/N6
20: -/root/N11
21: ^/root/N4/P14:V15
22: save
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13741106" author="mduerig" created="Thu, 15 Aug 2013 16:04:53 +0000"  >&lt;p&gt;A trimmed down sequence leading to the same problem is &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        +/root/N3:{}
        +/root/N6:{}
        +/root/N6/N7:{}
        save
        &amp;gt;/root/N6/N7:/root/N3/N12
        -/root/N3/N12
        -/root/N6
        save
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Added test case at revision 1514336. The same test passing for SegmentMK and MKImpl indicates this being a problem with the MongoMk. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt; could you have a look?&lt;/p&gt;</comment>
                            <comment id="13741299" author="mreutegg" created="Thu, 15 Aug 2013 18:22:25 +0000"  >&lt;p&gt;This is a known issue with the MongoMK, but so far wasn&apos;t considered important. See also MongoMKBranchMergeTest#movesInBranch().&lt;/p&gt;</comment>
                            <comment id="13742108" author="mduerig" created="Fri, 16 Aug 2013 11:25:54 +0000"  >&lt;p&gt;Hmm this will cause the following JCR code to fail with the same error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        Node root = session.getRootNode().addNode(&lt;span class=&quot;code-quote&quot;&gt;&quot;root&quot;&lt;/span&gt;);
        root.addNode(&lt;span class=&quot;code-quote&quot;&gt;&quot;N3&quot;&lt;/span&gt;);
        root.addNode(&lt;span class=&quot;code-quote&quot;&gt;&quot;N6&quot;&lt;/span&gt;).addNode(&lt;span class=&quot;code-quote&quot;&gt;&quot;N7&quot;&lt;/span&gt;);
        session.save();
        session.move(&lt;span class=&quot;code-quote&quot;&gt;&quot;/root/N6/N7&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;/root/N3/N12&quot;&lt;/span&gt;);
        root.getNode(&lt;span class=&quot;code-quote&quot;&gt;&quot;N3&quot;&lt;/span&gt;).getNode(&lt;span class=&quot;code-quote&quot;&gt;&quot;N12&quot;&lt;/span&gt;).remove();
        root.getNode(&lt;span class=&quot;code-quote&quot;&gt;&quot;N6&quot;&lt;/span&gt;).remove();
        session.save();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think we need to fix this. &lt;br/&gt;
Test case at &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=r1514656&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=r1514656&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13743783" author="mreutegg" created="Mon, 19 Aug 2013 12:58:04 +0000"  >&lt;p&gt;The root cause of the above test failure is the wrong revision used in MongoMK.markAsDeleted(). It uses the commit revision to find the nodes to delete, but instead it should use the base revision of the commit.&lt;/p&gt;

&lt;p&gt;However, the RootFuzzIT test still fails with the fix I have in my checkout. Probably for another reason. I&apos;ll further investigate.&lt;/p&gt;</comment>
                            <comment id="13743807" author="mreutegg" created="Mon, 19 Aug 2013 13:32:49 +0000"  >&lt;p&gt;Fixed the revision issue in MongoMK.markAsDeleted() and enabled the tests in RootTest and RepositoryTest.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/r1515408&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1515408&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13744149" author="mreutegg" created="Mon, 19 Aug 2013 20:01:13 +0000"  >&lt;p&gt;Looks like something is wrong with the child node count handling in MongoMK when there are removed nodes involved. Added a new test (currently ignored): &lt;a href=&quot;http://svn.apache.org/r1515581&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1515581&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13744293" author="mduerig" created="Mon, 19 Aug 2013 21:44:51 +0000"  >&lt;p&gt;The root cause is probably the same like the one that is responsible for&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.IllegalStateException: This tree does not exist
	at com.google.common.base.Preconditions.checkState(Preconditions.java:149)
	at org.apache.jackrabbit.oak.core.MutableTree.checkExists(MutableTree.java:437)
	at org.apache.jackrabbit.oak.core.MutableTree.addChild(MutableTree.java:267)
	at org.apache.jackrabbit.oak.core.RootFuzzIT$Operation$AddNode.apply(RootFuzzIT.java:233)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Setting &lt;tt&gt;KernelNodeState#MAX_CHILD_NODE_NAMES&lt;/tt&gt; to a large value makes the problem go away. Looks like the problem is in &lt;tt&gt;MongoMK#getChildren&lt;/tt&gt;. In the second half of the method the cache is refreshed, but the case when &lt;tt&gt;children.hasMore&lt;/tt&gt; is &lt;tt&gt;true&lt;/tt&gt; is not handled causing further children to go amiss. &lt;/p&gt;
</comment>
                            <comment id="13744749" author="mreutegg" created="Tue, 20 Aug 2013 06:40:33 +0000"  >&lt;p&gt;It&apos;s a bit deeper down the call stack actually. &lt;tt&gt;MongoMK#readChildren&lt;/tt&gt; does not set the &lt;tt&gt;hasMore&lt;/tt&gt; flag correctly. It compares the raw size of the returned documents and does not take visibility at the given read revision into account. Furthermore it may happen that the method returns fewer children than requested, even though there are &lt;b&gt;more&lt;/b&gt;, again due to visibility at the read revision.&lt;/p&gt;</comment>
                            <comment id="13744789" author="mreutegg" created="Tue, 20 Aug 2013 08:30:48 +0000"  >&lt;p&gt;Fixed the issue in MongoMK in revision: &lt;a href=&quot;http://svn.apache.org/r1515736&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1515736&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;RootFuzzIT now succeeds but takes quite a long time with the MongoMK. Therefore I didn&apos;t enable it yet.&lt;/p&gt;

&lt;p&gt;The reason why it takes so long is &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-926&quot; title=&quot;MongoMK: split documents when they are too large&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-926&quot;&gt;&lt;del&gt;OAK-926&lt;/del&gt;&lt;/a&gt; but also because reads from the cache return a copy of the document. I&apos;ll address this with &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-926&quot; title=&quot;MongoMK: split documents when they are too large&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-926&quot;&gt;&lt;del&gt;OAK-926&lt;/del&gt;&lt;/a&gt; as well.&lt;/p&gt;</comment>
                            <comment id="13744792" author="mreutegg" created="Tue, 20 Aug 2013 08:35:17 +0000"  >&lt;p&gt;Setting to fixed.&lt;/p&gt;

&lt;p&gt;I changed the FIXME in RootFuzzIT to refer to &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-926&quot; title=&quot;MongoMK: split documents when they are too large&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-926&quot;&gt;&lt;del&gt;OAK-926&lt;/del&gt;&lt;/a&gt; now. The test is still disabled for MongoMK.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/r1515742&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1515742&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13772706" author="alex.parvulescu" created="Fri, 20 Sep 2013 07:01:26 +0000"  >&lt;p&gt;Bulk close for the 0.9 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>343872</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1navb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>344174</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>