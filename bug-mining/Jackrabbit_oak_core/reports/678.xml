<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:42:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1335] version history related test failures</title>
                <link>https://issues.apache.org/jira/browse/OAK-1335</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;...when running the integrationTesting profile:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Failed tests:   testInitialNumberOfVersions(org.apache.jackrabbit.test.api.version.VersionHistoryTest): VersionHistory.getAllVersions() initially returns an iterator with two versions. expected:&amp;lt;2&amp;gt; but was:&amp;lt;1&amp;gt;
  testInitialNumberOfLinearVersions(org.apache.jackrabbit.test.api.version.VersionHistoryTest): VersionHistory.getAllVersions() and .getAllLinearVersions should return the same number of versions for a purely linear version history. expected:&amp;lt;1&amp;gt; but was:&amp;lt;2&amp;gt;
  testGetAllVersions(org.apache.jackrabbit.test.api.version.VersionHistoryTest): VersionHistory.getAllVersions() must contain the root version and all versions that have been created with a Node.checkin() call.
  testGetAllVersionsJcr2(org.apache.jackrabbit.test.api.version.VersionHistoryTest): VersionHistory.getAllVersions() must contain the root version and all versions that have been created with a Node.checkin() call.
  testCheckinCreatesNewVersionJcr2(org.apache.jackrabbit.test.api.version.CheckinTest): Checkin must create a new Version in the VersionHistory.
  testRestoreNameJcr2(org.apache.jackrabbit.test.api.version.RestoreTest): restore must restore child node version 1.0. expected:&amp;lt;1.[0]&amp;gt; but was:&amp;lt;1.[1]&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12689538">OAK-1335</key>
            <summary>version history related test failures</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reschke">Julian Reschke</assignee>
                                    <reporter username="reschke">Julian Reschke</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Jan 2014 18:34:55 +0000</created>
                <updated>Mon, 28 May 2018 12:34:36 +0000</updated>
                            <resolved>Wed, 19 Feb 2014 16:23:34 +0000</resolved>
                                                    <fixVersion>0.17</fixVersion>
                                    <component>jcr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13903314" author="anchela" created="Mon, 17 Feb 2014 15:37:52 +0000"  >&lt;p&gt;these tests now passed on my checkout and i removed them from the known-issues list.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reschke&quot; class=&quot;user-hover&quot; rel=&quot;reschke&quot;&gt;reschke&lt;/a&gt;, feel free to reopen this issue, if the keep failing for you. thanks a lot.&lt;/p&gt;</comment>
                            <comment id="13904199" author="reschke" created="Tue, 18 Feb 2014 16:10:28 +0000"  >&lt;p&gt;The tests still fail occasionally. Will attach details.&lt;/p&gt;</comment>
                            <comment id="13904202" author="reschke" created="Tue, 18 Feb 2014 16:14:40 +0000"  >&lt;p&gt;I see still test failures. For testInitialNumberOfVersions they are caused by the initial version history containing only one entry (the root entry).&lt;/p&gt;

&lt;p&gt;Modified test case to provide more detail:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testInitialNumberOfVersions() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; RepositoryException {
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; initialSize = getNumberOfVersions(vHistory);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (initialSize != 2) {
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; path = versionableNode.getPath();
            logger.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;incorrect initial VHR size: &quot;&lt;/span&gt; + initialSize);
            VersionIterator it = vHistory.getAllVersions();
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (it.hasNext()) {
                logger.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;version present: &quot;&lt;/span&gt; + it.nextVersion().getPath());
            }
            logger.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;ischeckedout (node): &quot;&lt;/span&gt; + versionableNode.isCheckedOut());
            logger.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;ischeckedout (vm): &quot;&lt;/span&gt; + versionableNode.getSession().getWorkspace().getVersionManager().isCheckedOut(path));

            vHistory.getSession().refresh(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
            initialSize = getNumberOfVersions(vHistory);
            logger.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;initial VHR size after refresh: &quot;&lt;/span&gt; + initialSize);

            superuser.refresh(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
            logger.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;size seen from other session: &quot;&lt;/span&gt; + getNumberOfVersions(superuser.getWorkspace().getVersionManager().getVersionHistory(path)));

            Session s = &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.getHelper().getReadOnlySession();
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                logger.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;size seen from &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; session: &quot;&lt;/span&gt; + getNumberOfVersions(s.getWorkspace().getVersionManager().getVersionHistory(path)));
            }
            &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
                s.logout();
            }
        }

        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;VersionHistory.getAllVersions() initially returns an iterator with two versions.&quot;&lt;/span&gt;, 2, initialSize);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log output:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;17:02:01.353 INFO  [main] JUnitTest.java:44                  Starting test case testInitialNumberOfVersions
17:02:01.353 WARN  [main] ItemImpl.java:275                  Item#save is only supported when the subtree rooted at that item contains all transient changes. Falling back to Session#save since system property item-save-does-session-save is true.
17:02:01.363 ERROR [main] VersionHistoryTest.java:127        incorrect initial VHR size: 1
17:02:01.363 ERROR [main] VersionHistoryTest.java:130        version present: /jcr:system/jcr:versionStorage/d7/4e/7f/d74e7fe5-442c-4dfc-bb35-24542d388137/jcr:rootVersion
17:02:01.363 ERROR [main] VersionHistoryTest.java:132        ischeckedout (node): false
17:02:01.363 ERROR [main] VersionHistoryTest.java:133        ischeckedout (vm): false
17:02:01.363 ERROR [main] VersionHistoryTest.java:137        initial VHR size after refresh: 1
17:02:01.363 ERROR [main] VersionHistoryTest.java:140        size seen from other session: 1
17:02:01.363 ERROR [main] VersionHistoryTest.java:144        size seen from new session: 1
17:02:01.373 INFO  [main] JUnitTest.java:48                  Completed test case testInitialNumberOfVersions
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13904362" author="reschke" created="Tue, 18 Feb 2014 18:23:48 +0000"  >&lt;p&gt;It seems that the test failures are caused by VersionHistoryDelegate&apos;s attempt to use a SortedMap where the created time is the key.&lt;/p&gt;

&lt;p&gt;This will fail when two versions happen to have the same timestamp.&lt;/p&gt;</comment>
                            <comment id="13905451" author="reschke" created="Wed, 19 Feb 2014 13:51:16 +0000"  >&lt;p&gt;After the fixes to the version history handling two tests still fail quite reliably:&lt;/p&gt;

&lt;p&gt;Failed tests:   testRestoreName(org.apache.jackrabbit.test.api.version.RestoreTest): Node.restore(&apos;test&apos;) must restore child node version 1.0. expected:&amp;lt;1.&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&amp;gt; but was:&amp;lt;1.&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;(same for testRestoreNameJcr2)&lt;/p&gt;

&lt;p&gt;To test:&lt;/p&gt;

&lt;p&gt;cd oak-jcr&lt;br/&gt;
mvn clean install test -Dtest=VersionIT&lt;/p&gt;</comment>
                            <comment id="13905545" author="reschke" created="Wed, 19 Feb 2014 15:21:04 +0000"  >&lt;p&gt;Discussed with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt;: probably caused by DateVersionSelector picking the wrong version when timestamps do not differ. Workaround in classic Jackrabbit was by tuning the creation date generation to always return a new timestamp no matter what the system time said.&lt;/p&gt;</comment>
                            <comment id="13905608" author="reschke" created="Wed, 19 Feb 2014 16:05:23 +0000"  >&lt;p&gt;Proposed patch&lt;/p&gt;

&lt;p&gt;1) Fail early in version selection code when we detect two versions with the same timestamp&lt;/p&gt;

&lt;p&gt;2) in checkin(), ensure that currentTimeMillis is different from baseversion (by busy-waiting)&lt;/p&gt;</comment>
                            <comment id="13905617" author="mreutegg" created="Wed, 19 Feb 2014 16:10:10 +0000"  >&lt;p&gt;Patch looks good to me. Thanks a lot for identifying the issue and providing the patch.&lt;/p&gt;

&lt;p&gt;Feel free to commit.&lt;/p&gt;</comment>
                            <comment id="13914266" author="alex.parvulescu" created="Thu, 27 Feb 2014 09:28:47 +0000"  >&lt;p&gt;bulk close for the 0.17.1 release&lt;/p&gt;</comment>
                            <comment id="16490808" author="reschke" created="Fri, 25 May 2018 14:36:54 +0000"  >&lt;p&gt;FWIW; I still see this failure:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Failed tests:   testRestoreNameJcr2(org.apache.jackrabbit.test.api.version.RestoreTest): restore must restore child node version 1.0. expected:&amp;lt;1.[0]&amp;gt; but was:&amp;lt;1.[1]&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;frequently (here: in Oak 1.6).&lt;/p&gt;</comment>
                            <comment id="16492370" author="mreutegg" created="Mon, 28 May 2018 08:02:21 +0000"  >&lt;p&gt;Can you please create a new issue, this one is closed?&lt;/p&gt;</comment>
                            <comment id="16492428" author="reschke" created="Mon, 28 May 2018 09:01:29 +0000"  >&lt;p&gt;Of course: &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-7512&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/OAK-7512&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16492616" author="reschke" created="Mon, 28 May 2018 12:34:36 +0000"  >&lt;p&gt;trunk: &lt;a href=&quot;http://svn.apache.org/r1569810&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1569810&lt;/a&gt; &lt;a href=&quot;http://svn.apache.org/r1569741&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1569741&lt;/a&gt; &lt;a href=&quot;http://svn.apache.org/r1569704&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1569704&lt;/a&gt; &lt;a href=&quot;http://svn.apache.org/r1559237&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1559237&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13162353">OAK-7512</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12700716">OAK-1525</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12629798" name="OAK-1335.diff" size="4124" author="reschke" created="Wed, 19 Feb 2014 16:05:23 +0000"/>
                            <attachment id="12623702" name="log" size="99971" author="reschke" created="Fri, 17 Jan 2014 18:35:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>368505</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 24 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rikn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>368809</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>