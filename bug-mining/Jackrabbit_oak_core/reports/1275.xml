<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:48:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2973] [Blob GC] Report accurate deleted count</title>
                <link>https://issues.apache.org/jira/browse/OAK-2973</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Currently, the underlying data stores do not report the actual count deleted from the candidate set in the &lt;tt&gt;GarbageCollectableBlobStore#deleteChunks&lt;/tt&gt; method as there may be blobs not satisfying the max last modified criteria. &lt;/p&gt;

&lt;p&gt;For debugging it would be better to support returning the actual deleted count so that &lt;tt&gt;MarkSweepGarbageCollector&lt;/tt&gt; can accurately report the count of blobs deleted.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12836751">OAK-2973</key>
            <summary>[Blob GC] Report accurate deleted count</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="amitjain">Amit Jain</assignee>
                                    <reporter username="amitjain">Amit Jain</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Jun 2015 06:54:34 +0000</created>
                <updated>Tue, 8 Oct 2019 15:22:14 +0000</updated>
                            <resolved>Thu, 6 Aug 2015 04:58:04 +0000</resolved>
                                                    <fixVersion>1.2.4</fixVersion>
                    <fixVersion>1.3.4</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>blob</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14633359" author="edivad" created="Mon, 20 Jul 2015 10:05:07 +0000"  >&lt;p&gt;Bulk move to 1.3.4&lt;/p&gt;</comment>
                            <comment id="14654754" author="amitjain" created="Wed, 5 Aug 2015 03:37:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt;&lt;br/&gt;
Can you please review the patch. This should also be merged to 1.2&lt;/p&gt;</comment>
                            <comment id="14654841" author="chetanm" created="Wed, 5 Aug 2015 05:27:28 +0000"  >&lt;p&gt;Change looks fine. &lt;/p&gt;

&lt;p&gt;However bumping major version might pose a problem. May be we should mark the &lt;tt&gt;MarkAndSweekGarbageCollector&lt;/tt&gt; with provider type. However it might still result in major version change as return type is being changed. Worst case we might need to provide a new method and let old method delegate to that (in AsbtractBlobStore) and make use of new method&lt;/p&gt;</comment>
                            <comment id="14654856" author="amitjain" created="Wed, 5 Aug 2015 05:41:29 +0000"  >&lt;p&gt;I think you meant &lt;tt&gt;GarbageCollectableBlobStore&lt;/tt&gt;. Yes still needs a major version change even with &lt;tt&gt;@ProviderType&lt;/tt&gt;. &lt;br/&gt;
The method &lt;tt&gt;deleteChunks&lt;/tt&gt; is only being used by GC andwas specifically added for it so, do we need to add a new method? &lt;/p&gt;</comment>
                            <comment id="14655010" author="amitjain" created="Wed, 5 Aug 2015 08:36:08 +0000"  >&lt;p&gt;Has an offline chat with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt; and It seems there may be consumers of the package &lt;tt&gt;org.apache.jackrabbit.oak.spi.blob&lt;/tt&gt;. Reworked the patch as per suggestions above. &lt;/p&gt;</comment>
                            <comment id="14655026" author="tmueller" created="Wed, 5 Aug 2015 08:50:29 +0000"  >&lt;p&gt;&amp;gt; However bumping major version might pose a problem.&lt;/p&gt;

&lt;p&gt;Why, if we don&apos;t want to backport it? I&apos;m not saying we should bump the major version, just want to understand why it&apos;s a problem.&lt;/p&gt;

&lt;p&gt;Returning &quot;long&quot; is OK I think, even thought the size of a list can not be larger than Integer.MAX_VALUE. However, the total number of removed entries (&quot;deleted&quot;) should be a long, and not an int. Sure, it&apos;s very unlikely that there are over 2 billion removed binaries, but if the method already uses &quot;long&quot;... Your patch uses:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;int deleted = 0;
    deleted += sweepInternal(...)
... but sweepInternal is a long...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I would probably go for long everywhere. Or long for deleted, and int for sweepInternal and deleteChunks.&lt;/p&gt;</comment>
                            <comment id="14655033" author="amitjain" created="Wed, 5 Aug 2015 08:59:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;I would probably go for long everywhere. Or long for deleted, and int for sweepInternal and deleteChunks.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes that should be changed, thanks for pointing that out. &lt;/p&gt;</comment>
                            <comment id="14655054" author="amitjain" created="Wed, 5 Aug 2015 09:18:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m not saying we should bump the major version, just want to understand why it&apos;s a problem.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The dependency resolution will be a problem for osgi bundles using &lt;tt&gt;org.apache.jackrabbit.oak.spi.blob&lt;/tt&gt; (they will currently have org.apache.jackrabbit.oak.spi.blob;version=&quot;[1.0,2)&quot;)&lt;/p&gt;</comment>
                            <comment id="14659490" author="amitjain" created="Thu, 6 Aug 2015 04:58:04 +0000"  >&lt;p&gt;Committed with:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk - &lt;a href=&quot;http://svn.apache.org/r1694394&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1694394&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;1.2 - &lt;a href=&quot;http://svn.apache.org/r1694400&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1694400&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14706657" author="edivad" created="Fri, 21 Aug 2015 12:13:07 +0000"  >&lt;p&gt;Bulk close for 1.3.4&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12748811" name="OAK-2973-v2.patch" size="18615" author="amitjain" created="Wed, 5 Aug 2015 08:36:08 +0000"/>
                            <attachment id="12748779" name="OAK-2973.patch" size="16509" author="amitjain" created="Wed, 5 Aug 2015 03:37:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fv67:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>