<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:37:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-802] Occasional type validation errors in TCK setup</title>
                <link>https://issues.apache.org/jira/browse/OAK-802</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Occasionally, like in 1% of the cases, I see a default &lt;tt&gt;mvn clean install -PintegrationTesting&lt;/tt&gt; build fail with lots of type validation errors from the TCK. A typical example is:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;testScoreColumn(org.apache.jackrabbit.test.api.query.SQLQueryLevel2Test)  Time elapsed: 0.01 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
javax.jcr.nodetype.ConstraintViolationException: org.apache.jackrabbit.oak.api.CommitFailedException: OakConstraint0001: /testroot/node1: Incorrect node type of child node node1 [nt:unstructured]
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.newRepositoryException(SessionDelegate.java:331)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.save(SessionDelegate.java:196)
	at org.apache.jackrabbit.oak.jcr.SessionImpl.save(SessionImpl.java:369)
	at org.apache.jackrabbit.test.api.query.AbstractQueryLevel2Test.setUpFullTextTest(AbstractQueryLevel2Test.java:45)
	at org.apache.jackrabbit.test.api.query.SQLQueryLevel2Test.testScoreColumn(SQLQueryLevel2Test.java:41)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;See &lt;a href=&quot;https://www.dropbox.com/s/57cps6ys0etd9an/org.apache.jackrabbit.oak.jcr.tck.QueryIT.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.dropbox.com/s/57cps6ys0etd9an/org.apache.jackrabbit.oak.jcr.tck.QueryIT.txt&lt;/a&gt; for the failsafe output of such an case.&lt;/p&gt;

&lt;p&gt;I&apos;ve been able to reproduce the problem with a build loop like the following on my laptop and on a m1.xlarge ec2 instance (it didn&apos;t show up on a m1.medium instance):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;for i in `seq 1 100`; do
    mvn clean install -PintegrationTesting &amp;gt; build$i.log 2&amp;gt;&amp;amp;1
done
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;happens at least on my laptop and on an ec2 m1.xlarge instance&lt;/p&gt;</environment>
        <key id="12645609">OAK-802</key>
            <summary>Occasional type validation errors in TCK setup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="jukkaz">Jukka Zitting</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 May 2013 08:02:34 +0000</created>
                <updated>Fri, 20 Sep 2013 07:01:47 +0000</updated>
                            <resolved>Tue, 28 May 2013 11:27:50 +0000</resolved>
                                                    <fixVersion>0.9</fixVersion>
                                    <component>core</component>
                    <component>jcr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13646449" author="jukkaz" created="Wed, 1 May 2013 08:08:57 +0000"  >&lt;p&gt;Improved error reporting in &lt;a href=&quot;http://svn.apache.org/r1477927&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1477927&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13646454" author="jukkaz" created="Wed, 1 May 2013 08:26:11 +0000"  >&lt;p&gt;The extra error details brought up something interesting:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;testScoreColumn(org.apache.jackrabbit.test.api.query.SQLQueryLevel2Test):
org. apache.jackrabbit.oak.api.CommitFailedException: OakConstraint0001:
/testroot/node1[nt:unstructured]: No matching child node definition found
for child node node1 in any of the parent types [nt:base, nt:query]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have no clue why the &lt;tt&gt;/testroot&lt;/tt&gt; node would be of type &lt;tt&gt;nt:query&lt;/tt&gt;, but that&apos;s clearly triggering these test failures.&lt;/p&gt;</comment>
                            <comment id="13668246" author="jukkaz" created="Tue, 28 May 2013 11:27:50 +0000"  >&lt;p&gt;It turned out that in some cases (given random ordering of individual tests) the TCK was picking the nt:query type from o.a.j.test.api.query.SaveTest and using that to create the /testroot node. This correctly led to problems as soon as any other tests tried to add extra content below /testroot.&lt;/p&gt;

&lt;p&gt;The TCK issue was fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/JCR-3601&quot; title=&quot;AbstractJCRTest.cleanUpTestRoot() does not properly set testNodeType&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JCR-3601&quot;&gt;&lt;del&gt;JCR-3601&lt;/del&gt;&lt;/a&gt; and I updated Oak accordingly in revision 1486876.&lt;/p&gt;</comment>
                            <comment id="13772820" author="alex.parvulescu" created="Fri, 20 Sep 2013 07:01:47 +0000"  >&lt;p&gt;Bulk close for the 0.9 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>325970</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1k8jb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>326315</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>