<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:53:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-6776] Correctly use IndexPlan.supportsPathRestrictions</title>
                <link>https://issues.apache.org/jira/browse/OAK-6776</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Right now, IndexPlan.supportsPathRestrictions (introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-6734&quot; title=&quot;IndexPlan: add supportsPathRestrictions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-6734&quot;&gt;&lt;del&gt;OAK-6734&lt;/del&gt;&lt;/a&gt;) is used in the query engine for some kind of mixed &quot;rule based&quot; and &quot;cost based&quot; &lt;a href=&quot;https://en.wikipedia.org/wiki/Query_optimization&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;query optimization&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I think the current implementation isn&apos;t correct, as (for example) a query with multiple indexes will now use the wrong index in some cases (for example property index, even if the cost of the Lucene index is lower).&lt;/p&gt;

&lt;p&gt;Also, if there is a Lucene index with supportsPathRestrictions, and one without, right now always the one with supportsPathRestrictions is used. This is probably better right now, but once &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-6735&quot; title=&quot;Lucene Index: improved cost estimation by using document count per field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-6735&quot;&gt;&lt;del&gt;OAK-6735&lt;/del&gt;&lt;/a&gt; is resolved, this should be fixed as well.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13106629">OAK-6776</key>
            <summary>Correctly use IndexPlan.supportsPathRestrictions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="thomasm">Thomas Mueller</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Oct 2017 07:27:07 +0000</created>
                <updated>Tue, 8 Oct 2019 15:21:28 +0000</updated>
                            <resolved>Wed, 15 Nov 2017 11:05:57 +0000</resolved>
                                                    <fixVersion>1.7.12</fixVersion>
                    <fixVersion>1.8.0</fixVersion>
                                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16189490" author="catholicon" created="Tue, 3 Oct 2017 10:03:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt;,&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Also, if there is a Lucene index with supportsPathRestrictions, and one without, right now always the one with supportsPathRestrictions is used&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Competing plans still fight out the cost war - see &lt;tt&gt;TraversalAvoidanceTest#competingPlans&lt;/tt&gt; [0].&lt;/p&gt;

&lt;p&gt;I agree that even path restrition support lucene indices have a disadvantage against property indices. That can probably be done here.&lt;/p&gt;

&lt;p&gt;Btw, even with that I think &quot;not going for traversal&quot; for some cases (&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-6734&quot; title=&quot;IndexPlan: add supportsPathRestrictions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-6734&quot;&gt;&lt;del&gt;OAK-6734&lt;/del&gt;&lt;/a&gt;) is correct - yes, it doesn&apos;t fix lucene&apos;s cost evaluation but we should take deterministic path if traversal can be avoided.&lt;/p&gt;

&lt;p&gt;[0]: &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-core/src/test/java/org/apache/jackrabbit/oak/query/TraversalAvoidanceTest.java#L105-L107&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-core/src/test/java/org/apache/jackrabbit/oak/query/TraversalAvoidanceTest.java#L105-L107&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16191164" author="tmueller" created="Wed, 4 Oct 2017 11:48:21 +0000"  >&lt;p&gt;&amp;gt; but we should take deterministic path if traversal can be avoided.&lt;/p&gt;

&lt;p&gt;That&apos;s still the case: if supportsPathRestrictions returns true, the cost of the index is scaled down to the expected number of nodes in this tree, and is at most the number of expected nodes in that tree. So traversal will &lt;em&gt;alway&lt;/em&gt; lose in that case (deterministically).&lt;/p&gt;

&lt;p&gt;Another index can still win however (for example a property index), if it returns a lower cost. But that&apos;s the case even now (with &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-6734&quot; title=&quot;IndexPlan: add supportsPathRestrictions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-6734&quot;&gt;&lt;del&gt;OAK-6734&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="16194639" author="tmueller" created="Fri, 6 Oct 2017 14:16:47 +0000"  >&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/r1811334&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1811334&lt;/a&gt; (trunk)&lt;/p&gt;

&lt;p&gt;still missing is: lucene indexes should return multiple plans, if some indexes do support path restrictions and some not&lt;/p&gt;</comment>
                            <comment id="16253287" author="tmueller" created="Wed, 15 Nov 2017 11:05:50 +0000"  >&lt;p&gt;&amp;gt; lucene indexes should return multiple plans&lt;/p&gt;

&lt;p&gt;Actually I found out that&apos;s wrong: Lucene returns all plans. So I consider this issue resolved.&lt;/p&gt;</comment>
                            <comment id="16283615" author="edivad" created="Fri, 8 Dec 2017 14:23:56 +0000"  >&lt;p&gt;Bulk close 1.7.12&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13105436">OAK-6734</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>OAK-5544</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zjmo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310921" key="com.pyxis.greenhopper.jira:gh-sprint">
                        <customfieldname>Sprint</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="312">L15</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>