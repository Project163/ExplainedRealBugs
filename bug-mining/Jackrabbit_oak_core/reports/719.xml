<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:42:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1471] Mod count in permission store requires cluster wide synchronization</title>
                <link>https://issues.apache.org/jira/browse/OAK-1471</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The current permission store implementation keeps a mod count property on some of the nodes to detect changes and update/invalidate a cache when required. In general this introduces a contention point when there are concurrent modifications of access control entries for a given user. Those concurrent changes may introduce conflicts and commits may have to be retried after a rebase. This still works somewhat OK when there is just a single oak instance, because both segment and document store implementation will eventually fall back to locking and serialize the commits. However, it does not work well in a cluster, unless we apply the same locking cluster wide.&lt;/p&gt;

&lt;p&gt;See also discussion here:&lt;br/&gt;
&lt;a href=&quot;http://markmail.org/message/k64udmgc3ctaqmn2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/message/k64udmgc3ctaqmn2&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12697404">OAK-1471</key>
            <summary>Mod count in permission store requires cluster wide synchronization</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tripod">Tobias Bocanegra</assignee>
                                    <reporter username="mreutegg">Marcel Reutegger</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Feb 2014 17:02:00 +0000</created>
                <updated>Mon, 24 Mar 2014 13:36:39 +0000</updated>
                            <resolved>Thu, 6 Mar 2014 20:59:51 +0000</resolved>
                                                    <fixVersion>0.19</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13921877" author="tripod" created="Thu, 6 Mar 2014 01:59:07 +0000"  >&lt;p&gt;here&apos;s the result on my box before the changes:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Benchmarks: ConcurrentEveryoneACLTest (oak 0.19-SNAPSHOT with everyone cache. modcount)
Fixtures: Oak-Tar
Runtime: 5
Num Items: 1000
Concurrency: 1,2,4,8,10,15,20,50
--------------------------------------
Executing benchmarks as admin: false on Oak-Tar
-----------------------------------------------------------
# ConcurrentEveryoneACLTest ,      C,    min,    10%,    50%,    90%,    max,      N
Oak-Tar                     ,      1,     11,     12,     13,     14,     19,    391
Oak-Tar                     ,      2,     12,     13,     14,     17,     27,    675
Oak-Tar                     ,      4,     15,     16,     19,     23,     55,   1020
Oak-Tar                     ,      8,     31,     50,     53,     56,    114,    743
Oak-Tar                     ,     10,     56,     66,     70,     76,    142,    708
Oak-Tar                     ,     15,     74,    104,    110,    117,    132,    687
Oak-Tar                     ,     20,     92,    136,    145,    154,    169,    698
Oak-Tar                     ,     50,    156,    353,    384,    411,    476,    670
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Benchmarks: ConcurrentReadAccessControlledTreeTest (oak 0.19-SNAPSHOT with everyone cache. modcount)
Fixtures: Oak-Tar
Runtime: 5
Num Items: 1000
Concurrency: 1,2,4,8,10,15,20,50
--------------------------------------
Executing benchmarks as admin: false on Oak-Tar
-----------------------------------------------------------
# ConcurrentReadAccessContro,      C,    min,    10%,    50%,    90%,    max,      N
Oak-Tar                     ,      1,     21,     22,     22,     24,     27,    221
Oak-Tar                     ,      2,     27,     37,     57,     90,    133,    168
Oak-Tar                     ,      4,     30,     43,     96,    223,    538,    173
Oak-Tar                     ,      8,     27,     80,    202,    400,    883,    178
Oak-Tar                     ,     10,     28,     86,    253,    485,    935,    177
Oak-Tar                     ,     15,     27,    120,    381,    767,   1557,    183
Oak-Tar                     ,     20,     33,    150,    536,    980,   2185,    188
Oak-Tar                     ,     50,     28,    337,   1349,   2518,   4114,    210
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Benchmarks: ConcurrentWriteACLTest (0.19-SNAPSHOT, with modcount)
Fixtures: Oak-Mongo
Admin User: true
Runtime: 10
Num Items: 10
Concurrency: 1,2,4,8,10,15,20,50
--------------------------------------
Executing benchmarks as admin: true on Oak-Mongo
-----------------------------------------------------------
# ConcurrentWriteACLTest    ,      C,    min,    10%,    50%,    90%,    max,      N
Oak-Mongo                   ,      1,     48,     58,     66,     77,     96,    150
Oak-Mongo                   ,      2,     46,     54,     63,     81,   5765,    155
Oak-Mongo                   ,      4,     49,     56,     68,     90,  10191,    149
Oak-Mongo                   ,      8,     51,     57,     70,   2193,   9824,    148
Oak-Mongo                   ,     10,     48,     59,     72,   2095,  10714,    148
Oak-Mongo                   ,     15,     50,     62,     79,   4674,  12190,    140
Oak-Mongo                   ,     20,     53,     64,     89,   5161,  12682,    135
Oak-Mongo                   ,     50,     60,     76,   4244,  11767,  15224,    129
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Model Name: MacBook Pro
Model Identifier: MacBookPro10,1
Processor Name: Intel Core i7
Processor Speed: 2.6 GHz
Number of Processors: 1
Total Number of Cores: 4
L2 Cache (per Core): 256 KB
L3 Cache: 6 MB
Memory: 16 GB
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13922470" author="mreutegg" created="Thu, 6 Mar 2014 13:06:47 +0000"  >&lt;p&gt;ConcurrentWriteACLTest is in my view a bit problematic because the probability is quite high that there are conflicts when run with two threads. The test adds access control entries and immediately after removes them again. This means e.g. the key rep%3AGrantACE in the node type index is added and removed very frequently and will lead to conflicts. If there was at least one other rep:GrantACE this wouldn&apos;t be a problem.&lt;/p&gt;

&lt;p&gt;I suggest to modify the test as outlined in the patch.&lt;/p&gt;</comment>
                            <comment id="13922941" author="tripod" created="Thu, 6 Mar 2014 19:34:24 +0000"  >&lt;p&gt;Benchmarks with upcoming solution:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Benchmarks: ConcurrentEveryoneACLTest (0.19-SNAPSHOT, no cache, no modcount)
Runtime: 5
Num Items: 1000
Concurrency: 1,2,4,8,10,15,20,50
--------------------------------------
Executing benchmarks as admin: false on Oak-Tar
-----------------------------------------------------------
# ConcurrentEveryoneACLTest ,      C,    min,    10%,    50%,    90%,    max,      N
Oak-Tar                     ,      1,     18,     18,     19,     22,     24,    257
Oak-Tar                     ,      2,     20,     21,     22,     24,     45,    452
Oak-Tar                     ,      4,     24,     26,     28,     31,     38,    707
Oak-Tar                     ,      8,     45,     95,     98,    102,    109,    409
Oak-Tar                     ,     10,     52,    118,    122,    129,    197,    405
Oak-Tar                     ,     15,     99,    180,    189,    265,    300,    382
Oak-Tar                     ,     20,    206,    236,    248,    326,    365,    392
Oak-Tar                     ,     50,    518,    605,    697,    759,    795,    400
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Benchmarks: ConcurrentReadAccessControlledTreeTest (0.19-SNAPSHOT, no cache, no modcount)
Runtime: 5
Num Items: 1000
Concurrency: 1,2,4,8,10,15,20,50
--------------------------------------
Executing benchmarks as admin: false on Oak-Tar
-----------------------------------------------------------
# ConcurrentReadAccessContro,      C,    min,    10%,    50%,    90%,    max,      N
Oak-Tar                     ,      1,     20,     21,     22,     24,     26,    226
Oak-Tar                     ,      2,     28,     33,     55,     86,    126,    173
Oak-Tar                     ,      4,     28,     49,     97,    201,    364,    178
Oak-Tar                     ,      8,     27,     72,    189,    406,    938,    181
Oak-Tar                     ,     10,     27,    104,    245,    473,   1015,    182
Oak-Tar                     ,     15,     32,    120,    369,    762,   1442,    187
Oak-Tar                     ,     20,     29,    189,    517,    968,   2185,    192
Oak-Tar                     ,     50,     30,    316,   1265,   2386,   3672,    213
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Benchmarks: ConcurrentWriteACLTest (0.19-SNAPSHOT, no cache, no modcount)
Runtime: 10
Num Items: 10
Concurrency: 1,2,4,8,10,15,20,50
--------------------------------------
Executing benchmarks as admin: true on Oak-Mongo
-----------------------------------------------------------
# ConcurrentWriteACLTest    ,      C,    min,    10%,    50%,    90%,    max,      N
Oak-Mongo                   ,      1,     44,     48,     54,     62,     81,    183
Oak-Mongo                   ,      2,     51,     59,     68,     82,    111,    289
Oak-Mongo                   ,      4,     79,    100,    123,    156,    444,    310
Oak-Mongo                   ,      8,    158,    207,    267,    343,    411,    301
Oak-Mongo                   ,     10,    250,    324,    410,    524,    632,    244
Oak-Mongo                   ,     15,    305,    438,    724,    900,   1065,    217
Oak-Mongo                   ,     20,    409,    663,    855,   1053,   1427,    239
Oak-Mongo                   ,     50,    646,   1990,   2326,   2816,   3495,    239
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13922979" author="tripod" created="Thu, 6 Mar 2014 19:59:53 +0000"  >&lt;p&gt;result:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;concurrent writes are almost twice as fast for the lower concurrency range (2-8) but also overall better. at least they show no degradation in through put even for high concurrency.&lt;/li&gt;
	&lt;li&gt;concurrent normal ACL reads are almost the same&lt;/li&gt;
	&lt;li&gt;concurrent everyone reads are about 30% slower, for a test set of 10k everyone ACEs&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13923053" author="tripod" created="Thu, 6 Mar 2014 20:59:51 +0000"  >&lt;p&gt;fixed in 1575041&lt;/p&gt;</comment>
                            <comment id="13945061" author="alex.parvulescu" created="Mon, 24 Mar 2014 13:36:39 +0000"  >&lt;p&gt;Bulk close for the 0.19 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12698894">OAK-1504</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12633120" name="OAK-1471.patch" size="2668" author="mreutegg" created="Thu, 6 Mar 2014 13:06:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>375878</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1srsn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>376174</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>