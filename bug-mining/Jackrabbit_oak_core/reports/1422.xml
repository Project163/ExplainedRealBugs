<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:50:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-3838] IndexPlanner incorrectly lets all full text indices to participate for suggest/spellcheck queries</title>
                <link>https://issues.apache.org/jira/browse/OAK-3838</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Currently, index planner builds plan for suggest/spellcheck queries even if the indices don&apos;t have those functionality enabled.&lt;/p&gt;

&lt;p&gt;Also, there&apos;s another issue: when suggestion/spell-check come into play, we need to dis-allow inheritance behavior of indexingRule. To clarify, a query like &lt;tt&gt;SELECT &lt;span class=&quot;error&quot;&gt;&amp;#91;rep:suggest()&amp;#93;&lt;/span&gt; from &lt;span class=&quot;error&quot;&gt;&amp;#91;nt:unstructured&amp;#93;&lt;/span&gt; where suggest(&apos;test&apos;)&lt;/tt&gt; if using some index preparing suggestions on &lt;tt&gt;nt:base&lt;/tt&gt; would give incorrect suggestions as the index would have suggested values from other type of nodes as well.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12927321">OAK-3838</key>
            <summary>IndexPlanner incorrectly lets all full text indices to participate for suggest/spellcheck queries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="catholicon">Vikas Saurabh</assignee>
                                    <reporter username="catholicon">Vikas Saurabh</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Jan 2016 17:36:14 +0000</created>
                <updated>Tue, 8 Oct 2019 15:21:45 +0000</updated>
                            <resolved>Thu, 7 Jan 2016 14:59:14 +0000</resolved>
                                                    <fixVersion>1.2.14</fixVersion>
                    <fixVersion>1.3.14</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>lucene</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15083455" author="catholicon" created="Tue, 5 Jan 2016 17:49:49 +0000"  >&lt;p&gt;Attaching &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12780584/12780584_OAK-3838.patch&quot; title=&quot;OAK-3838.patch attached to OAK-3838&quot;&gt;OAK-3838.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; where planner, for suggest/spellcheck queries, would validate:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;filter.selecter.nodeTypeName==indexingRule.baseNodeTypeName&lt;/li&gt;
	&lt;li&gt;at least 1 property defn in the index def has useInSuggest/Spellcheck as appropriate.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The &apos;disable node type hierarchy&apos; required a test case due to &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3156&quot; title=&quot;Lucene suggestions index definition can&amp;#39;t be restricted to a specific type of node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3156&quot;&gt;&lt;del&gt;OAK-3156&lt;/del&gt;&lt;/a&gt; (specifically &lt;tt&gt;LuceneIndexSuggestionTest#testSuggestQueryFromMoreGeneralNodeType&lt;/tt&gt;) needed to be inverted.&lt;/p&gt;

&lt;p&gt;Also, I had to expose a getter in SelectorImpl to get nodeTypeName.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt;, I left native query as is (instead of moving to hidden property def) because, native query inherently took care ignoring any other constraint. It does cause some string comparison for the &lt;tt&gt;value.startsWith(&quot;suggest?term=&quot;&lt;/tt&gt; but apart from a bit of dirty code, going for non-native wouldn&apos;t have given any benefit.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=teofili&quot; class=&quot;user-hover&quot; rel=&quot;teofili&quot;&gt;teofili&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt; can you please review?&lt;/p&gt;</comment>
                            <comment id="15083479" author="catholicon" created="Tue, 5 Jan 2016 18:03:10 +0000"  >&lt;p&gt;Have committed the patch in trunk at &lt;a href=&quot;http://svn.apache.org/r1723142&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1723142&lt;/a&gt;. Not resolving the issue yet though.&lt;/p&gt;</comment>
                            <comment id="15084982" author="chetanm" created="Wed, 6 Jan 2016 05:03:02 +0000"  >&lt;p&gt;Some minor comments&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Minor IndexDefinition#evaluateSpellcheckEnabled, IndexDefinition#evaluateSuggestionEnabled - return on matching condition would be better as break would only break out of inner loop&lt;/li&gt;
	&lt;li&gt;Minor Directly get string value from a given property. Any coercion (if required) would be done by PropertyValue itself
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+            PropertyValue pv = filter.getPropertyRestriction(definition.getFunctionName()).first;
+            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; query = &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(pv.getValue(pv.getType()));

Instead use
+            PropertyValue pv = filter.getPropertyRestriction(definition.getFunctionName()).first;
+            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; query = pv.getValue(Type.STRING);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; &lt;/li&gt;
	&lt;li&gt;Also would be good to refactor the new logic in IndexPlanner to a separate method as its very specific.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15085305" author="mreutegg" created="Wed, 6 Jan 2016 09:39:06 +0000"  >&lt;p&gt;I think this commit breaks the build. OSGiIT in oak-run reports:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.osgi.framework.BundleException: Unresolved constraint in bundle org.apache.jackrabbit.oak-lucene [29]: Unable to resolve 29.0: missing requirement [29.0] osgi.wiring.package; (osgi.wiring.package=org.apache.jackrabbit.oak.query.ast))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The ast package is not exported because it was only used internally in oak-core so far.&lt;/p&gt;</comment>
                            <comment id="15085491" author="catholicon" created="Wed, 6 Jan 2016 12:29:16 +0000"  >&lt;p&gt;Sorry for the noise. Reverted it at &lt;a href=&quot;http://svn.apache.org/r1723300&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1723300&lt;/a&gt;. Would discuss how to get queried node type and fix later.&lt;/p&gt;</comment>
                            <comment id="15085594" author="catholicon" created="Wed, 6 Jan 2016 14:45:48 +0000"  >&lt;p&gt;Suggest and spellcheck queries get piggy-backed as native queries (of the form &lt;tt&gt;native-lucene=suggest?term=&amp;lt;text&amp;gt;&lt;/tt&gt;).&lt;/p&gt;

&lt;p&gt;For a node type &lt;tt&gt;Type2&lt;/tt&gt; extending &lt;tt&gt;Type1&lt;/tt&gt; and &lt;tt&gt;Mixin1&lt;/tt&gt;, we get superTypes reported as &lt;tt&gt;Type1, Mixin1, Type2&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Currently, any indexing rule for super types would tend answer queries done on Type2. BUT, suggestions for indices for Type1 or Mixin1 would contain suggestion for nodes which are not on behalf of Type2 (thus containing extraneous data).&lt;/p&gt;

&lt;p&gt;Usually, such extraneous data gets filtered by query engine. But, results from suggestion/spellchek is opaque to query engine and hence would bubble up all the way. &lt;/p&gt;

&lt;p&gt;To avoid this, we want to match &lt;tt&gt;nodeTypeName&lt;/tt&gt; picked by selector exactly to indexing rule defined in the index. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt;, is it fine if we expose &lt;tt&gt;nodeTypeName&lt;/tt&gt; in &lt;tt&gt;Filter&lt;/tt&gt; (like we do for mixinTypes, primaryTypes, superTypes)?&lt;/p&gt;

&lt;p&gt;An alternative to not expose nodeTypeName is that we see if filter.primaryTypes or filter.mixinTypes contains indexingRule.baseNodeType (the indexingRule got picked up becuase filter.superTypes matched indexing rule... and superType intersects with primaryType would give us nodeTypeName). But, I feel that it&apos;s more useful to directly compare 2 strings than look up into 2 sets.&lt;/p&gt;</comment>
                            <comment id="15086205" author="catholicon" created="Wed, 6 Jan 2016 20:14:38 +0000"  >&lt;p&gt;Attaching &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12780828/12780828_OAK-3838-take2.patch&quot; title=&quot;OAK-3838-take2.patch attached to OAK-3838&quot;&gt;OAK-3838-take2.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; which is derivative of the earlier one. Have incorporated suggestions given by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt;. Also, have added &lt;tt&gt;getNodeTypeName&lt;/tt&gt; in &lt;tt&gt;Filter&lt;/tt&gt; and use that from IndexPlanner instead (assuming, that&apos;s how we decide to get queried node type to planner)&lt;/p&gt;</comment>
                            <comment id="15087365" author="tmueller" created="Thu, 7 Jan 2016 13:47:15 +0000"  >&lt;p&gt;OK I understand now. If there is only an index for &quot;nt:base&quot; and the query is for node type &quot;acme&quot;, then the index for &quot;nt:base&quot; can not be used, as the index does not contain nodetype information (and the result is not actually nodes, but suggestions). So, the index for &quot;nt:base&quot; can only be used for a query on &quot;nt:base&quot;.&lt;/p&gt;

&lt;p&gt;As for the method name: we currently have getMixinTypes, getPrimaryTypes, getSupertypes. Those return sets of strings. Therefore, I think the new method should be called just getNodeType and not getNodeTypeName.&lt;/p&gt;</comment>
                            <comment id="15087532" author="catholicon" created="Thu, 7 Jan 2016 14:59:14 +0000"  >&lt;p&gt;Thanks Thomas for the review. Have committed to trunk at &lt;a href=&quot;http://svn.apache.org/r1723565&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1723565&lt;/a&gt;. Resolving the issue.&lt;/p&gt;</comment>
                            <comment id="15112169" author="edivad" created="Fri, 22 Jan 2016 09:21:13 +0000"  >&lt;p&gt;Bulk close for 1.3.14&lt;/p&gt;</comment>
                            <comment id="15229531" author="catholicon" created="Thu, 7 Apr 2016 02:08:39 +0000"  >&lt;p&gt;Backported to 1.2 branch at &lt;a href=&quot;https://svn.apache.org/r1738073&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1738073&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12955649">OAK-4167</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12962627">OAK-4313</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12780828" name="OAK-3838-take2.patch" size="18170" author="catholicon" created="Wed, 6 Jan 2016 20:14:38 +0000"/>
                            <attachment id="12780584" name="OAK-3838.patch" size="15313" author="catholicon" created="Tue, 5 Jan 2016 17:49:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 32 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qtav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>