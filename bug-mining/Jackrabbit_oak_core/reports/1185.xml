<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:47:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2497] Range query with incorrectly formatted date</title>
                <link>https://issues.apache.org/jira/browse/OAK-2497</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Range queries on Date properties, with incorrectly formatted date, return no results (instead of either failing, or returning the expected result). Example date: &lt;tt&gt;2015-01-22T17:10:05.666z&lt;/tt&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12773723">OAK-2497</key>
            <summary>Range query with incorrectly formatted date</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="thomasm">Thomas Mueller</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Feb 2015 07:36:05 +0000</created>
                <updated>Tue, 8 Oct 2019 15:21:36 +0000</updated>
                            <resolved>Tue, 24 Mar 2015 15:13:38 +0000</resolved>
                                                    <fixVersion>1.1.8</fixVersion>
                                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14314206" author="tmueller" created="Tue, 10 Feb 2015 14:11:24 +0000"  >&lt;p&gt;This may have been introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2056&quot; title=&quot;Optimize orderings by date fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2056&quot;&gt;&lt;del&gt;OAK-2056&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14314213" author="tmueller" created="Tue, 10 Feb 2015 14:16:11 +0000"  >&lt;p&gt;The test I made (with Oak trunk actually, and a manually configured ordered index):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;//*[@cq:lastModified &amp;gt;= &apos;1900-01-01T17:10:05.666Z&apos;]
153 results
 
//*[@cq:lastModified &amp;gt;= &apos;1900-01-01T17:10:05.666z&apos;]
0 results
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14314425" author="edivad" created="Tue, 10 Feb 2015 16:27:38 +0000"  >&lt;p&gt;picking this up for investigation.&lt;/p&gt;

&lt;p&gt;Didn&apos;t understand if it&apos;s related to the ordered index only or query engine more in general.&lt;/p&gt;</comment>
                            <comment id="14314654" author="edivad" created="Tue, 10 Feb 2015 18:52:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;the problem does not rely on &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2056&quot; title=&quot;Optimize orderings by date fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2056&quot;&gt;&lt;del&gt;OAK-2056&lt;/del&gt;&lt;/a&gt; as I initially thought rather in&lt;br/&gt;
the ISO8601.parse() from the jackrabbit JCR Commons.&lt;/p&gt;

&lt;p&gt;quoting &lt;a href=&quot;https://www.ietf.org/rfc/rfc3339.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.ietf.org/rfc/rfc3339.txt&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;NOTE: Per ABNF and ISO8601, the &quot;T&quot; and &quot;Z&quot; characters in this&lt;br/&gt;
syntax may alternatively be lower case &quot;t&quot; or &quot;z&quot; respectively.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;currently the parse function does not consider the lowecase &lt;tt&gt;z&lt;/tt&gt; and&lt;br/&gt;
tries to pick the &lt;tt&gt;java.util.TimeZone&lt;/tt&gt; from it which does not exists&lt;br/&gt;
as java expects &lt;tt&gt;Z&lt;/tt&gt; (uppercase).&lt;/p&gt;

&lt;p&gt;We have two solutions here:&lt;/p&gt;

&lt;p&gt;a) We change the jcr-commons and release by changing the parse&lt;br/&gt;
function.&lt;/p&gt;

&lt;p&gt;b) we change our &lt;tt&gt;Conversions.toCalendar()&lt;/tt&gt; for considering the&lt;br/&gt;
lowercase &lt;tt&gt;z&lt;/tt&gt; (and &lt;tt&gt;t&lt;/tt&gt;) to be upcased before passing it to the&lt;br/&gt;
ISO8601.parse().&lt;/p&gt;


&lt;p&gt;In (0) a proposed solution for (b), which means we address it on the&lt;br/&gt;
oak side.&lt;/p&gt;

&lt;p&gt;(0) &lt;a href=&quot;https://github.com/davidegiannella/jackrabbit-oak/commit/03c35cc77cc98f201ccbefa9404d01c95e526c2b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/davidegiannella/jackrabbit-oak/commit/03c35cc77cc98f201ccbefa9404d01c95e526c2b&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;thoughts? If fine I will commit my changes on the oak side.&lt;/p&gt;</comment>
                            <comment id="14316321" author="tmueller" created="Wed, 11 Feb 2015 15:04:38 +0000"  >&lt;p&gt;The current behavior of Oak is: for comparison of type &quot;x &amp;gt; y&quot;, Oak tries to convert y to the type of x. If that fails (and here it does fail), then the types are compared (the PropertyType integer values of the types). This gives a consistent sort order, but it&apos;s unexpected.&lt;/p&gt;

&lt;p&gt;Spec compliance: I don&apos;t think this is specified, but we should check.&lt;/p&gt;

&lt;p&gt;Compatibility with Jackrabbit 2.x: Davide and me tested this with Jackrabbit 2.x, and we don&apos;t fully understand the logic there. I will ask Marcel, maybe he knows the details.&lt;/p&gt;

&lt;p&gt;What we might want to do for this case is convert both values to the same type, and then compare. For example, compare both to a string and then compare. I think that should work, and would be what the user expects. We need to check if there is anything in the spec that would say which type to convert to, given different input types. If one of them is binary, then probably we need to convert to binary (to avoid running out of memory). Then string.&lt;/p&gt;</comment>
                            <comment id="14338114" author="tmueller" created="Thu, 26 Feb 2015 09:05:33 +0000"  >&lt;p&gt;According to the JCR spec at &lt;a href=&quot;http://www.day.com/specs/jcr/2.0/6_Query.html#6.7.16%20Comparison&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.day.com/specs/jcr/2.0/6_Query.html#6.7.16%20Comparison&lt;/a&gt; :&lt;/p&gt;

&lt;p&gt;&quot;If operand1 and operand2 evaluate to values of different property types, the value of operand2 is converted to the property type of the value of operand1 as described in &#167;3.6.4 Property Type Conversion. If the type conversion fails, the query is invalid.&quot;&lt;/p&gt;

&lt;p&gt;About invalid queries:&lt;/p&gt;

&lt;p&gt;&quot;An invalid query causes the repository to throw InvalidQueryException. Which method invocation throws this exception is implementation determined, but for an invalid query, the exception must be thrown no later than completion of the Query.execute().&quot;&lt;/p&gt;

&lt;p&gt;So we should not throw a InvalidQueryException while traversing.&lt;/p&gt;

&lt;p&gt;In many cases, there is no restriction on the property type for a given property name. For such cases, to check if the value can be converted, we would have to traverse the whole result in Query.execute(). That would be slow if the query has many results. So I think that&apos;s not an option for us.&lt;/p&gt;

&lt;p&gt;What we currently do is use an unexpected conversion rule (the property &lt;em&gt;types&lt;/em&gt; are compared).&lt;/p&gt;

&lt;p&gt;I think it&apos;s more reasonable to either: &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;throw a RepositoryException while traversing (at the point when type conversion fails), or&lt;/li&gt;
	&lt;li&gt;use a different, more intuitive conversion rule.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;A similar problem occurs when using &quot;order by x&quot; with a mixed value type of x. About this, the spec says &quot;if v1 is a different property type than v2, the relative order of nt1 and nt2 is implementation determined&quot;.&lt;/p&gt;

&lt;p&gt;What we could do is: If one of the values is a binary, we could compare the binaries. If not, convert both values to a string, and compare the strings.&lt;/p&gt;</comment>
                            <comment id="14338620" author="edivad" created="Thu, 26 Feb 2015 16:09:03 +0000"  >&lt;blockquote&gt;&lt;p&gt;What we could do is: If one of the values is a binary, we could compare the binaries. If not, convert both values to a string, and compare the strings.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14346755" author="edivad" created="Wed, 4 Mar 2015 11:18:31 +0000"  >&lt;p&gt;bulk moving to 1.1.8&lt;/p&gt;</comment>
                            <comment id="14378010" author="tmueller" created="Tue, 24 Mar 2015 15:13:38 +0000"  >&lt;p&gt;Revision 1668914 (trunk)&lt;/p&gt;</comment>
                            <comment id="14482847" author="edivad" created="Tue, 7 Apr 2015 09:09:42 +0000"  >&lt;p&gt;Bulk closing for 1.1.8&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 32 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25erz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>