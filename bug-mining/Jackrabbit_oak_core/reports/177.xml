<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:36:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-520] IllegalStateException in MemoryNodeBuilder</title>
                <link>https://issues.apache.org/jira/browse/OAK-520</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;&lt;tt&gt;AuthorizablePropertyTest.testSetPropertyByRelPath()&lt;/tt&gt; sometimes causes an IllegalStateException in &lt;tt&gt;MemoryNodeBuilder&lt;/tt&gt;. This might be a problem with the latter uncovered by the recent switch to the p2 index mechanism (&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-511&quot; title=&quot;Query PropertyIndex that stores the index content as nodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-511&quot;&gt;&lt;del&gt;OAK-511&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.IllegalStateException
    at com.google.common.base.Preconditions.checkState(Preconditions.java:133)
    at org.apache.jackrabbit.oak.plugins.memory.MemoryNodeBuilder.read(MemoryNodeBuilder.java:205)
    at org.apache.jackrabbit.oak.plugins.memory.MemoryNodeBuilder.getChildNodeNames(MemoryNodeBuilder.java:379)
    at org.apache.jackrabbit.oak.plugins.index.p2.strategy.ContentMirrorStoreStrategy.remove(ContentMirrorStoreStrategy.java:66)
    at org.apache.jackrabbit.oak.plugins.index.p2.Property2IndexUpdate.apply(Property2IndexUpdate.java:143)
    at org.apache.jackrabbit.oak.plugins.index.p2.Property2IndexDiff.apply(Property2IndexDiff.java:232)
    at org.apache.jackrabbit.oak.plugins.index.IndexHookManager.apply(IndexHookManager.java:71)
    at org.apache.jackrabbit.oak.plugins.index.IndexHookManager.processCommit(IndexHookManager.java:61)
    at org.apache.jackrabbit.oak.spi.commit.CompositeHook.processCommit(CompositeHook.java:59)
    at org.apache.jackrabbit.oak.kernel.KernelNodeStoreBranch.merge(KernelNodeStoreBranch.java:127)
    at org.apache.jackrabbit.oak.core.RootImpl$2.run(RootImpl.java:240)
    at org.apache.jackrabbit.oak.core.RootImpl$2.run(RootImpl.java:236)
    at java.security.AccessController.doPrivileged(Native Method)
    at javax.security.auth.Subject.doAs(Subject.java:337)
    at org.apache.jackrabbit.oak.core.RootImpl.commit(RootImpl.java:235)
    at org.apache.jackrabbit.oak.jcr.SessionDelegate.save(SessionDelegate.java:255)
    at org.apache.jackrabbit.oak.jcr.SessionImpl.save(SessionImpl.java:283)
    at org.apache.jackrabbit.oak.jcr.security.user.AbstractUserTest.tearDown(AbstractUserTest.java:72)
    at org.apache.jackrabbit.test.AbstractJCRTest.run(AbstractJCRTest.java:456)
    at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:83)
    at org.junit.runner.JUnitCore.run(JUnitCore.java:157)
    at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:76)
    at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:195)
    at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:63)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
    at com.intellij.rt.execution.application.AppMain.main(AppMain.java:120) 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12623977">OAK-520</key>
            <summary>IllegalStateException in MemoryNodeBuilder</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stillalex">Alex Deparvu</assignee>
                                    <reporter username="mduerig">Michael D&#252;rig</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Dec 2012 14:26:23 +0000</created>
                <updated>Mon, 6 May 2013 15:49:08 +0000</updated>
                            <resolved>Wed, 19 Dec 2012 17:15:41 +0000</resolved>
                                                    <fixVersion>0.6</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13532360" author="alex.parvulescu" created="Fri, 14 Dec 2012 15:04:03 +0000"  >&lt;p&gt;I have removed the offending code with rev 1421913. Next, I&apos;ll try to understand why this is happening.&lt;/p&gt;</comment>
                            <comment id="13532363" author="mduerig" created="Fri, 14 Dec 2012 15:09:04 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    at com.google.common.base.Preconditions.checkState(Preconditions.java:133)
    at org.apache.jackrabbit.oak.plugins.memory.MemoryNodeBuilder.read(MemoryNodeBuilder.java:205)
    at org.apache.jackrabbit.oak.plugins.memory.MemoryNodeBuilder.getChildNodeNames(MemoryNodeBuilder.java:379)
    at org.apache.jackrabbit.oak.plugins.index.p2.strategy.ContentMirrorStoreStrategy.remove(ContentMirrorStoreStrategy.java:66)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The exceptions means, that remove is called on a node that already is removed. &lt;/p&gt;</comment>
                            <comment id="13532370" author="alex.parvulescu" created="Fri, 14 Dec 2012 15:16:37 +0000"  >&lt;p&gt;I think this might be caused by concurrent index updates and the fact that I&apos;m deleting index nodes while in parallel another thread is trying to update them.&lt;br/&gt;
I&apos;m looking at the failing test and it looks like there are overlapping updates among unit tests probably using the same session.&lt;/p&gt;

&lt;p&gt;This makes me reconsider the idea of pruning the index, and if that is even doable with concurrent updates&lt;/p&gt;</comment>
                            <comment id="13532373" author="alex.parvulescu" created="Fri, 14 Dec 2012 15:20:54 +0000"  >&lt;p&gt;&amp;gt; The exceptions means, that remove is called on a node that already is removed.&lt;br/&gt;
Interesting, adding&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (node.isRemoved()) {
  &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;seems to help the test pass &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;But I&apos;m worried about index corruption, deleting a path while an update is in place would not be too good.&lt;/p&gt;</comment>
                            <comment id="13532376" author="mduerig" created="Fri, 14 Dec 2012 15:25:44 +0000"  >&lt;p&gt;Which confirms that the node is already removed at that point. Begs the questions from whom? &lt;/p&gt;
</comment>
                            <comment id="13532378" author="alex.parvulescu" created="Fri, 14 Dec 2012 15:27:30 +0000"  >&lt;p&gt;I&apos;m thinking it is a different update to the same node that comes from another unit test running in parallel.&lt;/p&gt;</comment>
                            <comment id="13532383" author="mduerig" created="Fri, 14 Dec 2012 15:30:19 +0000"  >&lt;p&gt;I improved error reporting for such cases in revision 1421932&lt;/p&gt;</comment>
                            <comment id="13534143" author="alex.parvulescu" created="Mon, 17 Dec 2012 18:18:19 +0000"  >&lt;p&gt;I have refactored the code a bit, but I ran into &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-531&quot; title=&quot;NodeBuilder deleted child nodes can come back&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-531&quot;&gt;&lt;del&gt;OAK-531&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13536151" author="alex.parvulescu" created="Wed, 19 Dec 2012 17:15:41 +0000"  >&lt;p&gt;fixed with rev 1423962.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12624320">OAK-531</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>297876</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 48 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14vs7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>236614</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>