<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:40:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-928] Read access is enforced on NEW items</title>
                <link>https://issues.apache.org/jira/browse/OAK-928</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;as explained in &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-923&quot; title=&quot;Runtime exception while creating a group&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-923&quot;&gt;&lt;del&gt;OAK-923&lt;/del&gt;&lt;/a&gt; we may currently run into the situation where a new Tree is being added because it does not exist but the resulting child does not exist due to restricted access. the same is true for new properties.&lt;/p&gt;

&lt;p&gt;IMHO this breaks backwards compatibility with jackrabbit core.&lt;/p&gt;

&lt;p&gt;i would therefore suggest to&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;extend MutableTree#exists by checking for the tree being new&lt;br/&gt;
  line 390: 
  &lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;            
  - return nodeBuilder.exists();
  + return nodeBuilder.isNew() || nodeBuilder.exists();
  &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;similar behavior for #hasProperty #getProperty, #getProperties and #getPropertyCount (no patch yet).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;however, i would like to get a broader consensus on this kind of modifications as this&lt;br/&gt;
might have side effects in other places.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12659328">OAK-928</key>
            <summary>Read access is enforced on NEW items</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="angela">Angela Schreiber</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Jul 2013 13:12:13 +0000</created>
                <updated>Fri, 13 Dec 2013 09:01:12 +0000</updated>
                            <resolved>Mon, 2 Dec 2013 13:14:45 +0000</resolved>
                                                    <fixVersion>0.13</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13716379" author="mduerig" created="Tue, 23 Jul 2013 13:24:08 +0000"  >&lt;p&gt;(How) is this related to &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-869&quot; title=&quot;Runtime exception while adding node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-869&quot;&gt;&lt;del&gt;OAK-869&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13716389" author="anchela" created="Tue, 23 Jul 2013 13:40:48 +0000"  >&lt;p&gt;most probably this is related... i would consider &quot;this&quot; to be the root cause and the &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-869&quot; title=&quot;Runtime exception while adding node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-869&quot;&gt;&lt;del&gt;OAK-869&lt;/del&gt;&lt;/a&gt; being blocked by this one&lt;br/&gt;
as it only refers to Node#addNode. the same however is true for accessing, adding and modifying properties.&lt;/p&gt;</comment>
                            <comment id="13716393" author="mduerig" created="Tue, 23 Jul 2013 13:46:30 +0000"  >&lt;p&gt;Let&apos;s try to fix it in node builder then. Otherwise semantics for &lt;tt&gt;exists&lt;/tt&gt; will differ between &lt;tt&gt;Tree&lt;/tt&gt; and &lt;tt&gt;NodeBuilder&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="13716395" author="anchela" created="Tue, 23 Jul 2013 13:50:48 +0000"  >&lt;p&gt;fine with me. as stated above i think this is involves a bit more than just make a newly added tree accessible&lt;br/&gt;
and might also have an impact on the commit validation.&lt;/p&gt;</comment>
                            <comment id="13830314" author="jukkaz" created="Fri, 22 Nov 2013 21:09:49 +0000"  >&lt;p&gt;See revision 1544674 for an initial fix. The following &lt;tt&gt;ShadowInvisibleContentTest&lt;/tt&gt; tests still fail:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;testShadowInvisibleProperty&lt;/tt&gt; - Probably needs something like &lt;tt&gt;isReplaced(String propertyName)&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;testShadowInvisibleProperty2&lt;/tt&gt; - This is tricky, as the content diff won&apos;t see any changes. I&apos;d just declare this as an edge case and allow the commit to go through.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;testAddNodeCollidingWithInvisibleNode&lt;/tt&gt; - I think this needs to be fixed in the commit hook that checks for write permissions.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13832984" author="jukkaz" created="Tue, 26 Nov 2013 20:10:42 +0000"  >&lt;p&gt;Revision 1545803  takes care of the &lt;tt&gt;testShadowInvisibleProperty&lt;/tt&gt; test case by adding per-property &lt;tt&gt;isNew&lt;/tt&gt;/&lt;tt&gt;isReplaced&lt;/tt&gt; methods.&lt;/p&gt;

&lt;p&gt;Note that the test case originally made the assumption that the lack of read access also implies lack of write access. However, since the &lt;tt&gt;PermissionValidator&lt;/tt&gt; does not enforce this, I adjusted the test case in revision to highlight the interesting &quot;write-only&quot; behavior. See revision 1545807.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anchela&quot; class=&quot;user-hover&quot; rel=&quot;anchela&quot;&gt;anchela&lt;/a&gt;, can you take a look at the test case update in r1545807 and check whether the logic is sound? It seems to me that such &quot;write-only&quot; semantics would be useful in some cases (for example Unix systems have long used such setups for various purposes) and that&apos;s the way &lt;tt&gt;PermissionValidator&lt;/tt&gt; currently works. But the original &lt;tt&gt;ShadowInvisibleContentTest&lt;/tt&gt; setup (it expected commit() to fail when read access is denied) implied otherwise so I&apos;m not sure if that&apos;s the intended design.&lt;/p&gt;</comment>
                            <comment id="13833026" author="jukkaz" created="Tue, 26 Nov 2013 20:41:33 +0000"  >&lt;p&gt;Revision 1545820 updates and enables the &lt;tt&gt;testShadowInvisibleProperty2&lt;/tt&gt; test. If the added content perfectly matches the read-protected base content, then the commit() becomes a no-op and is successful even if write access is denied. This can be a bit surprising and might potentially expose protected information to a brute-force attacker, but I don&apos;t know how how easy it would be to avoid this. We&apos;d need to keep track of all updates, even when they match pre-existing content, which might be difficult depending on the backends being used.&lt;/p&gt;</comment>
                            <comment id="13833060" author="jukkaz" created="Tue, 26 Nov 2013 21:04:52 +0000"  >&lt;p&gt;Finally in revision 1545833 I enabled the &lt;tt&gt;testAddNodeCollidingWithInvisibleNode&lt;/tt&gt; test case after adjusting it&apos;s expectations to match those of &lt;tt&gt;testShadowInvisibleProperty&lt;/tt&gt; as discussed above.&lt;/p&gt;

&lt;p&gt;This should take care of everything for this issue, so resolving as Fixed.&lt;/p&gt;

&lt;p&gt;I&apos;ll file a followup issue for the &lt;tt&gt;testShadowInvisibleProperty2&lt;/tt&gt; case, as the issue is about write access more than read.&lt;/p&gt;</comment>
                            <comment id="13833759" author="reschke" created="Wed, 27 Nov 2013 13:05:15 +0000"  >&lt;p&gt;This test now frequently fails on my machine. Details:&lt;/p&gt;

&lt;p&gt;Tests run: 4, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.36 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
testAddNodeCollidingWithInvisibleNode(org.apache.jackrabbit.oak.security.authorization.evaluation.ShadowInvisibleContentTest)  Time elapsed: 0.09 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
java.lang.AssertionError&lt;br/&gt;
        at org.junit.Assert.fail(Assert.java:92)&lt;br/&gt;
        at org.junit.Assert.assertTrue(Assert.java:43)&lt;br/&gt;
        at org.junit.Assert.assertTrue(Assert.java:54)&lt;br/&gt;
        at org.apache.jackrabbit.oak.security.authorization.evaluation.ShadowInvisibleContentTest.testAddNodeCollidingWithInvisibleNode(ShadowInvisibleContentTest.java:129)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;/p&gt;</comment>
                            <comment id="13836454" author="reschke" created="Mon, 2 Dec 2013 11:59:44 +0000"  >&lt;p&gt;This tests keep failing on my machine. We need to either disable it, or, better yet, understand and fix the underlying problem.&lt;/p&gt;</comment>
                            <comment id="13836494" author="jukkaz" created="Mon, 2 Dec 2013 13:14:45 +0000"  >&lt;p&gt;I filed a followup issue &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1247&quot; title=&quot;Non-deterministic access control test failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1247&quot;&gt;&lt;del&gt;OAK-1247&lt;/del&gt;&lt;/a&gt; for the test failure, as it doesn&apos;t seem directly related to the functionality addressed in this issue.&lt;/p&gt;</comment>
                            <comment id="13847263" author="alex.parvulescu" created="Fri, 13 Dec 2013 09:01:12 +0000"  >&lt;p&gt;bulk close for the 0.13 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12652622">OAK-869</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12658741">OAK-923</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>339521</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1mk5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>339841</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>