<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:49:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-3169] rep:versionablePaths mixin not always set for versionable nodes</title>
                <link>https://issues.apache.org/jira/browse/OAK-3169</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;For versionable nodes, the &quot;rep:VersionablePaths&quot; mixin and the &quot;{workspaceName}&quot; property is sometimes not set.&lt;/p&gt;

&lt;p&gt;The problem seems to be that VersionablePathHook terminates processing too early if it encounters a hidden node:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public boolean childNodeChanged(String name, NodeState before, NodeState after) {
    if (NodeStateUtils.isHidden(name)) {
        // stop comparison
        return false;  /// &amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt; bug
    }
    ....
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Because the method returns false, processing is completely stopped, that includes processing of sibling nodes and further processing on any parent node.&lt;/p&gt;

&lt;p&gt;The bugfix seems to be &quot;return true&quot; instead of &quot;return false&quot;.&lt;/p&gt;

&lt;p&gt;Remark: It&apos;s quite easy to make this mistake. Maybe we should consider changing NodeStateDiff, and get rid of the return value for this method (change all methods of NodeStateDiff to void). For the &quot;stop any further processing&quot; case, we could use fast exception handling for flow control, for example:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public interface NodeStateDiff {
    // throw this exception to stop any further processing
    Exception STOP_PROCESSING = new Exception();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12850242">OAK-3169</key>
            <summary>rep:versionablePaths mixin not always set for versionable nodes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="thomasm">Thomas Mueller</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Jul 2015 13:55:39 +0000</created>
                <updated>Tue, 8 Oct 2019 15:21:11 +0000</updated>
                            <resolved>Wed, 5 Aug 2015 08:10:43 +0000</resolved>
                                    <version>1.0.16</version>
                    <version>1.0.17</version>
                    <version>1.0.18</version>
                    <version>1.2.3</version>
                    <version>1.3.2</version>
                    <version>1.3.3</version>
                                    <fixVersion>1.0.19</fixVersion>
                    <fixVersion>1.2.4</fixVersion>
                    <fixVersion>1.3.4</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14647689" author="tmueller" created="Thu, 30 Jul 2015 14:31:36 +0000"  >&lt;p&gt;The fix is simple, but we need a good test case.&lt;/p&gt;</comment>
                            <comment id="14647707" author="anchela" created="Thu, 30 Jul 2015 14:40:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt;, thanks for spotting. as far as test-cases are concerned: at the Oak level there are quite some security related tests that create hidden &lt;tt&gt;Tree&lt;/tt&gt;. so, that should be feasible if the default security setup is used later on to run the test, which adds a node with &lt;tt&gt;mix:versionable&lt;/tt&gt; to trigger the &lt;tt&gt;VersionablePathHook&lt;/tt&gt;. &lt;/p&gt;</comment>
                            <comment id="14647714" author="anchela" created="Thu, 30 Jul 2015 14:43:52 +0000"  >&lt;p&gt;one more thing: there might be other areas in the commit that suffer from the a similar problem.... you definitely don&apos;t want to traverse into the tree defined by the hidden node during this commithook... and that&apos;s true for most other commit hooks as well.&lt;/p&gt;</comment>
                            <comment id="14649578" author="reschke" created="Fri, 31 Jul 2015 18:11:15 +0000"  >&lt;p&gt;in the meantime I managed to install an IBM JVM on my system (IBM eclipse tools download contains it); the unit tests that we currently have do not fail though.&lt;/p&gt;</comment>
                            <comment id="14651528" author="reschke" created="Mon, 3 Aug 2015 07:07:16 +0000"  >&lt;p&gt;This appears to be caused by the optimization we did for &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3019&quot; title=&quot;VersionablePathHook must not process hidden nodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3019&quot;&gt;&lt;del&gt;OAK-3019&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14651596" author="mduerig" created="Mon, 3 Aug 2015 08:34:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;Maybe we should consider changing NodeStateDiff, and get rid of the return value.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;-1. If the Javadoc is not clear enough about the semantics of the return value we should change change that. Changing the signature of such a central component at this stage is asking for trouble. Also using exceptions for flow control does not improve this in any way IMO.&lt;/p&gt;</comment>
                            <comment id="14651709" author="jsedding" created="Mon, 3 Aug 2015 10:12:36 +0000"  >&lt;p&gt;Possibly the &lt;tt&gt;VersionablePathHook&lt;/tt&gt; could be migrated to the &lt;tt&gt;Editor&lt;/tt&gt; interface? The callbacks on &lt;tt&gt;Editor&lt;/tt&gt; have more intuitive semantics IMHO. I.e. return an &lt;tt&gt;Editor&lt;/tt&gt; instance if you want the subtree to be processed, &lt;tt&gt;null&lt;/tt&gt; if you want to skip it.&lt;/p&gt;</comment>
                            <comment id="14653213" author="tmueller" created="Tue, 4 Aug 2015 07:38:44 +0000"  >&lt;p&gt;&amp;gt; in the meantime I managed to install an IBM JVM on my system (IBM eclipse tools download contains it); the unit tests that we currently have do not fail though.&lt;/p&gt;

&lt;p&gt;Please note it also depends on the version of the JVM. In the Oracle JVM for example, the iteration order of a HashMap changed in some version (1.6 I think), and may have changed again. It is quite likely it also changed in an IBM JVM.&lt;/p&gt;

&lt;p&gt;&amp;gt; Changing the signature of such a central component at this stage is asking for trouble.&lt;/p&gt;

&lt;p&gt;Sure. Backward compatibility is a problem, and it&apos;s quite a lot of work to change all the code that uses this.&lt;/p&gt;

&lt;p&gt;&amp;gt; If the Javadoc is not clear enough about the semantics of the return value we should change change that. &lt;/p&gt;

&lt;p&gt;Yes, the Javadocs need to be improved.&lt;/p&gt;

&lt;p&gt;We should review all the code that uses this &quot;Diff&quot; mechanism. It&apos;s possible that there are more places were we return the wrong value in some cases, and (as we have seen here) this goes undetected quite easily.&lt;/p&gt;


</comment>
                            <comment id="14653701" author="tmueller" created="Tue, 4 Aug 2015 14:18:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3169&quot; title=&quot;rep:versionablePaths mixin not always set for versionable nodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3169&quot;&gt;&lt;del&gt;OAK-3169&lt;/del&gt;&lt;/a&gt;.patch (including test case)&lt;/p&gt;</comment>
                            <comment id="14653703" author="tmueller" created="Tue, 4 Aug 2015 14:19:07 +0000"  >&lt;p&gt;I had a look at the existing &quot;Diff&quot; methods, I did not find another case where &quot;false&quot; is returned by mistake.&lt;/p&gt;</comment>
                            <comment id="14654986" author="tmueller" created="Wed, 5 Aug 2015 08:09:35 +0000"  >&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/r1694069&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1694069&lt;/a&gt; (trunk)&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/r1694138&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1694138&lt;/a&gt; (1.0 branch)&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/r1694144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1694144&lt;/a&gt; (1.2 branch)&lt;/p&gt;</comment>
                            <comment id="14706621" author="edivad" created="Fri, 21 Aug 2015 12:13:00 +0000"  >&lt;p&gt;Bulk close for 1.3.4&lt;/p&gt;</comment>
                            <comment id="14725113" author="tmueller" created="Tue, 1 Sep 2015 09:57:14 +0000"  >&lt;p&gt;See also &lt;a href=&quot;http://jackrabbit.markmail.org/search/?q=list%3Aorg.apache.jackrabbit.oak-dev++OAK-3169#query:list%3Aorg.apache.jackrabbit.oak-dev%20%20OAK-3169+page:1+mid:wf3dgcbnyfzfeiff+state:results&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jackrabbit.markmail.org/search/?q=list%3Aorg.apache.jackrabbit.oak-dev++OAK-3169#query:list%3Aorg.apache.jackrabbit.oak-dev%20%20OAK-3169+page:1+mid:wf3dgcbnyfzfeiff+state:results&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12839563">OAK-3019</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12851656">OAK-3180</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12748672" name="OAK-3169.patch" size="3445" author="thomasm" created="Tue, 4 Aug 2015 14:18:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2i4dr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>