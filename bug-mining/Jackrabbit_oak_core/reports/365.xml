<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:38:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-825] Unnecessary performance overhead in MongoMK&apos;s calculation of keys for the nodeCache, nodeChildrenCache</title>
                <link>https://issues.apache.org/jira/browse/OAK-825</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The key of MongoMK.nodeCache and nodeChildrenCache is currently a String, whose evaluation is somewhat expensive:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;path + &lt;span class=&quot;code-quote&quot;&gt;&quot;@&quot;&lt;/span&gt; + rev
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the above code, &quot;rev.toString()&quot; internally creates another StringBuilder to generate another intermediate string. The attached screenshot shows that around 5% of profiling time within &quot;MongoMK.getNode()&quot; is wasted in order to calculate the caching key. Other methods are also affected.&lt;/p&gt;

&lt;p&gt;A simple way to improve this is to reuse a single StringBuilder for the key, as such:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;StringBuilder sb = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringBuilder();
sb.append(path);
sb.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;@&quot;&lt;/span&gt;);
rev.appendTo(sb);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A better way would probably be to wrap &quot;path&quot; and &quot;rev&quot; in another re-usable &quot;NodeRev&quot; object to be used instead of using two references &quot;path&quot; and &quot;rev&quot;. The &quot;NodeRev&quot; object would provide appropriate equals() and hashCode() implementations.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12647957">OAK-825</key>
            <summary>Unnecessary performance overhead in MongoMK&apos;s calculation of keys for the nodeCache, nodeChildrenCache</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="lukas.eder">Lukas Eder</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 May 2013 13:19:46 +0000</created>
                <updated>Mon, 10 Feb 2014 13:51:27 +0000</updated>
                            <resolved>Thu, 30 Jan 2014 19:26:21 +0000</resolved>
                                    <version>0.7</version>
                                    <fixVersion>0.16</fixVersion>
                                    <component>mongomk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13659552" author="tmueller" created="Thu, 16 May 2013 14:08:06 +0000"  >&lt;p&gt;Using a NodeRev class sounds like a good solution.&lt;/p&gt;

&lt;p&gt;The biggest performance problem I see in my tests is that MongoDB documents can grow very large, because they are not split. I will first have a look at this problem.&lt;/p&gt;</comment>
                            <comment id="13886437" author="mreutegg" created="Thu, 30 Jan 2014 09:21:23 +0000"  >&lt;p&gt;This becomes a more pressing issue with the DocumentNodeStore because there are many more calls on the cache compared to DocumentMK, which has a KernelNodeStore on top of it with another cache.&lt;/p&gt;</comment>
                            <comment id="13886955" author="mreutegg" created="Thu, 30 Jan 2014 19:26:21 +0000"  >&lt;p&gt;Changed the caches to use a CacheValue instead of a String for the keys with implementations for a simple String and String/Revision combo.&lt;/p&gt;

&lt;p&gt;In addition I also enabled the LIRS cache in DocumentNodeStore. Benchmark tests with heavy read load show better performance with this cache compared to the Guava implementation.&lt;/p&gt;

&lt;p&gt;Fixed in &lt;a href=&quot;http://svn.apache.org/r1562847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1562847&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13896545" author="alex.parvulescu" created="Mon, 10 Feb 2014 13:51:27 +0000"  >&lt;p&gt;bulk close for the 0.16 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12583477" name="MongoMK.nodeCache.png" size="85391" author="lukas.eder" created="Thu, 16 May 2013 13:20:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328313</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1kn9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328657</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>