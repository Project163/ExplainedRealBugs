<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:52:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-5545] Replica Set Info seems to close and open Mongo connections in a loop</title>
                <link>https://issues.apache.org/jira/browse/OAK-5545</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The Replica Set Info should keep a pool of direct connections to each replica set member (so it can get the recent info about the replicated revisions). It&#8217;s maintained by NodeCollectionProvider. It seems that the connection are being closed, even though they are still used:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;24.01.2017 13:33:42.238 *INFO* [MongoDocumentStore replica set info provider (0)] org.mongodb.driver.cluster Cluster created with settings {hosts=[10.40.66.214:27019], mode=SINGLE, requiredClusterType=UNKNOWN, serverSelectionTimeout=&apos;30000 ms&apos;, maxWaitQueueSize=500}
24.01.2017 13:33:42.239 *INFO* [MongoDocumentStore replica set info provider (0)] org.mongodb.driver.cluster No server chosen by ReadPreferenceServerSelector{readPreference=primary} from cluster description ClusterDescription{type=UNKNOWN, connectionMode=SINGLE, serverDescriptions=[ServerDescription{address=10.40.66.214:27019, type=UNKNOWN, state=CONNECTING}]}. Waiting for 30000 ms before timing out
24.01.2017 13:33:42.241 *INFO* [cluster-ClusterId{value=&apos;58870a5e30806985f2fc331e&apos;, description=&apos;null&apos;}-10.40.66.214:27019] org.mongodb.driver.connection Opened connection [connectionId{localValue:3190, serverValue:32190}] to 10.40.66.214:27019
24.01.2017 13:33:42.241 *INFO* [cluster-ClusterId{value=&apos;58870a5e30806985f2fc331e&apos;, description=&apos;null&apos;}-10.40.66.214:27019] org.mongodb.driver.cluster Monitor thread successfully connected to server with description ServerDescription{address=10.40.66.214:27019, type=REPLICA_SET_PRIMARY, state=CONNECTED, ok=true, version=ServerVersion{versionList=[3, 2, 1]}, minWireVersion=0, maxWireVersion=4, maxDocumentSize=16777216, roundTripTimeNanos=452055, setName=&apos;replica&apos;, canonicalAddress=10.40.66.214:27019, hosts=[no1010040066196.corp.adobe.com:27019, 10.40.66.214:27019, 10.40.66.183:27019], passives=[], arbiters=[], primary=&apos;10.40.66.214:27019&apos;, tagSet=TagSet{[]}, electionId=57c968610000000000000005, setVersion=3, lastWriteDate=null, lastUpdateTimeNanos=14416412141118257}
24.01.2017 13:33:42.244 *INFO* [MongoDocumentStore replica set info provider (0)] org.mongodb.driver.connection Opened connection [connectionId{localValue:3191, serverValue:32191}] to 10.40.66.214:27019
24.01.2017 13:33:42.245 *INFO* [MongoDocumentStore replica set info provider (0)] org.mongodb.driver.connection Closed connection [connectionId{localValue:3191, serverValue:32191}] to 10.40.66.214:27019 because the pool has been closed.
24.01.2017 13:33:47.248 *INFO* [MongoDocumentStore replica set info provider (0)] org.mongodb.driver.cluster Cluster created with settings {hosts=[10.40.66.214:27019], mode=SINGLE, requiredClusterType=UNKNOWN, serverSelectionTimeout=&apos;30000 ms&apos;, maxWaitQueueSize=500}
24.01.2017 13:33:47.249 *INFO* [MongoDocumentStore replica set info provider (0)] org.mongodb.driver.cluster No server chosen by ReadPreferenceServerSelector{readPreference=primary} from cluster description ClusterDescription{type=UNKNOWN, connectionMode=SINGLE, serverDescriptions=[ServerDescription{address=10.40.66.214:27019, type=UNKNOWN, state=CONNECTING}]}. Waiting for 30000 ms before timing out
24.01.2017 13:33:47.264 *INFO* [cluster-ClusterId{value=&apos;58870a6330806985f2fc331f&apos;, description=&apos;null&apos;}-10.40.66.214:27019] org.mongodb.driver.connection Opened connection [connectionId{localValue:3192, serverValue:32194}] to 10.40.66.214:27019
24.01.2017 13:33:47.265 *INFO* [cluster-ClusterId{value=&apos;58870a6330806985f2fc331f&apos;, description=&apos;null&apos;}-10.40.66.214:27019] org.mongodb.driver.cluster Monitor thread successfully connected to server with description ServerDescription{address=10.40.66.214:27019, type=REPLICA_SET_PRIMARY, state=CONNECTED, ok=true, version=ServerVersion{versionList=[3, 2, 1]}, minWireVersion=0, maxWireVersion=4, maxDocumentSize=16777216, roundTripTimeNanos=416028, setName=&apos;replica&apos;, canonicalAddress=10.40.66.214:27019, hosts=[no1010040066196.corp.adobe.com:27019, 10.40.66.214:27019, 10.40.66.183:27019], passives=[], arbiters=[], primary=&apos;10.40.66.214:27019&apos;, tagSet=TagSet{[]}, electionId=57c968610000000000000005, setVersion=3, lastWriteDate=null, lastUpdateTimeNanos=14416417164730588}
24.01.2017 13:33:47.268 *INFO* [MongoDocumentStore replica set info provider (0)] org.mongodb.driver.connection Opened connection [connectionId{localValue:3193, serverValue:32195}] to 10.40.66.214:27019
24.01.2017 13:33:47.269 *INFO* [MongoDocumentStore replica set info provider (0)] org.mongodb.driver.connection Closed connection [connectionId{localValue:3193, serverValue:32195}] to 10.40.66.214:27019 because the pool has been closed.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13038842">OAK-5545</key>
            <summary>Replica Set Info seems to close and open Mongo connections in a loop</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tomek.rekawek">Tomek R&#281;kawek</assignee>
                                    <reporter username="tomek.rekawek">Tomek R&#281;kawek</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Jan 2017 09:06:45 +0000</created>
                <updated>Mon, 13 Feb 2017 14:32:24 +0000</updated>
                            <resolved>Mon, 30 Jan 2017 09:53:59 +0000</resolved>
                                    <version>1.5.18</version>
                                    <fixVersion>1.6.0</fixVersion>
                                    <component>mongomk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15844993" author="tomek.rekawek" created="Mon, 30 Jan 2017 09:53:54 +0000"  >&lt;p&gt;Fixed for trunk in &lt;a href=&quot;https://svn.apache.org/r1780886&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1780886&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15863747" author="egli" created="Mon, 13 Feb 2017 14:23:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tomek.rekawek&quot; class=&quot;user-hover&quot; rel=&quot;tomek.rekawek&quot;&gt;tomek.rekawek&lt;/a&gt;, just trying to understand this change, so&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/cc0c01c52f38da9f96be95140f96fb25a58e0406/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/mongo/replica/ReplicaSetInfo.java#L287&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;previously&lt;/a&gt; that &lt;tt&gt;retain&lt;/tt&gt; is invoked with secondaries only&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/094426bb996b3e10730be0636480dcc3335e6a05/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/document/mongo/replica/ReplicaSetInfo.java#L288&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;with this change&lt;/a&gt; that &lt;tt&gt;retain&lt;/tt&gt; is invoked with secondaries &lt;b&gt;and&lt;/b&gt; the primary&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;was retaining the primary the goal of this fix then?&lt;/p&gt;</comment>
                            <comment id="15863751" author="tomek.rekawek" created="Mon, 13 Feb 2017 14:30:09 +0000"  >&lt;p&gt;The goal of this fix is indeed retaining the primary. Without it, the primary connection is being removed from the connection pool. As a result, without this fix, the primary connection was recreated every few seconds.&lt;/p&gt;</comment>
                            <comment id="15863752" author="egli" created="Mon, 13 Feb 2017 14:32:24 +0000"  >&lt;p&gt;That makes sense then, thx for the explanation!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="13042573">OAK-5636</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 39 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i39cy7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>