<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:47:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2784] Remove Nullable annotation in Predicates of BackgroundObserver</title>
                <link>https://issues.apache.org/jira/browse/OAK-2784</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; getLocalEventCount() {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; size(filter(queue, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Predicate&amp;lt;ContentChange&amp;gt;() {
                    @Override
                    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; apply(@Nullable ContentChange input) {
                        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; input.info != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
                    }
                }));
            }

            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; getExternalEventCount() {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; size(filter(queue, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Predicate&amp;lt;ContentChange&amp;gt;() {
                    @Override
                    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; apply(@Nullable ContentChange input) {
                        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; input.info == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
                    }
                }));
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;both methods should probably check for &lt;tt&gt;input&lt;/tt&gt; being null before accessing &lt;tt&gt;input.info&lt;/tt&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12821795">OAK-2784</key>
            <summary>Remove Nullable annotation in Predicates of BackgroundObserver</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chetanm">Chetan Mehrotra</assignee>
                                    <reporter username="angela">Angela Schreiber</reporter>
                        <labels>
                            <label>technical_debt</label>
                    </labels>
                <created>Fri, 17 Apr 2015 07:50:32 +0000</created>
                <updated>Wed, 2 Mar 2016 11:37:37 +0000</updated>
                            <resolved>Tue, 21 Apr 2015 09:46:59 +0000</resolved>
                                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14499421" author="anchela" created="Fri, 17 Apr 2015 07:52:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt;], since you introduced that code just yesterday... maybe you can take a quick look and get it fixed?&lt;br/&gt;
btw: you can most probably configure your IDE to spot that kind of issues right away.&lt;/p&gt;</comment>
                            <comment id="14502453" author="mduerig" created="Mon, 20 Apr 2015 07:18:08 +0000"  >&lt;p&gt;The code is actually correct as the queue being filtered cannot contain &lt;tt&gt;null&lt;/tt&gt; values. So I suggest we ignore the warning here as any runtime test incurs additional cost. &lt;/p&gt;

&lt;p&gt;On a more general note, the annotation based mechanism to detect null-ability is too crude to detect more subtle cases as these. This has already been noted around the &lt;tt&gt;SessionDelegate#perform&lt;/tt&gt; mechanism. So I suggest to not stretch it too far. &lt;/p&gt;</comment>
                            <comment id="14502641" author="chetanm" created="Mon, 20 Apr 2015 11:07:52 +0000"  >&lt;p&gt;+1. Also the Javadoc of Predicate allows for that&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Predicate&amp;lt;T&amp;gt; {
  /**
   * Returns the result of applying &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; predicate to {@code input}. This method is &amp;lt;i&amp;gt;generally
   * expected&amp;lt;/i&amp;gt;, but not absolutely required, to have the following properties:
   *
   * &amp;lt;ul&amp;gt;
   * &amp;lt;li&amp;gt;Its execution does not cause any observable side effects.
   * &amp;lt;li&amp;gt;The computation is &amp;lt;i&amp;gt;consistent with equals&amp;lt;/i&amp;gt;; that is, {@link Objects#equal
   *     Objects.equal}{@code (a, b)} implies that {@code predicate.apply(a) ==
   *     predicate.apply(b))}.
   * &amp;lt;/ul&amp;gt;
   *
   * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; NullPointerException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; {@code input} is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; and &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; predicate does not accept &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
   *     arguments
   */
  &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; apply(@Nullable T input);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A NPE is possible if the predicate does not accept null&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anchela&quot; class=&quot;user-hover&quot; rel=&quot;anchela&quot;&gt;anchela&lt;/a&gt; I am inclined to close this issue as &quot;Not a problem&quot;&lt;/p&gt;</comment>
                            <comment id="14504525" author="anchela" created="Tue, 21 Apr 2015 07:41:18 +0000"  >&lt;p&gt;while i agree that the code currently works, i don&apos;t agree with the conclusion: as the code base evolves, other people refactoring or adjusting it, this is prone for causing issues. i would at least add a comment explicitly stating that the argument must never be null to make it totally unambiguous for someone else that might in the future work on this.&lt;/p&gt;

&lt;p&gt;maybe i just did too many code review during the last year.... but what i saw was exactly this kind of pattern: someone writing code that for sure originally worked and was clear to the original author. unfortunately he/she suffered from code amnesia or someone else had to take over and fixing issues here and there or adding you features. what happens is that later on the code is no longer clear, devs usually don&apos;t have time to properly fix it or simply didn&apos;t get the original intention and such after years resulting in code that is really poor, not maintainable and not fixable except for a complete rewrite (which nobody is willing to do).&lt;/p&gt;</comment>
                            <comment id="14504619" author="mreutegg" created="Tue, 21 Apr 2015 08:44:24 +0000"  >&lt;p&gt;I&apos;d suggest we remove the Nullable annotation and adjust the summary of this issue accordingly. See attached patch.&lt;/p&gt;

&lt;p&gt;I think this is in line with the &lt;tt&gt;Predicate&lt;/tt&gt; contract and makes it clear the implementations in BackgroundObserver expect a non-null input.&lt;/p&gt;</comment>
                            <comment id="14504627" author="mduerig" created="Tue, 21 Apr 2015 08:50:16 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14504695" author="chetanm" created="Tue, 21 Apr 2015 09:46:59 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt;! This was the right fix as &lt;tt&gt;Nullable&lt;/tt&gt; annotation was giving wrong indication. With this patch Findbugs seems to be happy as well&lt;/p&gt;

&lt;p&gt;Also thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anchela&quot; class=&quot;user-hover&quot; rel=&quot;anchela&quot;&gt;anchela&lt;/a&gt; for taking note of this and following up. For future I would be more careful on how this annotation is left and also keep a check on findbug&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;FileStats path=&lt;span class=&quot;code-quote&quot;&gt;&quot;org/apache/jackrabbit/oak/spi/commit/BackgroundObserver.java&quot;&lt;/span&gt; bugCount=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; size=&lt;span class=&quot;code-quote&quot;&gt;&quot;172&quot;&lt;/span&gt;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Applied the patch to trunk in &lt;a href=&quot;http://svn.apache.org/r1675074&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1675074&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14586027" author="edivad" created="Mon, 15 Jun 2015 13:46:07 +0000"  >&lt;p&gt;Bulk Close for 1.3.0&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12726828" name="OAK-2784.patch" size="1194" author="mreutegg" created="Tue, 21 Apr 2015 08:44:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 22 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2de2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>