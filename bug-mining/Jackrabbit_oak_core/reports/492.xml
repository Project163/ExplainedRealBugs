<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:40:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-783] Reflect Move and Rename upon Root#commit</title>
                <link>https://issues.apache.org/jira/browse/OAK-783</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;right now rename and move operations cannot be identified during &lt;br/&gt;
commit processing in validators or commit hooks.&lt;/p&gt;

&lt;p&gt;for proper (and backwards compatible) permission evaluation however&lt;br/&gt;
we need the ability to distinguish between moving a node around or&lt;br/&gt;
having nodes + properties being removed and added.&lt;/p&gt;

&lt;p&gt;during the last oakathon michael and myself had a discussion regarding&lt;br/&gt;
that issue and michael convinced me that this can&apos;t be achieved by simply&lt;br/&gt;
passing the move information contained in RootImpl to the commit hook.&lt;/p&gt;

&lt;p&gt;therefore creating this issue to track progress and discussions regarding&lt;br/&gt;
move and renaming.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12643231">OAK-783</key>
            <summary>Reflect Move and Rename upon Root#commit</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="angela">Angela Schreiber</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Apr 2013 14:31:14 +0000</created>
                <updated>Mon, 13 Jan 2014 13:05:58 +0000</updated>
                            <resolved>Wed, 11 Dec 2013 15:13:09 +0000</resolved>
                                                    <fixVersion>0.14</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13635226" author="mduerig" created="Thu, 18 Apr 2013 14:55:43 +0000"  >&lt;p&gt;We could attach the path of the source of a moved node (i.e. the path it has in its base revision) to that node. We could use some kind of a hidden property which is never persisted for that. That is, the property is attached when the transient move is initiated, it is used in the commit hooks to determine whether an add node event is effectively the result of a moved node, and it would be removed (ignored) when persisting the branch on commit. &lt;/p&gt;

&lt;p&gt;AFAIK this information would be enough to regain a sequence of move operations that would take the base state to the current head state. See &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/trunk/doc/jsop-diff.md&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/blob/trunk/doc/jsop-diff.md&lt;/a&gt; for a description of such an algorithm and &lt;a href=&quot;https://github.com/mduerig/json-diff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mduerig/json-diff&lt;/a&gt; for a POC implementation. &lt;/p&gt;</comment>
                            <comment id="13802891" author="mduerig" created="Wed, 23 Oct 2013 14:16:25 +0000"  >&lt;p&gt;Initial prototype: &lt;a href=&quot;https://github.com/mduerig/jackrabbit-oak/commit/a74ea2095d5a3aea2e27dbc0b18038eec11f315a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mduerig/jackrabbit-oak/commit/a74ea2095d5a3aea2e27dbc0b18038eec11f315a&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13804194" author="mduerig" created="Thu, 24 Oct 2013 13:51:11 +0000"  >&lt;p&gt;At &lt;a href=&quot;http://svn.apache.org/r1535380&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1535380&lt;/a&gt;. I committed an initial implementation for move detection in the &lt;tt&gt;MoveDetector&lt;/tt&gt; class. A &lt;tt&gt;MoveDetector&lt;/tt&gt; is a &lt;tt&gt;Validator&lt;/tt&gt; that can detect certain move operations and reports these to a wrapped &lt;tt&gt;MoveValidator&lt;/tt&gt; by calling its &lt;tt&gt;move()&lt;/tt&gt;. That method is called additional to &lt;tt&gt;MoveValidator.childNodeAdded()&lt;/tt&gt; for the destination of the move operation and &lt;tt&gt;MoveValidator.childNodeDeleted()&lt;/tt&gt; for the source of the move operation.&lt;/p&gt;

&lt;p&gt;Detection of move operations relies on the presence of the &lt;tt&gt;:source-path&lt;/tt&gt; property on moved nodes. New nodes with this property set have been moved from the path indicated by the value of the property to its current location.&lt;/p&gt;

&lt;p&gt;Limitations:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Moving a moved node only reports one move from the original source to the final target.&lt;/li&gt;
	&lt;li&gt;Moving a transiently added node is not reported as a move operation but as an add operation on the move target.&lt;/li&gt;
	&lt;li&gt;Moving a child node of a transiently moved node is not reported as a move operation but as an add operation on the move target.&lt;/li&gt;
	&lt;li&gt;Moving a node back and forth to its original location is not reported at all.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I will add further tests to &lt;tt&gt;MoveDetectorTest&lt;/tt&gt; demonstrating these limitations. &lt;/p&gt;</comment>
                            <comment id="13804204" author="anchela" created="Thu, 24 Oct 2013 13:58:37 +0000"  >&lt;p&gt;cool... thanks for the effort. very much appreciated. &lt;br/&gt;
i will use it in the permission validator and can also add more permission related tests to see/demonstrate how big the impact of the limitations will be in that area.&lt;/p&gt;</comment>
                            <comment id="13869503" author="alex.parvulescu" created="Mon, 13 Jan 2014 13:05:58 +0000"  >&lt;p&gt;bulk close for the 0.14 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12637950">OAK-710</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12675483">OAK-1115</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12675251">OAK-1110</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323641</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 44 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ju6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323986</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>