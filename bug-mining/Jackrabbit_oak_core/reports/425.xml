<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:39:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-929] Permission changes not visible on root after refresh</title>
                <link>https://issues.apache.org/jira/browse/OAK-929</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;it looks like there is an issue on updating permission for the root node.&lt;/p&gt;

&lt;p&gt;If the permission for the root are changed those are not &quot;refreshed&quot;.&lt;/p&gt;

&lt;p&gt;Any other nodes different than root seems to work though&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12659567">OAK-929</key>
            <summary>Permission changes not visible on root after refresh</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mduerig">Michael D&#252;rig</assignee>
                                    <reporter username="asanso">Antonio Sanso</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Jul 2013 13:26:04 +0000</created>
                <updated>Fri, 20 Sep 2013 07:01:39 +0000</updated>
                            <resolved>Fri, 26 Jul 2013 09:01:16 +0000</resolved>
                                                    <fixVersion>0.9</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13718359" author="asanso" created="Wed, 24 Jul 2013 13:30:18 +0000"  >&lt;p&gt;attaching test patch &lt;/p&gt;</comment>
                            <comment id="13718451" author="anchela" created="Wed, 24 Jul 2013 15:05:15 +0000"  >&lt;p&gt;ui... nice catch.&lt;/p&gt;

&lt;p&gt;i had a quick look and from what i can see the permission provider is properly updated. i.e. a subsequent call to getReadStatus for the root node will return the expected deny (was allow before). &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;jukkaz&lt;/a&gt; could there be an issue with refreshing the root tree?&lt;/p&gt;</comment>
                            <comment id="13718453" author="anchela" created="Wed, 24 Jul 2013 15:06:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=asanso&quot; class=&quot;user-hover&quot; rel=&quot;asanso&quot;&gt;asanso&lt;/a&gt; the test patch should remove the ACE created at the root node as this is not part of the regular teardown and would cause other test to fail (if the bug wasn&apos;t there &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="13719441" author="mduerig" created="Thu, 25 Jul 2013 09:43:35 +0000"  >&lt;p&gt;This is caused by an outdated &lt;tt&gt;SecurityContext&lt;/tt&gt; after calling &lt;tt&gt;Root.refresh&lt;/tt&gt;. The &lt;tt&gt;SecurityContext&lt;/tt&gt; is acquired in the constructor of &lt;tt&gt;RootImpl&lt;/tt&gt; and tied to the root node state current at that time. Calling &lt;tt&gt;Root.refresh&lt;/tt&gt; resets the underlying &lt;tt&gt;NodeBuilder&lt;/tt&gt; rendering that node state outdated.&lt;/p&gt;</comment>
                            <comment id="13719661" author="mduerig" created="Thu, 25 Jul 2013 14:35:04 +0000"  >&lt;p&gt;Just had a chat with Angela and Jukka. The root cause of this is &lt;tt&gt;SecureNodeBuilder&lt;/tt&gt; not resetting its &lt;tt&gt;SecurityContext&lt;/tt&gt; on calling its &lt;tt&gt;reset&lt;/tt&gt; method. I&apos;ll try to come up with a fix that moves acquisition of the &lt;tt&gt;SecurityContext&lt;/tt&gt; into &lt;tt&gt;SecureNodeBuilder&lt;/tt&gt; and re-acquires it whenever &lt;tt&gt;reset&lt;/tt&gt; is called.  &lt;/p&gt;</comment>
                            <comment id="13719730" author="mduerig" created="Thu, 25 Jul 2013 16:01:55 +0000"  >&lt;p&gt;Fixed at revision 1507027&lt;/p&gt;</comment>
                            <comment id="13719748" author="anchela" created="Thu, 25 Jul 2013 16:23:56 +0000"  >&lt;p&gt;reopening as IMHO the test case should completely restore the original&lt;br/&gt;
state of the root node and not leave an allow-ACE left that hasn&apos;t been&lt;br/&gt;
there before.&lt;/p&gt;

&lt;p&gt;reason: the test creates ACEs for the user principal which will take&lt;br/&gt;
precedence over group principals -&amp;gt; this is quite likely to cause inconsistencies&lt;br/&gt;
or even failures with other tests that expect only the original test-setup to be present (one allow-read ACE for the everyone group on the root node).&lt;/p&gt;

&lt;p&gt;as far as the second test is concerned which creates an ACE at &apos;path&apos; the&lt;br/&gt;
finally clause is not required as the complete test root is being removed in the test teardown.&lt;/p&gt;

&lt;p&gt;thanks for fixing.&lt;/p&gt;</comment>
                            <comment id="13720477" author="mduerig" created="Fri, 26 Jul 2013 07:03:23 +0000"  >&lt;p&gt;Isn&apos;t the &lt;tt&gt;allow&lt;/tt&gt; call in the finally block inverse to the &lt;tt&gt;deny&lt;/tt&gt; earlier on?  Please advise. &lt;/p&gt;</comment>
                            <comment id="13720490" author="anchela" created="Fri, 26 Jul 2013 07:22:43 +0000"  >&lt;p&gt;it will remove the deny entry and add a new allow entry but doesn&apos;t restore the original state of the root node.&lt;br/&gt;
so, the finally clause should rather remove the ACE created before.&lt;/p&gt;

&lt;p&gt;therefore i would suggest to do something like&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;collect ACEs present on the root before&lt;/li&gt;
	&lt;li&gt;add the deny entry for the test&lt;/li&gt;
	&lt;li&gt;finally obtain the ACL for the root path and remove all entries that have not been present before&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Set&amp;lt;AccessControlEntry&amp;gt; acesBefore = ....
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
   &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; the test
&lt;/span&gt;} &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
   AccessControlList acl = o.a.j.commons.j.authorization.AccessControlUtils.getAccessControlList(superuser, rootPath);
   &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (acl != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (AccessControlEntry ace : acl.getAccessControlEntries()) {
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!acesBefore.contains(ace) {
              acl.removeAccessControlEntry(ace);
          }
      }
      acManager.setPolicy(rootPath, acl);
      superuser.save();
   }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;alternatively, we can move the test to a separate test class that creates it&apos;s private content repository.&lt;br/&gt;
but that would most probably more effort to do.&lt;/p&gt;</comment>
                            <comment id="13720554" author="mduerig" created="Fri, 26 Jul 2013 09:01:16 +0000"  >&lt;p&gt;Added clean up as suggested at revision 1507225. Thanks for clarifying.&lt;/p&gt;</comment>
                            <comment id="13772776" author="alex.parvulescu" created="Fri, 20 Sep 2013 07:01:39 +0000"  >&lt;p&gt;Bulk close for the 0.9 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12593935" name="OAK-929-patch.txt" size="1049" author="asanso" created="Wed, 24 Jul 2013 13:30:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>339760</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1mlmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>340079</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>