<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:49:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-3400] ClusterNodeInfo should not be osgi-dependent (for lease check failure handling)</title>
                <link>https://issues.apache.org/jira/browse/OAK-3400</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Currently the ClusterNodeInfo wants an (osgi) ComponentContext so that it can do a bundle-stop on lease failure.&lt;/p&gt;

&lt;p&gt;However, osgi-dependency we should only have in DocumentNodeStoreService - and not in DocumentNodeStore/ClusterNodeInfo etc.&lt;/p&gt;

&lt;p&gt;So instead of passing a ComponentContext, let the builder have a LeaseFailureHandler which will be passed to the ClusterNodeInfo.&lt;/p&gt;

&lt;p&gt;This blocks the IT tests - hence critical&lt;/p&gt;</description>
                <environment>&lt;p&gt;Affects revision 1.3.6+: 1702958&lt;/p&gt;</environment>
        <key id="12863892">OAK-3400</key>
            <summary>ClusterNodeInfo should not be osgi-dependent (for lease check failure handling)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stefanegli">Stefan Egli</assignee>
                                    <reporter username="stefanegli">Stefan Egli</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Sep 2015 14:12:53 +0000</created>
                <updated>Wed, 2 Mar 2016 14:27:05 +0000</updated>
                            <resolved>Mon, 14 Sep 2015 15:04:36 +0000</resolved>
                                                    <fixVersion>1.3.7</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14743560" author="mreutegg" created="Mon, 14 Sep 2015 14:15:38 +0000"  >&lt;p&gt;The failing test is in oak-remote:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Tests run: 240, Failures: 0, Errors: 80, Skipped: 0, Time elapsed: 22.381 sec &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.jackrabbit.oak.remote.http.handler.RemoteServerIT
testReadLastRevisionTreeMultiStringProperty[0](org.apache.jackrabbit.oak.remote.http.handler.RemoteServerIT)  Time elapsed: 0.007 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.NoClassDefFoundError: org/osgi/framework/BundleException
	at java.net.URLClassLoader$1.run(URLClassLoader.java:366)
	at java.net.URLClassLoader$1.run(URLClassLoader.java:355)
	at java.security.AccessController.doPrivileged(Native Method)
	at java.net.URLClassLoader.findClass(URLClassLoader.java:354)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:425)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:358)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStore.&amp;lt;init&amp;gt;(DocumentNodeStore.java:432)
	at org.apache.jackrabbit.oak.plugins.document.DocumentMK$Builder.getNodeStore(DocumentMK.java:637)
	at org.apache.jackrabbit.oak.NodeStoreFixture$2.createNodeStore(NodeStoreFixture.java:57)
	at org.apache.jackrabbit.oak.OakBaseTest.&amp;lt;init&amp;gt;(OakBaseTest.java:73)
	at org.apache.jackrabbit.oak.remote.http.handler.RemoteServerIT.&amp;lt;init&amp;gt;(RemoteServerIT.java:78)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14743615" author="egli" created="Mon, 14 Sep 2015 14:47:06 +0000"  >&lt;p&gt;fixed in &lt;a href=&quot;http://svn.apache.org/r1702963&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1702963&lt;/a&gt; - waiting for ITs to succeed before declaring victory&lt;/p&gt;</comment>
                            <comment id="14743643" author="egli" created="Mon, 14 Sep 2015 15:04:36 +0000"  >&lt;p&gt;I still get some ITs failing - but I can&apos;t see any connection to clusterNodeInfo/lease-handling - thus closing this ticket&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Running org.apache.jackrabbit.oak.jcr.tck.VersionIT
Tests run: 1416, Failures: 1, Errors: 2, Skipped: 0, Time elapsed: 220.493 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!
testRestoreOrderJcr2_4(org.apache.jackrabbit.test.api.version.RestoreTest)  Time elapsed: 1.528 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
junit.framework.AssertionFailedError: Failed to create versionable test node.OakMerge0004: The node 3:/jcr:system/jcr:versionStorage/32 was already added in revision
r14fcc5e050f-0-1, before
r14fcc5ea10d-0-1
	at junit.framework.Assert.fail(Assert.java:50)
	at org.apache.jackrabbit.test.api.version.AbstractVersionTest.setUp(AbstractVersionTest.java:86)
	at org.apache.jackrabbit.test.api.version.RestoreTest.setUp(RestoreTest.java:62)
	at junit.framework.TestCase.runBare(TestCase.java:132)
	at junit.framework.TestResult$1.protect(TestResult.java:110)
	at junit.framework.TestResult.runProtected(TestResult.java:128)
	at junit.framework.TestResult.run(TestResult.java:113)
	at junit.framework.TestCase.run(TestCase.java:124)
	at org.apache.jackrabbit.test.AbstractJCRTest.run(AbstractJCRTest.java:464)
	at junit.framework.TestSuite.runTest(TestSuite.java:243)
	at junit.framework.TestSuite.run(TestSuite.java:238)
	at junit.framework.TestSuite.runTest(TestSuite.java:243)
	at junit.framework.TestSuite.run(TestSuite.java:238)
	at junit.framework.TestSuite.runTest(TestSuite.java:243)
	at junit.framework.TestSuite.run(TestSuite.java:238)
	at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:83)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:252)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:141)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:112)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:189)
	at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:165)
	at org.apache.maven.surefire.booter.ProviderFactory.invokeProvider(ProviderFactory.java:85)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:115)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:75)

testRestoreOrder2Jcr2_2(org.apache.jackrabbit.test.api.version.RestoreTest)  Time elapsed: 5.172 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
javax.jcr.InvalidItemStateException: OakMerge0004: The node 4:/jcr:system/jcr:versionStorage/5c/13 was already added in revision
r14fcc5fe22a-0-1, before
r14fcc5ff652-0-1
	at org.apache.jackrabbit.oak.api.CommitFailedException.asRepositoryException(CommitFailedException.java:239)
	at org.apache.jackrabbit.oak.api.CommitFailedException.asRepositoryException(CommitFailedException.java:212)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.newRepositoryException(SessionDelegate.java:672)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.save(SessionDelegate.java:497)
	at org.apache.jackrabbit.oak.jcr.session.SessionImpl$8.performVoid(SessionImpl.java:425)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.performVoid(SessionDelegate.java:275)
	at org.apache.jackrabbit.oak.jcr.session.SessionImpl.save(SessionImpl.java:422)
	at org.apache.jackrabbit.test.api.version.RestoreTest.setUp(RestoreTest.java:72)
	at junit.framework.TestCase.runBare(TestCase.java:132)
	at junit.framework.TestResult$1.protect(TestResult.java:110)
	at junit.framework.TestResult.runProtected(TestResult.java:128)
	at junit.framework.TestResult.run(TestResult.java:113)
	at junit.framework.TestCase.run(TestCase.java:124)
	at org.apache.jackrabbit.test.AbstractJCRTest.run(AbstractJCRTest.java:464)
	at junit.framework.TestSuite.runTest(TestSuite.java:243)
	at junit.framework.TestSuite.run(TestSuite.java:238)
	at junit.framework.TestSuite.runTest(TestSuite.java:243)
	at junit.framework.TestSuite.run(TestSuite.java:238)
	at junit.framework.TestSuite.runTest(TestSuite.java:243)
	at junit.framework.TestSuite.run(TestSuite.java:238)
	at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:83)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:252)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:141)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:112)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:189)
	at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:165)
	at org.apache.maven.surefire.booter.ProviderFactory.invokeProvider(ProviderFactory.java:85)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:115)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:75)
Caused by: org.apache.jackrabbit.oak.plugins.document.FailedWithConflictException: OakMerge0004: The node 4:/jcr:system/jcr:versionStorage/5c/13 was already added in revision
r14fcc5fe22a-0-1, before
r14fcc5ff652-0-1
	at org.apache.jackrabbit.oak.plugins.document.ConflictException.asCommitFailedException(ConflictException.java:59)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreBranch$InMemory.merge(DocumentNodeStoreBranch.java:494)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreBranch.merge0(DocumentNodeStoreBranch.java:173)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreBranch.merge(DocumentNodeStoreBranch.java:129)
	at org.apache.jackrabbit.oak.plugins.document.DocumentRootBuilder.merge(DocumentRootBuilder.java:158)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStore.merge(DocumentNodeStore.java:1544)
	at org.apache.jackrabbit.oak.core.MutableRoot.commit(MutableRoot.java:247)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.commit(SessionDelegate.java:348)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.save(SessionDelegate.java:495)
	... 29 more
Caused by: org.apache.jackrabbit.oak.plugins.document.ConflictException: The node 4:/jcr:system/jcr:versionStorage/5c/13 was already added in revision
r14fcc5fe22a-0-1, before
r14fcc5ff652-0-1
	at org.apache.jackrabbit.oak.plugins.document.Commit.checkConflicts(Commit.java:579)
	at org.apache.jackrabbit.oak.plugins.document.Commit.createOrUpdateNode(Commit.java:485)
	at org.apache.jackrabbit.oak.plugins.document.Commit.applyToDocumentStore(Commit.java:369)
	at org.apache.jackrabbit.oak.plugins.document.Commit.applyToDocumentStore(Commit.java:263)
	at org.apache.jackrabbit.oak.plugins.document.Commit.applyInternal(Commit.java:232)
	at org.apache.jackrabbit.oak.plugins.document.Commit.apply(Commit.java:217)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreBranch.persist(DocumentNodeStoreBranch.java:282)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreBranch.persist(DocumentNodeStoreBranch.java:252)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreBranch.access$300(DocumentNodeStoreBranch.java:54)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreBranch$InMemory.merge(DocumentNodeStoreBranch.java:490)
	... 36 more

testRestoreOrder2Jcr2_3(org.apache.jackrabbit.test.api.version.RestoreTest)  Time elapsed: 0.337 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.IllegalStateException: Base version does not exist.
	at org.apache.jackrabbit.oak.jcr.version.ReadWriteVersionManager.getExistingBaseVersion(ReadWriteVersionManager.java:254)
	at org.apache.jackrabbit.oak.jcr.version.ReadWriteVersionManager.checkin(ReadWriteVersionManager.java:118)
	at org.apache.jackrabbit.oak.jcr.delegate.VersionManagerDelegate.checkin(VersionManagerDelegate.java:66)
	at org.apache.jackrabbit.oak.jcr.version.VersionManagerImpl$7.perform(VersionManagerImpl.java:355)
	at org.apache.jackrabbit.oak.jcr.version.VersionManagerImpl$7.perform(VersionManagerImpl.java:346)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.perform(SessionDelegate.java:209)
	at org.apache.jackrabbit.oak.jcr.version.VersionManagerImpl.checkin(VersionManagerImpl.java:346)
	at org.apache.jackrabbit.test.api.version.RestoreTest.setUp(RestoreTest.java:69)
	at junit.framework.TestCase.runBare(TestCase.java:132)
	at junit.framework.TestResult$1.protect(TestResult.java:110)
	at junit.framework.TestResult.runProtected(TestResult.java:128)
	at junit.framework.TestResult.run(TestResult.java:113)
	at junit.framework.TestCase.run(TestCase.java:124)
	at org.apache.jackrabbit.test.AbstractJCRTest.run(AbstractJCRTest.java:464)
	at junit.framework.TestSuite.runTest(TestSuite.java:243)
	at junit.framework.TestSuite.run(TestSuite.java:238)
	at junit.framework.TestSuite.runTest(TestSuite.java:243)
	at junit.framework.TestSuite.run(TestSuite.java:238)
	at junit.framework.TestSuite.runTest(TestSuite.java:243)
	at junit.framework.TestSuite.run(TestSuite.java:238)
	at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:83)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:252)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:141)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:112)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:189)
	at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:165)
	at org.apache.maven.surefire.booter.ProviderFactory.invokeProvider(ProviderFactory.java:85)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:115)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:75)


Results :

Failed tests:   testRestoreOrderJcr2_4(org.apache.jackrabbit.test.api.version.RestoreTest): Failed to create versionable test node.OakMerge0004: The node 3:/jcr:system/jcr:versionStorage/32 was already added in revision(..)

Tests in error: 
  testRestoreOrder2Jcr2_2(org.apache.jackrabbit.test.api.version.RestoreTest): OakMerge0004: The node 4:/jcr:system/jcr:versionStorage/5c/13 was already added in revision(..)
  testRestoreOrder2Jcr2_3(org.apache.jackrabbit.test.api.version.RestoreTest): Base version does not exist.

Tests run: 6479, Failures: 1, Errors: 2, Skipped: 22

[INFO] 
[INFO] --- maven-bundle-plugin:2.5.3:baseline (baseline) @ oak-jcr ---
[INFO] Baseline analysis complete, 0 error(s), 0 warning(s)
[INFO] 
[INFO] --- maven-failsafe-plugin:2.12.4:verify (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) @ oak-jcr ---
[INFO] Failsafe report directory: /Users/egli/svn/oak/oak-jcr/target/failsafe-reports
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Summary:
[INFO] 
[INFO] Oak Parent POM ..................................... SUCCESS [  2.899 s]
[INFO] Oak Commons ........................................ SUCCESS [ 13.869 s]
[INFO] Oak Blob Store ..................................... SUCCESS [  7.875 s]
[INFO] Oak Cloud Blob Store ............................... SUCCESS [  8.911 s]
[INFO] Oak Core ........................................... SUCCESS [06:38 min]
[INFO] Oak JCR Binding .................................... FAILURE [09:08 min]
[INFO] Oak upgrade ........................................ SKIPPED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;/cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14939263" author="amitjain" created="Thu, 1 Oct 2015 03:35:18 +0000"  >&lt;p&gt;Bulk close for 1.3.7&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 7 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2k4yf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>