<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:48:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-3324] Evaluation with restriction is not consistent with parent ACLs</title>
                <link>https://issues.apache.org/jira/browse/OAK-3324</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;consider the following ACL setup:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;testuser allow rep:read,rep:write      /testroot
testuser deny  jcr:removeNode /testroot/a  glob=*/c
testuser allow jcr:removeNode /testroot/a  glob=*/b
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;now: &lt;tt&gt;hasPermission(/tesroot/a/b/c, jcr:removeNode) == false&lt;/tt&gt; but the user is still able to delete the node.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;if we change the order of the ACEs with the restriction, it works (i.e. the user can&apos;t delete)&lt;/li&gt;
	&lt;li&gt;if we use direct ACLs on the respective nodes, it works&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think this is a bug...but I&apos;m not sure if &lt;tt&gt;hasPermission&lt;/tt&gt; is wrong, or the check during node deletion.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12860965">OAK-3324</key>
            <summary>Evaluation with restriction is not consistent with parent ACLs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tripod">Tobias Bocanegra</assignee>
                                    <reporter username="tripod">Tobias Bocanegra</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Sep 2015 10:34:11 +0000</created>
                <updated>Wed, 2 Mar 2016 12:13:25 +0000</updated>
                            <resolved>Fri, 4 Sep 2015 16:43:51 +0000</resolved>
                                    <version>1.3.4</version>
                                    <fixVersion>1.0.21</fixVersion>
                    <fixVersion>1.3.6</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14725177" author="tripod" created="Tue, 1 Sep 2015 10:53:04 +0000"  >&lt;p&gt;added test case &lt;tt&gt;oak-core/src/test/java/org/apache/jackrabbit/oak/security/authorization/restriction/PermissionTest.java&lt;/tt&gt; in r1700484&lt;/p&gt;</comment>
                            <comment id="14725289" author="tripod" created="Tue, 1 Sep 2015 12:07:57 +0000"  >&lt;p&gt;added same test in jackrabbit for comparison: r1700513.&lt;/p&gt;

&lt;p&gt;in Jackrabbit, this works as expected.&lt;/p&gt;</comment>
                            <comment id="14730683" author="tripod" created="Fri, 4 Sep 2015 11:54:22 +0000"  >&lt;p&gt;just realised the difference between &lt;tt&gt;hasPrivilege()&lt;/tt&gt; and &lt;tt&gt;isGranted()&lt;/tt&gt; - so the test was wrong.&lt;/p&gt;

&lt;p&gt;added updated test in r1701223.&lt;/p&gt;

&lt;p&gt;however, there is still an inconsistency in the way how restrictions are evaluated.&lt;br/&gt;
in the the case of:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;testuser allow rep:read,rep:write      /testroot
testuser deny  jcr:removeNode /testroot/a  glob=*/c
testuser allow jcr:removeNode /testroot/a  glob=*/b
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the user is granted REMOVE_NODE on /a/b/c, since the evaluation considers both entries on /testroot/a, when it checks the parent of &apos;c&apos; (because the REMOVE_NODE requires a check of the parent).&lt;br/&gt;
but the user is not granted REMOVE_NODE on /a/b/c/d, since the evaluation aborts after it encounters the deny.&lt;/p&gt;

&lt;p&gt;see &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-core/src/test/java/org/apache/jackrabbit/oak/security/authorization/restriction/PermissionTest.java#L150&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-core/src/test/java/org/apache/jackrabbit/oak/security/authorization/restriction/PermissionTest.java#L150&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14730736" author="tripod" created="Fri, 4 Sep 2015 12:45:25 +0000"  >&lt;p&gt;also see &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3351&quot; title=&quot;Add ability to prioritise restriction to where it matches&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3351&quot;&gt;&lt;del&gt;OAK-3351&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14730754" author="tripod" created="Fri, 4 Sep 2015 12:59:21 +0000"  >&lt;p&gt;improved test in r1701241. &lt;/p&gt;

&lt;p&gt;the problem is indeed that the parent ACL is read for the REMOVE_NODE permission.&lt;br/&gt;
when testing a permission that does not require the parent node ACL, like MODIFY_PROPERTY it works.&lt;/p&gt;

&lt;p&gt;see org.apache.jackrabbit.oak.security.authorization.restriction.CustomRestrictionProviderTest#testProtectByRestriction&lt;/p&gt;</comment>
                            <comment id="14730876" author="tripod" created="Fri, 4 Sep 2015 14:27:03 +0000"  >&lt;p&gt;I think we need to define how the restrictions should work. do they work like virtual ACEs wherever they match, or are only effective where they are defined, but activated if an item matches them.&lt;/p&gt;

&lt;p&gt;further we need to define, if they inherit the permissions down like normal ACEs.&lt;/p&gt;

&lt;p&gt;for example, consider this test:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;// allow rep:write          /testroot
// deny  jcr:modifyProperties /testroot/a  glob=*/c
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;this currently evaluates like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;assertIsGranted(pp, testRoot, true , TEST_A_PATH, Permissions.MODIFY_PROPERTY);
assertIsGranted(pp, testRoot, true, TEST_B_PATH, Permissions.MODIFY_PROPERTY);
assertIsGranted(pp, testRoot, false, TEST_C_PATH, Permissions.MODIFY_PROPERTY);
assertIsGranted(pp, testRoot, true, TEST_D_PATH, Permissions.MODIFY_PROPERTY);
assertIsGranted(pp, testRoot, true, TEST_E_PATH, Permissions.MODIFY_PROPERTY);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so the D and E nodes are not affected by the restriction that is effective on C. If this is the desired behavior, it should also work like this for REMOVE_NODE and ADD_NODE.&lt;/p&gt;

&lt;p&gt;the same setup with REMOVE_NODE shows this behavior:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;assertIsGranted(pp, testRoot, true, TEST_A_PATH, Permissions.REMOVE_NODE);
assertIsGranted(pp, testRoot, true, TEST_B_PATH, Permissions.REMOVE_NODE);
assertIsGranted(pp, testRoot, false, TEST_C_PATH, Permissions.REMOVE_NODE);
assertIsGranted(pp, testRoot, false, TEST_D_PATH, Permissions.REMOVE_NODE);
assertIsGranted(pp, testRoot, true, TEST_E_PATH, Permissions.REMOVE_NODE);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;which is completely inconsistent.&lt;/p&gt;</comment>
                            <comment id="14731041" author="tripod" created="Fri, 4 Sep 2015 16:43:51 +0000"  >&lt;p&gt;fixed in r1701290 by applying the same logic to permissions that respect the parent entry that is used for permissions that only respect the privileges on the entry.&lt;/p&gt;</comment>
                            <comment id="14731071" author="tripod" created="Fri, 4 Sep 2015 17:13:37 +0000"  >&lt;p&gt;backported to 1.0 in r1701297&lt;/p&gt;</comment>
                            <comment id="14733320" author="mreutegg" created="Mon, 7 Sep 2015 07:10:36 +0000"  >&lt;p&gt;Adjusted fix version. Next release from trunk is 1.3.6.&lt;/p&gt;</comment>
                            <comment id="14735035" author="kwin" created="Tue, 8 Sep 2015 15:55:39 +0000"  >&lt;p&gt;Wouldn&apos;t it make sense to backport that to the 1.2 branch as well?&lt;/p&gt;</comment>
                            <comment id="14902126" author="mreutegg" created="Tue, 22 Sep 2015 07:19:45 +0000"  >&lt;p&gt;Bulk close for Oak 1.3.6 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jn73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>