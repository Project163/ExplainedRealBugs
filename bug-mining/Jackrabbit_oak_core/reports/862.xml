<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:44:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1763] OrderedIndex does not comply with JCR&apos;s compareTo semantics</title>
                <link>https://issues.apache.org/jira/browse/OAK-1763</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The ordered index currently uses the lexicographical order of the string representation of the values. This does not comply with &lt;a href=&quot;http://www.day.com/specs/jcr/2.0/3_Repository_Model.html#3.6.5.1%20CompareTo%20Semantics&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JCR&apos;s compareTo sementics &lt;/a&gt; for e.g. double values. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12710066">OAK-1763</key>
            <summary>OrderedIndex does not comply with JCR&apos;s compareTo semantics</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mduerig">Michael D&#252;rig</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Apr 2014 15:48:02 +0000</created>
                <updated>Wed, 2 Mar 2016 15:32:47 +0000</updated>
                            <resolved>Fri, 29 May 2015 13:14:55 +0000</resolved>
                                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>6</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13978343" author="mduerig" created="Wed, 23 Apr 2014 15:50:45 +0000"  >&lt;p&gt;Test case at &lt;a href=&quot;http://svn.apache.org/r1589443&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1589443&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13979417" author="edivad" created="Thu, 24 Apr 2014 07:55:22 +0000"  >&lt;p&gt;In the index we receive only Strings and &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/property/strategy/IndexStoreStrategy.java#L39&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;no knowledge of the original type&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;IndexStoreStrategy.update(NodeBuilder, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;, Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;while a proper fix would require an API change that pass down the original type I could add some heuristic inspection of the value to see if it&apos;s a number/decimal or not and adding therefore padding of &lt;tt&gt;&lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/property/PropertyIndex.java#L86&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;MAX_STRING_LENGTH&lt;/a&gt;&lt;/tt&gt; &lt;tt&gt;0s&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Would that suit?&lt;/p&gt;</comment>
                            <comment id="13979434" author="mduerig" created="Thu, 24 Apr 2014 08:13:56 +0000"  >&lt;p&gt;I wouldn&apos;t go for the heuristic as it could be wrong in the case where people intentionally put numbers in strings. It would e.g. change the place in a list of strings where the &quot;numbers would go&quot;. Also how would you handle doubles? e.g. 2.0E17 &amp;lt; 1.0E18 but &quot;2.0E17&quot; &amp;gt; &quot;1.0E18&quot;.&lt;/p&gt;

&lt;p&gt;If we want to resolve this by encoding the values to strings such that the lexicographical order of the encoded values correspond to the compareTo semantics of the underlying values then &lt;tt&gt;org.apache.jackrabbit.oak.plugins.index.property.PropertyIndex#encode&lt;/tt&gt; would probably be the right place to do that. &lt;/p&gt;</comment>
                            <comment id="13979449" author="mduerig" created="Thu, 24 Apr 2014 08:29:22 +0000"  >&lt;p&gt;I just noted that the URL encoding done in &lt;tt&gt;PropertyIndex#encode&lt;/tt&gt; can result in a wrong sort order of string properties. See test case at &lt;a href=&quot;http://svn.apache.org/r1589632&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1589632&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13979454" author="edivad" created="Thu, 24 Apr 2014 08:35:28 +0000"  >&lt;p&gt;Probably the best solution is to pass down to the&lt;br/&gt;
IndexStoreStrategy.update() the PropertyValue itself and leave it&lt;br/&gt;
decide what to do with it. The PropertyIndex (the base one) will&lt;br/&gt;
always call the encode from there while the OrderedIndex (extension of&lt;br/&gt;
Property) could decide to perform any other operation before encoding.&lt;/p&gt;

&lt;p&gt;About the heuristic approach I was thinking something around the&lt;br/&gt;
following (typed straight and didn&apos;t tested. Could have errors)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Pattern number =
       Pattern.compile(&lt;span class=&quot;code-quote&quot;&gt;&quot;^-?\\d+(\\.(0E)?\\d+)?$&quot;&lt;/span&gt;);
&lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// key = &lt;span class=&quot;code-quote&quot;&gt;&quot;2.0E17&quot;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (number.matcher(key).matches()) {
   &lt;span class=&quot;code-comment&quot;&gt;// it&apos;s a numeric stuff. &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt; should fit &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; and &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt; as well.
&lt;/span&gt;   &lt;span class=&quot;code-comment&quot;&gt;// surround the following with &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;/&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;
&lt;/span&gt;   &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt; d = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;(key);
   &lt;span class=&quot;code-comment&quot;&gt;// fetching the nodes from the index &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; comparison
&lt;/span&gt;   &lt;span class=&quot;code-comment&quot;&gt;// value = &amp;lt;current-node-value&amp;gt;
&lt;/span&gt;   &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (number.matcher(value).matches()) {
      &lt;span class=&quot;code-comment&quot;&gt;// numeric with numeric
&lt;/span&gt;      &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt; v = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;(value):
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( v.compareTo(d) &amp;gt; 0) {
         &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;      }
      &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;   }
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
  &lt;span class=&quot;code-comment&quot;&gt;// any other string
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13979458" author="edivad" created="Thu, 24 Apr 2014 08:42:20 +0000"  >&lt;p&gt;RE the order and encode... &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/property/strategy/OrderedContentMirrorStoreStrategy.java#L311&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;that&apos;s my bad&lt;/a&gt;... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I should have used &lt;tt&gt;&lt;a href=&quot;http://docs.oracle.com/javase/6/docs/api/java/net/URLDecoder.html#decode%28java.lang.String,%20java.lang.String%29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;URLDecoder.decode()&lt;/a&gt;&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;One of those stuff done on a hurry and then forgotten...&lt;/p&gt;

&lt;p&gt;Maybe filing a different bug for that?&lt;/p&gt;</comment>
                            <comment id="13979482" author="mduerig" created="Thu, 24 Apr 2014 09:04:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;Probably the best solution is to pass down to the IndexStoreStrategy.update() the PropertyValue itself and leave it decide what to do with it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Something along these lines might work best here... right.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;About the heuristic approach...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not sure whether this works correctly e.g for cases like [&quot;goofy&quot;, &quot;42&quot;, &quot;Arthur&quot;]. How would you ensure that numbers are compared as strings here?&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;Maybe filing a different bug for that?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Might make sense yes. &lt;/p&gt;


</comment>
                            <comment id="13979492" author="edivad" created="Thu, 24 Apr 2014 09:15:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;Not sure whether this works correctly e.g for cases like &lt;tt&gt;[&quot;goofy&quot;, &quot;42&quot;, &quot;Arthur&quot;]&lt;/tt&gt;. How would you ensure that numbers are compared as strings here?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;well I didn&apos;t type functioning code &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Anyhow taking from the example&lt;br/&gt;
above and expanding the idea&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// value = &amp;lt;current-node-value&amp;gt;
&lt;/span&gt;   &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (number.matcher(value).matches()) {
      &lt;span class=&quot;code-comment&quot;&gt;// numeric with numeric
&lt;/span&gt;      &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt; v = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;(value):
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( v.compareTo(d) &amp;gt; 0) {
         &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;      }
      &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;   } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
     &lt;span class=&quot;code-comment&quot;&gt;// we fall back on &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; comparison.
&lt;/span&gt;   }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I know it won&apos;t really address mixed situations where we have Strings&lt;br/&gt;
with numbers and Strings with &quot;string&quot; as property value but IMO in&lt;br/&gt;
the vast majority of cases the indexed properties will be consistent;&lt;br/&gt;
something like: &lt;tt&gt;status=ABORTED&lt;/tt&gt; or &lt;tt&gt;pinned=1&lt;/tt&gt; or&lt;br/&gt;
&lt;tt&gt;endTime=2013-02-03&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;As said, the proper solution would be passing down the PropertyValue&lt;br/&gt;
itself down the stream and let each conten strategy decide if/what to&lt;br/&gt;
do with that. The above is a patch for avoiding an API change.&lt;/p&gt;</comment>
                            <comment id="14092733" author="edivad" created="Mon, 11 Aug 2014 12:46:57 +0000"  >&lt;p&gt;As said in &lt;a href=&quot;http://markmail.org/message/k363be3q7bodz6jn&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;oak-dev&lt;/a&gt; even the date encoding is affected even if marginally as the timezone will rarely change on the server side.&lt;/p&gt;

&lt;p&gt;Nevertheless a proposed solution for encoding of dates is something like the following&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://gist.github.com/davidegiannella/e278a8178f151bef1150&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/davidegiannella/e278a8178f151bef1150&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;edit&lt;/b&gt;. As the encoding applies to longs it could be reused for numbers as well.&lt;/p&gt;</comment>
                            <comment id="14092742" author="mduerig" created="Mon, 11 Aug 2014 13:07:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;the timezone will rarely change on the server side.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This doesn&apos;t depend on the server&apos;s time zone but on the one specified by the client:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;2014-04-22T10:11:24.002+01:00&quot;&lt;/span&gt;, PropertyType.DATE)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Will save the date property as string with the value &lt;tt&gt;2014-04-22T10:11:24.002+01:00&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;See also &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1111&quot; title=&quot;Node#setProperty(String, Calendar) doesn&amp;#39;t take time zone in account&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1111&quot;&gt;&lt;del&gt;OAK-1111&lt;/del&gt;&lt;/a&gt; for a related discussion. &lt;/p&gt;</comment>
                            <comment id="14519872" author="mmarth" created="Wed, 29 Apr 2015 18:18:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=edivad&quot; class=&quot;user-hover&quot; rel=&quot;edivad&quot;&gt;edivad&lt;/a&gt;, do you think we should still address this?&lt;/p&gt;</comment>
                            <comment id="14521077" author="edivad" created="Thu, 30 Apr 2015 07:45:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mmarth&quot; class=&quot;user-hover&quot; rel=&quot;mmarth&quot;&gt;mmarth&lt;/a&gt; as with &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2653&quot; title=&quot;Deprecate ordered index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2653&quot;&gt;&lt;del&gt;OAK-2653&lt;/del&gt;&lt;/a&gt; we deprecated the ordered index; I would not spend time on this. Other than an Oak customer find good reasons for not using Lucene Property Index instead.&lt;/p&gt;</comment>
                            <comment id="14564781" author="mduerig" created="Fri, 29 May 2015 13:14:55 +0000"  >&lt;p&gt;Won&apos;t fix thus&lt;/p&gt;</comment>
                            <comment id="14585955" author="edivad" created="Mon, 15 Jun 2015 13:45:02 +0000"  >&lt;p&gt;Bulk Close for 1.3.0&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12753413">OAK-2258</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12733498">OAK-2028</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>388388</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 22 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1uwjr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>388643</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>