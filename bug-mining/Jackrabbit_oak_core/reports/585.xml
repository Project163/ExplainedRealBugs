<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:41:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1254] Parallel execution of SimpleSearchTest fails with MongoMK</title>
                <link>https://issues.apache.org/jira/browse/OAK-1254</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;At some point in the benchmark run one MongoMK instance will fail to read a node created by another instance. The exception is very similar to &lt;b&gt;E1&lt;/b&gt; reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1204&quot; title=&quot;Analyze behaviour while running Oak cluster on Mongo&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1204&quot;&gt;&lt;del&gt;OAK-1204&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12682331">OAK-1254</key>
            <summary>Parallel execution of SimpleSearchTest fails with MongoMK</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="mreutegg">Marcel Reutegger</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Dec 2013 08:28:04 +0000</created>
                <updated>Mon, 13 Jan 2014 13:05:58 +0000</updated>
                            <resolved>Tue, 7 Jan 2014 08:50:41 +0000</resolved>
                                    <version>0.12</version>
                                    <fixVersion>0.14</fixVersion>
                                    <component>core</component>
                    <component>mongomk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13837458" author="mreutegg" created="Tue, 3 Dec 2013 08:42:05 +0000"  >&lt;p&gt;Added a standalone test to oak-jcr in &lt;a href=&quot;http://svn.apache.org/r1547314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1547314&lt;/a&gt; to reproduce the exception. The test basically does the same as three concurrently running SimpleSearchTest benchmarks targeting the same MongoDB but it is executed in a single JVM. I&apos;ll try to further strip it down.&lt;/p&gt;</comment>
                            <comment id="13843181" author="mreutegg" created="Mon, 9 Dec 2013 14:14:39 +0000"  >&lt;p&gt;Added a simplified test in &lt;a href=&quot;http://svn.apache.org/r1549576&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1549576&lt;/a&gt;. A rebased branch does not see changes correctly from another cluster node when some changes from the other node are published after the branch base.&lt;/p&gt;</comment>
                            <comment id="13844151" author="mreutegg" created="Tue, 10 Dec 2013 09:55:48 +0000"  >&lt;p&gt;Fixed several issues in &lt;a href=&quot;http://svn.apache.org/r1549801&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1549801&lt;/a&gt;.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Branch commits previously set the _lastRev when it inserted a document. This is not correct, because _lastRev must only reflect visible commits. The _lastRev for new documents is now set after the branch is merged and done with the background write operation.&lt;/li&gt;
	&lt;li&gt;Revision handling sometimes didn&apos;t take the merge commit revision into account, but was operating on the revision when the change was applied to the branch.&lt;/li&gt;
	&lt;li&gt;A merge commit was using a single revision to make branch commits visible. This does not work correctly when changes in the branch overwrite previous changes in the branch. A merge commit now consists of multiple revisions. One for each branch commit to make them visible in the sequence they were applied to the branch.&lt;/li&gt;
	&lt;li&gt;The revision when a node was last modified was not calculated correctly when the _lastRev from another cluster node isn&apos;t yet visible to the local cluster node. This what the simplified test is about in the previous comment. The test now succeeds and is enabled.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;tt&gt;ConcurrentAddNodesClusterIT#addNodesConcurrent&lt;/tt&gt; still fails sometimes and needs further investigation. I was also running the same test multiple times with MongoNodeStore and those test runs were all successful.&lt;/p&gt;</comment>
                            <comment id="13862983" author="mreutegg" created="Mon, 6 Jan 2014 13:25:08 +0000"  >&lt;p&gt;I identified yet another concurrency problem with the way the revision comparator is updated with seen-at revisions from different cluster nodes. The background read in MongoNodeStore first updates the revision comparator with seen-at revisions from foreign cluster nodes, then invalidates caches and eventually updates the comparator with its own revision. This sequence opens a small window where a read from other cluster node becomes visible even though it shouldn&apos;t.&lt;/p&gt;

&lt;p&gt;The background read orders the revisions with the help of the revision comparator like this:&lt;br/&gt;
1) current head revision happens before new revisions from other cluster nodes&lt;br/&gt;
2) new revisions from other cluster nodes happen before new head revision created by background read&lt;br/&gt;
3) new head revision happens before any future commit done on local cluster node&lt;/p&gt;

&lt;p&gt;The inconsistent read happens because 2) is done before 1) and local commits since the last background read appear to happen before new revisions from other cluster nodes.&lt;/p&gt;

&lt;p&gt;Added a test case in &lt;a href=&quot;http://svn.apache.org/r1555739&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1555739&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13862992" author="mreutegg" created="Mon, 6 Jan 2014 13:43:53 +0000"  >&lt;p&gt;Fixed revision sequence issue and enabled tests in &lt;a href=&quot;http://svn.apache.org/r1555752&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1555752&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13864014" author="mreutegg" created="Tue, 7 Jan 2014 08:50:41 +0000"  >&lt;p&gt;The test now passes. Resolving as fixed.&lt;/p&gt;</comment>
                            <comment id="13869502" author="alex.parvulescu" created="Mon, 13 Jan 2014 13:05:58 +0000"  >&lt;p&gt;bulk close for the 0.14 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12680250">OAK-1204</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>361588</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 44 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qbx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>361886</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>