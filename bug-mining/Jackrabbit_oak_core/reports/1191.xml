<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:47:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2740] TreeTypeProvider treats optimized node type definition info as Ac-Content</title>
                <link>https://issues.apache.org/jira/browse/OAK-2740</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;while investigating a bug reported by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=teofili&quot; class=&quot;user-hover&quot; rel=&quot;teofili&quot;&gt;teofili&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mpetria&quot; class=&quot;user-hover&quot; rel=&quot;mpetria&quot;&gt;mpetria&lt;/a&gt; that cause group-import with policy node to fail when run with non-administrative session, i found that the &lt;tt&gt;TreeTypeProvider&lt;/tt&gt; wrongly identifies the optimized item definition information stored with the node types (e.g. &lt;tt&gt;/jcr:system/jcr:nodeTypes/rep:AccessControllable/rep:namedChildNodeDefinitions/rep:policy&lt;/tt&gt; ) as access control content and thus doesn&apos;t read it properly when using a session that doesn&apos;t have jcr:readAccessControl privilege at /jcr:system/jcr:nodeTypes.&lt;/p&gt;

&lt;p&gt;the effect of this bug is as follows:&lt;br/&gt;
the internal calculation of the effective node type and thus item definitions will not work properly for &lt;tt&gt;rep:policy&lt;/tt&gt; nodes (and similar) as the editing session cannot read the full (oak internal) node type definition as stored below &lt;tt&gt;/jcr:system/jcr:nodeTypes&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12819691">OAK-2740</key>
            <summary>TreeTypeProvider treats optimized node type definition info as Ac-Content</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="angela">Angela Schreiber</assignee>
                                    <reporter username="angela">Angela Schreiber</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Apr 2015 14:29:57 +0000</created>
                <updated>Mon, 18 Apr 2016 14:25:56 +0000</updated>
                            <resolved>Fri, 10 Apr 2015 10:07:13 +0000</resolved>
                                                    <fixVersion>1.0.13</fixVersion>
                    <fixVersion>1.2.1</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14487427" author="anchela" created="Thu, 9 Apr 2015 14:36:01 +0000"  >&lt;p&gt;There are 2 possibilities to address this:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let &apos;AuthorizationContext&apos; also look at the primary type (instead of just relying on the name for performance reasons)&lt;/li&gt;
	&lt;li&gt;add some magic to TreeTypeProvider for the node type special case&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14487501" author="anchela" created="Thu, 9 Apr 2015 15:16:01 +0000"  >&lt;p&gt;the user-import test provided by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mpetria&quot; class=&quot;user-hover&quot; rel=&quot;mpetria&quot;&gt;mpetria&lt;/a&gt; that allowed me to reproduce the problem (which some extra refactoring to allow for non-admin imports).&lt;br/&gt;
this is just for completeness; i will create an different jira issue for these user-importer tests as they are no longer relevant for this issue (see &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2742&quot; title=&quot;Add UserImport tests that run with a non-admin session &quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2742&quot;&gt;&lt;del&gt;OAK-2742&lt;/del&gt;&lt;/a&gt;)... dedicated test-case that illustrates the root-cause of this bug will follow (attached as OAK_2740_test.patch).&lt;/p&gt;</comment>
                            <comment id="14488095" author="anchela" created="Thu, 9 Apr 2015 19:37:55 +0000"  >&lt;p&gt;oak-trunk: committed revision 1672468&lt;br/&gt;
merged into 1.2 branch: committed revision 1672470&lt;/p&gt;

&lt;p&gt;unless someone objects, i would also merge the fix into the 1.0 branch.&lt;/p&gt;
</comment>
                            <comment id="14488137" author="anchela" created="Thu, 9 Apr 2015 19:54:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=teofili&quot; class=&quot;user-hover&quot; rel=&quot;teofili&quot;&gt;teofili&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mpetria&quot; class=&quot;user-hover&quot; rel=&quot;mpetria&quot;&gt;mpetria&lt;/a&gt;, thanks very much for reporting the issue and providing tests and hints that helped identifying the bug.&lt;/p&gt;</comment>
                            <comment id="14489145" author="mpetria" created="Fri, 10 Apr 2015 08:13:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anchela&quot; class=&quot;user-hover&quot; rel=&quot;anchela&quot;&gt;anchela&lt;/a&gt; thanks for fix this. I also tested with my initial test and it works. One note, my test does two imports (one with adminSession and one with testSession) and the namespaces are added by the first import, that is why I did not need the namespace management privilege &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="14489264" author="anchela" created="Fri, 10 Apr 2015 09:35:48 +0000"  >&lt;p&gt;yes, with my refactoring i then had 2 imports with the testSession. since the uuid-conflict was not relevant for reproducing the problem, i dropped it from the test-case for the sake of simplicity. but obviously it would make sense to also have import-tests with non-admin sessions and different uuid-import-behaviour.&lt;/p&gt;</comment>
                            <comment id="14489307" author="anchela" created="Fri, 10 Apr 2015 10:07:00 +0000"  >&lt;p&gt;merged into 1.0 branch: committed revision 1672604.&lt;/p&gt;</comment>
                            <comment id="14502511" author="mreutegg" created="Mon, 20 Apr 2015 08:32:20 +0000"  >&lt;p&gt;Bulk close for 1.2.1 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12819707">OAK-2742</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12724239" name="OAK-2740.patch" size="949" author="angela" created="Thu, 9 Apr 2015 15:05:07 +0000"/>
                            <attachment id="12724245" name="OAK-2740_importTests.patch" size="87537" author="angela" created="Thu, 9 Apr 2015 15:16:01 +0000"/>
                            <attachment id="12724251" name="OAK-2740_test.patch" size="2404" author="angela" created="Thu, 9 Apr 2015 15:42:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2d1an:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>