<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:54:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-8328] Bug in index definition can block indexing / cause indexing in a loop</title>
                <link>https://issues.apache.org/jira/browse/OAK-8328</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;If we&#160; set &quot;/oak:index/indexName/entryCount&quot; to a Long multi-valued property. That will cause the system to reindex in a loop... You only see the root cause if debug level logging is enabled. There are likely other such problems. Oak should log a proper meaningful exception for config errors, and if possible not get into this loop. It also blocks other indexes to be updated I think.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
29.03.2019 11:58:55.688 *INFO* [async-index-update-async] org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; following indexes: [/oak:index/unifiedCreatedLucene]
29.03.2019 11:59:00.691 *INFO* [async-index-update-async] org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; following indexes: [/oak:index/unifiedCreatedLucene]
29.03.2019 11:59:05.685 *INFO* [async-index-update-async] org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; following indexes: [/oak:index/unifiedCreatedLucene]
29.03.2019 11:59:10.687 *INFO* [async-index-update-async] org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; following indexes: [/oak:index/unifiedCreatedLucene]
29.03.2019 11:59:15.685 *INFO* [async-index-update-async] org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; following indexes: [/oak:index/unifiedCreatedLucene]
29.03.2019 11:59:20.688 *INFO* [async-index-update-async] org.apache.jackrabbit.oak.plugins.index.IndexUpdate Reindexing will be performed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; following indexes: [/oak:index/unifiedCreatedLucene]

29.03.2019 12:13:50.692 *DEBUG* [async-index-update-async] org.apache.jackrabbit.oak.plugins.index.AsyncIndexUpdate [async] The index update is still failing
java.lang.IllegalStateException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at com.google.common.base.Preconditions.checkState(Preconditions.java:134)
	at org.apache.jackrabbit.oak.segment.SegmentPropertyState.getValue(SegmentPropertyState.java:145)
	at org.apache.jackrabbit.oak.plugins.index.lucene.IndexDefinition.&amp;lt;init&amp;gt;(IndexDefinition.java:358)
	at org.apache.jackrabbit.oak.plugins.index.lucene.IndexDefinition.&amp;lt;init&amp;gt;(IndexDefinition.java:95)
	at org.apache.jackrabbit.oak.plugins.index.lucene.IndexDefinition$Builder.build(IndexDefinition.java:314)
	at org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditorContext.enableReindexMode(LuceneIndexEditorContext.java:184)
	at org.apache.jackrabbit.oak.plugins.index.lucene.LuceneIndexEditor.enter(LuceneIndexEditor.java:118)
	at org.apache.jackrabbit.oak.spi.commit.ProgressNotificationEditor.enter(ProgressNotificationEditor.java:71)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13233909">OAK-8328</key>
            <summary>Bug in index definition can block indexing / cause indexing in a loop</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="ngupta">Nitin Gupta</reporter>
                        <labels>
                            <label>indexingPatch</label>
                    </labels>
                <created>Fri, 17 May 2019 07:28:24 +0000</created>
                <updated>Sun, 15 Jan 2023 02:00:03 +0000</updated>
                            <resolved>Thu, 25 Jul 2019 10:43:11 +0000</resolved>
                                                    <fixVersion>1.18.0</fixVersion>
                                    <component>core</component>
                    <component>lucene</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16843958" author="nitigup" created="Mon, 20 May 2019 13:18:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; - A PR here - &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/pull/129/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/pull/129/files&lt;/a&gt; . This still needs test cases , but the fix is open for review . I have added a detailed error message that should tell us where exactly is the config error . Also this will skip the index def with bad config from IndexUpdate and unblock the rest of the lane .&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16844550" author="tmueller" created="Tue, 21 May 2019 06:23:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ngupta&quot; class=&quot;user-hover&quot; rel=&quot;ngupta&quot;&gt;ngupta&lt;/a&gt; see my comments in the PR.&lt;/p&gt;</comment>
                            <comment id="16845767" author="nitigup" created="Wed, 22 May 2019 10:58:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; - Patch here -&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12969382/12969382_OAK-8328.patch&quot; title=&quot;OAK-8328.patch attached to OAK-8328&quot;&gt;OAK-8328.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&#160;. This has changes as per your review comments on the PR .&#160;&lt;/p&gt;</comment>
                            <comment id="16847284" author="tmueller" created="Fri, 24 May 2019 06:55:00 +0000"  >&lt;p&gt;The patch looks good to me. I will try to merge it today.&lt;/p&gt;</comment>
                            <comment id="16847315" author="nitigup" created="Fri, 24 May 2019 07:43:09 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; .&lt;/p&gt;</comment>
                            <comment id="16860956" author="tmueller" created="Tue, 11 Jun 2019 11:41:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ngupta&quot; class=&quot;user-hover&quot; rel=&quot;ngupta&quot;&gt;ngupta&lt;/a&gt; It would still be good to have a test case.&lt;/p&gt;</comment>
                            <comment id="16860969" author="nitigup" created="Tue, 11 Jun 2019 12:00:40 +0000"  >&lt;p&gt;Sure &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; - I will provide a test case too .&lt;/p&gt;</comment>
                            <comment id="16861030" author="nitigup" created="Tue, 11 Jun 2019 13:21:59 +0000"  >&lt;p&gt;Update - There is a test case in oak-core failing with this patch . Will fix that and provide a new patch .&lt;/p&gt;</comment>
                            <comment id="16862900" author="nitigup" created="Thu, 13 Jun 2019 10:13:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; - updated patch here - &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12971679/12971679_OAK-8328_2.patch&quot; title=&quot;OAK-8328_2.patch attached to OAK-8328&quot;&gt;OAK-8328_2.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; .&lt;/p&gt;

&lt;p&gt;This fixes the failing test . Also added a new test for Property Index that covers such scenario where an index def with a bad config should be ignored and not impacts other indexes which have correct definitions .&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I haven&apos;t been able to add a lucene index test as of now , because of some implementation differences across implementations of memory node store and other node stores . Will create a separate task to fix that . Can you please have a look at this new patch and merge .&lt;/p&gt;</comment>
                            <comment id="16864099" author="tmueller" created="Fri, 14 Jun 2019 14:03:29 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ngupta&quot; class=&quot;user-hover&quot; rel=&quot;ngupta&quot;&gt;ngupta&lt;/a&gt;! I added my own &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-8328&quot; title=&quot;Bug in index definition can block indexing / cause indexing in a loop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-8328&quot;&gt;&lt;del&gt;OAK-8328&lt;/del&gt;&lt;/a&gt;_3.patch with a few changes:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The added &quot;try 
{ ... }
&lt;p&gt; catch&quot; requires adding spaces unfortunately, so a formatting change. I don&apos;t know how this could have been avoided.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;I had to merge the test changes manually (not your fault), and I didn&apos;t use static imports as much... I think it&apos;s a matter of taste, your patch was just fine. I hope you don&apos;t mind.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ll not commit the changes right now, as it would break the build. Plus we want to investigate some broken upstream problem. &lt;/p&gt;

&lt;p&gt;&amp;gt; This fixes the failing test .&lt;/p&gt;

&lt;p&gt;Yes it does.&lt;/p&gt;</comment>
                            <comment id="16864294" author="nitigup" created="Fri, 14 Jun 2019 17:21:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;&amp;gt; The added &quot;try { ... } catch&quot; requires adding spaces&lt;/p&gt;

&lt;p&gt;Ah - the one in the PropertyIndexTest - yup , I am not sure how I can avoid that - I simply would have hit enter after starting the brackets - maybe there is some formatter check in intellij - I will look into it .&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&amp;gt; I had to merge the test changes manually (not your fault), and I didn&apos;t use static imports as much... I think it&apos;s a matter of taste, your patch was just fine. I hope you don&apos;t mind.&lt;/p&gt;

&lt;p&gt;Sure - no problem at all .&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&amp;gt; I&apos;ll not commit the changes right now, as it would break the build&lt;/p&gt;

&lt;p&gt;Is it that the build process doesn&apos;t pick up test code change at first and so the build would break because the PropertyIndex test would fail ? Or due to the the problem that&apos;s being discussed on the oak channel (Failing oak sprout)&lt;/p&gt;</comment>
                            <comment id="16876888" author="tmueller" created="Tue, 2 Jul 2019 11:37:15 +0000"  >&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/r1862419&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1862419&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16877459" author="nitigup" created="Wed, 3 Jul 2019 03:42:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; - I created a bug describing the difference in implementation around the Exception thrown from MemoryNodeStore and SegmentNodeStore in case the property is multivalued but the code expects it to be single valued . &lt;/p&gt;

&lt;p&gt;The MemoryNodeStore implementation here needs to be corrected , since it doesn&apos;t follow the api doc for PropertyState.&#160;&lt;/p&gt;

&lt;p&gt;Exact details here - &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-8455&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/OAK-8455&lt;/a&gt; .&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16880001" author="nitigup" created="Mon, 8 Jul 2019 03:29:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; - I have added the missing test case that was blocked on &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-8455&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/OAK-8455&lt;/a&gt; . Here&apos;s the patch for the test case - &lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12973839/12973839_OAK-8328_test.patch&quot; title=&quot;OAK-8328_test.patch attached to OAK-8328&quot;&gt;OAK-8328_test.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; . Can you please review and merge . You would need to first apply the patch that I have provided on &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-8455&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/OAK-8455&lt;/a&gt; for this test to pass .&lt;/p&gt;</comment>
                            <comment id="16892650" author="tmueller" created="Thu, 25 Jul 2019 10:42:44 +0000"  >&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/r1863731&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1863731&lt;/a&gt; (trunk)&lt;/p&gt;</comment>
                            <comment id="16892651" author="tmueller" created="Thu, 25 Jul 2019 10:43:11 +0000"  >&lt;p&gt;Finally committed the test case.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13242886">OAK-8455</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12969382" name="OAK-8328.patch" size="7889" author="ngupta" created="Wed, 22 May 2019 10:56:24 +0000"/>
                            <attachment id="12971679" name="OAK-8328_2.patch" size="16146" author="ngupta" created="Thu, 13 Jun 2019 10:08:57 +0000"/>
                            <attachment id="12971814" name="OAK-8328_3.patch" size="25000" author="thomasm" created="Fri, 14 Jun 2019 14:04:13 +0000"/>
                            <attachment id="12973839" name="OAK-8328_test.patch" size="6053" author="ngupta" created="Sat, 6 Jul 2019 17:45:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 16 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z02seg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>