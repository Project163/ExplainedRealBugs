<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:47:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2384] SegmentNotFoundException when keeping JCR Value references</title>
                <link>https://issues.apache.org/jira/browse/OAK-2384</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;With &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2192&quot; title=&quot;Concurrent commit during compaction results in mixed segments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2192&quot;&gt;&lt;del&gt;OAK-2192&lt;/del&gt;&lt;/a&gt; revision gc started to remove segments older than a certain threshold. The underlying assumption was that old sessions would call refresh (i.e. auto refresh) anyway once they become active again. However, it turns out that refreshing a sessions does not affect JCR values as those are directly tied to the underlying record. Accessing those values after its segment has been gc&apos;ed results in a &lt;tt&gt;SegmentNotFoundException&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;Keeping reference to JCR values is an important use case for Sling&apos;s &lt;tt&gt;JcrPropertyMap&lt;/tt&gt;, which is widely used.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12765997">OAK-2384</key>
            <summary>SegmentNotFoundException when keeping JCR Value references</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mduerig">Michael D&#252;rig</assignee>
                                    <reporter username="mduerig">Michael D&#252;rig</reporter>
                        <labels>
                            <label>gc</label>
                    </labels>
                <created>Fri, 9 Jan 2015 11:21:56 +0000</created>
                <updated>Tue, 16 Feb 2021 09:53:05 +0000</updated>
                            <resolved>Mon, 2 Mar 2015 13:11:51 +0000</resolved>
                                                    <fixVersion>1.0.12</fixVersion>
                    <fixVersion>1.1.8</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14270897" author="mduerig" created="Fri, 9 Jan 2015 11:26:17 +0000"  >&lt;p&gt;Test case at &lt;a href=&quot;http://svn.apache.org/r1650503&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1650503&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14270956" author="mduerig" created="Fri, 9 Jan 2015 12:35:43 +0000"  >&lt;p&gt;A fix would need to cache the property states on the heap. &lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://github.com/mduerig/jackrabbit-oak/commit/2b678a8a430375f5e4411512551c6335fd986cb8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mduerig/jackrabbit-oak/commit/2b678a8a430375f5e4411512551c6335fd986cb8&lt;/a&gt; for a simple solution.&lt;/p&gt;

&lt;p&gt;A more sophisticated approach would only cache once the underlying segment is being gc&apos;ed. See &lt;a href=&quot;https://github.com/mduerig/jackrabbit-oak/commit/5d5260e19653e85554da3ad77dc5cd35f7d089a5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mduerig/jackrabbit-oak/commit/5d5260e19653e85554da3ad77dc5cd35f7d089a5&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alex.parvulescu&quot; class=&quot;user-hover&quot; rel=&quot;alex.parvulescu&quot;&gt;alex.parvulescu&lt;/a&gt;, could you have a look?&lt;/p&gt;</comment>
                            <comment id="14282348" author="mduerig" created="Mon, 19 Jan 2015 10:17:47 +0000"  >&lt;p&gt;Tests under real traffic conditions revealed issues with this approach. Apparently we lose some of the performance optimisations that went into revision comparison for cached properties. AFICS this interacts badly with the compaction estimator as in one instance I&apos;ve seen that one not finishing. I&apos;ve also seen this stalling the system in gc. &lt;/p&gt;</comment>
                            <comment id="14343052" author="mduerig" created="Mon, 2 Mar 2015 11:28:15 +0000"  >&lt;p&gt;After a lot of poking around I came to the conclusion that the current behaviour is actually the right one. That is, we should specify JCR Values to be &apos;short lived&apos; and that they might not survive a gc cycle. So it is the clients responsibility to re-fetch them. This is already facilitated by the work being done on &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2407&quot; title=&quot;Auto-refresh sessions on revision gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2407&quot;&gt;&lt;del&gt;OAK-2407&lt;/del&gt;&lt;/a&gt;. OTOH with &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-4307&quot; title=&quot;Avoid caching JCR property values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-4307&quot;&gt;&lt;del&gt;SLING-4307&lt;/del&gt;&lt;/a&gt;, Sling preemptively adapted to the new contract already. &lt;/p&gt;

&lt;p&gt;IMO the only thing left do do here is to make sure we don&apos;t throw a &lt;tt&gt;SegmentNotFoundException&lt;/tt&gt; when accession a collected value but wrap it into a &lt;tt&gt;RepositoryException&lt;/tt&gt;.&lt;/p&gt;
</comment>
                            <comment id="14343139" author="mduerig" created="Mon, 2 Mar 2015 13:11:51 +0000"  >&lt;p&gt;Fixed in trunk at &lt;a href=&quot;http://svn.apache.org/r1663288&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1663288&lt;/a&gt;&lt;br/&gt;
Fixed in 1.0 branch at &lt;a href=&quot;http://svn.apache.org/r1663296&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1663296&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14354686" author="mreutegg" created="Tue, 10 Mar 2015 10:46:07 +0000"  >&lt;p&gt;Bulk close for Oak 1.0.12.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12735772">OAK-2045</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12693062" name="org.apache.sling.jcr.resource-2.4.0.jar" size="122310" author="mduerig" created="Mon, 19 Jan 2015 10:33:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>OAK-2849</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i244an:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>