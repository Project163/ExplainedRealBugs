<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:52:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-5260] Incorrect handling of subpaths with leading left curly bracket</title>
                <link>https://issues.apache.org/jira/browse/OAK-5260</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;As per &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-6383&quot; title=&quot;Unexpected behavior with left curly bracket in resource resolution&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-6383&quot;&gt;SLING-6383&lt;/a&gt; it looks like the Oak name mapping causes for example getItem(&quot;/libs/{sub&quot;) (with a left curly bracket in the path) to return the /libs node if that exists but the supplied path does not.&lt;/p&gt;

&lt;p&gt;I&apos;ll attach a patch with a test that demonstrates this. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fmeschbe&quot; class=&quot;user-hover&quot; rel=&quot;fmeschbe&quot;&gt;fmeschbe&lt;/a&gt; mentions in that Sling issue that the parsing of the CR 2 section 3.2.5.1 Expanded Form could be involved, treating the left curly bracket in a special way that&apos;s not appropriate here.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13027011">OAK-5260</key>
            <summary>Incorrect handling of subpaths with leading left curly bracket</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="bdelacretaz">Bertrand Delacretaz</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Dec 2016 14:40:31 +0000</created>
                <updated>Thu, 11 Jan 2024 14:00:04 +0000</updated>
                            <resolved>Thu, 22 Dec 2016 11:17:31 +0000</resolved>
                                                    <fixVersion>1.4.12</fixVersion>
                    <fixVersion>1.5.17</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>jcr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15735480" author="bdelacretaz" created="Fri, 9 Dec 2016 14:42:47 +0000"  >&lt;p&gt;In the attached test code, moving the the childA1 and childA2 test cases to the second section, paths not found, causes the test to fail although they should not be found.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        session.getRootNode().addNode(&lt;span class=&quot;code-quote&quot;&gt;&quot;parent&quot;&lt;/span&gt;);
        
        assertNodeFound(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, 
            &lt;span class=&quot;code-quote&quot;&gt;&quot;/parent&quot;&lt;/span&gt;,
            
            &lt;span class=&quot;code-comment&quot;&gt;// TODO these should not be found
&lt;/span&gt;            &lt;span class=&quot;code-quote&quot;&gt;&quot;/parent/{childA1&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;/parent/{{childA2&quot;&lt;/span&gt;
        );
        
        assertNodeFound(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, 
            &lt;span class=&quot;code-quote&quot;&gt;&quot;/parent/childB1&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;/parent/}childB2&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;/parent/{childB3}&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;/parent/sub/childB4&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;/parent/sub/}childB5&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;/parent/sub/{childB6}&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;/parent/sub/{childB7&quot;&lt;/span&gt;
        );
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15736014" author="jsedding" created="Fri, 9 Dec 2016 18:56:22 +0000"  >&lt;p&gt;Attached is a new &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12842598/12842598_OAK-5260-jsedding.patch&quot; title=&quot;OAK-5260-jsedding.patch attached to OAK-5260&quot;&gt;patch with a fix&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;, the test case provided by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bdelacretaz&quot; class=&quot;user-hover&quot; rel=&quot;bdelacretaz&quot;&gt;bdelacretaz&lt;/a&gt; (thanks!) and an additional test case closer to the root of the issue.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reschke&quot; class=&quot;user-hover&quot; rel=&quot;reschke&quot;&gt;reschke&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; could any of you please review the change? It is only a few lines, but pretty deep down.&lt;/p&gt;</comment>
                            <comment id="15741629" author="reschke" created="Mon, 12 Dec 2016 11:03:30 +0000"  >&lt;p&gt;I&apos;ll have a look soonish.&lt;/p&gt;

&lt;p&gt;EDIT: sorry, probably not this week.&lt;/p&gt;</comment>
                            <comment id="15747729" author="jsedding" created="Wed, 14 Dec 2016 08:57:44 +0000"  >&lt;p&gt;Anyone, please?&lt;/p&gt;</comment>
                            <comment id="15747842" author="bdelacretaz" created="Wed, 14 Dec 2016 09:50:38 +0000"  >&lt;p&gt;I cannot comment on your &lt;tt&gt;JcrPathParser&lt;/tt&gt; changes as I&apos;m not familiar with that code but your modified tests look good to me.&lt;/p&gt;</comment>
                            <comment id="15748528" author="tmueller" created="Wed, 14 Dec 2016 14:48:54 +0000"  >&lt;p&gt;JcrPathParser looks like a hand written state machine. Looking at the code, and at the tests (I can&apos;t find many tests, and no randomized tests), I think it&apos;s likely that there are more bugs.&lt;/p&gt;

&lt;p&gt;I can try to re-implement that class, not using a state machine, but multiple loops. First in the test package, then add more tests (randomized tests, and tests that compare the behaviour of both implementations), and then let&apos;s see what we can do from there.&lt;/p&gt;</comment>
                            <comment id="15748546" author="bdelacretaz" created="Wed, 14 Dec 2016 14:56:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;I can try to re-implement that class, not using a state machine, but multiple loops.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I would strongly recommend using JavaCC instead as a much safer way of creating a robust parser.&lt;/p&gt;

&lt;p&gt;I have successfully used it for the Sling repoinit stuff &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;As is often the case with these tools the grammar syntax is funky &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; but as opposed to more modern tools JavaCC doesn&apos;t have any runtime dependencies beside the default Java libraries.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://svn.apache.org/repos/asf/sling/trunk/bundles/extensions/repoinit/parser/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/repos/asf/sling/trunk/bundles/extensions/repoinit/parser/&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://svn.apache.org/repos/asf/sling/trunk/bundles/extensions/repoinit/parser/src/main/javacc/RepoInitGrammar.jjt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/sling/trunk/bundles/extensions/repoinit/parser/src/main/javacc/RepoInitGrammar.jjt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15748556" author="tmueller" created="Wed, 14 Dec 2016 14:59:54 +0000"  >&lt;p&gt;(Just my view) I think it&apos;s almost impossible to verify that the patch doesn&apos;t introduce new bugs. The problem is that code coverage from direct tests is low: NamePathMapperImplTest seems to be the only test, and not even that one is really a unit test. Code coverage is 65% for me; I would have expected nearly 100% code coverage, actually it would be good to use mutation testing (&lt;a href=&quot;http://pitest.org/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://pitest.org/&lt;/a&gt;) to verify we have enough tests. So changes are problematic.&lt;/p&gt;</comment>
                            <comment id="15748566" author="bdelacretaz" created="Wed, 14 Dec 2016 15:04:48 +0000"  >&lt;p&gt;BTW JavaCC is already used in &lt;a href=&quot;http://svn.apache.org/repos/asf/jackrabbit/trunk/jackrabbit-spi-commons&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/repos/asf/jackrabbit/trunk/jackrabbit-spi-commons&lt;/a&gt; but that&apos;s a much more complicated parser than my small repoinit thingy.&lt;/p&gt;</comment>
                            <comment id="15748605" author="tmueller" created="Wed, 14 Dec 2016 15:21:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bdelacretaz&quot; class=&quot;user-hover&quot; rel=&quot;bdelacretaz&quot;&gt;bdelacretaz&lt;/a&gt; JavaCC would be (a) tricky due to the &quot;Listener&quot; callback mechanism, (b) probably result in slower code, and (c) be harder to maintain. I have used both &lt;a href=&quot;http://newsql.sourceforge.net/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ANTLR&lt;/a&gt; and JavaCC in the past, but I find hand-written parsers &lt;a href=&quot;https://github.com/h2database/h2database/blob/master/h2/src/main/org/h2/command/Parser.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;1&lt;/a&gt; &lt;a href=&quot;https://github.com/h2database/h2database/blob/master/h2/src/main/org/h2/jdbc/JdbcConnection.java#L1291&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2&lt;/a&gt; &lt;a href=&quot;http://svn.apache.org/repos/asf/jackrabbit/trunk/jackrabbit-jcr-commons/src/main/java/org/apache/jackrabbit/commons/query/sql2/Parser.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3&lt;/a&gt;  &lt;a href=&quot;http://svn.apache.org/repos/asf/jackrabbit/oak/trunk/oak-core/src/main/java/org/apache/jackrabbit/oak/query/SQL2Parser.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4&lt;/a&gt; &lt;a href=&quot;http://svn.apache.org/repos/asf/jackrabbit/oak/trunk/oak-core/src/main/java/org/apache/jackrabbit/oak/query/xpath/XPathToSQL2Converter.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;5&lt;/a&gt; &lt;a href=&quot;http://svn.apache.org/repos/asf/jackrabbit/oak/trunk/oak-commons/src/main/java/org/apache/jackrabbit/oak/commons/json/JsopTokenizer.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;6&lt;/a&gt; &lt;a href=&quot;https://github.com/h2database/h2database/blob/master/h2/src/tools/org/h2/build/doc/XMLParser.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;7&lt;/a&gt; &lt;a href=&quot;https://github.com/h2database/h2database/blob/master/h2/src/main/org/h2/bnf/Bnf.java#L86&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;8&lt;/a&gt; to be easier to write and maintain and faster.&lt;/p&gt;
</comment>
                            <comment id="15748621" author="bdelacretaz" created="Wed, 14 Dec 2016 15:27:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;I have used both ANTLR &lt;span class=&quot;error&quot;&gt;&amp;#91;9&amp;#93;&lt;/span&gt; and JavaCC in the past, but I find hand-written parsers &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;-&lt;span class=&quot;error&quot;&gt;&amp;#91;8&amp;#93;&lt;/span&gt; to be easier to write and maintain.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fair enough, and whoever does the job decides anyway! I guess the key is to have sufficient test coverage to be confident in making changes, which is not currently the case here IIUC.&lt;/p&gt;</comment>
                            <comment id="15748761" author="mduerig" created="Wed, 14 Dec 2016 16:25:13 +0000"  >&lt;p&gt;Some reasons for not doing so:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;JCR paths have to deal with the awkwardness of resolving name spaces. Depending on the active name mappings a paths can be valid, invalid or even parse to different results.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Performance: the current parser is quite optimised, which is important as parsing paths &lt;b&gt;is&lt;/b&gt; on the critical path.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Legacy: the parser was inherited from Jackrabbit 2.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15748813" author="reschke" created="Wed, 14 Dec 2016 16:45:18 +0000"  >&lt;p&gt;(+1)&lt;/p&gt;

&lt;p&gt;FWIW, how &quot;{foo}bar&quot; needs to be parsed depends on whether foo is a valid URI; which implies the presence of a &quot;:&quot;. If it is a URI, then it needs to be mapped to a prefix (such as &quot;qux&quot;), and the resulting value would be &quot;qux:bar&quot; (this is because we use prefixed names, not expanded names, internally (1)).&lt;/p&gt;

&lt;p&gt;Note this falls apart with namespace names that aren&apos;t URIs, which (a) IMHO is forbidden in JCR but (b) used in Jackrabbit internally.&lt;/p&gt;

&lt;p&gt;(1) Something I&apos;m still unhappy with...&lt;/p&gt;</comment>
                            <comment id="15750965" author="tmueller" created="Thu, 15 Dec 2016 10:02:33 +0000"  >&lt;p&gt;JcrPathParser is a bit strange. There seems to be code that is impossible to reach, possibly this is due to bugs. For example, there is a variable &quot;wasSlash&quot; that is set and tested, but it is not possible to ever become true where it is tested for, because it is only true if the &lt;em&gt;last&lt;/em&gt; character was a slash, in which case the state can never be STATE_PREFIX, or STATE_NAME. I guess the assignment was meant to be &quot;wasSlash |= c == &apos;/&apos;&quot;. Also, the validate method uses a listener with the variable &quot;hasRoot&quot;, which can never possibly be true where it is tested. JcrNameParser looks a bit better, but I guess more tests should be added there as well. Need to check the spec now.&lt;/p&gt;</comment>
                            <comment id="15751316" author="tmueller" created="Thu, 15 Dec 2016 13:05:53 +0000"  >&lt;p&gt;The current behavior of the JcrPathParser is quite strange for slightly unusual paths. This patch partially fixes that, but a lot of weirdness remains. For example, the parser sometimes returns an empty string (which probably means &quot;current node&quot; but is not documented), or ignores some elements sometimes, and in other cases returns null (meaning invalid). For example, &quot;.&quot; becomes &quot;&quot; (the current node), &quot;x/.&quot; becomes &quot;x&quot;, &quot;/&quot; remains &quot;/&quot; (the root node). But &quot;/.&quot; and &quot;/x/..&quot; become &quot;&quot; (the current node). I don&apos;t understand that logic, it seems arbitrary. Other cases are more weird, for example &quot;}{&quot; becomes &quot;&quot; (the current node), but &quot;}&quot; stays &quot;}&quot;, and &quot;/parent/}{/child&quot; is invalid. And &quot;/[.&quot; becomes the current node, but &quot;[.&quot; doesn&apos;t, and so on.&lt;/p&gt;

&lt;p&gt;There is a risk that the attached patch breaks backwards compatibility in some weird cases (that are most likely anyway not spec compliant). But at least the patch fixes the problem of completely swallowing parts of the path, and it seems to fix that consistently, correctly, and fully (according to my tests).&lt;/p&gt;

&lt;p&gt;I suggest we apply the patch, but don&apos;t try to fix other broken or weird cases. And for Oak 1.7, I will rewrite the parsers, add test cases and documentation, try to find and fix compatibility issues, and run benchmarks (to ensure we don&apos;t get slower here).&lt;/p&gt;</comment>
                            <comment id="15751355" author="jsedding" created="Thu, 15 Dec 2016 13:20:16 +0000"  >&lt;p&gt;Thanks for your feedback &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; et al. I have opened &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-5316&quot; title=&quot;Rewrite JcrPathParser and JcrNameParser with good test coverage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-5316&quot;&gt;OAK-5316&lt;/a&gt; to track reimplementation of the parsers and set the fix version to 1.8.&lt;/p&gt;

&lt;p&gt;If there are no objections until later today, I will apply the patch as-is. There are no test failures with a full build of Oak and the added code only becomes active under very specific conditions.&lt;/p&gt;</comment>
                            <comment id="15753717" author="tmueller" created="Fri, 16 Dec 2016 07:36:03 +0000"  >&lt;p&gt;Thinking about this some more, I think there is a risk of applying the patch. The patch makes the following test pass:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+        String[] paths = {
+                &quot;/parent/sub/{childB7&quot;,
+                &quot;/parent/{childA1&quot;,
+                &quot;/parent/{{childA2&quot;
+        };
+
+        for (String path : paths) {
+            assertEquals(path, npMapper.getOakPath(path));
+        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(The new test contains more cases, but those were working before as well.)&lt;/p&gt;

&lt;p&gt;Assuming it is possible that such a nodes can exists, then the following paths become ambiguous:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;                &quot;/parent/{childA1/childChildB1}&quot;,
                &quot;/parent/{{childA2/}childChildB2}&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is the slash now the delimiter, or is the &quot;{..}&quot; pair the delimiter?&lt;/p&gt;

&lt;p&gt;The existing JcrPathParser code searches for a &quot;}&quot; after finding a &quot;{&quot;, then can&apos;t find one, and so truncates from &quot;/parent/{childA1&quot; to &quot;/parent/&quot;, which is then further truncated to &quot;/parent&quot;.&lt;/p&gt;

&lt;p&gt;Maybe it would be better to return null, meaning &quot;invalid&quot;. The Javadoc of that method says:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Returns the Oak path for the given JCR path, or &lt;em&gt;null&lt;/em&gt; if no&lt;br/&gt;
such mapping exists because the given JCR path contains a name element&lt;br/&gt;
with an unknown namespace URI or prefix, or is otherwise invalid.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There is also a problem with getOakName: the javadoc for &lt;em&gt;that&lt;/em&gt; method says:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Returns the Oak name for the specified JCR name. In contrast to&lt;br/&gt;
getOakNameOrNull(String) this method will throw a RepositoryException&lt;br/&gt;
if the JCR name is invalid and cannot be resolved.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is not in consistent with getOakPath, which never throws, but may return null. That&apos;s inconsistent. Then, the name &quot;{test&quot; is not considered invalid. So maybe you can create such nodes, which would be a problem, because if you create a child node &quot;}test2&quot;, then the full path of that node would be &quot;/{test/}test2&quot;, which is ambiguous.&lt;/p&gt;

&lt;p&gt;I think it would be much easier if names such as &quot;{test&quot; are invalid, because the &quot;}&quot; is missing. Instead, they need to be escaped using &quot;{}&quot;: &quot;{}{test&quot;.&lt;/p&gt;</comment>
                            <comment id="15753774" author="reschke" created="Fri, 16 Dec 2016 08:07:50 +0000"  >&lt;p&gt;The intent in JCR 2 was to allow using qualified names. Using the &quot;Clark&quot; notation (&quot;{ns}local&quot;) was considered parseable, as long as ns was a valid URI (and valid URIs as per RFC 3986 are always absolute, thus contain a scheme name).&lt;/p&gt;

&lt;p&gt;Thus, parsing as qualified name should (IMHO) only be triggered if (a) there&apos;s a matching closing &quot;}&quot; and there&apos;s a &quot;:&quot; in between (which wouldn&apos;t be allowed in a local name).&lt;/p&gt;

&lt;p&gt;With that, I don&apos;t think the examples become ambiguous.&lt;/p&gt;</comment>
                            <comment id="15754768" author="tmueller" created="Fri, 16 Dec 2016 15:49:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=julian.reschke%40gmx.de&quot; class=&quot;user-hover&quot; rel=&quot;julian.reschke@gmx.de&quot;&gt;julian.reschke@gmx.de&lt;/a&gt; I tried to create nodes named &quot;{&quot; and &quot;{test&quot; with a GUI tool and this failed, but I will need to test if this always fails using the JCR API.&lt;/p&gt;

&lt;p&gt;If you think those should be legal node names, then what about this:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Add node (a) named &quot;{abc:/}test&quot; to the root node.&lt;/li&gt;
	&lt;li&gt;Add node (b) named &quot;{abc:&quot; to the root node. According to your rules that should work right? Not a qualified name.&lt;/li&gt;
	&lt;li&gt;Create a child node (c) to node (b) named &quot;}test&quot;. Clearly valid.&lt;/li&gt;
	&lt;li&gt;Then node (c) will have the path &quot;/{abc:/}test&quot;. But that&apos;s the same path as node (a).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Sure, you could use the &quot;escape syntax&quot; &quot;/{}{abc:/}test&quot; for node (c). But which tool would do that?&lt;/p&gt;</comment>
                            <comment id="15754830" author="reschke" created="Fri, 16 Dec 2016 16:11:11 +0000"  >&lt;p&gt;(b) should fail, due to the &quot;:&quot; being invalid in the local name part.&lt;/p&gt;
</comment>
                            <comment id="15763684" author="bdelacretaz" created="Tue, 20 Dec 2016 08:59:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;If you think those should be legal node names...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;While names that include curly brackets &lt;em&gt;might&lt;/em&gt; be ok with the JCR spec I think they are highly impractical.&lt;/p&gt;

&lt;p&gt;I would suggest an optional &quot;forbid silly names&quot; mode in Oak, enabled by default, that blocks such things.&lt;/p&gt;</comment>
                            <comment id="15763717" author="tmueller" created="Tue, 20 Dec 2016 09:14:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=julian.reschke%40gmx.de&quot; class=&quot;user-hover&quot; rel=&quot;julian.reschke@gmx.de&quot;&gt;julian.reschke@gmx.de&lt;/a&gt; ok, but you would need to define what a &quot;matching closing &quot;}&quot;&quot; is. If you need to count opening and closing {} cases, then you can&apos;t use a regular expression to check for valid nodes. What about this:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Register a namespace &lt;tt&gt;NamespaceRegistry.registerNamespace(&quot;x&quot;, &quot;/{:&quot;)&lt;/tt&gt; (this is valid right now).&lt;/li&gt;
	&lt;li&gt;Register a namespace &lt;tt&gt;NamespaceRegistry.registerNamespace(&quot;y&quot;, &quot;:&quot;)&lt;/tt&gt; (this is valid right now).&lt;/li&gt;
	&lt;li&gt;Add node (a) named &quot;{/{:}test&quot; to the root node. (doesn&apos;t work right now, but I guess should work).&lt;/li&gt;
	&lt;li&gt;Add node (b) named &quot;{&quot; to the root node. Not a qualified name. (doesn&apos;t work right now, but according to you should be supported right?)&lt;/li&gt;
	&lt;li&gt;Create a child node (c) to node (b) named &quot;{:}test&quot;. Qualified name (works right now)&lt;/li&gt;
	&lt;li&gt;Then node (c) will have the path &quot;/{/{:}test&quot;. But that&apos;s the same path as node (a).&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="15763728" author="tmueller" created="Tue, 20 Dec 2016 09:19:48 +0000"  >&lt;p&gt;&amp;gt; forbid silly names&lt;/p&gt;

&lt;p&gt;Yes, I would prefer that, instead of what we have right now, and instead of adding more complex rules such as &quot;find matching }&quot; or check for &quot;:&quot; and so on.&lt;/p&gt;

&lt;p&gt;What we have right now is &quot;kind of&quot; broken because it results in very strange behavior. For example:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;session.getRootNode().addNode(&quot;{&quot; + UUID.randomUUID());
&amp;gt; javax.jcr.ItemExistsException: {98dc892a-e9b4-4cc7-b692-936db4cea61e
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Of course the error message is wrong, because how can it be possible that &lt;em&gt;that&lt;/em&gt; node exists. The reason for this exception is that &quot;{&quot; and everything behind that is currently ignored, so that this is equivalent to:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;session.getRootNode().addNode(&quot;.&quot;);
&amp;gt; javax.jcr.ItemExistsException: .
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="15763858" author="reschke" created="Tue, 20 Dec 2016 10:20:50 +0000"  >&lt;p&gt;The two namespace names might be valid to register (although I&apos;d argue no, because the Javadoc talks about URIs), but they are definitively invalid in a name (because that&apos;s &lt;b&gt;defined&lt;/b&gt; to be an URI as per &amp;lt;&lt;a href=&quot;https://greenbytes.de/tech/webdav/rfc3986.html#rfc.section.3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://greenbytes.de/tech/webdav/rfc3986.html#rfc.section.3&lt;/a&gt;&amp;gt;).&lt;/p&gt;

&lt;p&gt;(Yes, that&apos;s what the spec says, not how Jackrabbit/Oak might do things).&lt;/p&gt;

&lt;p&gt;So no, adding shouldn&apos;t work.&lt;/p&gt;</comment>
                            <comment id="15763864" author="tmueller" created="Tue, 20 Dec 2016 10:23:19 +0000"  >&lt;p&gt;The spec is not clear for such cases, but I would prefer if we throw an &quot;Invalid Path&quot; exception when trying to add or read nodes named &quot;{&quot; and similar.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The current implementation does not allow one to add such nodes, so I don&apos;t think we have compatibility issues for adding nodes.&lt;/li&gt;
	&lt;li&gt;Compatibility for reading: sure, any change means it is not 100% compatible, but &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-6383&quot; title=&quot;Unexpected behavior with left curly bracket in resource resolution&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-6383&quot;&gt;SLING-6383&lt;/a&gt; shows that the current behavior is so strange that no sane application would rely on the current behavior (which is: any node name that starts with &quot;{&quot; but doesn&apos;t contain &quot;}&quot; is the same as the current node).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Therefore, I suggest I create a new patch (as small as possible, but with additional unit tests).&lt;/p&gt;</comment>
                            <comment id="15763922" author="bdelacretaz" created="Tue, 20 Dec 2016 10:56:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;...I would prefer if we throw an &quot;Invalid Path&quot; exception when trying to add or read nodes named &quot;{&quot; and similar...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 from my Sling point of view.&lt;/p&gt;</comment>
                            <comment id="15766669" author="tmueller" created="Wed, 21 Dec 2016 10:08:55 +0000"  >&lt;p&gt;Assigned to me (&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jsedding&quot; class=&quot;user-hover&quot; rel=&quot;jsedding&quot;&gt;jsedding&lt;/a&gt; I hope that&apos;s fine for you).&lt;/p&gt;</comment>
                            <comment id="15766675" author="tmueller" created="Wed, 21 Dec 2016 10:11:51 +0000"  >&lt;p&gt;In todays Oak call we concluded that it&apos;s best if the parser is changes such that subpaths with leading left curly bracket (and no right curly bracket) are considered to be invalid. If somebody doesn&apos;t agree, please speak up.&lt;/p&gt;</comment>
                            <comment id="15766960" author="jsedding" created="Wed, 21 Dec 2016 12:37:13 +0000"  >&lt;p&gt;Fine with me &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt;, please go ahead. I agree that the risk is smaller this way.&lt;/p&gt;</comment>
                            <comment id="15769806" author="tmueller" created="Thu, 22 Dec 2016 11:14:18 +0000"  >&lt;p&gt;After the patch, trying to add node using the JCR API (addNode) with such a path will throw a different exception. It used to throw an ItemExistsException, now it will throw a PathNotFoundException. I find that weird as well, but it is consistent with other illegal node names.&lt;/p&gt;</comment>
                            <comment id="15769811" author="tmueller" created="Thu, 22 Dec 2016 11:15:53 +0000"  >&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/r1775628&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1775628&lt;/a&gt; (trunk)&lt;/p&gt;</comment>
                            <comment id="15794835" author="edivad" created="Tue, 3 Jan 2017 11:24:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; could you please backport to 1.4? Cut date is 9th Jan.&lt;/p&gt;</comment>
                            <comment id="15801105" author="tmueller" created="Thu, 5 Jan 2017 11:23:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=edivad&quot; class=&quot;user-hover&quot; rel=&quot;edivad&quot;&gt;edivad&lt;/a&gt; I&apos;m sorry I didn&apos;t see your message. Created &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-5410&quot; title=&quot;Backport OAK-5260 (Incorrect handling of subpaths with leading left curly bracket)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-5410&quot;&gt;&lt;del&gt;OAK-5410&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15821834" author="edivad" created="Fri, 13 Jan 2017 14:13:53 +0000"  >&lt;p&gt;Bulk close for 1.4.12&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13026995">SLING-6383</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13564200">OAK-10596</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13032225">OAK-5410</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13030093">OAK-5367</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12842598" name="OAK-5260-jsedding.patch" size="4060" author="jsedding" created="Fri, 9 Dec 2016 18:56:22 +0000"/>
                            <attachment id="12842565" name="OAK-5260.patch" size="1878" author="bdelacretaz" created="Fri, 9 Dec 2016 14:41:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 44 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37emv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>