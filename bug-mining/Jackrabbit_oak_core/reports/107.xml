<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:35:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-380] Define conversion of property values</title>
                <link>https://issues.apache.org/jira/browse/OAK-380</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;i just run into the situation of converting a propertystate&apos;s value&lt;br/&gt;
of type Date to a Long, which currently throws numberformatexception.&lt;/p&gt;

&lt;p&gt;while i can work around this, i think we should come up with a clear&lt;br/&gt;
definition on value conversion provided by oak-api. the only thing i&lt;br/&gt;
found so far was the description in PropertyState#getValue that claims&lt;br/&gt;
that a conversion in done but not which conversions are supported.&lt;br/&gt;
unless otherwise specified i had silently expected that simple jcr-conversions&lt;br/&gt;
would work.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12612209">OAK-380</key>
            <summary>Define conversion of property values</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="angela">Angela Schreiber</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Oct 2012 11:58:21 +0000</created>
                <updated>Tue, 21 May 2013 11:26:38 +0000</updated>
                            <resolved>Wed, 27 Feb 2013 14:14:59 +0000</resolved>
                                                    <fixVersion>0.7</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13477811" author="mduerig" created="Wed, 17 Oct 2012 12:20:11 +0000"  >&lt;p&gt;The conversions currently in place are the same we had earlier on &lt;tt&gt;CoreValue&lt;/tt&gt; (i.e. before &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-350&quot; title=&quot;Unify PropertyState and CoreValue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-350&quot;&gt;&lt;del&gt;OAK-350&lt;/del&gt;&lt;/a&gt;). I&apos;m not sure what the original motivation was for the kind of conversions which are built in but I think we should either&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Provide no conversion at all at that level but have a dedicated utility for handling conversions or,&lt;/li&gt;
	&lt;li&gt;provide all conversion mandated by JCR.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;In the latter case I&apos;d still delegate that conversion functionality to a utility method which then could also be used otherwise. &lt;/p&gt;</comment>
                            <comment id="13477852" author="anchela" created="Wed, 17 Oct 2012 13:20:25 +0000"  >&lt;p&gt;i don&apos;t have any particular preference... i just think it&apos;s odd if the conversion is&lt;br/&gt;
done halfway and everyone needs to write the same code.&lt;/p&gt;

&lt;p&gt;in any case i feel that the oak-api needs to be totally clear about this and explain&lt;br/&gt;
which conversions are made and which conversions fail and how the legitimate&lt;br/&gt;
jcr conversions can be achieved... something along that line...&lt;/p&gt;</comment>
                            <comment id="13479029" author="mduerig" created="Thu, 18 Oct 2012 14:25:30 +0000"  >&lt;p&gt;I made the current conversions explicit with revision 1399669. All conversions from the various &lt;tt&gt;PropertyState&lt;/tt&gt; implementations no go through the new &lt;tt&gt;Conversions&lt;/tt&gt; class which can also be used standalone.&lt;/p&gt;

&lt;p&gt;The ideas is that at this level only the conversions between the various representations of values as Java types are handled. That is, conversions between &lt;tt&gt;String&lt;/tt&gt;, &lt;tt&gt;Blob&lt;/tt&gt;, &lt;tt&gt;long&lt;/tt&gt;, &lt;tt&gt;double&lt;/tt&gt;, &lt;tt&gt;boolean&lt;/tt&gt; and &lt;tt&gt;BigDecimal&lt;/tt&gt;. &lt;br/&gt;
Conversions of values encoded into these types (e.g. PATH) should be handled separately. Currently this is done within &lt;tt&gt;ValueImpl&lt;/tt&gt; and &lt;tt&gt;ValueFactoryImpl&lt;/tt&gt;. However, since we might need such conversions also outside of the scope of JCR values, the next step here should be to untangle conversion of JCR values and &lt;tt&gt;ValueImpl&lt;/tt&gt;/&lt;tt&gt;ValueFactoryImpl&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="13479965" author="mduerig" created="Fri, 19 Oct 2012 11:42:02 +0000"  >&lt;p&gt;After a 2nd though, it might make sense to extend these conversions to all JCR types. That way we&apos;d have a single place where the conversions are defined and which could be used from other code as well. Note, that even then conversions involving name/path mappings would still have to be made explicitly. When done through the &lt;tt&gt;PropertyState.getValue()&lt;/tt&gt; methods such conversions would either fail or use a default name/path mapping (preferences?). &lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="13479973" author="jukkaz" created="Fri, 19 Oct 2012 12:21:56 +0000"  >&lt;p&gt;To start with I&apos;m not too excited about having JCR value types present in oak-core. I&apos;d rather just deal with JSON types (with default JavaScript type conversions) at this level and leave more complex typing to oak-jcr and the various JCR-related plugins we have.&lt;/p&gt;

&lt;p&gt;Anyway, since we now do have JCR values types in oak-core, I think it would make sense to also support JCR value conversions directly through the API instead of a separate utility class. However, I&apos;d still exclude all name mappings from oak-core.&lt;/p&gt;</comment>
                            <comment id="13479986" author="anchela" created="Fri, 19 Oct 2012 12:49:06 +0000"  >&lt;p&gt;+1 for extending the conversion to all jcr-types&lt;br/&gt;
+1 for direct conversion in the API&lt;/p&gt;

&lt;p&gt;regarding proper jcr compliant conversion of name/paths: as far as i remember there very&lt;br/&gt;
few valid conversions (something like uri/string/name/path are convertable).&lt;br/&gt;
i think i would leave the namespace / expanded name and path handling to jcr only&lt;br/&gt;
but support anything that was straight forward.&lt;/p&gt;
</comment>
                            <comment id="13479995" author="mduerig" created="Fri, 19 Oct 2012 13:00:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;To start with I&apos;m not too excited about having JCR value types present in oak-core...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed, however it turned out that in the other case conversions tend to scatter all over the code. I think there is no much harm done here since if you ignore the definitions for date, name, path, reference, weakreference and uri in &lt;tt&gt;Type&lt;/tt&gt;, you are back to just the JSON types.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;+1 for direct conversion in the API&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok, the implementation will still delegate to the utility class. Since these conversions will be needed from other places which don&apos;t deal with property states directly too.&lt;/p&gt;</comment>
                            <comment id="13480525" author="mduerig" created="Fri, 19 Oct 2012 23:38:50 +0000"  >&lt;p&gt;Turns out that the only missing part was conversions for dates. I added these in revision 1400338. &lt;br/&gt;
In revision 1400339 I refactored ValueImpl et. all. to make use of the new conversion utilities as much as possible. Anything left?&lt;/p&gt;</comment>
                            <comment id="13487661" author="mreutegg" created="Wed, 31 Oct 2012 10:36:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;Anything left?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;performance... toCalendar() is quite slow on my system. 1 million calls take ~80 seconds on my system because of the TimeZone lookup. In revision 1404080 I changed that into a static field, which speeds up the 1 millions calls considerably. Now it takes 700 ms on my system.&lt;/p&gt;</comment>
                            <comment id="13588372" author="mduerig" created="Wed, 27 Feb 2013 14:14:59 +0000"  >&lt;p&gt;Fixed at revision 1404080&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>249279</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 38 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0a6jr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57334</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>