<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:42:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1468] DocumentNodeStore.readChildDocs can return null entries, leading to NPE</title>
                <link>https://issues.apache.org/jira/browse/OAK-1468</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;While running some test I see the following NPE:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: java.lang.NullPointerException: null
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStore.readChildren(DocumentNodeStore.java:629)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStore$3.call(DocumentNodeStore.java:589)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStore$3.call(DocumentNodeStore.java:586)
	at org.apache.jackrabbit.oak.cache.CacheLIRS$Segment.get(CacheLIRS.java:841)
	at org.apache.jackrabbit.oak.cache.CacheLIRS.get(CacheLIRS.java:212)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStore.getChildren(DocumentNodeStore.java:586)
	... 25 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The NPE shouldn&apos;t be possible there, because the Callable implementation returns a non-null value (unless I&apos;m terribly mistaken). The hasMore flag of the returned Children object is set before each of the returns statements in DocumentNodeStore.readChildren().&lt;/p&gt;

&lt;p&gt;Please note, this happened with a previous version of Oak where the default cache implementation was CacheLIRS. Right now, the DocumentNodeStore uses the Guava implementation per default.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12697153">OAK-1468</key>
            <summary>DocumentNodeStore.readChildDocs can return null entries, leading to NPE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mreutegg">Marcel Reutegger</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Feb 2014 17:05:28 +0000</created>
                <updated>Tue, 11 Mar 2014 09:51:21 +0000</updated>
                            <resolved>Wed, 26 Feb 2014 14:57:28 +0000</resolved>
                                    <version>0.17</version>
                                    <fixVersion>0.18</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13912894" author="tmueller" created="Wed, 26 Feb 2014 13:40:58 +0000"  >&lt;p&gt;I can add a check for null in the LIRS cache, but I don&apos;t think that&apos;s the problem here. According to the stack trace, this looks like DocumentNodeStore revision 1566532, and the relevant lines are:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;573: Node.Children getChildren(@Nonnull final Node parent, ...
586:   children = nodeChildrenCache.get(key, new Callable&amp;lt;Node.Children&amp;gt;() {
588:     public Node.Children call() throws Exception {
589:       return readChildren(parent, name, limit);
...
624:   docs = readChildDocs(path, name, rawLimit);
626:   for (NodeDocument doc : docs) {
629:    String p = Utils.getPathFromId(doc.getId());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As far as I see, &quot;doc&quot; could be null at that point, as &quot;readChildDocs&quot; returns an iterator that does a transformation that uses &quot;store.find(Collection.NODES, Utils.getIdFromPath(p))&quot;, which can return null.&lt;/p&gt;</comment>
                            <comment id="13912901" author="tmueller" created="Wed, 26 Feb 2014 13:48:07 +0000"  >&lt;p&gt;Looking at the latest version of the code, I think the NPE can still occur (even when using the Guava cache), if one of the child nodes returned by readChildDocs  doesn&apos;t exist.&lt;/p&gt;</comment>
                            <comment id="13912921" author="tmueller" created="Wed, 26 Feb 2014 13:59:50 +0000"  >&lt;p&gt;The LIRS cache would already throw a NPE &quot;The value may not be null&quot; if the cache loader returns null. Test case added in revision 1572053.&lt;/p&gt;</comment>
                            <comment id="13912941" author="tmueller" created="Wed, 26 Feb 2014 14:06:30 +0000"  >&lt;p&gt;Revision 1572057: improved error message if the document was not found&lt;/p&gt;</comment>
                            <comment id="13912986" author="mreutegg" created="Wed, 26 Feb 2014 14:57:28 +0000"  >&lt;p&gt;Thanks for your help. Turns out I &lt;b&gt;was&lt;/b&gt; terribly wrong :-/ I mixed up the DocumentNodeStore revisions and assumed the issue is in a different location.&lt;/p&gt;

&lt;p&gt;It&apos;s a bit strange to see a document does not exist when it previously did. I guess it must be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1467&quot; title=&quot;Commit.rollback() may remove changes from other commit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1467&quot;&gt;&lt;del&gt;OAK-1467&lt;/del&gt;&lt;/a&gt;. Previously a rollback would remove an inserted document again. This is not the case anymore.&lt;/p&gt;

&lt;p&gt;Resolving as fixed.&lt;/p&gt;</comment>
                            <comment id="13912987" author="mreutegg" created="Wed, 26 Feb 2014 14:57:47 +0000"  >&lt;p&gt;Probably related to &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1467&quot; title=&quot;Commit.rollback() may remove changes from other commit&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1467&quot;&gt;&lt;del&gt;OAK-1467&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13930173" author="alex.parvulescu" created="Tue, 11 Mar 2014 09:51:21 +0000"  >&lt;p&gt;bulk close for the 0.18 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12697101">OAK-1467</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>375627</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1sq8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>375923</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>