<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:39:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-999] Version creates frozenNode children with orignial NoteType instead of frozenNode</title>
                <link>https://issues.apache.org/jira/browse/OAK-999</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;For a Version the the children of a the Versions FrozenNode have the the NodeType of their origin if they are not rferenceable. Expected is nt:frozenNode.&lt;/p&gt;

&lt;p&gt;The JCR Spec is not explicit on the node-type for this Nodes but it is not Compatible with JR2&lt;/p&gt;

&lt;p&gt;Dummy Test Case that just starts a Oak Repository&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Issue &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; RepositoryBaseTest {

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testVersionChild() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; RepositoryException {
        Session admin = getAdminSession();
        Node parent = admin.getRootNode().addNode(getClass().getSimpleName()+&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis(), JcrConstants.NT_UNSTRUCTURED);
        Node child = parent.addNode(&lt;span class=&quot;code-quote&quot;&gt;&quot;child&quot;&lt;/span&gt;);
        parent.addMixin(JcrConstants.MIX_VERSIONABLE);
        admin.save();
        VersionManager vm = admin.getWorkspace().getVersionManager();
        Version v = vm.checkin(parent.getPath());

        Node frozenChild = v.getFrozenNode().getNode(child.getName());
        Assert.assertEquals(JcrConstants.NT_FROZENNODE, frozenChild.getPrimaryNodeType().getName());
    }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12666934">OAK-999</key>
            <summary>Version creates frozenNode children with orignial NoteType instead of frozenNode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="chkeller">Christan Keller</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Sep 2013 17:39:34 +0000</created>
                <updated>Fri, 20 Sep 2013 07:01:42 +0000</updated>
                            <resolved>Wed, 11 Sep 2013 06:32:15 +0000</resolved>
                                    <version>0.8</version>
                                    <fixVersion>0.9</fixVersion>
                                    <component>jcr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13758850" author="mreutegg" created="Thu, 5 Sep 2013 07:24:06 +0000"  >&lt;p&gt;This was done on purpose. See &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-168?focusedCommentId=13651910&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13651910&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/OAK-168?focusedCommentId=13651910&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13651910&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In my view the spec is rather clear on what is expected. E.g. in the Versionable State section of the spec (&lt;a href=&quot;http://www.day.com/specs/jcr/2.0/3_Repository_Model.html#3.13.9%20Versionable%20State&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.day.com/specs/jcr/2.0/3_Repository_Model.html#3.13.9%20Versionable%20State&lt;/a&gt;) it says:&lt;/p&gt;

&lt;p&gt;&quot;For each child node C of N where&lt;/p&gt;

&lt;p&gt;    C has an OPV of COPY,&lt;/p&gt;

&lt;p&gt;a copy of the entire subgraph rooted at C ...&quot;&lt;/p&gt;

&lt;p&gt;Similarly for OPV of VERSION. There is also the problem with the nt:frozenNode node type. It contains a jcr:frozenUuid property. In Jackrabbit 2.x every node had an internal UUID even if it isn&apos;t referenceable, and this UUID was then used for jcr:frozenUuid. But Oak doesn&apos;t assign a UUID to a non-referenceable node. To me it seems nt:frozenNode only make sense for referenceable nodes.&lt;/p&gt;

&lt;p&gt;What kind of backward compatibility issue did you face with this? Is it query related? E.g. you get more results because nodes from the version storage match, which previously wouldn&apos;t?&lt;/p&gt;</comment>
                            <comment id="13758913" author="chkeller" created="Thu, 5 Sep 2013 09:08:52 +0000"  >&lt;p&gt;To start, my myjor concern is not of the &quot;proper&quot; interpretation fo the Spec.&lt;br/&gt;
It is the compatibilty issue.&lt;br/&gt;
I only put into play as I hoped to get tome insight in the expectations t han.&lt;/p&gt;

&lt;p&gt;My use case is: Iam ineressted in the node-type of one of thes OPV Copy Nodes in the Version.&lt;br/&gt;
While in Jackrabbit 2.0 i have to access it from the jcr:frozenPrimaryType while in Oak from the jcr:primaryType.&lt;/p&gt;

&lt;p&gt;As I said the spec is not explicit about the nodeType.&lt;br/&gt;
Sure you can read &quot;copy&quot; as inluding the nodeType. Maybe the fact they mentioned the name will remain the same in this copy. &lt;br/&gt;
(&lt;a href=&quot;http://www.day.com/specs/jcr/2.0/3_Repository_Model.html#3.13.3.5%20Frozen%20Node&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.day.com/specs/jcr/2.0/3_Repository_Model.html#3.13.3.5%20Frozen%20Node&lt;/a&gt;)&lt;br/&gt;
I have a tendency to interpret the spec to have intended that each version-Node has exactly on FrozenNode (of type nt:frozenNode)&lt;/p&gt;

&lt;p&gt;Regardless of this, when it comes to spec-conformity, I think the chosen Oak solution is not consistent.&lt;br/&gt;
You have differnt interpretation for the word &quot;copy&quot; in case it is a mix:referenceable Node or not.&lt;/p&gt;
</comment>
                            <comment id="13758933" author="mreutegg" created="Thu, 5 Sep 2013 09:20:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;differnt interpretation for the word &quot;copy&quot; in case it is a mix:referenceable Node or not&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree, that&apos;s not really consistent.&lt;/p&gt;

&lt;p&gt;What if we changed it use nt:frozenNode even for copied nodes, but set the jcr:frozenUuid to a dummy value for non-referenceable nodes? E.g. an empty string. Would this be a problem for your use case?&lt;/p&gt;</comment>
                            <comment id="13759027" author="anchela" created="Thu, 5 Sep 2013 12:34:10 +0000"  >&lt;p&gt;maybe the definition of the nt:frozenNode is simply wrong by defining the jcr:frozenUuid property as mandatory? in jackrabbit-core nobody would have noticed since the all nodes had a uuid anyway...&lt;/p&gt;</comment>
                            <comment id="13759116" author="chkeller" created="Thu, 5 Sep 2013 14:38:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt;&lt;br/&gt;
My case would be fixed with the consistent nt:frozenNodes for the version graph with &quot;dummy&quot; frozenUUID values for non-referenceable Nodes.&lt;/p&gt;

&lt;p&gt;If I am right the Jackrabbits UUID /NodeId for non-referenceable Nodes has only been accessable by use of jackrabbit.core classes and Implementaion classes.&lt;br/&gt;
Its usage in the field should therefor be very restricted. Bugs where people use the frozenUUID to access the &quot;normal&quot; (unversioned) Node should be rare.&lt;/p&gt;

&lt;p&gt;Apart from that this retundant value may cause other issues.&lt;/p&gt;

&lt;p&gt;(&lt;a href=&quot;http://www.day.com/specs/jcr/2.0/3_Repository_Model.html#3.13.4.4%20Frozen%20Identifier&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.day.com/specs/jcr/2.0/3_Repository_Model.html#3.13.4.4%20Frozen%20Identifier&lt;/a&gt;)&lt;br/&gt;
May open a solution to give a value that may allow to enter a value for non-referencable Nodes without risk, like use the Path?&lt;/p&gt;</comment>
                            <comment id="13760051" author="anchela" created="Fri, 6 Sep 2013 08:31:33 +0000"  >&lt;p&gt;ok... in this case the mandatory flag is probably correct but we should rather read the&lt;br/&gt;
jcr:frozenUUID to be the frozen identifier of the node, which apart from referenceable nodes is a implementation detail. that way round it actually makes sense.&lt;/p&gt;</comment>
                            <comment id="13764048" author="mreutegg" created="Wed, 11 Sep 2013 06:32:15 +0000"  >&lt;p&gt;For now I simply set the jcr:frozenUuid for non-referenceable nodes to an empty value. I will open a follow up issue to fix this and use the identifier instead.&lt;/p&gt;

&lt;p&gt;Fixed in &lt;a href=&quot;http://svn.apache.org/r1521744&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1521744&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13772792" author="alex.parvulescu" created="Fri, 20 Sep 2013 07:01:42 +0000"  >&lt;p&gt;Bulk close for the 0.9 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>346871</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ntbb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>347171</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>