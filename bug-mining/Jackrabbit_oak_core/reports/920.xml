<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:44:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1877] Hourly async reindexing on an idle instance</title>
                <link>https://issues.apache.org/jira/browse/OAK-1877</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1292&quot; title=&quot;Avoid async indexer commits when there are no changes to index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1292&quot;&gt;&lt;del&gt;OAK-1292&lt;/del&gt;&lt;/a&gt; introduced the following interesting but not very nice behavior:&lt;/p&gt;

&lt;p&gt;On an idle system with no changes for an extended amount of time, the &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1292&quot; title=&quot;Avoid async indexer commits when there are no changes to index&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1292&quot;&gt;&lt;del&gt;OAK-1292&lt;/del&gt;&lt;/a&gt; change blocks the async indexer from updating the reference to the last indexed checkpoint. After one hour (the default checkpoint lifetime), the referenced checkpoint will expire, and the indexer will fall back to full reindexing.&lt;/p&gt;

&lt;p&gt;The result of this behavior is that once every hour, the size of an idle instance will grow with dozens or hundreds of megabytes of new index data generated by reindexing. Older index data becomes garbage, but the compaction code from &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1804&quot; title=&quot;TarMK compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1804&quot;&gt;&lt;del&gt;OAK-1804&lt;/del&gt;&lt;/a&gt; is needed to make it collectable. A better solution would be to prevent the reindexing from happening in the first place.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12719106">OAK-1877</key>
            <summary>Hourly async reindexing on an idle instance</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="jukkaz">Jukka Zitting</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Jun 2014 04:19:18 +0000</created>
                <updated>Wed, 1 Oct 2014 13:14:10 +0000</updated>
                            <resolved>Mon, 16 Jun 2014 14:23:34 +0000</resolved>
                                    <version>1.0</version>
                                    <fixVersion>1.0.1</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14021566" author="jukkaz" created="Mon, 9 Jun 2014 04:32:25 +0000"  >&lt;p&gt;I committed an initial fix in revision 1601309. It increases the checkpoint lifetime to about 3 years (i.e. practically infinite) and only creates them if something actually has changed in the repository.&lt;/p&gt;</comment>
                            <comment id="14021795" author="alex.parvulescu" created="Mon, 9 Jun 2014 09:35:02 +0000"  >&lt;p&gt;good catch!&lt;/p&gt;</comment>
                            <comment id="14025232" author="jukkaz" created="Mon, 9 Jun 2014 14:43:35 +0000"  >&lt;p&gt;I ran a test with this change overnight, and the result is that an idle (AEM6) repository only grows about 1MB per hour (haven&apos;t yet figured out where that growth is coming from). That is two orders of magnitude less than before with no regressions I can find, so I merged the fix to the 1.0 branch in revision 1601396. I think we can consider this issue resolved.&lt;/p&gt;</comment>
                            <comment id="14029280" author="alex.parvulescu" created="Thu, 12 Jun 2014 15:46:12 +0000"  >&lt;p&gt;I added a null check surrounding the release call. This prevents a NPE and complies with the api contract of never passing a null value. (trunk rev 1602207, branch 1.0 rev 1602211).&lt;/p&gt;</comment>
                            <comment id="14032122" author="jukkaz" created="Mon, 16 Jun 2014 05:34:34 +0000"  >&lt;p&gt;There was a related problem in that the indexing status properties written by the async indexer would end up triggering the next async indexing iteration, thus still causing a new checkpoint to be created once every five seconds even if no other changes were committed between successive async indexer invocations. I fixed that in revision 1602796 (and 1602797), and merged the changes to the 1.0 branch in revision 1602798.&lt;/p&gt;</comment>
                            <comment id="14032428" author="alex.parvulescu" created="Mon, 16 Jun 2014 13:43:27 +0000"  >&lt;p&gt;there&apos;s a regression from the latest changes: content changes that are not indexed would generate a new checkpoint, but fail to properly link it from the &apos;async&apos; reference, resulting in a large number of warning messages because of the missing initial checkpoint.&lt;/p&gt;

&lt;p&gt;attached a proposed patch with some updates tests that also check the &apos;async&apos; reference to the checkpoints.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;jukkaz&lt;/a&gt; can you take a look?&lt;/p&gt;</comment>
                            <comment id="14032461" author="alex.parvulescu" created="Mon, 16 Jun 2014 14:23:34 +0000"  >&lt;p&gt;changed the patch a bit, talked to Jukka and we&apos;ve decided to keep the latest checkpoint and simply update the ref to it, instead of keeping the old one (good for gc reasons too).&lt;/p&gt;

&lt;p&gt;Marking as fixed, on trunk with rev &lt;a href=&quot;http://svn.apache.org/r1602872&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1602872&lt;/a&gt;, on 1.0 with rev 1602874.&lt;/p&gt;</comment>
                            <comment id="14035897" author="ptager" created="Wed, 18 Jun 2014 16:17:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;jukkaz&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alex.parvulescu&quot; class=&quot;user-hover&quot; rel=&quot;alex.parvulescu&quot;&gt;alex.parvulescu&lt;/a&gt;&lt;br/&gt;
are we tracking the long term solution to eliminate the remaining 1MB growth per hour, or has that been fixed with the latest changes?&lt;/p&gt;

&lt;p&gt;Got your answer on Granite-6164, thanks.&lt;/p&gt;</comment>
                            <comment id="14038598" author="kwin" created="Fri, 20 Jun 2014 08:53:06 +0000"  >&lt;p&gt;Is the 1MB growth fixed as well with this? If not is there another Oak-ticket to track that? Not everyone has access to Granite-6164 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14038614" author="alex.parvulescu" created="Fri, 20 Jun 2014 09:29:22 +0000"  >&lt;p&gt;The growth problem is considered fixed as part of this issue. Whatever size increase you might still notice thanks to background tasks, or simply repo updates, can be cleaned up by running the #gc operation regularly.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12650564" name="updates-without-indexed-changes.patch" size="5814" author="stillalex" created="Mon, 16 Jun 2014 13:43:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>397305</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 22 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1wehj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>397432</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>