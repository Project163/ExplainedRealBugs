<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:36:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-666] Property2Index: node type is used when indexing, but ignored when querying</title>
                <link>https://issues.apache.org/jira/browse/OAK-666</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The Property2Index filters by node type, so each index only contains data for a list of node types.&lt;/p&gt;

&lt;p&gt;But the getCost and and query methods ignore the node type.&lt;/p&gt;

&lt;p&gt;Because of that, if there are multiple indexes for the same property, each index filtering on certain node types, then running a query might pick the wrong index.&lt;/p&gt;

&lt;p&gt;The result is that the query doesn&apos;t return any data where it should, because the index doesn&apos;t return the right nodes.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12635304">OAK-666</key>
            <summary>Property2Index: node type is used when indexing, but ignored when querying</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stillalex">Alex Deparvu</assignee>
                                    <reporter username="thomasm">Thomas Mueller</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Mar 2013 09:37:29 +0000</created>
                <updated>Tue, 21 May 2013 11:26:23 +0000</updated>
                            <resolved>Thu, 7 Mar 2013 12:22:41 +0000</resolved>
                                                    <fixVersion>0.7</fixVersion>
                                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13593272" author="anchela" created="Tue, 5 Mar 2013 09:56:18 +0000"  >&lt;p&gt;this might go along with the lack of proper node type resolution with the node type aware&lt;br/&gt;
index definitions: according to alexP that restriction will currently only work if the&lt;br/&gt;
&apos;exact&apos; node type names are specified (super types will not work). since the evaluation&lt;br/&gt;
needs to be aware of super types it might be worth addressing that as well in the definition&lt;br/&gt;
setup.&lt;/p&gt;</comment>
                            <comment id="13593321" author="tmueller" created="Tue, 5 Mar 2013 11:04:44 +0000"  >&lt;p&gt;Workaround:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;#P oak-core
Index: src/main/java/org/apache/jackrabbit/oak/security/authorization/AccessControlInitializer.java
===================================================================
--- src/main/java/org/apache/jackrabbit/oak/security/authorization/AccessControlInitializer.java	(revision 1452338)
+++ src/main/java/org/apache/jackrabbit/oak/security/authorization/AccessControlInitializer.java	(working copy)
@@ -39,10 +39,10 @@
     &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; NodeState initialize(NodeState workspaceRoot, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; workspaceName, IndexHookProvider indexHook, QueryIndexProvider indexProvider, CommitHook commitHook) {
         NodeBuilder root = workspaceRoot.builder();
         &lt;span class=&quot;code-comment&quot;&gt;// property index &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; rep:principalName stored in ACEs
&lt;/span&gt;-        NodeBuilder index = IndexUtils.getOrCreateOakIndex(root);
-        IndexUtils.createIndexDefinition(index, &lt;span class=&quot;code-quote&quot;&gt;&quot;acPrincipalName&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,
-                ImmutableList.&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;of(REP_PRINCIPAL_NAME),
-                ImmutableList.&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;of(NT_REP_DENY_ACE, NT_REP_GRANT_ACE));
+&lt;span class=&quot;code-comment&quot;&gt;//        NodeBuilder index = IndexUtils.getOrCreateOakIndex(root);
&lt;/span&gt;+&lt;span class=&quot;code-comment&quot;&gt;//        IndexUtils.createIndexDefinition(index, &lt;span class=&quot;code-quote&quot;&gt;&quot;acPrincipalName&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,
&lt;/span&gt;+&lt;span class=&quot;code-comment&quot;&gt;//                ImmutableList.&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;of(REP_PRINCIPAL_NAME),
&lt;/span&gt;+&lt;span class=&quot;code-comment&quot;&gt;//                ImmutableList.&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;of(NT_REP_DENY_ACE, NT_REP_GRANT_ACE));
&lt;/span&gt;         &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; root.getNodeState();
     }
 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13593323" author="tmueller" created="Tue, 5 Mar 2013 11:10:47 +0000"  >&lt;p&gt;The workaround disabled the second index on rep:principalName, so queries that filter on rep:principalName don&apos;t use it.&lt;/p&gt;

&lt;p&gt;Please note the &quot;reproducability&quot; of this bug depends on the order of child nodes in the MicroKernel. So you might not be able to reproduce it when using the MicroKernelImpl, but only with the MongoMK (for example).&lt;/p&gt;</comment>
                            <comment id="13595818" author="alex.parvulescu" created="Thu, 7 Mar 2013 12:22:41 +0000"  >&lt;p&gt;good find!&lt;/p&gt;

&lt;p&gt;my tests did not cover this scenario at all really: having 2 indexes on the same property but with different node types.&lt;/p&gt;

&lt;p&gt;I&apos;ve seen both indexing and query time problems: as mentioned it all could work or fail based on which index node came up first.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>315797</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 37 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ihrz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>316140</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>