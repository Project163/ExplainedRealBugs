<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:44:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1916] NodeStoreKernel doesn&apos;t handle array properties correctly</title>
                <link>https://issues.apache.org/jira/browse/OAK-1916</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;&lt;tt&gt;NodeStoreKernel&lt;/tt&gt; currently only supports array properties of type long. For other types it will fail with an &lt;tt&gt;IllegalStateException&lt;/tt&gt;. See also the FIXME in the code.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12723649">OAK-1916</key>
            <summary>NodeStoreKernel doesn&apos;t handle array properties correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mduerig">Michael D&#252;rig</assignee>
                                    <reporter username="mduerig">Michael D&#252;rig</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Jun 2014 14:57:28 +0000</created>
                <updated>Mon, 10 Nov 2014 14:19:55 +0000</updated>
                            <resolved>Fri, 27 Jun 2014 12:59:48 +0000</resolved>
                                                    <fixVersion>1.0.9</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>mk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14043577" author="mduerig" created="Wed, 25 Jun 2014 14:58:46 +0000"  >&lt;p&gt;Proposed patch&lt;/p&gt;</comment>
                            <comment id="14043588" author="mduerig" created="Wed, 25 Jun 2014 15:05:15 +0000"  >&lt;p&gt;Above patch adds support for array properties of other types than long. However this seems to uncover a problem with the SegementMK:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;MicroKernel mk = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NodeStoreKernel(NodeStoreFixture.SEGMENT_MK.createNodeStore());
NodeStore nodeStore = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KernelNodeStore(mk);
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Jcr(nodeStore).createRepository();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;results in a NPE:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.NullPointerException
	at org.apache.jackrabbit.oak.plugins.segment.SegmentWriter.writeProperty(SegmentWriter.java:818)
	at org.apache.jackrabbit.oak.plugins.segment.SegmentWriter.writeProperty(SegmentWriter.java:813)
	at org.apache.jackrabbit.oak.plugins.segment.SegmentWriter.writeNode(SegmentWriter.java:1021)
	at org.apache.jackrabbit.oak.plugins.segment.SegmentWriter$2.childNodeChanged(SegmentWriter.java:990)
	at org.apache.jackrabbit.oak.plugins.memory.ModifiedNodeState.compareAgainstBaseState(ModifiedNodeState.java:396)
	at org.apache.jackrabbit.oak.plugins.segment.SegmentWriter.writeNode(SegmentWriter.java:981)
	at org.apache.jackrabbit.oak.plugins.segment.SegmentWriter.writeNode(SegmentWriter.java:1009)
	at org.apache.jackrabbit.oak.plugins.segment.SegmentNodeBuilder.getNodeState(SegmentNodeBuilder.java:61)
	at org.apache.jackrabbit.oak.plugins.segment.SegmentNodeBuilder.updated(SegmentNodeBuilder.java:46)
	at org.apache.jackrabbit.oak.plugins.memory.MemoryNodeBuilder.updated(MemoryNodeBuilder.java:205)
	at org.apache.jackrabbit.oak.plugins.memory.MemoryNodeBuilder.setProperty(MemoryNodeBuilder.java:489)
	at org.apache.jackrabbit.oak.plugins.memory.MemoryNodeBuilder.setProperty(MemoryNodeBuilder.java:495)
	at org.apache.jackrabbit.oak.kernel.NodeStoreKernel.addNode(NodeStoreKernel.java:293)
	at org.apache.jackrabbit.oak.kernel.NodeStoreKernel.addNode(NodeStoreKernel.java:273)
	at org.apache.jackrabbit.oak.kernel.NodeStoreKernel.addNode(NodeStoreKernel.java:273)
	at org.apache.jackrabbit.oak.kernel.NodeStoreKernel.addNode(NodeStoreKernel.java:273)
	at org.apache.jackrabbit.oak.kernel.NodeStoreKernel.addNode(NodeStoreKernel.java:273)
	at org.apache.jackrabbit.oak.kernel.NodeStoreKernel.addNode(NodeStoreKernel.java:273)
	at org.apache.jackrabbit.oak.kernel.NodeStoreKernel.applyJsop(NodeStoreKernel.java:176)
	at org.apache.jackrabbit.oak.kernel.NodeStoreKernel.applyJsop(NodeStoreKernel.java:155)
	at org.apache.jackrabbit.oak.kernel.NodeStoreKernel.commit(NodeStoreKernel.java:519)
	at org.apache.jackrabbit.oak.kernel.KernelNodeStore.commit(KernelNodeStore.java:262)
	at org.apache.jackrabbit.oak.kernel.KernelNodeStoreBranch.persist(KernelNodeStoreBranch.java:111)
	at org.apache.jackrabbit.oak.kernel.KernelNodeStoreBranch.persist(KernelNodeStoreBranch.java:41)
	at org.apache.jackrabbit.oak.spi.state.AbstractNodeStoreBranch$Persisted.persistTransientHead(AbstractNodeStoreBranch.java:625)
	at org.apache.jackrabbit.oak.spi.state.AbstractNodeStoreBranch$Persisted.access$000(AbstractNodeStoreBranch.java:529)
	at org.apache.jackrabbit.oak.spi.state.AbstractNodeStoreBranch$BranchState.persist(AbstractNodeStoreBranch.java:352)
	at org.apache.jackrabbit.oak.spi.state.AbstractNodeStoreBranch$InMemory.setRoot(AbstractNodeStoreBranch.java:476)
	at org.apache.jackrabbit.oak.spi.state.AbstractNodeStoreBranch.setRoot(AbstractNodeStoreBranch.java:220)
	at org.apache.jackrabbit.oak.kernel.KernelRootBuilder.purge(KernelRootBuilder.java:185)
	at org.apache.jackrabbit.oak.kernel.KernelRootBuilder.merge(KernelRootBuilder.java:141)
	at org.apache.jackrabbit.oak.kernel.KernelNodeStore.merge(KernelNodeStore.java:164)
	at org.apache.jackrabbit.oak.spi.lifecycle.OakInitializer.initialize(OakInitializer.java:45)
	at org.apache.jackrabbit.oak.Oak.createContentRepository(Oak.java:512)
	at org.apache.jackrabbit.oak.jcr.Jcr.createRepository(Jcr.java:189)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;jukkaz&lt;/a&gt;, could you have a look at this when you have some time to spare?&lt;/p&gt;</comment>
                            <comment id="14043843" author="jukkaz" created="Wed, 25 Jun 2014 18:03:39 +0000"  >&lt;p&gt;I fixed the SegmentNodeState issue in revision 1605526. Non-name &lt;tt&gt;jcr:primaryType&lt;/tt&gt; or &lt;tt&gt;jcr:mixinTypes&lt;/tt&gt; properties were not being handled correctly.&lt;/p&gt;</comment>
                            <comment id="14044437" author="alex.parvulescu" created="Thu, 26 Jun 2014 07:56:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;Non-name jcr:primaryType or jcr:mixinTypes properties were not being handled correctly.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It looks like there&apos;s now a NPE happening in the PropertyIndex because there is a primary type registered as &lt;em&gt;null&lt;/em&gt;. &lt;br/&gt;
You can see it during the UUID lookup where it will try to get the cost of the node type index using all existing primary node types &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, and encoding the null value results in a NPE.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, nt:file, rep:ChildNodeDefinitions, rep:AuthorizableFolder, nt:versionedChild, nt:activity, nt:hierarchyNode, rep:Group, rep:Members, nt:query, rep:PropertyDefinition, nt:resource, rep:PropertyDefinitions, rep:nodeTypes, rep:Unstructured, nt:unstructured, nt:version, rep:GrantACE, rep:Restrictions, nt:propertyDefinition, rep:DenyACE, nt:versionLabels, nt:nodeType, nt:address, rep:ACE, rep:root, rep:PermissionStore, rep:ACL, nt:childNodeDefinition, nt:frozenNode, rep:MemberReferences, rep:Token, rep:Policy, rep:Privileges, rep:NamedChildNodeDefinitions, rep:MemberReferencesList, rep:AccessControl, oak:QueryIndexDefinition, rep:system, rep:Activities, rep:User, rep:Authorizable, rep:versionStorage, rep:Privilege, nt:configuration, rep:NodeType, rep:ChildNodeDefinition, rep:PrincipalAccessControl, nt:folder, oak:Unstructured, nt:versionHistory, nt:linkedFile, rep:NamedPropertyDefinitions, rep:Permissions, rep:Configurations
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14044651" author="jukkaz" created="Thu, 26 Jun 2014 13:29:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;It looks like there&apos;s now a NPE happening in the PropertyIndex because there is a primary type registered as null. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This behavior is triggered by a limitation in the proof-of-concept -style implementation of &lt;tt&gt;NodeStoreKernel&lt;/tt&gt; (see comment in &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-987&quot; title=&quot;Implement the MicroKernel API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-987&quot;&gt;&lt;del&gt;OAK-987&lt;/del&gt;&lt;/a&gt;). It currently makes no distinction between name and string values, so properties like &lt;tt&gt;jcr:primaryType&lt;/tt&gt; end up stored as strings instead of names. This makes type-safe calls like &lt;tt&gt;NodeState.getName(&quot;jcr:primaryType&quot;)&lt;/tt&gt; return &lt;tt&gt;null&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14045913" author="mduerig" created="Fri, 27 Jun 2014 12:59:48 +0000"  >&lt;p&gt;Fixed at &lt;a href=&quot;http://svn.apache.org/r1606077&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1606077&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14204802" author="mduerig" created="Mon, 10 Nov 2014 14:09:43 +0000"  >&lt;p&gt;This issue had the wrong fix version set. So far it is only fixed in trunk -&amp;gt; set fix version to 1.1.0&lt;/p&gt;</comment>
                            <comment id="14204820" author="mduerig" created="Mon, 10 Nov 2014 14:19:55 +0000"  >&lt;p&gt;Merged into 1.0 at &lt;a href=&quot;http://svn.apache.org/r1637872&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1637872&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12652435" name="OAK-1916.patch" size="5826" author="mduerig" created="Wed, 25 Jun 2014 14:58:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>401834</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1x5zb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>401903</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>