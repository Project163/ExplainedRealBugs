<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:49:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-3434] Revert backwards-incompatible changes to SecurityProviderImpl</title>
                <link>https://issues.apache.org/jira/browse/OAK-3434</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3201&quot; title=&quot;Use static references in SecurityProviderImpl for composite services&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3201&quot;&gt;&lt;del&gt;OAK-3201&lt;/del&gt;&lt;/a&gt; introduced some backwards-incompatible changes to &lt;tt&gt;SecurityProviderImpl&lt;/tt&gt;. It should be investigated if those changes can be reverted to maintain the backwards compatibility of the &lt;tt&gt;org.apache.jackrabbit.oak.security&lt;/tt&gt; package.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12895122">OAK-3434</key>
            <summary>Revert backwards-incompatible changes to SecurityProviderImpl</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="frm">Francesco Mari</assignee>
                                    <reporter username="frm">Francesco Mari</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Sep 2015 13:50:34 +0000</created>
                <updated>Wed, 2 Mar 2016 14:23:14 +0000</updated>
                            <resolved>Tue, 22 Sep 2015 08:32:36 +0000</resolved>
                                                    <fixVersion>1.0.22</fixVersion>
                    <fixVersion>1.2.7</fixVersion>
                    <fixVersion>1.3.7</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14900736" author="frm" created="Mon, 21 Sep 2015 14:12:27 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12761435/12761435_OAK-3434-01.patch&quot; title=&quot;OAK-3434-01.patch attached to OAK-3434&quot;&gt;OAK-3434-01.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; reverts the backwards-incompatible changes introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3201&quot; title=&quot;Use static references in SecurityProviderImpl for composite services&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3201&quot;&gt;&lt;del&gt;OAK-3201&lt;/del&gt;&lt;/a&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anchela&quot; class=&quot;user-hover&quot; rel=&quot;anchela&quot;&gt;anchela&lt;/a&gt;, can you validate the correctness of this patch? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt;, what do you think about the approach to the solution, from an OSGi standpoint?&lt;/p&gt;</comment>
                            <comment id="14902071" author="chetanm" created="Tue, 22 Sep 2015 06:59:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=frm&quot; class=&quot;user-hover&quot; rel=&quot;frm&quot;&gt;frm&lt;/a&gt; Can you provide some details around what were the backward incompatible change done. From mail thread on DL it was not clear on what the breaking change and which this patch is trying to fix&lt;/p&gt;</comment>
                            <comment id="14902175" author="frm" created="Tue, 22 Sep 2015 07:51:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt;, the concerns expressed on oak-dev are about the changes that turned &lt;tt&gt;SecurityProviderImpl&lt;/tt&gt; into a non-component class, e.g. by removing annotations and protected activate/deactivate/bind/unbind methods. There seem to be clients of the &lt;tt&gt;org.apache.jackrabbit.oak.security&lt;/tt&gt; package that extend &lt;tt&gt;SecurityProviderImpl&lt;/tt&gt;, so removing the protected methods is breaking compatibility with those clients. The patch is reverting &lt;tt&gt;SecurityProviderImpl&lt;/tt&gt; and its containing package to how they were before &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3201&quot; title=&quot;Use static references in SecurityProviderImpl for composite services&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3201&quot;&gt;&lt;del&gt;OAK-3201&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14902186" author="chetanm" created="Tue, 22 Sep 2015 07:59:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;There seem to be clients of the org.apache.jackrabbit.oak.security package that extend SecurityProviderImpl&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Do we have clients or its just because bnd thinks we are breaking backward compatibility? Extending OSGi components would anyway not work easily. &lt;/p&gt;</comment>
                            <comment id="14902201" author="frm" created="Tue, 22 Sep 2015 08:10:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt;, there are clients out there extending from &lt;tt&gt;SecurityProviderImpl&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14902202" author="anchela" created="Tue, 22 Sep 2015 08:10:46 +0000"  >&lt;p&gt;we do have clients and i know for sure of one project that extends the existing security provide.&lt;/p&gt;

&lt;p&gt;a part from that: breaking backwards compatibility is IMO &lt;em&gt;always&lt;/em&gt; troublesome because we simply don&apos;t know how our exported public APIs are being used and who uses it. i made a huge effort (and some compromises) to keep oak security as compatible with jackrabbit as possible and there must be really compelling reasons for breaking compatibility within a minor version change. that&apos;s my personal take but comparing the number of issues in the security area compared with other parts of oak, i think it is the right choice.&lt;/p&gt;</comment>
                            <comment id="14902227" author="frm" created="Tue, 22 Sep 2015 08:32:36 +0000"  >&lt;p&gt;Fixed in trunk at r1704479.&lt;/p&gt;</comment>
                            <comment id="14902237" author="chetanm" created="Tue, 22 Sep 2015 08:45:30 +0000"  >&lt;p&gt;Just for the record - From what I know extending OSGi component does not work. So in an OSGi setup if a customer is extending SecurityProvider I do not see how it worked so far. Assuming it worked then also its hard to see how it worked as then you would still have 2 security providers as extending would not cause the first one to be disabled. So it would have been good to first have a test case which can demonstrate this problamatic scenario and then have a fix.&lt;/p&gt;


</comment>
                            <comment id="14902675" author="chetanm" created="Tue, 22 Sep 2015 13:58:41 +0000"  >&lt;p&gt;Also to confirm -Do with current approach we would have 2 SecurityProvider instance registered in service registry?&lt;/p&gt;

&lt;p&gt;If yes then that would cause problem as there are component which rely on SecurityProvider &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; and they would then either need to be modified. At very least the old implementation should be disabled by default and possibly only activated if some config is provision.&lt;/p&gt;

&lt;p&gt;Overall I would recommend to rethink current implemented approach and aim for one where a single SecurityProvider is registered in the system. Otherwise it would lead to non deterministic behaviour.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/sling/blob/trunk/bundles/jcr/oak-server/src/main/java/org/apache/sling/oak/server/OakSlingRepositoryManager.java#L205&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/sling/blob/trunk/bundles/jcr/oak-server/src/main/java/org/apache/sling/oak/server/OakSlingRepositoryManager.java#L205&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14902733" author="frm" created="Tue, 22 Sep 2015 14:41:04 +0000"  >&lt;p&gt;The current implemented approach registers the new &lt;tt&gt;SecurityProvider&lt;/tt&gt; with a property &lt;tt&gt;type=default&lt;/tt&gt;. This property can be used to reference the correct &lt;tt&gt;SecurityProvider&lt;/tt&gt;. I think that there are a couple of solutions to this problem, anyway:&lt;/p&gt;

&lt;p&gt;1. A &lt;tt&gt;policy=ConfigurationPolicy.REQUIRE&lt;/tt&gt; could be added to &lt;tt&gt;SecurityProviderImpl&lt;/tt&gt; so that it will be disabled unless some OSGi configuration is explicitly provided. &lt;tt&gt;SecurityProviderImpl&lt;/tt&gt; would still be a component, just not active by default.&lt;/p&gt;

&lt;p&gt;2. The &lt;tt&gt;@Component&lt;/tt&gt; annotation could be removed, removing any chance that &lt;tt&gt;SecurityProviderImpl&lt;/tt&gt; would hit the service registry again. While this would not impact the backwards compatibility of &lt;tt&gt;SecurityProviderImpl&lt;/tt&gt;, this would increase the version of the exported package to &lt;tt&gt;2.0.0&lt;/tt&gt;, unless we manually implement the methods that are currently generated by the Maven SCR plugin. I don&apos;t think that this is an option.&lt;/p&gt;

&lt;p&gt;3. Ignore the issue on our side and fix the clients to reference the new &lt;tt&gt;SecurityProvider&lt;/tt&gt; with a filter using on the &lt;tt&gt;type&lt;/tt&gt; property.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt;, if you think that the first solution would fix the problem, I can go ahead and make the fix.&lt;/p&gt;</comment>
                            <comment id="14902761" author="chetanm" created="Tue, 22 Sep 2015 14:58:55 +0000"  >&lt;p&gt;As mentioned before I am still not clear on what is the actual problem here. &lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Break in backward compatibility of SecurityProviderImpl - There are users which are extending SecurityProviderImpl in OSGi and current approach would cause a breaking change. If thats the case then as mentioned before most likely such a usage of security provider is not possible. So lets first have a testcase which demonstrate such kind of usage and see how it gets broken&lt;/li&gt;
	&lt;li&gt;Break in backward compatibility of &lt;tt&gt;org.apache.jackrabbit.oak.security&lt;/tt&gt; package - as this package contains certain other classes causing a breaking change in SecurityProviderImpl would lead to major version increment. If that is the case then it more of problem of getting BND check passed only.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;So can it be determined whats the actual problem here?&lt;/p&gt;</comment>
                            <comment id="14902819" author="frm" created="Tue, 22 Sep 2015 15:39:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;There are users which are extending SecurityProviderImpl in OSGi.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;From my understanding, there are users extending &lt;tt&gt;SecurityProviderImpl&lt;/tt&gt;, but this may not necessarily happen in an OSGi context.&lt;/p&gt;</comment>
                            <comment id="14904039" author="chetanm" created="Wed, 23 Sep 2015 06:20:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;but this may not necessarily happen in an OSGi context.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In that case we can remove all OSGi specific semantics and restore the older impl i.e. just drop the OSGi annotations. That would only require a minor version change I think&lt;/p&gt;</comment>
                            <comment id="14906026" author="frm" created="Thu, 24 Sep 2015 08:42:47 +0000"  >&lt;p&gt;Backported to 1.2 in r1705014.&lt;/p&gt;</comment>
                            <comment id="14906240" author="frm" created="Thu, 24 Sep 2015 11:45:24 +0000"  >&lt;p&gt;Backported to 1.0 in r1705037.&lt;/p&gt;</comment>
                            <comment id="14939247" author="amitjain" created="Thu, 1 Oct 2015 03:35:14 +0000"  >&lt;p&gt;Bulk close for 1.3.7&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12761435" name="OAK-3434-01.patch" size="25352" author="frm" created="Mon, 21 Sep 2015 14:12:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 7 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2lcgn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>