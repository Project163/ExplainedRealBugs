<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:43:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1689] XPath and union queries with &quot;or&quot; can return the same node multiple times</title>
                <link>https://issues.apache.org/jira/browse/OAK-1689</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;XPath queries that contain &quot;or&quot; with can in some cases return the same node twice. Those queries are converted to &quot;union&quot;, as follows, where the same problem exists:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;select [jcr:path], [jcr:score], * from ... 
where contains(*, &apos;square&apos;) 
union 
select [jcr:path], [jcr:score], * from ... 
where [x] = &apos;1&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Currently, the results of both subqueries are combined with &quot;Iterators.concat(left.getRows(), right.getRows())&quot; (Iterators is from Google Guava). That means results of the first part of the union is executed, then the result of the second query. This result is wrapped / filtered using &quot;FilterIterators.newCombinedFilter(it, distinct, limit, offset, orderBy, settings)&quot;, which is Oak code. &quot;distinct&quot; is true for &quot;union&quot; and false for &quot;union all&quot;.&lt;/p&gt;

&lt;p&gt;Now, &quot;distinct&quot; operates on the result row object, which contains the path, the score, and all property values. In previous versions, the &quot;jcr:score&quot; was always a fixed value, but in the latest Oak version &quot;jcr:score&quot; is the value returned from the index, which means the two rows are not equal:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;path: /test/a, score: 0.5 (from the first subquery; Lucene index)
path: /test/a, score: 0.0 (from the second subquery; property index)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12706956">OAK-1689</key>
            <summary>XPath and union queries with &quot;or&quot; can return the same node multiple times</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="thomasm">Thomas Mueller</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Apr 2014 14:38:57 +0000</created>
                <updated>Tue, 6 Nov 2018 02:26:32 +0000</updated>
                            <resolved>Mon, 14 Apr 2014 12:33:30 +0000</resolved>
                                                    <fixVersion>1.0</fixVersion>
                                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13961888" author="tmueller" created="Mon, 7 Apr 2014 14:40:32 +0000"  >&lt;p&gt;I guess the easiest solution is to ignore &quot;jcr:score&quot; (and other pseudo-properties) for the &quot;distinct&quot; operation.&lt;/p&gt;</comment>
                            <comment id="13961893" author="alex.parvulescu" created="Mon, 7 Apr 2014 14:53:58 +0000"  >&lt;p&gt;agreed, it doesn&apos;t make sense to compare scores for this.&lt;/p&gt;</comment>
                            <comment id="13965157" author="tmueller" created="Thu, 10 Apr 2014 09:17:03 +0000"  >&lt;p&gt;Revision 1586247 (trunk)&lt;/p&gt;</comment>
                            <comment id="13968304" author="tmueller" created="Mon, 14 Apr 2014 12:33:30 +0000"  >&lt;p&gt;Revision 1587198 (1.0 branch)&lt;/p&gt;</comment>
                            <comment id="14017589" author="alex.parvulescu" created="Wed, 4 Jun 2014 10:16:51 +0000"  >&lt;p&gt;bulk close for the 1.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13170045">OAK-7605</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385279</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 24 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1udgn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385546</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>