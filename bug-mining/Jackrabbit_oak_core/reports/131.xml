<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:35:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-413] TreeLocation.getStatus() cost increases as more content is read below this location</title>
                <link>https://issues.apache.org/jira/browse/OAK-413</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The more content is read below a given location the more expensive the getStatus() becomes on that TreeLocation. There seem to be two issues:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Reading creates snapshots in MemoryNodeBuilder depending on how the tree is accessed.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Cost for comparing states also increases as snapshots are created for NodeStates.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ll attach a test that shows the described behaviour.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12614332">OAK-413</key>
            <summary>TreeLocation.getStatus() cost increases as more content is read below this location</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="mreutegg">Marcel Reutegger</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Nov 2012 10:01:56 +0000</created>
                <updated>Mon, 6 May 2013 15:49:19 +0000</updated>
                            <resolved>Thu, 1 Nov 2012 14:13:35 +0000</resolved>
                                    <version>0.5</version>
                                    <fixVersion>0.6</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13488586" author="jukkaz" created="Thu, 1 Nov 2012 10:07:52 +0000"  >&lt;p&gt;I&apos;m working on &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-391&quot; title=&quot;Avoid weak references in TreeImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-391&quot;&gt;&lt;del&gt;OAK-391&lt;/del&gt;&lt;/a&gt; to come up with a way to use NodeBuilders more effectively in TreeImpl so that we wouldn&apos;t need to call snapshot() so often.&lt;/p&gt;</comment>
                            <comment id="13488591" author="mreutegg" created="Thu, 1 Nov 2012 10:15:39 +0000"  >&lt;p&gt;AFAICS the problem is not that snapshot() is called. That&apos;s OK, as long as it doesn&apos;t create those MutableNodeState overlays unnecessarily (and recursively) for nodes that are only read. AFAIU this would make the snapshot() call very quick because it doesn&apos;t traverse down the hierarchy.&lt;/p&gt;</comment>
                            <comment id="13488617" author="jukkaz" created="Thu, 1 Nov 2012 11:24:55 +0000"  >&lt;p&gt;I think I spotted the problem, at least a part of it. The child() method in MemoryNodeBuilder doesn&apos;t take into account the case where a node is modified (the root node is always consider as such) but a child node isn&apos;t. I&apos;ll fix it.&lt;/p&gt;</comment>
                            <comment id="13488711" author="jukkaz" created="Thu, 1 Nov 2012 14:13:35 +0000"  >&lt;p&gt;Fixed in revision 1404599 by making the &lt;tt&gt;MemoryNodeBuilder.child()&lt;/tt&gt; method correctly handle the case where an existing but unmodified child of a &quot;connected&quot; (i.e. modified or root) parent is requested. The earlier code would always mark such children as modified and thus cause the entire subtree to be traversed when looking for modifications.&lt;/p&gt;

&lt;p&gt;Before this change:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;snapshots: 0
0 ms. ([2, 2, 2, 2, 2, 2, 2, 2, 2, 2])
snapshots: 0
68 ms. ([3282, 3282, 3282, 3282, 3282, 3282, 3282, 3282, 3282, 3282])
snapshots: 0
4744 ms. ([88572, 88572, 88572, 88572, 88572, 88572, 88572, 88572, 88572, 88572])
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;After:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;snapshots: 0
1 ms. ([0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
snapshots: 0
0 ms. ([0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
snapshots: 0
0 ms. ([0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12551693" name="OAK-413.patch" size="5506" author="mreutegg" created="Thu, 1 Nov 2012 10:03:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253576</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 3 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0dvlz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>79051</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>