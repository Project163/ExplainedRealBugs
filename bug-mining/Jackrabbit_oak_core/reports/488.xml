<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:40:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1109] SegmentMK: failed to load segment</title>
                <link>https://issues.apache.org/jira/browse/OAK-1109</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.IllegalStateException: Failed to load segment 4d00233a-62bb-4f39-baf2-a3dd4dfeb6fe
at org.apache.jackrabbit.oak.plugins.segment.AbstractStore.readSegment(AbstractStore.java:97)
at org.apache.jackrabbit.oak.plugins.segment.Segment.getSegment(Segment.java:150)
at org.apache.jackrabbit.oak.plugins.segment.Segment.getSegment(Segment.java:161)
at org.apache.jackrabbit.oak.plugins.segment.Template.compareAgainstBaseState(Template.java:285)
at org.apache.jackrabbit.oak.plugins.segment.SegmentNodeState.compareAgainstBaseState(SegmentNodeState.java:284)
at org.apache.jackrabbit.oak.core.RootFuzzIT.fuzzTest(RootFuzzIT.java:137)
Caused by: java.lang.IllegalArgumentException: Segment not found: 4d00233a-62bb-4f39-baf2-a3dd4dfeb6fe
at org.apache.jackrabbit.oak.plugins.segment.memory.MemoryStore.loadSegment(MemoryStore.java:74)
at org.apache.jackrabbit.oak.plugins.segment.AbstractStore.readSegment(AbstractStore.java:92)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Instructions and patch to reproduce in follow up comment&lt;/p&gt;</description>
                <environment></environment>
        <key id="12675224">OAK-1109</key>
            <summary>SegmentMK: failed to load segment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="mduerig">Michael D&#252;rig</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Oct 2013 10:30:09 +0000</created>
                <updated>Thu, 21 Nov 2013 10:30:42 +0000</updated>
                            <resolved>Wed, 23 Oct 2013 20:24:02 +0000</resolved>
                                                    <fixVersion>0.11</fixVersion>
                                    <component>segmentmk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13802772" author="mduerig" created="Wed, 23 Oct 2013 10:32:07 +0000"  >&lt;p&gt;To reproduce apply patch and run &lt;tt&gt;RootFuzzIT&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="13802777" author="alex.parvulescu" created="Wed, 23 Oct 2013 10:38:34 +0000"  >&lt;p&gt;is this similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1087&quot; title=&quot;TCK tests fail with SegmentMK and MongoStore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1087&quot;&gt;&lt;del&gt;OAK-1087&lt;/del&gt;&lt;/a&gt;? it was the reason the tests were disabled on that setup.&lt;/p&gt;</comment>
                            <comment id="13803279" author="jukkaz" created="Wed, 23 Oct 2013 20:24:02 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;http://svn.apache.org/r1535156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1535156&lt;/a&gt;. The problem was caused by the SegmentNodeState comparison getting confused about the two separate SegmentStores. The fix makes sure that the correct SegmentStore gets accessed for each  node state.&lt;/p&gt;

&lt;p&gt;A consequence of such a setup is that the SegmentMK is unable to leverage shared subtrees when comparing trees, and thus it will end up calling &lt;tt&gt;childNodeChanged&lt;/tt&gt; on all nodes in the tree even if they&apos;re equal. Thus the failIfNotHidden(name) assertion on &lt;tt&gt;childNodeChanged&lt;/tt&gt; in the patch still fails. That&apos;s an error in the patched test case, as the implementation is allowed to call &lt;tt&gt;childNodeChanged&lt;/tt&gt; in such cases even if the subtrees are actually equal.&lt;/p&gt;

&lt;p&gt;As for &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1087&quot; title=&quot;TCK tests fail with SegmentMK and MongoStore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1087&quot;&gt;&lt;del&gt;OAK-1087&lt;/del&gt;&lt;/a&gt;, I think that&apos;s a different issue.&lt;/p&gt;</comment>
                            <comment id="13828760" author="alex.parvulescu" created="Thu, 21 Nov 2013 10:30:42 +0000"  >&lt;p&gt;bulk close for the 0.11 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12609838" name="OAK-1109.patch" size="4154" author="mduerig" created="Wed, 23 Oct 2013 10:32:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>354844</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1p6b3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>355133</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>