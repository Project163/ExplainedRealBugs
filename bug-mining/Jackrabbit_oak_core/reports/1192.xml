<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:47:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2736] Oak instance does not close the executors created upon ContentRepository creation</title>
                <link>https://issues.apache.org/jira/browse/OAK-2736</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Oak.createContentRepository does not closes the executors it creates upon close. It should close the executor if that is created by itself and not passed by outside&lt;/p&gt;

&lt;p&gt;Also see recent &lt;a href=&quot;http://markmail.org/thread/rryydj7vpua5qbub&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;thread&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12819638">OAK-2736</key>
            <summary>Oak instance does not close the executors created upon ContentRepository creation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chetanm">Chetan Mehrotra</assignee>
                                    <reporter username="chetanm">Chetan Mehrotra</reporter>
                        <labels>
                            <label>CI</label>
                            <label>Jenkins</label>
                    </labels>
                <created>Thu, 9 Apr 2015 11:23:41 +0000</created>
                <updated>Wed, 2 Mar 2016 12:06:48 +0000</updated>
                            <resolved>Fri, 7 Aug 2015 10:09:11 +0000</resolved>
                                                    <fixVersion>1.3.4</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                                                            <comments>
                            <comment id="14487172" author="chetanm" created="Thu, 9 Apr 2015 11:29:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt; Can you review the patch?&lt;/p&gt;</comment>
                            <comment id="14488266" author="mduerig" created="Thu, 9 Apr 2015 20:59:11 +0000"  >&lt;p&gt;I&apos;m not too happy with the additional Closable. It serves its purpose however. Could we rename &lt;tt&gt;CloseableExecutor&lt;/tt&gt; to something like &lt;tt&gt;ExecutorCloser&lt;/tt&gt;? It is not really an executor but rather a closer. &lt;/p&gt;

&lt;p&gt;On a somewhat related note we should probably safeguard the &lt;tt&gt;createContentRepository&lt;/tt&gt; method such that it throws an &lt;tt&gt;ISE&lt;/tt&gt; when called more than once. Otherwise multiple repository instances created by the same builder would share their executors.&lt;/p&gt;</comment>
                            <comment id="14488862" author="chetanm" created="Fri, 10 Apr 2015 03:56:41 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12724452/12724452_OAK-2736-2.patch&quot; title=&quot;OAK-2736-2.patch attached to OAK-2736&quot;&gt;updated patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; including above feedback and also tests&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt; can you review again? Also should we merge the fix to various branches to avoid test failures there&lt;/p&gt;</comment>
                            <comment id="14492064" author="mduerig" created="Mon, 13 Apr 2015 08:31:59 +0000"  >&lt;p&gt;Looks good!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also should we merge the fix to various branches to avoid test failures there&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;d do that if this issue turns out to be too much of a blocker for branches. &lt;/p&gt;</comment>
                            <comment id="14492108" author="chetanm" created="Mon, 13 Apr 2015 09:12:56 +0000"  >&lt;p&gt;Done &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk - &lt;a href=&quot;http://svn.apache.org/r1673140&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1673140&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14493036" author="torgeir@pobox.com" created="Mon, 13 Apr 2015 20:44:04 +0000"  >&lt;p&gt;Any chance for a backport to the stable 1.2.* branch?&lt;/p&gt;</comment>
                            <comment id="14493515" author="chetanm" created="Tue, 14 Apr 2015 03:40:39 +0000"  >&lt;p&gt;Merged to 1.2 branch with &lt;a href=&quot;http://svn.apache.org/r1673343&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1673343&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14493544" author="chetanm" created="Tue, 14 Apr 2015 04:31:23 +0000"  >&lt;p&gt;Reopening as fix seems to cause failure in oak-run as Oak instance is used twice&lt;/p&gt;</comment>
                            <comment id="14493562" author="chetanm" created="Tue, 14 Apr 2015 05:01:06 +0000"  >&lt;p&gt;Reverted the merge from 1.2 branch and disabled the check for repository instance being used twice untill we get the test case passed. Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2760&quot; title=&quot;HttpServer in Oak creates multiple instance of ContentRepository&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2760&quot;&gt;&lt;del&gt;OAK-2760&lt;/del&gt;&lt;/a&gt; to track that.&lt;/p&gt;

&lt;p&gt;On my side I have to admit I ran the test upto oak-lucene and not complete so did not detected that! Also the build notification came quite late. Anyways merge to  branch has been reverted and would be done only once proper fix is done&lt;/p&gt;</comment>
                            <comment id="14576914" author="edivad" created="Mon, 8 Jun 2015 09:48:12 +0000"  >&lt;p&gt;Bulk move to 1.3.1&lt;/p&gt;</comment>
                            <comment id="14595606" author="edivad" created="Mon, 22 Jun 2015 09:45:46 +0000"  >&lt;p&gt;Bulk move to 1.3.2&lt;/p&gt;</comment>
                            <comment id="14610132" author="edivad" created="Wed, 1 Jul 2015 13:05:15 +0000"  >&lt;p&gt;Bulk move to 1.3.3.&lt;/p&gt;</comment>
                            <comment id="14633279" author="edivad" created="Mon, 20 Jul 2015 10:04:51 +0000"  >&lt;p&gt;Bulk move to 1.3.4&lt;/p&gt;</comment>
                            <comment id="14640091" author="torgeir@pobox.com" created="Fri, 24 Jul 2015 07:44:10 +0000"  >&lt;p&gt;Running oak 1.3.3 now results in much less warnings during webapp restart. There is one remaining thread though that is not closed, &lt;/p&gt;

&lt;p&gt;24-Jul-2015 17:41:06.727 WARNING &lt;span class=&quot;error&quot;&gt;&amp;#91;http-nio-8080-exec-1&amp;#93;&lt;/span&gt; org.apache.catalina.loader.WebappClassLoaderBase.clearReferencesThreads The web application &lt;span class=&quot;error&quot;&gt;&amp;#91;frontend&amp;#93;&lt;/span&gt; appears to have started a thread named &lt;span class=&quot;error&quot;&gt;&amp;#91;oak-repository-executor-1&amp;#93;&lt;/span&gt; but has failed to stop it. This is very likely to create a memory leak. Stack trace of thread:&lt;br/&gt;
 sun.misc.Unsafe.park(Native Method)&lt;br/&gt;
 java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)&lt;/p&gt;

&lt;p&gt;Am not sure if this one would be covered by this fix, or if something needs to be configured differently to get this thread to be stopped.&lt;/p&gt;</comment>
                            <comment id="14661531" author="alex.parvulescu" created="Fri, 7 Aug 2015 09:07:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;Running oak 1.3.3 now results in much less warnings during webapp restart. There is one remaining thread though that is not closed,&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=torgeir%40pobox.com&quot; class=&quot;user-hover&quot; rel=&quot;torgeir@pobox.com&quot;&gt;torgeir@pobox.com&lt;/a&gt; thanks for the feedback! Could you please keep an eye on this and when it happens again capture some thread dumps, so we have an idea of what that thread is actually doing?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;edit&amp;#93;&lt;/span&gt; actually judging by the thread name (&apos;oak-repository-executor-*&apos;), I think it&apos;s the RepositoryImpl scheduler that&apos;s not being closed properly &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;. I&apos;ll followup with a dedicated issue: &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3197&quot; title=&quot;RepositoryImpl doesn&amp;#39;t close the scheduler nicely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3197&quot;&gt;&lt;del&gt;OAK-3197&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-jcr/src/main/java/org/apache/jackrabbit/oak/jcr/repository/RepositoryImpl.java#L347&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/blob/trunk/oak-jcr/src/main/java/org/apache/jackrabbit/oak/jcr/repository/RepositoryImpl.java#L347&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14661586" author="alex.parvulescu" created="Fri, 7 Aug 2015 10:09:11 +0000"  >&lt;p&gt;remaining TODOs were addressed via &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2760&quot; title=&quot;HttpServer in Oak creates multiple instance of ContentRepository&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2760&quot;&gt;&lt;del&gt;OAK-2760&lt;/del&gt;&lt;/a&gt;, marking as resolved.&lt;/p&gt;</comment>
                            <comment id="14661784" author="torgeir@pobox.com" created="Fri, 7 Aug 2015 12:49:36 +0000"  >&lt;p&gt;Just tried 1.4-SNAPSHOT now and there&apos;s no unclosed threads on webapp redeployment now, thx!&lt;/p&gt;</comment>
                            <comment id="14661832" author="torgeir@pobox.com" created="Fri, 7 Aug 2015 13:36:34 +0000"  >&lt;p&gt;Sorry, spoke too soon; got &lt;/p&gt;

&lt;p&gt;07-Aug-2015 23:32:33.061 WARNING &lt;span class=&quot;error&quot;&gt;&amp;#91;http-nio-8080-exec-8&amp;#93;&lt;/span&gt; org.apache.catalina.loader.WebappClassLoaderBase.clearReferencesThreads The web application &lt;span class=&quot;error&quot;&gt;&amp;#91;frontend&amp;#93;&lt;/span&gt; appears to have started a thread named &lt;span class=&quot;error&quot;&gt;&amp;#91;oak-repository-executor-1&amp;#93;&lt;/span&gt; but has failed to stop it. This is very likely to create a memory leak. Stack trace of thread:&lt;br/&gt;
 sun.misc.Unsafe.park(Native Method)&lt;br/&gt;
 java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)&lt;br/&gt;
 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)&lt;br/&gt;
 java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:1093)&lt;br/&gt;
 java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:809)&lt;br/&gt;
 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1067)&lt;br/&gt;
 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1127)&lt;br/&gt;
 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)&lt;br/&gt;
 java.lang.Thread.run(Thread.java:745)&lt;/p&gt;

&lt;p&gt;I&apos;ll check again when the RepositoryImpl change is in the 1.4-snapshot.&lt;/p&gt;</comment>
                            <comment id="14661835" author="alex.parvulescu" created="Fri, 7 Aug 2015 13:40:48 +0000"  >&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; yes, you are really looking for the fix from &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3197&quot; title=&quot;RepositoryImpl doesn&amp;#39;t close the scheduler nicely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3197&quot;&gt;&lt;del&gt;OAK-3197&lt;/del&gt;&lt;/a&gt; here. The changes are in, so I would appreciate it if you could give it a spin!&lt;/p&gt;</comment>
                            <comment id="14662038" author="torgeir@pobox.com" created="Fri, 7 Aug 2015 16:14:26 +0000"  >&lt;p&gt;Looks good now with 1.4-SNAPSHOT.&lt;/p&gt;</comment>
                            <comment id="14706626" author="edivad" created="Fri, 21 Aug 2015 12:13:02 +0000"  >&lt;p&gt;Bulk close for 1.3.4&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12852941">OAK-3197</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12828301">OAK-2854</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12819698">OAK-2741</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12832746">OAK-2909</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12724452" name="OAK-2736-2.patch" size="6017" author="chetanm" created="Fri, 10 Apr 2015 03:56:41 +0000"/>
                            <attachment id="12724204" name="OAK-2736.patch" size="2447" author="chetanm" created="Thu, 9 Apr 2015 11:29:56 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12820716">OAK-2760</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>OAK-2714</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2d0zb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>