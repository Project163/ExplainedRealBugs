<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:52:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-4390] DocumentStoreStatsIT.update fails when RDB&apos;s append mode is disabled</title>
                <link>https://issues.apache.org/jira/browse/OAK-4390</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;When run with &lt;tt&gt;-Dorg.apache.jackrabbit.oak.plugins.document.rdb.RDBDocumentStore.NOAPPEND=true&lt;/tt&gt; (see &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-4389&quot; title=&quot;RDBDocumentStore: add system property for disabling appending updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-4389&quot;&gt;&lt;del&gt;OAK-4389&lt;/del&gt;&lt;/a&gt;):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;update[RDBFixture: RDB-Postgres](org.apache.jackrabbit.oak.plugins.document.DocumentStoreStatsIT)  Time elapsed: 0.008 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
Wanted but not invoked:
documentStoreStatsCollector.doneUpdate(
    &amp;lt;any&amp;gt;,
    nodes,
    2
);
-&amp;gt; at org.apache.jackrabbit.oak.plugins.document.DocumentStoreStatsIT.update(DocumentStoreStatsIT.java:128)

However, there were other interactions with this mock:
documentStoreStatsCollector.doneCreate(
    1747821,
    nodes,
    [update[RDBFixture: RDB-Postgres]],
    true
);
-&amp;gt; at org.apache.jackrabbit.oak.plugins.document.rdb.RDBDocumentStore.internalCreate(RDBDocumentStore.java:1182)

documentStoreStatsCollector.doneFindUncached(
    845900,
    nodes,
    &quot;update[RDBFixture: RDB-Postgres]-478ebbb3-cb70-409d-af13-f1b2c11c4103&quot;,
    false,
    false
);
-&amp;gt; at org.apache.jackrabbit.oak.plugins.document.rdb.RDBDocumentStore.readDocumentUncached(RDBDocumentStore.java:1484)

documentStoreStatsCollector.doneFindCached(
    nodes,
    &quot;update[RDBFixture: RDB-Postgres]&quot;
);
-&amp;gt; at org.apache.jackrabbit.oak.plugins.document.rdb.RDBDocumentStore.readDocumentCached(RDBDocumentStore.java:1093)

documentStoreStatsCollector.doneFindAndModify(
    1521593,
    nodes,
    &quot;update[RDBFixture: RDB-Postgres]&quot;,
    false,
    true,
    -1
);
-&amp;gt; at org.apache.jackrabbit.oak.plugins.document.rdb.RDBDocumentStore.internalUpdate(RDBDocumentStore.java:1299)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12971884">OAK-4390</key>
            <summary>DocumentStoreStatsIT.update fails when RDB&apos;s append mode is disabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reschke">Julian Reschke</assignee>
                                    <reporter username="reschke">Julian Reschke</reporter>
                        <labels>
                    </labels>
                <created>Sun, 22 May 2016 15:55:30 +0000</created>
                <updated>Tue, 30 May 2017 08:38:57 +0000</updated>
                            <resolved>Mon, 20 Feb 2017 14:43:06 +0000</resolved>
                                    <version>1.4.13</version>
                    <version>1.6.0</version>
                                    <fixVersion>1.7.0</fixVersion>
                    <fixVersion>1.6.2</fixVersion>
                    <fixVersion>1.4.16</fixVersion>
                    <fixVersion>1.8.0</fixVersion>
                                    <component>rdbmk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15295627" author="reschke" created="Sun, 22 May 2016 16:46:23 +0000"  >&lt;p&gt;The reason being that in this case a different code path is used, and that creates different kinds of statistics.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt; - is there a particular reason why the stats are taken relatively low-level and not closer to the API call?&lt;/p&gt;</comment>
                            <comment id="15295901" author="chetanm" created="Mon, 23 May 2016 04:27:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reschke&quot; class=&quot;user-hover&quot; rel=&quot;reschke&quot;&gt;reschke&lt;/a&gt; couple of reasons around doing this at low level&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Record stats only when call is made to remote and not when call gets answered by cache&lt;/li&gt;
	&lt;li&gt;Ability to also record retries to see if certain code flows are resulting in lots of retries or not&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15295905" author="reschke" created="Mon, 23 May 2016 04:33:02 +0000"  >&lt;p&gt;Ack.&lt;/p&gt;

&lt;p&gt;So when I have time I&apos;ll try to find a way to fix this properly...&lt;/p&gt;</comment>
                            <comment id="15863661" author="reschke" created="Mon, 13 Feb 2017 13:30:51 +0000"  >&lt;p&gt;Minimal change that fixes the issue for me - &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt; could you do a sanity check whether the change is consistent with the intended way stats should be collected?&lt;/p&gt;</comment>
                            <comment id="15874416" author="chetanm" created="Mon, 20 Feb 2017 11:41:45 +0000"  >&lt;p&gt;+1. Looks good&lt;/p&gt;</comment>
                            <comment id="15874625" author="reschke" created="Mon, 20 Feb 2017 14:44:13 +0000"  >&lt;p&gt;trunk: &lt;a href=&quot;http://svn.apache.org/r1783773&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1783773&lt;/a&gt;&lt;br/&gt;
1.6: &lt;a href=&quot;http://svn.apache.org/r1792877&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1792877&lt;/a&gt;&lt;br/&gt;
1.4: &lt;a href=&quot;http://svn.apache.org/r1792914&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1792914&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16029049" author="edivad" created="Tue, 30 May 2017 08:38:57 +0000"  >&lt;p&gt;Bulk close for 1.7.0&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12852355" name="OAK-4390.diff" size="836" author="reschke" created="Mon, 13 Feb 2017 13:30:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 24 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2yc6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>