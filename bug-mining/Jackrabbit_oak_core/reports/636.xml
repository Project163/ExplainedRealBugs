<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:41:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1285] QueryEngine#executeQuery takes NamePathMapper which is not part of oak-api</title>
                <link>https://issues.apache.org/jira/browse/OAK-1285</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fmeschbe&quot; class=&quot;user-hover&quot; rel=&quot;fmeschbe&quot;&gt;fmeschbe&lt;/a&gt; spotted the following inconsistency in the oak api:&lt;/p&gt;

&lt;p&gt;o.a.j.o.api.QueryEngine#executeQuery(String statement, String language,&lt;br/&gt;
            long limit, long offset, Map&amp;lt;String, ? extends PropertyValue&amp;gt; bindings,&lt;br/&gt;
            NamePathMapper namePathMapper) throws ParseException;&lt;/p&gt;

&lt;p&gt;takes a NamePathMapper which is not part of the oak api but only defined in the plugins.&lt;/p&gt;

&lt;p&gt;to resolve that inconsistency we may consider moving the NamePathMapper to a new o.a.j.oak.api.namepath package and keep the implementations in the plugins.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12684482">OAK-1285</key>
            <summary>QueryEngine#executeQuery takes NamePathMapper which is not part of oak-api</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="angela">Angela Schreiber</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Dec 2013 16:14:07 +0000</created>
                <updated>Mon, 10 Feb 2014 13:51:24 +0000</updated>
                            <resolved>Wed, 22 Jan 2014 18:12:05 +0000</resolved>
                                                    <fixVersion>0.16</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13877967" author="jukkaz" created="Tue, 21 Jan 2014 23:01:02 +0000"  >&lt;p&gt;The attached 0001 patch replaces the &lt;tt&gt;NamePathMapper&lt;/tt&gt; argument with a &lt;tt&gt;Map&amp;lt;String, String&amp;gt;&lt;/tt&gt; of the local namespace remappings to be applied when processing the query statement. That map is then used by the query parser to construct a local &lt;tt&gt;NamePathMapper&lt;/tt&gt; for use just for that query.&lt;/p&gt;

&lt;p&gt;This works well except for the &lt;tt&gt;UserQueryManager&lt;/tt&gt; class which doesn&apos;t have direct access to the current set of local namespace remappings. Given how far removed from classes like &lt;tt&gt;SessionContext&lt;/tt&gt; or &lt;tt&gt;SessionNamespaces&lt;/tt&gt; the &lt;tt&gt;UserQueryManager&lt;/tt&gt; is, I couldn&apos;t find any easy way to pass that information to it.&lt;/p&gt;

&lt;p&gt;As an alternative (see patch 0002) I tried constructing the user queries directly using Oak names and an empty set of namespace remappings, which would have worked nicely (no need for the duplicate oak-jcr-oak mapping of names) except for the lack of type information in the potential value constraints which makes it impossible to tell whether a given value constraint is a name to be remapped or just some generic value for which remapping isn&apos;t needed.&lt;/p&gt;

&lt;p&gt;It seems like first idea of making the set of local namespace mappings available to the &lt;tt&gt;UserQueryManager&lt;/tt&gt; for use when executing the query would be cleaner, but I&apos;m not sure how to best pass that information through &lt;tt&gt;UserConfiguration&lt;/tt&gt; and &lt;tt&gt;UserManager&lt;/tt&gt;.  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anchela&quot; class=&quot;user-hover&quot; rel=&quot;anchela&quot;&gt;anchela&lt;/a&gt;, any ideas?&lt;/p&gt;

&lt;p&gt;A crude approach would be to replace the &lt;tt&gt;NamePathMapper&lt;/tt&gt; argument with some helper interface that provides access to both the &lt;tt&gt;NamePathMapper&lt;/tt&gt; instance and the related set of local namespace mappings.&lt;/p&gt;</comment>
                            <comment id="13878435" author="anchela" created="Wed, 22 Jan 2014 09:10:27 +0000"  >&lt;p&gt;patch 0002 looks similar to what i tried to do in my very first draft of the user query... i don&apos;t recall the very details but i didn&apos;t get that work.&lt;/p&gt;

&lt;p&gt;so, i agree that executing the user query with the local namespace mappings would be cleaner.&lt;/p&gt;

&lt;p&gt;having said that: the user query manager in fact &apos;has&apos; the local mappings but they are hidden in the namepathmapper. which means that we would basically have all the information we need but we can&apos;t access them any more... instead of inventing yet another helper interface that encapsulates namepathmapper and the namespacemapping, wouldn&apos;t it be possible allow for building/extracting the namespace mapping from a given NamePathMapper... e.g. via NameMapper plus extension?&lt;/p&gt;</comment>
                            <comment id="13878906" author="jukkaz" created="Wed, 22 Jan 2014 17:56:26 +0000"  >&lt;p&gt;Hmm, good point about getting the mappings from &lt;tt&gt;NamePathMapper&lt;/tt&gt;. I didn&apos;t think of that as I originally wanted to hide all mapping details below the interface (you just give it a name string and it returns the result, mapped in whichever way is appropriate), but given that we already do have the &lt;tt&gt;hasSessionLocalMappings()&lt;/tt&gt; method it seems reasonable to also add &lt;tt&gt;getSessionLocalMappings()&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="13878930" author="jukkaz" created="Wed, 22 Jan 2014 18:12:05 +0000"  >&lt;p&gt;Yep, that approach works. Committed in revision 1560446.&lt;/p&gt;

&lt;p&gt;I actually ended up replacing the &lt;tt&gt;hasSessionLocalMappings()&lt;/tt&gt; method with &lt;tt&gt;getSessionLocalMappings()&lt;/tt&gt; as the former can be implemented in terms of the latter.&lt;/p&gt;</comment>
                            <comment id="13896527" author="alex.parvulescu" created="Mon, 10 Feb 2014 13:51:24 +0000"  >&lt;p&gt;bulk close for the 0.16 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12624214" name="0001-OAK-1285-QueryEngine-executeQuery-takes-NamePathMapp.patch" size="25915" author="jukkaz" created="Tue, 21 Jan 2014 23:01:02 +0000"/>
                            <attachment id="12624215" name="0002-OAK-1285-QueryEngine-executeQuery-takes-NamePathMapp.patch" size="8522" author="jukkaz" created="Tue, 21 Jan 2014 23:01:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>363554</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qo0n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>363860</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>