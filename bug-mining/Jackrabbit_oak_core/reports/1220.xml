<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:47:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2752] SegmentIdTable can sometimes hang when calling getSegmentId(msb, lsb)</title>
                <link>https://issues.apache.org/jira/browse/OAK-2752</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The while loop getSegmentId(msb, lsb) loops forever in the situation where the segment id is not found. &lt;/p&gt;

&lt;p&gt;Looping occurs from &apos;first&apos; and loops to the end of the SegmentId references, and then loops back to first.  If the segmentid is not found in any of the referenced items then looping continues past &apos;first&apos; again and loops for eternity through all the references.&lt;/p&gt;

&lt;p&gt;See attached patch for possible fix to break out of the loop after getting back to &apos;first&apos; again.&lt;/p&gt;

&lt;p&gt;note: I have tested this patch on my system and it seems to work, but I do not know if the patch provides the best fix, I am a bit new to this code.  The most important part of the patch would be the break condition from the loop so the loop does not continue after testing each reference&lt;/p&gt;</description>
                <environment></environment>
        <key id="12820093">OAK-2752</key>
            <summary>SegmentIdTable can sometimes hang when calling getSegmentId(msb, lsb)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="wmcgaule">Will McGauley</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Apr 2015 14:56:26 +0000</created>
                <updated>Tue, 8 Oct 2019 15:21:31 +0000</updated>
                            <resolved>Wed, 15 Apr 2015 14:42:34 +0000</resolved>
                                    <version>1.2</version>
                                    <fixVersion>1.0.13</fixVersion>
                    <fixVersion>1.2.1</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14489740" author="wmcgaule" created="Fri, 10 Apr 2015 14:59:15 +0000"  >&lt;p&gt;attaching patch to break out of loop after all the references are tested&lt;/p&gt;</comment>
                            <comment id="14489755" author="chetanm" created="Fri, 10 Apr 2015 15:10:45 +0000"  >&lt;p&gt;Just a guess but may be due to &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2654&quot; title=&quot;SegmentIdTable too eager to refresh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2654&quot;&gt;&lt;del&gt;OAK-2654&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14492534" author="cgoudie" created="Mon, 13 Apr 2015 15:45:56 +0000"  >&lt;p&gt;+1 for Will&apos;s patch.&lt;/p&gt;

&lt;p&gt;This is a particularly problematic loop, as one stuck thread in this loop ends up blocking any additionally callers (and in a stack trace that I am looking at, there are many)&lt;/p&gt;

&lt;p&gt;This problem becomes compounded because the threads waiting for this monitor are also holding other object monitors and other types of semaphores further up the stack, which results in a variety of other problems including log in issues to JCR.&lt;/p&gt;

&lt;p&gt;As the problem continues, more and more threads pile up, blocking in more and more areas.&lt;/p&gt;</comment>
                            <comment id="14492554" author="cgoudie" created="Mon, 13 Apr 2015 16:08:36 +0000"  >&lt;p&gt;It looks to me as though the check of while(reference != null) might be able to continue indefinitely if the weak reference it is referring to is garbage collected. shouldRefresh will probably be set, but refresh() wont be run since it is outside the loop, and so reference will still be in the list.&lt;/p&gt;

&lt;p&gt;Additionally, if shouldRefresh = true and it identifies an ID, it will return out without running the refresh, so stale entries will still be in the list.&lt;/p&gt;

&lt;p&gt;It looks to my eyes as though Will&apos;s patch will allow the thread to properly break out, and trigger the refresh, however I see that the original intent was to avoid using a map. This part probably deserves a review. &lt;/p&gt;</comment>
                            <comment id="14493668" author="chetanm" created="Tue, 14 Apr 2015 06:31:10 +0000"  >&lt;p&gt;Issue is also seen on current branch (but look like not part of released 1.0.12). So setting the fix version to 1.0.13&lt;/p&gt;</comment>
                            <comment id="14493724" author="tmueller" created="Tue, 14 Apr 2015 07:34:41 +0000"  >&lt;p&gt;I think the patch needs work.&lt;/p&gt;

&lt;p&gt;The code in this class looks a bit weird to me, at least it&apos;s incorrectly / poorly documented, as the javadoc says: &quot;Each table entry is either null (when there are no matching identifiers) or a list of weak references to the matching identifiers.&quot;. Well, a table entry is not a list, it&apos;s a reference. So that&apos;s wrong. &quot;Actually, this is a array. It&apos;s not a hash map, to conserve memory (maps need much more memory).&quot; I guess it&apos;s actually because of speed, not memory, because the array is only half full where a hash map is usually 3/4 full. I also wonder why it&apos;s an ArrayList and not simply an array. And why it&apos;s using linear probing (and why this is not documented). &lt;/p&gt;

&lt;p&gt;The current code seems to assume the is a &quot;null&quot; entry in the list, and this seems to be enforced in refresh(). But it is not documented. And probably not correct in some edge cases, this is why it hangs in your case. But the patch does not fix that, which might be a problem.&lt;/p&gt;
</comment>
                            <comment id="14493776" author="alex.parvulescu" created="Tue, 14 Apr 2015 08:21:04 +0000"  >&lt;p&gt;I think I have a better idea of why this happens and it looks like this was indeed introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2654&quot; title=&quot;SegmentIdTable too eager to refresh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2654&quot;&gt;&lt;del&gt;OAK-2654&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;What I missed initially with &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2654&quot; title=&quot;SegmentIdTable too eager to refresh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2654&quot;&gt;&lt;del&gt;OAK-2654&lt;/del&gt;&lt;/a&gt; was that refresh will also double the size of the list if the number of elements gets too large. So now the resize doesn&apos;t happen as often which triggers the infinite loop. This can be seen in the attached test, you only need to fill the entire table with entries and a search will loop forever as the resize method will never be called. resizing will basically add null entries at the end of the list which will basically break the infinite loop.&lt;/p&gt;

&lt;p&gt;the fix is 100% &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wmcgaule&quot; class=&quot;user-hover&quot; rel=&quot;wmcgaule&quot;&gt;wmcgaule&lt;/a&gt;&apos;s patch, I only added a small test.&lt;/p&gt;</comment>
                            <comment id="14493797" author="tmueller" created="Tue, 14 Apr 2015 08:37:05 +0000"  >&lt;p&gt;&amp;gt; might be able to continue indefinitely if the weak reference it is referring to is garbage collected.&lt;/p&gt;

&lt;p&gt;The entry is a WeakReference. The references are not automatically garbage collected. The &lt;em&gt;referent&lt;/em&gt; of the reference it garbage collected, but that one is not checked for null.&lt;/p&gt;</comment>
                            <comment id="14493801" author="alex.parvulescu" created="Tue, 14 Apr 2015 08:42:13 +0000"  >&lt;p&gt;agreed, the key to the infinite loop is the resize, not calling refresh means that the resize will not happen, so the loop could never encounter a &lt;em&gt;null&lt;/em&gt; entry. the &lt;em&gt;null&lt;/em&gt; entry needs to come from the resize, not the gc collecting the weak refs&apos;s reference.&lt;/p&gt;</comment>
                            <comment id="14493803" author="tmueller" created="Tue, 14 Apr 2015 08:44:27 +0000"  >&lt;p&gt;&amp;gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2654&quot; title=&quot;SegmentIdTable too eager to refresh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2654&quot;&gt;&lt;del&gt;OAK-2654&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I see the problem now, yes that makes sense. I guess the bug was introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2654&quot; title=&quot;SegmentIdTable too eager to refresh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2654&quot;&gt;&lt;del&gt;OAK-2654&lt;/del&gt;&lt;/a&gt; because the class is poorly documented and tested, so that should be fixed.&lt;/p&gt;

&lt;p&gt;A problem of &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2654&quot; title=&quot;SegmentIdTable too eager to refresh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2654&quot;&gt;&lt;del&gt;OAK-2654&lt;/del&gt;&lt;/a&gt; is that it slows down read access, if the table is almost full. Basically you end up with a hash table that has an access cost of O&amp;#40;n&amp;#41; instead of the O(1). Sure, you avoid frequent resizes on put, so in many cases put is no longer O&amp;#40;n&amp;#41; but O(1). But at the cost of potentially very high cost on get.&lt;/p&gt;






</comment>
                            <comment id="14493808" author="tmueller" created="Tue, 14 Apr 2015 08:50:31 +0000"  >&lt;p&gt;I would probably resize if the map is more than 75% full. That should avoid the performance problem of &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2654&quot; title=&quot;SegmentIdTable too eager to refresh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2654&quot;&gt;&lt;del&gt;OAK-2654&lt;/del&gt;&lt;/a&gt;, without making read access slow in some cases.&lt;/p&gt;</comment>
                            <comment id="14493876" author="mduerig" created="Tue, 14 Apr 2015 10:25:50 +0000"  >&lt;p&gt;I agree, we need to clean up this class and add clear Javadocs. Let&apos;s do that in a separate issue though. &lt;/p&gt;</comment>
                            <comment id="14493882" author="mduerig" created="Tue, 14 Apr 2015 10:31:35 +0000"  >&lt;p&gt;The problem I see with the patch is that when it breaks out of the loop &lt;tt&gt;index == first&lt;/tt&gt; and &lt;tt&gt;references.get(index) != null&lt;/tt&gt; thus the subsequent &lt;tt&gt;references.set(index,...)&lt;/tt&gt; will overwrite and existing entry. &lt;/p&gt;

&lt;p&gt;Maybe Thomas&apos; suggestion of resizing when the table&apos;s fill ratio reaches a certain threshold would kill two birds with one stone here. &lt;/p&gt;</comment>
                            <comment id="14493889" author="mduerig" created="Tue, 14 Apr 2015 10:39:11 +0000"  >&lt;p&gt;BTW, we should take this opportunity and add a unit test for &lt;tt&gt;SegmentIdTable&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14494034" author="alex.parvulescu" created="Tue, 14 Apr 2015 12:21:55 +0000"  >&lt;p&gt;tentative new patch based on offline discussion with MichaelD and Thomas comments.&lt;/p&gt;

&lt;p&gt;from what I gather the problems are when the table is at near capacity, the looping around causes a lot of performance issues, so the idea would be to increase the capacity when it goes beyond a certain threshold.&lt;br/&gt;
another problem is overwriting existing items, which can happen with the current version of the patch.&lt;/p&gt;

&lt;p&gt;the current approach is to keep track of the number of moves from the starting point and once that goes beyond 0.75 we can directly increase the size and add the item at the index pointing to the old end of the list, which will definitely be a null slot.&lt;br/&gt;
I might have left stuff out, feel free to break it apart if it doesn&apos;t look right. &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt;&lt;/p&gt;



</comment>
                            <comment id="14494062" author="tmueller" created="Tue, 14 Apr 2015 12:53:23 +0000"  >&lt;p&gt;Iterating over 75% is not quite the same as the table being 75% full. I&apos;m working on a patch as well.&lt;/p&gt;</comment>
                            <comment id="14494074" author="mduerig" created="Tue, 14 Apr 2015 13:02:18 +0000"  >&lt;p&gt;I think we should rather keep track of the number of entries in the table and refresh when &lt;tt&gt;count &amp;gt; 0.75 * size&lt;/tt&gt;. The initial code before &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2654&quot; title=&quot;SegmentIdTable too eager to refresh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2654&quot;&gt;&lt;del&gt;OAK-2654&lt;/del&gt;&lt;/a&gt; did this in a way, only that it refreshed too eagerly. So I would like to propose to revert &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2654&quot; title=&quot;SegmentIdTable too eager to refresh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2654&quot;&gt;&lt;del&gt;OAK-2654&lt;/del&gt;&lt;/a&gt; and replace the condition for refresh with a better one. &lt;/p&gt;</comment>
                            <comment id="14494076" author="mduerig" created="Tue, 14 Apr 2015 13:03:09 +0000"  >&lt;p&gt;Proposed patch refreshing when 75% full&lt;/p&gt;</comment>
                            <comment id="14494086" author="alex.parvulescu" created="Tue, 14 Apr 2015 13:12:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;So I would like to propose to revert &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2654&quot; title=&quot;SegmentIdTable too eager to refresh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2654&quot;&gt;&lt;del&gt;OAK-2654&lt;/del&gt;&lt;/a&gt; and replace the condition for refresh with a better one.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;makes sense. re. the patch: wouldn&apos;t you have to recompute the &lt;em&gt;count&lt;/em&gt; in the #refresh method?&lt;/p&gt;</comment>
                            <comment id="14494094" author="mduerig" created="Tue, 14 Apr 2015 13:12:57 +0000"  >&lt;p&gt;Yes of course. Good catch. Will update the patch.&lt;/p&gt;</comment>
                            <comment id="14494096" author="mduerig" created="Tue, 14 Apr 2015 13:13:34 +0000"  >&lt;p&gt;Updated patch decrementing count when removing ids. &lt;/p&gt;</comment>
                            <comment id="14494132" author="tmueller" created="Tue, 14 Apr 2015 13:47:16 +0000"  >&lt;p&gt;The patch v3 has a bug (and there is no test for that yet), because it swaps the operations &quot;references.set&quot; and &quot;refresh&quot; here:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-        references.set(index, new WeakReference&amp;lt;SegmentId&amp;gt;(id));
         if (shouldRefresh) {
-            refresh();
+            refreshAndResize();
         }
+        SegmentId id = new SegmentId(tracker, msb, lsb);
+        references.set(index, new WeakReference&amp;lt;SegmentId&amp;gt;(id));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That way, the index would still be the old index (with the lower size), which is the wrong one. So you would end up with two SegmentId objects for the same segment id.&lt;/p&gt;</comment>
                            <comment id="14494140" author="tmueller" created="Tue, 14 Apr 2015 13:58:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2752&quot; title=&quot;SegmentIdTable can sometimes hang when calling getSegmentId(msb, lsb)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2752&quot;&gt;&lt;del&gt;OAK-2752&lt;/del&gt;&lt;/a&gt;-tm1.patch: quite a bit patch, with one additional test. But more tests are needed.&lt;/p&gt;</comment>
                            <comment id="14494189" author="alex.parvulescu" created="Tue, 14 Apr 2015 14:56:12 +0000"  >&lt;p&gt;assigning to Thomas, it looks like he has the best contender here.&lt;/p&gt;</comment>
                            <comment id="14494219" author="mduerig" created="Tue, 14 Apr 2015 15:07:34 +0000"  >&lt;p&gt;Let&apos;s keep changes minimal for this issue as we need to back port it to 1.0. &lt;/p&gt;

&lt;p&gt;As &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2654&quot; title=&quot;SegmentIdTable too eager to refresh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2654&quot;&gt;&lt;del&gt;OAK-2654&lt;/del&gt;&lt;/a&gt; greatly increased upgrade performance but introduced this regression I suggest we re-evaluate performance with &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2752&quot; title=&quot;SegmentIdTable can sometimes hang when calling getSegmentId(msb, lsb)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2752&quot;&gt;&lt;del&gt;OAK-2752&lt;/del&gt;&lt;/a&gt;-md2.patch, which fixes the regression. That patch is minimal in the sense that it just uses a more exact condition to determine whether a refresh is actually required but does not add any additional logic or refactorings on top of that. &lt;/p&gt;
</comment>
                            <comment id="14494234" author="alex.parvulescu" created="Tue, 14 Apr 2015 15:17:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;with &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2752&quot; title=&quot;SegmentIdTable can sometimes hang when calling getSegmentId(msb, lsb)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2752&quot;&gt;&lt;del&gt;OAK-2752&lt;/del&gt;&lt;/a&gt;-v3.patch&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;you probably meant &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2752&quot; title=&quot;SegmentIdTable can sometimes hang when calling getSegmentId(msb, lsb)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2752&quot;&gt;&lt;del&gt;OAK-2752&lt;/del&gt;&lt;/a&gt;-md2.patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I like the idea of keeping and entry count and refreshing on the .75 threshold better. this was also captured in Thomas&apos;s patch.&lt;br/&gt;
Fully agree with the idea that a minimal set of changes is to be desired, we can save bigger refactoring endeavours for later on.&lt;/p&gt;</comment>
                            <comment id="14495857" author="tmueller" created="Wed, 15 Apr 2015 08:33:39 +0000"  >&lt;p&gt;In any case, I think we need more tests, because this is quite a central class. Any bug here is very problematic, and it&apos;s easy to make mistakes here (bugs that can affect performance a lot, and bugs that can break things in very bad ways, for example having two segment id objects for the same segment).&lt;/p&gt;

&lt;p&gt;I like the testing approach taken by Alex, however I think the fast tests (all of them?) should not be IT tests, so we find problems earlier.&lt;/p&gt;

&lt;p&gt;&amp;gt; we can save bigger refactoring endeavours for later on.&lt;/p&gt;

&lt;p&gt;I agree my patch is big. I&apos;m trying to write a smaller patch.&lt;/p&gt;</comment>
                            <comment id="14495859" author="mduerig" created="Wed, 15 Apr 2015 08:37:42 +0000"  >&lt;p&gt;Could you add some tests then? &lt;/p&gt;</comment>
                            <comment id="14495867" author="alex.parvulescu" created="Wed, 15 Apr 2015 08:49:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think the fast tests (all of them?) should not be IT tests, so we find problems earlier.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I fully agree, I wasn&apos;t sure initially how long the test will take to find the mentioned issues (see other heavy IT tests around the segment bits). now the tests look fast enough to be run as unit tests, so feel free to rename the test class (remove the &apos;IT&apos;).&lt;/p&gt;</comment>
                            <comment id="14495964" author="mduerig" created="Wed, 15 Apr 2015 09:59:34 +0000"  >&lt;p&gt;FTR, I just hit this issue during a compaction cycle in my work on &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2713&quot; title=&quot;High memory usage of CompactionMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2713&quot;&gt;&lt;del&gt;OAK-2713&lt;/del&gt;&lt;/a&gt;. Compaction would never finish because of this. &lt;/p&gt;</comment>
                            <comment id="14495991" author="tmueller" created="Wed, 15 Apr 2015 10:22:30 +0000"  >&lt;p&gt;While writing test, I think I found a second issue, with the (relatively new) method clearSegmentIdTables. After calling this method, two different instances for the same segment id can be created. The problem is that clearSegmentIdTables &lt;em&gt;removes&lt;/em&gt; the reference, and not just &lt;em&gt;clears&lt;/em&gt; the reference. The refresh() method is then called, however it does not recreate the internal map, because there were only hash conflicts but no empty references.&lt;/p&gt;</comment>
                            <comment id="14495996" author="mduerig" created="Wed, 15 Apr 2015 10:24:45 +0000"  >&lt;p&gt;The duplicate instances indeed created problems. See &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2662&quot; title=&quot;SegmentOverflowException in HeavyWriteIT on Jenkins&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2662&quot;&gt;&lt;del&gt;OAK-2662&lt;/del&gt;&lt;/a&gt;. But this should be fixed now. &lt;/p&gt;</comment>
                            <comment id="14496010" author="tmueller" created="Wed, 15 Apr 2015 10:39:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2752&quot; title=&quot;SegmentIdTable can sometimes hang when calling getSegmentId(msb, lsb)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2752&quot;&gt;&lt;del&gt;OAK-2752&lt;/del&gt;&lt;/a&gt;-tm2.patch: new patch, with more tests, less changes, and an additional bug fixed.&lt;/p&gt;</comment>
                            <comment id="14496104" author="mduerig" created="Wed, 15 Apr 2015 12:09:22 +0000"  >&lt;p&gt;Patch looks good to me except for the removed line in &lt;tt&gt;clearSegmentIdTables&lt;/tt&gt;. Could you elaborate why this is necessary?&lt;/p&gt;

&lt;p&gt;Thanks for the tests and the comments. Very helpful.&lt;/p&gt;</comment>
                            <comment id="14496140" author="tmueller" created="Wed, 15 Apr 2015 12:59:30 +0000"  >&lt;p&gt;I have added more comments to the code. Removing the line in clearSegmentIdTables is needed because refresh() only re-builds the map if there is a hash collision &lt;em&gt;and&lt;/em&gt; there is an empty reference. If the reference is removed as well, then the map is not re-build, in which case you can end up with two segment id objects for the same segment.&lt;/p&gt;</comment>
                            <comment id="14496143" author="tmueller" created="Wed, 15 Apr 2015 13:04:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2752&quot; title=&quot;SegmentIdTable can sometimes hang when calling getSegmentId(msb, lsb)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2752&quot;&gt;&lt;del&gt;OAK-2752&lt;/del&gt;&lt;/a&gt;-tm3.patch with more documentation&lt;br/&gt;
I&apos;m running the tests now (all of them, so it will take a while) and will then commit the change to trunk and branches&lt;/p&gt;</comment>
                            <comment id="14496198" author="tmueller" created="Wed, 15 Apr 2015 13:55:50 +0000"  >&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/r1673761&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1673761&lt;/a&gt; (trunk)&lt;/p&gt;</comment>
                            <comment id="14496262" author="tmueller" created="Wed, 15 Apr 2015 14:42:17 +0000"  >&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/r1673786&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1673786&lt;/a&gt; (1.2 branch)&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/r1673789&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1673789&lt;/a&gt; (1.0 branch)&lt;/p&gt;</comment>
                            <comment id="14496338" author="cgoudie" created="Wed, 15 Apr 2015 15:24:44 +0000"  >&lt;p&gt;Thanks everyone for the extremely rapid fix. We are testing it soon and will let you know.&lt;/p&gt;</comment>
                            <comment id="14500185" author="cgoudie" created="Fri, 17 Apr 2015 16:55:57 +0000"  >&lt;p&gt;We&apos;ve been running a lot of bulk testing since applying this bundle, and it does appear that it has resolved the bound up threads and deadlocks in this area. Thanks for the hard work!&lt;/p&gt;</comment>
                            <comment id="14502505" author="mreutegg" created="Mon, 20 Apr 2015 08:32:18 +0000"  >&lt;p&gt;Bulk close for 1.2.1 release.&lt;/p&gt;</comment>
                            <comment id="14572639" author="tmueller" created="Thu, 4 Jun 2015 12:04:03 +0000"  >&lt;p&gt;I added a benchmark with an alternative implementation (currently not used) that uses quadratic probing instead of linear probing, in &lt;a href=&quot;http://svn.apache.org/r1683527&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1683527&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12725214" name="OAK-2752-md.patch" size="4328" author="mduerig" created="Tue, 14 Apr 2015 13:03:09 +0000"/>
                            <attachment id="12725217" name="OAK-2752-md2.patch" size="4882" author="mduerig" created="Tue, 14 Apr 2015 13:13:34 +0000"/>
                            <attachment id="12725227" name="OAK-2752-tm1.patch" size="13284" author="thomasm" created="Tue, 14 Apr 2015 13:58:48 +0000"/>
                            <attachment id="12725540" name="OAK-2752-tm2.patch" size="15260" author="thomasm" created="Wed, 15 Apr 2015 10:39:10 +0000"/>
                            <attachment id="12725565" name="OAK-2752-tm3.patch" size="16140" author="thomasm" created="Wed, 15 Apr 2015 13:04:40 +0000"/>
                            <attachment id="12725177" name="OAK-2752-v2.patch" size="3403" author="stillalex" created="Tue, 14 Apr 2015 08:21:04 +0000"/>
                            <attachment id="12725209" name="OAK-2752-v3.patch" size="4946" author="stillalex" created="Tue, 14 Apr 2015 12:21:55 +0000"/>
                            <attachment id="12724571" name="OAK-2752.patch" size="1780" author="wmcgaule" created="Fri, 10 Apr 2015 14:59:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 24 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2d3tj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>