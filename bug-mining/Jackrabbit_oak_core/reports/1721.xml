<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:53:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-6440] Incorrect node type diff</title>
                <link>https://issues.apache.org/jira/browse/OAK-6440</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The type editor in Oak checks if a change to a node type requires a repository traversal to verify the existing content conforms to the new type. In some cases the current implementation detects a major change in type changes even though it is only minor.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13085938">OAK-6440</key>
            <summary>Incorrect node type diff</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="mreutegg">Marcel Reutegger</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Jul 2017 13:15:32 +0000</created>
                <updated>Mon, 24 Jul 2017 13:16:29 +0000</updated>
                            <resolved>Tue, 11 Jul 2017 08:48:31 +0000</resolved>
                                    <version>1.6.0</version>
                                    <fixVersion>1.7.4</fixVersion>
                    <fixVersion>1.8.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16080424" author="mreutegg" created="Mon, 10 Jul 2017 14:40:36 +0000"  >&lt;p&gt;Added an ignored test: &lt;a href=&quot;http://svn.apache.org/r1801476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1801476&lt;/a&gt; and &lt;a href=&quot;http://svn.apache.org/r1801477&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1801477&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16080425" author="mreutegg" created="Mon, 10 Jul 2017 14:41:00 +0000"  >&lt;p&gt;Attached proposed fix &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12876422/12876422_OAK-6440.patch&quot; title=&quot;OAK-6440.patch attached to OAK-6440&quot;&gt;OAK-6440.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;.&lt;/p&gt;</comment>
                            <comment id="16081842" author="mreutegg" created="Tue, 11 Jul 2017 08:07:03 +0000"  >&lt;p&gt;There&apos;s a problem with the previous patch. It doesn&apos;t work well with existing node type definitions written by previous versions of Oak. Depending on the Oak version and the node type registration mechanism used, nt:base may be present as declared supertype or not.&lt;/p&gt;

&lt;p&gt;The new patch &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12876586/12876586_OAK-6440-1.patch&quot; title=&quot;OAK-6440-1.patch attached to OAK-6440&quot;&gt;OAK-6440-1.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; simply ignores nt:base when a diff of supertypes is done.&lt;/p&gt;</comment>
                            <comment id="16081853" author="alex.parvulescu" created="Tue, 11 Jul 2017 08:24:20 +0000"  >&lt;p&gt;I was trying to understand the first version patch, but I was struggling a bit. Second version makes more sense and seems less intrusive. If I read your last comment correctly, this might be triggered by the fact that &lt;tt&gt;nt:base&lt;/tt&gt; could or not be present on the definition and this confuses the diff mechanism.&lt;/p&gt;

&lt;p&gt;I say it looks good even though I don&apos;t fully understand the implications &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;ps. I&apos;m wondering if patching the &lt;tt&gt;NamedTemplate#getOakNamesOrThrowConstraintViolation&lt;/tt&gt; to inject nt:base if it doesn&apos;t exist has the same end result (no major changes detected) while at the same time fixing the definitions.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;edit&amp;#93;&lt;/span&gt; attached a demo patch to explain my idea. feel free to ignore if it doesn&apos;t look proper &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16081868" author="mreutegg" created="Tue, 11 Jul 2017 08:33:16 +0000"  >&lt;p&gt;This may also work, but has implications on other uses of this method. E.g. it is also used in &lt;tt&gt;NodeTypeDefinitionTemplateImpl.setRequiredPrimaryTypeNames()&lt;/tt&gt;. There we probably don&apos;t want to add &lt;tt&gt;nt:base&lt;/tt&gt; automatically.&lt;/p&gt;</comment>
                            <comment id="16081893" author="mreutegg" created="Tue, 11 Jul 2017 08:48:32 +0000"  >&lt;p&gt;Applied &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-6440&quot; title=&quot;Incorrect node type diff&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-6440&quot;&gt;&lt;del&gt;OAK-6440&lt;/del&gt;&lt;/a&gt;-1.patch to trunk: &lt;a href=&quot;http://svn.apache.org/r1801573&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1801573&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16098387" author="edivad" created="Mon, 24 Jul 2017 13:16:29 +0000"  >&lt;p&gt;Bulk close for 1.7.4&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12876586" name="OAK-6440-1.patch" size="2523" author="mreutegg" created="Tue, 11 Jul 2017 08:03:59 +0000"/>
                            <attachment id="12876588" name="OAK-6440-fix-input.patch" size="2827" author="stillalex" created="Tue, 11 Jul 2017 08:25:50 +0000"/>
                            <attachment id="12876422" name="OAK-6440.patch" size="2662" author="mreutegg" created="Mon, 10 Jul 2017 14:40:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 16 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hbgf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>