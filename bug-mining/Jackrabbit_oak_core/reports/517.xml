<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:40:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1155] PropertyIndex cost calculation is faulty</title>
                <link>https://issues.apache.org/jira/browse/OAK-1155</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The cost calculation can easily go out of bounds when it needs to estimate (whenever there are more than 100 nodes).&lt;br/&gt;
The high value it returns can be higher than the traversal index which has a max of 10M, but can be less smaller.&lt;/p&gt;


&lt;p&gt;For example:&lt;br/&gt;
  100 nodes in the index:&lt;br/&gt;
  with a single level /content cost is 6250000&lt;br/&gt;
  adding a second level /content/data cost jumps to 1.544804416E9&lt;/p&gt;

&lt;p&gt;  101 nodes in the index:&lt;br/&gt;
  with a single level /content cost is 100&lt;br/&gt;
  adding a second level /content/data stays at 100&lt;/p&gt;

&lt;p&gt;  100 nodes, 12 levels deep, cost is 2.147483647E9&lt;br/&gt;
  101 nodes, 12 levels deep, cost is 6.7108864E7&lt;/p&gt;</description>
                <environment></environment>
        <key id="12678176">OAK-1155</key>
            <summary>PropertyIndex cost calculation is faulty</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="stillalex">Alex Deparvu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Nov 2013 08:34:37 +0000</created>
                <updated>Fri, 13 Dec 2013 09:01:15 +0000</updated>
                            <resolved>Thu, 28 Nov 2013 14:17:12 +0000</resolved>
                                                    <fixVersion>0.13</fixVersion>
                                    <component>core</component>
                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13817115" author="alex.parvulescu" created="Fri, 8 Nov 2013 08:37:15 +0000"  >&lt;p&gt;added test case with rev &lt;a href=&quot;http://svn.apache.org/r1539949&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1539949&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13817209" author="alex.parvulescu" created="Fri, 8 Nov 2013 11:54:09 +0000"  >&lt;p&gt;added a workaround with rev &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;I pushed the traversal fallback flag to the query, this allows for the distinction between the defined query indexes and the traversal index. &lt;br/&gt;
I think the traversal index should never be picked if there&apos;s a valid query index available no matter the cost is provides, a property index is a subset of the entire repository, I can&apos;t see a case where it&apos;s more efficient to traverse everything.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://svn.apache.org/r1539990&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1539990&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13834639" author="tmueller" created="Thu, 28 Nov 2013 09:26:57 +0000"  >&lt;p&gt;I think your are right, the property index should be used even if there are many entries in the index.&lt;/p&gt;

&lt;p&gt;&amp;gt;  I can&apos;t see a case where it&apos;s more efficient to traverse everything.&lt;/p&gt;

&lt;p&gt;There is one case: if the index contains a large subset of all nodes (for example more than 30%, as this is currently the case for the nodetype index I think). In this case, traversing can be faster. However, if the nodetype index contains less entries, then this isn&apos;t a problem. So I think we shouldn&apos;t optimize for the case that the index contains too many entries - instead we should avoid having indexes that contain so many entries &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="13834834" author="tmueller" created="Thu, 28 Nov 2013 13:45:38 +0000"  >&lt;p&gt;I think the main problem is the formula used to estimate the cost. It tries to guess the number of nodes based on the first traversed 100 entries, and uses the average width as well as the average depth of those nodes. The main issue is that the average width can be way off, resulting is extremely high values (the formula roughly uses Math.pow(averageWidth, averageDepth)). It would probably be more accurate to use a fixed average width, for example 1.1. That way, numbers will within a reasonable range.&lt;/p&gt;</comment>
                            <comment id="13834860" author="tmueller" created="Thu, 28 Nov 2013 14:17:12 +0000"  >&lt;p&gt;Revision 1546369: simplified to estimation formula to use the average depth of the first 100 matches, and a fixed average width of 1.1.&lt;/p&gt;</comment>
                            <comment id="13847280" author="alex.parvulescu" created="Fri, 13 Dec 2013 09:01:15 +0000"  >&lt;p&gt;bulk close for the 0.13 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357551</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pmzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357841</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>