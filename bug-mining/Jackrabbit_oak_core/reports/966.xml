<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:45:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1982] Ordered index must ignore full-text queries</title>
                <link>https://issues.apache.org/jira/browse/OAK-1982</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Currently, the ordered index does not check for full-text constraints (like the property index), and may returns a low cost for such cases.&lt;/p&gt;

&lt;p&gt;Only full-text indexes (Lucene, Solr) know how to process full-text conditions. Only those indexes are supposed to return a low cost for such queries.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12729134">OAK-1982</key>
            <summary>Ordered index must ignore full-text queries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="thomasm">Thomas Mueller</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Jul 2014 09:51:22 +0000</created>
                <updated>Tue, 8 Oct 2019 15:22:14 +0000</updated>
                            <resolved>Thu, 24 Jul 2014 10:23:54 +0000</resolved>
                                    <version>1.0</version>
                    <version>1.0.1</version>
                    <version>1.0.2</version>
                                    <fixVersion>1.0.3</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14071568" author="tmueller" created="Wed, 23 Jul 2014 09:55:01 +0000"  >&lt;p&gt;Patch (not yet tested):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Index: src/main/java/org/apache/jackrabbit/oak/plugins/index/property/OrderedPropertyIndex.java
===================================================================
--- src/main/java/org/apache/jackrabbit/oak/plugins/index/property/OrderedPropertyIndex.java	(revision 1612518)
+++ src/main/java/org/apache/jackrabbit/oak/plugins/index/property/OrderedPropertyIndex.java	(working copy)
@@ -87,6 +87,14 @@
             LOG.debug(&quot;getPlans() - rootState: {} - &quot;, root);
         }
         List&amp;lt;IndexPlan&amp;gt; plans = new ArrayList&amp;lt;IndexPlan&amp;gt;();
+        if (filter.getFullTextConstraint() != null) {
+            // not an appropriate index for full-text search
+            return plans;
+        }
+        if (filter.containsNativeConstraint()) {
+            // not an appropriate index for native search
+            return plans;
+        }
 
         OrderedPropertyIndexLookup lookup = getLookup(root);
         Collection&amp;lt;PropertyRestriction&amp;gt; restrictions = filter.getPropertyRestrictions();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=edivad&quot; class=&quot;user-hover&quot; rel=&quot;edivad&quot;&gt;edivad&lt;/a&gt;, I believe you are working on a new ordered index implementation, could you ensure to do the same there please?&lt;/p&gt;</comment>
                            <comment id="14072969" author="edivad" created="Thu, 24 Jul 2014 08:08:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I believe you are working on a new ordered index implementation, could you ensure to do the same there please?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Pencilled it. I&apos;ll make sure of it.&lt;/p&gt;

&lt;p&gt;Anyhow I was reviewing the patch. The non-processing has been applied&lt;br/&gt;
at the very top of the plans creation. In case of ordered index it&lt;br/&gt;
could play in case of the ORDER BY clause is the on an indexed&lt;br/&gt;
property. I would let the query engine then apply the filters.&lt;/p&gt;

&lt;p&gt;I would go then for something like this&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/property/OrderedPropertyIndex.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/property/OrderedPropertyIndex.java
index a0aaaaa..aff0473 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/property/OrderedPropertyIndex.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/plugins/index/property/OrderedPropertyIndex.java
@@ -87,15 +87,6 @@ public class OrderedPropertyIndex implements QueryIndex, AdvancedQueryIndex {
             LOG.debug(&quot;getPlans() - rootState: {} - &quot;, root);
         }
         List&amp;lt;IndexPlan&amp;gt; plans = new ArrayList&amp;lt;IndexPlan&amp;gt;();
-        if (filter.getFullTextConstraint() != null) {
-            // not an appropriate index for full-text search
-            return plans;
-        }
-        if (filter.containsNativeConstraint()) {
-            // not an appropriate index for native search
-            return plans;
-        }
-
         OrderedPropertyIndexLookup lookup = getLookup(root);
         Collection&amp;lt;PropertyRestriction&amp;gt; restrictions = filter.getPropertyRestrictions();
 
@@ -122,6 +113,7 @@ public class OrderedPropertyIndex implements QueryIndex, AdvancedQueryIndex {
         }
 
         // then we add plans for each restriction that could apply to us
+        if (filter.getFullTextConstraint() == null &amp;amp;&amp;amp; !filter.containsNativeConstraint()) {
             for (Filter.PropertyRestriction pr : restrictions) {
                 String propertyName = PathUtils.getName(pr.propertyName);
                 if (lookup.isIndexed(propertyName, &quot;/&quot;, filter)) {
@@ -163,6 +155,7 @@ public class OrderedPropertyIndex implements QueryIndex, AdvancedQueryIndex {
                     }
                 }
             }
+        }
 
         return plans;
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;WDYT?&lt;/p&gt;
</comment>
                            <comment id="14073062" author="tmueller" created="Thu, 24 Jul 2014 10:23:54 +0000"  >&lt;p&gt;Revision 1612835 (trunk)&lt;br/&gt;
Revision 1613060 (1.0 branch)&lt;/p&gt;</comment>
                            <comment id="14073063" author="tmueller" created="Thu, 24 Jul 2014 10:27:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=edivad&quot; class=&quot;user-hover&quot; rel=&quot;edivad&quot;&gt;edivad&lt;/a&gt;, only full-text indexes (Lucene, Solr) know how to process full-text conditions. The ordered index must not be used for such queries, as that way the full-text index would not be used (only one index can be used per selector of the raw query). So using the ordered index for &quot;order by&quot; clauses does not work in this case - the query result could be wrong.&lt;/p&gt;</comment>
                            <comment id="14073112" author="edivad" created="Thu, 24 Jul 2014 11:37:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt;: So the patch looks good &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I thought the query engine was able to merge two result sets to avoid any needed in-memory sorting.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>407208</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 17 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1y2lz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>407224</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>