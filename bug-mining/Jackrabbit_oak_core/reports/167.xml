<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:36:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-189] Swallowed exceptions</title>
                <link>https://issues.apache.org/jira/browse/OAK-189</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Exceptions should not be silently swallowed. This is currently done in SessionDelegate$SessionNameMapper, methods getOakPrefix(), getOakPrefixFromURI(), and getJcrPrefix(). Those methods catch RepositoryException, don&apos;t log by default (only when using debug level), and don&apos;t log the exception stack trace or throw an exception.&lt;/p&gt;

&lt;p&gt;Catching a very wide band of exceptions (RepositoryException) and then simply returning null is not an acceptable solution in my view.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12598973">OAK-189</key>
            <summary>Swallowed exceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="thomasm">Thomas Mueller</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Jul 2012 14:45:31 +0000</created>
                <updated>Tue, 21 May 2013 11:26:34 +0000</updated>
                            <resolved>Fri, 1 Mar 2013 14:42:53 +0000</resolved>
                                                    <fixVersion>0.7</fixVersion>
                                    <component>jcr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13415201" author="tmueller" created="Mon, 16 Jul 2012 14:58:50 +0000"  >&lt;p&gt;The reason why I think it&apos;s not acceptable is that the exception could be anything, for example out of disk space, or some internal error. Just silently returning null, without logging, makes it hard to find the root cause of the problem, because everything else might just look fine. Some code might accept null as a correct answer, so that the program just behaves somewhat differently.&lt;/p&gt;</comment>
                            <comment id="13421330" author="mduerig" created="Tue, 24 Jul 2012 11:21:17 +0000"  >&lt;p&gt;This is another example for why I think checked exceptions are not worth it. It forces exceptions to be handled in places where nothing can be done about them. So they are just ignored... &lt;/p&gt;</comment>
                            <comment id="13422310" author="tmueller" created="Wed, 25 Jul 2012 14:31:31 +0000"  >&lt;p&gt;Well, this is not about checked versus uncheck exceptions, but about catching an exception and then simply &quot;return null&quot;, without logging the exception, without re-throwing a different exception. The exception is silently ignored, and the code behaves in a different way.&lt;/p&gt;</comment>
                            <comment id="13526554" author="mduerig" created="Fri, 7 Dec 2012 17:16:00 +0000"  >&lt;p&gt;This is a consequence of the decision taken in &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-89&quot; title=&quot;Improve exception handling&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-89&quot;&gt;&lt;del&gt;OAK-89&lt;/del&gt;&lt;/a&gt; to use checked exceptions everywhere. This inevitably leads to situations where you have to catch exception even though you don&apos;t want to. I think logging at debug level is the right thing to do. Apart from adding the stack trace to the log, I don&apos;t think there is any more we can do.&lt;/p&gt;</comment>
                            <comment id="13526563" author="mduerig" created="Fri, 7 Dec 2012 17:27:02 +0000"  >&lt;p&gt;Fixed at revision 1418402.&lt;/p&gt;</comment>
                            <comment id="13526758" author="jukkaz" created="Fri, 7 Dec 2012 20:50:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;the decision taken in &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-89&quot; title=&quot;Improve exception handling&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-89&quot;&gt;&lt;del&gt;OAK-89&lt;/del&gt;&lt;/a&gt; to use checked exceptions everywhere&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t see such a decision in that issue.&lt;/p&gt;

&lt;p&gt;The problem here is that the API the SessionNameMapper is using does not distinguish between actionable exceptions (something like a NamespaceNotFoundException) and a too generic base class (RepositoryException) for which there&apos;s no reasonable action to be taken at that level of the code.&lt;/p&gt;

&lt;p&gt;A deeper solution to this problem could be to make SessionNameMapper have direct access to the internal namespace mappings used by the associated SessionImpl instance (or perhaps even make SessionNameMapper responsible for managing those mappings). That way we wouldn&apos;t have to roundtrip through the JCR API and deal with potential extra exceptions.&lt;/p&gt;</comment>
                            <comment id="13527775" author="tmueller" created="Mon, 10 Dec 2012 08:35:11 +0000"  >&lt;p&gt;Now the exception stack trace is logged when using log level debug.&lt;/p&gt;

&lt;p&gt;I&apos;m not happy with the current solution, because exceptions are still silently swallowed by default (by default, because the log level is not debug by default). So for example if there is an IO exception in the MicroKernel, or anything strange happened, it will still behave in a strange way, and it&apos;s very hard to figure out whats going on.&lt;/p&gt;

&lt;p&gt;I would prefer a solution where exceptions are used for truly exceptional cases, and not used for control flow. To me it looks like they are used for control flow currently, in those cases.&lt;/p&gt;</comment>
                            <comment id="13527777" author="tmueller" created="Mon, 10 Dec 2012 08:38:12 +0000"  >&lt;p&gt;If &quot;return null&quot; is in fact an exception, then I would prefer throwing &quot;IllegalArgumentException(e)&quot; or something like that (throw a runtime exception with the wrapped RepositoryException).&lt;/p&gt;

&lt;p&gt;If &quot;return null&quot; means something else, for example the node doesn&apos;t exist, then this should only happen in a very specific exception, for example ItemNotFoundException or PathNotFoundException, and not on the generic RepositoryException.&lt;/p&gt;</comment>
                            <comment id="13527795" author="jukkaz" created="Mon, 10 Dec 2012 09:09:49 +0000"  >&lt;p&gt;I&apos;ll look at adapting the class as outlined above so we don&apos;t need to deal with potential RepositoryExceptions.&lt;/p&gt;</comment>
                            <comment id="13527880" author="mduerig" created="Mon, 10 Dec 2012 11:28:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;I don&apos;t see such a decision in that issue.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It might not be eminent from the issue itself but this was pretty much the result of the surrounding discussion back then. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;A deeper solution to this problem could &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree that this could be solved through a more profound refactoring. However, my point is that checked exceptions don&apos;t compose and this code is a prime example of what this leads to. In the end effect this hurts code quality. People usually won&apos;t go the extra mile and refactor the code. They will in most cases just want to get their job done, catch the exception and move on.&lt;/p&gt;

&lt;p&gt;FWIW, skimming through the sources in oak-core/main, I quickly found 91 places where exception handling smells. Most places even had multiple issues associated with them:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;In 70 cases exception handling is forced upon the the consumer of an API because the implemented API doesn&apos;t allow throwing exceptions.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In 18 cases the checked exception is wrapped into a runtime exception. This might not be wrong per se but it is part of the fall out from forcing code to handle an exception where a caller higher up in the call chain might be in a better position to handle it.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In 6 cases an overly broad range of exceptions is caught (Exception, RuntimeException, not even counting RepositoryException).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In 27 cases there is no adequate logging.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In 8 cases exceptions are misused for flow control.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In 30 cases the exception in just swallowed even though a higher up caller might well be able to handle it.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In 5 cases the exception indicates a programming error and should be an assertion.&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="13528955" author="jukkaz" created="Tue, 11 Dec 2012 13:27:37 +0000"  >&lt;p&gt;I replaced the troublesome SessionNameMapper class with a new LocalNameMapper one in revision 1420139. The new class doesn&apos;t use the JCR API to access the underlying namespace registry or session-local mappings, so it doesn&apos;t need to deal with RepositoryExceptions.&lt;/p&gt;

&lt;p&gt;Re: 91 places; Did you have a generic design change in mind that could address most of those, or should we look at them on a case-by-case manner like with SessionNameMapper?&lt;/p&gt;</comment>
                            <comment id="13528976" author="mduerig" created="Tue, 11 Dec 2012 13:57:51 +0000"  >&lt;p&gt;Thanks, this looks much better now.&lt;/p&gt;

&lt;p&gt;The generic change I had in mind was part of the discussion around &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-89&quot; title=&quot;Improve exception handling&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-89&quot;&gt;&lt;del&gt;OAK-89&lt;/del&gt;&lt;/a&gt;. There I suggested not to use checked exceptions because it would lead to exactly this situation. I agreed to look at the respective issues on a by case basis but remained sceptical. See &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-89?focusedCommentId=13270024&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13270024&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/OAK-89?focusedCommentId=13270024&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13270024&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;So if we want to tackle this, we will most probably have to grep through all catch(.*) occurrences and check them manually. &lt;/p&gt;</comment>
                            <comment id="13590577" author="mduerig" created="Fri, 1 Mar 2013 14:42:53 +0000"  >&lt;p&gt;Cleaning up old issues. Please reopen if necessary. Consider opening a new issue for follow up work.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>296517</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 38 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i149wv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233069</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>