<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:46:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2195] Repository upgrade does not correctly update jcr:all aggregate privileges and bits</title>
                <link>https://issues.apache.org/jira/browse/OAK-2195</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;When custom privileges are present &lt;tt&gt;jcr:all&lt;/tt&gt; does not correctly reflect those via &lt;tt&gt;#getAggregatePrivileges&lt;/tt&gt; and via its bit map. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12748072">OAK-2195</key>
            <summary>Repository upgrade does not correctly update jcr:all aggregate privileges and bits</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="angela">Angela Schreiber</assignee>
                                    <reporter username="mduerig">Michael D&#252;rig</reporter>
                        <labels>
                            <label>production</label>
                            <label>upgrade</label>
                    </labels>
                <created>Tue, 14 Oct 2014 16:33:07 +0000</created>
                <updated>Fri, 23 Jan 2015 12:11:55 +0000</updated>
                            <resolved>Thu, 15 Jan 2015 09:12:27 +0000</resolved>
                                                    <fixVersion>1.0.10</fixVersion>
                    <fixVersion>1.1.5</fixVersion>
                                    <component>upgrade</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14171188" author="mduerig" created="Tue, 14 Oct 2014 16:35:38 +0000"  >&lt;p&gt;Proposed patch and test. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anchela&quot; class=&quot;user-hover&quot; rel=&quot;anchela&quot;&gt;anchela&lt;/a&gt;, could you have a look whether this makes sense?&lt;/p&gt;</comment>
                            <comment id="14173507" author="anchela" created="Thu, 16 Oct 2014 08:01:28 +0000"  >&lt;p&gt;not sure... it feels really wrong to me that the upgrade code manually tries to enforce what the corresponding commit hooks and validators do in a regular setup... for example it sets the jcr:all privilege, but does it also set the next-bits?&lt;/p&gt;

&lt;p&gt;IMO the correct fix would be to have all built-in privileges installed by the corresponding initializer first and then regularly register those privileges from the jackrabbit 2.x instance that are not yet registered... i.e. only registering custom privileges. and again: from my point of view the registration should not be done manually on the node builder but rather with the corresponding commithooks in place that make sure the privilege content is consistent. then, the upgrader doesn&apos;t have to know about the implementation details.&lt;/p&gt;</comment>
                            <comment id="14173510" author="anchela" created="Thu, 16 Oct 2014 08:04:54 +0000"  >&lt;p&gt;btw: are you sure that the problem only arises if custom privileges are present? from what i understood the upgraded repository in particular misses all built-in privileges defined by oak 1.0 which were not present in jackrabbit 2.x...&lt;/p&gt;</comment>
                            <comment id="14173649" author="mduerig" created="Thu, 16 Oct 2014 11:51:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;the correct fix would be to have all built-in privileges installed by the corresponding initializer first&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is already the case. Only custom privileges are currently being written &apos;manually&apos;, which is bad as you pointed out. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;but rather with the corresponding commithooks &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed. However, I&apos;d need some help here as I&apos;m not familiar with those parts of the code base. Which commit hooks would this be? How could I get them involved?&lt;/p&gt;</comment>
                            <comment id="14278456" author="anchela" created="Thu, 15 Jan 2015 09:10:18 +0000"  >&lt;p&gt;revision 1651988 : the &lt;tt&gt;JcrAllCommitHook&lt;/tt&gt; didn&apos;t properly cope with the situation where the privilge-store root was created along with the custom privileges such as it happens during upgrade.&lt;/p&gt;

&lt;p&gt;revision 1651989 : add test-case as provided by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;revision 1651996 : &lt;tt&gt;JcrAllCommitHookTest&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="14283450" author="chetanm" created="Tue, 20 Jan 2015 06:01:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anchela&quot; class=&quot;user-hover&quot; rel=&quot;anchela&quot;&gt;anchela&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt; Should this bug fix also merged to 1.0 branch as most of the upgrade is being performed via build from 1.0 branch&lt;/p&gt;</comment>
                            <comment id="14283571" author="anchela" created="Tue, 20 Jan 2015 07:59:57 +0000"  >&lt;p&gt;probably it should. if nobody objects i will merge the changes into the 1.0 branch.&lt;/p&gt;</comment>
                            <comment id="14283702" author="anchela" created="Tue, 20 Jan 2015 11:01:28 +0000"  >&lt;p&gt;merged changes into 1.0 branch at rev. 1653223&lt;/p&gt;</comment>
                            <comment id="14289149" author="edivad" created="Fri, 23 Jan 2015 12:11:55 +0000"  >&lt;p&gt;Bulk close for 1.1.5&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12674792" name="OAK-2195.patch" size="3639" author="mduerig" created="Tue, 14 Oct 2014 16:35:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 43 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i215t3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>