<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:47:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2960] SegmentNodeStoreService doesn&apos;t fully implement a @Modified method</title>
                <link>https://issues.apache.org/jira/browse/OAK-2960</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The &lt;tt&gt;SegmentNodeStoreService&lt;/tt&gt; component recently introduced an &lt;tt&gt;@Modified&lt;/tt&gt; method that picks up changes in just one configuration property and ignores the rest.&lt;/p&gt;

&lt;p&gt;Some configuration properties, like &lt;tt&gt;customBlobStore&lt;/tt&gt;, have a huge impact on the dynamic behaviour of the component. If the component fails to pick up these changes, its behaviour is just wrong.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;@Modified&lt;/tt&gt; method should be removed. It is safer to go through a complete deactivation and activation process.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12835416">OAK-2960</key>
            <summary>SegmentNodeStoreService doesn&apos;t fully implement a @Modified method</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="amitjain">Amit Jain</assignee>
                                    <reporter username="frm">Francesco Mari</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Jun 2015 14:21:16 +0000</created>
                <updated>Wed, 2 Mar 2016 11:39:36 +0000</updated>
                            <resolved>Tue, 9 Jun 2015 12:25:27 +0000</resolved>
                                                    <fixVersion>1.0.15</fixVersion>
                    <fixVersion>1.2.3</fixVersion>
                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>segmentmk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14572852" author="frm" created="Thu, 4 Jun 2015 14:23:08 +0000"  >&lt;p&gt;The &lt;tt&gt;@Modified&lt;/tt&gt; method was introduced as part of the resolution of &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2016&quot; title=&quot;Make blob gc max age configurable in SegmentNodeStoreService&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2016&quot;&gt;&lt;del&gt;OAK-2016&lt;/del&gt;&lt;/a&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=amitjain&quot; class=&quot;user-hover&quot; rel=&quot;amitjain&quot;&gt;amitjain&lt;/a&gt;, can you have a look at this issue?&lt;/p&gt;</comment>
                            <comment id="14574086" author="frm" created="Fri, 5 Jun 2015 07:47:08 +0000"  >&lt;p&gt;The attached &lt;tt&gt;OAK&amp;#45;2960-01.patch&lt;/tt&gt; removes the &lt;tt&gt;@Modified&lt;/tt&gt; method, forcing a full cleanup of the component when the configuration changes.&lt;/p&gt;</comment>
                            <comment id="14574124" author="amitjain" created="Fri, 5 Jun 2015 08:30:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=frm&quot; class=&quot;user-hover&quot; rel=&quot;frm&quot;&gt;frm&lt;/a&gt;&lt;br/&gt;
The behavior matches what we have for the DocumentNodeStoreService.&lt;/p&gt;

&lt;p&gt;The intended behavior for @Modified annotated method is to detect changes for the property &lt;tt&gt;blobGcMaxAgeInSecs&lt;/tt&gt; only as it is safer to do it dynamically. For the other properties I am not so sure that is the case. In fact for the property &lt;tt&gt;customBlobStore&lt;/tt&gt;, it is definitely not safer to change it midway as switching the property would mean that the earlier blobs would not be found, so, they are handled only on activate.&lt;/p&gt;</comment>
                            <comment id="14574132" author="frm" created="Fri, 5 Jun 2015 08:39:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=amitjain&quot; class=&quot;user-hover&quot; rel=&quot;amitjain&quot;&gt;amitjain&lt;/a&gt;, configuration can change at any time for any properties. A component should handle modification to all of its properties, and act accordingly if some property has a deeper impact than others. &lt;/p&gt;

&lt;p&gt;The solution developed for &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2016&quot; title=&quot;Make blob gc max age configurable in SegmentNodeStoreService&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2016&quot;&gt;&lt;del&gt;OAK-2016&lt;/del&gt;&lt;/a&gt; forces a user to unbind the configuration, modify properties (if one of the properties to modify is not &lt;tt&gt;blobGcMaxAgeInSecs&lt;/tt&gt;), and bind the configuration again. This behaviour, other than being cumbersome, is different from the one that the &lt;tt&gt;DocumentNodeStoreService&lt;/tt&gt; used to have.&lt;/p&gt;</comment>
                            <comment id="14574140" author="amitjain" created="Fri, 5 Jun 2015 08:49:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=frm&quot; class=&quot;user-hover&quot; rel=&quot;frm&quot;&gt;frm&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The solution developed for &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2016&quot; title=&quot;Make blob gc max age configurable in SegmentNodeStoreService&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2016&quot;&gt;&lt;del&gt;OAK-2016&lt;/del&gt;&lt;/a&gt; forces a user to unbind the configuration, modify properties (if one of the properties to modify is not blobGcMaxAgeInSecs), and bind the configuration again. This behaviour, other than being cumbersome &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes that is the intent because most of it is initializing the DocumentStore and the BlobStore which should not change. (As done with &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2016&quot; title=&quot;Make blob gc max age configurable in SegmentNodeStoreService&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2016&quot;&gt;&lt;del&gt;OAK-2016&lt;/del&gt;&lt;/a&gt; and the existing solution in DocumentNodeStoreService)&lt;/p&gt;

&lt;p&gt;BTW did not get what is different from DocumentNodeStoreService. See below.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /**
     * At runtime DocumentNodeStore only pickup modification of certain properties
     */
    @Modified
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void modified(Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, ?&amp;gt; config){
        versionGcMaxAgeInSecs = toLong(config.get(PROP_VER_GC_MAX_AGE), DEFAULT_VER_GC_MAX_AGE);
        blobGcMaxAgeInSecs = toLong(config.get(PROP_BLOB_GC_MAX_AGE), DEFAULT_BLOB_GC_MAX_AGE);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14574174" author="frm" created="Fri, 5 Jun 2015 09:15:34 +0000"  >&lt;p&gt;The difference is the presence of the &lt;tt&gt;@Modified&lt;/tt&gt; method itself. &lt;/p&gt;

&lt;p&gt;Without the &lt;tt&gt;@Modified&lt;/tt&gt; method, the sequence of callbacks seen by the component during its lifecycle was &lt;tt&gt;activated()&lt;/tt&gt;, &lt;tt&gt;deactivated()&lt;/tt&gt;, &lt;tt&gt;activated()&lt;/tt&gt;, &lt;tt&gt;deactivated()&lt;/tt&gt;, and so on. This means that the &lt;tt&gt;DocumentStore&lt;/tt&gt;, the &lt;tt&gt;BlobStore&lt;/tt&gt; and everything else had to be finalized and reinitialized at every configuration change.&lt;/p&gt;

&lt;p&gt;With the &lt;tt&gt;@Modified&lt;/tt&gt; method, the sequence of callbacks seen by the component during its lifecycle is &lt;tt&gt;activated()&lt;/tt&gt;,  zero or more &lt;tt&gt;modified()&lt;/tt&gt;, and finally &lt;tt&gt;deactivated()&lt;/tt&gt;. This doesn&apos;t mean that the &lt;tt&gt;DocumentStore&lt;/tt&gt;, the &lt;tt&gt;BlobStore&lt;/tt&gt; and everything doesn&apos;t have to be finalized and reinitialized. It just needs to be done when some &quot;critical&quot; properties change.&lt;/p&gt;

&lt;p&gt;To correctly implement this behaviour, the component should maintain every configuration property value into instance variables. When the &lt;tt&gt;@Modified&lt;/tt&gt; method is called, the new property values should be compared with the old ones (saved in the instance variables). If a change is detected for &quot;critical&quot; property values, like &lt;tt&gt;customBlobStore&lt;/tt&gt;, then the appropriate finalizations and reinitializations should be performed. Otherwise, the new property values can just be set and they will be automatically picked up.&lt;/p&gt;

&lt;p&gt;This is the reason why I think that &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2016&quot; title=&quot;Make blob gc max age configurable in SegmentNodeStoreService&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2016&quot;&gt;&lt;del&gt;OAK-2016&lt;/del&gt;&lt;/a&gt; is wrong. It doesn&apos;t fully implement this strategy. As it is, it may be safer to just go through a complete cycle of &lt;tt&gt;deactivated()&lt;/tt&gt; and &lt;tt&gt;activated()&lt;/tt&gt; callbacks.&lt;/p&gt;

</comment>
                            <comment id="14576611" author="amitjain" created="Mon, 8 Jun 2015 05:20:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;The difference is the presence of the @Modified method itself.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It is also present in the DocumentNodeStoreService as I mentioned above&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This doesn&apos;t mean that the DocumentStore, the BlobStore and everything doesn&apos;t have to be finalized and reinitialized. It just needs to be done when some &quot;critical&quot; properties change.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Why? Is it required by the specification, asking as I don&apos;t know.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This is the reason why I think that &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2016&quot; title=&quot;Make blob gc max age configurable in SegmentNodeStoreService&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2016&quot;&gt;&lt;del&gt;OAK-2016&lt;/del&gt;&lt;/a&gt; is wrong. It doesn&apos;t fully implement this strategy. As it is, it may be safer to just go through a complete cycle of deactivated() and activated() callbacks.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Well, the current implementations do just that but in addition also do update some non-critical properties (via the @Modified) method.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetanm&quot; class=&quot;user-hover&quot; rel=&quot;chetanm&quot;&gt;chetanm&lt;/a&gt; wdyt? Are the current implementations in Document/SegmentNodeStoreService a problem?&lt;/p&gt;</comment>
                            <comment id="14576865" author="edivad" created="Mon, 8 Jun 2015 09:47:39 +0000"  >&lt;p&gt;Bulk move to 1.3.1&lt;/p&gt;</comment>
                            <comment id="14578575" author="frm" created="Tue, 9 Jun 2015 08:31:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;It is also present in the DocumentNodeStoreService as I mentioned above.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry, I didn&apos;t read carefully. My same comments apply to &lt;tt&gt;DocumentNodeStoreService&lt;/tt&gt; as well.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Why? Is it required by the specification, asking as I don&apos;t know.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It is not strictly required by the specification. It is a matter of conventions, though. If you design your component to ignore some changes in the configuration, it should be documented in a very visible way. Moreover, it may be worth logging an INFO message in the &lt;tt&gt;@Modified&lt;/tt&gt; method describing what configuration option is being ignored and why. It should be also documented that for a configuration to be fully applied, that same configuration must be unbound and bound again.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Well, the current implementations do just that but in addition also do update some non-critical properties (via the @Modified) method.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not completely true. Changes to properties are persistently saved in the configuration by the CM Implementation, but are not picked up by the component unless that same configuration is unbound and bound again. Persisting the properties and propagating the configuration to the component are two different steps, see section 104.5.3 in the OSGi Compendium. If a &lt;tt&gt;@Modified&lt;/tt&gt; method is present, the component is not reactivated, see sections 112.5.12 and 112.5.14 in the OSGi compendium&lt;/p&gt;
</comment>
                            <comment id="14578646" author="amitjain" created="Tue, 9 Jun 2015 09:46:23 +0000"  >&lt;p&gt;Cloned the issue for making changes to the DocumentNodeStoreService as well - &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2970&quot; title=&quot;DocumentNodeStoreService doesn&amp;#39;t fully implement a @Modified method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2970&quot;&gt;&lt;del&gt;OAK-2970&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14578812" author="amitjain" created="Tue, 9 Jun 2015 12:25:27 +0000"  >&lt;p&gt;Committed the patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk - &lt;a href=&quot;http://svn.apache.org/r1684376&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1684376&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;1.0 - &lt;a href=&quot;http://svn.apache.org/r1684401&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1684401&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;1.2 - &lt;a href=&quot;http://svn.apache.org/r1684400&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1684400&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14587453" author="amitjain" created="Tue, 16 Jun 2015 04:30:42 +0000"  >&lt;p&gt;Bulk close for Oak 1.0.15&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="12836498">OAK-2970</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12732220">OAK-2016</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12737862" name="OAK-2960-01.patch" size="2244" author="frm" created="Fri, 5 Jun 2015 07:47:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 22 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fmxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>