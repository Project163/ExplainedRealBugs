<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:51:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-5009] ExternalToExternalMigrationTest failures on Windows</title>
                <link>https://issues.apache.org/jira/browse/OAK-5009</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Tests run: 2, Failures: 0, Errors: 2, Skipped: 0, Time elapsed: 13.484 sec &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.jackrabbit.oak.segment.migration.ExternalToExternalMigrationTest
blobsCanBeReadAfterSwitchingBlobStore(org.apache.jackrabbit.oak.segment.migration.ExternalToExternalMigrationTest)  Time elapsed: 0.463 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.io.IOException: Unable to delete file: C:\tmp\1477483643533-0\segmentstore\data00001a.tar

blobsExistsOnTheNewBlobStore(org.apache.jackrabbit.oak.segment.migration.ExternalToExternalMigrationTest)  Time elapsed: 13.021 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.io.IOException: Unable to delete file: C:\tmp\1477483643996-0\segmentstore\data00000a.tar

Running org.apache.jackrabbit.oak.segment.migration.SegmentToExternalMigrationTest
Tests run: 2, Failures: 0, Errors: 2, Skipped: 0, Time elapsed: 12.719 sec &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.jackrabbit.oak.segment.migration.SegmentToExternalMigrationTest
blobsCanBeReadAfterSwitchingBlobStore(org.apache.jackrabbit.oak.segment.migration.SegmentToExternalMigrationTest)  Time elapsed: 0.157 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.io.IOException: Unable to delete file: C:\tmp\1477483657018-0\segmentstore\data00001a.tar

blobsExistsOnTheNewBlobStore(org.apache.jackrabbit.oak.segment.migration.SegmentToExternalMigrationTest)  Time elapsed: 12.561 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.io.IOException: Unable to delete file: C:\tmp\1477483657193-0\segmentstore\data00000a.tar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13015399">OAK-5009</key>
            <summary>ExternalToExternalMigrationTest failures on Windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tomek.rekawek">Tomek R&#281;kawek</assignee>
                                    <reporter username="reschke">Julian Reschke</reporter>
                        <labels>
                            <label>test-failure</label>
                    </labels>
                <created>Wed, 26 Oct 2016 12:24:43 +0000</created>
                <updated>Tue, 8 Oct 2019 15:21:57 +0000</updated>
                            <resolved>Thu, 10 Nov 2016 10:46:27 +0000</resolved>
                                                    <fixVersion>1.4.11</fixVersion>
                    <fixVersion>1.5.13</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>core</component>
                    <component>segment-tar</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15608444" author="reschke" created="Wed, 26 Oct 2016 13:22:59 +0000"  >&lt;p&gt;Tests marked as to be ignored in r1766682.&lt;/p&gt;</comment>
                            <comment id="15608794" author="mduerig" created="Wed, 26 Oct 2016 15:34:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt;, could you have a look whether there is something wrong with the setup of these tests? One thing we should change is the directory for the store. The &lt;tt&gt;/tmp&lt;/tt&gt; dir is troublesome as on the Apache Jenkins this is on a file system with little space. In other places we started using &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Rule
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; TemporaryFolder folder = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TemporaryFolder(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;target&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="15636264" author="tmueller" created="Fri, 4 Nov 2016 12:58:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tomek.rekawek&quot; class=&quot;user-hover&quot; rel=&quot;tomek.rekawek&quot;&gt;tomek.rekawek&lt;/a&gt; as you originally wrote that code (I just committed it, see &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3148&quot; title=&quot;Online migration process for the binaries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3148&quot;&gt;&lt;del&gt;OAK-3148&lt;/del&gt;&lt;/a&gt;), could you review the patch please?&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;--- src/test/java/org/apache/jackrabbit/oak/plugins/blob/migration/AbstractMigratorTest.java	(revision 1768019)
+++ src/test/java/org/apache/jackrabbit/oak/plugins/blob/migration/AbstractMigratorTest.java	(working copy)
@@ -24,6 +24,8 @@
 import java.io.File;
 import java.io.IOException;
 import java.io.InputStream;
+import java.nio.file.FileSystems;
+import java.nio.file.Path;
 import java.util.Random;
 
 import org.apache.commons.io.FileUtils;
@@ -40,6 +42,7 @@
 import org.apache.jackrabbit.oak.spi.state.NodeBuilder;
 import org.apache.jackrabbit.oak.spi.state.NodeState;
 import org.apache.jackrabbit.oak.spi.state.NodeStore;
+import org.h2.store.fs.FilePath;
 import org.junit.After;
 import org.junit.Before;
 import org.junit.Ignore;
@@ -63,7 +66,8 @@
 
     @Before
     public void setup() throws CommitFailedException, IllegalArgumentException, IOException {
-        repository = Files.createTempDir();
+        Path target = FileSystems.getDefault().getPath(&quot;target&quot;);
+        repository = java.nio.file.Files.createTempDirectory(target, &quot;migrate-&quot;).toFile();
         BlobStore oldBlobStore = createOldBlobStore(repository);
         NodeStore originalNodeStore = createNodeStore(oldBlobStore, repository);
         createContent(originalNodeStore);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15636458" author="tomek.rekawek" created="Fri, 4 Nov 2016 14:11:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt;, as far as I know these Windows exceptions related to MMAPed files, it&apos;ll still break in the teardown() method:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        FileUtils.deleteDirectory(repository);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A strategy taken in similar cases is to catch the exception and ignore it (it&apos;s ok to do it, since the directory will be created in target/, which is temporary anyway). Feel free to fix it or assign it to me (as you said, it&apos;s my code after all).&lt;/p&gt;</comment>
                            <comment id="15651326" author="tmueller" created="Wed, 9 Nov 2016 16:14:12 +0000"  >&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/r1768995&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1768995&lt;/a&gt; (trunk)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tomek.rekawek&quot; class=&quot;user-hover&quot; rel=&quot;tomek.rekawek&quot;&gt;tomek.rekawek&lt;/a&gt; could you review my fix, and if needed fix my fix &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15653663" author="frm" created="Thu, 10 Nov 2016 10:18:22 +0000"  >&lt;p&gt;Reopening this issue as the fix seems to introduce test failures on oak-segment-tar. Starting from r1768995 the following failures occur when running unit tests.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Running org.apache.jackrabbit.oak.segment.migration.ExternalToExternalMigrationTest
Tests run: 2, Failures: 0, Errors: 2, Skipped: 0, Time elapsed: 0.174 sec &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.jackrabbit.oak.segment.migration.ExternalToExternalMigrationTest
blobsCanBeReadAfterSwitchingBlobStore(org.apache.jackrabbit.oak.segment.migration.ExternalToExternalMigrationTest)  Time elapsed: 0.102 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.NullPointerException

blobsExistsOnTheNewBlobStore(org.apache.jackrabbit.oak.segment.migration.ExternalToExternalMigrationTest)  Time elapsed: 0.068 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.NullPointerException

Running org.apache.jackrabbit.oak.segment.migration.SegmentToExternalMigrationTest
Tests run: 2, Failures: 0, Errors: 2, Skipped: 0, Time elapsed: 0.134 sec &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.jackrabbit.oak.segment.migration.SegmentToExternalMigrationTest
blobsCanBeReadAfterSwitchingBlobStore(org.apache.jackrabbit.oak.segment.migration.SegmentToExternalMigrationTest)  Time elapsed: 0.045 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.NullPointerException

blobsExistsOnTheNewBlobStore(org.apache.jackrabbit.oak.segment.migration.SegmentToExternalMigrationTest)  Time elapsed: 0.082 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.NullPointerException

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15653716" author="frm" created="Thu, 10 Nov 2016 10:41:32 +0000"  >&lt;p&gt;I ignored the failing tests at r1769071.&lt;/p&gt;</comment>
                            <comment id="15653724" author="tomek.rekawek" created="Thu, 10 Nov 2016 10:46:07 +0000"  >&lt;p&gt;I&apos;ve fixed the issue and re-enabled the tests in r1769078.&lt;/p&gt;</comment>
                            <comment id="15663683" author="edivad" created="Mon, 14 Nov 2016 11:35:47 +0000"  >&lt;p&gt;Bulk close for 1.5.13&lt;/p&gt;</comment>
                            <comment id="15734531" author="amitjain" created="Fri, 9 Dec 2016 06:58:00 +0000"  >&lt;p&gt;Merged into 1.4 branch &lt;a href=&quot;http://svn.apache.org/viewvc?rev=1773324&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1773324&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13004201">OAK-4789</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="13015354">OAK-5007</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ldzb:0000ia001f4m</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>