<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:54:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-8848] Impossible to replace a mix:versionable by a different mix:versionable</title>
                <link>https://issues.apache.org/jira/browse/OAK-8848</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;If you delete a node with mixin mix:versionable and move another node with the same mixin in its place (that is, it now has the very same path), you get a ConstraintViolationException that complains that you are changing protected properties. Thus, this operation is impossible to perform within one transaction. But splitting it into two transactions is risky in many cases. It seems there is a mechanism that checks for changes of protected properties, and ignores that this is now a different node.&lt;/p&gt;

&lt;p&gt;If you have two nodes /somewhere/1 and /somewhere/2 which both are nt:unstructured and have mix:versionable, the following code triggers an exception but shouldn&apos;t:&lt;/p&gt;

&lt;p&gt;&#160; &#160; session.removeItem(&quot;/somewhere/2&quot;);&lt;br/&gt;
&#160; &#160; session.move(&quot;/somewhere/1&quot;, &quot;/somewhere/2&quot;);&lt;br/&gt;
&#160; &#160; session.save();&lt;/p&gt;

&lt;p&gt;The actual stacktrace thrown is:&lt;/p&gt;

&lt;p&gt;javax.jcr.nodetype.ConstraintViolationException: OakConstraint0100: Property is protected: jcr:versionHistory&lt;br/&gt;
at org.apache.jackrabbit.oak.api.CommitFailedException.asRepositoryException(CommitFailedException.java:226)&lt;br/&gt;
at org.apache.jackrabbit.oak.api.CommitFailedException.asRepositoryException(CommitFailedException.java:213)&lt;br/&gt;
at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.newRepositoryException(SessionDelegate.java:669)&lt;br/&gt;
at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.save(SessionDelegate.java:495)&lt;br/&gt;
at org.apache.jackrabbit.oak.jcr.session.SessionImpl$8.performVoid(SessionImpl.java:420)&lt;br/&gt;
at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.performVoid(SessionDelegate.java:273)&lt;br/&gt;
at org.apache.jackrabbit.oak.jcr.session.SessionImpl.save(SessionImpl.java:417)&lt;br/&gt;
at org.apache.sling.jcr.oak.server.internal.TcclWrappingJackrabbitSession.save(TcclWrappingJackrabbitSession.java:212)&lt;br/&gt;
at org.apache.jsp.apps.composum.prototype.assets.pagesintegration.hpsx.hpsx_jsp._jspService(hpsx_jsp.java:115)&lt;br/&gt;
at org.apache.sling.scripting.jsp.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)&lt;br/&gt;
(irrelevant sling stuff omitted)&lt;br/&gt;
Caused by: org.apache.jackrabbit.oak.api.CommitFailedException: OakConstraint0100: Property is protected: jcr:versionHistory&lt;br/&gt;
at org.apache.jackrabbit.oak.plugins.version.VersionEditor.throwProtected(VersionEditor.java:257)&lt;br/&gt;
at org.apache.jackrabbit.oak.plugins.version.VersionEditor.propertyChanged(VersionEditor.java:152)&lt;br/&gt;
at org.apache.jackrabbit.oak.spi.commit.VisibleEditor.propertyChanged(VisibleEditor.java:73)&lt;br/&gt;
at org.apache.jackrabbit.oak.spi.commit.EditorDiff.propertyChanged(EditorDiff.java:92)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.SegmentNodeState.compareProperties(SegmentNodeState.java:664)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.SegmentNodeState.compareAgainstBaseState(SegmentNodeState.java:558)&lt;br/&gt;
at org.apache.jackrabbit.oak.spi.commit.EditorDiff.childNodeChanged(EditorDiff.java:147)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.MapRecord.compare(MapRecord.java:495)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.SegmentNodeState.compareAgainstBaseState(SegmentNodeState.java:651)&lt;br/&gt;
at org.apache.jackrabbit.oak.spi.commit.EditorDiff.childNodeChanged(EditorDiff.java:147)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.MapRecord.compare(MapRecord.java:422)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.SegmentNodeState.compareAgainstBaseState(SegmentNodeState.java:651)&lt;br/&gt;
at org.apache.jackrabbit.oak.spi.commit.EditorDiff.childNodeChanged(EditorDiff.java:147)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.MapRecord.compare(MapRecord.java:422)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.SegmentNodeState.compareAgainstBaseState(SegmentNodeState.java:651)&lt;br/&gt;
at org.apache.jackrabbit.oak.spi.commit.EditorDiff.childNodeChanged(EditorDiff.java:147)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.MapRecord.compare(MapRecord.java:422)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.SegmentNodeState.compareAgainstBaseState(SegmentNodeState.java:651)&lt;br/&gt;
at org.apache.jackrabbit.oak.spi.commit.EditorDiff.childNodeChanged(EditorDiff.java:147)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.SegmentNodeState.compareAgainstBaseState(SegmentNodeState.java:598)&lt;br/&gt;
at org.apache.jackrabbit.oak.spi.commit.EditorDiff.childNodeChanged(EditorDiff.java:147)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.MapRecord.compare(MapRecord.java:422)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.SegmentNodeState.compareAgainstBaseState(SegmentNodeState.java:651)&lt;br/&gt;
at org.apache.jackrabbit.oak.spi.commit.EditorDiff.childNodeChanged(EditorDiff.java:147)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.MapRecord.compare(MapRecord.java:422)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.SegmentNodeState.compareAgainstBaseState(SegmentNodeState.java:651)&lt;br/&gt;
at org.apache.jackrabbit.oak.spi.commit.EditorDiff.process(EditorDiff.java:51)&lt;br/&gt;
at org.apache.jackrabbit.oak.spi.commit.EditorHook.processCommit(EditorHook.java:54)&lt;br/&gt;
at org.apache.jackrabbit.oak.spi.commit.CompositeHook.processCommit(CompositeHook.java:60)&lt;br/&gt;
at org.apache.jackrabbit.oak.plugins.version.VersionHook.processCommit(VersionHook.java:86)&lt;br/&gt;
at org.apache.jackrabbit.oak.spi.commit.CompositeHook.processCommit(CompositeHook.java:60)&lt;br/&gt;
at org.apache.jackrabbit.oak.spi.commit.CompositeHook.processCommit(CompositeHook.java:60)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.scheduler.Commit.apply(Commit.java:99)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.scheduler.LockBasedScheduler.execute(LockBasedScheduler.java:299)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.scheduler.LockBasedScheduler.schedule(LockBasedScheduler.java:270)&lt;br/&gt;
at org.apache.jackrabbit.oak.segment.SegmentNodeStore.merge(SegmentNodeStore.java:211)&lt;br/&gt;
at org.apache.jackrabbit.oak.core.MutableRoot.commit(MutableRoot.java:251)&lt;br/&gt;
at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.commit(SessionDelegate.java:346)&lt;br/&gt;
at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.save(SessionDelegate.java:493)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;The problem occurred from within Sling (Starter 11) using oak 1.16.0.&lt;/p&gt;</environment>
        <key id="13278648">OAK-8848</key>
            <summary>Impossible to replace a mix:versionable by a different mix:versionable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="hanspeterstoerr">Hans-Peter Stoerr</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Jan 2020 08:32:06 +0000</created>
                <updated>Thu, 11 Jul 2024 03:31:35 +0000</updated>
                            <resolved>Wed, 19 Jun 2024 11:07:13 +0000</resolved>
                                    <version>1.16.0</version>
                                    <fixVersion>1.66.0</fixVersion>
                                    <component>core</component>
                    <component>jcr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17847205" author="reschke" created="Fri, 17 May 2024 08:32:27 +0000"  >&lt;p&gt;Can we start with a subtask to create a reproducable test and mark that as &quot;@Ignore&quot;.&lt;/p&gt;</comment>
                            <comment id="17849942" author="reschke" created="Tue, 28 May 2024 09:15:50 +0000"  >&lt;p&gt;What is the expection about what would happen with the existing version history?&lt;/p&gt;

&lt;p&gt;Maybe this needs a TCK test to compare behavior with Jackrabbit.&lt;/p&gt;</comment>
                            <comment id="17856241" author="egli" created="Wed, 19 Jun 2024 11:07:13 +0000"  >&lt;p&gt;PR &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/pull/1474&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/pull/1474&lt;/a&gt; squash merged, thx &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=horia__poradici&quot; class=&quot;user-hover&quot; rel=&quot;horia__poradici&quot;&gt;horia__poradici&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 20 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0adhs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>