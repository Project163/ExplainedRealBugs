<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:42:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1404] Pre-Authenticated login does not propagate principals in subject to AuthInfo class.</title>
                <link>https://issues.apache.org/jira/browse/OAK-1404</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;systemSession = Subject.doAs(SystemSubject.INSTANCE, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrivilegedExceptionAction&amp;lt;ContentSession&amp;gt;() {
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ContentSession run() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; LoginException, NoSuchWorkspaceException {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; repository.login(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    }
});
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Produces a session with no permissions.&lt;/p&gt;

&lt;p&gt;I think there are 2 issues:&lt;/p&gt;

&lt;p&gt;1. Pre-Authenticated logins do not set an AuthInfo to the public credentials of the Subject.&lt;br/&gt;
2. the AbstractAccessControlManager uses the AuthInfo.getPrincipals() to retrieve them. IMO, the principals should always match those of the subject and be retrieved from there.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12693831">OAK-1404</key>
            <summary>Pre-Authenticated login does not propagate principals in subject to AuthInfo class.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tripod">Tobias Bocanegra</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Feb 2014 06:25:30 +0000</created>
                <updated>Wed, 26 Feb 2014 15:50:29 +0000</updated>
                            <resolved>Wed, 26 Feb 2014 15:50:29 +0000</resolved>
                                    <version>0.15</version>
                                                    <component>security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13894244" author="tripod" created="Fri, 7 Feb 2014 06:53:20 +0000"  >&lt;p&gt;workaround for system subject:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/security/authentication/SystemSubject.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/security/authentication/SystemSubject.java
@@ -16,9 +16,13 @@
  */
 &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.apache.jackrabbit.oak.spi.security.authentication;

+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.security.Principal;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.Collections;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.Set;
+
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.security.auth.Subject;

+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.jackrabbit.oak.api.AuthInfo;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.jackrabbit.oak.spi.security.principal.SystemPrincipal;

 /**
@@ -34,6 +38,8 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SystemSubject {
     &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; SystemSubject() {}

     &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Subject createSystemSubject() {
-        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Subject(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, Collections.singleton(SystemPrincipal.INSTANCE), Collections.&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;emptySet(), Collections.&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;emptySet());
+        Set&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Principal&amp;gt; principals = Collections.singleton(SystemPrincipal.INSTANCE);
+        AuthInfo info = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AuthInfoImpl(&lt;span class=&quot;code-quote&quot;&gt;&quot;system&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, principals);
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Subject(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, principals, Collections.singleton(info), Collections.&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;emptySet());
     }
 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But I think this should be solved globally. Somehow it&apos;s wrong to put the AutoInfo class as public credential in the Subject and provide principals others than those of the subject. If the goal of the public credentials is to transport the authenticated userid and the attributes we might only include those into the info.&lt;/p&gt;</comment>
                            <comment id="13894254" author="tripod" created="Fri, 7 Feb 2014 07:12:55 +0000"  >&lt;p&gt;added workaround above in r1565558&lt;/p&gt;</comment>
                            <comment id="13913041" author="anchela" created="Wed, 26 Feb 2014 15:50:08 +0000"  >&lt;p&gt;regarding 1: that&apos;s the duty of the application that performs the authentication in the first place.&lt;br/&gt;
regarding 2: i don&apos;t want to spread the Subject throughout the code base as we did in jackrabbit core.&lt;br/&gt;
regarding workaround: fine with me.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>372340</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 38 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1s62f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>372644</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>