<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:38:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-923] Runtime exception while creating a group</title>
                <link>https://issues.apache.org/jira/browse/OAK-923</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Trying to create a group where the user has not  permission ends up in a runtime exception&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.IllegalStateException: This tree does not exist
	at com.google.common.base.Preconditions.checkState(Preconditions.java:149)
	at org.apache.jackrabbit.oak.core.MutableTree.checkExists(MutableTree.java:381)
	at org.apache.jackrabbit.oak.core.MutableTree.setProperty(MutableTree.java:298)
	at org.apache.jackrabbit.oak.util.NodeUtil.setName(NodeUtil.java:226)
	at org.apache.jackrabbit.oak.util.NodeUtil.addChild(NodeUtil.java:108)
	at org.apache.jackrabbit.oak.util.NodeUtil.getOrAddChild(NodeUtil.java:115)
	at org.apache.jackrabbit.oak.security.user.UserProvider.createFolderNodes(UserProvider.java:280)
	at org.apache.jackrabbit.oak.security.user.UserProvider.createAuthorizableNode(UserProvider.java:247)
	at org.apache.jackrabbit.oak.security.user.UserProvider.createGroup(UserProvider.java:185)
	at org.apache.jackrabbit.oak.security.user.UserManagerImpl.createGroup(UserManagerImpl.java:188)
	at org.apache.jackrabbit.oak.security.user.UserManagerImpl.createGroup(UserManagerImpl.java:166)
	at org.apache.jackrabbit.oak.jcr.security.authorization.UserManagementTest.testCreateGroup3(UserManagementTest.java:170)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at junit.framework.TestCase.runTest(TestCase.java:168)
	at junit.framework.TestCase.runBare(TestCase.java:134)
	at junit.framework.TestResult$1.protect(TestResult.java:110)
	at junit.framework.TestResult.runProtected(TestResult.java:128)
	at junit.framework.TestResult.run(TestResult.java:113)
	at junit.framework.TestCase.run(TestCase.java:124)
	at org.apache.jackrabbit.test.AbstractJCRTest.run(AbstractJCRTest.java:464)
	at junit.framework.TestSuite.runTest(TestSuite.java:243)
	at junit.framework.TestSuite.run(TestSuite.java:238)
	at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:83)
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:49)
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It would be better to have a checked excpetion instead e.g. javax.jcr.AccessDeniedException&lt;/p&gt;

&lt;p&gt;I will attach test to reproduce the issue&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12658741">OAK-923</key>
            <summary>Runtime exception while creating a group</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="angela">Angela Schreiber</assignee>
                                    <reporter username="asanso">Antonio Sanso</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Jul 2013 12:17:46 +0000</created>
                <updated>Fri, 20 Sep 2013 07:01:36 +0000</updated>
                            <resolved>Tue, 23 Jul 2013 13:37:36 +0000</resolved>
                                                    <fixVersion>0.9</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13715263" author="asanso" created="Mon, 22 Jul 2013 15:00:13 +0000"  >&lt;p&gt;attaching proposed solution.&lt;/p&gt;

&lt;p&gt;This is not a real patch since it currently breaks some tests.&lt;/p&gt;

&lt;p&gt;This patch would also address the needing on OpenSecurityProvider in the UserInitializer&lt;/p&gt;</comment>
                            <comment id="13716360" author="anchela" created="Tue, 23 Jul 2013 12:44:45 +0000"  >&lt;p&gt;thanks for reporting this issue and the patch. just a few comments:&lt;/p&gt;

&lt;p&gt;regarding the test:&lt;br/&gt;
IMHO it should fail not succeed as you deny all permissions on the root (but with AccessDenied instead of IllegalState)&lt;/p&gt;

&lt;p&gt;regarding the SecureNodeUtil and the modifications made to UserProvider:&lt;br/&gt;
i think the runtime exception can be circumvented much simpler without passing around the permission provider: the exception is raised during NodeUtil#addChild in case the new child does not exist after being created. i see 2 ways to address this:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;verify if the added child exists in the utility and throw AccessDeniedException if that&apos;s not the case&lt;/li&gt;
	&lt;li&gt;change the MutableTree such that a NEW tree is always accessible (afaik this would be the backwards compatible solution)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;regarding UserInitializer:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;i would suggest to make the workspace name accessible from RootImpl instead of keeping it an shadowing field&lt;/li&gt;
	&lt;li&gt;the system subject is a singleton. i would avoid passing the subject to the constructor and keeping it in a field.&lt;/li&gt;
	&lt;li&gt;ContentSession#getUserID is allowed to return null which IMO was appropriate in this case.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13716388" author="anchela" created="Tue, 23 Jul 2013 13:37:24 +0000"  >&lt;p&gt;part one of the patch (UserInitializer:&lt;br/&gt;
-&amp;gt; committed slightly modified patch at Revision: 1506035&lt;/p&gt;

&lt;p&gt;part 2:&lt;br/&gt;
as far as accessibility of new items is concerned i decided to move this to a different issue (-&amp;gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-928&quot; title=&quot;Read access is enforced on NEW items&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-928&quot;&gt;&lt;del&gt;OAK-928&lt;/del&gt;&lt;/a&gt;).&lt;br/&gt;
in any case having NodeUtil check for the created new to exist (e.g. if the name refers to a hidden item) &lt;br/&gt;
looks beneficial to me to avoid this kind of unexpected runtime exception in a &quot;Node&quot;-utility. while addressing&lt;br/&gt;
this issue i also simplified the way the intermediate authorizable folders are being create in order to&lt;br/&gt;
better deal with limited access in the folder hierarchy.&lt;/p&gt;

&lt;p&gt;-&amp;gt; committed r1506037&lt;/p&gt;</comment>
                            <comment id="13772760" author="alex.parvulescu" created="Fri, 20 Sep 2013 07:01:36 +0000"  >&lt;p&gt;Bulk close for the 0.9 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12659328">OAK-928</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12593664" name="OAK-923-patch.txt" size="14470" author="asanso" created="Tue, 23 Jul 2013 08:58:09 +0000"/>
                            <attachment id="12593525" name="OAK-923-test.txt" size="967" author="asanso" created="Mon, 22 Jul 2013 15:00:13 +0000"/>
                            <attachment id="12593181" name="OAK-923-test.txt" size="967" author="asanso" created="Fri, 19 Jul 2013 12:19:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>338935</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1mgjr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>339255</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>