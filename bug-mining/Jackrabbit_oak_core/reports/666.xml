<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:42:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1405] OR of different constraints broken</title>
                <link>https://issues.apache.org/jira/browse/OAK-1405</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;There is a peculiar search bug on load 16 that &apos;OR&apos; of 3 constraints is broken but removing any one returns the results.  The below query returns no results but removing any one of 3 &apos;OR&apos;ed conditions returns the result. &lt;/p&gt;


&lt;p&gt;//*&lt;span class=&quot;error&quot;&gt;&amp;#91;(  jcr:content/metadata/@cq:tags = &amp;#39;stockphotography:business&amp;#39;   or jcr:like(jcr:content/metadata/@cq:tags, &amp;#39;stockphotography:business/%&amp;#39;) or jcr:content/metadata/@cq:tags = &amp;#39;/etc/tags/stockphotography/business&amp;#39;) &amp;#93;&lt;/span&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12694232">OAK-1405</key>
            <summary>OR of different constraints broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="amalhotr">Ankush Malhotra</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Feb 2014 10:25:09 +0000</created>
                <updated>Tue, 8 Oct 2019 15:21:50 +0000</updated>
                            <resolved>Tue, 11 Feb 2014 10:28:34 +0000</resolved>
                                    <version>0.15</version>
                                    <fixVersion>0.17</fixVersion>
                                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13897713" author="tmueller" created="Tue, 11 Feb 2014 10:28:34 +0000"  >&lt;p&gt;Revision 1567031&lt;/p&gt;</comment>
                            <comment id="13906814" author="maurya" created="Thu, 20 Feb 2014 09:44:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt;&lt;br/&gt;
It seems queries are dependent on order of constraints in them. Below query works fine &lt;/p&gt;

&lt;p&gt;//element(*, dam:Asset) &lt;br/&gt;
[&lt;br/&gt;
 jcr:content/metadata/@cq:tags = &apos;abc&apos;   or jcr:content/metadata/@cq:tags = &apos;abc&apos;  or jcr:like(jcr:content/metadata/@cq:tags,&apos;stockphotography:business&apos;) &lt;br/&gt;
]&lt;/p&gt;

&lt;p&gt;After changing order of last constraint, it didn&apos;t worked -&lt;/p&gt;


&lt;p&gt;//element(*, dam:Asset) &lt;br/&gt;
[&lt;br/&gt;
 jcr:content/metadata/@cq:tags = &apos;abc&apos;    or jcr:like(jcr:content/metadata/@cq:tags,&apos;stockphotography:business&apos;)  or jcr:content/metadata/@cq:tags = &apos;abc&apos;&lt;br/&gt;
]&lt;/p&gt;

&lt;p&gt;Its like only last constraint is effective and it occurs when there are atleast 3 constraints and atleast one of them uses jcr:like function.&lt;/p&gt;</comment>
                            <comment id="13907084" author="tmueller" created="Thu, 20 Feb 2014 15:45:23 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I&apos;m not quite sure, maybe the problem is already fixed in the current trunk, and what you see is a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1432&quot; title=&quot;Query: use &amp;quot;union&amp;quot; for complex XPath queries that use multiple &amp;quot;or&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1432&quot;&gt;&lt;del&gt;OAK-1432&lt;/del&gt;&lt;/a&gt;. I converted the two XPath statements to SQL-2 and got the following results:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;//element(*, dam:Asset)[jcr:content/metadata/@cq:tags = &apos;abc&apos;
  or jcr:content/metadata/@cq:tags = &apos;abc&apos;
  or jcr:like(jcr:content/metadata/@cq:tags,&apos;stockphotography:business&apos;)]
select [jcr:path], [jcr:score], *
  from [dam:Asset] as a
  where [jcr:content/metadata/cq:tags] = &apos;abc&apos;
  or [jcr:content/metadata/cq:tags] = &apos;abc&apos;
  union select [jcr:path], [jcr:score], *
  from [dam:Asset] as a
  where [jcr:content/metadata/cq:tags] like &apos;stockphotography:business&apos;

//element(*, dam:Asset)[jcr:content/metadata/@cq:tags = &apos;abc&apos;
  or jcr:like(jcr:content/metadata/@cq:tags,&apos;stockphotography:business&apos;)
  or jcr:content/metadata/@cq:tags = &apos;abc&apos;]
select [jcr:path], [jcr:score], *
  from [dam:Asset] as a
  where [jcr:content/metadata/cq:tags] = &apos;abc&apos;
  union select [jcr:path], [jcr:score], *
  from [dam:Asset] as a
  where [jcr:content/metadata/cq:tags] like &apos;stockphotography:business&apos;
  union select [jcr:path], [jcr:score], *
  from [dam:Asset] as a
  where [jcr:content/metadata/cq:tags] = &apos;abc&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;So both are now union queries, and can use an index on &quot;cq:tags&quot;. The first query only has two union queries, not three, because the converter detects the property is the same, and the SQL-2 parser will convert that to &lt;span class=&quot;error&quot;&gt;&amp;#91;jcr:content/metadata/cq:tags&amp;#93;&lt;/span&gt; in (&apos;abc&apos;, &apos;abc&apos;). For the second case this is not detected, but that shouldn&apos;t matter much.&lt;/p&gt;

&lt;p&gt;As for the jcr:like: you are not actually using a search pattern with wildcards, why do you use &quot;jcr:like&quot; and not simply &quot;=&quot; ? Please note when using jcr:like, the property index on &quot;cq:tags&quot; can not be used, and a traversal would be needed, which is very slow.&lt;/p&gt;</comment>
                            <comment id="13908040" author="maurya" created="Fri, 21 Feb 2014 06:48:43 +0000"  >&lt;p&gt;Right, SQL-2 conversion seems fine now. My only concern was both queries should give same results. Will check with the latest oak-core version and update. Thanks&lt;/p&gt;</comment>
                            <comment id="13914258" author="alex.parvulescu" created="Thu, 27 Feb 2014 09:28:46 +0000"  >&lt;p&gt;bulk close for the 0.17.1 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>372741</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 38 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1s8in:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>373045</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>