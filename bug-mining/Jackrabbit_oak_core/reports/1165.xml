<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:47:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2603] Failure in one of the batch in VersionGC might lead to orphaned nodes</title>
                <link>https://issues.apache.org/jira/browse/OAK-2603</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;VersionGC logic currently performs deletion of nodes in batches. For GC to work properly NodeDocument should always be removed in bottom-up mode i.e. parent node should be removed &lt;b&gt;after&lt;/b&gt; child has been removed&lt;/p&gt;

&lt;p&gt;Currently the GC logic deletes the NodeDocument in undefined order. In such mode if one of the batch fails then its possible that parent might have got deleted but the child was not deleted. &lt;/p&gt;

&lt;p&gt;Now in next run the child node would not be recognized as a deleted node because the commit root would not be found.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12780818">OAK-2603</key>
            <summary>Failure in one of the batch in VersionGC might lead to orphaned nodes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chetanm">Chetan Mehrotra</assignee>
                                    <reporter username="chetanm">Chetan Mehrotra</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Mar 2015 12:04:14 +0000</created>
                <updated>Mon, 20 Apr 2015 13:45:13 +0000</updated>
                            <resolved>Wed, 11 Mar 2015 10:43:42 +0000</resolved>
                                                    <fixVersion>1.0.13</fixVersion>
                    <fixVersion>1.1.8</fixVersion>
                                    <component>mongomk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14356278" author="chetanm" created="Wed, 11 Mar 2015 04:35:57 +0000"  >&lt;p&gt;Fixed the issue by sorting the list before passing to &lt;tt&gt;DocumentStore&lt;/tt&gt; for deletion. This ensures that child get deleted before parent&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk - &lt;a href=&quot;http://svn.apache.org/r1665758&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1665758&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;1.0 - &lt;a href=&quot;http://svn.apache.org/r1665759&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1665759&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14356411" author="chetanm" created="Wed, 11 Mar 2015 06:57:46 +0000"  >&lt;p&gt;Reopening as the fix used incorrect comparator i.e. using PathComparator for Ids&lt;/p&gt;</comment>
                            <comment id="14356427" author="chetanm" created="Wed, 11 Mar 2015 07:25:35 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12703859/12703859_OAK-2603.patch&quot; title=&quot;OAK-2603.patch attached to OAK-2603&quot;&gt;patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; which &lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;initially collects the paths to be deleted&lt;/li&gt;
	&lt;li&gt;Sort using PathComparator&lt;/li&gt;
	&lt;li&gt;Uses a PATH_TO_ID transformation before passing the paths to DocumentStore (which works with ids) for removal&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt; Can you review. Initially I thought to implement a ID Comparator on line of PathComparator. However was not sure about id&apos;s based on long path. It might have still worked because sort first on depth would ensure that parent end up last in the list.&lt;/p&gt;</comment>
                            <comment id="14356453" author="mreutegg" created="Wed, 11 Mar 2015 07:55:48 +0000"  >&lt;p&gt;I like the approach with the PathComparator better. This way we don&apos;t have to introduce yet another comparator.&lt;/p&gt;

&lt;p&gt;I noticed one minor thing: the debug message mentions ids, but now passes paths. We should either change the message or transform the paths to ids.&lt;/p&gt;

&lt;p&gt;I was also wondering if the partitioning is necessary because we already do that in the MongoDocumentStore.remove().&lt;/p&gt;</comment>
                            <comment id="14356456" author="chetanm" created="Wed, 11 Mar 2015 07:59:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;I noticed one minor thing: the debug message mentions ids, but now passes paths. We should either change the message or transform the paths to ids.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ack&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I was also wondering if the partitioning is necessary because we already do that in the MongoDocumentStore.remove().&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The problem is that remove takes a list and not iterator currently. Creating a complete new list post transformation would have doubled the storage cost. So used current approach. This would also be later required for fix done for &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2557&quot; title=&quot;VersionGC uses way too much memory if there is a large pile of garbage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2557&quot;&gt;&lt;del&gt;OAK-2557&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14356701" author="chetanm" created="Wed, 11 Mar 2015 10:43:42 +0000"  >&lt;p&gt;After looking further I realized that having a dedicated &lt;tt&gt;NodeDocumentIdComparator&lt;/tt&gt; would be better and it would perform better for large list sorting so added a comparator and used that to sort in VersionGC in &lt;a href=&quot;http://svn.apache.org/r1665835&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1665835&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14502814" author="edivad" created="Mon, 20 Apr 2015 13:45:13 +0000"  >&lt;p&gt;Bulk close for 1.0.13&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12778275">OAK-2557</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12703859" name="OAK-2603.patch" size="4638" author="chetanm" created="Wed, 11 Mar 2015 07:25:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i26ko7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>