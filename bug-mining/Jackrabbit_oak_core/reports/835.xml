<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:43:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1684] Non-blocking reindexing doesn&apos;t save the initial checkpoint</title>
                <link>https://issues.apache.org/jira/browse/OAK-1684</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Following &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1456&quot; title=&quot;Non-blocking reindexing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1456&quot;&gt;&lt;del&gt;OAK-1456&lt;/del&gt;&lt;/a&gt;, I&apos;ve enabled the async reindex background thread,  which introduced a performance issue where the async reindexer will perform a full diff each time if there are never any changes to be processed.&lt;/p&gt;

&lt;p&gt;This happens because the state update happens only when there are relevant changes for the index, so if there are never any relevant changes, the state will never be saved.&lt;/p&gt;

&lt;p&gt;The issue also affects the async full-text index (lucene) because it will not save the checkpoint of the last seen state, it will only save a checkpoint of the last relevant state, so in the case there are no changes, the diff will grow bigger and bigger.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12706915">OAK-1684</key>
            <summary>Non-blocking reindexing doesn&apos;t save the initial checkpoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stillalex">Alex Deparvu</assignee>
                                    <reporter username="stillalex">Alex Deparvu</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Apr 2014 10:00:20 +0000</created>
                <updated>Wed, 4 Jun 2014 10:16:44 +0000</updated>
                            <resolved>Mon, 14 Apr 2014 09:01:19 +0000</resolved>
                                    <version>0.20</version>
                                    <fixVersion>1.0</fixVersion>
                                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13961760" author="alex.parvulescu" created="Mon, 7 Apr 2014 10:02:18 +0000"  >&lt;p&gt;The simple fix is to save the checkpoint on each run, even if there are no changes, but that may interfere with the existing optimization built around the &lt;em&gt;AsyncUpdateCallback&lt;/em&gt;.&lt;/p&gt;</comment>
                            <comment id="13961837" author="alex.parvulescu" created="Mon, 7 Apr 2014 13:28:11 +0000"  >&lt;p&gt;I have temporarily disabled the extra thread with rev &lt;a href=&quot;http://svn.apache.org/r1585476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1585476&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13962187" author="alex.parvulescu" created="Mon, 7 Apr 2014 19:53:15 +0000"  >&lt;p&gt;attaching proposed patch to move the property index async reindex to a dedicated mbean to be triggered on demand via jmx.&lt;/p&gt;

&lt;p&gt;I had to tweak the stats a bit too: I decoupled the jmx stats from the content persisted stats to allow them to be updated even in the case where there are no content updates.&lt;/p&gt;</comment>
                            <comment id="13962682" author="mduerig" created="Tue, 8 Apr 2014 08:00:03 +0000"  >&lt;p&gt;Patch looks good to me +1. As one minor point the Javadoc of &lt;tt&gt;PropertyIndexAsyncReindex#PropertyIndexAsyncReindex&lt;/tt&gt; needs updating. &lt;/p&gt;</comment>
                            <comment id="13962688" author="mduerig" created="Tue, 8 Apr 2014 08:03:29 +0000"  >&lt;p&gt;Regrading the repeated diffs against a missing node in the case where there are no content changes and there is no checkpoint yet. Couldn&apos;t we do something along the lines of&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (before == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+            async.setProperty(name, checkpoint);
             before = MISSING_NODE;
         }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;?&lt;/p&gt;</comment>
                            <comment id="13962690" author="alex.parvulescu" created="Tue, 8 Apr 2014 08:09:53 +0000"  >&lt;p&gt;It won&apos;t fix much because there is no guarantee that we&apos;ll merge the changes back into the main branch. Store#merge (line 174) only happens when there are some changes that are indexed (callback.dirty flag is raised).&lt;/p&gt;</comment>
                            <comment id="13962819" author="alex.parvulescu" created="Tue, 8 Apr 2014 12:32:10 +0000"  >&lt;p&gt;fixed with &lt;a href=&quot;http://svn.apache.org/r1585680&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1585680&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13965294" author="alex.parvulescu" created="Thu, 10 Apr 2014 12:48:55 +0000"  >&lt;p&gt;merged to 1.0 branch in rev 1586284&lt;/p&gt;</comment>
                            <comment id="13968060" author="jukkaz" created="Mon, 14 Apr 2014 04:15:30 +0000"  >&lt;p&gt;I notice that the (temporary?) r1585476 is not merged to the 1.0 branch. Was the intention to keep that change (in which case it probably should be merged) or drop it (in which case it should be reverted in trunk)?&lt;/p&gt;

&lt;p&gt;Reopening to make sure we remember to check this before 1.0.&lt;/p&gt;</comment>
                            <comment id="13968179" author="alex.parvulescu" created="Mon, 14 Apr 2014 09:01:19 +0000"  >&lt;p&gt;good find, thanks!&lt;br/&gt;
I had some merge errors and managed to mess up the merge in the end by applying both changes.&lt;/p&gt;</comment>
                            <comment id="14017558" author="alex.parvulescu" created="Wed, 4 Jun 2014 10:16:44 +0000"  >&lt;p&gt;bulk close for the 1.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12639050" name="OAK-1684.patch" size="17687" author="stillalex" created="Mon, 7 Apr 2014 19:53:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385238</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 24 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ud7j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385505</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>