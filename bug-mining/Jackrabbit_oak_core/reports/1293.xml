<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:48:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-3079] LastRevRecoveryAgent can update _lastRev of children but not the root</title>
                <link>https://issues.apache.org/jira/browse/OAK-3079</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;As mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2131?focusedCommentId=14616391&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14616391&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;OAK-2131&lt;/a&gt; there can be a situation wherein the LastRevRecoveryAgent updates some nodes in the tree but not the root. This seems to happen due to &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2131&quot; title=&quot;Reduce usage of _lastRev&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2131&quot;&gt;&lt;del&gt;OAK-2131&lt;/del&gt;&lt;/a&gt;&apos;s change in the Commit.applyToCache (where paths to update are collected via tracker.track): in that code, paths which are non-root and for which no content has changed (and mind you, a content change includes adding _deleted, which happens by default for nodes with children) are not &apos;tracked&apos;, ie for those the _lastRev is not update by subsequent backgroundUpdate operations - leaving them &apos;old/out-of-date&apos;. This seems correct as per description/intention of &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2131&quot; title=&quot;Reduce usage of _lastRev&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2131&quot;&gt;&lt;del&gt;OAK-2131&lt;/del&gt;&lt;/a&gt; where the last revision can be determined via the commitRoot of the parent. But it has the effect that the LastRevRecoveryAgent then finds those intermittent nodes to be updated while as the root has already been updated (which is at first glance non-intuitive).&lt;/p&gt;

&lt;p&gt;I&apos;ll attach a test case to reproduce this.&lt;/p&gt;

&lt;p&gt;Perhaps this is a bug, perhaps it&apos;s ok. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt; wdyt?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12843210">OAK-3079</key>
            <summary>LastRevRecoveryAgent can update _lastRev of children but not the root</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="stefanegli">Stefan Egli</reporter>
                        <labels>
                            <label>resilience</label>
                    </labels>
                <created>Tue, 7 Jul 2015 15:01:49 +0000</created>
                <updated>Mon, 19 Dec 2016 21:44:33 +0000</updated>
                            <resolved>Thu, 27 Aug 2015 09:07:19 +0000</resolved>
                                    <version>1.2</version>
                    <version>1.3.2</version>
                                    <fixVersion>1.2.17</fixVersion>
                    <fixVersion>1.3.5</fixVersion>
                    <fixVersion>1.4</fixVersion>
                                    <component>core</component>
                    <component>mongomk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14616821" author="egli" created="Tue, 7 Jul 2015 15:04:09 +0000"  >&lt;p&gt;Attached &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12743971/12743971_NonRootUpdatingLastRevRecoveryTest.java&quot; title=&quot;NonRootUpdatingLastRevRecoveryTest.java attached to OAK-3079&quot;&gt;NonRootUpdatingLastRevRecoveryTest.java&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; which illustrates what was described in the ticket. Note that the test succeed - which is why I derive that this is not a bug. The test produces log info of the following kind:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;17:03:28.848 INFO  [main] LastRevRecoveryAgent.java:248     Updated lastRev of [6] documents &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; performing lastRev recovery &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; cluster node [1]: {/foo/bar/5/6=r14e690b0947-0-1, /foo/bar/5=r14e690b0947-0-1, /foo/bar/1/2=r14e690b0940-0-1, /foo/bar/1=r14e690b0940-0-1, /foo/bar/1/2/3=r14e690b0940-0-1, /foo/bar/5/6/7=r14e690b0947-0-1}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which shows that root was not updated .. to see this, enable logback-test.xml console logger.&lt;/p&gt;</comment>
                            <comment id="14711396" author="mreutegg" created="Tue, 25 Aug 2015 14:56:32 +0000"  >&lt;p&gt;This is indeed a bug. The recovery set _lastRev entries on documents where none is needed. However, those entries will not do any harm. They just reflect information also contained in the commit information.&lt;/p&gt;</comment>
                            <comment id="14716316" author="mreutegg" created="Thu, 27 Aug 2015 09:04:15 +0000"  >&lt;p&gt;There are two issues with the current LastRevRecoverAgent implementation:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;when it loops over the suspect documents, it does not keep track of _lastRev implied by explicit modification on the document&lt;/li&gt;
	&lt;li&gt;determineLastModification() also considers commitRoot and revisions entries without local modification&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14716321" author="mreutegg" created="Thu, 27 Aug 2015 09:07:19 +0000"  >&lt;p&gt;Fixed in trunk: &lt;a href=&quot;http://svn.apache.org/r1698096&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1698096&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I didn&apos;t included the attached test but created a simpler test to reproduce the problem.&lt;/p&gt;</comment>
                            <comment id="14730792" author="edivad" created="Fri, 4 Sep 2015 13:10:37 +0000"  >&lt;p&gt;Bulk close for 1.3.5&lt;/p&gt;</comment>
                            <comment id="15361128" author="mreutegg" created="Mon, 4 Jul 2016 10:12:13 +0000"  >&lt;p&gt;Merged into 1.2 branch: &lt;a href=&quot;http://svn.apache.org/r1751238&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1751238&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15361131" author="mreutegg" created="Mon, 4 Jul 2016 10:16:22 +0000"  >&lt;p&gt;Partially merged into 1.0 branch with: &lt;a href=&quot;http://svn.apache.org/r1751239&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1751239&lt;/a&gt; (test only). This issue does not affect 1.0 branch, hence no fix is needed there.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12743958">OAK-2131</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13029268">OAK-5337</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12859572">OAK-3305</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12743971" name="NonRootUpdatingLastRevRecoveryTest.java" size="11617" author="stefanegli" created="Tue, 7 Jul 2015 15:04:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>OAK-3270</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 19 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gxxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>