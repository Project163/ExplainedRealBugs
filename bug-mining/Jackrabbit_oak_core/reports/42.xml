<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:34:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-225] Sling I18N queries not supported by Oak</title>
                <link>https://issues.apache.org/jira/browse/OAK-225</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;The Sling I18N component issues XPath queries like the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;//element(*,mix:language)[fn:lower-case(@jcr:language)=&apos;en&apos;]//element(*,sling:Message)[@sling:message]/(@sling:key|@sling:message)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Such queries currently fail with the following exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;javax.jcr.query.InvalidQueryException: java.text.ParseException: Query: //element(*,mix:language)[fn:lower-(*)case(@jcr:language)=&apos;en&apos;]//element(*,sling:Message)[@sling:message]/(@sling:key|@sling:message); expected: (
        at org.apache.jackrabbit.oak.jcr.query.QueryManagerImpl.executeQuery(QueryManagerImpl.java:115)
        at org.apache.jackrabbit.oak.jcr.query.QueryImpl.execute(QueryImpl.java:85)
        at org.apache.sling.jcr.resource.JcrResourceUtil.query(JcrResourceUtil.java:52)
        at org.apache.sling.jcr.resource.internal.helper.jcr.JcrResourceProvider.queryResources(JcrResourceProvider.java:262)
        ... 54 more
Caused by: java.text.ParseException: Query: //element(*,mix:language)[fn:lower-(*)case(@jcr:language)=&apos;en&apos;]//element(*,sling:Message)[@sling:message]/(@sling:key|@sling:message); expected: (
        at org.apache.jackrabbit.oak.query.XPathToSQL2Converter.getSyntaxError(XPathToSQL2Converter.java:704)
        at org.apache.jackrabbit.oak.query.XPathToSQL2Converter.read(XPathToSQL2Converter.java:410)
        at org.apache.jackrabbit.oak.query.XPathToSQL2Converter.parseExpression(XPathToSQL2Converter.java:336)
        at org.apache.jackrabbit.oak.query.XPathToSQL2Converter.parseCondition(XPathToSQL2Converter.java:279)
        at org.apache.jackrabbit.oak.query.XPathToSQL2Converter.parseAnd(XPathToSQL2Converter.java:252)
        at org.apache.jackrabbit.oak.query.XPathToSQL2Converter.parseConstraint(XPathToSQL2Converter.java:244)
        at org.apache.jackrabbit.oak.query.XPathToSQL2Converter.convert(XPathToSQL2Converter.java:153)
        at org.apache.jackrabbit.oak.query.QueryEngineImpl.parseQuery(QueryEngineImpl.java:86)
        at org.apache.jackrabbit.oak.query.QueryEngineImpl.executeQuery(QueryEngineImpl.java:99)
        at org.apache.jackrabbit.oak.query.QueryEngineImpl.executeQuery(QueryEngineImpl.java:39)
        at org.apache.jackrabbit.oak.jcr.query.QueryManagerImpl.executeQuery(QueryManagerImpl.java:110)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12601231">OAK-225</key>
            <summary>Sling I18N queries not supported by Oak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomasm">Thomas Mueller</assignee>
                                    <reporter username="jukkaz">Jukka Zitting</reporter>
                        <labels>
                            <label>sling</label>
                            <label>xpath</label>
                    </labels>
                <created>Thu, 2 Aug 2012 15:22:25 +0000</created>
                <updated>Mon, 6 May 2013 15:49:20 +0000</updated>
                            <resolved>Mon, 10 Dec 2012 14:53:00 +0000</resolved>
                                    <version>0.3</version>
                                    <fixVersion>0.6</fixVersion>
                                    <component>core</component>
                    <component>query</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13430992" author="tmueller" created="Wed, 8 Aug 2012 09:59:57 +0000"  >&lt;p&gt;In revision 1370294 the query is converted to a SQL-2 query, so executing the query no longer fails. However the conversion is not correct (as far as I know):&lt;/p&gt;

&lt;p&gt;    //element(*,mix:language)&lt;span class=&quot;error&quot;&gt;&amp;#91;fn:lower-case(@jcr:language)=&amp;#39;en&amp;#39;&amp;#93;&lt;/span&gt;&lt;br/&gt;
    //element(*,sling:Message)&lt;span class=&quot;error&quot;&gt;&amp;#91;@sling:message&amp;#93;&lt;/span&gt;&lt;br/&gt;
    /(@sling:key|@sling:message)&lt;/p&gt;

&lt;p&gt;is currently converted to:&lt;/p&gt;

&lt;p&gt;    select &lt;span class=&quot;error&quot;&gt;&amp;#91;jcr:path&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;jcr:score&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;sling:key&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;sling:message&amp;#93;&lt;/span&gt; &lt;br/&gt;
    from &lt;span class=&quot;error&quot;&gt;&amp;#91;sling:Message&amp;#93;&lt;/span&gt; &lt;br/&gt;
    where (lower(&lt;span class=&quot;error&quot;&gt;&amp;#91;jcr:language&amp;#93;&lt;/span&gt;) = &apos;en&apos;) &lt;br/&gt;
    and (&lt;span class=&quot;error&quot;&gt;&amp;#91;sling:message&amp;#93;&lt;/span&gt; is not null)&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if it&apos;s worth the effort to support such XPath queries.&lt;/p&gt;</comment>
                            <comment id="13431082" author="alexander.klimetschek" created="Wed, 8 Aug 2012 12:29:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m not sure if it&apos;s worth the effort to support such XPath queries.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The point is to specify a property matching on a higher level (jcr:language + mix:language) and in the tree below that get only certain nodes (sling:Message). While I could imagine that for the sling use case this could be modified (i.e. first search for matching jcr:language nodes, then traverse the tree below to fetch sling:Message nodes via the JCR API), I think this use case is very normal in a hierarchical content structure.&lt;/p&gt;

&lt;p&gt;Personally, I would love if Oak would give more love (and improvements over the JCR 1.0 spec state) to Xpath as the main search language than SQL, as SQL is really awkward with tree structures.&lt;/p&gt;</comment>
                            <comment id="13431085" author="alex.parvulescu" created="Wed, 8 Aug 2012 12:34:29 +0000"  >&lt;p&gt;I&apos;ve also replied to the commit in the mail &lt;a href=&quot;http://markmail.org/message/wbe4viu7zclsk7dk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/message/wbe4viu7zclsk7dk&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;&amp;gt; I&apos;m not sure if it&apos;s worth the effort to support such XPath queries. &lt;br/&gt;
I don&apos;t fully agree with this. We should support it properly (generate an equivalent query, even if it&apos;s possible that is suboptimal) or not at all. &lt;/p&gt;

&lt;p&gt;Having a half way translation is misleading especially when there is no clear indication of what is going on (the engine translating between the query languages).&lt;/p&gt;</comment>
                            <comment id="13431099" author="tmueller" created="Wed, 8 Aug 2012 13:05:07 +0000"  >&lt;p&gt;I tried to add the comment on &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-225&quot; title=&quot;Sling I18N queries not supported by Oak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-225&quot;&gt;&lt;del&gt;OAK-225&lt;/del&gt;&lt;/a&gt; yesterday, but Jira was not working properly. It seems even today it sometimes doesn&apos;t work, let&apos;s see.&lt;/p&gt;

&lt;p&gt;The fix I did so far was to support &quot;fn:lower-case&quot;. This wasn&apos;t supported before (even for very very simple queries).&lt;/p&gt;

&lt;p&gt;The query is not converted correctly, I know, and this needs to be either fixed or it has to fail (throw an exception). &lt;/p&gt;

&lt;p&gt;For XPath queries of this form, a join would be needed I believe. I didn&apos;t look into that so far, I&apos;m not sure how easy it is to support it (all I know is that it&apos;s not trivial). I guess it&apos;s not just a question on whether we &apos;want&apos; to support it (I want &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; but also if it&apos;s worth the effort, and this I&apos;m not convinced yet. It sounds like, as a short term solution, it would be relatively easy to change the query in Sling, but in the long term I guess it would be better to support such queries.&lt;/p&gt;</comment>
                            <comment id="13431133" author="tmueller" created="Wed, 8 Aug 2012 14:26:30 +0000"  >&lt;p&gt;Let me rephrase it: I&apos;m not convinced it&apos;s worth to support such queries &lt;b&gt;right now&lt;/b&gt; (in the near term). If there are many such queries, then yes, if it&apos;s the only one, I would rather postpone support until the end of the year, and make such queries throw an exception currently.&lt;/p&gt;</comment>
                            <comment id="13431687" author="fmeschbe" created="Thu, 9 Aug 2012 09:06:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;it would be relatively easy to change the query in Sling&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You are of course welcome to raise an issue in Sling proposing a different Query, which (a) requires no to minial code changes and (b) works on both Jackrabit 2 and Oak. Thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13527967" author="tmueller" created="Mon, 10 Dec 2012 14:51:34 +0000"  >&lt;p&gt;The query&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;//element(*,mix:language)[fn:lower-&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;(@jcr:language)=&lt;span class=&quot;code-quote&quot;&gt;&apos;en&apos;&lt;/span&gt;]
&lt;/span&gt;  &lt;span class=&quot;code-comment&quot;&gt;//element(*,sling:Message)[@sling:message]
&lt;/span&gt;  /(@sling:key|@sling:message)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;is now converted to the SQL-2 query&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;select
    b.[jcr:path] as [jcr:path], 
    b.[jcr:score] as [jcr:score], 
    b.[sling:key] as [sling:key], 
    b.[sling:message] as [sling:message] 
from [mix:language] as a 
    &lt;span class=&quot;code-keyword&quot;&gt;inner&lt;/span&gt; join [sling:Message] as b 
    on isdescendantnode(b, a) 
where lower(a.[jcr:language]) = &lt;span class=&quot;code-quote&quot;&gt;&apos;en&apos;&lt;/span&gt; 
    and b.[sling:message] is not &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>296753</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 49 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14h33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234231</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>