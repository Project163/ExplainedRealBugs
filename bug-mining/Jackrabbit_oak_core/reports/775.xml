<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:43:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1465] performance degradation with growing index size on Oak-Mongo</title>
                <link>https://issues.apache.org/jira/browse/OAK-1465</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Tested with an oak-snapshot of Monday Feb 24, 10AM EST.&lt;/p&gt;

&lt;p&gt;Noticed that when the amount of nodes indexed - eg wrt a particular property - the adding of nodes becomes slower and slower.&lt;/p&gt;

&lt;p&gt;Will attach a oak-run benchmark to underline this. Basically the scenario where this occurred was:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;have a number of &quot;level 1&quot; nodes (eg 100)&lt;/li&gt;
	&lt;li&gt;under those &quot;level 1&quot; nodes, add a growing list of children, each with a property that is indexed (ie that index is actually growing and is probably causing the slowdown).&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12696930">OAK-1465</key>
            <summary>performance degradation with growing index size on Oak-Mongo</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="stefanegli">Stefan Egli</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Feb 2014 14:55:10 +0000</created>
                <updated>Tue, 8 Apr 2014 12:47:18 +0000</updated>
                            <resolved>Thu, 27 Mar 2014 10:51:48 +0000</resolved>
                                    <version>0.17</version>
                                    <fixVersion>0.20</fixVersion>
                                    <component>mongomk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13910373" author="egli" created="Mon, 24 Feb 2014 15:00:45 +0000"  >&lt;p&gt;Attached the CreateManyIndexedNodesTest which when run as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-Xmx2048m -Dwarmup=10 -Druntime=20
--concurrency 1,1,1,1,1,1,1,1,1,1 CreateManyIndexedNodesTest Oak-Mongo
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;yields the following degradation on my box:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;# CreateManyIndexedNodesTest       C     min     10%     50%     90%     max       N
Oak-Mongo                          1    1092    1131    1221    1379    1657      17
Oak-Mongo                          1    1252    1269    1362    1471    1530      15
Oak-Mongo                          1    1340    1362    1424    1507    1531      15
Oak-Mongo                          1    1427    1434    1508    5956    7004      11
Oak-Mongo                          1    1551    1554    1649   16383   22377      12
Oak-Mongo                          1    1682    1682    1761    4961    4961       9
Oak-Mongo                          1    1696    1696    1811    4608    4608       9
Oak-Mongo                          1    1881    1881    1918   37519   37519       3
Oak-Mongo                          1   28782   28782   28782   28782   28782       1
Oak-Mongo                          1   25750   25750   25750   25750   25750       1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13910559" author="egli" created="Mon, 24 Feb 2014 17:37:23 +0000"  >&lt;p&gt;Test ran against 0.17-SNAPSHOT - and thus likely against mongoMK, not mongoNS - since rerunning on 0.18-SNAPSHOT yields much nicer numbers and less degradation. Closing this one until I get a clear testcase showing the same effect with the latest oak snapshot.&lt;/p&gt;</comment>
                            <comment id="13910603" author="egli" created="Mon, 24 Feb 2014 18:21:08 +0000"  >&lt;p&gt;reopening &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
this degradation is there also in 0.18-snapshot (double-checked..) - but with much better overall figured, and slightly less dramatic:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;# CreateManyIndexedNodesTest       C     min     10%     50%     90%     max       N
Oak-Mongo                          1     104     129     156     234     512     117
Oak-Mongo                          1     107     130     163     224     277     119
Oak-Mongo                          1     118     132     166     254     694     108
Oak-Mongo                          1     118     146     178     247     961     101
Oak-Mongo                          1     122     146     178     244     743     106
Oak-Mongo                          1     125     147     185     242     402     105
Oak-Mongo                          1     146     157     183     256     363     101
Oak-Mongo                          1     140     160     192     249    1402      95
Oak-Mongo                          1     152     163     195     264     545      95
Oak-Mongo                          1     150     167     212    1563    4263      37
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13911444" author="egli" created="Tue, 25 Feb 2014 10:14:50 +0000"  >&lt;p&gt;PS: more iterations, creating more nodes per iteration result in higher degradation. And the degradation also happens if the value of the indexed property remains constant.&lt;/p&gt;</comment>
                            <comment id="13922257" author="alex.parvulescu" created="Thu, 6 Mar 2014 10:17:44 +0000"  >&lt;p&gt;I know this is silly, but I&apos;m going to ask you to run the tests again as I can&apos;t reproduce the degradation on my machine &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&lt;br/&gt;
I did see a quite a big difference between having an index and not having one, but no clear degradation as mentioned in this ticket.&lt;/p&gt;

&lt;p&gt;One thing that happened is the test crashed with an OOME, but that may be just my 32b machine acting out &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I found the errors interesting, maybe this is useful for the other guys:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;this is what you see in the mongo console (sever side?)
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Wed Mar  5 19:32:32 [conn125] ERROR:   mmap() failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /home/alex/ci/oak/mongo/mongo-data/Oak-Mongo-1394044290140.2 len:67108864 errno:12 Cannot allocate memory
Wed Mar  5 19:32:32 [conn125] ERROR: mmap failed with out of memory. You are using a 32-bit build and probably need to upgrade to 64
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;and this is what you see on the application (client side?), warning long stack traces ahead &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Apache Jackrabbit Oak 0.19-SNAPSHOT
# CreateManyIndexedNodesTest       C     min     10%     50%     90%     max       N
Oak-Mongo                          1     128     161     205     291    1732     258
Oak-Mongo                          1     124     168     211     268    1300     268
Oak-Mongo                          1     123     163     210     283    2307     246
Oak-Mongo                          1     110     164     209     285    1392     259
Oak-Mongo                          1     141     168     208     287     675     266
Oak-Mongo                          1     137     169     216     284     713     260
Oak-Mongo                          1     133     159     206     279    2790     245
Oak-Mongo                          1     118     166     208     287     684     265
Oak-Mongo                          1     135     166     212     278    1228     262
Oak-Mongo                          1     133     166     212     287     702     263
Oak-Mongo                          1     138     171     213     280    2161     248
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;Background job org.apache.jackrabbit.oak.benchmark.CreateManyIndexedNodesTest$Writer@13ed2fc&quot;&lt;/span&gt; java.lang.RuntimeException: javax.jcr.RepositoryException: OakMerge0001: OakMerge0001: Failed to merge changes to the underlying store (retries 4, 4719 ms)
	at org.apache.jackrabbit.oak.benchmark.CreateManyIndexedNodesTest$Writer.run(CreateManyIndexedNodesTest.java:93)
	at org.apache.jackrabbit.oak.benchmark.AbstractTest$1.run(AbstractTest.java:430)
Caused by: javax.jcr.RepositoryException: OakMerge0001: OakMerge0001: Failed to merge changes to the underlying store (retries 4, 4719 ms)
	at org.apache.jackrabbit.oak.api.CommitFailedException.asRepositoryException(CommitFailedException.java:247)
	at org.apache.jackrabbit.oak.api.CommitFailedException.asRepositoryException(CommitFailedException.java:212)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.newRepositoryException(SessionDelegate.java:502)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.save(SessionDelegate.java:389)
	at org.apache.jackrabbit.oak.jcr.session.SessionImpl$8.perform(SessionImpl.java:414)
	at org.apache.jackrabbit.oak.jcr.session.SessionImpl$8.perform(SessionImpl.java:411)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.perform(SessionDelegate.java:157)
	at org.apache.jackrabbit.oak.jcr.session.SessionImpl.perform(SessionImpl.java:124)
	at org.apache.jackrabbit.oak.jcr.session.SessionImpl.save(SessionImpl.java:411)
	at org.apache.jackrabbit.oak.benchmark.CreateManyIndexedNodesTest$Writer.run(CreateManyIndexedNodesTest.java:90)
	... 1 more
Caused by: org.apache.jackrabbit.oak.api.CommitFailedException: OakMerge0001: OakMerge0001: Failed to merge changes to the underlying store (retries 4, 4719 ms)
	at org.apache.jackrabbit.oak.spi.state.AbstractNodeStoreBranch.merge(AbstractNodeStoreBranch.java:304)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreBranch.merge(DocumentNodeStoreBranch.java:143)
	at org.apache.jackrabbit.oak.plugins.document.DocumentRootBuilder.merge(DocumentRootBuilder.java:147)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStore.merge(DocumentNodeStore.java:1187)
	at org.apache.jackrabbit.oak.core.MutableRoot.commit(MutableRoot.java:242)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.commit(SessionDelegate.java:245)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.save(SessionDelegate.java:387)
	... 7 more
Caused by: org.apache.jackrabbit.mk.api.MicroKernelException: java.lang.NullPointerException
	at org.apache.jackrabbit.oak.plugins.document.mongo.MongoDocumentStore.findAndModify(MongoDocumentStore.java:428)
	at org.apache.jackrabbit.oak.plugins.document.mongo.MongoDocumentStore.createOrUpdate(MongoDocumentStore.java:440)
	at org.apache.jackrabbit.oak.plugins.document.Commit.rollback(Commit.java:397)
	at org.apache.jackrabbit.oak.plugins.document.Commit.applyToDocumentStore(Commit.java:345)
	at org.apache.jackrabbit.oak.plugins.document.Commit.applyToDocumentStore(Commit.java:203)
	at org.apache.jackrabbit.oak.plugins.document.Commit.applyInternal(Commit.java:188)
	at org.apache.jackrabbit.oak.plugins.document.Commit.apply(Commit.java:177)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreBranch.persist(DocumentNodeStoreBranch.java:172)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreBranch.persist(DocumentNodeStoreBranch.java:85)
	at org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreBranch.persist(DocumentNodeStoreBranch.java:36)
	at org.apache.jackrabbit.oak.spi.state.AbstractNodeStoreBranch$InMemory.merge(AbstractNodeStoreBranch.java:487)
	at org.apache.jackrabbit.oak.spi.state.AbstractNodeStoreBranch.merge(AbstractNodeStoreBranch.java:288)
	... 13 more
Caused by: java.lang.NullPointerException
	at com.google.common.base.Preconditions.checkNotNull(Preconditions.java:192)
	at org.apache.jackrabbit.oak.plugins.document.util.StringValue.&amp;lt;init&amp;gt;(StringValue.java:35)
	at org.apache.jackrabbit.oak.plugins.document.mongo.MongoDocumentStore.addToCache(MongoDocumentStore.java:753)
	at org.apache.jackrabbit.oak.plugins.document.mongo.MongoDocumentStore.applyToCache(MongoDocumentStore.java:708)
	at org.apache.jackrabbit.oak.plugins.document.mongo.MongoDocumentStore.findAndModify(MongoDocumentStore.java:422)
	... 24 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13922499" author="mreutegg" created="Thu, 6 Mar 2014 13:31:07 +0000"  >&lt;p&gt;Hmm, that&apos;s pretty strange. A MongoDB document always has an _id field. The method DBCollection.findAndModify() should either return the previous document, null or throw an exception...&lt;/p&gt;</comment>
                            <comment id="13922559" author="egli" created="Thu, 6 Mar 2014 14:28:28 +0000"  >&lt;p&gt;I reran the CreateManyIndexedNodesTest on my macbook with the following parameters:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;threadcount = 1 (although did see similar numbers with higher number of threads, eg 10 or 20 threads)&lt;/li&gt;
	&lt;li&gt;nodes per thread = 50&lt;/li&gt;
	&lt;li&gt;parentcount = 100&lt;/li&gt;
	&lt;li&gt;40 loops: --concurrency 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1&lt;/li&gt;
	&lt;li&gt;homebrew-mongoD 2.2.0 on localhost&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I see that:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the benchmark runner is at 100-120% CPU&lt;/li&gt;
	&lt;li&gt;the mongoD is at 30-35% only&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Here&apos;s the result. The initial number of loops (N) is 112, which doesn&apos;t go in a straight line south, but nevertheless, on average, N ends up lower in the 70s range:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;# CreateManyIndexedNodesTest       C     min     10%     50%     90%     max       N
Oak-Mongo                          1     143     159     178     194     428     112
Oak-Mongo                          1     147     157     172     190     411     115
Oak-Mongo                          1     141     152     165     185     450     118
Oak-Mongo                          1     144     151     168     182     230     120
Oak-Mongo                          1     144     155     172     197     972     107
Oak-Mongo                          1     147     160     174     195     211     114
Oak-Mongo                          1     150     162     179     197     704     109
Oak-Mongo                          1     154     166     182     204    2660      79
Oak-Mongo                          1     153     166     181     203    2116      93
Oak-Mongo                          1     161     167     183     200     380     108
Oak-Mongo                          1     164     172     186     204    1586      94
Oak-Mongo                          1     164     175     188     212     459     104
Oak-Mongo                          1     163     176     191     211    1058     100
Oak-Mongo                          1     165     180     193     210    1459      93
Oak-Mongo                          1     165     180     196     222     239     102
Oak-Mongo                          1     171     179     209    1963    2893      35
Oak-Mongo                          1     181     184     209    1483    2764      44
Oak-Mongo                          1     178     184     197     237    2373      88
Oak-Mongo                          1     180     188     200     238     478      96
Oak-Mongo                          1     183     193     207     246     946      89
Oak-Mongo                          1     185     196     209     247    1356      89
Oak-Mongo                          1     192     198     216     240     277      92
Oak-Mongo                          1     195     202     220     251    1133      84
Oak-Mongo                          1     195     200     217     248     278      91
Oak-Mongo                          1     199     207     219     255    1622      83
Oak-Mongo                          1     208     213     228     255     767      84
Oak-Mongo                          1     206     214     230     255     320      87
Oak-Mongo                          1     207     217     245     290    1040      78
Oak-Mongo                          1     210     219     247     297     860      75
Oak-Mongo                          1     212     221     246     284     299      82
Oak-Mongo                          1     207     220     245     298     935      77
Oak-Mongo                          1     217     219     248     300    2502      71
Oak-Mongo                          1     220     228     253     273     281      80
Oak-Mongo                          1     212     224     253     304    1032      75
Oak-Mongo                          1     213     224     250     300    1337      71
Oak-Mongo                          1     218     227     254     292     397      79
Oak-Mongo                          1     217     232     255     286     641      77
Oak-Mongo                          1     225     231     257     299    1571      72
Oak-Mongo                          1     229     234     258     284     309      78
Oak-Mongo                          1     228     235     260     296     461      76
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13922560" author="egli" created="Thu, 6 Mar 2014 14:30:15 +0000"  >&lt;p&gt;PS: That would have created env 40 * 4250 = 170,000 nodes (spread over 100 parents, ie 1,700 per parent node)&lt;/p&gt;</comment>
                            <comment id="13923851" author="egli" created="Fri, 7 Mar 2014 12:41:21 +0000"  >&lt;p&gt;Marking as blocker as this becomes more and more obvious when doing cluster scalability measurements&lt;/p&gt;</comment>
                            <comment id="13923855" author="egli" created="Fri, 7 Mar 2014 12:53:09 +0000"  >&lt;p&gt;Note that the cluster scalability measurements I did might also slow down to a combination of things - not only this index issue - maybe this is something more generic in the sense that large number of nodes degrade .. I&apos;ll update this when I find more evidence&lt;/p&gt;</comment>
                            <comment id="13923870" author="alex.parvulescu" created="Fri, 7 Mar 2014 13:22:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;not only this index issue - maybe this is something more generic in the sense that large number of nodes degrade &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Could you possibly compare degradation without the indexing enabled? I know that one to one the inserts will be faster, so you&apos;ll see higher numbers, but it would be interesting to see the degradation too.&lt;/p&gt;</comment>
                            <comment id="13930653" author="mreutegg" created="Tue, 11 Mar 2014 17:55:00 +0000"  >&lt;p&gt;The degradation may also be caused by a growing root document. Right now the root document keeps a list of previous documents, which contain old data of the document. There&apos;s an open issue to turn that list into a tree structure: &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1342&quot; title=&quot;Cascading document history&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1342&quot;&gt;&lt;del&gt;OAK-1342&lt;/del&gt;&lt;/a&gt;. This will keep the size of the root document stable.&lt;/p&gt;</comment>
                            <comment id="13931613" author="alex.parvulescu" created="Wed, 12 Mar 2014 10:23:40 +0000"  >&lt;p&gt;This is how the property index updates look like &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; each save operation triggers 2 index updates (&lt;em&gt;before&lt;/em&gt; and &lt;em&gt;after&lt;/em&gt; are the index keys):&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;one node type (oak:Unstructured)&lt;/li&gt;
	&lt;li&gt;one property type. (here the property has the same value as the node name)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;My profiling session shows a lot of cache misses on the DocumentNodeStore#getNode, and given the high frequency of small commits I don&apos;t see any code tweaks that I could do to speed up this test.&lt;/p&gt;

&lt;p&gt;It would be interesting to add some sort of output of the cache stats after the tests, I wanted to at least see them, but I found it ridiculously hard to get a reference to that stats object.&lt;/p&gt;

&lt;p&gt;I&apos;m un-assigning myself from this issue, but I&apos;m still open to any ideas of improvement, so feel free to point to anything I might have missed in the indexing code.&lt;/p&gt;

&lt;p&gt;A small thing I&apos;ve noticed is that the NodeBuilder#getChildNodeNames in the case of the DocumentNodeState is using the default AbstractNodeState impl which is simply calling #getChildNodeEntries and then extracting the names. I did not see heavy usage of this method (I ran into it in the IndexUpdate#collectIndexEditors method), so I don&apos;t think very important to provide a more efficient implementation.&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;update on /test19b6d919/testNode/level1_49/217f0ea5-190c-4c56-8b7d-c4b180c670a1
    before []
    after  [217f0ea5-190c-4c56-8b7d-c4b180c670a1]
update on /test19b6d919/testNode/level1_49/217f0ea5-190c-4c56-8b7d-c4b180c670a1
    before []
    after  [oak%3AUnstructured]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13931621" author="alex.parvulescu" created="Wed, 12 Mar 2014 10:29:53 +0000"  >&lt;p&gt;Assigning to Marcel, please assign to somebody else if I you are not the right candidate.&lt;/p&gt;</comment>
                            <comment id="13944984" author="mreutegg" created="Mon, 24 Mar 2014 13:00:10 +0000"  >&lt;p&gt;I ran Stefan&apos;s test on my machine and I see a very steep increase in max time to execute a test loop. The time is roughly equal to the time it takes mongodb to flush the mmap files. It does it once every minute, which means each test iteration sees one flush event. Over time the flush takes up to 20 seconds on my machine. MongoDB was running on a regular hard disk drive. I will re-run the test on an SSD...&lt;/p&gt;</comment>
                            <comment id="13945121" author="mreutegg" created="Mon, 24 Mar 2014 14:02:24 +0000"  >&lt;p&gt;The test run on the SSD (although already 4 years old), shows a similar behavior. After a while the MongoDB mmap flushing affects the test, but it seems to settle at roughly 18 seconds per flush. I&apos;ll have to run a longer test to see if it goes further up.&lt;/p&gt;

&lt;p&gt;I did notice a minor issue in &lt;tt&gt;NodeDocument.getNewestRevision()&lt;/tt&gt; where the cost increases slightly when the revision history gets bigger. Though, the effect of the mmap flushing is much more significant.&lt;/p&gt;</comment>
                            <comment id="13945164" author="mreutegg" created="Mon, 24 Mar 2014 14:35:23 +0000"  >&lt;p&gt;Optimized access to newest deleted value in &lt;a href=&quot;http://svn.apache.org/r1580864&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1580864&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13946304" author="mreutegg" created="Tue, 25 Mar 2014 08:52:07 +0000"  >&lt;p&gt;I re-ran the test on more recent hardware (and different OS) and the flush time is much lower. The slow down is still there and due to &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1342&quot; title=&quot;Cascading document history&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1342&quot;&gt;&lt;del&gt;OAK-1342&lt;/del&gt;&lt;/a&gt;. I will implement &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1342&quot; title=&quot;Cascading document history&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1342&quot;&gt;&lt;del&gt;OAK-1342&lt;/del&gt;&lt;/a&gt; first and then re-run the test.&lt;/p&gt;</comment>
                            <comment id="13949026" author="mreutegg" created="Thu, 27 Mar 2014 08:20:08 +0000"  >&lt;p&gt;With recent changes from &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1342&quot; title=&quot;Cascading document history&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1342&quot;&gt;&lt;del&gt;OAK-1342&lt;/del&gt;&lt;/a&gt; the time to run one test iteration stays quite stable. See attached graph. The max time corresponds mostly to the varying mmap flush time, but more importantly the 90% line is rather flat.&lt;/p&gt;</comment>
                            <comment id="13962838" author="alex.parvulescu" created="Tue, 8 Apr 2014 12:47:18 +0000"  >&lt;p&gt;bulk close for the 0.20.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12689996">OAK-1342</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12630674" name="CreateManyIndexedNodesTest.java" size="3959" author="stefanegli" created="Mon, 24 Feb 2014 15:00:45 +0000"/>
                            <attachment id="12637107" name="image002.png" size="115287" author="mreutegg" created="Thu, 27 Mar 2014 08:20:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>375405</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 32 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1sovr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>375701</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>