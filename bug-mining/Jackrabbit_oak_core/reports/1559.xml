<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:51:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-5055] o.a.j.o.s.s.RevisionGC returns status that don&apos;t comply with the API</title>
                <link>https://issues.apache.org/jira/browse/OAK-5055</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;According to the API &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, the method &lt;tt&gt;RevisionGC#startRevisionGC&lt;/tt&gt; should &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;  the status of the operation right after it was initiated
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;However, it does return &lt;tt&gt;succeeded&lt;/tt&gt; on every call, see &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.&lt;br/&gt;
I believe this should either compute the actual state, or return &lt;tt&gt;initiated&lt;/tt&gt; or &lt;tt&gt;running&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Same applies for &lt;tt&gt;cancelRevisionGC&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&#160;&lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/18d69e6f590064585414f12bda724f48f3d5843f/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/state/RevisionGCMBean.java#L34-L40&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/blob/18d69e6f590064585414f12bda724f48f3d5843f/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/state/RevisionGCMBean.java#L34-L40&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/e873825b92faf14b7ef52130c36e6466edcef6b0/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/state/RevisionGC.java#L105&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/blob/e873825b92faf14b7ef52130c36e6466edcef6b0/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/state/RevisionGC.java#L105&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/e873825b92faf14b7ef52130c36e6466edcef6b0/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/state/RevisionGC.java#L123&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/blob/e873825b92faf14b7ef52130c36e6466edcef6b0/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/state/RevisionGC.java#L123&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13017633">OAK-5055</key>
            <summary>o.a.j.o.s.s.RevisionGC returns status that don&apos;t comply with the API</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marett">Timothee Maret</assignee>
                                    <reporter username="marett">Timothee Maret</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Nov 2016 13:37:13 +0000</created>
                <updated>Mon, 14 Nov 2016 11:35:36 +0000</updated>
                            <resolved>Thu, 3 Nov 2016 16:46:15 +0000</resolved>
                                    <version>1.5.12</version>
                                    <fixVersion>1.5.13</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15632737" author="marett" created="Thu, 3 Nov 2016 13:39:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt; wdyt, should we change the implementation ? If so, shall we opt for &lt;tt&gt;initiated&lt;/tt&gt; or &lt;tt&gt;running&lt;/tt&gt;&#160;?&lt;/p&gt;</comment>
                            <comment id="15632774" author="marett" created="Thu, 3 Nov 2016 13:53:29 +0000"  >&lt;p&gt;Attaching a svn compatible patch.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt; could you have a look ?&lt;/p&gt;</comment>
                            <comment id="15632809" author="mduerig" created="Thu, 3 Nov 2016 14:06:34 +0000"  >&lt;p&gt;Good catch! I think we should change this to &lt;tt&gt;initiated&lt;/tt&gt; to avoid any confusion when a subsequent call to &lt;tt&gt;RevisionGC.getRevisionGCStatus()&lt;/tt&gt; does not (yet) return &lt;tt&gt;RUNNING&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15632956" author="marett" created="Thu, 3 Nov 2016 14:48:51 +0000"  >&lt;p&gt;Attaching a patch returning &lt;tt&gt;initiated&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15632959" author="marett" created="Thu, 3 Nov 2016 14:50:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt; that makes sense. Please see the updated patch&lt;/p&gt;</comment>
                            <comment id="15633211" author="marett" created="Thu, 3 Nov 2016 15:46:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt; Looking deeper into the &lt;tt&gt;RevisionGC&lt;/tt&gt;, it seems there&apos;s another bug. I&apos;ll discuss it here since it is coupled to the current issue.&lt;/p&gt;

&lt;p&gt;Actually returning &lt;tt&gt;initiated&lt;/tt&gt;, &lt;tt&gt;failed&lt;/tt&gt;, etc. is bogus, the operation id does not match the id of the &lt;tt&gt;gcOp&lt;/tt&gt; field in the &lt;tt&gt;RevisionGC&lt;/tt&gt; instance. This is because the operation methods implicitely increment the idGen counter (example at &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;). With the current ManagementOperation code, there seems to be no way to invoke the &lt;tt&gt;initiated&lt;/tt&gt;, &lt;tt&gt;failed&lt;/tt&gt;, etc. methods without messing up the id.&lt;/p&gt;

&lt;p&gt;This could be fixed however, either by &lt;br/&gt;
1. Exposing the &lt;tt&gt;initiated(id,message)&lt;/tt&gt; like methods by making them public ; and changing the &lt;tt&gt;RevisionGC&lt;/tt&gt; to code to invoke those methods&lt;br/&gt;
2. In &lt;tt&gt;RevisionGC&lt;/tt&gt;, return &lt;tt&gt;getRevisionGCStatus()&lt;/tt&gt; in any case instead of &lt;tt&gt;initiated&lt;/tt&gt;, &lt;tt&gt;failed&lt;/tt&gt;, etc.&lt;/p&gt;

&lt;p&gt;wdyt ?&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&#160;&lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/e873825b92faf14b7ef52130c36e6466edcef6b0/oak-core/src/main/java/org/apache/jackrabbit/oak/management/ManagementOperation.java#L279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/blob/e873825b92faf14b7ef52130c36e6466edcef6b0/oak-core/src/main/java/org/apache/jackrabbit/oak/management/ManagementOperation.java#L279&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="15633221" author="mduerig" created="Thu, 3 Nov 2016 15:49:39 +0000"  >&lt;p&gt;Thanks for the patch. Applied at &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1767908&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1767908&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Will have a look at your other comment in a minute. &lt;/p&gt;</comment>
                            <comment id="15633250" author="marett" created="Thu, 3 Nov 2016 15:59:39 +0000"  >&lt;p&gt;Attaching a patch that &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;expose the &lt;tt&gt;initiated(id,message)&lt;/tt&gt; like methods&lt;/li&gt;
	&lt;li&gt;return the &lt;tt&gt;initiated&lt;/tt&gt; status when starting an async action&lt;/li&gt;
	&lt;li&gt;return the same gcOp id except when starting the async action fails (because there already is an action running or because there was none running)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15633290" author="mduerig" created="Thu, 3 Nov 2016 16:14:14 +0000"  >&lt;p&gt;I like this approach. As a small improvement I think we should bass the management operation to e.g. &lt;tt&gt;initiated&lt;/tt&gt; instead of just the id. &lt;/p&gt;

&lt;p&gt;I will rework the patch to that respect and apply. Unless you have objections. &lt;/p&gt;</comment>
                            <comment id="15633330" author="marett" created="Thu, 3 Nov 2016 16:25:34 +0000"  >&lt;p&gt;No objection, thanks for looking at this!&lt;/p&gt;</comment>
                            <comment id="15633397" author="mduerig" created="Thu, 3 Nov 2016 16:46:15 +0000"  >&lt;p&gt;Fixed at &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1767930&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1767930&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marett&quot; class=&quot;user-hover&quot; rel=&quot;marett&quot;&gt;marett&lt;/a&gt; for sending patches. Could you give my cruft a final review please?&lt;/p&gt;</comment>
                            <comment id="15633526" author="marett" created="Thu, 3 Nov 2016 17:19:57 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mduerig&quot; class=&quot;user-hover&quot; rel=&quot;mduerig&quot;&gt;mduerig&lt;/a&gt;! I have looked at the patch and tried in my setup, LGTM.&lt;/p&gt;</comment>
                            <comment id="15663661" author="edivad" created="Mon, 14 Nov 2016 11:35:36 +0000"  >&lt;p&gt;Bulk close for 1.5.13&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12836875" name="OAK-5055.patch" size="3167" author="marett" created="Thu, 3 Nov 2016 15:59:39 +0000"/>
                            <attachment id="12836839" name="OAK-5055.patch" size="1556" author="marett" created="Thu, 3 Nov 2016 14:48:51 +0000"/>
                            <attachment id="12836806" name="OAK-5055.patch" size="1550" author="marett" created="Thu, 3 Nov 2016 13:53:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35sr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>