<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:51:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-5070] Journal diff not working for changes in bundled node</title>
                <link>https://issues.apache.org/jira/browse/OAK-5070</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;For changes in bundled nodes diff is not reporting change in properties of bundled node&lt;/p&gt;</description>
                <environment></environment>
        <key id="13018193">OAK-5070</key>
            <summary>Journal diff not working for changes in bundled node</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chetanm">Chetan Mehrotra</assignee>
                                    <reporter username="chetanm">Chetan Mehrotra</reporter>
                        <labels>
                            <label>bundling</label>
                    </labels>
                <created>Fri, 4 Nov 2016 18:23:37 +0000</created>
                <updated>Mon, 14 Nov 2016 11:35:12 +0000</updated>
                            <resolved>Mon, 7 Nov 2016 15:41:51 +0000</resolved>
                                                    <fixVersion>1.5.13</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>documentmk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15637380" author="chetanm" created="Fri, 4 Nov 2016 19:14:37 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12837232/12837232_OAK-5070-v1.patch&quot; title=&quot;OAK-5070-v1.patch attached to OAK-5070&quot;&gt;patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; for the same&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt; Can you review the patch. Some open points&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;What to do if commitRoot itself is bundled. What should be the depth. Should it be depth of bundling root?&lt;/li&gt;
	&lt;li&gt;How would the diff work when it is not back by journal diff. diffFewChildren and diffManyChildren would need some change&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15643848" author="chetanm" created="Mon, 7 Nov 2016 10:54:31 +0000"  >&lt;p&gt;Discussed with Marcel&lt;/p&gt;

&lt;p&gt;For now disabled the bundling feature by default with r1768496. Once we decide the fix for this issue it would need to be enabled back&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;What to do if commitRoot itself is bundled. What should be the depth. Should it be depth of bundling root?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Commit root should always be a NodeDocument ID. So in case whole commit is part of bundled nodes only then it would be id of the bundling root&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;How would the diff work when it is not back by journal diff. diffFewChildren and diffManyChildren would need some change&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;diffFewChildren (used for upto 50 child nodes) should work fine as it depends on NodeState. However diffManyChildren would pose problem. Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-5079&quot; title=&quot;Diff would not work for bundled nodes when done without journal support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-5079&quot;&gt;&lt;del&gt;OAK-5079&lt;/del&gt;&lt;/a&gt; for that&lt;/p&gt;</comment>
                            <comment id="15643989" author="chetanm" created="Mon, 7 Nov 2016 12:03:42 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12837757/12837757_OAK-5070-v2.patch&quot; title=&quot;OAK-5070-v2.patch attached to OAK-5070&quot;&gt;updated patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Does not modify the commit root&lt;/li&gt;
	&lt;li&gt;Ensures that only non bundled changes are applied to cache&lt;/li&gt;
	&lt;li&gt;Moved out diff entry creation logic from applyChanges&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Technically the way things are setup applyChanges was no op for bundled nodes (with or without modified nodes change). But I have refactored to make it more explicit&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mreutegg&quot; class=&quot;user-hover&quot; rel=&quot;mreutegg&quot;&gt;mreutegg&lt;/a&gt; Please review the updated patch and also impact of bundling on any other logic in Commit&lt;/p&gt;</comment>
                            <comment id="15644126" author="reschke" created="Mon, 7 Nov 2016 13:05:27 +0000"  >&lt;p&gt;But...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;testBundlingEnabledByDefault(org.apache.jackrabbit.oak.run.osgi.DocumentNodeStoreConfigTest)  Time elapsed: 0.401 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
Assertion failed:

assert ns.bundlingConfigHandler.enabled
       |  |                     |
       |  |                     false
       |  org.apache.jackrabbit.oak.plugins.document.bundlor.BundlingConfigHandler@34845b35
       org.apache.jackrabbit.oak.plugins.document.DocumentNodeStore@5d800f82

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15644153" author="mreutegg" created="Mon, 7 Nov 2016 13:14:56 +0000"  >&lt;p&gt;The DocumentBundlingTest has an unused import and I would rather move &lt;tt&gt;addDiffCacheEntry()&lt;/tt&gt; from DocumentNodeStore to Commit. The method does not have any dependency to DocumentNodeStore.&lt;/p&gt;

&lt;p&gt;It also looks like the logic at the end of &lt;tt&gt;Commit.applyToCache()&lt;/tt&gt; can be simplified. That is, group together the cases when &lt;tt&gt;bundled&lt;/tt&gt; is false.&lt;/p&gt;

&lt;p&gt;I&apos;ll update the patch.&lt;/p&gt;</comment>
                            <comment id="15644198" author="mreutegg" created="Mon, 7 Nov 2016 13:37:18 +0000"  >&lt;p&gt;See updated patch v3.&lt;/p&gt;</comment>
                            <comment id="15644514" author="chetanm" created="Mon, 7 Nov 2016 15:41:51 +0000"  >&lt;p&gt;Applied updated patch from Marcel with r1768536&lt;/p&gt;</comment>
                            <comment id="15663620" author="edivad" created="Mon, 14 Nov 2016 11:35:12 +0000"  >&lt;p&gt;Bulk close for 1.5.13&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13018838">OAK-5080</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12688013">OAK-1312</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12837232" name="OAK-5070-v1.patch" size="1528" author="chetanm" created="Fri, 4 Nov 2016 19:14:37 +0000"/>
                            <attachment id="12837757" name="OAK-5070-v2.patch" size="5340" author="chetanm" created="Mon, 7 Nov 2016 12:03:42 +0000"/>
                            <attachment id="12837772" name="OAK-5070-v3.patch" size="7818" author="mreutegg" created="Mon, 7 Nov 2016 13:37:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35w7j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>