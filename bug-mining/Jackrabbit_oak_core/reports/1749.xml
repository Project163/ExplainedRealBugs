<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:53:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-6750] Lucene facets don&apos;t work with relative properties</title>
                <link>https://issues.apache.org/jira/browse/OAK-6750</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;Facets currently work only when faceted dimension is direct property of selected node e.g. &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;select \[jcr:path], \[rep:facet(jc/text)] from \[nt:base] where ... 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;doesn&apos;t work but &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;select \[jcr:path], \[rep:facet(text)] from \[nt:base] where ... 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;works (assume correct index defs).&lt;/p&gt;

&lt;p&gt;The issue is that &lt;tt&gt;ast/SelectorImpl#currentOakProperty&lt;/tt&gt; check if &lt;tt&gt;rep:facet(jc/text)&lt;/tt&gt; is a relative path or not and incorrectly &apos;feels&apos; that it indeed is - it then proceeds ahead to traverse down a tree with elements [&lt;tt&gt;rep:facet(jc&lt;/tt&gt;, &lt;tt&gt;text)&lt;/tt&gt;] which makes no sense.&lt;/p&gt;

&lt;p&gt;/cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=teofili&quot; class=&quot;user-hover&quot; rel=&quot;teofili&quot;&gt;teofili&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tmueller&quot; class=&quot;user-hover&quot; rel=&quot;tmueller&quot;&gt;tmueller&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13106272">OAK-6750</key>
            <summary>Lucene facets don&apos;t work with relative properties</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="catholicon">Vikas Saurabh</assignee>
                                    <reporter username="catholicon">Vikas Saurabh</reporter>
                        <labels>
                    </labels>
                <created>Sun, 1 Oct 2017 03:46:20 +0000</created>
                <updated>Tue, 8 Oct 2019 15:21:09 +0000</updated>
                            <resolved>Sat, 7 Oct 2017 02:45:53 +0000</resolved>
                                                    <fixVersion>1.7.9</fixVersion>
                    <fixVersion>1.6.7</fixVersion>
                    <fixVersion>1.4.19</fixVersion>
                    <fixVersion>1.8.0</fixVersion>
                                    <component>lucene</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16187275" author="catholicon" created="Sun, 1 Oct 2017 04:05:22 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12889876/12889876_OAK-6750-testCase.patch&quot; title=&quot;OAK-6750-testCase.patch attached to OAK-6750&quot;&gt;OAK-6750-testCase.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; has a test case that fails. (Can&apos;t commit as Junit3 doesn&apos;t seem to have @Ignore :-/).&lt;/p&gt;</comment>
                            <comment id="16187386" author="teofili" created="Sun, 1 Oct 2017 13:51:29 +0000"  >&lt;p&gt;it feels strange as I think there was a test for relative properties, however it it fails we need to fix it as I think it&apos;s a valid use case.&lt;/p&gt;</comment>
                            <comment id="16187522" author="catholicon" created="Sun, 1 Oct 2017 20:20:12 +0000"  >&lt;p&gt;btw, a trivial fix can be:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SelectorImpl.java b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SelectorImpl.java
index 87fe1bd7e4..a246756de6 100644
--- a/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SelectorImpl.java
+++ b/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SelectorImpl.java
@@ -637,7 +637,7 @@ public class SelectorImpl extends SourceImpl {
             PropertyState s = builder.getPropertyState();
             return PropertyValues.create(s);
         }
-        boolean relative = oakPropertyName.indexOf(&apos;/&apos;) &amp;gt;= 0;
+        boolean relative = !oakPropertyName.startsWith(QueryConstants.REP_FACET + &quot;(&quot;) &amp;amp;&amp;amp; oakPropertyName.indexOf(&apos;/&apos;) &amp;gt;= 0;
         Tree t = currentTree();
         if (relative) {
             for (String p : PathUtils.elements(PathUtils.getParentPath(oakPropertyName))) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;... since none of the other methods respected at [0] should likely be hit by such issue. That said, I think SelectorImpl could have been aware of the method being used and reacted to check for &apos;relative&apos; accordingly.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt;, can you please check this out.&lt;/p&gt;

&lt;p&gt;[0]: &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/blob/e526867ba7663b99ee5ccfdbd6cee0a84aa789b6/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SelectorImpl.java#L673-L683&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/blob/e526867ba7663b99ee5ccfdbd6cee0a84aa789b6/oak-core/src/main/java/org/apache/jackrabbit/oak/query/ast/SelectorImpl.java#L673-L683&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16189426" author="tmueller" created="Tue, 3 Oct 2017 09:10:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=catholicon&quot; class=&quot;user-hover&quot; rel=&quot;catholicon&quot;&gt;catholicon&lt;/a&gt; the change above for SelectorImpl.currentOakProperty, probably it makes sense to also check for &lt;tt&gt;rep:excerpt(...)&lt;/tt&gt;. Not sure if there are other such &quot;function properties&quot;. Checking for &quot;(&quot; is important.&lt;/p&gt;

&lt;p&gt;Similarly, in currentOakProperty, I would change the following:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        } else if (oakPropertyName.startsWith(QueryConstants.REP_EXCERPT + &quot;(&quot;)) {
            result = currentRow.getValue(oakPropertyName);
...
        } else if (oakPropertyName.startsWith(QueryConstants.REP_FACET + &quot;(&quot;)) {
            result = currentRow.getValue(oakPropertyName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16195546" author="catholicon" created="Sat, 7 Oct 2017 02:45:53 +0000"  >&lt;p&gt;Fixed on trunk at &lt;a href=&quot;https://svn.apache.org/r1811380&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1811380&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16203246" author="edivad" created="Fri, 13 Oct 2017 08:59:21 +0000"  >&lt;p&gt;Bulk close for 1.7.9&lt;/p&gt;</comment>
                            <comment id="16235281" author="catholicon" created="Thu, 2 Nov 2017 06:53:39 +0000"  >&lt;p&gt;Backported to 1.6 at &lt;a href=&quot;https://svn.apache.org/r1814034&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1814034&lt;/a&gt; and to 1.4 at &lt;a href=&quot;https://svn.apache.org/r1814334&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1814334&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16270561" author="mreutegg" created="Wed, 29 Nov 2017 10:34:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=catholicon&quot; class=&quot;user-hover&quot; rel=&quot;catholicon&quot;&gt;catholicon&lt;/a&gt;, it looks like the 1.4 backport causes build failures on travis (&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-7007&quot; title=&quot;Test failure: FacetTest.testFacetsNA()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-7007&quot;&gt;&lt;del&gt;OAK-7007&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="16270570" author="catholicon" created="Wed, 29 Nov 2017 10:43:08 +0000"  >&lt;p&gt;Oops. Sorry. I thought I had checked Travis on my local fork before pushing. BTW, I think it would have been backport of &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-6792&quot; title=&quot;rep:facet not supported in xpath&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-6792&quot;&gt;&lt;del&gt;OAK-6792&lt;/del&gt;&lt;/a&gt; (backported in same revision) which would have broken it. I would take a look (likely tomorrow though)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13098851">OAK-6607</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13121600">OAK-7007</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="13125455">OAK-7070</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12889876" name="OAK-6750-testCase.patch" size="3913" author="catholicon" created="Sun, 1 Oct 2017 04:04:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 50 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3kr4n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>