<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:51:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-4770] Missing exception handling in ClusterNodeInfo.renewLease()</title>
                <link>https://issues.apache.org/jira/browse/OAK-4770</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;ClusterNodeInfo.renewLease() does not handle a potential DocumentStoreException on &lt;tt&gt;findAndModify()&lt;/tt&gt;. This may leave &lt;tt&gt;previousLeaseEndTime&lt;/tt&gt; in an inconsistent state and a subsequent &lt;tt&gt;renewLease()&lt;/tt&gt; call then considers the lease timed out. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13003226">OAK-4770</key>
            <summary>Missing exception handling in ClusterNodeInfo.renewLease()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mreutegg">Marcel Reutegger</assignee>
                                    <reporter username="mreutegg">Marcel Reutegger</reporter>
                        <labels>
                            <label>resilience</label>
                    </labels>
                <created>Wed, 7 Sep 2016 13:04:05 +0000</created>
                <updated>Tue, 16 Feb 2021 09:53:07 +0000</updated>
                            <resolved>Tue, 13 Sep 2016 08:24:19 +0000</resolved>
                                                    <fixVersion>1.4.10</fixVersion>
                    <fixVersion>1.5.10</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>core</component>
                    <component>documentmk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15473673" author="mreutegg" created="Thu, 8 Sep 2016 12:00:12 +0000"  >&lt;p&gt;While writing tests to reproduce the described problem, I noticed that &lt;tt&gt;renewLease()&lt;/tt&gt; may throw an AssertionError.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefanegli&quot; class=&quot;user-hover&quot; rel=&quot;stefanegli&quot;&gt;stefanegli&lt;/a&gt;, can we change this into a DocumentStoreException or what is the reason for this somewhat unexpected error? I would also like to clarify in the contract what the cases are when an exception (or error) can be expected.&lt;/p&gt;</comment>
                            <comment id="15473717" author="mreutegg" created="Thu, 8 Sep 2016 12:20:13 +0000"  >&lt;p&gt;Added more tests, one ignored for this issue: &lt;a href=&quot;http://svn.apache.org/r1759795&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1759795&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15473920" author="mreutegg" created="Thu, 8 Sep 2016 13:53:01 +0000"  >&lt;p&gt;There&apos;s another problem with the renewLease() method. It does not notice when it is being recovered by another cluster node. See &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-4779&quot; title=&quot;ClusterNodeInfo may renew lease while recovery is running&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-4779&quot;&gt;&lt;del&gt;OAK-4779&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15474025" author="mreutegg" created="Thu, 8 Sep 2016 14:35:51 +0000"  >&lt;p&gt;I would also like to highlight and clarify another observation: the current implementation of renewLease() does &lt;b&gt;not&lt;/b&gt; check if the current time is past the leaseEndTime. It just tries to push out the leaseEndTime to a new value. Reading the &lt;tt&gt;performLeaseCheck()&lt;/tt&gt; source, it seems like this is intended, because only the lease check method will set &lt;tt&gt;leaseCheckFailed&lt;/tt&gt; to &lt;tt&gt;true&lt;/tt&gt; in case of a timeout. &lt;tt&gt;renewLease()&lt;/tt&gt; may also set it to &lt;tt&gt;true&lt;/tt&gt; but only based on the result of the conditional updated. That is, it will only fail if another cluster node did a recovery. &lt;/p&gt;</comment>
                            <comment id="15483575" author="mreutegg" created="Mon, 12 Sep 2016 09:06:08 +0000"  >&lt;p&gt;Discussed with Stefan offline and the intention of the AssertionError was to break through try/catches and terminate the current thread. But the lease update thread currently also catches errors and will not terminate. I will therefore try to replace usage of AssertionError with DocumentStoreException and update the contract of renewLease() accordingly.&lt;/p&gt;</comment>
                            <comment id="15486641" author="mreutegg" created="Tue, 13 Sep 2016 08:24:21 +0000"  >&lt;p&gt;Fixed in trunk: &lt;a href=&quot;http://svn.apache.org/r1760492&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1760492&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15502966" author="edivad" created="Mon, 19 Sep 2016 10:11:11 +0000"  >&lt;p&gt;bulk close for 1.5.10&lt;/p&gt;</comment>
                            <comment id="15650667" author="mreutegg" created="Wed, 9 Nov 2016 11:19:07 +0000"  >&lt;p&gt;Merged into 1.4 branch: &lt;a href=&quot;http://svn.apache.org/r1768862&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1768862&lt;/a&gt; and &lt;a href=&quot;http://svn.apache.org/r1768911&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1768911&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16527523" author="reschke" created="Fri, 29 Jun 2018 12:03:09 +0000"  >&lt;p&gt;trunk: &lt;a href=&quot;http://svn.apache.org/r1760492&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1760492&lt;/a&gt; &lt;a href=&quot;http://svn.apache.org/r1759795&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1759795&lt;/a&gt;&lt;br/&gt;
1.4: &lt;a href=&quot;http://svn.apache.org/r1768911&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1768911&lt;/a&gt; &lt;a href=&quot;http://svn.apache.org/r1768862&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1768862&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13001950">OAK-4739</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13003584">OAK-4779</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13001950">OAK-4739</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13004263">OAK-4792</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>OAK-3270</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 20 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33c2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>