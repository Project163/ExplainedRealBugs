<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:40:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-1176] ObservationTest#observationDispose fails every now and then</title>
                <link>https://issues.apache.org/jira/browse/OAK-1176</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;on my computer ObservationTest#observationDispose failes every now and then but always succeeds when i run the oak-jcr tests again after the failure:&lt;/p&gt;

&lt;p&gt;observationDispose&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;(org.apache.jackrabbit.oak.jcr.observation.ObservationTest)  Time elapsed: 0.335 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
java.lang.AssertionError&lt;br/&gt;
	at org.junit.Assert.fail(Assert.java:92)&lt;br/&gt;
	at org.junit.Assert.assertTrue(Assert.java:43)&lt;br/&gt;
	at org.junit.Assert.assertFalse(Assert.java:68)&lt;br/&gt;
	at org.junit.Assert.assertFalse(Assert.java:79)&lt;br/&gt;
	at org.apache.jackrabbit.oak.jcr.observation.ObservationTest.observationDispose(ObservationTest.java:352)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45)&lt;br/&gt;
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)&lt;br/&gt;
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42)&lt;br/&gt;
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)&lt;br/&gt;
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)&lt;br/&gt;
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:30)&lt;br/&gt;
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:263)&lt;br/&gt;
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:68)&lt;br/&gt;
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:47)&lt;br/&gt;
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:231)&lt;br/&gt;
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:60)&lt;br/&gt;
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:229)&lt;br/&gt;
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:50)&lt;br/&gt;
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:222)&lt;br/&gt;
	at org.junit.runners.ParentRunner.run(ParentRunner.java:300)&lt;br/&gt;
	at org.junit.runners.Suite.runChild(Suite.java:128)&lt;br/&gt;
	at org.junit.runners.Suite.runChild(Suite.java:24)&lt;br/&gt;
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:231)&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:439)&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:695)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12678992">OAK-1176</key>
            <summary>ObservationTest#observationDispose fails every now and then</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mduerig">Michael D&#252;rig</assignee>
                                    <reporter username="angela">Angela Schreiber</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Nov 2013 11:00:12 +0000</created>
                <updated>Mon, 16 Dec 2013 11:03:38 +0000</updated>
                            <resolved>Tue, 26 Nov 2013 12:59:43 +0000</resolved>
                                                    <fixVersion>0.13</fixVersion>
                                    <component>jcr</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13821253" author="mduerig" created="Wed, 13 Nov 2013 12:02:34 +0000"  >&lt;p&gt;This is most probably due to a race condition in &lt;tt&gt;BackgroundObserver&lt;/tt&gt;. Even though the &lt;tt&gt;STOP&lt;/tt&gt; signal might be in the queue, there is still the chance of a pending change that has been taken from the queue earlier being passed to the observer. &lt;/p&gt;

&lt;p&gt;Two variants for fixing:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1176&quot; title=&quot;ObservationTest#observationDispose fails every now and then&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1176&quot;&gt;&lt;del&gt;OAK-1176&lt;/del&gt;&lt;/a&gt;-1.patch addresses this by synchronising notification of the observer. This approach might be prone to dead locks.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1176&quot; title=&quot;ObservationTest#observationDispose fails every now and then&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1176&quot;&gt;&lt;del&gt;OAK-1176&lt;/del&gt;&lt;/a&gt;-2.patch addresses the issue by having the &lt;tt&gt;stop()&lt;/tt&gt; call join the back ground thread.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anchela&quot; class=&quot;user-hover&quot; rel=&quot;anchela&quot;&gt;anchela&lt;/a&gt; since I can&apos;t reproduce the test failure locally, could to try out the patches and feedback?&lt;/p&gt;</comment>
                            <comment id="13822381" author="anchela" created="Thu, 14 Nov 2013 12:48:44 +0000"  >&lt;p&gt;Patch 2: still test failure&lt;/p&gt;</comment>
                            <comment id="13822384" author="mduerig" created="Thu, 14 Nov 2013 12:54:17 +0000"  >&lt;p&gt;Forgot about that one. Please try again with &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1176&quot; title=&quot;ObservationTest#observationDispose fails every now and then&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1176&quot;&gt;&lt;del&gt;OAK-1176&lt;/del&gt;&lt;/a&gt;-3.patch&lt;/p&gt;</comment>
                            <comment id="13822502" author="anchela" created="Thu, 14 Nov 2013 15:14:06 +0000"  >&lt;p&gt;tried patch 3 and didn&apos;t experience the failure up to now.&lt;/p&gt;</comment>
                            <comment id="13822510" author="mduerig" created="Thu, 14 Nov 2013 15:22:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jukkaz&quot; class=&quot;user-hover&quot; rel=&quot;jukkaz&quot;&gt;jukkaz&lt;/a&gt; any concerns re patch 3? After all I removed your comment re. not having to use &lt;tt&gt;Thread.join&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="13822523" author="jukkaz" created="Thu, 14 Nov 2013 15:36:04 +0000"  >&lt;p&gt;Instead of joining the background thread (which could be in the middle of a massive content diff), I&apos;d rather use a flag in &lt;tt&gt;ChangeProcessor&lt;/tt&gt; or &lt;tt&gt;EventGenerator&lt;/tt&gt; that stops the delivery of any further event instances. IIRC we had something like that before r1539363.&lt;/p&gt;</comment>
                            <comment id="13822526" author="mduerig" created="Thu, 14 Nov 2013 15:45:05 +0000"  >&lt;p&gt;Good point! I&apos;ll give it a shot.&lt;/p&gt;</comment>
                            <comment id="13826541" author="mduerig" created="Tue, 19 Nov 2013 14:34:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-1176&quot; title=&quot;ObservationTest#observationDispose fails every now and then&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-1176&quot;&gt;&lt;del&gt;OAK-1176&lt;/del&gt;&lt;/a&gt;-4.patch addresses Jukka&apos;s concerns by moving the stop logic to the &lt;tt&gt;ChangeProcessoer&lt;/tt&gt; class.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anchela&quot; class=&quot;user-hover&quot; rel=&quot;anchela&quot;&gt;anchela&lt;/a&gt; could you give this one a try?&lt;/p&gt;</comment>
                            <comment id="13832550" author="mduerig" created="Tue, 26 Nov 2013 12:59:43 +0000"  >&lt;p&gt;Fixed at &lt;a href=&quot;http://svn.apache.org/r1545636&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1545636&lt;/a&gt;. I partially undid changes from &lt;a href=&quot;http://svn.apache.org/r1541935&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1541935&lt;/a&gt; (&lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-710&quot; title=&quot;PermissionValidator: Backwards compatible permission evaluation for moving/renaming nodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-710&quot;&gt;&lt;del&gt;OAK-710&lt;/del&gt;&lt;/a&gt;) as it seemed to me they where introduced accidentally by a leftover from reviewing an earlier patch from this issue. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anchela&quot; class=&quot;user-hover&quot; rel=&quot;anchela&quot;&gt;anchela&lt;/a&gt;, correct me if I&apos;m wrong. &lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;http://svn.apache.org/viewvc/jackrabbit/oak/trunk/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/commit/BackgroundObserver.java?r1=1541935&amp;amp;r2=1541934&amp;amp;pathrev=1541935&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/jackrabbit/oak/trunk/oak-core/src/main/java/org/apache/jackrabbit/oak/spi/commit/BackgroundObserver.java?r1=1541935&amp;amp;r2=1541934&amp;amp;pathrev=1541935&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13847289" author="alex.parvulescu" created="Fri, 13 Dec 2013 09:01:16 +0000"  >&lt;p&gt;bulk close for the 0.13 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12684921">OAK-1290</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12613583" name="OAK-1176-1.patch" size="1218" author="mduerig" created="Wed, 13 Nov 2013 12:02:34 +0000"/>
                            <attachment id="12613584" name="OAK-1176-2.patch" size="1271" author="mduerig" created="Wed, 13 Nov 2013 12:02:34 +0000"/>
                            <attachment id="12613825" name="OAK-1176-3.patch" size="1343" author="mduerig" created="Thu, 14 Nov 2013 12:54:17 +0000"/>
                            <attachment id="12614625" name="OAK-1176-4.patch" size="1658" author="mduerig" created="Tue, 19 Nov 2013 14:34:19 +0000"/>
                            <attachment id="12613823" name="org.apache.jackrabbit.oak.jcr.observation.ObservationTest.txt" size="10709" author="angela" created="Thu, 14 Nov 2013 12:48:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>358357</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pry7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>358647</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>