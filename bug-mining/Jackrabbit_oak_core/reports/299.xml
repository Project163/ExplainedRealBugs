<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:37:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-800] EffectiveType#getTypeNames may throw NPE</title>
                <link>https://issues.apache.org/jira/browse/OAK-800</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;&lt;em&gt;EffectiveType#getTypeNames&lt;/em&gt; may throw NPE if any of the types doesn&apos;t have &lt;em&gt;oak:supertypes&lt;/em&gt; property defined.&lt;/p&gt;

&lt;p&gt;At line 200: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    Iterables.addAll(names, type.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;oak:supertypes&quot;&lt;/span&gt;).getValue(NAMES));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where &lt;em&gt;type.getProperty(&quot;oak:supertypes&quot;)&lt;/em&gt; may be &lt;em&gt;null&lt;/em&gt; (as per &lt;em&gt;@CheckForNull&lt;/em&gt; annotation on &lt;em&gt;NodeState#getProperty(String name)&lt;/em&gt;).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12645241">OAK-800</key>
            <summary>EffectiveType#getTypeNames may throw NPE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="teofili">Tommaso Teofili</assignee>
                                    <reporter username="teofili">Tommaso Teofili</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Apr 2013 14:51:57 +0000</created>
                <updated>Tue, 21 May 2013 11:18:36 +0000</updated>
                            <resolved>Mon, 29 Apr 2013 16:50:41 +0000</resolved>
                                                    <fixVersion>0.7</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13644554" author="teofili" created="Mon, 29 Apr 2013 14:56:55 +0000"  >&lt;p&gt;the trivial patch would be &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    PropertyState superTypes = type.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;oak:supertypes&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (superTypes != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        Iterables.addAll(names, superTypes.getValue(NAMES));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13644642" author="teofili" created="Mon, 29 Apr 2013 16:50:56 +0000"  >&lt;p&gt;resolved at r1477164&lt;/p&gt;</comment>
                            <comment id="13644660" author="jukkaz" created="Mon, 29 Apr 2013 17:12:05 +0000"  >&lt;p&gt;A better solution is to use the new &lt;tt&gt;getNames()&lt;/tt&gt; method from &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-776&quot; title=&quot;NodeState convenience accessors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-776&quot;&gt;&lt;del&gt;OAK-776&lt;/del&gt;&lt;/a&gt;, see &lt;a href=&quot;http://svn.apache.org/r1477203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1477203&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;RegistrationEditor&lt;/tt&gt; class should take care of populating the &lt;tt&gt;oak:supertypes&lt;/tt&gt; properties and other bits on which the &lt;tt&gt;TypeEditor&lt;/tt&gt; depends. There&apos;s probably something wrong in the repository setup if type validation is run before the &lt;tt&gt;RegistrationEditor&lt;/tt&gt; has had a chance to pre-compile the required extra type information needed by the validator.&lt;/p&gt;</comment>
                            <comment id="13645309" author="teofili" created="Tue, 30 Apr 2013 06:22:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;The RegistrationEditor class should take care of populating the oak:supertypes properties and other bits on which the TypeEditor depends. There&apos;s probably something wrong in the repository setup if type validation is run before the RegistrationEditor has had a chance to pre-compile the required extra type information needed by the validator.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;yes, this showed up when trying to upgrade a 0.6 Oak repository to 0.7, however your suggestion (and fix) looks good, using &lt;em&gt;getNames()&lt;/em&gt; is better.&lt;/p&gt;</comment>
                            <comment id="13645311" author="jukkaz" created="Tue, 30 Apr 2013 06:26:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;this showed up when trying to upgrade a 0.6 Oak repository to 0.7&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good point. We&apos;ll need to make sure that the type compilation done by &lt;tt&gt;RegistrationEditor&lt;/tt&gt; is automatically applied when upgrading an existing repository (mostly Jackrabbit ones, not so important yet for earlier Oak versions). Alternatively we could make the TypeEditor automatically compile the type information in memory if it&apos;s not yet available in content.&lt;/p&gt;</comment>
                            <comment id="13645347" author="teofili" created="Tue, 30 Apr 2013 07:32:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;Good point. We&apos;ll need to make sure that the type compilation done by RegistrationEditor is automatically applied when upgrading an existing repository (mostly Jackrabbit ones, not so important yet for earlier Oak versions).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree it&apos;s more important for JR installations&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Alternatively we could make the TypeEditor automatically compile the type information in memory if it&apos;s not yet available in content.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not yet sure about what&apos;s the best alternative here: &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the former (re applying &lt;em&gt;RegistrationEditor&lt;/em&gt;&apos;s type compilation), in my opinion, looks better at a first glance even if I&apos;m not sure modifying node types information on the repository would sound nice to users / consumers of the repository&lt;/li&gt;
	&lt;li&gt;the latter (&lt;em&gt;TypeEditor&lt;/em&gt;&apos;s in memory type compilation) would probably be more costly but less intrusive even if once you upgrade you&apos;re perhaps expecting some changes to happen.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Probably that&apos;s also part of a broader discussion on migration from JR to Oak.&lt;/p&gt;</comment>
                            <comment id="13646472" author="jukkaz" created="Wed, 1 May 2013 09:05:31 +0000"  >&lt;p&gt;FTR, here&apos;s a code snippet that we could use in &lt;tt&gt;TypeEditorProvider&lt;/tt&gt; to do in-memory type compilation when needed:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!types.getChildNode(NT_BASE).hasProperty(OAK_SUPERTYPES)) {
    NodeBuilder typesBuilder = types.builder();
    RegistrationEditor editor = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RegistrationEditor(typesBuilder);
    EditorDiff.process(editor, MISSING_NODE, types);
    types = typesBuilder.getNodeState();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;&lt;p&gt;Probably that&apos;s also part of a broader discussion on migration from JR to Oak.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed. Let&apos;s follow up on oak-dev@ and/or other issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>325603</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 29 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1k69z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>325948</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>