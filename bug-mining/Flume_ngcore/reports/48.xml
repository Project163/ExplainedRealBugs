<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:56:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLUME-1244] Implement a load-balancing RpcClient with round/robin and random distribution capabilties.</title>
                <link>https://issues.apache.org/jira/browse/FLUME-1244</link>
                <project id="12311321" key="FLUME">Flume</project>
                    <description>&lt;p&gt;We now have a load balancing sink processor implemented via &lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-1198&quot; title=&quot;Implement a load-balancing sink processor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-1198&quot;&gt;&lt;del&gt;FLUME-1198&lt;/del&gt;&lt;/a&gt; which provides the ability to distribute load over a set of sinks via round/robin or random distribution scheme. A similar implementation should be available for the RpcClient within the client SDK.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12558709">FLUME-1244</key>
            <summary>Implement a load-balancing RpcClient with round/robin and random distribution capabilties.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aprabhakar">Arvind Prabhakar</assignee>
                                    <reporter username="aprabhakar">Arvind Prabhakar</reporter>
                        <labels>
                    </labels>
                <created>Thu, 31 May 2012 01:11:38 +0000</created>
                <updated>Fri, 8 Jun 2012 00:39:32 +0000</updated>
                            <resolved>Thu, 7 Jun 2012 23:12:20 +0000</resolved>
                                                    <fixVersion>1.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13290927" author="aprabhakar" created="Thu, 7 Jun 2012 10:57:41 +0000"  >&lt;p&gt;Here is my attempt at Load Balancing RPC client. Some details:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;To activate the client, set the property &lt;tt&gt;client.type&lt;/tt&gt; to &lt;tt&gt;default_loadbalance&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;It requires that you have at least two hosts specified via &lt;tt&gt;hosts = h1 h2&lt;/tt&gt; and &lt;tt&gt;hosts.h1 = hostname:port&lt;/tt&gt; etc.&lt;/li&gt;
	&lt;li&gt;By default it uses a round-robin scheme to distribute load over the various hosts.&lt;/li&gt;
	&lt;li&gt;To change the load distribution scheme to random instead of round robin, set the value of &lt;tt&gt;host-selector&lt;/tt&gt; to &lt;tt&gt;random&lt;/tt&gt;. Otherwise it can be set to &lt;tt&gt;round_robin&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;To specify your own implementation of host selection algorithm, implement the interface &lt;tt&gt;org.apache.flume.api.LoadBalancingRpcClient.HostSelector&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;This implementation uses optimistic failover where a failure in handling event send request will result in the client automatically advancing to the next available host specified by the selector.&lt;/li&gt;
	&lt;li&gt;If all hosts fail, the EventDeliveryException will be raised.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13291142" author="mpercy" created="Thu, 7 Jun 2012 17:24:48 +0000"  >&lt;p&gt;Reviewing this patch now.&lt;/p&gt;</comment>
                            <comment id="13291300" author="mpercy" created="Thu, 7 Jun 2012 21:00:50 +0000"  >&lt;p&gt;Nice work. This functionality is sorely needed!&lt;/p&gt;

&lt;p&gt;I have the following code review feedback:&lt;/p&gt;

&lt;p&gt;LoadBalancingRpcClient.java&lt;br/&gt;
===========================&lt;/p&gt;

&lt;p&gt;In getClient(): if (!client.isActive()), then we should close() the RpcClient before replacing the reference. That call cleans up the Netty transceiver threads in the base client. Also, (!client.isActive()) should be an &quot;else if&quot; condition, otherwise I think it&apos;s possible to create two clients in a row very quickly in a failure case when the client starts as null and remains inactive/dead after creation due to the host being down.&lt;/p&gt;

&lt;p&gt;In append(): I wonder how expensive it is to create a new HostInfo Iterator on every append() operation. A higher level caching construct or iteration abstraction might be more efficient. However the RoundRobinHostSelector implementation is nice and elegant. This is just a note and I think we can profile / optimize this later if needed.&lt;/p&gt;

&lt;p&gt;In close(): This method should call close() on all iterated RPC clients. !isActive() does not imply that close() does not need to be called... there are cases where a NettyRpcClient can be NEW or DEAD and have an active thread pool. Also, close() is specified as an idempotent operation, but maybe that needs to be clarified better in the RpcClient interface.&lt;/p&gt;

&lt;p&gt;In RandomOrderHostSelector.createHostIterator(): This line is a bit disconcerting: indexOrder&lt;span class=&quot;error&quot;&gt;&amp;#91;indexList.size() - 1&amp;#93;&lt;/span&gt; = indexList.remove(pick);&lt;br/&gt;
It would would be good to store indexList.size() in a local var so we don&apos;t have to look in the JLS to figure out the order of operations on that... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ... BTW, wouldn&apos;t the RHS be evaluated first? Or inside the square brackets would happen first?&lt;/p&gt;

&lt;p&gt;TestLoadBalancingRpcClient.java&lt;br/&gt;
===============================&lt;/p&gt;

&lt;p&gt;Nit: the test method names should start with a lowercase letter for Java standard method naming&lt;/p&gt;

&lt;p&gt;Minor: in TestLbClientTenHostRoundRobinDistribution() and TestLbClientTenHostRoundRobinDistributionBatch(): We do not have to rely on distribution approximation for the asserts here. Since there is no randomness, we can count the # of events and assert exactly as in some of the other non-randomized tests.&lt;/p&gt;

&lt;p&gt;That&apos;s all I have. Thanks for adding this important feature, all in all it looks quite good.&lt;/p&gt;</comment>
                            <comment id="13291362" author="aprabhakar" created="Thu, 7 Jun 2012 22:03:37 +0000"  >&lt;p&gt;Thanks for the review Mike! Great feedback as usual. See my comments below:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;In getClient(): if (!client.isActive()), then we should close() the RpcClient before replacing the reference. That call cleans up the Netty transceiver threads in the base client. Also, (!client.isActive()) should be an &quot;else if&quot; condition, otherwise I think it&apos;s possible to create two clients in a row very quickly in a failure case when the client starts as null and remains inactive/dead after creation due to the host being down.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;In append(): I wonder how expensive it is to create a new HostInfo Iterator on every append() operation. A higher level caching construct or iteration abstraction might be more efficient. However the RoundRobinHostSelector implementation is nice and elegant. This is just a note and I think we can profile / optimize this later if needed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agree. Lets profile it and see. The thought did cross my mind as well.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;In close(): This method should call close() on all iterated RPC clients. !isActive() does not imply that close() does not need to be called... there are cases where a NettyRpcClient can be NEW or DEAD and have an active thread pool. Also, close() is specified as an idempotent operation, but maybe that needs to be clarified better in the RpcClient interface.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;In RandomOrderHostSelector.createHostIterator(): This line is a bit disconcerting: indexOrder&lt;span class=&quot;error&quot;&gt;&amp;#91;indexList.size() - 1&amp;#93;&lt;/span&gt; = indexList.remove(pick);&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;One of my finer moments.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It would would be good to store indexList.size() in a local var so we don&apos;t have to look in the JLS to figure out the order of operations on that...  ... BTW, wouldn&apos;t the RHS be evaluated first? Or inside the square brackets would happen first?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I refactored it to make it easy on the eyes. Apologies for having cryptic code.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Nit: the test method names should start with a lowercase letter for Java standard method naming&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Another one of my finer moments &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Fixed it.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Minor: in TestLbClientTenHostRoundRobinDistribution() and TestLbClientTenHostRoundRobinDistributionBatch(): We do not have to rely on distribution approximation for the asserts here. Since there is no randomness, we can count the # of events and assert exactly as in some of the other non-randomized tests.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I will let it be right now since at one time I was playing with different values of the host and event size and there was some offsets due to rounding that made this comparison better. But I agree - in the current state it does not make much difference.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;That&apos;s all I have. Thanks for adding this important feature, all in all it looks quite good.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks again for a thorough review Mike. &lt;/p&gt;

</comment>
                            <comment id="13291364" author="aprabhakar" created="Thu, 7 Jun 2012 22:04:06 +0000"  >&lt;p&gt;Patch with review feedback incorporated.&lt;/p&gt;</comment>
                            <comment id="13291405" author="mpercy" created="Thu, 7 Jun 2012 23:10:38 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13291406" author="mpercy" created="Thu, 7 Jun 2012 23:12:20 +0000"  >&lt;p&gt;Patch committed. Thanks Arvind!&lt;/p&gt;</comment>
                            <comment id="13291411" author="mubarakseyed" created="Thu, 7 Jun 2012 23:25:41 +0000"  >&lt;p&gt;Thanks Arvind/Mike for the Patch. Will test it out.&lt;/p&gt;</comment>
                            <comment id="13291458" author="hudson" created="Fri, 8 Jun 2012 00:39:32 +0000"  >&lt;p&gt;Integrated in flume-trunk #228 (See &lt;a href=&quot;https://builds.apache.org/job/flume-trunk/228/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/flume-trunk/228/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-1244&quot; title=&quot;Implement a load-balancing RpcClient with round/robin and random distribution capabilties.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-1244&quot;&gt;&lt;del&gt;FLUME-1244&lt;/del&gt;&lt;/a&gt;. Implement a load-balancing RpcClient.&lt;/p&gt;

&lt;p&gt;(Arvind Prabhakar via Mike Percy) (Revision 1347827)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
mpercy : &lt;a href=&quot;http://svn.apache.org/viewvc/?view=rev&amp;amp;rev=1347827&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/?view=rev&amp;amp;rev=1347827&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/incubator/flume/trunk/flume-ng-core/src/main/java/org/apache/flume/channel/MemoryChannel.java&lt;/li&gt;
	&lt;li&gt;/incubator/flume/trunk/flume-ng-core/src/main/java/org/apache/flume/sink/AbstractSinkSelector.java&lt;/li&gt;
	&lt;li&gt;/incubator/flume/trunk/flume-ng-core/src/main/java/org/apache/flume/sink/LoadBalancingSinkProcessor.java&lt;/li&gt;
	&lt;li&gt;/incubator/flume/trunk/flume-ng-sdk/src/main/java/org/apache/flume/api/FailoverRpcClient.java&lt;/li&gt;
	&lt;li&gt;/incubator/flume/trunk/flume-ng-sdk/src/main/java/org/apache/flume/api/HostInfo.java&lt;/li&gt;
	&lt;li&gt;/incubator/flume/trunk/flume-ng-sdk/src/main/java/org/apache/flume/api/LoadBalancingRpcClient.java&lt;/li&gt;
	&lt;li&gt;/incubator/flume/trunk/flume-ng-sdk/src/main/java/org/apache/flume/api/NettyAvroRpcClient.java&lt;/li&gt;
	&lt;li&gt;/incubator/flume/trunk/flume-ng-sdk/src/main/java/org/apache/flume/api/RpcClientConfigurationConstants.java&lt;/li&gt;
	&lt;li&gt;/incubator/flume/trunk/flume-ng-sdk/src/main/java/org/apache/flume/api/RpcClientFactory.java&lt;/li&gt;
	&lt;li&gt;/incubator/flume/trunk/flume-ng-sdk/src/main/java/org/apache/flume/util&lt;/li&gt;
	&lt;li&gt;/incubator/flume/trunk/flume-ng-sdk/src/main/java/org/apache/flume/util/SpecificOrderIterator.java&lt;/li&gt;
	&lt;li&gt;/incubator/flume/trunk/flume-ng-sdk/src/test/java/org/apache/flume/api/RpcTestUtils.java&lt;/li&gt;
	&lt;li&gt;/incubator/flume/trunk/flume-ng-sdk/src/test/java/org/apache/flume/api/TestLoadBalancingRpcClient.java&lt;/li&gt;
	&lt;li&gt;/incubator/flume/trunk/flume-ng-sdk/src/test/java/org/apache/flume/api/TestNettyAvroRpcClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12531251" name="FLUME-1244-1.patch" size="48145" author="aprabhakar" created="Thu, 7 Jun 2012 10:51:13 +0000"/>
                            <attachment id="12531325" name="FLUME-1244-2.patch" size="48291" author="aprabhakar" created="Thu, 7 Jun 2012 22:04:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>248245</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 24 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i09tuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>55270</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>