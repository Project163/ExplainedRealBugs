<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:57:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLUME-2538] TestResettableFileInputStream fails on JDK 8</title>
                <link>https://issues.apache.org/jira/browse/FLUME-2538</link>
                <project id="12311321" key="FLUME">Flume</project>
                    <description>&lt;p&gt;TestResettableFileInputStream.testUtf8DecodeErrorHandlingReplace fails in JDK 8&lt;br/&gt;
&quot;testUtf8DecodeErrorHandlingReplace(org.apache.flume.serialization.TestResettableFileInputStream)  Time elapsed: 6 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
org.junit.ComparisonFailure: expected:&amp;lt;...(&#65533;&#65533;&#65533;)&lt;br/&gt;
NonUnicode: (&#65533;[])&lt;br/&gt;
&amp;gt; but was:&amp;lt;...(&#65533;&#65533;&#65533;)&lt;br/&gt;
NonUnicode: (&#65533;&lt;span class=&quot;error&quot;&gt;&amp;#91;&#65533;&#65533;&#65533;&#65533;&amp;#93;&lt;/span&gt;) &quot;&lt;/p&gt;

&lt;p&gt;Charsetdecoder.decode has changed in its behavior, as to how it handles CodingErrorAction.Replace policy &lt;br/&gt;
Will submit a patch today.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12753077">FLUME-2538</key>
            <summary>TestResettableFileInputStream fails on JDK 8</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jrufus">Johny Rufus</assignee>
                                    <reporter username="jrufus">Johny Rufus</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Nov 2014 16:03:53 +0000</created>
                <updated>Fri, 14 Nov 2014 00:44:46 +0000</updated>
                            <resolved>Thu, 13 Nov 2014 23:24:48 +0000</resolved>
                                    <version>1.5.0.1</version>
                                    <fixVersion>1.6.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14199523" author="jrufus" created="Thu, 6 Nov 2014 01:09:26 +0000"  >&lt;p&gt;One way to see the difference in the behavior is by running the below code in Jdk 7 and 8&lt;br/&gt;
@Test&lt;br/&gt;
  public void testTest() {&lt;br/&gt;
    CharsetDecoder decoder = Charsets.UTF_8.newDecoder();&lt;/p&gt;

&lt;p&gt;    decoder.onMalformedInput(CodingErrorAction.REPLACE);&lt;br/&gt;
    decoder.onUnmappableCharacter(CodingErrorAction.REPLACE);&lt;/p&gt;

&lt;p&gt;    ByteBuffer buf = ByteBuffer.allocate(20);&lt;br/&gt;
    buf.put(new byte[] &lt;/p&gt;
{ (byte)0xf8, (byte)0xa1, (byte)0xa1, (byte)0xa1,
            (byte)0xa1 }
&lt;p&gt;);&lt;br/&gt;
    buf.flip();&lt;/p&gt;

&lt;p&gt;    CharBuffer cbuf = CharBuffer.allocate(1);&lt;br/&gt;
    CoderResult res = decoder.decode(buf, cbuf, false);&lt;br/&gt;
    System.out.println(decoder.getClass().getName());&lt;br/&gt;
    System.out.println(&quot;Pos &amp;#8212; &quot;&lt;ins&gt;buf.position()&lt;/ins&gt; &quot;  cbuf pos --&quot;+cbuf.position());&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Jdk 7 output --&amp;gt;Pos &amp;#8212; 5  cbuf pos --1&lt;br/&gt;
Jdk 8 output --&amp;gt;Pos &amp;#8212; 1  cbuf pos --1&lt;/p&gt;

&lt;p&gt;In Jdk7: If there is a invalid byte sequence and CodingErrorAction.Replace is specified, then the complete set of invalid bye sequence is treated as one malformed character and replaced by one replacement character in the output buffer  &lt;span class=&quot;error&quot;&gt;&amp;#91;Hence the position is advanced by 5 as seen in the output as its a 5 byte invalid sequence&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;In Jdk8: Each invalid byte in the sequence is treated as a malformed character and hence we see the buffer being advanced by only one position. So for every malformed character, we see the replacement character included in the output buffer&lt;/p&gt;

&lt;p&gt;Attaching a patch that accommodates the above modified behavior &lt;/p&gt;</comment>
                            <comment id="14199529" author="hshreedharan" created="Thu, 6 Nov 2014 01:13:12 +0000"  >&lt;p&gt;Wondering why that was not documented - without documentation, this test is hacky at best (Java folks figure out the regression and fix it &amp;#8211; breaks the test on only new versions of Java 8). Can you file a bug for Java, if this is not actually documented?&lt;/p&gt;</comment>
                            <comment id="14208218" author="jrufus" created="Wed, 12 Nov 2014 16:27:12 +0000"  >&lt;p&gt;Atlast I was able to find the bug that caused this change &lt;br/&gt;
&lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-7096080&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.openjdk.java.net/browse/JDK-7096080&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The relevant portion to this bug taken from - &lt;a href=&quot;http://mail.openjdk.java.net/pipermail/core-libs-dev/2011-September/007722.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail.openjdk.java.net/pipermail/core-libs-dev/2011-September/007722.html&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;which is a link mentioned in this bug report&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&quot;Another corner case is how to deal with the old 5-6 bytes byte sequence, &lt;br/&gt;
such as&lt;br/&gt;
&quot;fc 80 80 8f bf bf&quot;, we are now treating them as 1 malformed utf-8 byte &lt;br/&gt;
sequence, so any&lt;br/&gt;
of these 5-6 bytes &quot;old&quot; formed will be treated one malformed character &lt;br/&gt;
and then replaced&lt;br/&gt;
by one &quot;\ufffd&quot;. But according to the new &quot;best practice&quot; &lt;br/&gt;
recommendation, it probably should&lt;br/&gt;
be replaced by 6 \ufffd.&quot;&lt;/p&gt;</comment>
                            <comment id="14208848" author="hshreedharan" created="Wed, 12 Nov 2014 22:57:58 +0000"  >&lt;p&gt;I like the patch, but I&apos;d recommend not accepting both. We should make sure that pre-JDK 8 the old string is valid and for JDK 8 it will be the new string. You can get the java version from the system property - java.version.&lt;/p&gt;</comment>
                            <comment id="14209228" author="jrufus" created="Thu, 13 Nov 2014 04:03:21 +0000"  >&lt;p&gt;Thanks Hari, attaching the modified patch&lt;/p&gt;</comment>
                            <comment id="14211249" author="hshreedharan" created="Thu, 13 Nov 2014 20:30:54 +0000"  >&lt;p&gt;This looks good. Can you link the OpenJDK bug in the jira? Also, can you see if there is a corresponding bug on bugs.java.com?&lt;/p&gt;

&lt;p&gt;I will run the tests and commit it (I am also renaming the expectedString param to JDK8expectedString)&lt;/p&gt;</comment>
                            <comment id="14211347" author="jrufus" created="Thu, 13 Nov 2014 21:51:32 +0000"  >&lt;p&gt;Thanks Hari. Linked both OpenJDK and bugs.java.com. &lt;/p&gt;</comment>
                            <comment id="14211462" author="jira-bot" created="Thu, 13 Nov 2014 23:24:30 +0000"  >&lt;p&gt;Commit 698f0ba2de9c697ea9fe52134e36a694abc28d88 in flume&apos;s branch refs/heads/trunk from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hshreedharan&quot; class=&quot;user-hover&quot; rel=&quot;hshreedharan&quot;&gt;hshreedharan&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=flume.git;h=698f0ba&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=flume.git;h=698f0ba&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-2538&quot; title=&quot;TestResettableFileInputStream fails on JDK 8&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-2538&quot;&gt;&lt;del&gt;FLUME-2538&lt;/del&gt;&lt;/a&gt;. TestResettableFileInputStream fails on JDK 8.&lt;/p&gt;

&lt;p&gt;(Johny Rufus via Hari)&lt;/p&gt;</comment>
                            <comment id="14211463" author="jira-bot" created="Thu, 13 Nov 2014 23:24:36 +0000"  >&lt;p&gt;Commit c53339c028b8d30cf42b208dc259cf61375bbfd5 in flume&apos;s branch refs/heads/flume-1.6 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hshreedharan&quot; class=&quot;user-hover&quot; rel=&quot;hshreedharan&quot;&gt;hshreedharan&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=flume.git;h=c53339c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=flume.git;h=c53339c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-2538&quot; title=&quot;TestResettableFileInputStream fails on JDK 8&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-2538&quot;&gt;&lt;del&gt;FLUME-2538&lt;/del&gt;&lt;/a&gt;. TestResettableFileInputStream fails on JDK 8.&lt;/p&gt;

&lt;p&gt;(Johny Rufus via Hari)&lt;/p&gt;</comment>
                            <comment id="14211464" author="hshreedharan" created="Thu, 13 Nov 2014 23:24:48 +0000"  >&lt;p&gt;Committed! Thanks Johny!&lt;/p&gt;</comment>
                            <comment id="14211598" author="hudson" created="Fri, 14 Nov 2014 00:39:32 +0000"  >&lt;p&gt;SUCCESS: Integrated in flume-trunk #697 (See &lt;a href=&quot;https://builds.apache.org/job/flume-trunk/697/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/flume-trunk/697/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-2538&quot; title=&quot;TestResettableFileInputStream fails on JDK 8&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-2538&quot;&gt;&lt;del&gt;FLUME-2538&lt;/del&gt;&lt;/a&gt;. TestResettableFileInputStream fails on JDK 8. (hshreedharan: &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/flume/repo?p=flume.git&amp;amp;a=commit&amp;amp;h=698f0ba2de9c697ea9fe52134e36a694abc28d88&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/flume/repo?p=flume.git&amp;amp;a=commit&amp;amp;h=698f0ba2de9c697ea9fe52134e36a694abc28d88&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;flume-ng-core/src/test/java/org/apache/flume/serialization/TestResettableFileInputStream.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14211609" author="hudson" created="Fri, 14 Nov 2014 00:44:46 +0000"  >&lt;p&gt;SUCCESS: Integrated in Flume-trunk-hbase-98 #54 (See &lt;a href=&quot;https://builds.apache.org/job/Flume-trunk-hbase-98/54/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Flume-trunk-hbase-98/54/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-2538&quot; title=&quot;TestResettableFileInputStream fails on JDK 8&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-2538&quot;&gt;&lt;del&gt;FLUME-2538&lt;/del&gt;&lt;/a&gt;. TestResettableFileInputStream fails on JDK 8. (hshreedharan: &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/flume/repo?p=flume.git&amp;amp;a=commit&amp;amp;h=698f0ba2de9c697ea9fe52134e36a694abc28d88&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/flume/repo?p=flume.git&amp;amp;a=commit&amp;amp;h=698f0ba2de9c697ea9fe52134e36a694abc28d88&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;flume-ng-core/src/test/java/org/apache/flume/serialization/TestResettableFileInputStream.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12681242" name="FLUME-2538-1.patch" size="1268" author="jrufus" created="Thu, 13 Nov 2014 04:03:21 +0000"/>
                            <attachment id="12679741" name="FLUME-2538.patch" size="1077" author="jrufus" created="Thu, 6 Nov 2014 01:10:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2205j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>