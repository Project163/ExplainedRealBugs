<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:57:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLUME-1993] On Windows, when using the spooling directory source, there is a file sharing violation when trying to delete tracker file</title>
                <link>https://issues.apache.org/jira/browse/FLUME-1993</link>
                <project id="12311321" key="FLUME">Flume</project>
                    <description>&lt;p&gt;spooling directory source&lt;br/&gt;
org.apache.flume.client.avro.ReliableSpoolingFileEventReader.getNextFile() &lt;/p&gt;

&lt;p&gt;Gets an instance of a DurablePositionTracker and is not calling close() on it before then creating another instance... thus not calling close on the underlying DataFileWriter.  This left the file locked in Windows and hence any delete attempts were failing...causing the Agent to spin around and around trying to delete this file and creating endless numbers of the temporary tracker files.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12642352">FLUME-1993</key>
            <summary>On Windows, when using the spooling directory source, there is a file sharing violation when trying to delete tracker file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulchavez">Paul Chavez</assignee>
                                    <reporter username="scaph01">Phil Scala</reporter>
                        <labels>
                    </labels>
                <created>Sat, 13 Apr 2013 00:32:39 +0000</created>
                <updated>Fri, 19 Apr 2013 07:42:30 +0000</updated>
                            <resolved>Thu, 18 Apr 2013 22:49:26 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>Sinks+Sources</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13630823" author="scaph01" created="Sat, 13 Apr 2013 00:34:52 +0000"  >&lt;p&gt;Attaching my implementation of a minor change to close the DurablePositionTracker, before creating a new instance so that the underlying streams are closed.&lt;/p&gt;</comment>
                            <comment id="13630831" author="hshreedharan" created="Sat, 13 Apr 2013 00:44:08 +0000"  >&lt;p&gt;Hi Phil,&lt;br/&gt;
Could you please submit a patch, rather than the file itself? You can get more info here: &lt;a href=&quot;https://cwiki.apache.org/FLUME/how-to-contribute.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/FLUME/how-to-contribute.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13630837" author="scaph01" created="Sat, 13 Apr 2013 00:55:39 +0000"  >&lt;p&gt;Patch attached.&lt;/p&gt;</comment>
                            <comment id="13630840" author="scaph01" created="Sat, 13 Apr 2013 00:57:07 +0000"  >&lt;p&gt;Please see attached patch for changes.&lt;/p&gt;</comment>
                            <comment id="13630841" author="iekpo" created="Sat, 13 Apr 2013 01:02:45 +0000"  >&lt;p&gt;Phil, in addition to the wiki link from Hari above, you can follow the steps below to create a review for the patch.&lt;/p&gt;

&lt;p&gt;Check first to make sure that it follows the formatting guidelines and recommendations specified in the wiki page.&lt;/p&gt;

&lt;p&gt;I will be updating the wiki page soon with these steps but in the time being, here are the steps for submitting the review for this patch:&lt;/p&gt;

&lt;p&gt;(1) Get the latest code from GIT&lt;/p&gt;

&lt;p&gt;git clone &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/flume.git&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/flume.git&lt;/a&gt; flume&lt;/p&gt;

&lt;p&gt;cd flume&lt;/p&gt;

&lt;p&gt;git checkout flume-1.4&lt;/p&gt;

&lt;p&gt;The current branch for the next release is flume-1.4; this is why we are using &quot;flume-1.4&quot;.&lt;/p&gt;

&lt;p&gt;(2) Apply your changes to the code you have checked out&lt;/p&gt;

&lt;p&gt;(3) Try to compile the code changes, create a tarball and run the unit tests to make sure that all is well with your changes&lt;/p&gt;

&lt;p&gt;mvn clean install&lt;/p&gt;

&lt;p&gt;It is very important to test the changes to make sure the work satisfactorily before submitting the patch&lt;/p&gt;

&lt;p&gt;So you can configure the generated tarball and run it to see if it works for you first&lt;/p&gt;

&lt;p&gt;(4) If all is well, then create the patches:&lt;/p&gt;

&lt;p&gt;git diff --no-prefix &amp;gt; /path/to/&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-11&quot; title=&quot;Tests are setting logger level and should not be.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-11&quot;&gt;&lt;del&gt;FLUME-0011&lt;/del&gt;&lt;/a&gt;.patch&lt;/p&gt;

&lt;p&gt;Use the JIRA issue ID for the patch files you generate.&lt;/p&gt;

&lt;p&gt;If you have more than one pending patch (for different issues) to submit, you can specify the path to the file or directory where the changes are&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;p&gt;git diff --no-prefix flume-ng-core/src/main/java/org/apache/flume/serialization/LineDeserializer.java &amp;gt; /path/to/&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-1&quot; title=&quot;JSP web pages do not have &amp;lt;title&amp;gt; tag sets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-1&quot;&gt;&lt;del&gt;FLUME-0001&lt;/del&gt;&lt;/a&gt;.patch&lt;/p&gt;

&lt;p&gt;git diff --no-prefix flume-ng-doc/sphinx/Flume* &amp;gt; /path/to/&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-2&quot; title=&quot;Flume node&amp;#39;s tail source does not report error or go into error state to user attempts to tail a file it doesn&amp;#39;t have permissions to read.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-2&quot;&gt;&lt;del&gt;FLUME-0002&lt;/del&gt;&lt;/a&gt;.patch&lt;/p&gt;

&lt;p&gt;git diff --no-prefix flume-ng-core/src/main/java/org/apache/flume/sink/ &amp;gt; /path/to/&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-3&quot; title=&quot;Ant failed due to old Thrift jar&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-3&quot;&gt;&lt;del&gt;FLUME-0003&lt;/del&gt;&lt;/a&gt;.patch&lt;/p&gt;

&lt;p&gt;(5) Upload the patche file(s) to the JIRA issue and set the status to PATCH AVAILABLE.&lt;/p&gt;

&lt;p&gt;(6) Create a review for your patch files here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Pick &quot;flume-git&quot; as the repository and &quot;Flume&quot; as the group. The current branch is &quot;flume-1.4&quot;&lt;/p&gt;

&lt;p&gt;(7) You can take a look at other code reviews here for some examples:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/groups/Flume/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/groups/Flume/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thank you for your contribution&lt;/p&gt;
</comment>
                            <comment id="13631970" author="paulchavez" created="Mon, 15 Apr 2013 18:18:31 +0000"  >&lt;p&gt;Attached alternate fix. Instead of explicitly closing the file don&apos;t create the new instance unless we deleted the old one. Also check for file existence before attempting delete when getting next instance to appease Windows.&lt;/p&gt;

&lt;p&gt;Note: tried to follow the instructions for creating a code review, but the review web app would not let me attach the patch &quot;The selected file does not appear to be a diff.&quot;&lt;/p&gt;</comment>
                            <comment id="13634675" author="mpercy" created="Thu, 18 Apr 2013 00:29:05 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulchavez&quot; class=&quot;user-hover&quot; rel=&quot;paulchavez&quot;&gt;paulchavez&lt;/a&gt;, I think you got to the bottom of this one. Yep, it&apos;s a bug and I agree with your change to ReliableSpoolingFileEventReader.java. However, I am unclear on why you made the change you did to DurablePositionTracker.java. As far as I can tell, we already check at the top of getInstance() whether the file exists, so an additional check should be unnecessary.&lt;/p&gt;

&lt;p&gt;By the way, I had trouble applying your patch as well. I think you have a UTF BOM at the beginning of the file or something because it&apos;s messing with all my tools. I was able to manually remove those bytes and eventually apply your patch, but I bet that&apos;s why Review Board didn&apos;t like it.&lt;/p&gt;</comment>
                            <comment id="13634679" author="mpercy" created="Thu, 18 Apr 2013 00:29:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=scaph01&quot; class=&quot;user-hover&quot; rel=&quot;scaph01&quot;&gt;scaph01&lt;/a&gt;: Please take a look @ &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulchavez&quot; class=&quot;user-hover&quot; rel=&quot;paulchavez&quot;&gt;paulchavez&lt;/a&gt;&apos;s changes and let us know what you think. Thanks!&lt;/p&gt;</comment>
                            <comment id="13634793" author="paulchavez" created="Thu, 18 Apr 2013 03:28:25 +0000"  >&lt;p&gt;Mike, I agree the change to DurablePositionTracker.java is not required. I put that in there thinking a code path called delete on an already deleted file and then later a co-worker found the real issue. I should have backed it out before generating the diff. Thanks for the feedback on the file attach issue, now I think I can suppress the BOM with the windows tools I use.&lt;/p&gt;</comment>
                            <comment id="13634835" author="mpercy" created="Thu, 18 Apr 2013 04:50:02 +0000"  >&lt;p&gt;Paul do you want to resubmit your patch with only the desired changes?&lt;/p&gt;

&lt;p&gt;Otherwise I will revert the changes to that file on commit.&lt;/p&gt;</comment>
                            <comment id="13635288" author="scaph01" created="Thu, 18 Apr 2013 16:16:10 +0000"  >&lt;p&gt;Paul&apos;s fix is cleaner than mine, I have tested it locally and confirm that the spool source is working on my windows 7 machine.  My run of the unit tests failed, though I don&apos;t believe they ever 100% passed, if &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulchavez&quot; class=&quot;user-hover&quot; rel=&quot;paulchavez&quot;&gt;paulchavez&lt;/a&gt; has confirmed the unit tests work, then I am happy.&lt;/p&gt;</comment>
                            <comment id="13635316" author="paulchavez" created="Thu, 18 Apr 2013 16:37:19 +0000"  >&lt;p&gt;Update patch is attached. I have not attempted to run the unit tests, only did functional testing for this specific issue on Server 2008 R2. Review request submitted: &lt;a href=&quot;https://reviews.apache.org/r/10607/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/10607/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13635607" author="mpercy" created="Thu, 18 Apr 2013 20:03:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulchavez&quot; class=&quot;user-hover&quot; rel=&quot;paulchavez&quot;&gt;paulchavez&lt;/a&gt;, +1 on your latest patch.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=scaph01&quot; class=&quot;user-hover&quot; rel=&quot;scaph01&quot;&gt;scaph01&lt;/a&gt;, thanks for reporting this issue as well as reviewing and testing this patch.&lt;/p&gt;

&lt;p&gt;I think there are a few unit tests (particularly for Exec source) that fail on Windows, so for now since you guys have tested this manually let&apos;s go ahead with it.&lt;/p&gt;

&lt;p&gt;Since you worked together on this I&apos;ll attribute you both with in the commit. I&apos;m also adding you both as Flume contributors in JIRA, so you can assign JIRA tickets to yourselves now.&lt;/p&gt;

&lt;p&gt;Paul, since we settled on your version of the change, I&apos;m assigning this JIRA to you.&lt;/p&gt;</comment>
                            <comment id="13635663" author="paulchavez" created="Thu, 18 Apr 2013 20:38:35 +0000"  >&lt;p&gt;Mike, I&apos;m not clear on what further action I should take.&lt;/p&gt;</comment>
                            <comment id="13635785" author="mpercy" created="Thu, 18 Apr 2013 22:49:26 +0000"  >&lt;p&gt;Ah, you deleted the old one and replaced it. Looks good.&lt;/p&gt;

&lt;p&gt;I just pushed this change to trunk and flume-1.4 branches. Thanks for your contributions Paul and Phil!&lt;/p&gt;</comment>
                            <comment id="13636163" author="hudson" created="Fri, 19 Apr 2013 07:42:30 +0000"  >&lt;p&gt;Integrated in flume-trunk #396 (See &lt;a href=&quot;https://builds.apache.org/job/flume-trunk/396/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/flume-trunk/396/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-1993&quot; title=&quot;On Windows, when using the spooling directory source, there is a file sharing violation when trying to delete tracker file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-1993&quot;&gt;&lt;del&gt;FLUME-1993&lt;/del&gt;&lt;/a&gt;. Fix spooldir tracker file sharing violation on Windows. (Revision 6662b34c03511be65cdad8ead04860f7b0ab5fa6)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
mpercy : &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/flume/repo?p=flume.git&amp;amp;a=commit&amp;amp;h=6662b34c03511be65cdad8ead04860f7b0ab5fa6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/flume/repo?p=flume.git&amp;amp;a=commit&amp;amp;h=6662b34c03511be65cdad8ead04860f7b0ab5fa6&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;flume-ng-core/src/main/java/org/apache/flume/client/avro/ReliableSpoolingFileEventReader.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12579360" name="FLUME-1993.patch" size="896" author="paulchavez" created="Thu, 18 Apr 2013 16:37:19 +0000"/>
                            <attachment id="12578564" name="ReliableSpoolingFileEventReader.java" size="21380" author="scaph01" created="Sat, 13 Apr 2013 00:34:52 +0000"/>
                            <attachment id="12578567" name="ReliableSpoolingFileEventReader.java.patch" size="869" author="scaph01" created="Sat, 13 Apr 2013 00:56:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>322766</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 31 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1josf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323111</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>