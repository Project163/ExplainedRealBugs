<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:56:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLUME-1676] ExecSource should provide a configurable charset</title>
                <link>https://issues.apache.org/jira/browse/FLUME-1676</link>
                <project id="12311321" key="FLUME">Flume</project>
                    <description>&lt;p&gt;The character set is currently not configurable in the exec source - &lt;a href=&quot;http://flume.apache.org/FlumeUserGuide.html#exec-source&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flume.apache.org/FlumeUserGuide.html#exec-source&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;File - &lt;a href=&quot;https://github.com/apache/flume/blob/trunk/flume-ng-core/src/main/java/org/apache/flume/source/ExecSource.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flume/blob/trunk/flume-ng-core/src/main/java/org/apache/flume/source/ExecSource.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Can somebody please expose the ability to specify character set in the exec source?&lt;/p&gt;</description>
                <environment>&lt;p&gt;:~/apache-flume-1.4.0-SNAPSHOT/conf# ../bin/flume-ng version&lt;br/&gt;
Flume 1.4.0-SNAPSHOT&lt;br/&gt;
Source code repository: &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf/flume.git&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf/flume.git&lt;/a&gt;&lt;br/&gt;
Revision: 831a86fc5501a8624b184ea65e53749df31692b8&lt;br/&gt;
Compiled by jenkins on Tue Oct 30 03:18:08 UTC 2012&lt;br/&gt;
From source with checksum 98685e32b9e500a2305f538b4468faaa&lt;/p&gt;</environment>
        <key id="12614416">FLUME-1676</key>
            <summary>ExecSource should provide a configurable charset</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nitin_matrix">Nitin Verma</assignee>
                                    <reporter username="saggar">Suresh Saggar</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Thu, 1 Nov 2012 19:05:06 +0000</created>
                <updated>Fri, 14 Dec 2012 01:34:36 +0000</updated>
                            <resolved>Thu, 13 Dec 2012 19:39:19 +0000</resolved>
                                    <version>notrack</version>
                                    <fixVersion>1.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="13488942" author="mpercy" created="Thu, 1 Nov 2012 19:06:47 +0000"  >&lt;p&gt;Talked to Suresh about this on IRC. Example would be using exec source with a tail -F command on a file that is ISO-8859 encoded.&lt;/p&gt;</comment>
                            <comment id="13488948" author="saggar" created="Thu, 1 Nov 2012 19:16:11 +0000"  >&lt;p&gt;I was trying to setup a FLumeNG multi-tier workflow with agent01 running on some webserver using exec source &amp;amp; avro sink and other agent02 running on some webserver (a collector) using avro source and hdfs sink. &lt;/p&gt;

&lt;p&gt;Configuration file - &lt;a href=&quot;https://gist.github.com/3993648&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/3993648&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Although the data (here tail output) was getting written to hdfs, but when i cat the file I can see some formatting issues. Link to the HDFS output depicting formatting issue - &lt;a href=&quot;https://gist.github.com/3995476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/3995476&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13489312" author="nitin_matrix" created="Fri, 2 Nov 2012 08:52:14 +0000"  >&lt;p&gt;There are few questions around this request.&lt;/p&gt;

&lt;p&gt;Before that I would like to explain a bit about two charsets under consideration.&lt;/p&gt;

&lt;p&gt;Suppose we need to write a&#178;=&#188;b in ISO-8859-1 (&lt;a href=&quot;http://en.wikipedia.org/wiki/ISO/IEC_8859-1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://en.wikipedia.org/wiki/ISO/IEC_8859-1&lt;/a&gt;).&lt;br/&gt;
1. a,b,= fall in ASCII range, thus you can type&lt;br/&gt;
2. &#178; = B2, &#188; = BC in hex.&lt;/p&gt;

&lt;p&gt;$ awk &apos; BEGIN &lt;/p&gt;
{ printf &quot;a%s=%sb\n&quot;, &quot;\xB2&quot;, &quot;\xBC&quot; } &apos; &lt;br/&gt;
a&#65533;=&#65533;b&lt;br/&gt;
&lt;br/&gt;
Note: If this shows up as a&#178;=&#188;b, then you are on ISO-8859-1.&lt;br/&gt;
&lt;br/&gt;
Now let us encode the same in UTF-8 (&lt;a href=&quot;http://en.wikipedia.org/wiki/UTF-8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://en.wikipedia.org/wiki/UTF-8&lt;/a&gt;)&lt;br/&gt;
&lt;br/&gt;
   Char. number range  |        UTF-8 octet sequence&lt;br/&gt;
      (hexadecimal)    |              (binary)&lt;br/&gt;
   -------------------&lt;del&gt;+&lt;/del&gt;--------------------------------------------&lt;br/&gt;
   0000 0000-0000 007F | 0xxxxxxx&lt;br/&gt;
   0000 0080-0000 07FF | 110xxxxx 10xxxxxx&lt;br/&gt;
   0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx&lt;br/&gt;
   0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx&lt;br/&gt;
   and so on so forth&lt;br/&gt;
&lt;br/&gt;
The hex values for the chars is same in UTF-8 but it has to be encoded it is not a single byte charset (&#178; = B2, &#188; = BC )&lt;br/&gt;
&lt;br/&gt;
As B2 &amp;amp; BC &amp;gt; 7F and &amp;lt; 0800, it would be encoded in two bytes (110xxxxx 10xxxxxx)&lt;br/&gt;
B2 =&amp;gt; 1011 0010 =&amp;gt; 1100 0010 1011 0010 =&amp;gt; C2 B2&lt;br/&gt;
B2 =&amp;gt; 1011 1100 =&amp;gt; 1100 0010 1011 1100 =&amp;gt; C2 BC&lt;br/&gt;
&lt;br/&gt;
$ awk &apos; BEGIN { printf &quot;a%s=%sb\n&quot;, &quot;\xC2\xB2&quot;, &quot;\xC2\xBC&quot; } &apos; &lt;br/&gt;
a&#178;=&#188;b&lt;br/&gt;
&lt;br/&gt;
Note: If this shows up as a&#194;&#178;=&#194;&#188;b, then you are on ISO-8859-1.&lt;br/&gt;
&lt;br/&gt;
iconv tries to makes sure it translates bytes in such a way that from-charset is visible on to-charset terminal.&lt;br/&gt;
&lt;br/&gt;
Thus it would add C2, if I do the following.&lt;br/&gt;
&lt;br/&gt;
$ awk &apos; BEGIN { printf &quot;a%s=%sbn&quot;, &quot;xB2&quot;, &quot;xBC&quot; }
&lt;p&gt; &apos; | iconv -f &quot;ISO-8859-1&quot; -t &quot;UTF-8&quot;&lt;br/&gt;
a&#178;=&#188;b&lt;/p&gt;

&lt;p&gt;Warning:&lt;br/&gt;
There are many charsets around and not all charsets support all the characters. Thereby Byte translation is a lossy business. Example below:-&lt;br/&gt;
$ awk &apos; BEGIN &lt;/p&gt;
{ print &quot;\xE0\xA5\x90&quot; }
&lt;p&gt; &apos; | iconv -f &quot;UTF-8&quot; -t &quot;ISO-8859-1&quot;&lt;br/&gt;
iconv: illegal input sequence at position 0&lt;/p&gt;

&lt;p&gt;Considering all above, I feel&lt;/p&gt;

&lt;p&gt;Flume should concentrate on transferring byte to byte from one system to another, not translating. If the charset of two systems is different, then&lt;br/&gt;
source system: cat $file&lt;br/&gt;
sink system: cat $file | iconv -f source-charset -t sink-charset&lt;br/&gt;
should show the same visible output, till sink-charset defines all the characters defined in source-charset.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;Only guarantee flume should give is bytes transferred on sink are the same as the bytes given via the source **&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="13489324" author="mpercy" created="Fri, 2 Nov 2012 09:19:35 +0000"  >&lt;p&gt;Nitin: That is the guarantee Flume provides as a framework. I believe the request is the following:&lt;/p&gt;

&lt;p&gt;1. Provide a way to specify the charset that is provided on the terminal to Flume, so that the Exec Source knows how to decode it into a String.&lt;br/&gt;
2. Provide a way to specify the charset we will store in the Flume Event object itself, when the Exec Source encodes the String into binary form using EventBuilder.&lt;/p&gt;

&lt;p&gt;Without the capability to specify these encodings, a user doesn&apos;t have enough control over how the Exec Source interprets his text input data.&lt;/p&gt;

&lt;p&gt;(Edit: clarifications)&lt;/p&gt;</comment>
                            <comment id="13489504" author="nitin_matrix" created="Fri, 2 Nov 2012 15:55:57 +0000"  >&lt;p&gt;Hi Mike,&lt;/p&gt;

&lt;p&gt;I did some testing on constructing java strings using iso-8859-1 bytes. As java string translates from given bytes to UTF-16, if charset is not correct then it is lossy. (default is UTF-8)&lt;/p&gt;

&lt;p&gt;For flume we should ingest and egest bytes from strings using the charset so that channel get the same bytes as user source had, likewise the sink.&lt;/p&gt;

&lt;p&gt;string = new String(bytes, charset);&lt;br/&gt;
string.getBytes(charset);&lt;/p&gt;

&lt;p&gt;TODO: I would do similar tests on streams.&lt;/p&gt;

&lt;p&gt;Java Test Code&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; edu.nitin.testcodes;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.charset.Charset;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.testng.annotations.Test;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CharsetTest {

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testCharset() {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] bytes = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]{(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0x40, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0xC2, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0xE6,(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0x40};
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Charset charset = Charset.forName(&lt;span class=&quot;code-quote&quot;&gt;&quot;ISO-8859-1&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Input bytes&quot;&lt;/span&gt;);
        print(bytes);

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;ingest using charset&quot;&lt;/span&gt;);
        {
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; string = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(bytes, charset);
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(string);
            print(string.getBytes());
            print(string.getBytes(charset));
        }

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;ingest without using charset&quot;&lt;/span&gt;);
        {
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; string = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(bytes);
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(string);
            print(string.getBytes());
            print(string.getBytes(charset));
        }

    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void print(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; bytes[]) {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; b : bytes) {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;  %02X&quot;&lt;/span&gt;, b);
        }
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println();
    }
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Input bytes
  40  C2  E6  40
ingest using charset
@&#194;&#230;@
  40  C3  82  C3  A6  40
  40  C2  E6  40
ingest without using charset
@&#65533;&#65533;
  40  EF  BF  BD  EF  BF  BD
  40  3F  3F
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13489544" author="nitin_matrix" created="Fri, 2 Nov 2012 17:07:56 +0000"  >&lt;p&gt;Hi Mike,&lt;/p&gt;

&lt;p&gt;InputStreamReader needs to know the charset else readLine just messes it up.&lt;/p&gt;

&lt;p&gt;bufferedReader = new BufferedReader(new InputStreamReader(byteArrayInputStream, charset));&lt;br/&gt;
bufferedReader.readLine().getBytes(charset);&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; edu.nitin.testcodes;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.BufferedReader;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.ByteArrayInputStream;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.InputStreamReader;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.charset.Charset;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.testng.annotations.Test;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CharsetStreamTest {

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testCharset() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] bytes = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]{
            (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0x40, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0xC2, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0xE6, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0x40, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) &lt;span class=&quot;code-quote&quot;&gt;&apos;\n&apos;&lt;/span&gt;,
            (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0x41, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0xC2, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0xE6, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0x40, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) &lt;span class=&quot;code-quote&quot;&gt;&apos;\n&apos;&lt;/span&gt;,
            (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0x42, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0xC2, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0xE6, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0x40, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) &lt;span class=&quot;code-quote&quot;&gt;&apos;\n&apos;&lt;/span&gt;,
            (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0x43, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0xC2, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0xE6, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0x40, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) &lt;span class=&quot;code-quote&quot;&gt;&apos;\n&apos;&lt;/span&gt;,
            (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0x44, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0xC2, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0xE6, (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 0x40
        };

        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Charset charset = Charset.forName(&lt;span class=&quot;code-quote&quot;&gt;&quot;ISO-8859-1&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Input bytes&quot;&lt;/span&gt;);
        print(bytes);

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;ingest using charset&quot;&lt;/span&gt;);
        {
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ByteArrayInputStream byteArrayInputStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(bytes);

            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; BufferedReader bufferedReader = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedReader(
                    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InputStreamReader(byteArrayInputStream, charset));
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; line;
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((line = bufferedReader.readLine()) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                print(line.getBytes(charset));
            }
        }

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;ingest without using charset&quot;&lt;/span&gt;);
        {
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ByteArrayInputStream byteArrayInputStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(bytes);

            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; BufferedReader bufferedReader = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedReader(
                    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InputStreamReader(byteArrayInputStream));
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; line;
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((line = bufferedReader.readLine()) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                print(line.getBytes(charset));
            }
        }

    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void print(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; bytes[]) {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; b : bytes) {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;  %02X&quot;&lt;/span&gt;, b);
        }
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println();
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Input bytes
  40  C2  E6  40  0A  41  C2  E6  40  0A  42  C2  E6  40  0A  43  C2  E6  40  0A  44  C2  E6  40
ingest using charset
  40  C2  E6  40
  41  C2  E6  40
  42  C2  E6  40
  43  C2  E6  40
  44  C2  E6  40
ingest without using charset
  40  3F  3F  40
  41  3F  3F  40
  42  3F  3F  40
  43  3F  3F  40
  44  3F  3F
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13489555" author="nitin_matrix" created="Fri, 2 Nov 2012 17:19:14 +0000"  >&lt;p&gt;So there are two ways to deal these bytes&lt;br/&gt;
1. Do not use String/Reader, that is deal with InputStream/byte[].&lt;br/&gt;
2. Make String/Reader charset aware&lt;/p&gt;</comment>
                            <comment id="13490095" author="nitin_matrix" created="Sat, 3 Nov 2012 20:55:56 +0000"  >&lt;p&gt;From 22a33fb248fc60bd46a594c1980841ca6a19c8a1 Mon Sep 17 00:00:00 2001&lt;br/&gt;
From: Nitin Verma &amp;lt;nitin.matrix@gmail.com&amp;gt;&lt;br/&gt;
Date: Sun, 4 Nov 2012 02:07:49 +0530&lt;br/&gt;
Subject: &lt;span class=&quot;error&quot;&gt;&amp;#91;PATCH 2/2&amp;#93;&lt;/span&gt; Added charset support for ExecSource&lt;/p&gt;

&lt;p&gt;&amp;#8212;&lt;br/&gt;
 .../java/org/apache/flume/source/ExecSource.java   |   20 +++++++++++++++-----&lt;br/&gt;
 .../source/ExecSourceConfigurationConstants.java   |    8 ++++++++&lt;br/&gt;
 2 files changed, 23 insertions&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/add.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, 5 deletions&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/forbidden.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;diff --git a/flume-ng-core/src/main/java/org/apache/flume/source/ExecSource.java b/flume-ng-core/src/main/java/org/apache/flume/source/ExecSource.java&lt;br/&gt;
index 46f672f..9d3b70a 100644&lt;br/&gt;
&amp;#8212; a/flume-ng-core/src/main/java/org/apache/flume/source/ExecSource.java&lt;br/&gt;
+++ b/flume-ng-core/src/main/java/org/apache/flume/source/ExecSource.java&lt;br/&gt;
@@ -42,6 +42,7 @@ import org.slf4j.Logger;&lt;br/&gt;
 import org.slf4j.LoggerFactory;&lt;/p&gt;

&lt;p&gt; import com.google.common.base.Preconditions;&lt;br/&gt;
+import java.nio.charset.Charset;&lt;/p&gt;

&lt;p&gt; /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&amp;lt;p&amp;gt;&lt;br/&gt;
@@ -149,6 +150,7 @@ Configurable {&lt;br/&gt;
   private boolean logStderr;&lt;br/&gt;
   private Integer bufferCount;&lt;br/&gt;
   private ExecRunnable runner;&lt;br/&gt;
+  private Charset charset;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   @Override&lt;br/&gt;
   public void start() {&lt;br/&gt;
@@ -158,7 +160,7 @@ Configurable {&lt;br/&gt;
     counterGroup = new CounterGroup();&lt;/p&gt;

&lt;p&gt;     runner = new ExecRunnable(command, getChannelProcessor(), counterGroup,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;restart, restartThrottle, logStderr, bufferCount);&lt;br/&gt;
+        restart, restartThrottle, logStderr, bufferCount, charset);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     // FIXME: Use a callback-like executor / future to signal us upon failure.&lt;br/&gt;
     runnerFuture = executor.submit(runner);&lt;br/&gt;
@@ -224,13 +226,16 @@ Configurable &lt;/p&gt;
{
 
     bufferCount = context.getInteger(ExecSourceConfigurationConstants.CONFIG_BATCH_SIZE,
         ExecSourceConfigurationConstants.DEFAULT_BATCH_SIZE);
+    
+    charset = Charset.forName(context.getString(ExecSourceConfigurationConstants.CHARSET,
+        ExecSourceConfigurationConstants.DEFAULT_CHARSET));
   }

&lt;p&gt;   private static class ExecRunnable implements Runnable {&lt;/p&gt;

&lt;p&gt;     public ExecRunnable(String command, ChannelProcessor channelProcessor,&lt;br/&gt;
         CounterGroup counterGroup, boolean restart, long restartThrottle,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;boolean logStderr, int bufferCount) {&lt;br/&gt;
+        boolean logStderr, int bufferCount, Charset charset) {&lt;br/&gt;
       this.command = command;&lt;br/&gt;
       this.channelProcessor = channelProcessor;&lt;br/&gt;
       this.counterGroup = counterGroup;&lt;br/&gt;
@@ -238,6 +243,7 @@ Configurable 
{
       this.bufferCount = bufferCount;
       this.restart = restart;
       this.logStderr = logStderr;
+      this.charset = charset;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     private String command;&lt;br/&gt;
@@ -247,6 +253,7 @@ Configurable {&lt;br/&gt;
     private long restartThrottle;&lt;br/&gt;
     private int bufferCount;&lt;br/&gt;
     private boolean logStderr;&lt;br/&gt;
+    private Charset charset;&lt;br/&gt;
     private Process process = null;&lt;/p&gt;

&lt;p&gt;     @Override&lt;br/&gt;
@@ -258,11 +265,11 @@ Configurable {&lt;br/&gt;
           String[] commandArgs = command.split(&quot;&lt;br class=&quot;atl-forced-newline&quot; /&gt;s+&quot;);&lt;br/&gt;
           process = new ProcessBuilder(commandArgs).start();&lt;br/&gt;
           reader = new BufferedReader(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;new InputStreamReader(process.getInputStream()));&lt;br/&gt;
+              new InputStreamReader(process.getInputStream(), charset));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;           // StderrLogger dies as soon as the input stream is invalid&lt;br/&gt;
           StderrReader stderrReader = new StderrReader(new BufferedReader(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;new InputStreamReader(process.getErrorStream())), logStderr);&lt;br/&gt;
+              new InputStreamReader(process.getErrorStream(), charset)), logStderr);&lt;br/&gt;
           stderrReader.setName(&quot;StderrReader-&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot; + command + &amp;quot;&amp;#93;&lt;/span&gt;&quot;);&lt;br/&gt;
           stderrReader.setDaemon(true);&lt;br/&gt;
           stderrReader.start();&lt;br/&gt;
@@ -271,7 +278,7 @@ Configurable {&lt;br/&gt;
           List&amp;lt;Event&amp;gt; eventList = new ArrayList&amp;lt;Event&amp;gt;();&lt;br/&gt;
           while ((line = reader.readLine()) != null) {&lt;br/&gt;
             counterGroup.incrementAndGet(&quot;exec.lines.read&quot;);&lt;/li&gt;
	&lt;li&gt;eventList.add(EventBuilder.withBody(line.getBytes()));&lt;br/&gt;
+            eventList.add(EventBuilder.withBody(line.getBytes(charset)));&lt;br/&gt;
             if(eventList.size() &amp;gt;= bufferCount) {&lt;br/&gt;
               channelProcessor.processEventBatch(eventList);&lt;br/&gt;
               eventList.clear();&lt;br/&gt;
@@ -340,6 +347,9 @@ Configurable {&lt;br/&gt;
         String line = null;&lt;br/&gt;
         while((line = input.readLine()) != null) {&lt;br/&gt;
           if(logStderr) {&lt;br/&gt;
+            // There is no need to read &apos;line&apos; with a charset &lt;br/&gt;
+            // as we do not to propagate it.&lt;br/&gt;
+            // It is in UTF-16 and would be printed in UTF-8 format.&lt;br/&gt;
             logger.info(&quot;StderrLogger&lt;span class=&quot;error&quot;&gt;&amp;#91;{}&amp;#93;&lt;/span&gt; = &apos;{}&apos;&quot;, ++i, line);&lt;br/&gt;
           }&lt;br/&gt;
         }&lt;br/&gt;
diff --git a/flume-ng-core/src/main/java/org/apache/flume/source/ExecSourceConfigurationConstants.java b/flume-ng-core/src/main/java/org/apache/flume/source/ExecSourceConfigurationConstants.java&lt;br/&gt;
index 0ba0508..2176d20 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flume-ng-core/src/main/java/org/apache/flume/source/ExecSourceConfigurationConstants.java&lt;br/&gt;
+++ b/flume-ng-core/src/main/java/org/apache/flume/source/ExecSourceConfigurationConstants.java&lt;br/&gt;
@@ -18,6 +18,8 @@&lt;br/&gt;
  */&lt;br/&gt;
 package org.apache.flume.source;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+import java.nio.charset.Charset;&lt;br/&gt;
+&lt;br/&gt;
 public class ExecSourceConfigurationConstants {&lt;/p&gt;

&lt;p&gt;   /**&lt;br/&gt;
@@ -43,4 +45,10 @@ public class ExecSourceConfigurationConstants &lt;/p&gt;
{
    */
   public static final String CONFIG_BATCH_SIZE = &quot;batchSize&quot;;
   public static final int DEFAULT_BATCH_SIZE = 20;
+  
+  /**
+   * Charset for reading input
+   */
+  public static final String CHARSET = &quot;charset&quot;;
+  public static final String DEFAULT_CHARSET = &quot;UTF-8&quot;;
 }</comment>
                            <comment id="13490096" author="nitin_matrix" created="Sat, 3 Nov 2012 20:56:42 +0000"  >&lt;p&gt;attaching the patch please review.&lt;/p&gt;</comment>
                            <comment id="13494863" author="nitin_matrix" created="Sun, 11 Nov 2012 12:08:51 +0000"  >&lt;p&gt;Fix was uploaded on 3rd Nov, I am waiting for comments.&lt;/p&gt;</comment>
                            <comment id="13509367" author="roshan_naik" created="Tue, 4 Dec 2012 00:15:02 +0000"  >&lt;p&gt;would be nice to have it on review board.&lt;/p&gt;</comment>
                            <comment id="13525880" author="brocknoland" created="Thu, 6 Dec 2012 22:28:12 +0000"  >&lt;p&gt;Nitin,&lt;/p&gt;

&lt;p&gt;Thank you for the patch!! Since it&apos;s a non-trival patch, would you mind posting a review board item? reviews.apache.org&lt;/p&gt;

&lt;p&gt;Brock&lt;/p&gt;</comment>
                            <comment id="13525896" author="nitin_matrix" created="Thu, 6 Dec 2012 22:47:12 +0000"  >&lt;p&gt;Sure Done. Brock &amp;amp; Roshan&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/8383/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/8383/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13525980" author="brocknoland" created="Thu, 6 Dec 2012 22:57:09 +0000"  >&lt;p&gt;Thanks Nitin! I commented on the review board item. Thank you very much for the patch!!&lt;/p&gt;</comment>
                            <comment id="13531253" author="nitin_matrix" created="Thu, 13 Dec 2012 18:08:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/8383/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/8383/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;cleaned up, but not able to &apos;Update Diff&apos; the patch.&lt;/p&gt;</comment>
                            <comment id="13531377" author="brocknoland" created="Thu, 13 Dec 2012 19:39:19 +0000"  >&lt;p&gt;Committed to trunk and 1.4! Thanks Nitin for your contribution!&lt;/p&gt;</comment>
                            <comment id="13531899" author="hudson" created="Fri, 14 Dec 2012 01:34:36 +0000"  >&lt;p&gt;Integrated in flume-trunk #340 (See &lt;a href=&quot;https://builds.apache.org/job/flume-trunk/340/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/flume-trunk/340/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-1676&quot; title=&quot;ExecSource should provide a configurable charset&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-1676&quot;&gt;&lt;del&gt;FLUME-1676&lt;/del&gt;&lt;/a&gt;: ExecSource should provide a configurable charset (Revision d20c94ca61103632de2cd941a716dbd4d9c6d719)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
brock : &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/flume/repo?p=flume.git&amp;amp;a=commit&amp;amp;h=d20c94ca61103632de2cd941a716dbd4d9c6d719&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/flume/repo?p=flume.git&amp;amp;a=commit&amp;amp;h=d20c94ca61103632de2cd941a716dbd4d9c6d719&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;flume-ng-core/src/main/java/org/apache/flume/source/ExecSourceConfigurationConstants.java&lt;/li&gt;
	&lt;li&gt;flume-ng-core/src/main/java/org/apache/flume/source/ExecSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12623831">FLUME-1781</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12551994" name="flume-1676.patch" size="5371" author="nitin_matrix" created="Sat, 3 Nov 2012 20:56:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253745</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e4yf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80565</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Readers and Strings used for data exchange with native-process and channel are charset aware now. </customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>