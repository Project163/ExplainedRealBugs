<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:55:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLUME-827] Avro client conn failure results in 60-second wait before terminating</title>
                <link>https://issues.apache.org/jira/browse/FLUME-827</link>
                <project id="12311321" key="FLUME">Flume</project>
                    <description>&lt;p&gt;Launching the avro client when the Flume NG node isn&apos;t yet running will result in a conn refused error. The client should then shutdown immediately, but instead waits for 1 minute before the client is terminated.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12529585">FLUME-827</key>
            <summary>Avro client conn failure results in 60-second wait before terminating</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="esammer">Eric Sammer</assignee>
                                    <reporter username="will@cloudera.com">Will McQueen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Nov 2011 00:19:37 +0000</created>
                <updated>Fri, 2 Dec 2011 22:06:23 +0000</updated>
                            <resolved>Fri, 2 Dec 2011 21:26:20 +0000</resolved>
                                    <version>NG alpha 1</version>
                                    <fixVersion>NG alpha 2</fixVersion>
                                    <component>Node</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13140952" author="esammer" created="Tue, 1 Nov 2011 05:35:06 +0000"  >&lt;p&gt;Will:&lt;/p&gt;

&lt;p&gt;I was thinking about this and was thinking that the client should retry indefinitely (with warnings in the logs). The rationale is similar to that of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-823&quot; title=&quot;The properties configuration provider should fail if the configuration file is not found&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-823&quot;&gt;&lt;del&gt;FLUME-823&lt;/del&gt;&lt;/a&gt;. In this case, though, there&apos;s the potentially common possibility that the Avro server to which the client is connecting (e.g. another flume node in a tiered collection deployment) disappears temporarily (e.g. is restarted, a network partition). Ideally, the client would reestablish the connection, in this case, and continue transferring data. Thoughts?&lt;/p&gt;</comment>
                            <comment id="13141181" author="ralph.goers@dslextreme.com" created="Tue, 1 Nov 2011 13:54:05 +0000"  >&lt;p&gt;Retries should be left to the client. In my case, the Log4j2 client can be configured with multiple agents. If the first doesn&apos;t work it should fail over as fast as possible to its secondary agent.  I would expect this same behavior from Agents that are forwarding to other agents.  Ideally, the client should periodically check to see if the primary has come back and then switch back when it does.&lt;/p&gt;</comment>
                            <comment id="13141472" author="esammer" created="Tue, 1 Nov 2011 19:09:28 +0000"  >&lt;p&gt;+1 to what Ralph said. There will likely be pluggable policies that dictate how clients (sinks) pick from servers (sources) in tiered collection deployments. Think of not just HA but also load balancing policies. My original long design for this was that clients would never send to servers, but instead send to a group (which could be made up of a single server) with a policy (round robin, sticky selection (what Ralph describes), weighted, etc.).&lt;/p&gt;</comment>
                            <comment id="13141640" author="will@cloudera.com" created="Tue, 1 Nov 2011 21:47:39 +0000"  >&lt;p&gt;Okay, so it sounds like the client&apos;s retry policy should be configurable &amp;#8211; left to the client, as Ralph says. Since each agent can act as both a client and server (sink and source, respectively), then each sink and each source can have its own pluggable retry policy, as Eric suggests. The behavior of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-823&quot; title=&quot;The properties configuration provider should fail if the configuration file is not found&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-823&quot;&gt;&lt;del&gt;FLUME-823&lt;/del&gt;&lt;/a&gt; can also be dictated by these policies. Policies can be grabbed from a local config file (eg, flume.properties), although for a large number of agents I can see value in some kind of central management of policies with a policy server that agents would grab their configs from.&lt;/p&gt;

&lt;p&gt;Eric, for the original long design where clients send events to a group node that contains the retry policy (among other policies), if I understand correctly we&apos;d have something like this:&lt;/p&gt;

&lt;p&gt;Client ==&amp;gt; Group ==&amp;gt; Server&lt;/p&gt;

&lt;p&gt;What would be the client&apos;s retry policy if it&apos;s now the group node disappears temporarily?&lt;/p&gt;</comment>
                            <comment id="13149853" author="esammer" created="Mon, 14 Nov 2011 19:52:37 +0000"  >&lt;p&gt;Will:&lt;/p&gt;

&lt;p&gt;The idea is that the group is expanded. It&apos;s a logical construct, not physical. In other words, it&apos;s config syntax sugar only. The user says clients (sinks) a, b, and c are in group 1 and servers (sources) x and y are also in group 1. Now, flume understands it can load balance sinks a, b, and c to sources x and y. This is the same idea as Flume OG&apos;s autoChain (except we&apos;d load balance rather than stick to a single server although I suppose that could be another policy option). At least this was my thinking / idea.&lt;/p&gt;</comment>
                            <comment id="13149855" author="esammer" created="Mon, 14 Nov 2011 19:55:54 +0000"  >&lt;p&gt;Marking this a blocker. If the connection between the client and server breaks, the AvroSink currently doesn&apos;t not reconnect in any meaningful way. This breaks tiered collection.&lt;/p&gt;</comment>
                            <comment id="13161835" author="esammer" created="Fri, 2 Dec 2011 20:24:11 +0000"  >&lt;p&gt;Review up.&lt;/p&gt;</comment>
                            <comment id="13161837" author="jiraposter@reviews.apache.org" created="Fri, 2 Dec 2011 20:25:39 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2995/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/2995/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for Flume, Arvind Prabhakar and Prasad Mujumdar.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Properly detect RPC failures and reconnect as necessary.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-827&quot; title=&quot;Avro client conn failure results in 60-second wait before terminating&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-827&quot;&gt;&lt;del&gt;FLUME-827&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-827&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLUME-827&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  i/flume-ng-core/src/test/java/org/apache/flume/sink/TestAvroSink.java fead54f &lt;br/&gt;
  i/flume-ng-core/src/main/java/org/apache/flume/sink/AvroSink.java e1f381d &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2995/diff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/2995/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;New unit tests that confirm this works given a simple connect, send, kill server, send, start server, reconnect, deliver use case.&lt;br/&gt;
Ran manual tests with a pair of agents handling data during transient failures. Works!&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Eric&lt;/p&gt;
</comment>
                            <comment id="13161860" author="jiraposter@reviews.apache.org" created="Fri, 2 Dec 2011 21:21:39 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2995/#review3604&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/2995/#review3604&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;One thing I noted during the review which is unrelated is that the sink implementation is not thread safe. It is not a concern right now, but if we decide to move to multi-threaded pollable sink runners, that will need to be addressed.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Arvind&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-12-02 20:23:44, Eric Sammer wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2995/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/2995/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-12-02 20:23:44)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for Flume, Arvind Prabhakar and Prasad Mujumdar.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Properly detect RPC failures and reconnect as necessary.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-827&quot; title=&quot;Avro client conn failure results in 60-second wait before terminating&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-827&quot;&gt;&lt;del&gt;FLUME-827&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-827&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLUME-827&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;i/flume-ng-core/src/test/java/org/apache/flume/sink/TestAvroSink.java fead54f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;i/flume-ng-core/src/main/java/org/apache/flume/sink/AvroSink.java e1f381d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2995/diff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/2995/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;New unit tests that confirm this works given a simple connect, send, kill server, send, start server, reconnect, deliver use case.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ran manual tests with a pair of agents handling data during transient failures. Works!&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Eric&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13161862" author="esammer" created="Fri, 2 Dec 2011 21:26:20 +0000"  >&lt;p&gt;Committed to the flume-728 branch.&lt;/p&gt;</comment>
                            <comment id="13161873" author="hudson" created="Fri, 2 Dec 2011 22:06:23 +0000"  >&lt;p&gt;Integrated in flume-728 #65 (See &lt;a href=&quot;https://builds.apache.org/job/flume-728/65/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/flume-728/65/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-827&quot; title=&quot;Avro client conn failure results in 60-second wait before terminating&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-827&quot;&gt;&lt;del&gt;FLUME-827&lt;/del&gt;&lt;/a&gt;: Avro client conn failure results in 60-second wait before terminating&lt;/p&gt;

&lt;p&gt;esammer : &lt;a href=&quot;http://svn.apache.org/viewvc/?view=rev&amp;amp;rev=1209693&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/?view=rev&amp;amp;rev=1209693&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/incubator/flume/branches/flume-728/flume-ng-core/src/main/java/org/apache/flume/sink/AvroSink.java&lt;/li&gt;
	&lt;li&gt;/incubator/flume/branches/flume-728/flume-ng-core/src/test/java/org/apache/flume/sink/TestAvroSink.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>215445</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 51 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i09rb3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>54857</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>