<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:58:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLUME-3352] Unnecessary canary test will block on readonly spooldir while another trackerdir is set.</title>
                <link>https://issues.apache.org/jira/browse/FLUME-3352</link>
                <project id="12311321" key="FLUME">Flume</project>
                    <description>&lt;p&gt;&lt;b&gt;Phenomenon&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;In many cases, we have just read permission on spoolDir and write permission on trackerDir.&lt;/p&gt;

&lt;p&gt;However whenever flume starts for spooldir source , it will always try to create a &apos;.canary&apos; file in the spooling directory.&lt;/p&gt;

&lt;p&gt;Then it leads to the failure of some processing unnecessarily.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Recur&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;(Usually spooldir is mounted readonly from a nas in production and this time we create a readonly directory instead.)&lt;/p&gt;

&lt;p&gt;First we create the spoolDir by root user and create a file in it and it is readonly for others by default.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
su root
mkdir /home/hadoop/testspooldir
echo &lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt; &amp;gt; /home/hadoop/testspooldir/bar&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then switch to another user (hadoop) who runs flume and make sure it has read permission for the spooldir.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
su hadoop
mkdir /home/hadoop/testtrackerdir
ll /home/hadoop/testspooldir
&amp;gt;&amp;gt; total 4-rw-r--r-- 1 root root 4 Jan 16 19:15 bar&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;now create the example.conf:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a1.sources = r1
a1.sinks = k1
a1.channels = c1
a1.sources.r1.type = spooldir
a1.sources.r1.deletePolicy = never
a1.sources.r1.spoolDir = /home/hadoop/testspooldir
a1.sources.r1.trackerDir = /home/hadoop/testtrackerdir
a1.sources.r1.trackingPolicy = tracker_dir
a1.sinks.k1.type = logger
a1.channels.c1.type = memory
a1.channels.c1.capacity = 1000
a1.channels.c1.transactionCapacity = 100
a1.sources.r1.channels = c1
a1.sinks.k1.channel = c1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and start flume with it&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bin/flume-ng agent --conf conf --conf-file conf/example.conf --name a1 -Dflume.root.logger=INFO,console&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;then the IOException is thrown.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2020-01-16 19:16:12,777 (lifecycleSupervisor-1-0) [ERROR - org.apache.flume.lifecycle.LifecycleSupervisor$MonitorRunnable.run(LifecycleSupervisor.java:251)] Unabl2020-01-16 19:16:12,777 (lifecycleSupervisor-1-0) [ERROR - org.apache.flume.lifecycle.LifecycleSupervisor$MonitorRunnable.run(LifecycleSupervisor.java:251)] Unable to start EventDrivenSourceRunner: { source:Spool Directory source r1: { spoolDir: /home/hadoop/testspooldir } } - Exception follows.org.apache.flume.FlumeException: Unable to read and modify files in the spooling directory: /home/hadoop/testspooldir at org.apache.flume.client.avro.ReliableSpoolingFileEventReader.&amp;lt;init&amp;gt;(ReliableSpoolingFileEventReader.java:195) at org.apache.flume.client.avro.ReliableSpoolingFileEventReader.&amp;lt;init&amp;gt;(ReliableSpoolingFileEventReader.java:89) at org.apache.flume.client.avro.ReliableSpoolingFileEventReader$Builder.build(ReliableSpoolingFileEventReader.java:882) at org.apache.flume.source.SpoolDirectorySource.start(SpoolDirectorySource.java:111) at org.apache.flume.source.EventDrivenSourceRunner.start(EventDrivenSourceRunner.java:44) at org.apache.flume.lifecycle.LifecycleSupervisor$MonitorRunnable.run(LifecycleSupervisor.java:249) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180) at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)Caused by: java.io.IOException: Permission denied at java.io.UnixFileSystem.createFileExclusively(Native Method) at java.io.File.createTempFile(File.java:2024) at org.apache.flume.client.avro.ReliableSpoolingFileEventReader.&amp;lt;init&amp;gt;(ReliableSpoolingFileEventReader.java:185) ... 12 more&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Fix&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;We just add the condition where this trick is necessary.&lt;/p&gt;

&lt;p&gt;The pr/patch will be submitted as as shown below.&lt;/p&gt;

&lt;p&gt;Or let it still exist and using warning log instead of exception thrown is better?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13279808">FLUME-3352</key>
            <summary>Unnecessary canary test will block on readonly spooldir while another trackerdir is set.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="hackty">taoyang</reporter>
                        <labels>
                            <label>patch</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 16 Jan 2020 11:56:29 +0000</created>
                <updated>Wed, 1 Jun 2022 06:25:55 +0000</updated>
                                            <version>1.9.0</version>
                                                    <component>Sinks+Sources</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="6600">1h 50m</timespent>
                                <comments>
                            <comment id="17018875" author="hackty" created="Sun, 19 Jan 2020 11:04:59 +0000"  >&lt;p&gt;Fix &amp;amp; two unit tests were added to ensure the correctness.&lt;/p&gt;

&lt;p&gt;The description of two unit test:&lt;br/&gt;
 &lt;b&gt;testRenameTrackingPolicyOnReadonlySpoolDirectory&lt;/b&gt;&lt;br/&gt;
 One supplemented to examine the mechanisation of canary (RenameTrackingPolicy is enabled so the spooldir should have the write access.)&lt;br/&gt;
 It can pass no matter before or after the fix.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;testTrackerDirTrackingPolicyOnReadonlySpoolDirectory&lt;/b&gt;&lt;br/&gt;
 One that added to ensure the correctness on currect fix.(TrackerDirTrackingPolicy is enabled and the trackdir is different from spooldir. This time the write permission of spooldir is not necessary to the trackdir and also works well.)&lt;br/&gt;
 It can fail before the fix and pass after the fix.&lt;/p&gt;</comment>
                            <comment id="17046255" author="jira-bot" created="Thu, 27 Feb 2020 07:35:05 +0000"  >&lt;p&gt;Commit 5c9bfe6dc745d85f2459958b767e6e05550d8a81 in flume&apos;s branch refs/heads/trunk from Yang.Tao&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=flume.git;h=5c9bfe6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=flume.git;h=5c9bfe6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-3352&quot; title=&quot;Unnecessary canary test will block on readonly spooldir while another trackerdir is set.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-3352&quot;&gt;FLUME-3352&lt;/a&gt;: Skip spooldir canary when tracker dir is used (#314)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Unnecessary canary test will block on readonly spooldir while another trackerdir is set.&lt;/li&gt;
	&lt;li&gt;Add unit tests to ensure TrackingPolicy.RENAME / TrackingPolicy.TRACKER_DIR effective on readonly spooldir&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17046449" author="hudson" created="Thu, 27 Feb 2020 10:04:51 +0000"  >&lt;p&gt;ABORTED: Integrated in Jenkins build flume-trunk #767 (See &lt;a href=&quot;https://builds.apache.org/job/flume-trunk/767/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/flume-trunk/767/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-3352&quot; title=&quot;Unnecessary canary test will block on readonly spooldir while another trackerdir is set.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-3352&quot;&gt;FLUME-3352&lt;/a&gt;: Skip spooldir canary when tracker dir is used (#314) (github: &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/flume/repo?p=flume.git&amp;amp;a=commit&amp;amp;h=5c9bfe6dc745d85f2459958b767e6e05550d8a81&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/flume/repo?p=flume.git&amp;amp;a=commit&amp;amp;h=5c9bfe6dc745d85f2459958b767e6e05550d8a81&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) flume-ng-core/src/main/java/org/apache/flume/client/avro/ReliableSpoolingFileEventReader.java&lt;/li&gt;
	&lt;li&gt;(edit) flume-ng-core/src/test/java/org/apache/flume/client/avro/TestReliableSpoolingFileEventReader.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17316231" author="jira-bot" created="Wed, 7 Apr 2021 11:15:49 +0000"  >&lt;p&gt;Commit 5c9bfe6dc745d85f2459958b767e6e05550d8a81 in flume&apos;s branch refs/heads/dependabot/maven/hive.version-3.1.2 from Yang.Tao&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=flume.git;h=5c9bfe6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=flume.git;h=5c9bfe6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-3352&quot; title=&quot;Unnecessary canary test will block on readonly spooldir while another trackerdir is set.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-3352&quot;&gt;FLUME-3352&lt;/a&gt;: Skip spooldir canary when tracker dir is used (#314)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Unnecessary canary test will block on readonly spooldir while another trackerdir is set.&lt;/li&gt;
	&lt;li&gt;Add unit tests to ensure TrackingPolicy.RENAME / TrackingPolicy.TRACKER_DIR effective on readonly spooldir&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12991118" name="FLUME-3352-0.patch" size="2427" author="hackty" created="Thu, 16 Jan 2020 12:00:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 31 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0akmw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>