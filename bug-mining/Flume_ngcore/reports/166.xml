<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:57:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLUME-2798] Malformed Syslog messages can lead to OutOfMemoryException</title>
                <link>https://issues.apache.org/jira/browse/FLUME-2798</link>
                <project id="12311321" key="FLUME">Flume</project>
                    <description>&lt;p&gt;It&apos;s possible for a client submitting syslog data which is malformed in various ways to convince SyslogUtils.extractEvent to continually fill the ByteArrayOutputStream it uses to collect the event until the agent runs out of memory.  Since the OOM condition affects the whole agent, it&apos;s possible that a client sending such data (due to accident or malicious intent) to disable the agent, as long as it remains connected.&lt;/p&gt;

&lt;p&gt;Note that this is probably only possible using SyslogTcpSource although the fix touches common code in SyslogUtils.java.&lt;/p&gt;

&lt;p&gt;The issue can happen in two ways:&lt;/p&gt;

&lt;p&gt;Scenario 1: Send a message like this:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&amp;lt;&amp;gt; some more stuff here&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;This causes a NumberFormatException:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Sep 11, 2015 2:27:07 AM org.jboss.netty.channel.SimpleChannelHandler
WARNING: EXCEPTION, please implement org.apache.flume.source.SyslogTcpSource$syslogTcpHandler.exceptionCaught() &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; proper handling.
java.lang.NumberFormatException: For input string: &quot;&quot;
	at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.java:504)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.java:527)
	at org.apache.flume.source.SyslogUtils.buildEvent(SyslogUtils.java:198)
	at org.apache.flume.source.SyslogUtils.extractEvent(SyslogUtils.java:344)
	at org.apache.flume.source.SyslogTcpSource$syslogTcpHandler.messageReceived(SyslogTcpSource.java:76)
	at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:268)
	at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:255)
	at org.jboss.netty.channel.socket.nio.NioWorker.read(NioWorker.java:94)
	at org.jboss.netty.channel.socket.nio.AbstractNioWorker.processSelectedKeys(AbstractNioWorker.java:364)
	at org.jboss.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:238)
	at org.jboss.netty.channel.socket.nio.NioWorker.run(NioWorker.java:38)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This exception does not get handled, and it happens before reset() can be called.  The result is that the state machine in SyslogUtils gets stuck in the DATA state, and all subsequent data just gets appended to the baos, while the above exception streams to the log.  Eventually the agent runs out of memory.&lt;/p&gt;

&lt;p&gt;Scenario 2: Send some data like this:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&amp;lt;123...........&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;No length checking is done in the PRIO state so you could potentially fill the agent memory this way too.&lt;/p&gt;

&lt;p&gt;I&apos;m attaching a patch which handles both of these issues and adds more exception handling to buildEvent to make sure that reset() is called in future unforeseen situations.&lt;/p&gt;

&lt;p&gt;Thanks also to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roshan_naik&quot; class=&quot;user-hover&quot; rel=&quot;roshan_naik&quot;&gt;roshan_naik&lt;/a&gt; for helping to make this patch better.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12895004">FLUME-2798</key>
            <summary>Malformed Syslog messages can lead to OutOfMemoryException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tweek">Phil D&apos;Amore</assignee>
                                    <reporter username="tweek">Phil D&apos;Amore</reporter>
                        <labels>
                    </labels>
                <created>Sun, 20 Sep 2015 20:36:34 +0000</created>
                <updated>Sat, 18 Jun 2016 17:37:32 +0000</updated>
                            <resolved>Fri, 2 Oct 2015 23:20:14 +0000</resolved>
                                    <version>1.4.0</version>
                    <version>1.5.0</version>
                    <version>1.6.0</version>
                                    <fixVersion>1.7.0</fixVersion>
                                    <component>Sinks+Sources</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14941911" author="roshan_naik" created="Fri, 2 Oct 2015 22:42:56 +0000"  >&lt;p&gt;This patch looks good to me.&lt;br/&gt;
+1&lt;/p&gt;
</comment>
                            <comment id="14941938" author="jira-bot" created="Fri, 2 Oct 2015 23:10:09 +0000"  >&lt;p&gt;Commit c8eb221c6bbeb24a6e5073eb89e69e7cd2a10366 in flume&apos;s branch refs/heads/trunk from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roshan_naik&quot; class=&quot;user-hover&quot; rel=&quot;roshan_naik&quot;&gt;roshan_naik&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=flume.git;h=c8eb221&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=flume.git;h=c8eb221&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-2798&quot; title=&quot;Malformed Syslog messages can lead to OutOfMemoryException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-2798&quot;&gt;&lt;del&gt;FLUME-2798&lt;/del&gt;&lt;/a&gt;. Malformed Syslog messages can lead to OutOfMemoryException&lt;/p&gt;

&lt;p&gt;(Phil D&apos;Amore via Roshan Naik)&lt;/p&gt;</comment>
                            <comment id="14941940" author="jira-bot" created="Fri, 2 Oct 2015 23:10:31 +0000"  >&lt;p&gt;Commit 7dbe6fef6226d3fc2d8ada711c583b29ede3cfbd in flume&apos;s branch refs/heads/flume-1.7 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roshan_naik&quot; class=&quot;user-hover&quot; rel=&quot;roshan_naik&quot;&gt;roshan_naik&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=flume.git;h=7dbe6fe&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=flume.git;h=7dbe6fe&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-2798&quot; title=&quot;Malformed Syslog messages can lead to OutOfMemoryException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-2798&quot;&gt;&lt;del&gt;FLUME-2798&lt;/del&gt;&lt;/a&gt;. Malformed Syslog messages can lead to OutOfMemoryException&lt;/p&gt;

&lt;p&gt;(Phil D&apos;Amore via Roshan Naik)&lt;/p&gt;</comment>
                            <comment id="14941944" author="roshan_naik" created="Fri, 2 Oct 2015 23:12:51 +0000"  >&lt;p&gt;Its committed.&lt;/p&gt;

&lt;p&gt;Thanks very much for the patch  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tweek&quot; class=&quot;user-hover&quot; rel=&quot;tweek&quot;&gt;tweek&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="14942025" author="hudson" created="Sat, 3 Oct 2015 01:09:32 +0000"  >&lt;p&gt;FAILURE: Integrated in Flume-trunk-hbase-1 #128 (See &lt;a href=&quot;https://builds.apache.org/job/Flume-trunk-hbase-1/128/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Flume-trunk-hbase-1/128/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-2798&quot; title=&quot;Malformed Syslog messages can lead to OutOfMemoryException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-2798&quot;&gt;&lt;del&gt;FLUME-2798&lt;/del&gt;&lt;/a&gt;. Malformed Syslog messages can lead to OutOfMemoryException (roshan: &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/flume/repo?p=flume.git&amp;amp;a=commit&amp;amp;h=c8eb221c6bbeb24a6e5073eb89e69e7cd2a10366&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/flume/repo?p=flume.git&amp;amp;a=commit&amp;amp;h=c8eb221c6bbeb24a6e5073eb89e69e7cd2a10366&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;flume-ng-core/src/main/java/org/apache/flume/source/SyslogUDPSource.java&lt;/li&gt;
	&lt;li&gt;flume-ng-core/src/test/java/org/apache/flume/source/TestSyslogUtils.java&lt;/li&gt;
	&lt;li&gt;flume-ng-core/src/main/java/org/apache/flume/source/SyslogTcpSource.java&lt;/li&gt;
	&lt;li&gt;flume-ng-core/src/main/java/org/apache/flume/source/SyslogUtils.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12761352" name="FLUME-2798.patch" size="8700" author="tweek" created="Sun, 20 Sep 2015 20:39:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2lbqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>