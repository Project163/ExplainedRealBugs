<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:58:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLUME-2620] File channel throws NullPointerException if a header value is null</title>
                <link>https://issues.apache.org/jira/browse/FLUME-2620</link>
                <project id="12311321" key="FLUME">Flume</project>
                    <description>&lt;p&gt;File channel throws NullPointerException if a header value is null.&lt;br/&gt;
If this is intended, it should be reported correctly in the logs.&lt;/p&gt;

&lt;p&gt;Sample trace:&lt;/p&gt;

&lt;p&gt;org.apache.flume.ChannelException: Unable to put batch on required channel: FileChannel chan &lt;/p&gt;
{ dataDirs: [/var/lib/ingestion-csv/chan/data] }
&lt;p&gt;	at org.apache.flume.channel.ChannelProcessor.processEventBatch(ChannelProcessor.java:200)&lt;br/&gt;
	at org.apache.flume.source.SpoolDirectorySource$SpoolDirectoryRunnable.run(SpoolDirectorySource.java:236)&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)&lt;br/&gt;
	at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:304)&lt;br/&gt;
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:178)&lt;br/&gt;
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.flume.channel.file.proto.ProtosFactory$FlumeEventHeader$Builder.setValue(ProtosFactory.java:7415)&lt;br/&gt;
	at org.apache.flume.channel.file.Put.writeProtos(Put.java:85)&lt;br/&gt;
	at org.apache.flume.channel.file.TransactionEventRecord.toByteBuffer(TransactionEventRecord.java:174)&lt;br/&gt;
	at org.apache.flume.channel.file.Log.put(Log.java:622)&lt;br/&gt;
	at org.apache.flume.channel.file.FileChannel$FileBackedTransaction.doPut(FileChannel.java:469)&lt;br/&gt;
	at org.apache.flume.channel.BasicTransactionSemantics.put(BasicTransactionSemantics.java:93)&lt;br/&gt;
	at org.apache.flume.channel.BasicChannelSemantics.put(BasicChannelSemantics.java:80)&lt;br/&gt;
	at org.apache.flume.channel.ChannelProcessor.processEventBatch(ChannelProcessor.java:189)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12774181">FLUME-2620</key>
            <summary>File channel throws NullPointerException if a header value is null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marcellhegedus">Marcell Hegedus</assignee>
                                    <reporter username="smolav">Santiago M. Mola</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Feb 2015 11:53:03 +0000</created>
                <updated>Tue, 12 Sep 2017 13:51:08 +0000</updated>
                            <resolved>Tue, 25 Jul 2017 12:05:27 +0000</resolved>
                                                    <fixVersion>1.8.0</fixVersion>
                                    <component>File Channel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                                                                                <comments>
                            <comment id="14316828" author="hshreedharan" created="Wed, 11 Feb 2015 19:26:22 +0000"  >&lt;p&gt;I don&apos;t think it is, this is a minor fix. I will submit a patch soon.&lt;/p&gt;</comment>
                            <comment id="15265503" author="neerjakhattar" created="Sat, 30 Apr 2016 21:32:56 +0000"  >&lt;p&gt;Patch is attached to handle null values in header &lt;/p&gt;

&lt;p&gt;for example:&lt;br/&gt;
[{&lt;br/&gt;
  &quot;headers&quot; : &lt;/p&gt;
{
             &quot;timestamp&quot; : &quot;434324343&quot;,
             &quot;host&quot; : null
             }
&lt;p&gt;,&lt;br/&gt;
  &quot;body&quot; : &quot;random_body&quot;&lt;br/&gt;
  }]&lt;/p&gt;

&lt;p&gt;This used to fail previously and now it works.&lt;/p&gt;
</comment>
                            <comment id="15271819" author="neerjakhattar" created="Thu, 5 May 2016 02:59:57 +0000"  >&lt;p&gt;New patch is attached with test cases included.&lt;/p&gt;</comment>
                            <comment id="15272559" author="jarcec" created="Thu, 5 May 2016 16:05:18 +0000"  >&lt;p&gt;I have two comments to the &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12802350/FLUME-2620.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;latest patch&lt;/a&gt;:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Our code style is to put opening bracket next to the previous statement. E.g. &lt;tt&gt;if(headerVal.getValue()==null) {&lt;/tt&gt; on one single line rather then two. Can you please fix the method &lt;tt&gt;checkAndReplaceNullInHeaders&lt;/tt&gt; to look like that?&lt;/li&gt;
	&lt;li&gt;Can we introduce a configuration option that will allow user to configure the default &quot;replacement&quot; value for &lt;tt&gt;null&lt;/tt&gt;? I&apos;m concerned that someone might need to distinguish the case of value being &lt;tt&gt;null&lt;/tt&gt; or empty.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15275689" author="neerjakhattar" created="Sun, 8 May 2016 19:49:34 +0000"  >&lt;p&gt;New patch is attached for review&lt;/p&gt;</comment>
                            <comment id="15275936" author="neerjakhattar" created="Mon, 9 May 2016 04:50:13 +0000"  >&lt;p&gt;new patch is attached ( fixed the review board comments)&lt;/p&gt;</comment>
                            <comment id="15281082" author="neerjakhattar" created="Thu, 12 May 2016 01:01:19 +0000"  >&lt;p&gt;New patch is attached based on review board comments&lt;/p&gt;</comment>
                            <comment id="15282395" author="neerjakhattar" created="Fri, 13 May 2016 04:44:40 +0000"  >&lt;p&gt;updated patch  attached&lt;/p&gt;</comment>
                            <comment id="15298418" author="neerjakhattar" created="Tue, 24 May 2016 16:09:29 +0000"  >&lt;p&gt;new patch is attached with doc change.&lt;/p&gt;</comment>
                            <comment id="15319548" author="neerjakhattar" created="Tue, 7 Jun 2016 22:03:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jarcec&quot; class=&quot;user-hover&quot; rel=&quot;jarcec&quot;&gt;jarcec&lt;/a&gt; let me know if you need anything else. I updated the patch with doc info.&lt;/p&gt;</comment>
                            <comment id="15357396" author="neerjakhattar" created="Thu, 30 Jun 2016 16:27:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jarcec&quot; class=&quot;user-hover&quot; rel=&quot;jarcec&quot;&gt;jarcec&lt;/a&gt; any update?&lt;/p&gt;</comment>
                            <comment id="15415920" author="mpercy" created="Wed, 10 Aug 2016 20:03:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=neerjakhattar&quot; class=&quot;user-hover&quot; rel=&quot;neerjakhattar&quot;&gt;neerjakhattar&lt;/a&gt;: See my comment on reviewboard from a few weeks ago. Here is what I wrote: This doesn&apos;t look like it changes the file channel at all. Isn&apos;t that the underlying issue? Couldn&apos;t the FileChannel allow a null value in a header, or treat it as an empty string? Maybe that would be a cleaner solution.&lt;/p&gt;</comment>
                            <comment id="15415930" author="mpercy" created="Wed, 10 Aug 2016 20:11:00 +0000"  >&lt;p&gt;The above is just my opinion, I am happy for others to chime in if they prefer this solution&lt;/p&gt;</comment>
                            <comment id="15415938" author="mpercy" created="Wed, 10 Aug 2016 20:14:22 +0000"  >&lt;p&gt;Also &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jarcec&quot; class=&quot;user-hover&quot; rel=&quot;jarcec&quot;&gt;jarcec&lt;/a&gt; regarding your comment back in May, I don&apos;t think the Flume data model really supports null values in the headers because the schema for the header values is Map&amp;lt;String, String&amp;gt;. I would be more comfortable always casting null -&amp;gt; empty string and even implicitly performing this case by accepting null values in the FileChannel and coercing them to empty strings. Thoughts?&lt;/p&gt;</comment>
                            <comment id="15885550" author="marcellhegedus" created="Mon, 27 Feb 2017 10:45:49 +0000"  >&lt;p&gt;There was no activity on this issue in the past 6 months. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=neerjakhattar&quot; class=&quot;user-hover&quot; rel=&quot;neerjakhattar&quot;&gt;neerjakhattar&lt;/a&gt;, do you mind if I assign it to me? Your proposed patch fixes the issue in HTTP Source however the issue lays in File Channel and can be reproduced with other sources (eg. JMS Source). I&apos;d prefer if File Channel behaved similar to Memory Channel: accept null values in header.&lt;/p&gt;</comment>
                            <comment id="15905395" author="marcellhegedus" created="Fri, 10 Mar 2017 16:58:11 +0000"  >&lt;p&gt;Attaching new patch&lt;/p&gt;</comment>
                            <comment id="15923387" author="roshan_naik" created="Tue, 14 Mar 2017 01:43:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcellhegedus&quot; class=&quot;user-hover&quot; rel=&quot;marcellhegedus&quot;&gt;marcellhegedus&lt;/a&gt; i have added you as contributor. You should be able to go ahead and assign this JIRA yourself if you like.&lt;/p&gt;</comment>
                            <comment id="15923388" author="roshan_naik" created="Tue, 14 Mar 2017 01:46:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcellhegedus&quot; class=&quot;user-hover&quot; rel=&quot;marcellhegedus&quot;&gt;marcellhegedus&lt;/a&gt;  It is easier to review the patches if put on &lt;a href=&quot;https://reviews.apache.org/r/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Review Board&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15927649" author="marcellhegedus" created="Thu, 16 Mar 2017 08:12:57 +0000"  >&lt;p&gt;Uploaded patch to &lt;a href=&quot;https://reviews.apache.org/r/57617/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;reviewboard&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16099933" author="jira-bot" created="Tue, 25 Jul 2017 12:04:22 +0000"  >&lt;p&gt;Commit 1e69fc7c29f104a2117a62de11cba9b2a2c740e1 in flume&apos;s branch refs/heads/trunk from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcellhegedus&quot; class=&quot;user-hover&quot; rel=&quot;marcellhegedus&quot;&gt;marcellhegedus&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=flume.git;h=1e69fc7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=flume.git;h=1e69fc7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-2620&quot; title=&quot;File channel throws NullPointerException if a header value is null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-2620&quot;&gt;&lt;del&gt;FLUME-2620&lt;/del&gt;&lt;/a&gt;. File Channel to support empty values in headers&lt;/p&gt;

&lt;p&gt;Flume user guide does not specify whether a value in event header could be null or not.&lt;br/&gt;
Given an external system generating events which header values can be null and a user configures&lt;br/&gt;
Flume with Memory Channel then he will have no trouble.&lt;br/&gt;
Later on when the user changes Memory Channel to File Channel then Flume will fail with NPE.&lt;br/&gt;
It is because FC is serializing events with protocol buffer and header values are defined as&lt;br/&gt;
required in the proto file.&lt;br/&gt;
In this patch I have changed the value field to optional. However protocol buffer does not have&lt;br/&gt;
a notation for null and setting a field to null raises NPE again. Added a null check before&lt;br/&gt;
serialization to prevent this.&lt;br/&gt;
There is on caveat: When an optional field is not set, at deserialization it will be set to a&lt;br/&gt;
default value: in this case it will be empty string.&lt;/p&gt;

&lt;p&gt;Reviewers: Miklos Csanady&lt;/p&gt;

&lt;p&gt;(Marcell Hegedus via Denes Arvay)&lt;/p&gt;</comment>
                            <comment id="16099934" author="denes" created="Tue, 25 Jul 2017 12:05:19 +0000"  >&lt;p&gt;Thank you all for the contribution, I have committed and pushed this change. Marking the ticket as resolved.&lt;/p&gt;</comment>
                            <comment id="16100649" author="hudson" created="Tue, 25 Jul 2017 19:51:51 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build Flume-trunk-hbase-1 #261 (See &lt;a href=&quot;https://builds.apache.org/job/Flume-trunk-hbase-1/261/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Flume-trunk-hbase-1/261/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-2620&quot; title=&quot;File channel throws NullPointerException if a header value is null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-2620&quot;&gt;&lt;del&gt;FLUME-2620&lt;/del&gt;&lt;/a&gt;. File Channel to support empty values in headers (denes: &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/flume/repo?p=flume.git&amp;amp;a=commit&amp;amp;h=1e69fc7c29f104a2117a62de11cba9b2a2c740e1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/flume/repo?p=flume.git&amp;amp;a=commit&amp;amp;h=1e69fc7c29f104a2117a62de11cba9b2a2c740e1&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) flume-ng-channels/flume-file-channel/src/main/java/org/apache/flume/channel/file/Put.java&lt;/li&gt;
	&lt;li&gt;(edit) flume-ng-channels/flume-file-channel/src/main/proto/filechannel.proto&lt;/li&gt;
	&lt;li&gt;(edit) flume-ng-core/src/test/java/org/apache/flume/channel/TestMemoryChannel.java&lt;/li&gt;
	&lt;li&gt;(edit) flume-ng-channels/flume-file-channel/src/test/java/org/apache/flume/channel/file/TestFileChannel.java&lt;/li&gt;
	&lt;li&gt;(edit) flume-ng-channels/flume-file-channel/src/main/java/org/apache/flume/channel/file/proto/ProtosFactory.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16102603" author="hudson" created="Thu, 27 Jul 2017 02:07:27 +0000"  >&lt;p&gt;ABORTED: Integrated in Jenkins build Flume-trunk-hbase-1 #304 (See &lt;a href=&quot;https://builds.apache.org/job/Flume-trunk-hbase-1/304/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Flume-trunk-hbase-1/304/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/FLUME-2620&quot; title=&quot;File channel throws NullPointerException if a header value is null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLUME-2620&quot;&gt;&lt;del&gt;FLUME-2620&lt;/del&gt;&lt;/a&gt;. File Channel to support empty values in headers (denes: &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/flume/repo?p=flume.git&amp;amp;a=commit&amp;amp;h=1e69fc7c29f104a2117a62de11cba9b2a2c740e1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/flume/repo?p=flume.git&amp;amp;a=commit&amp;amp;h=1e69fc7c29f104a2117a62de11cba9b2a2c740e1&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) flume-ng-channels/flume-file-channel/src/main/java/org/apache/flume/channel/file/Put.java&lt;/li&gt;
	&lt;li&gt;(edit) flume-ng-channels/flume-file-channel/src/main/java/org/apache/flume/channel/file/proto/ProtosFactory.java&lt;/li&gt;
	&lt;li&gt;(edit) flume-ng-channels/flume-file-channel/src/main/proto/filechannel.proto&lt;/li&gt;
	&lt;li&gt;(edit) flume-ng-channels/flume-file-channel/src/test/java/org/apache/flume/channel/file/TestFileChannel.java&lt;/li&gt;
	&lt;li&gt;(edit) flume-ng-core/src/test/java/org/apache/flume/channel/TestMemoryChannel.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12802895" name="FLUME-2620-0.patch" size="7692" author="neerjakhattar" created="Sun, 8 May 2016 19:49:34 +0000"/>
                            <attachment id="12802919" name="FLUME-2620-1.patch" size="9340" author="neerjakhattar" created="Mon, 9 May 2016 04:50:13 +0000"/>
                            <attachment id="12803551" name="FLUME-2620-2.patch" size="8176" author="neerjakhattar" created="Thu, 12 May 2016 01:01:19 +0000"/>
                            <attachment id="12803795" name="FLUME-2620-3.patch" size="9071" author="neerjakhattar" created="Fri, 13 May 2016 04:44:40 +0000"/>
                            <attachment id="12805915" name="FLUME-2620-4.patch" size="13579" author="neerjakhattar" created="Tue, 24 May 2016 16:09:29 +0000"/>
                            <attachment id="12857353" name="FLUME-2620-5.patch" size="9828" author="marcellhegedus" created="Fri, 10 Mar 2017 16:58:11 +0000"/>
                            <attachment id="12802350" name="FLUME-2620.patch" size="3193" author="neerjakhattar" created="Thu, 5 May 2016 02:59:57 +0000"/>
                            <attachment id="12801616" name="FLUME-2620.patch" size="1339" author="neerjakhattar" created="Sat, 30 Apr 2016 21:32:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 16 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25h87:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>