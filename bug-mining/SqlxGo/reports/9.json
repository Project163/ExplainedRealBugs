{"url":"https://api.github.com/repos/jmoiron/sqlx/issues/41","repository_url":"https://api.github.com/repos/jmoiron/sqlx","labels_url":"https://api.github.com/repos/jmoiron/sqlx/issues/41/labels{/name}","comments_url":"https://api.github.com/repos/jmoiron/sqlx/issues/41/comments","events_url":"https://api.github.com/repos/jmoiron/sqlx/issues/41/events","html_url":"https://github.com/jmoiron/sqlx/issues/41","id":25205710,"node_id":"MDU6SXNzdWUyNTIwNTcxMA==","number":41,"title":"sqlx.DB makes a copy of sql.DB instead of using a pointer","user":{"login":"kdar","id":119919,"node_id":"MDQ6VXNlcjExOTkxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/119919?v=4","gravatar_id":"","url":"https://api.github.com/users/kdar","html_url":"https://github.com/kdar","followers_url":"https://api.github.com/users/kdar/followers","following_url":"https://api.github.com/users/kdar/following{/other_user}","gists_url":"https://api.github.com/users/kdar/gists{/gist_id}","starred_url":"https://api.github.com/users/kdar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kdar/subscriptions","organizations_url":"https://api.github.com/users/kdar/orgs","repos_url":"https://api.github.com/users/kdar/repos","events_url":"https://api.github.com/users/kdar/events{/privacy}","received_events_url":"https://api.github.com/users/kdar/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-01-07T23:32:04Z","updated_at":"2014-01-08T17:54:37Z","closed_at":"2014-01-08T17:54:35Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I am getting data races with sqlx because it takes a copy of sql.DB and therefore the mutexes are copies as well. This manifests itself when using sqlx.NewDb multiple times on the same sql.DB (this happens because of different libraries using sqlx but their interfaces pass around sql.DB).\n\nchanging\n\n```\ntype DB struct {\n        sql.DB\n        driverName string\n}\n\nfunc NewDb(db *sql.DB, driverName string) *DB {\n        return &DB{*db, driverName}\n}\n```\n\nto\n\n```\ntype DB struct {\n    *sql.DB\n    driverName string\n}\n\nfunc NewDb(db *sql.DB, driverName string) *DB {\n    return &DB{db, driverName}\n}\n```\n\nfixes this issue.\n\nAlso have to change `func Open(driverName, dataSourceName string) (*DB, error)`\n\nSee https://groups.google.com/forum/#!topic/golang-nuts/C4Cmjv6owCs\n","closed_by":{"login":"jmoiron","id":218132,"node_id":"MDQ6VXNlcjIxODEzMg==","avatar_url":"https://avatars.githubusercontent.com/u/218132?v=4","gravatar_id":"","url":"https://api.github.com/users/jmoiron","html_url":"https://github.com/jmoiron","followers_url":"https://api.github.com/users/jmoiron/followers","following_url":"https://api.github.com/users/jmoiron/following{/other_user}","gists_url":"https://api.github.com/users/jmoiron/gists{/gist_id}","starred_url":"https://api.github.com/users/jmoiron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jmoiron/subscriptions","organizations_url":"https://api.github.com/users/jmoiron/orgs","repos_url":"https://api.github.com/users/jmoiron/repos","events_url":"https://api.github.com/users/jmoiron/events{/privacy}","received_events_url":"https://api.github.com/users/jmoiron/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/jmoiron/sqlx/issues/41/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/jmoiron/sqlx/issues/41/timeline","performed_via_github_app":null,"state_reason":"completed"}