{"url":"https://api.github.com/repos/FasterXML/woodstox/issues/142","repository_url":"https://api.github.com/repos/FasterXML/woodstox","labels_url":"https://api.github.com/repos/FasterXML/woodstox/issues/142/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/woodstox/issues/142/comments","events_url":"https://api.github.com/repos/FasterXML/woodstox/issues/142/events","html_url":"https://github.com/FasterXML/woodstox/issues/142","id":1192997132,"node_id":"I_kwDOAVe4IM5HG7EM","number":142,"title":"`XMLEventReader` always returns the full content in text events, even if coalescing disabled","user":{"login":"johannesherr","id":7567298,"node_id":"MDQ6VXNlcjc1NjcyOTg=","avatar_url":"https://avatars.githubusercontent.com/u/7567298?v=4","gravatar_id":"","url":"https://api.github.com/users/johannesherr","html_url":"https://github.com/johannesherr","followers_url":"https://api.github.com/users/johannesherr/followers","following_url":"https://api.github.com/users/johannesherr/following{/other_user}","gists_url":"https://api.github.com/users/johannesherr/gists{/gist_id}","starred_url":"https://api.github.com/users/johannesherr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johannesherr/subscriptions","organizations_url":"https://api.github.com/users/johannesherr/orgs","repos_url":"https://api.github.com/users/johannesherr/repos","events_url":"https://api.github.com/users/johannesherr/events{/privacy}","received_events_url":"https://api.github.com/users/johannesherr/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/woodstox/milestones/25","html_url":"https://github.com/FasterXML/woodstox/milestone/25","labels_url":"https://api.github.com/repos/FasterXML/woodstox/milestones/25/labels","id":7427434,"node_id":"MI_kwDOAVe4IM4AcVVq","number":25,"title":"6.3.0","description":null,"creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":5,"state":"open","created_at":"2021-11-24T18:16:55Z","updated_at":"2022-06-27T23:42:07Z","due_on":null,"closed_at":null},"comments":5,"created_at":"2022-04-05T11:10:12Z","updated_at":"2022-04-30T02:48:15Z","closed_at":"2022-04-30T02:45:56Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The event based Woodstox API (XMLEventReader) always returns the full text content of elements. This leads to OutOfMemoryErrors, when the strings are large.\r\n\r\nThe specification seems to intend to split large text contents into multiple text events. Thereby allowing the user to avoid unlimited memory usage. That is the behaviour one sees in the JDK-Implementation of XMLInputFactory, com.sun.xml.internal.stream.XMLInputFactoryImpl.\r\n\r\nWoodstox seems to deliberately avoid this behaviour as seen here:\r\n```\r\nif (forER) {\r\n    /* 30-Sep-2005, TSa: No point in returning runt segments for event readers\r\n     *   (due to event object overhead, less convenient); let's just force\r\n     *   returning of full length segments.\r\n     */\r\n    mShortestTextSegment = Integer.MAX_VALUE;\r\n```\r\nhttps://github.com/FasterXML/woodstox/blob/e313616922c1dc3b1d72dfb2ab96c3e7cbb08dd7/src/main/java/com/ctc/wstx/sr/BasicStreamReader.java#L442\r\n\r\nAs far as I know the property javax.xml.stream.XMLInputFactory.IS_COALESCING should determine if a parser returns text contents as a single string. It has no effect on Woodstox behavior, unfortunately.\r\n\r\nThis makes it impossible for us to use the Woodstox parser.\r\n\r\nOur use case is, to transfer XML documents and to modify some of them slightly. Because we mostly pass the documents through unchanged, the event based api seems a good fit for us, because we do not want to change most of the document. Therefore, we read the xml events and pass them to a XMLEventWriter. In some cases we need to make changes and modify the events, before writing them out.\r\n\r\nSome documents we have to handle, contain up to 10 GB of data as text content of a single xml element. This leads to OOME, when the parser tries to return it as a single text event.\r\n\r\nIf this non-standard behavior of Woodstox is something you cannot fix, could you tell us what a workaround for this situation is? SAX or Stax base approaches seem a bad fit for our use case since you have to deliberately specify what parts of the xml you want to handle. This seems to increase the risk of inadvertently leaving out parts of the document and thereby causing unwanted changes, when processing it.\r\n","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/woodstox/issues/142/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/woodstox/issues/142/timeline","performed_via_github_app":null,"state_reason":"completed"}