diff --git a/release-notes/VERSION b/release-notes/VERSION
index 22e32e5..6424a81 100644
--- a/release-notes/VERSION
+++ b/release-notes/VERSION
@@ -4,6 +4,10 @@ Project: woodstox
 === Releases ===
 ------------------------------------------------------------------------
 
+6.2.5 (not yet released)
+
+#123: NPE for content that only has XML declaration and unknown encoding
+
 6.2.4 (11-Feb-2021)
 
 #122: Expected either attr limit (2147483647) >= currAttrSize (0) OR >= outBuf.length (96)
diff --git a/src/main/java/com/ctc/wstx/io/StreamBootstrapper.java b/src/main/java/com/ctc/wstx/io/StreamBootstrapper.java
index c6c2ad0..e7f3057 100644
--- a/src/main/java/com/ctc/wstx/io/StreamBootstrapper.java
+++ b/src/main/java/com/ctc/wstx/io/StreamBootstrapper.java
@@ -175,9 +175,8 @@ public final class StreamBootstrapper
                 normEnc = verifyXmlEncoding(mFoundEncoding);
             }
         } else {
-            /* We'll actually then just inherit whatever main doc had...
-             * (or in case there was no parent, just copy the 'unknown')
-             */
+            // We'll actually then just inherit whatever main doc had...
+            // (or in case there was no parent, just copy the 'unknown')
             mXml11Handling = (XmlConsts.XML_V_11 == xmlVersion);
         }
 
@@ -208,12 +207,10 @@ public final class StreamBootstrapper
                 normEnc = CharsetNames.CS_UTF8;
             }
         }
-
         mInputEncoding = normEnc;
 
-        /* And then the reader. Let's figure out if we can use our own fast
-         * implementations first:
-         */
+        // And then the reader. Let's figure out if we can use our own fast
+        // implementations first:
         BaseReader r;
 
         // Normalized, can thus use straight equality checks now
@@ -242,6 +239,13 @@ public final class StreamBootstrapper
                 } else {
                     in = new MergedStream(cfg, in, mByteBuffer, mInputPtr, mInputEnd);
                 }
+            } else {
+                // 03-Apr-2021, tatu: [woodstox-core#123] Edge case possible, too:
+                //   specifically, input only contains XML declaration, with an unknown
+                //   encoding, and no more input.
+                if (in == null) {
+                    in = new ByteArrayInputStream(mByteBuffer, 0, 0);
+                }
             }
             // 20-Jan-2006, TSa: Ok; although it is possible to declare
             //   stream as 'UTF-16', JDK may need help in figuring out
diff --git a/src/main/java/com/ctc/wstx/stax/WstxInputFactory.java b/src/main/java/com/ctc/wstx/stax/WstxInputFactory.java
index df1a9cd..f968334 100644
--- a/src/main/java/com/ctc/wstx/stax/WstxInputFactory.java
+++ b/src/main/java/com/ctc/wstx/stax/WstxInputFactory.java
@@ -745,24 +745,21 @@ public class WstxInputFactory
             encoding = ss.getEncoding();
 
             try {
-            	/* 11-Nov-2008, TSa: Let's add optimized handling for byte-block
-            	 *   source
-            	 */
-            	if (src instanceof Stax2ByteArraySource) {
-            		Stax2ByteArraySource bas = (Stax2ByteArraySource) src;
-            		bs = StreamBootstrapper.getInstance(pubId, SystemId.construct(sysId), bas.getBuffer(), bas.getBufferStart(), bas.getBufferEnd());
-            	} else {
-            		in = ss.constructInputStream();
-            		if (in == null) {
-            			r = ss.constructReader();
-            		}
-            	}
+                // 11-Nov-2008, TSa: Let's add optimized handling for byte-block source
+                if (src instanceof Stax2ByteArraySource) {
+                    Stax2ByteArraySource bas = (Stax2ByteArraySource) src;
+                    bs = StreamBootstrapper.getInstance(pubId, SystemId.construct(sysId), bas.getBuffer(), bas.getBufferStart(), bas.getBufferEnd());
+                } else {
+                    in = ss.constructInputStream();
+                    if (in == null) {
+                        r = ss.constructReader();
+                    }
+                }
             } catch (IOException ioe) {
                 throw new WstxIOException(ioe);
             }
-            /* Caller has no direct access to stream/reader, Woodstox
-             * owns it and thus has to close too
-             */
+            // Caller has no direct access to stream/reader, Woodstox
+            // owns it and thus has to close too
             autoCloseInput = true;
         } else  if (src instanceof StreamSource) {
             StreamSource ss = (StreamSource) src;
@@ -772,15 +769,13 @@ public class WstxInputFactory
             if (in == null) {
                 r = ss.getReader();
             }
-            /* Caller still has access to stream/reader; no need to
-             * force auto-close-input
-             */
+            // Caller still has access to stream/reader; no need to
+            // force auto-close-input
             autoCloseInput = cfg.willAutoCloseInput();
         } else if (src instanceof SAXSource) {
             SAXSource ss = (SAXSource) src;
-            /* 28-Jan-2006, TSa: Not a complete implementation, but maybe
-             *   even this might help...
-             */
+            // 28-Jan-2006, TSa: Not a complete implementation, but maybe
+            //   even this might help...
             sysId = ss.getSystemId();
             InputSource isrc = ss.getInputSource();
             if (isrc != null) {
@@ -790,9 +785,8 @@ public class WstxInputFactory
                     r = isrc.getCharacterStream();
                 }
             }
-            /* Caller still has access to stream/reader; no need to
-             * force auto-close-input
-             */
+            // Caller still has access to stream/reader; no need to
+            // force auto-close-input
             autoCloseInput = cfg.willAutoCloseInput();
         } else if (src instanceof DOMSource) {
             DOMSource domSrc = (DOMSource) src;
@@ -802,25 +796,25 @@ public class WstxInputFactory
             throw new IllegalArgumentException("Can not instantiate Stax reader for XML source type "+src.getClass()+" (unrecognized type)");
         }
         if (bs == null) { // may have already created boostrapper...
-		    if (r != null) { 
-		    	bs = ReaderBootstrapper.getInstance(pubId, SystemId.construct(sysId), r, encoding);
-		    } else if (in != null) {
-		    	bs = StreamBootstrapper.getInstance(pubId, SystemId.construct(sysId), in);
-		    } else if (sysId != null && sysId.length() > 0) {
-		    	/* 26-Dec-2008, TSa: If we must construct URL from system id,
-		    	 *   it means caller will not have access to resulting
-		    	 *   stream, thus we will force auto-closing.
-		    	 */
-		    	autoCloseInput = true;
-		    	try {
-		    		return createSR(cfg, URLUtil.urlFromSystemId(sysId),
-		    				forER, autoCloseInput);
-		    	} catch (IOException ioe) {
-		    		throw new WstxIOException(ioe);
-		    	}
-		    } else {
-		    	throw new XMLStreamException("Can not create Stax reader for the Source passed -- neither reader, input stream nor system id was accessible; can not use other types of sources (like embedded SAX streams)");
-		    }
+            if (r != null) { 
+                bs = ReaderBootstrapper.getInstance(pubId, SystemId.construct(sysId), r, encoding);
+            } else if (in != null) {
+                bs = StreamBootstrapper.getInstance(pubId, SystemId.construct(sysId), in);
+            } else if (sysId != null && sysId.length() > 0) {
+                /* 26-Dec-2008, TSa: If we must construct URL from system id,
+                 *   it means caller will not have access to resulting
+                 *   stream, thus we will force auto-closing.
+                 */
+                autoCloseInput = true;
+                try {
+                    return createSR(cfg, URLUtil.urlFromSystemId(sysId),
+                            forER, autoCloseInput);
+                } catch (IOException ioe) {
+                    throw new WstxIOException(ioe);
+                }
+            } else {
+                throw new XMLStreamException("Can not create Stax reader for the Source passed -- neither reader, input stream nor system id was accessible; can not use other types of sources (like embedded SAX streams)");
+            }
         }
         return createSR(cfg, sysId, bs, forER, autoCloseInput);
     }
diff --git a/src/test/java/org/codehaus/stax/test/stream/TestXmlDecl.java b/src/test/java/org/codehaus/stax/test/stream/TestXmlDecl.java
index e382ac9..500e738 100644
--- a/src/test/java/org/codehaus/stax/test/stream/TestXmlDecl.java
+++ b/src/test/java/org/codehaus/stax/test/stream/TestXmlDecl.java
@@ -72,12 +72,10 @@ public class TestXmlDecl
 
     public void testInvalidDeclXXX() throws Exception
     {
-        final String XML = "<?xml version=\"1.1\" encoding=\"U\"?>";
+        final byte[] XML = "<?xml version=\"1.1\" encoding=\"U\"?>".getBytes("UTF-8");
         final XMLInputFactory xmlF = getFactory(true);
-
         try {
-            XMLStreamReader sr = xmlF.createXMLStreamReader(new ByteArrayInputStream(
-                    XML.getBytes("UTF-8")));
+            XMLStreamReader sr = xmlF.createXMLStreamReader(new ByteArrayInputStream(XML));
             sr.next();
             fail("Should not pass");
         } catch (XMLStreamException e) {
diff --git a/src/test/java/stax2/stream/TestStreamSource.java b/src/test/java/stax2/stream/TestStreamSource.java
index 8af20f2..aedb0fd 100644
--- a/src/test/java/stax2/stream/TestStreamSource.java
+++ b/src/test/java/stax2/stream/TestStreamSource.java
@@ -4,6 +4,8 @@ import java.io.*;
 import javax.xml.stream.*;
 import javax.xml.transform.stream.StreamSource;
 
+import org.codehaus.stax2.io.Stax2ByteArraySource;
+
 import stax2.BaseStax2Test;
 
 /**
@@ -21,8 +23,7 @@ public class TestStreamSource
      * This test is related to problem reported as [WSTX-182], inability
      * to use SystemId alone as source.
      */
-    public void testCreateUsingSystemId()
-        throws IOException, XMLStreamException
+    public void testCreateUsingSystemId() throws Exception
     {
         File tmpF = File.createTempFile("staxtest", ".xml");
         tmpF.deleteOnExit();
@@ -40,4 +41,19 @@ public class TestStreamSource
         assertTokenType(END_ELEMENT, sr.next());
         sr.close();
     }
+
+    // For [woodstox-core#123]: edge case where content ends right after XML declaration
+    // with unrecognized encoding
+    public void testInvalidDecl123() throws Exception
+    {
+        final byte[] XML = "<?xml version=\"1.1\" encoding=\"U\"?>".getBytes("UTF-8");
+        final XMLInputFactory xmlF = getInputFactory();
+        try {
+            XMLStreamReader sr = xmlF.createXMLStreamReader(new Stax2ByteArraySource(XML, 0, XML.length));
+            sr.next();
+            fail("Should not pass");
+        } catch (XMLStreamException e) {
+            verifyException(e, "Unsupported encoding: U");
+        }
+    }
 }
