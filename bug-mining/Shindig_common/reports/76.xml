<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:34:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SHINDIG-1935] Add org.apache.xerces.dom.DeferredElementNSImpl to sizeoffilter.txt to have EH Cache ignore this class</title>
                <link>https://issues.apache.org/jira/browse/SHINDIG-1935</link>
                <project id="12310741" key="SHINDIG">Shindig</project>
                    <description>&lt;p&gt;When rendering a gadget I am seeing a warning from EH Cache saying it had exceeded the 1000 object limit when traversing the object graph.  After enabling additional EH Cache logging it looks like the class org.apache.xerces.dom.DeferredElementNSImpl has a pretty big object graph.  I believe this class is used to represent DOM elements so it could be that the HTML for the gadget is fairly large making the object graph representing one of the elements pretty large as well.  I think it is safe to ignore this class since classing the Java Object representation of the HTML is not as important as caching the HTML itself.    I have attached the EH Cache debug with the details of the object graph.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12672810">SHINDIG-1935</key>
            <summary>Add org.apache.xerces.dom.DeferredElementNSImpl to sizeoffilter.txt to have EH Cache ignore this class</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rbaxter">Ryan Baxter</assignee>
                                    <reporter username="rbaxter">Ryan Baxter</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Oct 2013 13:05:30 +0000</created>
                <updated>Mon, 23 Dec 2013 21:10:09 +0000</updated>
                            <resolved>Mon, 23 Dec 2013 21:10:09 +0000</resolved>
                                    <version>2.5.0</version>
                    <version>2.5.1</version>
                    <version>2.5.0-update1</version>
                                    <fixVersion>2.5.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13789208" author="ssievers" created="Tue, 8 Oct 2013 13:30:59 +0000"  >&lt;p&gt;Do you know which cache is using this class?  A quick look and I see that org.apache.shindig.gadgets.templates.TemplateLibraryFactory is storing org.w3c.dom.Element.  &lt;/p&gt;

&lt;p&gt;Is your gadget using templates when you see this error?&lt;/p&gt;</comment>
                            <comment id="13789395" author="rbaxter" created="Tue, 8 Oct 2013 17:02:30 +0000"  >&lt;p&gt;Right it is the cache in the TemplateLibraryFactory (parsedXml) which is causing the warning.  There is a template library being used by the gadget.  Ignoring the class will still result in the object being cached but we just won&apos;t know how big the object is.  I can see how that effects sizing of the cache.  What I can&apos;t find much information on is how to determine if there are shared resources within the class we can ignore.  Given that we are just relying on underlying libraries to build the Document for us I would think it would difficult to find out what to ignore.  Would it be possible to determine shared resources from the object graph?  I can&apos;t find much information on how to interpret them.  &lt;/p&gt;</comment>
                            <comment id="13789963" author="hsaputra" created="Wed, 9 Oct 2013 02:57:29 +0000"  >&lt;p&gt;Did setting DeferredElementNSImpl  to the ignore list solve the warning issue?&lt;/p&gt;

&lt;p&gt;Maybe we could just create simple cache for the DOM element in Guava cache which just requires the object to be in the heap I believe.&lt;/p&gt;</comment>
                            <comment id="13790267" author="ssievers" created="Wed, 9 Oct 2013 11:47:28 +0000"  >&lt;p&gt;I don&apos;t think there&apos;s anything you can really do given what is currently being cached.  Because TemplateLibraryFactory is caching Element, we can&apos;t straight out ignore Element.  We would need insight into the Element implementation which is a bad smell.&lt;/p&gt;

&lt;p&gt;Taking a step back, I think the better solution may be to change what TemplateLibraryFactory is caching.  Today the TemplateLibraryFactory caches an Element, which is simply the result of an XML parse of the response from the request for the template.  That&apos;s all well and good, but it immediately turns around and creates the actual TemplateLibrary from that content.  Why not cache the TemplateLibrary, which does further processing on the Element?  And because we own XmlTemplateLibrary (the only implementation of TemplateLibrary), we have a much better chance of ignoring content in the object graph that shouldn&apos;t count towards the size of the object in the cache.  Btw, looking at XmlTemplateLibrary, it doesn&apos;t appear to store any complex objects that would blow up its object graph.&lt;/p&gt;

&lt;p&gt;To Henry&apos;s point, I&apos;d rather not get into a pattern of using one-off caches that aren&apos;t provided by CacheProvider for these types of cases.  If we run into a problem like this that can&apos;t be resolved using the standard EhCache implementation, I think we should look at improving our the EhCache implementation.&lt;/p&gt;</comment>
                            <comment id="13791642" author="rbaxter" created="Thu, 10 Oct 2013 16:27:35 +0000"  >&lt;p&gt;Actually the XMLTemplateLibrary DefaultTagRegistry will end up storing instances of DeferredElementNSImpl, specifically inside the TemplateBasedHandler class.  I tried making the changes but EHCache still runs into the 1000 object limit when rendering my gadget because of this.&lt;/p&gt;

&lt;p&gt;I see the value in caching the DOM of the template so we don&apos;t have to do that parse all the time, especially when it is a shared template library.&lt;/p&gt;

&lt;p&gt;I am not sure if my question from above was answered, when we ignore an object do we still cache that object but just not include its sizing in the calculation of the parent objects overall size?  Is that because that specific object is cached elsewhere in the cache already?&lt;/p&gt;</comment>
                            <comment id="13792232" author="rbaxter" created="Fri, 11 Oct 2013 01:37:20 +0000"  >&lt;p&gt;What is we just cache the XML string?&lt;/p&gt;</comment>
                            <comment id="13792247" author="ssievers" created="Fri, 11 Oct 2013 01:49:19 +0000"  >&lt;p&gt;Caching just the XML string doesn&apos;t buy us much since the httpResponses cache is doing pretty much the same thing.  The purpose of this cache is to cache the parsed content so we don&apos;t have to do it again.&lt;/p&gt;

&lt;p&gt;I want to look a little more into exactly what parts of the template Element we need and should hang onto.&lt;/p&gt;</comment>
                            <comment id="13822195" author="linyunz" created="Thu, 14 Nov 2013 06:12:24 +0000"  >&lt;p&gt;By enabling the DEBUG level log in net.sf.ehcache.pool.sizeof.ObjectGraphWalker, we can see lots of String objects visited when ehcache calculates the size of the parsed xml .  It appears each line in the Javascript CDATA section generates a String , and two objects will be counted  (the String and its char array) .  The default sizeOf policy sets the maxDepth to 1000, which means if the javascript code in the template reaches around 500 lines,  this warning will be thrown. &lt;/p&gt;

&lt;p&gt;The javascript in template can be complex . 500 lines may not be enough.  We have specific sizeof policy setting for FeatureJSCache,  increasing the maxDepth to 5000. I think it makes sense to use a specific cache setting for template cache as well. &lt;/p&gt;

&lt;p&gt;Another option is to cache a processed xml file instead of the original one, for example, compact the js code in template or simply remove all new lines in the js.  This helps to reduce the string object number. This would most likely effect the readability of the code sent to the browser. But when we enable the cache , we are most likely in a production environment.  Or maybe we can provide an option to configure whether we will compact the js before caching the template . &lt;/p&gt;</comment>
                            <comment id="13847221" author="linyunz" created="Fri, 13 Dec 2013 07:08:50 +0000"  >&lt;p&gt;A patch for this JIRA. &lt;/p&gt;

&lt;p&gt;This patch contains two changes . The first change is to increase the maxDepth of sizeOfPolicy for template library cache,   as the template file can be complex enough to exceed the original 1000 limitation .&lt;/p&gt;

&lt;p&gt;Another change is to rewrite the template xml string before parsing.  This reduces the string object number counted by ehcache. The rewrite can be controlled by a property in shindig.properties.  The negative impact is it would impact the readability of the gadget code in browser. &lt;/p&gt;</comment>
                            <comment id="13855929" author="rbaxter" created="Mon, 23 Dec 2013 21:10:09 +0000"  >&lt;p&gt;Committed revision 1553211&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12618550" name="fix-1935-bug.patch" size="5154" author="linyunz" created="Fri, 13 Dec 2013 07:08:50 +0000"/>
                            <attachment id="12607359" name="org.apache.xerces.dom.DeferredElementNSImpl.txt" size="34235" author="rbaxter" created="Tue, 8 Oct 2013 13:10:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352433</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 47 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1orhr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352720</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>