<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:34:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SHINDIG-1192] content-rewrite is not compliant with Open Social v0.9, plus some bugs</title>
                <link>https://issues.apache.org/jira/browse/SHINDIG-1192</link>
                <project id="12310741" key="SHINDIG">Shindig</project>
                    <description>&lt;p&gt;Description of the issues, and details of the associated patch file:&lt;/p&gt;

&lt;p&gt;Issues:&lt;br/&gt;
1) Not compliant with 0.9 spec: &lt;a href=&quot;http://www.opensocial.org/Technical-Resources/opensocial-spec-v09/Gadgets-API-Specification.html#rfc.section.3.4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.opensocial.org/Technical-Resources/opensocial-spec-v09/Gadgets-API-Specification.html#rfc.section.3.4&lt;/a&gt;&lt;br/&gt;
     Shindig uses include-urls, exclude-urls (note: plural) which are regular expressions&lt;br/&gt;
     Specification use include-url, exclude-url which are case insensitive matches, plus it allows multiple occurrences of these tags.&lt;br/&gt;
     Note: no effort to support minify for this patch&lt;br/&gt;
   Fix: Alter the code to honor these tags. For backward compatibility the old &quot;plural&quot; tags are also accepted. &lt;/p&gt;

&lt;p&gt;2) Throughout Shindig parameters &quot;debug&quot; and &quot;nocache&quot; have been used and honored for various requests. For the rewriters it is missing. &quot;nocache&quot; is obvious. &quot;debug&quot; is not used today, but could be used to support the minify options of the future.&lt;br/&gt;
   Fix: Alter the rewriters to properly pass the debug and nocache from the HttpRequest or GadgetContext to the end URL.&lt;/p&gt;

&lt;p&gt;3) The concat rewriter takes a list of URLs and rewrites them so that it does not exceed some max length. However the test was done after the appending which could lead to a URL that was too long.&lt;br/&gt;
   Fix: Altered the algorithm so it will check the predicted length prior to appending.&lt;/p&gt;

&lt;p&gt;4) The concat rewriter did not handle a gadget authors link that was originally too long. &lt;br/&gt;
   Fix: Since concat is for the benefit of the gadget author (as opposed to security), original links that are too long are simply passed through without being rewritten.&lt;/p&gt;

&lt;p&gt;5) The ConcatProxyServlet is vulnerable to response splitting: &lt;a href=&quot;http://www.google.com/search?q=response+splitting+vulnerability&amp;amp;ie=utf-8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.google.com/search?q=response+splitting+vulnerability&amp;amp;ie=utf-8&lt;/a&gt;&lt;br/&gt;
   Fix: Check for \r \n in header&lt;/p&gt;

&lt;p&gt;6) The concat rewriter (or concat servlet) did not do caching header correctly.&lt;br/&gt;
   Fix: Borrowing from how the proxy rewriters did it, added the refresh parameter to the concat URL&lt;/p&gt;

&lt;p&gt;Enhancements&lt;/p&gt;

&lt;p&gt;1) Because: this is optional feature; and this costs resources server side, I felt that to allow a gadget author to include additional resources that were explicitly excluded by the original server config, or to allow the gadget author to extend the expires time beyond the original server config times would be an issue. Therefore added a configuration parameter to shindig properties &quot;shindig.content-rewrite.only-allow-excludes=false&quot;, which when set to true will: disallow additional include-url(s); will honor the original exclude-urls; disallow an increase in expires time; not allow additional extensions to be cached. &lt;/p&gt;

&lt;p&gt;2) There was some initial effort to allow the rewriters to be &quot;guiced&quot; into the code by using a protected method to create a proxying link rewriter, HTMLContentRewriter.createLinkRewriter() &amp;amp; CssRequestRewriter.createLinkRewriter(). However with 3 different types of link rewriters used across 4 files, plus who knows where else it will be used. This pattern of protected methods is not scalable. Chose to use a factory pattern for the 3 link rewriters.&lt;/p&gt;

&lt;p&gt;Specific Files:&lt;br/&gt;
java/common/conf/shindig.properties&lt;br/&gt;
     New property&lt;/p&gt;

&lt;p&gt;java/gadgets/src/main/java/org/apache/shindig/gadgets/servlet/ProxyBase.java&lt;br/&gt;
java/gadgets/src/main/java/org/apache/shindig/gadgets/servlet/ConcatProxyServlet.java&lt;br/&gt;
     Support for &quot;nocache&quot;&lt;br/&gt;
     Fixes the response splitting vulnerability.&lt;br/&gt;
     Also if &quot;refresh&quot; is not present, will explicitly send nocache headers.&lt;/p&gt;

&lt;p&gt;java/gadgets/src/main/java/org/apache/shindig/gadgets/render/SanitizingProxyingLinkRewriterFactory.java&lt;br/&gt;
java/gadgets/src/main/java/org/apache/shindig/gadgets/render/DefaultSanitizingProxyingLinkRewriterFactory.java&lt;br/&gt;
java/gadgets/src/main/java/org/apache/shindig/gadgets/render/SanitizingProxyingLinkRewriter.java&lt;br/&gt;
java/gadgets/src/main/java/org/apache/shindig/gadgets/rewrite/ConcatLinkRewriterFactory.java&lt;br/&gt;
java/gadgets/src/main/java/org/apache/shindig/gadgets/rewrite/DefaultConcatLinkRewriterFactory.java&lt;br/&gt;
java/gadgets/src/main/java/org/apache/shindig/gadgets/rewrite/ConcatLinkRewriter.java&lt;br/&gt;
java/gadgets/src/main/java/org/apache/shindig/gadgets/rewrite/ProxyingLinkRewriterFactory.java&lt;br/&gt;
java/gadgets/src/main/java/org/apache/shindig/gadgets/rewrite/DefaultProxyingLinkRewriterFactory.java&lt;br/&gt;
java/gadgets/src/main/java/org/apache/shindig/gadgets/rewrite/ProxyingLinkRewriter.java&lt;br/&gt;
     An interface for the factory, default implementation of the factory, and the rewriter.&lt;br/&gt;
     Sanitizing and Concat were generally extracted from their &quot;inner class&quot; definitions.&lt;br/&gt;
     Fixed Concat to always include refresh on the URL&lt;/p&gt;


&lt;p&gt;java/gadgets/src/main/java/org/apache/shindig/gadgets/rewrite/ContentRewriterFeatureFactory.java&lt;br/&gt;
     Needed to handle additional include/exclude tags, and new only-allow-excludes option.&lt;/p&gt;

&lt;p&gt;java/gadgets/src/main/java/org/apache/shindig/gadgets/rewrite/ContentRewriterFeature.java&lt;br/&gt;
     Reuses some algorithms from the original, but is best reviewed as new code implementing the algorithms necessary to support the original and new features.&lt;/p&gt;

&lt;p&gt;java/gadgets/src/main/java/org/apache/shindig/gadgets/rewrite/HTMLContentRewriter.java&lt;br/&gt;
java/gadgets/src/main/java/org/apache/shindig/gadgets/rewrite/CssRequestRewriter.java&lt;br/&gt;
java/gadgets/src/main/java/org/apache/shindig/gadgets/render/SanitizingRequestRewriter.java&lt;br/&gt;
java/gadgets/src/main/java/org/apache/shindig/gadgets/render/SanitizingGadgetRewriter.java&lt;br/&gt;
     Refactored to use new factory pattern.&lt;/p&gt;

&lt;p&gt;java/gadgets/src/main/java/org/apache/shindig/gadgets/spec/Feature.java&lt;br/&gt;
     Needed a new accessor method&lt;/p&gt;

&lt;p&gt;Unit Test Files:&lt;br/&gt;
java/gadgets/src/test/java/org/apache/shindig/gadgets/render/SanitizingGadgetRewriterTest.java&lt;br/&gt;
java/gadgets/src/test/java/org/apache/shindig/gadgets/render/SanitizingRequestRewriterTest.java&lt;br/&gt;
java/gadgets/src/test/java/org/apache/shindig/gadgets/rewrite/ProxyingLinkRewriterTest.java&lt;br/&gt;
java/gadgets/src/test/java/org/apache/shindig/gadgets/rewrite/ContentRewriterFeatureTestCase.java&lt;br/&gt;
java/gadgets/src/test/java/org/apache/shindig/gadgets/rewrite/ContentRewriterFeatureTestCaseOS9.java&lt;br/&gt;
java/gadgets/src/test/java/org/apache/shindig/gadgets/rewrite/HTMLContentRewriterTest.java&lt;br/&gt;
java/gadgets/src/test/java/org/apache/shindig/gadgets/rewrite/CssRequestRewriterTest.java&lt;br/&gt;
java/gadgets/src/test/java/org/apache/shindig/gadgets/rewrite/BaseRewriterTestCase.java&lt;br/&gt;
java/gadgets/src/test/resources/org/apache/shindig/gadgets/rewrite/rewritestyle2-expected.html&lt;br/&gt;
java/gadgets/src/test/resources/org/apache/shindig/gadgets/rewrite/rewritebasic-expected.css&lt;br/&gt;
java/gadgets/src/test/resources/org/apache/shindig/gadgets/rewrite/rewritescriptbasic.html&lt;br/&gt;
   In General:&lt;br/&gt;
     Mods for use of the new Factory Pattern&lt;br/&gt;
     Tests for debug and nocache&lt;br/&gt;
     Test for only-allow-excludes&lt;br/&gt;
     Concat now uses &quot;refresh&quot;, added to tests&lt;/p&gt;

&lt;p&gt;   ContentRewriterFeatureTestCaseOS9.java&lt;br/&gt;
     New file based on ContentRewriterFeatureTestCase.java, but uses the OpenSocial v 0.9 specification to perform the tests.&lt;/p&gt;

&lt;p&gt;   HTMLContentRewriterTest.java&lt;br/&gt;
   rewritescriptbasic.html&lt;br/&gt;
     Added test for the splitting of concat rewrites into multiple concats.&lt;/p&gt;

&lt;p&gt;   HTMLContentRewriterTest.java&lt;br/&gt;
   CssRequestRewriterTest.java&lt;br/&gt;
   BaseRewriterTestCase.java&lt;br/&gt;
     Somehow the refresh time was &quot;HTTP&quot;, rather than a valid integer! I changed this to a valid integer, and fixed the test standards. Additional added tests to specifically test when refresh is not a valid integer.&lt;br/&gt;
     Added tests to ensure the ConcatRewriter will properly split the rewrite into different URLs.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12438129">SHINDIG-1192</key>
            <summary>content-rewrite is not compliant with Open Social v0.9, plus some bugs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jon.weygandt">Jon Weygandt</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Oct 2009 21:33:33 +0000</created>
                <updated>Thu, 5 Nov 2009 16:33:11 +0000</updated>
                            <resolved>Thu, 5 Nov 2009 16:33:11 +0000</resolved>
                                    <version>1.1-BETA3</version>
                                    <fixVersion>1.1-BETA4</fixVersion>
                                    <component>Java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12765777" author="plindner" created="Wed, 14 Oct 2009 22:05:35 +0000"  >&lt;p&gt;can you upload this patch to codereview.appspot.com?  Something this big should have a review..&lt;/p&gt;

&lt;p&gt;Thanks for the &lt;/p&gt;</comment>
                            <comment id="12765793" author="adamwiner" created="Wed, 14 Oct 2009 22:30:37 +0000"  >&lt;p&gt;Part of Shindig-737.&lt;/p&gt;</comment>
                            <comment id="12766090" author="jon.weygandt" created="Thu, 15 Oct 2009 15:29:31 +0000"  >&lt;p&gt;The code review is on &lt;a href=&quot;http://codereview.appspot.com/130079&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://codereview.appspot.com/130079&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Am I doing something wrong? I set the reviewer to&lt;br/&gt;
&quot;Shindig.remailer@gmail.com&quot;, but never see any notification in this&lt;br/&gt;
group.&lt;/p&gt;
</comment>
                            <comment id="12770168" author="plindner" created="Mon, 26 Oct 2009 20:09:57 +0000"  >&lt;p&gt;I&apos;m going to try to carve out some time to look this over.&lt;/p&gt;

&lt;p&gt;Overall it seems quite good and fixes a number of big issues.&lt;/p&gt;
</comment>
                            <comment id="12773950" author="plindner" created="Thu, 5 Nov 2009 15:26:00 +0000"  >&lt;p&gt;lgtm, will apply today..&lt;/p&gt;</comment>
                            <comment id="12773963" author="plindner" created="Thu, 5 Nov 2009 16:33:11 +0000"  >&lt;p&gt;looks good..&lt;/p&gt;

&lt;p&gt;will get committed when svn.apache.org comes back online..&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12409812">SHINDIG-737</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12422144" name="fix-1192-bug.patch" size="135887" author="jon.weygandt" created="Wed, 14 Oct 2009 21:45:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>174475</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 3 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i10f7j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>210598</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>