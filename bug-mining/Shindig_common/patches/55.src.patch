diff --git a/java/common/src/main/java/org/apache/shindig/auth/BlobCrypterSecurityToken.java b/java/common/src/main/java/org/apache/shindig/auth/BlobCrypterSecurityToken.java
index 8fd358f14..5c3282143 100644
--- a/java/common/src/main/java/org/apache/shindig/auth/BlobCrypterSecurityToken.java
+++ b/java/common/src/main/java/org/apache/shindig/auth/BlobCrypterSecurityToken.java
@@ -43,7 +43,6 @@ public class BlobCrypterSecurityToken extends AbstractSecurityToken implements S
   protected static final String TRUSTED_JSON_KEY = "j";
   protected static final String EXPIRES_KEY = "x";
 
-  protected final BlobCrypter crypter;
   protected final String container;
   protected final String domain;
 
@@ -63,8 +62,7 @@ public class BlobCrypterSecurityToken extends AbstractSecurityToken implements S
    * @param container container that is issuing the token
    * @param domain domain to use for signed fetch with default signed fetch key.
    */
-  public BlobCrypterSecurityToken(BlobCrypter crypter, String container, String domain) {
-    this.crypter = crypter;
+  public BlobCrypterSecurityToken(String container, String domain) {
     this.container = container;
     this.domain = domain;
   }
@@ -84,7 +82,7 @@ public class BlobCrypterSecurityToken extends AbstractSecurityToken implements S
   public static BlobCrypterSecurityToken decrypt(BlobCrypter crypter, String container, String domain,
         String token, String activeUrl) throws BlobCrypterException {
     Map<String, String> values = crypter.unwrap(token, MAX_TOKEN_LIFETIME_SECS);
-    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken(crypter, container, domain);
+    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken(container, domain);
     setTokenValues(t, values);
     t.setActiveUrl(activeUrl);
     return t;
@@ -109,30 +107,30 @@ public class BlobCrypterSecurityToken extends AbstractSecurityToken implements S
    * Encrypt and sign the token.  The returned value is *not* web safe, it should be URL
    * encoded before being used as a form parameter.
    */
-  public String encrypt() throws BlobCrypterException {
-    Map<String, String> values = buildValuesMap();
-    return container + ':' + crypter.wrap(values);
+  public static String encrypt(SecurityToken token, BlobCrypter crypter) throws BlobCrypterException {
+    Map<String, String> values = buildValuesMap(token);
+    return token.getContainer() + ':' + crypter.wrap(values);
   }
 
-  protected Map<String, String> buildValuesMap() {
+  protected static Map<String, String> buildValuesMap(SecurityToken token) {
     Map<String, String> values = Maps.newHashMap();
-    if (ownerId != null) {
-      values.put(OWNER_KEY, ownerId);
+    if (token.getOwnerId() != null) {
+      values.put(OWNER_KEY, token.getOwnerId());
     }
-    if (viewerId != null) {
-      values.put(VIEWER_KEY, viewerId);
+    if (token.getViewerId() != null) {
+      values.put(VIEWER_KEY, token.getViewerId());
     }
-    if (appUrl != null) {
-      values.put(GADGET_KEY, appUrl);
+    if (token.getAppUrl() != null) {
+      values.put(GADGET_KEY, token.getAppUrl());
     }
-    if (moduleId != 0) {
-      values.put(GADGET_INSTANCE_KEY, Long.toString(moduleId));
+    if (token.getModuleId() != 0) {
+      values.put(GADGET_INSTANCE_KEY, Long.toString(token.getModuleId()));
     }
-    if (expiresAt != null) {
-      values.put(EXPIRES_KEY, Long.toString(expiresAt));
+    if (token.getExpiresAt() != null) {
+      values.put(EXPIRES_KEY, Long.toString(token.getExpiresAt()));
     }
-    if (trustedJson != null) {
-      values.put(TRUSTED_JSON_KEY, trustedJson);
+    if (token.getTrustedJson() != null) {
+      values.put(TRUSTED_JSON_KEY, token.getTrustedJson());
     }
     return values;                                                                                           
    }
diff --git a/java/common/src/main/java/org/apache/shindig/auth/BlobCrypterSecurityTokenCodec.java b/java/common/src/main/java/org/apache/shindig/auth/BlobCrypterSecurityTokenCodec.java
index 3a8fd1f64..8c99d4f51 100644
--- a/java/common/src/main/java/org/apache/shindig/auth/BlobCrypterSecurityTokenCodec.java
+++ b/java/common/src/main/java/org/apache/shindig/auth/BlobCrypterSecurityTokenCodec.java
@@ -160,14 +160,18 @@ public class BlobCrypterSecurityTokenCodec implements SecurityTokenCodec, Contai
   }
 
   public String encodeToken(SecurityToken token) throws SecurityTokenException {
-    if (! (token instanceof BlobCrypterSecurityToken)) {
+    if (!token.getAuthenticationMode().equals(
+            AuthenticationMode.SECURITY_TOKEN_URL_PARAMETER.name())) {
       throw new SecurityTokenException("Can only encode BlogCrypterSecurityTokens");
     }
 
-    BlobCrypterSecurityToken t = (BlobCrypterSecurityToken)token;
-
+    BlobCrypter crypter = crypters.get(token.getContainer());
+    if (crypter == null) {
+      throw new SecurityTokenException("Unknown container " + token.getContainer());
+    }
+    
     try {
-      return t.encrypt();
+      return BlobCrypterSecurityToken.encrypt(token, crypter);
     } catch (BlobCrypterException e) {
       throw new SecurityTokenException(e);
     }
diff --git a/java/common/src/test/java/org/apache/shindig/auth/BlobCrypterSecurityTokenCodecTest.java b/java/common/src/test/java/org/apache/shindig/auth/BlobCrypterSecurityTokenCodecTest.java
index 85b16280a..df2cf9d77 100644
--- a/java/common/src/test/java/org/apache/shindig/auth/BlobCrypterSecurityTokenCodecTest.java
+++ b/java/common/src/test/java/org/apache/shindig/auth/BlobCrypterSecurityTokenCodecTest.java
@@ -106,14 +106,14 @@ public class BlobCrypterSecurityTokenCodecTest {
 
   @Test
   public void testCreateToken() throws Exception {
-    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken(
-        getBlobCrypter(getContainerKey("container")), "container", null);
+    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken("container", null);
     t.setAppUrl("http://www.example.com/gadget.xml");
     t.setModuleId(12345L);
     t.setOwnerId("owner");
     t.setViewerId("viewer");
     t.setTrustedJson("trusted");
-    String encrypted = t.encrypt();
+    String encrypted = BlobCrypterSecurityToken.encrypt(t,
+            getBlobCrypter(getContainerKey("container")));
 
     SecurityToken t2 = codec.createToken(
         ImmutableMap.of(SecurityTokenCodec.SECURITY_TOKEN_NAME, encrypted));
@@ -129,14 +129,14 @@ public class BlobCrypterSecurityTokenCodecTest {
 
   @Test
   public void testUnknownContainer() throws Exception {
-    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken(
-        getBlobCrypter(getContainerKey("container")), "container", null);
+    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken("container", null);
     t.setAppUrl("http://www.example.com/gadget.xml");
     t.setModuleId(12345L);
     t.setOwnerId("owner");
     t.setViewerId("viewer");
     t.setTrustedJson("trusted");
-    String encrypted = t.encrypt();
+    String encrypted = BlobCrypterSecurityToken.encrypt(t,
+            getBlobCrypter(getContainerKey("container")));
     encrypted = encrypted.replace("container:", "other:");
 
     try {
@@ -149,14 +149,14 @@ public class BlobCrypterSecurityTokenCodecTest {
 
   @Test
   public void testWrongContainer() throws Exception {
-    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken(
-        getBlobCrypter(getContainerKey("container")), "container", null);
+    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken("container", null);
     t.setAppUrl("http://www.example.com/gadget.xml");
     t.setModuleId(12345L);
     t.setOwnerId("owner");
     t.setViewerId("viewer");
     t.setTrustedJson("trusted");
-    String encrypted = t.encrypt();
+    String encrypted = BlobCrypterSecurityToken.encrypt(t,
+            getBlobCrypter(getContainerKey("container")));
     encrypted = encrypted.replace("container:", "example:");
 
     try {
@@ -169,14 +169,14 @@ public class BlobCrypterSecurityTokenCodecTest {
 
   @Test
   public void testExpired() throws Exception {
-    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken(
-        getBlobCrypter(getContainerKey("container")), "container", null);
+    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken("container", null);
     t.setAppUrl("http://www.example.com/gadget.xml");
     t.setModuleId(12345L);
     t.setOwnerId("owner");
     t.setViewerId("viewer");
     t.setTrustedJson("trusted");
-    String encrypted = t.encrypt();
+    String encrypted = BlobCrypterSecurityToken.encrypt(t,
+            getBlobCrypter(getContainerKey("container")));
 
     timeSource.incrementSeconds(3600 + 181); // one hour plus clock skew
     try {
@@ -223,14 +223,14 @@ public class BlobCrypterSecurityTokenCodecTest {
   @Test
   public void testChangingContainers() throws Exception {
     String newContainer = "newcontainer";
-    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken(
-        getBlobCrypter(getContainerKey(newContainer)), newContainer, null);
+    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken(newContainer, null);
     t.setAppUrl("http://www.example.com/gadget.xml");
     t.setModuleId(12345L);
     t.setOwnerId("owner");
     t.setViewerId("viewer");
     t.setTrustedJson("trusted");
-    String encrypted = t.encrypt();
+    String encrypted = BlobCrypterSecurityToken.encrypt(t,
+            getBlobCrypter(getContainerKey(newContainer)));
 
     // fails when trying to create a token for a non-existing container
     try {
diff --git a/java/common/src/test/java/org/apache/shindig/auth/BlobCrypterSecurityTokenTest.java b/java/common/src/test/java/org/apache/shindig/auth/BlobCrypterSecurityTokenTest.java
index a577cd428..769c7d057 100644
--- a/java/common/src/test/java/org/apache/shindig/auth/BlobCrypterSecurityTokenTest.java
+++ b/java/common/src/test/java/org/apache/shindig/auth/BlobCrypterSecurityTokenTest.java
@@ -50,8 +50,8 @@ public class BlobCrypterSecurityTokenTest {
 
   @Test(expected=UnsupportedOperationException.class)
   public void testNullValues() throws Exception {
-    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken(crypter, CONTAINER, DOMAIN);
-    String token = t.encrypt();
+    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken(CONTAINER, DOMAIN);
+    String token = BlobCrypterSecurityToken.encrypt(t, crypter);
     assertTrue("should start with container: " + token, token.startsWith("container:"));
     String[] fields = StringUtils.split(token, ':');
     BlobCrypterSecurityToken t2 =
@@ -72,13 +72,13 @@ public class BlobCrypterSecurityTokenTest {
 
   @Test
   public void testRealValues() throws Exception {
-    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken(crypter, CONTAINER, DOMAIN);
+    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken(CONTAINER, DOMAIN);
     t.setAppUrl("http://www.example.com/gadget.xml");
     t.setModuleId(12345L);
     t.setOwnerId("owner");
     t.setViewerId("viewer");
     t.setTrustedJson("trusted");
-    String token = t.encrypt();
+    String token = BlobCrypterSecurityToken.encrypt(t, crypter);
     assertTrue("should start with container: " + token, token.startsWith("container:"));
     String[] fields = StringUtils.split(token, ':');
     BlobCrypterSecurityToken t2 =
@@ -96,8 +96,8 @@ public class BlobCrypterSecurityTokenTest {
 
   @Test(expected=BlobExpiredException.class)
   public void testExpired() throws Exception {
-    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken(crypter, CONTAINER, DOMAIN);
-    String token = t.encrypt();
+    BlobCrypterSecurityToken t = new BlobCrypterSecurityToken(CONTAINER, DOMAIN);
+    String token = BlobCrypterSecurityToken.encrypt(t, crypter);
     // one hour plus clock skew
     timeSource.incrementSeconds(3600 + 181);
     String[] fields = StringUtils.split(token, ':');
