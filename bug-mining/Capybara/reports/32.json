{"url":"https://api.github.com/repos/teamcapybara/capybara/issues/328","repository_url":"https://api.github.com/repos/teamcapybara/capybara","labels_url":"https://api.github.com/repos/teamcapybara/capybara/issues/328/labels{/name}","comments_url":"https://api.github.com/repos/teamcapybara/capybara/issues/328/comments","events_url":"https://api.github.com/repos/teamcapybara/capybara/issues/328/events","html_url":"https://github.com/teamcapybara/capybara/issues/328","id":799610,"node_id":"MDU6SXNzdWU3OTk2MTA=","number":328,"title":"Capybara does not pass header after form submit","user":{"login":"PeterBloom","id":156478,"node_id":"MDQ6VXNlcjE1NjQ3OA==","avatar_url":"https://avatars.githubusercontent.com/u/156478?v=4","gravatar_id":"","url":"https://api.github.com/users/PeterBloom","html_url":"https://github.com/PeterBloom","followers_url":"https://api.github.com/users/PeterBloom/followers","following_url":"https://api.github.com/users/PeterBloom/following{/other_user}","gists_url":"https://api.github.com/users/PeterBloom/gists{/gist_id}","starred_url":"https://api.github.com/users/PeterBloom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PeterBloom/subscriptions","organizations_url":"https://api.github.com/users/PeterBloom/orgs","repos_url":"https://api.github.com/users/PeterBloom/repos","events_url":"https://api.github.com/users/PeterBloom/events{/privacy}","received_events_url":"https://api.github.com/users/PeterBloom/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2011-04-21T17:33:28Z","updated_at":"2019-08-18T05:14:18Z","closed_at":"2011-04-25T09:36:24Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I am building a Rails 3 app which renders different views for mobile devices (using jQuery Mobile) and regular desktop browsers. I am testing with Cucumber/Capybara, and have separate test suites for mobile and browser. I am able to set a mobile User-Agent string in the request's HTTP header just fine using the ‘headers hack’ found here…\n\nhttp://stackoverflow.com/questions/3399156/using-cucumber-capybara-in-rails-3-how-do-i-set-a-custom-user-agent-string\n\nThe Problem...\n\nMost of my mobile Cucumber steps work fine (e.g., I set the mobile header in a step, thereafter the mobile views render). However after a form submit, the test then renders a browser view of the next step (not the mobile view I want). I think this may be because Capybara is dropping the header after a form submit action.\n\nI tried to test this by adding a logger to my controller action so I could look at the user_agent headers, as follows:\n\ndef show\n    # …\n    logger.info(\"Headers: #{request.user_agent}\")\n    # …\nend\n\nI used an iPhone header (Buyer is the resource). In my test.log I see:\n\nFor the create action…\n\nStarted POST \"/buyers\" for 127.0.0.1 at 2011-04-19 16:49:18 -0700\nProcessing by BuyersController#create as HTML\n  #...\nHeaders: Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_0 like Mac OS X; en-us) AppleWebKit/532.9 (KHTML, like Gecko) Version/4.0.5 Mobile/8A293 Safari/6531.22.7\n  #...\nRedirected to http://www.example.com/buyers/1\nCompleted 302 Found in 7ms\n\nFor the subsequent show action (note ‘Headers:’ is blank)…\n\nStarted GET \"/buyers/1\" for 127.0.0.1 at 2011-04-19 16:49:18 -0700\nProcessing by BuyersController#show as HTML\n #...\nHeaders: \n #...\nCompleted 200 OK in 4ms (Views: 2.8ms | ActiveRecord: 1.4ms)\n\nAs one would expect, the a ‘show me the page’ step then renders the browser page, not the mobile page I want.\n\nHow can I preserve the header so all my mobile steps run in my mobile test suite? \n","closed_by":{"login":"jnicklas","id":134,"node_id":"MDQ6VXNlcjEzNA==","avatar_url":"https://avatars.githubusercontent.com/u/134?v=4","gravatar_id":"","url":"https://api.github.com/users/jnicklas","html_url":"https://github.com/jnicklas","followers_url":"https://api.github.com/users/jnicklas/followers","following_url":"https://api.github.com/users/jnicklas/following{/other_user}","gists_url":"https://api.github.com/users/jnicklas/gists{/gist_id}","starred_url":"https://api.github.com/users/jnicklas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnicklas/subscriptions","organizations_url":"https://api.github.com/users/jnicklas/orgs","repos_url":"https://api.github.com/users/jnicklas/repos","events_url":"https://api.github.com/users/jnicklas/events{/privacy}","received_events_url":"https://api.github.com/users/jnicklas/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/teamcapybara/capybara/issues/328/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/teamcapybara/capybara/issues/328/timeline","performed_via_github_app":null,"state_reason":"completed"}