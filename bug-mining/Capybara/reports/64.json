{"url":"https://api.github.com/repos/teamcapybara/capybara/issues/848","repository_url":"https://api.github.com/repos/teamcapybara/capybara","labels_url":"https://api.github.com/repos/teamcapybara/capybara/issues/848/labels{/name}","comments_url":"https://api.github.com/repos/teamcapybara/capybara/issues/848/comments","events_url":"https://api.github.com/repos/teamcapybara/capybara/issues/848/events","html_url":"https://github.com/teamcapybara/capybara/issues/848","id":7661663,"node_id":"MDU6SXNzdWU3NjYxNjYz","number":848,"title":"Capybara stops / hangs unexpectedly and inconsistently","user":{"login":"mattheworiordan","id":43789,"node_id":"MDQ6VXNlcjQzNzg5","avatar_url":"https://avatars.githubusercontent.com/u/43789?v=4","gravatar_id":"","url":"https://api.github.com/users/mattheworiordan","html_url":"https://github.com/mattheworiordan","followers_url":"https://api.github.com/users/mattheworiordan/followers","following_url":"https://api.github.com/users/mattheworiordan/following{/other_user}","gists_url":"https://api.github.com/users/mattheworiordan/gists{/gist_id}","starred_url":"https://api.github.com/users/mattheworiordan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattheworiordan/subscriptions","organizations_url":"https://api.github.com/users/mattheworiordan/orgs","repos_url":"https://api.github.com/users/mattheworiordan/repos","events_url":"https://api.github.com/users/mattheworiordan/events{/privacy}","received_events_url":"https://api.github.com/users/mattheworiordan/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":22,"created_at":"2012-10-17T16:35:31Z","updated_at":"2019-08-17T06:14:01Z","closed_at":"2013-02-25T08:03:22Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Firstly, I appreciate how hard it is to debug this issue, or even figure out if Capybara is indeed at fault, but I believe Capybara and or the Capybara-Webkit driver is the most likely culprit.  So I appreciate any help if you can help.\n\nI am on OS X 10.8.1 with the latest version of all gems, QT webkit and Ruby 1.9.3 available.  I'll post the info further down for your reference.\n\nI have found that recently when running a few small Cucumber tests using `rake cucumber:wip` everything tends to work fine.  However, when I run the full suite I find the tests just hang for some reason, and never fix themselves.  I have seen this in my CI environment (Mac as well, but OS OX 10.7) as well.  And I only seem to see this when Capybara-Webkit is enabled, however it does seem to hang sometimes before Capybara-Webkit is invoked.\n\nFor example, in my most recent run, I ran `rake cucumber` and 34 scenarios across 5 feature files ran OK, and then oddly when I hit the 6th feature file (one of many more), it hung on the first scenario.\n\nHere is the output from the test on that scenario showing, and importantly it does not seem like the @javascript interpretor has yet been invoked (I use capybara-webkit) as it got stuck on the Background portion:\n\n```\nFeature: Backlog Other Functionality\n  In order to manage a backlog\n  A visitor\n  Should be able to rely on some necessary functionality\n\n  Background:                                                                                      # features/backlog_other.feature:6\n    Given the database has the necessary lookup tables                                             # features/step_definitions/shared_steps.rb:1\n    And a user named \"John\" is registered                                                          # features/step_definitions/authentication_steps.rb:1\n```\n\nThe @javascript declaration in fact comes later in the scenario declaration, not in the background section, so to be honest I'm not sure if Capybara detects that in advance and switches to the :javascript driver, or if it only switches when the Scenario starts that is tagged with @javascript.\n\nAnyway, clearly it is hanging on the next step in the Background which is `And I am signed in as \"John\"`\nThe code for this step is as follows:\n\n```\nstep %{I am on the home page}\nstep %{I follow \"Log in\"}\nstep %{I fill in \"Email\" with \"#{user_name.gsub(/ /,'')}@acme.com\"}\nstep %{I fill in \"Password\" with \"password\"}\nstep %{I press \"Log in\"}\nstep %{I should see the notice \"Signed in successfully.\"}\n```\n\nNow I could include all the code for this step if you want, but it's all pretty bog standard Capybara code.  For example, here are two of the steps:\n\n```\nGiven /^(?:|I )am on (.+)$/ do |page_name|\n  visit path_to(page_name)\nend\n\nWhen /^(?:|I )follow \"([^\"]*)\"(?: within \"([^\"]*)\")?$/ do |link, selector|\n  with_scope(selector_to(selector)) do\n    click_link(link)\n  end\nend\n```\n\nSo why it should hang on this step confuses me.  There is certainly nothing in those steps that warrants any odd behaviour, and if I run that test individually it works just fine.\n\nHas anyone else experienced this intermittent behaviour?  Is there some way I can start to debug the issue or provide more information?\n\nHere is some info on my environment:\n\nOS X Version: 10.8.1\nRuby: ruby-1.9.3-p194 using RVM\nXCode version:  4.5.1\n\n$ gcc --version\n    i686-apple-darwin11-llvm-gcc-4.2 (GCC) 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2336.11.00)\n\n$ bundle list\nGems included by the bundle:\n- Ascii85 (1.0.2)\n- ZenTest (4.8.2)\n- actionmailer (3.2.8)\n- actionpack (3.2.8)\n- activemodel (3.2.8)\n- activerecord (3.2.8)\n- activeresource (3.2.8)\n- activesupport (3.2.8)\n- acts_as_list (0.1.8)\n- addressable (2.3.2)\n- arel (3.0.2)\n- autotest (4.4.6)\n- autotest-growl (0.2.16)\n- autotest-rails (4.1.2)\n- awesome_print (1.1.0)\n- bcrypt-ruby (3.0.1)\n- builder (3.0.3)\n- bundler (1.2.0)\n- capybara (1.1.2)\n- capybara-screenshot (0.2.2)\n- capybara-webkit (0.12.1)\n- childprocess (0.3.5)\n- chunky_png (1.2.6)\n- coderay (1.0.8)\n- columnize (0.3.6)\n- compass (0.12.2)\n- compass-960-plugin (0.10.4)\n- compass-rails (1.0.3)\n- cucumber (1.2.1)\n- cucumber-rails (1.3.0)\n- database_cleaner (0.9.1)\n- debugger (1.2.0)\n- debugger-linecache (1.1.2)\n- debugger-ruby_core_source (1.1.3)\n- deep_merge (1.0.0)\n- devise (2.1.2)\n- devise-encryptable (0.1.1)\n- diff-lcs (1.1.3)\n- ejs (1.1.1)\n- email_spec (1.2.1)\n- erubis (2.7.0)\n- exceptional (2.0.32)\n- excon (0.16.4)\n- execjs (1.4.0)\n- factory_girl (4.1.0)\n- factory_girl_rails (4.1.0)\n- ffi (1.1.5)\n- foreman (0.60.0)\n- fssm (0.2.9)\n- gherkin (2.11.4)\n- growl (1.0.3)\n- haml (3.1.7)\n- hashery (2.0.1)\n- heroku (2.32.11)\n- heroku-api (0.3.5)\n- heroku_san (3.0.4)\n- hike (1.2.1)\n- hpricot (0.8.6)\n- httparty (0.9.0)\n- i18n (0.6.1)\n- journey (1.0.4)\n- jquery-rails (2.1.3)\n- jslint_on_rails (1.1.1)\n- json (1.7.5)\n- kgio (2.7.4)\n- launchy (2.1.2)\n- libwebsocket (0.1.5)\n- mail (2.4.4)\n- method_source (0.8)\n- mime-types (1.19)\n- multi_json (1.3.6)\n- multi_xml (0.5.1)\n- netrc (0.7.7)\n- newrelic_rpm (3.4.2)\n- nokogiri (1.5.5)\n- orm_adapter (0.4.0)\n- pdf-reader (1.2.0)\n- pg (0.14.1)\n- polyglot (0.3.3)\n- prawn (0.12.0)\n- pry (0.9.10)\n- pry-rails (0.0.4 6dd39e3)\n- quiet_assets (1.0.1)\n- rack (1.4.1)\n- rack-cache (1.2)\n- rack-force_domain (0.2.0 ff16ac9)\n- rack-ssl (1.3.2)\n- rack-test (0.6.2)\n- rails (3.2.8)\n- railties (3.2.8)\n- raindrops (0.10.0)\n- rake (0.9.2.2)\n- rdoc (3.12)\n- recursive-open-struct (0.2.2 8178fa5)\n- redis (2.2.2)\n- redis-namespace (1.0.3)\n- rest-client (1.6.7)\n- rspec (2.11.0)\n- rspec-core (2.11.1)\n- rspec-expectations (2.11.3)\n- rspec-mocks (2.11.3)\n- rspec-rails (2.11.0)\n- ruby-rc4 (0.1.5)\n- ruby_parser (2.3.1)\n- rubyzip (0.9.9)\n- sass (3.2.1)\n- sass-rails (3.2.5)\n- selenium-webdriver (2.25.0)\n- sequel (3.20.0)\n- sexp_processor (3.2.0)\n- shortly (0.3.3)\n- shoulda-matchers (1.4.0)\n- sinatra (1.0)\n- slop (3.3.3)\n- sprockets (2.1.3)\n- taps (0.3.24)\n- thor (0.16.0)\n- tilt (1.3.3)\n- timecop (0.5.2)\n- treetop (1.4.11)\n- ttfunk (1.0.3)\n- turbo-sprockets-rails3 (0.1.15)\n- tzinfo (0.3.33)\n- uglifier (1.3.0)\n- unicorn (4.3.1)\n- vanity (1.8.0 dda319f)\n- warden (1.2.1)\n- watchr (0.7)\n- webrat (0.7.3)\n- will_paginate (3.0.3)\n- xml-object (0.9.93)\n- xpath (0.1.4)\n\n$ brew info qt\n    qt: stable 4.8.3 (bottled), HEAD\n    http://qt.nokia.com/\n    /usr/local/Cellar/qt/4.8.2 (2753 files, 195M)\n    /usr/local/Cellar/qt/4.8.3 (2779 files, 194M) *\n    https://github.com/mxcl/homebrew/commits/master/Library/Formula/qt.rb\n    ==> Options\n    --developer\n      Compile and link Qt with developer options\n    --with-qt3support\n      Enable deprecated Qt3Support module\n    --with-debug-and-release\n      Compile Qt in debug and release mode\n    --with-qtdbus\n      Enable QtDBus module\n    --universal\n      Build a universal binary\n    --with-mysql\n      Enable MySQL plugin\n    --with-demos-examples\n      Enable Qt demos and examples\n    ==> Caveats\n    We agreed to the Qt opensource license for you.\n    If this is unacceptable you should uninstall.\n","closed_by":{"login":"jnicklas","id":134,"node_id":"MDQ6VXNlcjEzNA==","avatar_url":"https://avatars.githubusercontent.com/u/134?v=4","gravatar_id":"","url":"https://api.github.com/users/jnicklas","html_url":"https://github.com/jnicklas","followers_url":"https://api.github.com/users/jnicklas/followers","following_url":"https://api.github.com/users/jnicklas/following{/other_user}","gists_url":"https://api.github.com/users/jnicklas/gists{/gist_id}","starred_url":"https://api.github.com/users/jnicklas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnicklas/subscriptions","organizations_url":"https://api.github.com/users/jnicklas/orgs","repos_url":"https://api.github.com/users/jnicklas/repos","events_url":"https://api.github.com/users/jnicklas/events{/privacy}","received_events_url":"https://api.github.com/users/jnicklas/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/teamcapybara/capybara/issues/848/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/teamcapybara/capybara/issues/848/timeline","performed_via_github_app":null,"state_reason":"completed"}