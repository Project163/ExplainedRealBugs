{"url":"https://api.github.com/repos/teamcapybara/capybara/issues/1785","repository_url":"https://api.github.com/repos/teamcapybara/capybara","labels_url":"https://api.github.com/repos/teamcapybara/capybara/issues/1785/labels{/name}","comments_url":"https://api.github.com/repos/teamcapybara/capybara/issues/1785/comments","events_url":"https://api.github.com/repos/teamcapybara/capybara/issues/1785/events","html_url":"https://github.com/teamcapybara/capybara/issues/1785","id":187290979,"node_id":"MDU6SXNzdWUxODcyOTA5Nzk=","number":1785,"title":"Broken exceptions with rails views","user":{"login":"mluts","id":15202437,"node_id":"MDQ6VXNlcjE1MjAyNDM3","avatar_url":"https://avatars.githubusercontent.com/u/15202437?v=4","gravatar_id":"","url":"https://api.github.com/users/mluts","html_url":"https://github.com/mluts","followers_url":"https://api.github.com/users/mluts/followers","following_url":"https://api.github.com/users/mluts/following{/other_user}","gists_url":"https://api.github.com/users/mluts/gists{/gist_id}","starred_url":"https://api.github.com/users/mluts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mluts/subscriptions","organizations_url":"https://api.github.com/users/mluts/orgs","repos_url":"https://api.github.com/users/mluts/repos","events_url":"https://api.github.com/users/mluts/events{/privacy}","received_events_url":"https://api.github.com/users/mluts/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-11-04T09:46:57Z","updated_at":"2019-08-17T01:14:18Z","closed_at":"2016-11-09T00:04:49Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Broken `ActionView::Template::Error` with rails v4.2.1\r\n\r\n## Meta\r\nCapybara Version: 2.10.1\r\nDriver: Poltergeist\r\n\r\n## Expected Behavior\r\nShould see\r\n```\r\nERROR[\"test_redirects_to_user_registration_page\", UserInvitationTest, 5.526182861009147]\r\n test_redirects_to_user_registration_page#UserInvitationTest (5.53s)\r\nActionView::Template::Error:         ActionView::Template::Error: undefined method `ssn' for #<User:0x0055de54509ca8>\r\n            app/views/users/invitations/edit.html.haml:29:in `block in _app_views_users_invitations_edit_html_haml___1320733798883780792_47206699358840'\r\n            app/views/users/invitations/edit.html.haml:11:in `_app_views_users_invitations_edit_html_haml___1320733798883780792_47206699358840'\r\n```\r\n\r\n## Actual Behavior\r\nInstead i see\r\n```\r\nERROR[\"test_redirects_to_user_registration_page\", UserInvitationTest, 2.2288646230008453]\r\n test_redirects_to_user_registration_page#UserInvitationTest (2.23s)\r\nArgumentError:         ArgumentError: wrong number of arguments (1 for 2)\r\n            test/support/integration_tests.rb:28:in `block in <class:IntegrationTest>'\r\n```\r\n## Steps to reproduce\r\n\r\n1. Write a rails view\r\n2. Put a `raise \"Boom!\"` inside a view.\r\n\r\n```\r\n-# app/views/users/registrations/new.html.haml\r\n- raise \"Boom\"\r\n```\r\n\r\n3. Write an integration test for this view\r\n\r\n```\r\n# test/integration/user/sign_up_test.rb\r\nclass IntegrationTest < ActionDispatch;:IntegrationTest\r\n  include Capybara::DSL\r\n  \r\n  setup do\r\n    Capybara.current_driver = :poltergeist\r\n  end\r\n  \r\n   test 'sign-up form works' do\r\n     visit new_user_registration_path\r\n   end\r\nend\r\n```\r\n\r\n4. Observe weird exception\r\n\r\n```\r\nERROR[\"test_user_is_created_after_filling_in_sign-up_form\", User::SignUptest, 2.349236459005624]\r\n test_user_is_created_after_filling_in_sign-up_form#User::SignUptest (2.35s)\r\nArgumentError:         ArgumentError: wrong number of arguments (1 for 2)\r\n            test/integration/user/sign_up_test.rb:15:in `fill_in_input'\r\n            test/integration/user/sign_up_test.rb:26:in `block (2 levels) in <class:SignUptest>'\r\n            test/integration/user/sign_up_test.rb:25:in `block in <class:SignUptest>'\r\n```\r\n\r\n## Quickfix\r\n\r\n```diff\r\ndiff --git a/lib/capybara/session.rb b/lib/capybara/session.rb                                                                                                                                                                      index 0a4f22b..74a9096 100644\r\n--- a/lib/capybara/session.rb\r\n+++ b/lib/capybara/session.rb\r\n@@ -125,7 +125,7 @@ module Capybara\r\n         begin\r\n           raise CapybaraError, \"Your application server raised an error - It has been raised in your test code because Capybara.raise_server_errors == true\"\r\n         rescue CapybaraError\r\n-          raise @server.error.class, @server.error.message, @server.error.backtrace\r\n+          raise @server.error\r\n         end\r\n       end\r\n     ensure\r\n```\r\n\r\n## Why this happened\r\n\r\nBad `ActionView::Template::Error#initialize` in rails ([link](https://github.com/rails/rails/blob/v4.2.1/actionview/lib/action_view/template/error.rb#L64))","closed_by":{"login":"twalpole","id":16556,"node_id":"MDQ6VXNlcjE2NTU2","avatar_url":"https://avatars.githubusercontent.com/u/16556?v=4","gravatar_id":"","url":"https://api.github.com/users/twalpole","html_url":"https://github.com/twalpole","followers_url":"https://api.github.com/users/twalpole/followers","following_url":"https://api.github.com/users/twalpole/following{/other_user}","gists_url":"https://api.github.com/users/twalpole/gists{/gist_id}","starred_url":"https://api.github.com/users/twalpole/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/twalpole/subscriptions","organizations_url":"https://api.github.com/users/twalpole/orgs","repos_url":"https://api.github.com/users/twalpole/repos","events_url":"https://api.github.com/users/twalpole/events{/privacy}","received_events_url":"https://api.github.com/users/twalpole/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/teamcapybara/capybara/issues/1785/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/teamcapybara/capybara/issues/1785/timeline","performed_via_github_app":null,"state_reason":"completed"}