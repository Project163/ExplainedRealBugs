{"url":"https://api.github.com/repos/teamcapybara/capybara/issues/2044","repository_url":"https://api.github.com/repos/teamcapybara/capybara","labels_url":"https://api.github.com/repos/teamcapybara/capybara/issues/2044/labels{/name}","comments_url":"https://api.github.com/repos/teamcapybara/capybara/issues/2044/comments","events_url":"https://api.github.com/repos/teamcapybara/capybara/issues/2044/events","html_url":"https://github.com/teamcapybara/capybara/issues/2044","id":328886051,"node_id":"MDU6SXNzdWUzMjg4ODYwNTE=","number":2044,"title":"CSS attribute selector including comma does not match to the element in 3.2.0","user":{"login":"yhatt","id":3993388,"node_id":"MDQ6VXNlcjM5OTMzODg=","avatar_url":"https://avatars.githubusercontent.com/u/3993388?v=4","gravatar_id":"","url":"https://api.github.com/users/yhatt","html_url":"https://github.com/yhatt","followers_url":"https://api.github.com/users/yhatt/followers","following_url":"https://api.github.com/users/yhatt/following{/other_user}","gists_url":"https://api.github.com/users/yhatt/gists{/gist_id}","starred_url":"https://api.github.com/users/yhatt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yhatt/subscriptions","organizations_url":"https://api.github.com/users/yhatt/orgs","repos_url":"https://api.github.com/users/yhatt/repos","events_url":"https://api.github.com/users/yhatt/events{/privacy}","received_events_url":"https://api.github.com/users/yhatt/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2018-06-04T02:05:12Z","updated_at":"2019-08-16T20:14:15Z","closed_at":"2018-06-04T16:16:11Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Meta\r\nCapybara Version: 3.2.0\r\nDriver Information (and browser if relevant): rack-test 1.0.0 / selenium-webdriver 3.12.0 with Chrome 67.0.3396.62\r\n\r\n## Expected Behavior\r\n\r\nCSS attribute selector including comma should match to the element correctly in 3.2.0\r\n\r\n## Actual Behavior\r\n<!-- include full stacktrace of any error -->\r\n\r\nThe comma included selector was working in v3.1.1, but it does not work in 3.2.0 (Raise `Capybara::ExpectationNotMet`).\r\n\r\n```\r\n$ ruby ./template.rb\r\nTraceback (most recent call last):\r\n        5: from ./template.rb:14:in `<main>'\r\n        4: from /Users/yuki.hattori/.anyenv/envs/rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/capybara-3.2.0/lib/capybara/session.rb:734:in `block (2 levels) in <class:Session>'\r\n        3: from /Users/yuki.hattori/.anyenv/envs/rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/capybara-3.2.0/lib/capybara/node/finders.rb:279:in `first'\r\n        2: from /Users/yuki.hattori/.anyenv/envs/rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/capybara-3.2.0/lib/capybara/node/finders.rb:251:in `all'\r\n        1: from /Users/yuki.hattori/.anyenv/envs/rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/capybara-3.2.0/lib/capybara/node/base.rb:83:in `synchronize'\r\n/Users/yuki.hattori/.anyenv/envs/rbenv/versions/2.5.1/lib/ruby/gems/2.5.0/gems/capybara-3.2.0/lib/capybara/node/finders.rb:253:in `block in all': expected to find visible css \"img[src=\\\"data:image/gif;base64,R0lGODdhAQABAPAAAMLCwgAAACwAAAAAAQABAAACAkQBADs=\\\"]\" at least 1 time but there were no matches (Capybara::ExpectationNotMet)\r\n```\r\n\r\nThe data URI scheme should include comma, so its assertion will not work.\r\n\r\n## Steps to reproduce\r\n\r\n```ruby\r\n# Try in `3.1.1` and `3.2.0` to confirm an issue.\r\ngem 'capybara', '3.2.0'\r\n\r\nrequire 'capybara'\r\n\r\nhtml = DATA.read\r\napp = proc { |env| [200, { 'Content-Type' => 'text/html' }, [html] ] }\r\n\r\n# Reproduce in rack_test and selenium_chrome(_headless) driver\r\nsess = Capybara::Session.new(:rack_test, app)\r\nsess.visit('/')\r\n\r\n# CSS attribute selector including comma does not match to the element in Capybara 3.2.0.\r\np sess.first('img[src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMLCwgAAACwAAAAAAQABAAACAkQBADs=\"]')\r\np sess.first('img[src*=\",\"]')\r\n\r\n# The other special chars like `:`, `/`, `;`, and `=` would match.\r\np sess.first('img[src^=\"data:image/gif;base64\"]')\r\np sess.first('img[src$=\"R0lGODdhAQABAPAAAMLCwgAAACwAAAAAAQABAAACAkQBADs=\"]')\r\n\r\n__END__\r\n\r\n<!doctype html>\r\n<html>\r\n  <body>\r\n    <img src=\"data:image/gif;base64,R0lGODdhAQABAPAAAMLCwgAAACwAAAAAAQABAAACAkQBADs=\" />\r\n  </body>\r\n</html>\r\n```\r\n\r\nIn 3.1.1, all matcher return `img` element correctly.\r\n\r\n```\r\n# In Capybara 3.1.1\r\n$ ruby ./template.rb\r\n#<Capybara::Node::Element tag=\"img\" path=\"/html/body/img\">\r\n#<Capybara::Node::Element tag=\"img\" path=\"/html/body/img\">\r\n#<Capybara::Node::Element tag=\"img\" path=\"/html/body/img\">\r\n#<Capybara::Node::Element tag=\"img\" path=\"/html/body/img\">\r\n```","closed_by":{"login":"twalpole","id":16556,"node_id":"MDQ6VXNlcjE2NTU2","avatar_url":"https://avatars.githubusercontent.com/u/16556?v=4","gravatar_id":"","url":"https://api.github.com/users/twalpole","html_url":"https://github.com/twalpole","followers_url":"https://api.github.com/users/twalpole/followers","following_url":"https://api.github.com/users/twalpole/following{/other_user}","gists_url":"https://api.github.com/users/twalpole/gists{/gist_id}","starred_url":"https://api.github.com/users/twalpole/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/twalpole/subscriptions","organizations_url":"https://api.github.com/users/twalpole/orgs","repos_url":"https://api.github.com/users/twalpole/repos","events_url":"https://api.github.com/users/twalpole/events{/privacy}","received_events_url":"https://api.github.com/users/twalpole/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/teamcapybara/capybara/issues/2044/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/teamcapybara/capybara/issues/2044/timeline","performed_via_github_app":null,"state_reason":"completed"}