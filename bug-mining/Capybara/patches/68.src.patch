diff --git a/lib/capybara/query.rb b/lib/capybara/query.rb
index 04c551dd..28ce2fc8 100644
--- a/lib/capybara/query.rb
+++ b/lib/capybara/query.rb
@@ -39,10 +39,12 @@ module Capybara
       node.unsynchronized do
         if options[:text]
           regexp = options[:text].is_a?(Regexp) ? options[:text] : Regexp.escape(options[:text])
-          type = if @options.has_key?(:visible) and not @options[:visible] then :all else nil end
-          return false if not node.text(type).match(regexp)
+          return false if not node.text(visible).match(regexp)
+        end
+        case visible
+          when :visible then return false unless node.visible?
+          when :hidden then return false if node.visible?
         end
-        return false if visible? and not node.visible?
         selector.custom_filters.each do |name, block|
           return false if options.has_key?(name) and not block.call(node, options[name])
         end
@@ -65,11 +67,19 @@ module Capybara
       end
     end
 
-    def visible?
+    def visible
       if options.has_key?(:visible)
-        @options[:visible]
+        case @options[:visible]
+          when true then :visible
+          when false then :all
+          else @options[:visible]
+        end
       else
-        Capybara.ignore_hidden_elements
+        if Capybara.ignore_hidden_elements
+          :visible
+        else
+          :all
+        end
       end
     end
 
diff --git a/lib/capybara/spec/session/first_spec.rb b/lib/capybara/spec/session/first_spec.rb
index 6875ceed..45d91b99 100644
--- a/lib/capybara/spec/session/first_spec.rb
+++ b/lib/capybara/spec/session/first_spec.rb
@@ -47,7 +47,22 @@ Capybara::SpecHelper.spec '#first' do
 
     it "should find nodes regardless of whether they are invisible when false" do
       @session.first(:css, "a#invisible", :visible => false).should_not be_nil
-      @session.first(:css, "a", :visible => false).should_not be_nil
+      @session.first(:css, "a#visible", :visible => false).should_not be_nil
+    end
+
+    it "should find nodes regardless of whether they are invisible when :all" do
+      @session.first(:css, "a#invisible", :visible => :all).should_not be_nil
+      @session.first(:css, "a#visible", :visible => :all).should_not be_nil
+    end
+
+    it "should find only hidden nodes when :hidden" do
+      @session.first(:css, "a#invisible", :visible => :hidden).should_not be_nil
+      @session.first(:css, "a#visible", :visible => :hidden).should be_nil
+    end
+
+    it "should find only visible nodes when :visible" do
+      @session.first(:css, "a#invisible", :visible => :visible).should be_nil
+      @session.first(:css, "a#visible", :visible => :visible).should_not be_nil
     end
 
     it "should default to Capybara.ignore_hidden_elements" do
