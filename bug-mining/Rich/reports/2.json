{"url":"https://api.github.com/repos/Textualize/rich/issues/2875","repository_url":"https://api.github.com/repos/Textualize/rich","labels_url":"https://api.github.com/repos/Textualize/rich/issues/2875/labels{/name}","comments_url":"https://api.github.com/repos/Textualize/rich/issues/2875/comments","events_url":"https://api.github.com/repos/Textualize/rich/issues/2875/events","html_url":"https://github.com/Textualize/rich/issues/2875","id":1620396386,"node_id":"I_kwDODSlIsc5glUli","number":2875,"title":"[BUG] Class of default value may change behavior of repr auto generation","user":{"login":"FlxB2","id":7521847,"node_id":"MDQ6VXNlcjc1MjE4NDc=","avatar_url":"https://avatars.githubusercontent.com/u/7521847?v=4","gravatar_id":"","url":"https://api.github.com/users/FlxB2","html_url":"https://github.com/FlxB2","followers_url":"https://api.github.com/users/FlxB2/followers","following_url":"https://api.github.com/users/FlxB2/following{/other_user}","gists_url":"https://api.github.com/users/FlxB2/gists{/gist_id}","starred_url":"https://api.github.com/users/FlxB2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/FlxB2/subscriptions","organizations_url":"https://api.github.com/users/FlxB2/orgs","repos_url":"https://api.github.com/users/FlxB2/repos","events_url":"https://api.github.com/users/FlxB2/events{/privacy}","received_events_url":"https://api.github.com/users/FlxB2/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2200581776,"node_id":"MDU6TGFiZWwyMjAwNTgxNzc2","url":"https://api.github.com/repos/Textualize/rich/labels/Needs%20triage","name":"Needs triage","color":"bfdadc","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2023-03-12T15:00:34Z","updated_at":"2023-07-29T15:50:13Z","closed_at":"2023-07-29T15:50:02Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"- [x] I've checked [docs](https://rich.readthedocs.io/en/latest/introduction.html) and [closed issues](https://github.com/Textualize/rich/issues?q=is%3Aissue+is%3Aclosed) for possible solutions.\r\n- [x] I can't find my issue in the [FAQ](https://github.com/Textualize/rich/blob/master/FAQ.md).\r\n\r\n**Describe the bug**\r\n\r\nThanks for developing rich! I noticed that when automatically generating `__rich_repr__`, parameters are compared to inspects `Parameter.empty` via `==`. For various reasons I use a class which overwrites equality when comparing to `Parameter.empty` and therefore breaks the automatically generated representation.\r\n\r\nHere is a minimal working example based on the examples provided in the docs:\r\n```python\r\nimport rich\r\nfrom rich.pretty import pprint\r\nfrom inspect import Parameter\r\n\r\nclass StupidClass:\r\n    def __init__(self, a):\r\n        self.a = a\r\n\r\n    def __eq__(self, other) -> bool:\r\n        if other is Parameter.empty:\r\n            return True\r\n        try:\r\n            return self.a == other.a\r\n        except Exception:\r\n            return False\r\n    \r\n    def __ne__(self, other: object) -> bool:\r\n        return not self.__eq__(other)\r\n\r\nclass NotStupid:\r\n    pass\r\n\r\n@rich.repr.auto\r\nclass Bird:\r\n    def __init__(self, name, eats, fly=True, another=StupidClass(2), extinct=NotStupid()):\r\n        self.name = name\r\n        self.eats = eats\r\n        self.fly = fly\r\n        self.another = another\r\n        self.extinct = extinct\r\n\r\npprint(Bird(\"penguin\", [\"fish\"], another=StupidClass(9), extinct=NotStupid()))\r\n```\r\nOutput:\r\n```\r\nBird('penguin', ['fish'], <__main__.StupidClass object at 0x7f8201c35610>, extinct=<__main__.NotStupid object at 0x7f82005ae4f0>)\r\n```\r\n\r\nExpected Output:\r\n```\r\nBird('penguin', ['fish'], another=<__main__.StupidClass object at 0x7fbcc1e44610>, extinct=<__main__.NotStupid object at 0x7fbcc07bd4f0>)\r\n```\r\n\r\n**Possible Fix**\r\n\r\nrepr.py\r\n```diff\r\ndef auto_rich_repr(self: Type[T]) -> Result:\r\n            \"\"\"Auto generate __rich_rep__ from signature of __init__\"\"\"\r\n            try:\r\n                signature = inspect.signature(self.__init__)\r\n                for name, param in signature.parameters.items():\r\n                    if param.kind == param.POSITIONAL_ONLY:\r\n                        yield getattr(self, name)\r\n                    elif param.kind in (\r\n                        param.POSITIONAL_OR_KEYWORD,\r\n                        param.KEYWORD_ONLY,\r\n                    ):\r\n-                        if param.default == param.empty:\r\n+                        if param.default is param.empty:\r\n                            yield getattr(self, param.name)\r\n                        else:\r\n                            yield param.name, getattr(self, param.name), param.default\r\n            except Exception as error:\r\n                raise ReprError(\r\n                    f\"Failed to auto generate __rich_repr__; {error}\"\r\n                ) from None\r\n```\r\n\r\n**Platform**\r\n<details>\r\n<summary>Click to expand</summary>\r\n\r\nWhat platform (Win/Linux/Mac) are you running on? Ubuntu\r\n What terminal software are you using? Xfce Terminal Emulator\r\n\r\nI may ask you to copy and paste the output of the following commands. It may save some time if you do it now.\r\n\r\nIf you're using Rich in a terminal:\r\n\r\n```\r\npython -m rich diagnose\r\n                                                                                   Rich features                                                                                    \r\n                                                                                                                                                                                    \r\n    Colors    âœ“ 4-bit color                 â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„ \r\n              âœ“ 8-bit color                 â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„ \r\n              âœ“ Truecolor (16.7 million)    â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„ \r\n              âœ“ Dumb terminals              â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„ \r\n              âœ“ Automatic color conversion  â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„â–„ \r\n                                                                                                                                                                                    \r\n    Styles    All ansi styles: bold, dim, italic, underline, strikethrough, reverse, and even blink.                                                                                \r\n                                                                                                                                                                                    \r\n     Text     Word wrap text. Justify left, center, right or full.                                                                                                                  \r\n                                                                                                                                                                                    \r\n              Lorem ipsum dolor sit amet, consectetur  Lorem ipsum dolor sit amet, consectetur   Lorem ipsum dolor sit amet, consectetur Lorem ipsum dolor  sit  amet,  consectetur \r\n              adipiscing elit. Quisque in metus sed     adipiscing elit. Quisque in metus sed      adipiscing elit. Quisque in metus sed adipiscing  elit.  Quisque  in  metus  sed \r\n              sapien ultricies pretium a at justo.       sapien ultricies pretium a at justo.       sapien ultricies pretium a at justo. sapien  ultricies  pretium  a  at   justo. \r\n              Maecenas luctus velit et auctor maximus. Maecenas luctus velit et auctor maximus. Maecenas luctus velit et auctor maximus. Maecenas luctus velit et auctor maximus.   \r\n                                                                                                                                                                                    \r\n    Asian     ğŸ‡¨ğŸ‡³  è¯¥åº“æ”¯æŒä¸­æ–‡ï¼Œæ—¥æ–‡å’ŒéŸ©æ–‡æ–‡æœ¬ï¼                                                                                                                                    \r\n   language   ğŸ‡¯ğŸ‡µ  ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ä¸­å›½èªã€æ—¥æœ¬èªã€éŸ“å›½èªã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™                                                                                                  \r\n   support    ğŸ‡°ğŸ‡·  ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì¤‘êµ­ì–´, ì¼ë³¸ì–´ ë° í•œêµ­ì–´ í…ìŠ¤íŠ¸ë¥¼ ì§€ì›í•©ë‹ˆë‹¤                                                                                                      \r\n                                                                                                                                                                                    \r\n    Markup    Rich supports a simple bbcode-like markup for color, style, and emoji! ğŸ‘ ğŸ ğŸœ ğŸ» ğŸ¥– ğŸšŒ                                                                              \r\n                                                                                                                                                                                    \r\n    Tables     Date           Title                                 Production Budget       Box Office                                                                              \r\n              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                             \r\n               Dec 20, 2019   Star Wars: The Rise of Skywalker           $275,000,000     $375,126,118                                                                              \r\n               May 25, 2018   Solo: A Star Wars Story                    $275,000,000     $393,151,347                                                                              \r\n               Dec 15, 2017   Star Wars Ep. VIII: The Last Jedi          $262,000,000   $1,332,539,889                                                                              \r\n               May 19, 1999   Star Wars Ep. I: The phantom Menace        $115,000,000   $1,027,044,677                                                                              \r\n                                                                                                                                                                                    \r\n    Syntax       1 def iter_last(values: Iterable[T]) -> Iterable[Tuple[bool, T]]:                {                                                                                 \r\n highlighting    2 â”‚   \"\"\"Iterate and generate a tuple with a flag for last value.\"\"\"             â”‚   'foo': [3.1427, ('Paul Atreides', 'Vladimir Harkonnen', 'Thufir Hawat')],     \r\n      &          3 â”‚   iter_values = iter(values)                                                 â”‚   'atomic': (False, True, None)                                                 \r\n    pretty       4 â”‚   try:                                                                       }                                                                                 \r\n   printing      5 â”‚   â”‚   previous_value = next(iter_values)                                                                                                                       \r\n                 6 â”‚   except StopIteration:                                                                                                                                        \r\n                 7 â”‚   â”‚   return                                                                                                                                                   \r\n                 8 â”‚   for value in iter_values:                                                                                                                                    \r\n                 9 â”‚   â”‚   yield False, previous_value                                                                                                                              \r\n                10 â”‚   â”‚   previous_value = value                                                                                                                                   \r\n                11 â”‚   yield True, previous_value                                                                                                                                   \r\n                                                                                                                                                                                    \r\n   Markdown   # Markdown                                                                          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“ \r\n                                                                                                  â”ƒ                                   Markdown                                    â”ƒ \r\n              Supports much of the *markdown* __syntax__!                                         â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”› \r\n                                                                                                                                                                                    \r\n              - Headers                                                                           Supports much of the markdown syntax!                                             \r\n              - Basic formatting: **bold**, *italic*, `code`                                                                                                                        \r\n              - Block quotes                                                                       â€¢ Headers                                                                        \r\n              - Lists, and more...                                                                 â€¢ Basic formatting: bold, italic, code                                           \r\n                                                                                                   â€¢ Block quotes                                                                   \r\n                                                                                                   â€¢ Lists, and more...                                                             \r\n                                                                                                                                                                                    \r\n    +more!    Progress bars, columns, styled logging handler, tracebacks, etc...                                                                                                    \r\n                                                                                                                                                                                    \r\nrendered in 123.0ms (cold cache)\r\nrendered in 50.0ms (warm cache)\r\n                                            â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Thanks for trying out Rich! â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                                            \r\n                                            â”‚                                                                                          â”‚                                            \r\n                                            â”‚  We hope you enjoy using Rich!               Textualize https://github.com/textualize    â”‚                                            \r\n                                            â”‚                                                                                          â”‚                                            \r\n                                            â”‚  Rich is maintained with â¤ by Textualize.io     Twitter https://twitter.com/willmcgugan  â”‚                                            \r\n                                            â”‚                                                                                          â”‚                                            \r\n                                            â”‚  - Will McGugan                                                                          â”‚                                            \r\n                                            â”‚                                                                                          â”‚                                            \r\n                                            â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯ \r\n\r\n\r\npip freeze | grep rich\r\nrich==13.3.2\r\n```\r\n</details>\r\n","closed_by":{"login":"willmcgugan","id":554369,"node_id":"MDQ6VXNlcjU1NDM2OQ==","avatar_url":"https://avatars.githubusercontent.com/u/554369?v=4","gravatar_id":"","url":"https://api.github.com/users/willmcgugan","html_url":"https://github.com/willmcgugan","followers_url":"https://api.github.com/users/willmcgugan/followers","following_url":"https://api.github.com/users/willmcgugan/following{/other_user}","gists_url":"https://api.github.com/users/willmcgugan/gists{/gist_id}","starred_url":"https://api.github.com/users/willmcgugan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willmcgugan/subscriptions","organizations_url":"https://api.github.com/users/willmcgugan/orgs","repos_url":"https://api.github.com/users/willmcgugan/repos","events_url":"https://api.github.com/users/willmcgugan/events{/privacy}","received_events_url":"https://api.github.com/users/willmcgugan/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Textualize/rich/issues/2875/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Textualize/rich/issues/2875/timeline","performed_via_github_app":null,"state_reason":"completed"}