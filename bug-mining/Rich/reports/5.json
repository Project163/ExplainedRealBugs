{"url":"https://api.github.com/repos/Textualize/rich/issues/3112","repository_url":"https://api.github.com/repos/Textualize/rich","labels_url":"https://api.github.com/repos/Textualize/rich/issues/3112/labels{/name}","comments_url":"https://api.github.com/repos/Textualize/rich/issues/3112/comments","events_url":"https://api.github.com/repos/Textualize/rich/issues/3112/events","html_url":"https://github.com/Textualize/rich/issues/3112","id":1874527118,"node_id":"I_kwDODSlIsc5vuwOO","number":3112,"title":"[BUG] pre-commit hook installation is broken on 3.10+","user":{"login":"evilhamsterman","id":59560,"node_id":"MDQ6VXNlcjU5NTYw","avatar_url":"https://avatars.githubusercontent.com/u/59560?v=4","gravatar_id":"","url":"https://api.github.com/users/evilhamsterman","html_url":"https://github.com/evilhamsterman","followers_url":"https://api.github.com/users/evilhamsterman/followers","following_url":"https://api.github.com/users/evilhamsterman/following{/other_user}","gists_url":"https://api.github.com/users/evilhamsterman/gists{/gist_id}","starred_url":"https://api.github.com/users/evilhamsterman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/evilhamsterman/subscriptions","organizations_url":"https://api.github.com/users/evilhamsterman/orgs","repos_url":"https://api.github.com/users/evilhamsterman/repos","events_url":"https://api.github.com/users/evilhamsterman/events{/privacy}","received_events_url":"https://api.github.com/users/evilhamsterman/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2200581776,"node_id":"MDU6TGFiZWwyMjAwNTgxNzc2","url":"https://api.github.com/repos/Textualize/rich/labels/Needs%20triage","name":"Needs triage","color":"bfdadc","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2023-08-30T23:46:05Z","updated_at":"2023-11-07T17:07:18Z","closed_at":"2023-11-07T17:07:07Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"- [x] I've checked [docs](https://rich.readthedocs.io/en/latest/introduction.html) and [closed issues](https://github.com/Textualize/rich/issues?q=is%3Aissue+is%3Aclosed) for possible solutions.\r\n- [x] I can't find my issue in the [FAQ](https://github.com/Textualize/rich/blob/master/FAQ.md).\r\n\r\n**Describe the bug**\r\nPre-commit hook installation on newer versions of Python it appears to be due to the pycln hook\r\n\r\n<details>\r\n<summary>pre-commit.log</summary>\r\n\r\n### version information\r\n\r\n```\r\npre-commit version: 2.21.0\r\ngit --version: git version 2.41.0\r\nsys.version:\r\n    3.11.4 (main, Jul 28 2023, 05:02:22) [GCC 12.2.0]\r\nsys.executable: /home/vscode/.cache/pypoetry/virtualenvs/rich-2QMMeOcc-py3.11/bin/python\r\nos.name: posix\r\nsys.platform: linux\r\n```\r\n\r\n### error information\r\n\r\n```\r\nAn unexpected error has occurred: CalledProcessError: command: ('/home/vscode/.cache/pre-commit/repopym0e_4s/py_env-python3/bin/python', '-mpip', 'install', '.')\r\nreturn code: 1\r\nstdout:\r\n    Processing /home/vscode/.cache/pre-commit/repopym0e_4s\r\n      Installing build dependencies: started\r\n      Installing build dependencies: finished with status 'done'\r\n      Getting requirements to build wheel: started\r\n      Getting requirements to build wheel: finished with status 'done'\r\n      Preparing metadata (pyproject.toml): started\r\n      Preparing metadata (pyproject.toml): finished with status 'done'\r\n    Collecting libcst<0.4.0,>=0.3.10 (from pycln==1.2.5)\r\n      Using cached libcst-0.3.23-py3-none-any.whl (517 kB)\r\n    Collecting pathspec<0.10.0,>=0.9.0 (from pycln==1.2.5)\r\n      Using cached pathspec-0.9.0-py2.py3-none-any.whl (31 kB)\r\n    Collecting pyyaml<6.0.0,>=5.3.1 (from pycln==1.2.5)\r\n      Using cached PyYAML-5.4.1.tar.gz (175 kB)\r\n      Installing build dependencies: started\r\n      Installing build dependencies: finished with status 'done'\r\n      Getting requirements to build wheel: started\r\n      Getting requirements to build wheel: finished with status 'error'\r\n    \r\nstderr:\r\n      error: subprocess-exited-with-error\r\n      \r\n      × Getting requirements to build wheel did not run successfully.\r\n      │ exit code: 1\r\n      ╰─> [68 lines of output]\r\n          /tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/config/setupcfg.py:293: _DeprecatedConfig: Deprecated config in `setup.cfg`\r\n          !!\r\n          \r\n                  ********************************************************************************\r\n                  The license_file parameter is deprecated, use license_files instead.\r\n          \r\n                  By 2023-Oct-30, you need to update your project and remove deprecated calls\r\n                  or your builds will no longer be supported.\r\n          \r\n                  See https://setuptools.pypa.io/en/latest/userguide/declarative_config.html for details.\r\n                  ********************************************************************************\r\n          \r\n          !!\r\n            parsed = self.parsers.get(option_name, lambda x: x)(value)\r\n          running egg_info\r\n          writing lib3/PyYAML.egg-info/PKG-INFO\r\n          writing dependency_links to lib3/PyYAML.egg-info/dependency_links.txt\r\n          writing top-level names to lib3/PyYAML.egg-info/top_level.txt\r\n          Traceback (most recent call last):\r\n            File \"/home/vscode/.cache/pre-commit/repopym0e_4s/py_env-python3/lib/python3.11/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 353, in <module>\r\n              main()\r\n            File \"/home/vscode/.cache/pre-commit/repopym0e_4s/py_env-python3/lib/python3.11/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 335, in main\r\n              json_out['return_val'] = hook(**hook_input['kwargs'])\r\n                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n            File \"/home/vscode/.cache/pre-commit/repopym0e_4s/py_env-python3/lib/python3.11/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 118, in get_requires_for_build_wheel\r\n              return hook(config_settings)\r\n                     ^^^^^^^^^^^^^^^^^^^^^\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/build_meta.py\", line 355, in get_requires_for_build_wheel\r\n              return self._get_build_requires(config_settings, requirements=['wheel'])\r\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/build_meta.py\", line 325, in _get_build_requires\r\n              self.run_setup()\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/build_meta.py\", line 341, in run_setup\r\n              exec(code, locals())\r\n            File \"<string>\", line 271, in <module>\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/__init__.py\", line 107, in setup\r\n              return distutils.core.setup(**attrs)\r\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/_distutils/core.py\", line 185, in setup\r\n              return run_commands(dist)\r\n                     ^^^^^^^^^^^^^^^^^^\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/_distutils/core.py\", line 201, in run_commands\r\n              dist.run_commands()\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/_distutils/dist.py\", line 969, in run_commands\r\n              self.run_command(cmd)\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/dist.py\", line 1233, in run_command\r\n              super().run_command(command)\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/_distutils/dist.py\", line 988, in run_command\r\n              cmd_obj.run()\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/command/egg_info.py\", line 319, in run\r\n              self.find_sources()\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/command/egg_info.py\", line 327, in find_sources\r\n              mm.run()\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/command/egg_info.py\", line 549, in run\r\n              self.add_defaults()\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/command/egg_info.py\", line 587, in add_defaults\r\n              sdist.add_defaults(self)\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/command/sdist.py\", line 113, in add_defaults\r\n              super().add_defaults()\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/_distutils/command/sdist.py\", line 251, in add_defaults\r\n              self._add_defaults_ext()\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/_distutils/command/sdist.py\", line 336, in _add_defaults_ext\r\n              self.filelist.extend(build_ext.get_source_files())\r\n                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n            File \"<string>\", line 201, in get_source_files\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/_distutils/cmd.py\", line 107, in __getattr__\r\n              raise AttributeError(attr)\r\n          AttributeError: cython_sources\r\n          [end of output]\r\n      \r\n      note: This error originates from a subprocess, and is likely not a problem with pip.\r\n    error: subprocess-exited-with-error\r\n    \r\n    × Getting requirements to build wheel did not run successfully.\r\n    │ exit code: 1\r\n    ╰─> See above for output.\r\n    \r\n    note: This error originates from a subprocess, and is likely not a problem with pip.\r\n    \r\n```\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/vscode/.cache/pypoetry/virtualenvs/rich-2QMMeOcc-py3.11/lib/python3.11/site-packages/pre_commit/error_handler.py\", line 73, in error_handler\r\n    yield\r\n  File \"/home/vscode/.cache/pypoetry/virtualenvs/rich-2QMMeOcc-py3.11/lib/python3.11/site-packages/pre_commit/main.py\", line 390, in main\r\n    return install_hooks(args.config, store)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/home/vscode/.cache/pypoetry/virtualenvs/rich-2QMMeOcc-py3.11/lib/python3.11/site-packages/pre_commit/commands/install_uninstall.py\", line 146, in install_hooks\r\n    install_hook_envs(all_hooks(load_config(config_file), store), store)\r\n  File \"/home/vscode/.cache/pypoetry/virtualenvs/rich-2QMMeOcc-py3.11/lib/python3.11/site-packages/pre_commit/repository.py\", line 223, in install_hook_envs\r\n    _hook_install(hook)\r\n  File \"/home/vscode/.cache/pypoetry/virtualenvs/rich-2QMMeOcc-py3.11/lib/python3.11/site-packages/pre_commit/repository.py\", line 79, in _hook_install\r\n    lang.install_environment(\r\n  File \"/home/vscode/.cache/pypoetry/virtualenvs/rich-2QMMeOcc-py3.11/lib/python3.11/site-packages/pre_commit/languages/python.py\", line 221, in install_environment\r\n    helpers.run_setup_cmd(prefix, install_cmd)\r\n  File \"/home/vscode/.cache/pypoetry/virtualenvs/rich-2QMMeOcc-py3.11/lib/python3.11/site-packages/pre_commit/languages/helpers.py\", line 48, in run_setup_cmd\r\n    cmd_output_b(*cmd, cwd=prefix.prefix_dir, **kwargs)\r\n  File \"/home/vscode/.cache/pypoetry/virtualenvs/rich-2QMMeOcc-py3.11/lib/python3.11/site-packages/pre_commit/util.py\", line 143, in cmd_output_b\r\n    raise CalledProcessError(returncode, cmd, stdout_b, stderr_b)\r\npre_commit.util.CalledProcessError: command: ('/home/vscode/.cache/pre-commit/repopym0e_4s/py_env-python3/bin/python', '-mpip', 'install', '.')\r\nreturn code: 1\r\nstdout:\r\n    Processing /home/vscode/.cache/pre-commit/repopym0e_4s\r\n      Installing build dependencies: started\r\n      Installing build dependencies: finished with status 'done'\r\n      Getting requirements to build wheel: started\r\n      Getting requirements to build wheel: finished with status 'done'\r\n      Preparing metadata (pyproject.toml): started\r\n      Preparing metadata (pyproject.toml): finished with status 'done'\r\n    Collecting libcst<0.4.0,>=0.3.10 (from pycln==1.2.5)\r\n      Using cached libcst-0.3.23-py3-none-any.whl (517 kB)\r\n    Collecting pathspec<0.10.0,>=0.9.0 (from pycln==1.2.5)\r\n      Using cached pathspec-0.9.0-py2.py3-none-any.whl (31 kB)\r\n    Collecting pyyaml<6.0.0,>=5.3.1 (from pycln==1.2.5)\r\n      Using cached PyYAML-5.4.1.tar.gz (175 kB)\r\n      Installing build dependencies: started\r\n      Installing build dependencies: finished with status 'done'\r\n      Getting requirements to build wheel: started\r\n      Getting requirements to build wheel: finished with status 'error'\r\n    \r\nstderr:\r\n      error: subprocess-exited-with-error\r\n      \r\n      × Getting requirements to build wheel did not run successfully.\r\n      │ exit code: 1\r\n      ╰─> [68 lines of output]\r\n          /tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/config/setupcfg.py:293: _DeprecatedConfig: Deprecated config in `setup.cfg`\r\n          !!\r\n          \r\n                  ********************************************************************************\r\n                  The license_file parameter is deprecated, use license_files instead.\r\n          \r\n                  By 2023-Oct-30, you need to update your project and remove deprecated calls\r\n                  or your builds will no longer be supported.\r\n          \r\n                  See https://setuptools.pypa.io/en/latest/userguide/declarative_config.html for details.\r\n                  ********************************************************************************\r\n          \r\n          !!\r\n            parsed = self.parsers.get(option_name, lambda x: x)(value)\r\n          running egg_info\r\n          writing lib3/PyYAML.egg-info/PKG-INFO\r\n          writing dependency_links to lib3/PyYAML.egg-info/dependency_links.txt\r\n          writing top-level names to lib3/PyYAML.egg-info/top_level.txt\r\n          Traceback (most recent call last):\r\n            File \"/home/vscode/.cache/pre-commit/repopym0e_4s/py_env-python3/lib/python3.11/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 353, in <module>\r\n              main()\r\n            File \"/home/vscode/.cache/pre-commit/repopym0e_4s/py_env-python3/lib/python3.11/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 335, in main\r\n              json_out['return_val'] = hook(**hook_input['kwargs'])\r\n                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n            File \"/home/vscode/.cache/pre-commit/repopym0e_4s/py_env-python3/lib/python3.11/site-packages/pip/_vendor/pyproject_hooks/_in_process/_in_process.py\", line 118, in get_requires_for_build_wheel\r\n              return hook(config_settings)\r\n                     ^^^^^^^^^^^^^^^^^^^^^\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/build_meta.py\", line 355, in get_requires_for_build_wheel\r\n              return self._get_build_requires(config_settings, requirements=['wheel'])\r\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/build_meta.py\", line 325, in _get_build_requires\r\n              self.run_setup()\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/build_meta.py\", line 341, in run_setup\r\n              exec(code, locals())\r\n            File \"<string>\", line 271, in <module>\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/__init__.py\", line 107, in setup\r\n              return distutils.core.setup(**attrs)\r\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/_distutils/core.py\", line 185, in setup\r\n              return run_commands(dist)\r\n                     ^^^^^^^^^^^^^^^^^^\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/_distutils/core.py\", line 201, in run_commands\r\n              dist.run_commands()\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/_distutils/dist.py\", line 969, in run_commands\r\n              self.run_command(cmd)\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/dist.py\", line 1233, in run_command\r\n              super().run_command(command)\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/_distutils/dist.py\", line 988, in run_command\r\n              cmd_obj.run()\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/command/egg_info.py\", line 319, in run\r\n              self.find_sources()\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/command/egg_info.py\", line 327, in find_sources\r\n              mm.run()\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/command/egg_info.py\", line 549, in run\r\n              self.add_defaults()\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/command/egg_info.py\", line 587, in add_defaults\r\n              sdist.add_defaults(self)\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/command/sdist.py\", line 113, in add_defaults\r\n              super().add_defaults()\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/_distutils/command/sdist.py\", line 251, in add_defaults\r\n              self._add_defaults_ext()\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/_distutils/command/sdist.py\", line 336, in _add_defaults_ext\r\n              self.filelist.extend(build_ext.get_source_files())\r\n                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n            File \"<string>\", line 201, in get_source_files\r\n            File \"/tmp/pip-build-env-a7onesou/overlay/lib/python3.11/site-packages/setuptools/_distutils/cmd.py\", line 107, in __getattr__\r\n              raise AttributeError(attr)\r\n          AttributeError: cython_sources\r\n          [end of output]\r\n      \r\n      note: This error originates from a subprocess, and is likely not a problem with pip.\r\n    error: subprocess-exited-with-error\r\n    \r\n    × Getting requirements to build wheel did not run successfully.\r\n    │ exit code: 1\r\n    ╰─> See above for output.\r\n    \r\n    note: This error originates from a subprocess, and is likely not a problem with pip.\r\n</details>\r\n\r\n\r\n\r\n**Platform**\r\nI've tried on Mac and Linux Python 3.9, 3.10, 3.11. The hooks fail to install on 3.10 and 3.11\r\n\r\n","closed_by":{"login":"darrenburns","id":5740731,"node_id":"MDQ6VXNlcjU3NDA3MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5740731?v=4","gravatar_id":"","url":"https://api.github.com/users/darrenburns","html_url":"https://github.com/darrenburns","followers_url":"https://api.github.com/users/darrenburns/followers","following_url":"https://api.github.com/users/darrenburns/following{/other_user}","gists_url":"https://api.github.com/users/darrenburns/gists{/gist_id}","starred_url":"https://api.github.com/users/darrenburns/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/darrenburns/subscriptions","organizations_url":"https://api.github.com/users/darrenburns/orgs","repos_url":"https://api.github.com/users/darrenburns/repos","events_url":"https://api.github.com/users/darrenburns/events{/privacy}","received_events_url":"https://api.github.com/users/darrenburns/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Textualize/rich/issues/3112/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Textualize/rich/issues/3112/timeline","performed_via_github_app":null,"state_reason":"completed"}