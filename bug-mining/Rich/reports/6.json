{"url":"https://api.github.com/repos/Textualize/rich/issues/3368","repository_url":"https://api.github.com/repos/Textualize/rich","labels_url":"https://api.github.com/repos/Textualize/rich/issues/3368/labels{/name}","comments_url":"https://api.github.com/repos/Textualize/rich/issues/3368/comments","events_url":"https://api.github.com/repos/Textualize/rich/issues/3368/events","html_url":"https://github.com/Textualize/rich/issues/3368","id":2327074925,"node_id":"I_kwDODSlIsc6KtFht","number":3368,"title":"[BUG] Test failures with Python 3.13.0b1: test_pretty.py and dataclass repr","user":{"login":"befeleme","id":33810531,"node_id":"MDQ6VXNlcjMzODEwNTMx","avatar_url":"https://avatars.githubusercontent.com/u/33810531?v=4","gravatar_id":"","url":"https://api.github.com/users/befeleme","html_url":"https://github.com/befeleme","followers_url":"https://api.github.com/users/befeleme/followers","following_url":"https://api.github.com/users/befeleme/following{/other_user}","gists_url":"https://api.github.com/users/befeleme/gists{/gist_id}","starred_url":"https://api.github.com/users/befeleme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/befeleme/subscriptions","organizations_url":"https://api.github.com/users/befeleme/orgs","repos_url":"https://api.github.com/users/befeleme/repos","events_url":"https://api.github.com/users/befeleme/events{/privacy}","received_events_url":"https://api.github.com/users/befeleme/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2200581776,"node_id":"MDU6TGFiZWwyMjAwNTgxNzc2","url":"https://api.github.com/repos/Textualize/rich/labels/Needs%20triage","name":"Needs triage","color":"bfdadc","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-05-31T06:40:34Z","updated_at":"2024-08-26T15:48:26Z","closed_at":"2024-08-26T15:48:12Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"- [x] I've checked [docs](https://rich.readthedocs.io/en/latest/introduction.html) and [closed issues](https://github.com/Textualize/rich/issues?q=is%3Aissue+is%3Aclosed) for possible solutions.\r\n- [x] I can't find my issue in the [FAQ](https://github.com/Textualize/rich/blob/master/FAQ.md).\r\n\r\n**Describe the bug**\r\n\r\n3 of `test_pretty` fail with Python 3.13.0b1:\r\n\r\n```\r\n=================================== FAILURES ===================================\r\n____________________________ test_pretty_dataclass _____________________________\r\n\r\n    def test_pretty_dataclass():\r\n        dc = ExampleDataclass(1000, \"Hello, World\", 999, [\"foo\", \"bar\", \"baz\"])\r\n        result = pretty_repr(dc, max_width=80)\r\n        print(repr(result))\r\n        assert (\r\n            result\r\n            == \"ExampleDataclass(foo=1000, bar='Hello, World', baz=['foo', 'bar', 'baz'])\"\r\n        )\r\n        result = pretty_repr(dc, max_width=16)\r\n        print(repr(result))\r\n>       assert (\r\n            result\r\n            == \"ExampleDataclass(\\n    foo=1000,\\n    bar='Hello, World',\\n    baz=[\\n        'foo',\\n        'bar',\\n        'baz'\\n    ]\\n)\"\r\n        )\r\nE       assert \"ExampleDataclass(foo=1000, bar='Hello, World', baz=['foo', 'bar', 'baz'])\" == \"ExampleDataclass(\\n    foo=1000,\\n    bar='Hello, World',\\n    baz=[\\n        'foo',\\n        'bar',\\n        'baz'\\n    ]\\n)\"\r\nE         + ExampleDataclass(foo=1000, bar='Hello, World', baz=['foo', 'bar', 'baz'])\r\nE         - ExampleDataclass(\r\nE         -     foo=1000,\r\nE         -     bar='Hello, World',\r\nE         -     baz=[\r\nE         -         'foo',\r\nE         -         'bar',\r\nE         -         'baz'\r\nE         -     ]\r\nE         - )\r\n\r\ntests/test_pretty.py:184: AssertionError\r\n----------------------------- Captured stdout call -----------------------------\r\n\"ExampleDataclass(foo=1000, bar='Hello, World', baz=['foo', 'bar', 'baz'])\"\r\n\"ExampleDataclass(foo=1000, bar='Hello, World', baz=['foo', 'bar', 'baz'])\"\r\n________________________ test_reference_cycle_dataclass ________________________\r\n\r\n    def test_reference_cycle_dataclass():\r\n        @dataclass\r\n        class Example:\r\n            x: int\r\n            y: Any\r\n    \r\n        test = Example(1, None)\r\n        test.y = test\r\n        res = pretty_repr(test)\r\n>       assert res == \"Example(x=1, y=...)\"\r\nE       AssertionError: assert 'test_reference_cycle_dataclass.<locals>.Example(x=1, y=...)' == 'Example(x=1, y=...)'\r\nE         - Example(x=1, y=...)\r\nE         + test_reference_cycle_dataclass.<locals>.Example(x=1, y=...)\r\n\r\ntests/test_pretty.py:356: AssertionError\r\n___________________________ test_max_depth_dataclass ___________________________\r\n\r\n    def test_max_depth_dataclass():\r\n        @dataclass\r\n        class Foo:\r\n            foo: object\r\n    \r\n        @dataclass\r\n        class Bar:\r\n            bar: object\r\n    \r\n>       assert (\r\n            pretty_repr(Foo(foo=Bar(bar=Foo(foo=[]))), max_depth=2)\r\n            == \"Foo(foo=Bar(bar=Foo(...)))\"\r\n        )\r\nE       AssertionError: assert 'test_max_depth_dataclass.<locals>.Foo(foo=test_max_depth_dataclass.<locals>.Bar(bar=test_max_depth_dataclass.<locals>.Foo(foo=[])))' == 'Foo(foo=Bar(bar=Foo(...)))'\r\nE         - Foo(foo=Bar(bar=Foo(...)))\r\nE         + test_max_depth_dataclass.<locals>.Foo(foo=test_max_depth_dataclass.<locals>.Bar(bar=test_max_depth_dataclass.<locals>.Foo(foo=[])))\r\n\r\ntests/test_pretty.py:487: AssertionError\r\n=========================== short test summary info ============================\r\nFAILED tests/test_pretty.py::test_pretty_dataclass - assert \"ExampleDataclass...\r\nFAILED tests/test_pretty.py::test_reference_cycle_dataclass - AssertionError:...\r\nFAILED tests/test_pretty.py::test_max_depth_dataclass - AssertionError: asser...\r\n============= 3 failed, 799 passed, 24 skipped, 1 warning in 4.76s =============\r\n```\r\nEdit this with a clear and concise description of what the bug.\r\n\r\nProvide a minimal code example that demonstrates the issue if you can. If the issue is visual in nature, consider posting a screenshot.\r\n\r\n**Platform**\r\n<details>\r\n<summary>Click to expand</summary>\r\n\r\nFedora Linux 41\r\n\r\n</details>\r\n","closed_by":{"login":"willmcgugan","id":554369,"node_id":"MDQ6VXNlcjU1NDM2OQ==","avatar_url":"https://avatars.githubusercontent.com/u/554369?v=4","gravatar_id":"","url":"https://api.github.com/users/willmcgugan","html_url":"https://github.com/willmcgugan","followers_url":"https://api.github.com/users/willmcgugan/followers","following_url":"https://api.github.com/users/willmcgugan/following{/other_user}","gists_url":"https://api.github.com/users/willmcgugan/gists{/gist_id}","starred_url":"https://api.github.com/users/willmcgugan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willmcgugan/subscriptions","organizations_url":"https://api.github.com/users/willmcgugan/orgs","repos_url":"https://api.github.com/users/willmcgugan/repos","events_url":"https://api.github.com/users/willmcgugan/events{/privacy}","received_events_url":"https://api.github.com/users/willmcgugan/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/Textualize/rich/issues/3368/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Textualize/rich/issues/3368/timeline","performed_via_github_app":null,"state_reason":"completed"}