{"url":"https://api.github.com/repos/gofiber/fiber/issues/3012","repository_url":"https://api.github.com/repos/gofiber/fiber","labels_url":"https://api.github.com/repos/gofiber/fiber/issues/3012/labels{/name}","comments_url":"https://api.github.com/repos/gofiber/fiber/issues/3012/comments","events_url":"https://api.github.com/repos/gofiber/fiber/issues/3012/events","html_url":"https://github.com/gofiber/fiber/issues/3012","id":2315084944,"node_id":"I_kwDODfYWS86J_WSQ","number":3012,"title":"ðŸ¤— [Question]: Is `fiber.Ctx` thread safe? If not, is that documented?","user":{"login":"omaskery","id":121959,"node_id":"MDQ6VXNlcjEyMTk1OQ==","avatar_url":"https://avatars.githubusercontent.com/u/121959?v=4","gravatar_id":"","url":"https://api.github.com/users/omaskery","html_url":"https://github.com/omaskery","followers_url":"https://api.github.com/users/omaskery/followers","following_url":"https://api.github.com/users/omaskery/following{/other_user}","gists_url":"https://api.github.com/users/omaskery/gists{/gist_id}","starred_url":"https://api.github.com/users/omaskery/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/omaskery/subscriptions","organizations_url":"https://api.github.com/users/omaskery/orgs","repos_url":"https://api.github.com/users/omaskery/repos","events_url":"https://api.github.com/users/omaskery/events{/privacy}","received_events_url":"https://api.github.com/users/omaskery/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2064310322,"node_id":"MDU6TGFiZWwyMDY0MzEwMzIy","url":"https://api.github.com/repos/gofiber/fiber/labels/%F0%9F%A4%94%20Question","name":"ðŸ¤” Question","color":"ffcce4","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2024-05-24T10:47:06Z","updated_at":"2024-06-17T07:26:14Z","closed_at":"2024-06-17T07:26:14Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Question Description\r\n\r\nThe project I've recently joined uses fiber, and when running the test suite with `--race` I'm getting races detected. Several of them seem to stem from accessing `Ctx` in multiple goroutines. For example, when `Ctx.String()` is called by our test framework it internally asks `fasthttp` for `c.fasthttp.URI().FullURI()` which internally computes the full URI on each invocation and writes it to an internal variable.\r\n\r\nI've tried searching online to see if other people have discussed this already, or had similar issues, but I've had no luck.\r\n\r\nSo my question is: is `fiber.Ctx` thread safe or is it not intended for sharing between goroutines?\r\n\r\nIf it is not thread safe: should this be documented somewhere, similar to how it is documented that `Ctx` is only valid for the duration of the request handler?\r\n\r\n### Code Snippet (optional)\r\n\r\nEdit: quickly added some pseudo code:\r\n\r\n```go\r\nfunc Handler(ctx *fiber.Ctx, ...) (..., error) {\r\n  eg := errgroup.Group{}\r\n  \r\n  eg.Go(func() error {\r\n    // use ctx\r\n    return nil\r\n  })\r\n  \r\n  eg.Go(func() error {\r\n    // use ctx\r\n    return nil\r\n  })\r\n  \r\n  if err := eg.Wait(); err != nil {\r\n    return err\r\n  }\r\n  \r\n  return ..., nil\r\n}\r\n```\r\n\r\n### Checklist:\r\n\r\n- [X] I agree to follow Fiber's [Code of Conduct](https://github.com/gofiber/fiber/blob/master/.github/CODE_OF_CONDUCT.md).\r\n- [X] I have checked for existing issues that describe my questions prior to opening this one.\r\n- [X] I understand that improperly formatted questions may be closed without explanation.","closed_by":{"login":"ReneWerner87","id":7063188,"node_id":"MDQ6VXNlcjcwNjMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/7063188?v=4","gravatar_id":"","url":"https://api.github.com/users/ReneWerner87","html_url":"https://github.com/ReneWerner87","followers_url":"https://api.github.com/users/ReneWerner87/followers","following_url":"https://api.github.com/users/ReneWerner87/following{/other_user}","gists_url":"https://api.github.com/users/ReneWerner87/gists{/gist_id}","starred_url":"https://api.github.com/users/ReneWerner87/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ReneWerner87/subscriptions","organizations_url":"https://api.github.com/users/ReneWerner87/orgs","repos_url":"https://api.github.com/users/ReneWerner87/repos","events_url":"https://api.github.com/users/ReneWerner87/events{/privacy}","received_events_url":"https://api.github.com/users/ReneWerner87/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/gofiber/fiber/issues/3012/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/gofiber/fiber/issues/3012/timeline","performed_via_github_app":null,"state_reason":"completed"}