{"url":"https://api.github.com/repos/slimphp/Slim/issues/2282","repository_url":"https://api.github.com/repos/slimphp/Slim","labels_url":"https://api.github.com/repos/slimphp/Slim/issues/2282/labels{/name}","comments_url":"https://api.github.com/repos/slimphp/Slim/issues/2282/comments","events_url":"https://api.github.com/repos/slimphp/Slim/issues/2282/events","html_url":"https://github.com/slimphp/Slim/issues/2282","id":248231649,"node_id":"MDU6SXNzdWUyNDgyMzE2NDk=","number":2282,"title":"Unable to overwrite default HTTP headers in response","user":{"login":"Finesse","id":9006227,"node_id":"MDQ6VXNlcjkwMDYyMjc=","avatar_url":"https://avatars.githubusercontent.com/u/9006227?v=4","gravatar_id":"","url":"https://api.github.com/users/Finesse","html_url":"https://github.com/Finesse","followers_url":"https://api.github.com/users/Finesse/followers","following_url":"https://api.github.com/users/Finesse/following{/other_user}","gists_url":"https://api.github.com/users/Finesse/gists{/gist_id}","starred_url":"https://api.github.com/users/Finesse/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Finesse/subscriptions","organizations_url":"https://api.github.com/users/Finesse/orgs","repos_url":"https://api.github.com/users/Finesse/repos","events_url":"https://api.github.com/users/Finesse/events{/privacy}","received_events_url":"https://api.github.com/users/Finesse/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":55368,"node_id":"MDU6TGFiZWw1NTM2OA==","url":"https://api.github.com/repos/slimphp/Slim/labels/discussion","name":"discussion","color":"b3b3b3","default":false,"description":null},{"id":210765075,"node_id":"MDU6TGFiZWwyMTA3NjUwNzU=","url":"https://api.github.com/repos/slimphp/Slim/labels/Slim%203","name":"Slim 3","color":"009800","default":false,"description":null},{"id":279496120,"node_id":"MDU6TGFiZWwyNzk0OTYxMjA=","url":"https://api.github.com/repos/slimphp/Slim/labels/question","name":"question","color":"5319e7","default":true,"description":null}],"state":"closed","locked":false,"assignee":{"login":"geggleto","id":4027602,"node_id":"MDQ6VXNlcjQwMjc2MDI=","avatar_url":"https://avatars.githubusercontent.com/u/4027602?v=4","gravatar_id":"","url":"https://api.github.com/users/geggleto","html_url":"https://github.com/geggleto","followers_url":"https://api.github.com/users/geggleto/followers","following_url":"https://api.github.com/users/geggleto/following{/other_user}","gists_url":"https://api.github.com/users/geggleto/gists{/gist_id}","starred_url":"https://api.github.com/users/geggleto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/geggleto/subscriptions","organizations_url":"https://api.github.com/users/geggleto/orgs","repos_url":"https://api.github.com/users/geggleto/repos","events_url":"https://api.github.com/users/geggleto/events{/privacy}","received_events_url":"https://api.github.com/users/geggleto/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"geggleto","id":4027602,"node_id":"MDQ6VXNlcjQwMjc2MDI=","avatar_url":"https://avatars.githubusercontent.com/u/4027602?v=4","gravatar_id":"","url":"https://api.github.com/users/geggleto","html_url":"https://github.com/geggleto","followers_url":"https://api.github.com/users/geggleto/followers","following_url":"https://api.github.com/users/geggleto/following{/other_user}","gists_url":"https://api.github.com/users/geggleto/gists{/gist_id}","starred_url":"https://api.github.com/users/geggleto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/geggleto/subscriptions","organizations_url":"https://api.github.com/users/geggleto/orgs","repos_url":"https://api.github.com/users/geggleto/repos","events_url":"https://api.github.com/users/geggleto/events{/privacy}","received_events_url":"https://api.github.com/users/geggleto/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":12,"created_at":"2017-08-06T07:46:48Z","updated_at":"2018-05-16T12:55:36Z","closed_at":"2018-05-15T14:19:47Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### The problem\r\n\r\nI try to make a response cached by a browser. To do it I run:\r\n\r\n```php\r\n$app->get('/test', function ($request, $response, $arguments) {\r\n    return $response\r\n        ->withHeader('Cache-Control', 'public, max-age=86400')\r\n        ->write('Hello');\r\n});\r\n```\r\n\r\nWhen I send a request to the route I get a response with such headers:\r\n\r\n```\r\nCache-Control: no-store, no-cache, must-revalidate\r\nCache-Control: max-age=86400, public\r\n```\r\n\r\nAs a result, the browser doesn't cache the response.\r\n\r\n\r\n### Investigation\r\n\r\nI've found that Slim sends headers using this code (`Slim\\App::respond`):\r\n\r\n```php\r\n// Headers\r\nforeach ($response->getHeaders() as $name => $values) {\r\n    foreach ($values as $value) {\r\n        header(sprintf('%s: %s', $name, $value), false);\r\n    }\r\n}\r\n```\r\n\r\nThe second argument of the `header` function stands for «do not remove previous and default headers» being equal `false`. That's why browser gets the default headers in the response.\r\n\r\nTo workaround this I had to add `header_remove('Cache-Control')` to the route code. I believe this is a dirty hack.\r\n\r\n\r\n### Suggested solution\r\n\r\nCall the `header` function with the second argument equals `true` for the first value of the header and equals `false` for the rest:\r\n\r\n```php\r\n// Headers\r\nforeach ($response->getHeaders() as $name => $values) {\r\n    foreach ($values as $index => $value) {\r\n        header(sprintf('%s: %s', $name, $value), $index === 0);\r\n    }\r\n}\r\n```\r\n\r\nI would make a pull request if you agree.\r\n\r\nP.S. There is a similar issue here: https://github.com/slimphp/Slim/issues/2246. There is no solution in that issue.","closed_by":{"login":"geggleto","id":4027602,"node_id":"MDQ6VXNlcjQwMjc2MDI=","avatar_url":"https://avatars.githubusercontent.com/u/4027602?v=4","gravatar_id":"","url":"https://api.github.com/users/geggleto","html_url":"https://github.com/geggleto","followers_url":"https://api.github.com/users/geggleto/followers","following_url":"https://api.github.com/users/geggleto/following{/other_user}","gists_url":"https://api.github.com/users/geggleto/gists{/gist_id}","starred_url":"https://api.github.com/users/geggleto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/geggleto/subscriptions","organizations_url":"https://api.github.com/users/geggleto/orgs","repos_url":"https://api.github.com/users/geggleto/repos","events_url":"https://api.github.com/users/geggleto/events{/privacy}","received_events_url":"https://api.github.com/users/geggleto/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/slimphp/Slim/issues/2282/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/slimphp/Slim/issues/2282/timeline","performed_via_github_app":null,"state_reason":"completed"}