{"url":"https://api.github.com/repos/slimphp/Slim/issues/1590","repository_url":"https://api.github.com/repos/slimphp/Slim","labels_url":"https://api.github.com/repos/slimphp/Slim/issues/1590/labels{/name}","comments_url":"https://api.github.com/repos/slimphp/Slim/issues/1590/comments","events_url":"https://api.github.com/repos/slimphp/Slim/issues/1590/events","html_url":"https://github.com/slimphp/Slim/issues/1590","id":116987464,"node_id":"MDU6SXNzdWUxMTY5ODc0NjQ=","number":1590,"title":"Issue with \"index.php\" appearing in Pretty Rewrite URLs","user":{"login":"pokmot","id":546113,"node_id":"MDQ6VXNlcjU0NjExMw==","avatar_url":"https://avatars.githubusercontent.com/u/546113?v=4","gravatar_id":"","url":"https://api.github.com/users/pokmot","html_url":"https://github.com/pokmot","followers_url":"https://api.github.com/users/pokmot/followers","following_url":"https://api.github.com/users/pokmot/following{/other_user}","gists_url":"https://api.github.com/users/pokmot/gists{/gist_id}","starred_url":"https://api.github.com/users/pokmot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pokmot/subscriptions","organizations_url":"https://api.github.com/users/pokmot/orgs","repos_url":"https://api.github.com/users/pokmot/repos","events_url":"https://api.github.com/users/pokmot/events{/privacy}","received_events_url":"https://api.github.com/users/pokmot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2015-11-15T11:17:31Z","updated_at":"2015-11-28T20:39:21Z","closed_at":"2015-11-28T20:39:21Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This can of course be resolved with middleware, however as this has an effect on potentially all sites using URL rewrites I thought I would raise it now.\n\nIf, when using URL rewrite, you access the site by including the PHP file name in the url (e.g. index.php), getBasePath includes the file name in the result. When using this as a base href=\"\" tag, all my static files are now being routed through the PHP file:\n\n```\nIn HTML:\n<base href=\"{{ BasePath }}\">\n<link rel=\"stylesheet\" href=\"css/style.css\"/>\n\nSample:\n$uri = \\Slim\\Http\\Uri::createFromEnvironment(\n    \\Slim\\Http\\Environment::mock(\n        [\n            'SCRIPT_NAME' => '/foo/index.php',\n            'REQUEST_URI' => '/foo/index.php',\n        ])\n);\nprint $uri->getBasePath();\n\n// Output: /foo/index.php\n// Asset path becomes: /foo/index.php/css/style.css **not working**\n\n\n$uri = \\Slim\\Http\\Uri::createFromEnvironment(\n    \\Slim\\Http\\Environment::mock(\n        [\n            'SCRIPT_NAME' => '/foo/index.php',\n            'REQUEST_URI' => '/foo/',\n        ])\n);\nprint $uri->getBasePath();\n\n// Output: /foo\n// Asset path becomes: /foo/css/style.css **works great**\n```\n\nThe issue is the comparison made on line 197 of Uri.php - as the request uri and the script name is the same, getBasePath will return it including the script name.\n\nI do understand this is desired behavior for those not using URL rewriting, however for those that do, this is an issue.\n\nMy main issue is that the behavior is inconsistent and depends whether it's loading a script directly or using URL rewriting. If it always included the script name I would simply use dirname(). If it never included it I could easily add index.php where needed.\n\nWith this scenario I need to do the same comparison as done on line 197 in Uri.php, and if they match I use dirname to get the path on its own,\n\nAny thoughts on how this is best resolved? Middleware or Slim code change? Or use a redirect in .htaccess?\n","closed_by":{"login":"akrabat","id":33135,"node_id":"MDQ6VXNlcjMzMTM1","avatar_url":"https://avatars.githubusercontent.com/u/33135?v=4","gravatar_id":"","url":"https://api.github.com/users/akrabat","html_url":"https://github.com/akrabat","followers_url":"https://api.github.com/users/akrabat/followers","following_url":"https://api.github.com/users/akrabat/following{/other_user}","gists_url":"https://api.github.com/users/akrabat/gists{/gist_id}","starred_url":"https://api.github.com/users/akrabat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/akrabat/subscriptions","organizations_url":"https://api.github.com/users/akrabat/orgs","repos_url":"https://api.github.com/users/akrabat/repos","events_url":"https://api.github.com/users/akrabat/events{/privacy}","received_events_url":"https://api.github.com/users/akrabat/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/slimphp/Slim/issues/1590/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/slimphp/Slim/issues/1590/timeline","performed_via_github_app":null,"state_reason":"completed"}