{"url":"https://api.github.com/repos/laravel/framework/issues/54869","repository_url":"https://api.github.com/repos/laravel/framework","labels_url":"https://api.github.com/repos/laravel/framework/issues/54869/labels{/name}","comments_url":"https://api.github.com/repos/laravel/framework/issues/54869/comments","events_url":"https://api.github.com/repos/laravel/framework/issues/54869/events","html_url":"https://github.com/laravel/framework/issues/54869","id":2890128579,"node_id":"I_kwDOAHMwOs6sQ9zD","number":54869,"title":"InferBasePath fails to resolve application when project name is vendor","user":{"login":"shane-zeng","id":82361059,"node_id":"MDQ6VXNlcjgyMzYxMDU5","avatar_url":"https://avatars.githubusercontent.com/u/82361059?v=4","gravatar_id":"","url":"https://api.github.com/users/shane-zeng","html_url":"https://github.com/shane-zeng","followers_url":"https://api.github.com/users/shane-zeng/followers","following_url":"https://api.github.com/users/shane-zeng/following{/other_user}","gists_url":"https://api.github.com/users/shane-zeng/gists{/gist_id}","starred_url":"https://api.github.com/users/shane-zeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shane-zeng/subscriptions","organizations_url":"https://api.github.com/users/shane-zeng/orgs","repos_url":"https://api.github.com/users/shane-zeng/repos","events_url":"https://api.github.com/users/shane-zeng/events{/privacy}","received_events_url":"https://api.github.com/users/shane-zeng/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":24480042,"node_id":"MDU6TGFiZWwyNDQ4MDA0Mg==","url":"https://api.github.com/repos/laravel/framework/labels/bug","name":"bug","color":"ee0701","default":true,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2025-03-03T04:25:25Z","updated_at":"2025-03-04T00:04:46Z","closed_at":"2025-03-04T00:04:45Z","author_association":"CONTRIBUTOR","type":{"id":153191,"node_id":"IT_kwDOAA6eeM4AAlZn","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T09:16:16Z","updated_at":"2024-07-26T10:05:51Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Laravel Version\n\n11.44.0\n\n### PHP Version\n\n8.2.27\n\n### Database Driver & Version\n\n_No response_\n\n### Description\n\n**Description:**\n\nAfter upgrading to Laravel 11, our test suite started failing with the following error when running tests in a project named vendor:\n```\nParallel Runner unable to resolve application.\n```\n\nAdditionally, the following warnings appear:\n```\nINFO  Warning: Undefined array key 0 in /vendor/laravel/framework/src/Illuminate/Foundation/Application.php on line 261\nDeprecated: dirname(): Passing null to parameter #1 ($path) of type string is deprecated in /vendor/laravel/framework/src/Illuminate/Foundation/Application.php on line 258\n```\n\n**Expected Behavior**\n\nEven if the project name is vendor, inferBasePath should still be able to resolve the application path without errors.\n\n**Request for Help**\n\nI would like to avoid manually setting APP_BASE_PATH as an environment variable to work around this issue. Is there a cleaner solution or workaround that can prevent this error from occurring without having to adjust the APP_BASE_PATH?\n\nThis issue only started appearing after [PR #54119](https://github.com/laravel/framework/pull/54119) was merged. Would appreciate any insights or potential fixes. Thanks!\n\n### Steps To Reproduce\n\n1. Create a new Laravel project named vendor:\n```\ncomposer create-project laravel/laravel vendor\n```\n\n2. Navigate into the project directory and run tests:\n```\ncd vendor\nphp artisan test --parallel\n```\n\n3. Observe the error output.\n\n**Possible Cause**\nThe issue appeared after merging [PR #54119](https://github.com/laravel/framework/pull/54119). The problem arises in the inferBasePath method in Illuminate\\Foundation\\Application:\n\n```\npublic static function inferBasePath()\n{\n    return match (true) {\n        isset($_ENV['APP_BASE_PATH']) => $_ENV['APP_BASE_PATH'],\n        default => dirname(array_values(array_filter(\n            array_keys(ClassLoader::getRegisteredLoaders()),\n            fn ($path) => ! str_contains($path, '/vendor/'),\n        ))[0]),\n    };\n}\n```\n\nSince the project name itself is vendor, the array filter removes all matching paths, leading to an empty array. When array_values(...)[0] is accessed, it results in an “Undefined array key 0” warning, followed by a dirname(null) deprecation warning.","closed_by":{"login":"crynobone","id":172966,"node_id":"MDQ6VXNlcjE3Mjk2Ng==","avatar_url":"https://avatars.githubusercontent.com/u/172966?v=4","gravatar_id":"","url":"https://api.github.com/users/crynobone","html_url":"https://github.com/crynobone","followers_url":"https://api.github.com/users/crynobone/followers","following_url":"https://api.github.com/users/crynobone/following{/other_user}","gists_url":"https://api.github.com/users/crynobone/gists{/gist_id}","starred_url":"https://api.github.com/users/crynobone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/crynobone/subscriptions","organizations_url":"https://api.github.com/users/crynobone/orgs","repos_url":"https://api.github.com/users/crynobone/repos","events_url":"https://api.github.com/users/crynobone/events{/privacy}","received_events_url":"https://api.github.com/users/crynobone/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/laravel/framework/issues/54869/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":1,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/laravel/framework/issues/54869/timeline","performed_via_github_app":null,"state_reason":"completed"}