{"url":"https://api.github.com/repos/laravel/framework/issues/51747","repository_url":"https://api.github.com/repos/laravel/framework","labels_url":"https://api.github.com/repos/laravel/framework/issues/51747/labels{/name}","comments_url":"https://api.github.com/repos/laravel/framework/issues/51747/comments","events_url":"https://api.github.com/repos/laravel/framework/issues/51747/events","html_url":"https://github.com/laravel/framework/issues/51747","id":2341539789,"node_id":"I_kwDOAHMwOs6LkQ_N","number":51747,"title":"SQLite issue with default 0 columns when migrating db from schema dump since L11 upgrade","user":{"login":"adiachenko","id":10194667,"node_id":"MDQ6VXNlcjEwMTk0NjY3","avatar_url":"https://avatars.githubusercontent.com/u/10194667?v=4","gravatar_id":"","url":"https://api.github.com/users/adiachenko","html_url":"https://github.com/adiachenko","followers_url":"https://api.github.com/users/adiachenko/followers","following_url":"https://api.github.com/users/adiachenko/following{/other_user}","gists_url":"https://api.github.com/users/adiachenko/gists{/gist_id}","starred_url":"https://api.github.com/users/adiachenko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adiachenko/subscriptions","organizations_url":"https://api.github.com/users/adiachenko/orgs","repos_url":"https://api.github.com/users/adiachenko/repos","events_url":"https://api.github.com/users/adiachenko/events{/privacy}","received_events_url":"https://api.github.com/users/adiachenko/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1993557750,"node_id":"MDU6TGFiZWwxOTkzNTU3NzUw","url":"https://api.github.com/repos/laravel/framework/labels/help%20wanted","name":"help wanted","color":"008672","default":true,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2024-06-08T08:00:28Z","updated_at":"2024-06-14T16:22:16Z","closed_at":"2024-06-14T16:22:15Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Laravel Version\r\n\r\n11.10.0\r\n\r\n### PHP Version\r\n\r\n8.3.1\r\n\r\n### Database Driver & Version\r\n\r\nSQLite 3.43.2\r\n\r\n### Description\r\n\r\nAfter upgrade to Laravel 11 we started receiving the following error in tests (using sqlite in memory)\r\n\r\n```\r\nIlluminate\\Database\\QueryException: SQLSTATE[23000]: Integrity constraint violation: 19 NOT NULL constraint failed: partners.support_priority\r\n```\r\n\r\nIt looked like the issue was caused by columns in schema dump file that had `default 0 not null` clause attached to them.\r\n\r\nI tried looking closer into what is going on and comparing it on Laravel 10 and Laravel 11:\r\n\r\n```\r\n$schema = DB::select(\"PRAGMA table_info(partners);\");\r\ndd($schema);\r\n```\r\n\r\nOn Laravel 10 this outputs the following for problematic column:\r\n```\r\n{\r\n    \"cid\": 13\r\n    \"name\": \"support_priority\"\r\n    \"type\": \"INTEGER\"\r\n    \"notnull\": 1\r\n    \"dflt_value\": \"0\"\r\n    \"pk\": 0\r\n}\r\n```\r\n\r\nMeanwhile, on Laravel 11:\r\n```\r\n{\r\n    \"cid\": 13\r\n    \"name\": \"support_priority\"\r\n    \"type\": \"INTEGER\"\r\n    \"notnull\": 1\r\n    \"dflt_value\": null\r\n    \"pk\": 0\r\n}\r\n```\r\n\r\nNote how Laravel 11 version does not default 0. Recreating schema dump file on Laravel 11 did not fix the issue. So I searched and replaced all instances DEFAULT 0 на DEFAULT '0' in schema dump file and, interestingly, the issue was gone. Makes me wonder in Laravel 11 has some weird type coercion issue that equates 0 to null. \r\n\r\n### Steps To Reproduce\r\n\r\nNote that the issue may not be easy to reproduce because when creating the dump itself Laravel (both on 10 or 11) seemingly randomly uses different syntax for different tables: I have some tables with `integer not null default '0'` and some with `INTEGER DEFAULT 0 NOT NULL` on similar columns. I am no sure what the correlation here. However, regardless of this, the dump did not cause issue on Laravel 10, but does on Laravel 11.","closed_by":{"login":"taylorotwell","id":463230,"node_id":"MDQ6VXNlcjQ2MzIzMA==","avatar_url":"https://avatars.githubusercontent.com/u/463230?v=4","gravatar_id":"","url":"https://api.github.com/users/taylorotwell","html_url":"https://github.com/taylorotwell","followers_url":"https://api.github.com/users/taylorotwell/followers","following_url":"https://api.github.com/users/taylorotwell/following{/other_user}","gists_url":"https://api.github.com/users/taylorotwell/gists{/gist_id}","starred_url":"https://api.github.com/users/taylorotwell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/taylorotwell/subscriptions","organizations_url":"https://api.github.com/users/taylorotwell/orgs","repos_url":"https://api.github.com/users/taylorotwell/repos","events_url":"https://api.github.com/users/taylorotwell/events{/privacy}","received_events_url":"https://api.github.com/users/taylorotwell/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/laravel/framework/issues/51747/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/laravel/framework/issues/51747/timeline","performed_via_github_app":null,"state_reason":"completed"}