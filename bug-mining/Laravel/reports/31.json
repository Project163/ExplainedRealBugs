{"url":"https://api.github.com/repos/laravel/framework/issues/54785","repository_url":"https://api.github.com/repos/laravel/framework","labels_url":"https://api.github.com/repos/laravel/framework/issues/54785/labels{/name}","comments_url":"https://api.github.com/repos/laravel/framework/issues/54785/comments","events_url":"https://api.github.com/repos/laravel/framework/issues/54785/events","html_url":"https://github.com/laravel/framework/issues/54785","id":2877421467,"node_id":"I_kwDOAHMwOs6rgfeb","number":54785,"title":"ValueObject for key in Notification::fake() testing","user":{"login":"koraga","id":34651075,"node_id":"MDQ6VXNlcjM0NjUxMDc1","avatar_url":"https://avatars.githubusercontent.com/u/34651075?v=4","gravatar_id":"","url":"https://api.github.com/users/koraga","html_url":"https://github.com/koraga","followers_url":"https://api.github.com/users/koraga/followers","following_url":"https://api.github.com/users/koraga/following{/other_user}","gists_url":"https://api.github.com/users/koraga/gists{/gist_id}","starred_url":"https://api.github.com/users/koraga/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/koraga/subscriptions","organizations_url":"https://api.github.com/users/koraga/orgs","repos_url":"https://api.github.com/users/koraga/repos","events_url":"https://api.github.com/users/koraga/events{/privacy}","received_events_url":"https://api.github.com/users/koraga/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":24480042,"node_id":"MDU6TGFiZWwyNDQ4MDA0Mg==","url":"https://api.github.com/repos/laravel/framework/labels/bug","name":"bug","color":"ee0701","default":true,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2025-02-25T07:45:40Z","updated_at":"2025-02-27T18:28:13Z","closed_at":"2025-02-27T18:28:13Z","author_association":"NONE","type":{"id":153191,"node_id":"IT_kwDOAA6eeM4AAlZn","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T09:16:16Z","updated_at":"2024-07-26T10:05:51Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Laravel Version\n\n11.38.2\n\n### PHP Version\n\n8.3.17\n\n### Database Driver & Version\n\nPostgres 17 + MacOS 15.3.1 arm\n\n### Description\n\nWhen attempting to test notification sending for a model where the key is a ValueObject, I encountered errors indicating that the array key is invalid.\n\n```php\n/**\n * @property Uuid $id\n */\nfinal class User extends Authenticatable\n{\n    public $incrementing = false;\n\n    public $usesUniqueIds = true;\n\n    protected $keyType = 'string';\n\n    protected function casts(): array\n    {\n        return [\n            'id' => Uuid::class,\n        ];\n    }\n}\n\nfinal class Test extends TestCase\n{\n    public function testAssertNotificationSentTo(): void\n    {\n        Notification::fake();\n\n        $user = User::factory()->create();\n\n        $job = new Job($user);\n        $job->handle();\n\n        Notification::assertSentTo($user, RegistrationNotification::class);\n    }\n}\n```\n\nand i catch error\n```\nTypeError: Cannot access offset of type App\\Infrastructure\\Uuid\\Uuid on array\n/var/www/html/vendor/laravel/framework/src/Illuminate/Support/Testing/Fakes/NotificationFake.php:329\n/var/www/html/vendor/laravel/framework/src/Illuminate/Support/Testing/Fakes/NotificationFake.php:294\n/var/www/html/app/Telegram/Jobs/Job.php:24\n/var/www/html/tests/Feature/Telegram/Jobs/Test.php:32\n```\n\nValueObject for model key works fine everywhere except Notification::fake(). This behavior is inconsistent.\n\nMy solution for this bug https://github.com/laravel/framework/pull/54769\n\n### Steps To Reproduce\n\nCreate ValueObject with [casts](https://laravel.com/docs/11.x/eloquent-mutators#value-object-casting) for ID (model key) and try testing with Notifications. ","closed_by":{"login":"taylorotwell","id":463230,"node_id":"MDQ6VXNlcjQ2MzIzMA==","avatar_url":"https://avatars.githubusercontent.com/u/463230?v=4","gravatar_id":"","url":"https://api.github.com/users/taylorotwell","html_url":"https://github.com/taylorotwell","followers_url":"https://api.github.com/users/taylorotwell/followers","following_url":"https://api.github.com/users/taylorotwell/following{/other_user}","gists_url":"https://api.github.com/users/taylorotwell/gists{/gist_id}","starred_url":"https://api.github.com/users/taylorotwell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/taylorotwell/subscriptions","organizations_url":"https://api.github.com/users/taylorotwell/orgs","repos_url":"https://api.github.com/users/taylorotwell/repos","events_url":"https://api.github.com/users/taylorotwell/events{/privacy}","received_events_url":"https://api.github.com/users/taylorotwell/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/laravel/framework/issues/54785/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/laravel/framework/issues/54785/timeline","performed_via_github_app":null,"state_reason":"completed"}