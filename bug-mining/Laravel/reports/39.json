{"url":"https://api.github.com/repos/laravel/framework/issues/55732","repository_url":"https://api.github.com/repos/laravel/framework","labels_url":"https://api.github.com/repos/laravel/framework/issues/55732/labels{/name}","comments_url":"https://api.github.com/repos/laravel/framework/issues/55732/comments","events_url":"https://api.github.com/repos/laravel/framework/issues/55732/events","html_url":"https://github.com/laravel/framework/issues/55732","id":3062533507,"node_id":"I_kwDOAHMwOs62io2D","number":55732,"title":"Http Client mangles multiple-valued keys in parseMultipartBodyFormat","user":{"login":"tobia","id":48756,"node_id":"MDQ6VXNlcjQ4NzU2","avatar_url":"https://avatars.githubusercontent.com/u/48756?v=4","gravatar_id":"","url":"https://api.github.com/users/tobia","html_url":"https://github.com/tobia","followers_url":"https://api.github.com/users/tobia/followers","following_url":"https://api.github.com/users/tobia/following{/other_user}","gists_url":"https://api.github.com/users/tobia/gists{/gist_id}","starred_url":"https://api.github.com/users/tobia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tobia/subscriptions","organizations_url":"https://api.github.com/users/tobia/orgs","repos_url":"https://api.github.com/users/tobia/repos","events_url":"https://api.github.com/users/tobia/events{/privacy}","received_events_url":"https://api.github.com/users/tobia/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1993557750,"node_id":"MDU6TGFiZWwxOTkzNTU3NzUw","url":"https://api.github.com/repos/laravel/framework/labels/help%20wanted","name":"help wanted","color":"008672","default":true,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2025-05-14T09:56:27Z","updated_at":"2025-07-18T16:31:59Z","closed_at":"2025-07-18T16:31:59Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Laravel Version\n\n12.x\n\n### PHP Version\n\n8.4\n\n### Database Driver & Version\n\n_No response_\n\n### Description\n\nPremise: http post data often contains multiple values for the same key. This is needed to post the selection of checkbox widgets, select widgets with the multiple flag set, and others. Laravel's http client receives the post data and stores it internally as a keyed array, therefore the only way to post multiple values for a single key is to associate the key with an array of values:\n```\nHttp::post('http://example.com/users', [\n    'name' => 'Steve',\n    'roles' => ['Network Administrator', 'Janitor'],\n]);\n```\nThis bug happens when the request includes both attached files, which forces it to be sent as multipart/form-data, and checkboxes or other input elements with multiple values.\nThe source of the bug is [PendingRequest::parseMultipartBodyFormat](https://github.com/laravel/framework/blob/12.x/src/Illuminate/Http/Client/PendingRequest.php#L1012) in the following code:\n```\nis_array($value) ? $value : ['name' => $key, 'contents' => $value]\n```\nThis fails to handle multiple value arrays, such as `['Network Administrator', 'Janitor']`.\n\n### Steps To Reproduce\n\nUse the Laravel Http client to make a POST request that includes both an attached file and a multiple-valued key. For example:\n```\nHttp::attach(\n    'attachment', file_get_contents('photo.jpg'), 'photo.jpg', ['Content-Type' => 'image/jpeg']\n)->post('http://example.com/users', [\n    'name' => 'Steve',\n    'roles' => ['Network Administrator', 'Janitor'],\n]);\n```\nThis mangles the multiple-valued key and results in InvalidArgumentException: A 'contents' key is required.","closed_by":{"login":"taylorotwell","id":463230,"node_id":"MDQ6VXNlcjQ2MzIzMA==","avatar_url":"https://avatars.githubusercontent.com/u/463230?v=4","gravatar_id":"","url":"https://api.github.com/users/taylorotwell","html_url":"https://github.com/taylorotwell","followers_url":"https://api.github.com/users/taylorotwell/followers","following_url":"https://api.github.com/users/taylorotwell/following{/other_user}","gists_url":"https://api.github.com/users/taylorotwell/gists{/gist_id}","starred_url":"https://api.github.com/users/taylorotwell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/taylorotwell/subscriptions","organizations_url":"https://api.github.com/users/taylorotwell/orgs","repos_url":"https://api.github.com/users/taylorotwell/repos","events_url":"https://api.github.com/users/taylorotwell/events{/privacy}","received_events_url":"https://api.github.com/users/taylorotwell/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/laravel/framework/issues/55732/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/laravel/framework/issues/55732/timeline","performed_via_github_app":null,"state_reason":"completed"}