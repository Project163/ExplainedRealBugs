{"url":"https://api.github.com/repos/laravel/framework/issues/53226","repository_url":"https://api.github.com/repos/laravel/framework","labels_url":"https://api.github.com/repos/laravel/framework/issues/53226/labels{/name}","comments_url":"https://api.github.com/repos/laravel/framework/issues/53226/comments","events_url":"https://api.github.com/repos/laravel/framework/issues/53226/events","html_url":"https://github.com/laravel/framework/issues/53226","id":2597503056,"node_id":"I_kwDOAHMwOs6a0sBQ","number":53226,"title":"Incorrect bindings in DB::update when using a collection as a value","user":{"login":"omergy","id":98457067,"node_id":"U_kgDOBd5V6w","avatar_url":"https://avatars.githubusercontent.com/u/98457067?v=4","gravatar_id":"","url":"https://api.github.com/users/omergy","html_url":"https://github.com/omergy","followers_url":"https://api.github.com/users/omergy/followers","following_url":"https://api.github.com/users/omergy/following{/other_user}","gists_url":"https://api.github.com/users/omergy/gists{/gist_id}","starred_url":"https://api.github.com/users/omergy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/omergy/subscriptions","organizations_url":"https://api.github.com/users/omergy/orgs","repos_url":"https://api.github.com/users/omergy/repos","events_url":"https://api.github.com/users/omergy/events{/privacy}","received_events_url":"https://api.github.com/users/omergy/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2024-10-18T13:18:33Z","updated_at":"2024-10-22T07:59:25Z","closed_at":"2024-10-21T14:03:08Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Laravel Version\n\n11.26.0\n\n### PHP Version\n\n8.3.12\n\n### Database Driver & Version\n\nMySQL\n\n### Description\n\nWhen using a collection as a column value in DB::update, the wrong bindings are applied.\r\nBefore Laravel 11, the collection would be turned into a string (which still is the case if you use an array) but now all the values of the collection is spread and added to the bindings array.\r\n\r\nThe change seems to have come from this pull request with the added `Arr::flatten`: https://github.com/laravel/framework/pull/50030\r\n\r\nExample:\r\n\r\n- `DB::table('foo')->update(['bar' => collect(['a', 'b'])]);`\r\n- gives the error ```SQLSTATE[HY093]: Invalid parameter number (Connection: mysql, SQL: update `foo` set `bar` = a)```\r\n- Expected is that the collection should become a (json)string `'[\"a\",\"b\"]'` and be saved in the database.\r\n\r\nWith an array it still works (and this is how it was in version < 11 with collections)\r\n- `DB::table('foo')->update(['bar' => ['a', 'b']]);`\r\n- correctly updates with: ```update `foo` set `bar` = [\"a\",\"b\"]```\n\n### Steps To Reproduce\n\n- Use Laravel 11.x\r\n- Create (example) table:\r\n```<?php\r\n\r\nuse Illuminate\\Database\\Migrations\\Migration;\r\nuse Illuminate\\Database\\Schema\\Blueprint;\r\nuse Illuminate\\Support\\Facades\\Schema;\r\n\r\nreturn new class extends Migration {\r\n    public function up(): void\r\n    {\r\n        Schema::create('foo', function (Blueprint $table) {\r\n            $table->id();\r\n            $table->string('bar');\r\n        });\r\n    }\r\n\r\n    public function down(): void\r\n    {\r\n        Schema::dropIfExists('foo');\r\n    }\r\n};\r\n```\r\n- `php artisan tinker`\r\n- `DB::table('foo')->update(['bar' => collect(['a', 'b'])]);`","closed_by":{"login":"taylorotwell","id":463230,"node_id":"MDQ6VXNlcjQ2MzIzMA==","avatar_url":"https://avatars.githubusercontent.com/u/463230?v=4","gravatar_id":"","url":"https://api.github.com/users/taylorotwell","html_url":"https://github.com/taylorotwell","followers_url":"https://api.github.com/users/taylorotwell/followers","following_url":"https://api.github.com/users/taylorotwell/following{/other_user}","gists_url":"https://api.github.com/users/taylorotwell/gists{/gist_id}","starred_url":"https://api.github.com/users/taylorotwell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/taylorotwell/subscriptions","organizations_url":"https://api.github.com/users/taylorotwell/orgs","repos_url":"https://api.github.com/users/taylorotwell/repos","events_url":"https://api.github.com/users/taylorotwell/events{/privacy}","received_events_url":"https://api.github.com/users/taylorotwell/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/laravel/framework/issues/53226/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/laravel/framework/issues/53226/timeline","performed_via_github_app":null,"state_reason":"completed"}