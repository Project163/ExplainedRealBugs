{"url":"https://api.github.com/repos/pugjs/pug/issues/227","repository_url":"https://api.github.com/repos/pugjs/pug","labels_url":"https://api.github.com/repos/pugjs/pug/issues/227/labels{/name}","comments_url":"https://api.github.com/repos/pugjs/pug/issues/227/comments","events_url":"https://api.github.com/repos/pugjs/pug/issues/227/events","html_url":"https://github.com/pugjs/pug/issues/227","id":946335,"node_id":"MDU6SXNzdWU5NDYzMzU=","number":227,"title":"renderFile may call callback twice if it throws an error","user":{"login":"awwright","id":437517,"node_id":"MDQ6VXNlcjQzNzUxNw==","avatar_url":"https://avatars.githubusercontent.com/u/437517?v=4","gravatar_id":"","url":"https://api.github.com/users/awwright","html_url":"https://github.com/awwright","followers_url":"https://api.github.com/users/awwright/followers","following_url":"https://api.github.com/users/awwright/following{/other_user}","gists_url":"https://api.github.com/users/awwright/gists{/gist_id}","starred_url":"https://api.github.com/users/awwright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/awwright/subscriptions","organizations_url":"https://api.github.com/users/awwright/orgs","repos_url":"https://api.github.com/users/awwright/repos","events_url":"https://api.github.com/users/awwright/events{/privacy}","received_events_url":"https://api.github.com/users/awwright/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2011-05-24T10:23:03Z","updated_at":"2011-05-24T18:03:26Z","closed_at":"2011-05-24T18:03:25Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"In exports.renderFile in lib/index.js, if the requested file is not cached, it will be rendered with the following code:\n\n``` javascript\n    fs.readFile(path, 'utf8', function(err, str){\n      if (err) return fn(err);\n      try {\n        fn(null, exports.render(str, options));\n      } catch (err) {\n        fn(err);\n      }\n    });\n```\n\nThis poses a problem because if the call to fn() creates an exception (or any error) it wil be caught by Jade and be called again in the catch block. Callbacks are of course only supposed to be called once, and Jade shouldn't be catching outside exceptions anyways.\nThe code should probably look something like this:\n\n``` javascript\n    fs.readFile(path, 'utf8', function(err, str){\n      if (err) return fn(err);\n      try {\n        var result = exports.render(str, options);\n      } catch (err) {\n        return fn(err);\n      }\n      fn(null, result);\n    });\n```\n","closed_by":{"login":"tj","id":25254,"node_id":"MDQ6VXNlcjI1MjU0","avatar_url":"https://avatars.githubusercontent.com/u/25254?v=4","gravatar_id":"","url":"https://api.github.com/users/tj","html_url":"https://github.com/tj","followers_url":"https://api.github.com/users/tj/followers","following_url":"https://api.github.com/users/tj/following{/other_user}","gists_url":"https://api.github.com/users/tj/gists{/gist_id}","starred_url":"https://api.github.com/users/tj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tj/subscriptions","organizations_url":"https://api.github.com/users/tj/orgs","repos_url":"https://api.github.com/users/tj/repos","events_url":"https://api.github.com/users/tj/events{/privacy}","received_events_url":"https://api.github.com/users/tj/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pugjs/pug/issues/227/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pugjs/pug/issues/227/timeline","performed_via_github_app":null,"state_reason":"completed"}