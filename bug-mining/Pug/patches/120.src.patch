diff --git a/lib/parser.js b/lib/parser.js
index 224787e..9d2f84c 100644
--- a/lib/parser.js
+++ b/lib/parser.js
@@ -129,7 +129,7 @@ Parser.prototype = {
       } else {
         var next = this.peek();
         var expr = this.parseExpr();
-        expr.filename = this.options.filename;
+        expr.filename = expr.filename || this.filename;
         expr.line = next.line;
         block.push(expr);
       }
diff --git a/test/error.reporting.js b/test/error.reporting.js
index 17b45b9..297cc19 100644
--- a/test/error.reporting.js
+++ b/test/error.reporting.js
@@ -43,17 +43,45 @@ describe('error reporting', function () {
         assert(/foo\(/.test(err.message))
       });
     });
-    describe('with a layout', function () {
+    describe('with a layout without block declaration (syntax)', function () {
       it('includes detail of where the error was thrown including the filename', function () {
-        var err = getFileError(__dirname + '/fixtures/compile.with.layout.error.jade', {})
-        assert(/layout.error.jade:2/.test(err.message))
+        var err = getFileError(__dirname + '/fixtures/compile.with.layout.syntax.error.jade', {})
+        assert(/[\\\/]layout.syntax.error.jade:2/.test(err.message))
         assert(/foo\(/.test(err.message))
       });
     });
-    describe('with a include', function () {
+    describe('with a layout without block declaration (locals)', function () {
       it('includes detail of where the error was thrown including the filename', function () {
-        var err = getFileError(__dirname + '/fixtures/compile.with.include.error.jade', {})
-        assert(/include.error.jade:2/.test(err.message))
+        var err = getFileError(__dirname + '/fixtures/compile.with.layout.locals.error.jade', {})
+        assert(/[\\\/]layout.locals.error.jade:2/.test(err.message))
+        assert(/undefined is not a function/.test(err.message))
+      });
+    });
+    describe('with a include (syntax)', function () {
+      it('includes detail of where the error was thrown including the filename', function () {
+        var err = getFileError(__dirname + '/fixtures/compile.with.include.syntax.error.jade', {})
+        assert(/[\\\/]include.syntax.error.jade:2/.test(err.message))
+        assert(/foo\(/.test(err.message))
+      });
+    });
+    describe('with a include (locals)', function () {
+      it('includes detail of where the error was thrown including the filename', function () {
+        var err = getFileError(__dirname + '/fixtures/compile.with.include.locals.error.jade', {})
+        assert(/[\\\/]include.locals.error.jade:2/.test(err.message))
+        assert(/foo\(/.test(err.message))
+      });
+    });
+    describe('with a layout (without block) with an include (syntax)', function () {
+      it('includes detail of where the error was thrown including the filename', function () {
+        var err = getFileError(__dirname + '/fixtures/compile.with.layout.with.include.syntax.error.jade', {})
+        assert(/[\\\/]include.syntax.error.jade:2/.test(err.message))
+        assert(/foo\(/.test(err.message))
+      });
+    });
+    describe('with a layout (without block) with an include (locals)', function () {
+      it('includes detail of where the error was thrown including the filename', function () {
+        var err = getFileError(__dirname + '/fixtures/compile.with.layout.with.include.locals.error.jade', {})
+        assert(/[\\\/]include.locals.error.jade:2/.test(err.message))
         assert(/foo\(/.test(err.message))
       });
     });
diff --git a/test/fixtures/compile.with.include.error.jade b/test/fixtures/compile.with.include.error.jade
deleted file mode 100644
index ac64a7c..0000000
--- a/test/fixtures/compile.with.include.error.jade
+++ /dev/null
@@ -1 +0,0 @@
-include include.error.jade
\ No newline at end of file
diff --git a/test/fixtures/compile.with.include.locals.error.jade b/test/fixtures/compile.with.include.locals.error.jade
new file mode 100644
index 0000000..fc333b0
--- /dev/null
+++ b/test/fixtures/compile.with.include.locals.error.jade
@@ -0,0 +1 @@
+include include.locals.error.jade
\ No newline at end of file
diff --git a/test/fixtures/compile.with.include.syntax.error.jade b/test/fixtures/compile.with.include.syntax.error.jade
new file mode 100644
index 0000000..9beb67d
--- /dev/null
+++ b/test/fixtures/compile.with.include.syntax.error.jade
@@ -0,0 +1 @@
+include include.syntax.error.jade
\ No newline at end of file
diff --git a/test/fixtures/compile.with.layout.error.jade b/test/fixtures/compile.with.layout.error.jade
deleted file mode 100644
index 67918d0..0000000
--- a/test/fixtures/compile.with.layout.error.jade
+++ /dev/null
@@ -1 +0,0 @@
-extends layout.error.jade
\ No newline at end of file
diff --git a/test/fixtures/compile.with.layout.locals.error.jade b/test/fixtures/compile.with.layout.locals.error.jade
new file mode 100644
index 0000000..8069c8e
--- /dev/null
+++ b/test/fixtures/compile.with.layout.locals.error.jade
@@ -0,0 +1 @@
+extends layout.locals.error.jade
\ No newline at end of file
diff --git a/test/fixtures/compile.with.layout.syntax.error.jade b/test/fixtures/compile.with.layout.syntax.error.jade
new file mode 100644
index 0000000..691bc3a
--- /dev/null
+++ b/test/fixtures/compile.with.layout.syntax.error.jade
@@ -0,0 +1 @@
+extends layout.syntax.error.jade
\ No newline at end of file
diff --git a/test/fixtures/compile.with.layout.with.include.locals.error.jade b/test/fixtures/compile.with.layout.with.include.locals.error.jade
new file mode 100644
index 0000000..1bea1fd
--- /dev/null
+++ b/test/fixtures/compile.with.layout.with.include.locals.error.jade
@@ -0,0 +1 @@
+extends compile.with.include.locals.error.jade
\ No newline at end of file
diff --git a/test/fixtures/compile.with.layout.with.include.syntax.error.jade b/test/fixtures/compile.with.layout.with.include.syntax.error.jade
new file mode 100644
index 0000000..6e93fe6
--- /dev/null
+++ b/test/fixtures/compile.with.layout.with.include.syntax.error.jade
@@ -0,0 +1 @@
+extends compile.with.include.syntax.error.jade
\ No newline at end of file
diff --git a/test/fixtures/include.locals.error.jade b/test/fixtures/include.locals.error.jade
new file mode 100644
index 0000000..bd604a9
--- /dev/null
+++ b/test/fixtures/include.locals.error.jade
@@ -0,0 +1,2 @@
+
+= foo()
\ No newline at end of file
diff --git a/test/fixtures/include.error.jade b/test/fixtures/include.syntax.error.jade
similarity index 100%
rename from test/fixtures/include.error.jade
rename to test/fixtures/include.syntax.error.jade
diff --git a/test/fixtures/layout.locals.error.jade b/test/fixtures/layout.locals.error.jade
new file mode 100644
index 0000000..bd604a9
--- /dev/null
+++ b/test/fixtures/layout.locals.error.jade
@@ -0,0 +1,2 @@
+
+= foo()
\ No newline at end of file
diff --git a/test/fixtures/layout.error.jade b/test/fixtures/layout.syntax.error.jade
similarity index 100%
rename from test/fixtures/layout.error.jade
rename to test/fixtures/layout.syntax.error.jade
