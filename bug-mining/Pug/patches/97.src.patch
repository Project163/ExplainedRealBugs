diff --git a/lib/parser.js b/lib/parser.js
index 44d8038..d0037b9 100644
--- a/lib/parser.js
+++ b/lib/parser.js
@@ -28,7 +28,7 @@ var Parser = exports = module.exports = function Parser(str, filename, options){
   this.input = str;
   this.lexer = new Lexer(str, options);
   this.filename = filename;
-  this.blocks = {};
+  this.blocks = [];
   this.mixins = {};
   this.options = options;
   this.contexts = [this];
@@ -138,10 +138,36 @@ Parser.prototype = {
       this.context(parser);
       var ast = parser.parse();
       this.context();
+
       // hoist mixins
       for (var name in this.mixins)
         ast.unshift(this.mixins[name]);
       return ast;
+    } else  {
+      // console.dir(this.blocks);
+      this.blocks.reverse();
+      var blocksHash = {};
+      for (var i in this.blocks) {
+        if (!( ({}).hasOwnProperty.call(blocksHash, [this.blocks[i].name]) )) {
+          // console.log('new ' + this.blocks[i].mode + ' ' + this.blocks[i].name + ' ' + this.blocks[i].line);
+          blocksHash[this.blocks[i].name] = this.blocks[i];
+        } else {
+          // console.log(this.blocks[i].mode + ' ' + this.blocks[i].name + ' ' + this.blocks[i].line);
+          switch (this.blocks[i].mode) {
+            case 'replace':
+              blocksHash[this.blocks[i].name].nodes = this.blocks[i].nodes;
+              break;
+            case 'append':
+              blocksHash[this.blocks[i].name].nodes = blocksHash[this.blocks[i].name].nodes.concat(this.blocks[i].nodes);
+              break;
+            case 'prepend':
+              blocksHash[this.blocks[i].name].nodes = this.blocks[i].nodes.concat(blocksHash[this.blocks[i].name].nodes);
+              break;
+          }
+          this.blocks[i] = blocksHash[this.blocks[i].name];
+        }
+      }
+      // console.dir(blocksHash.content.nodes);
     }
 
     return block;
@@ -399,7 +425,7 @@ Parser.prototype = {
     var str = fs.readFileSync(path, 'utf8');
     var parser = new Parser(str, path, this.options);
 
-    parser.blocks = this.blocks;
+    parser.blocks = this.blocks.reverse();
     parser.contexts = this.contexts;
     this.extending = parser;
 
@@ -420,23 +446,25 @@ Parser.prototype = {
       ? this.block()
       : new nodes.Block(new nodes.Literal(''));
 
-    var prev = this.blocks[name];
-
-    if (prev) {
-      switch (prev.mode) {
-        case 'append':
-          block.nodes = block.nodes.concat(prev.nodes);
-          prev = block;
-          break;
-        case 'prepend':
-          block.nodes = prev.nodes.concat(block.nodes);
-          prev = block;
-          break;
-      }
-    }
+    // var prev = this.blocks[name];
+
+    // if (prev) {
+    //   switch (prev.mode) {
+    //     case 'append':
+    //       block.nodes = block.nodes.concat(prev.nodes);
+    //       prev = block;
+    //       break;
+    //     case 'prepend':
+    //       block.nodes = prev.nodes.concat(block.nodes);
+    //       prev = block;
+    //       break;
+    //   }
+    // }
 
     block.mode = mode;
-    return this.blocks[name] = prev || block;
+    block.name = name;
+    this.blocks.push(block);
+    return this.blocks[name] = block;
   },
 
   /**
@@ -474,7 +502,9 @@ Parser.prototype = {
     var path = join(dir, path);
     var str = fs.readFileSync(path, 'utf8');
     var parser = new Parser(str, path, this.options);
-    parser.blocks = utils.merge({}, this.blocks);
+    // parser.blocks = utils.merge({}, this.blocks);
+    parser.blocks = utils.merge([], this.blocks);
+
     parser.mixins = this.mixins;
 
     this.context(parser);
diff --git a/test/cases/layout.multi.append.prepend.block.html b/test/cases/layout.multi.append.prepend.block.html
new file mode 100644
index 0000000..f96e65e
--- /dev/null
+++ b/test/cases/layout.multi.append.prepend.block.html
@@ -0,0 +1,5 @@
+<p>prepended content 2</p>
+<p>prepended content 1</p>
+<p>redefined content</p>
+<p>appended content 1</p>
+<p>appended content 2</p>
\ No newline at end of file
diff --git a/test/cases/layout.multi.append.prepend.block.jade b/test/cases/layout.multi.append.prepend.block.jade
new file mode 100644
index 0000000..ab920f8
--- /dev/null
+++ b/test/cases/layout.multi.append.prepend.block.jade
@@ -0,0 +1,13 @@
+extends ../fixtures/multi-append-prepend-block/redefine
+
+append content
+	p appended content 1
+
+prepend content
+	p prepended content 1
+
+append content
+	p appended content 2
+
+prepend content
+	p prepended content 2
\ No newline at end of file
diff --git a/test/fixtures/multi-append-prepend-block/redefine.jade b/test/fixtures/multi-append-prepend-block/redefine.jade
new file mode 100644
index 0000000..308ff47
--- /dev/null
+++ b/test/fixtures/multi-append-prepend-block/redefine.jade
@@ -0,0 +1,5 @@
+extends root
+
+
+block content
+	p redefined content
\ No newline at end of file
diff --git a/test/fixtures/multi-append-prepend-block/root.jade b/test/fixtures/multi-append-prepend-block/root.jade
new file mode 100644
index 0000000..0a8837f
--- /dev/null
+++ b/test/fixtures/multi-append-prepend-block/root.jade
@@ -0,0 +1,2 @@
+block content
+	p default content
\ No newline at end of file
