diff --git a/lib/compiler.js b/lib/compiler.js
index 03a39bb..579c85f 100644
--- a/lib/compiler.js
+++ b/lib/compiler.js
@@ -37,6 +37,7 @@ var Compiler = module.exports = function Compiler(node, options) {
   this.inMixin = false;
   this.indents = 0;
   this.parentIndents = 0;
+  this.terse = false;
   if (options.doctype) this.setDoctype(options.doctype);
 };
 
@@ -609,11 +610,27 @@ Compiler.prototype = {
     var val = this.attrs(attrs);
     if (val.inherits) {
       this.bufferExpression("jade.attrs(jade.merge({ " + val.buf +
-          " }, attributes), jade.merge(" + val.escaped + ", escaped, true))");
-    } else if (val.constant) {
-      this.buffer(runtime.attrs(toConstant('{' + val.buf + '}'), JSON.parse(val.escaped)));
+          " }, attributes), jade.merge(" + val.escaped + ", escaped, true), " + JSON.stringify(this.terse) + ")");
     } else {
-      this.bufferExpression("jade.attrs({ " + val.buf + " }, " + val.escaped + ")");
+      var classes = [];
+      var classEscaping = [];
+      attrs.forEach(function (attr) {
+        var key = attr.name;
+        var escaped = attr.escaped;
+        if (key === 'class') {
+          classes.push(attr.val);
+          classEscaping.push(attr.escaped);
+        } else if (isConstant(attr.val)) {
+          this.buffer(runtime.attr(key, toConstant(attr.val), escaped, this.terse));
+        } else {
+          this.bufferExpression('jade.attr("' + key + '", ' + attr.val + ', ' + JSON.stringify(escaped) + ', ' + JSON.stringify(this.terse) + ')');
+        }
+      }.bind(this));
+      if (classes.every(isConstant)) {
+        this.buffer(runtime.cls(classes.map(toConstant), classEscaping));
+      } else {
+        this.bufferExpression('jade.cls([' + classes.join(',') + '], ' + JSON.stringify(classEscaping) + ')');
+      }
     }
   },
 
@@ -627,10 +644,11 @@ Compiler.prototype = {
       , escaped = {}
       , constant = attrs.every(function(attr){ return isConstant(attr.val) })
       , inherits = false;
-
-    if (this.terse) buf.push('terse: true');
-
+    
+    var keys = [];
     attrs.forEach(function(attr){
+      if (keys.indexOf(attr.name) !== -1) throw new Error('Duplicate key "' + attr.name + '" is not allowed.');
+      if (attr.name !== 'class') keys.push(attr.name);
       if (attr.name == 'attributes') return inherits = true;
       escaped[attr.name] = attr.escaped;
       if (attr.name == 'class') {
diff --git a/lib/runtime.js b/lib/runtime.js
index 9a636f5..bcfa9e3 100644
--- a/lib/runtime.js
+++ b/lib/runtime.js
@@ -88,56 +88,87 @@ function joinClasses(val) {
   return Array.isArray(val) ? val.map(joinClasses).filter(nulls).join(' ') : val;
 }
 
+/**
+ * Render the given classes.
+ *
+ * @param {Array} classes
+ * @param {Array.<Boolean>} escaped
+ * @return {String}
+ */
+exports.cls = function cls(classes, escaped) {
+  var buf = [];
+  for (var i = 0; i < classes.length; i++) {
+    if (escaped && escaped[i]) {
+      buf.push(exports.escape(joinClasses([classes[i]])));
+    } else {
+      buf.push(joinClasses(classes[i]));
+    }
+  }
+  var text = joinClasses(buf);
+  if (text.length) {
+    return ' class="' + text + '"';
+  } else {
+    return '';
+  }
+};
+
+/**
+ * Render the given attribute.
+ *
+ * @param {String} key
+ * @param {String} val
+ * @param {Boolean} escaped
+ * @param {Boolean} terse
+ * @return {String}
+ */
+exports.attr = function attr(key, val, escaped, terse) {
+  if ('boolean' == typeof val || null == val) {
+    if (val) {
+      return ' ' + (terse ? key : key + '="' + key + '"');
+    } else {
+      return '';
+    }
+  } else if (0 == key.indexOf('data') && 'string' != typeof val) {
+    return ' ' + key + "='" + JSON.stringify(val).replace(/'/g, '&apos;') + "'";
+  } else if (escaped) {
+    return ' ' + key + '="' + exports.escape(val) + '"';
+  } else {
+    return ' ' + key + '="' + val + '"';
+  }
+};
+
 /**
  * Render the given attributes object.
  *
  * @param {Object} obj
  * @param {Object} escaped
  * @return {String}
- * @api private
  */
+exports.attrs = function attrs(obj, escaped, terse){
+  var buf = [];
 
-exports.attrs = function attrs(obj, escaped){
-  var buf = []
-    , terse = obj.terse;
-
-  delete obj.terse;
-  var keys = Object.keys(obj)
-    , len = keys.length;
+  var keys = Object.keys(obj);
 
-  if (len) {
-    buf.push('');
-    for (var i = 0; i < len; ++i) {
+  if (keys.length) {
+    for (var i = 0; i < keys.length; ++i) {
       var key = keys[i]
         , val = obj[key];
 
-      if ('boolean' == typeof val || null == val) {
-        if (val) {
-          terse
-            ? buf.push(key)
-            : buf.push(key + '="' + key + '"');
-        }
-      } else if (0 == key.indexOf('data') && 'string' != typeof val) {
-        buf.push(key + "='" + JSON.stringify(val).replace(/'/g, '&apos;') + "'");
-      } else if ('class' == key) {
-        if (escaped && escaped[key]){
-          if (val = exports.escape(joinClasses(val))) {
-            buf.push(key + '="' + val + '"');
-          }
-        } else {
-          if (val = joinClasses(val)) {
-            buf.push(key + '="' + val + '"');
+      if ('class' == key) {
+        if (val = joinClasses(val)) {
+          if (escaped && escaped[key]){
+            buf.push(' ' + key + '="' + exports.escape(val) + '"');
+          } else {
+            buf.push(' ' + key + '="' + val + '"');
           }
         }
-      } else if (escaped && escaped[key]) {
-        buf.push(key + '="' + exports.escape(val) + '"');
       } else {
-        buf.push(key + '="' + val + '"');
+        buf.push(exports.attr(key, val, escaped && escaped[key], terse));
       }
     }
   }
 
-  return buf.join(' ');
+  return buf.join('');
 };
 
 /**
diff --git a/test/anti-cases/attrs.unescaped.jade b/test/anti-cases/attrs.unescaped.jade
new file mode 100644
index 0000000..ab47e09
--- /dev/null
+++ b/test/anti-cases/attrs.unescaped.jade
@@ -0,0 +1,3 @@
+script(type='text/x-template')
+  #user(id!='user-<%= user.id %>')
+    h1 <%= user.title %>
\ No newline at end of file
diff --git a/test/cases/attrs.unescaped.jade b/test/cases/attrs.unescaped.jade
index ab47e09..36a4e10 100644
--- a/test/cases/attrs.unescaped.jade
+++ b/test/cases/attrs.unescaped.jade
@@ -1,3 +1,3 @@
 script(type='text/x-template')
-  #user(id!='user-<%= user.id %>')
+  div(id!='user-<%= user.id %>')
     h1 <%= user.title %>
\ No newline at end of file
