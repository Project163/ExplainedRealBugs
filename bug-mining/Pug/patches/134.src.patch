diff --git a/lib/utils.js b/lib/utils.js
index 2640058..813a55a 100644
--- a/lib/utils.js
+++ b/lib/utils.js
@@ -27,11 +27,11 @@ exports.walkAST = function walkAST(ast, before, after) {
     case 'Mixin':
     case 'Tag':
     case 'When':
+    case 'Code':
       ast.block && walkAST(ast.block, before, after);
       break;
     case 'Attrs':
     case 'BlockComment':
-    case 'Code':
     case 'Comment':
     case 'Doctype':
     case 'Filter':
@@ -44,4 +44,4 @@ exports.walkAST = function walkAST(ast, before, after) {
       break;
   }
   after && after(ast);
-};
\ No newline at end of file
+};
diff --git a/test/cases/blocks-in-if.html b/test/cases/blocks-in-if.html
new file mode 100644
index 0000000..c3b9107
--- /dev/null
+++ b/test/cases/blocks-in-if.html
@@ -0,0 +1 @@
+<p>ajax contents</p>
diff --git a/test/cases/blocks-in-if.jade b/test/cases/blocks-in-if.jade
new file mode 100644
index 0000000..80bc4b6
--- /dev/null
+++ b/test/cases/blocks-in-if.jade
@@ -0,0 +1,19 @@
+//- see https://github.com/visionmedia/jade/issues/1589
+
+-var ajax = true
+
+-if( ajax )
+    //- return only contents if ajax requests
+    block contents
+        p ajax contents
+
+-else
+    //- return all html
+    doctype html
+    html
+        head
+            meta( charset='utf8' )
+            title sample
+            body
+                block contents
+                    p all contetns
