diff --git a/examples/whitespace.jade b/examples/whitespace.jade
index 9361656..df1060f 100644
--- a/examples/whitespace.jade
+++ b/examples/whitespace.jade
@@ -6,6 +6,7 @@ ul
   li two
          
   li three
+
         
       
   li four
diff --git a/lib/jade.js b/lib/jade.js
index 3e60ced..1bb5c25 100644
--- a/lib/jade.js
+++ b/lib/jade.js
@@ -713,7 +713,7 @@ function interpolate(str){
  */
 
 exports.render = function(str, options){
-    var js,
+    var fn,
         options = options || {},
         filename = options.filename;
 
@@ -727,7 +727,13 @@ exports.render = function(str, options){
             }
             var js = parser.parse();
             if (options.debug) sys.puts('\nfunction:', js.replace(/^/gm, '  '));
-            return js;
+            try {
+                return new Function('locals, attrs, escape, _', 'with (locals) {' + js + '}');
+            } catch (err) {
+                // TODO: re-catch and apply real lineno
+                process.compile(js, filename || 'Jade');
+                return;
+            }
         } catch (err) {
             rethrow(err, parser.lineno);
         }
@@ -754,26 +760,17 @@ exports.render = function(str, options){
     if (options.cache) {
         if (filename) {
             if (cache[filename]) {
-                js = cache[filename];
+                fn = cache[filename];
             } else {
-                js = cache[filename] = parse();
+                fn = cache[filename] = parse();
             }
         } else {
             throw new Error('filename is required when using the cache option');
         }
     } else {
-        js = parse();
+        fn = parse();
     }
 
-    // Generate function
-    try {
-        var fn = Function('locals, attrs, escape, _', 'with (locals) {' + js + '}');
-    } catch (err) {
-        // TODO: re-catch and apply real lineno
-        process.compile(js, filename || 'Jade');
-        return;
-    }
-    
     try {
         options.locals = options.locals || {};
         options.locals.sys = sys;
diff --git a/test/jade.test.js b/test/jade.test.js
index 797c834..0d4a56b 100644
--- a/test/jade.test.js
+++ b/test/jade.test.js
@@ -216,7 +216,7 @@ module.exports = {
         
         assert.equal('<p></p>', render('p', { cache: true, filename: 'foo.jade' }));
         assert.equal('<p></p>', render('p', { cache: true, filename: 'foo.jade' }));
-        assert.ok(typeof jade.cache['foo.jade'] === 'string', 'Test cache');
+        assert.ok(typeof jade.cache['foo.jade'] === 'function', 'Test cache');
     },
     
     'test tag text': function(assert){
