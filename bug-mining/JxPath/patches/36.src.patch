diff --git a/src/java/org/apache/commons/jxpath/ri/model/dom/DOMAttributeIterator.java b/src/java/org/apache/commons/jxpath/ri/model/dom/DOMAttributeIterator.java
index f6ffe426..a979a10a 100644
--- a/src/java/org/apache/commons/jxpath/ri/model/dom/DOMAttributeIterator.java
+++ b/src/java/org/apache/commons/jxpath/ri/model/dom/DOMAttributeIterator.java
@@ -57,7 +57,7 @@ public class DOMAttributeIterator implements NodeIterator {
                 int count = map.getLength();
                 for (int i = 0; i < count; i++) {
                     Attr attr = (Attr) map.item(i);
-                    if (testAttr(attr, name)) {
+                    if (testAttr(attr)) {
                         attributes.add(attr);
                     }
                 }
@@ -65,7 +65,7 @@ public class DOMAttributeIterator implements NodeIterator {
         }
     }
 
-    private boolean testAttr(Attr attr, QName testName) {
+    private boolean testAttr(Attr attr) {
         String nodePrefix = DOMNodePointer.getPrefix(attr);
         String nodeLocalName = DOMNodePointer.getLocalName(attr);
 
@@ -79,22 +79,16 @@ public class DOMAttributeIterator implements NodeIterator {
 
         String testLocalName = name.getName();
         if (testLocalName.equals("*") || testLocalName.equals(nodeLocalName)) {
-            String testPrefix = testName.getPrefix();
+            String testPrefix = name.getPrefix();
 
-            if (equalStrings(testPrefix, nodePrefix)) {
+            if (testPrefix == null || equalStrings(testPrefix, nodePrefix)) {
                 return true;
             }
-
-            String testNS = null;
-            if (testPrefix != null) {
-                testNS = parent.getNamespaceURI(testPrefix);
-            }
-
-            String nodeNS = null;
-            if (nodePrefix != null) {
-                nodeNS = parent.getNamespaceURI(nodePrefix);
+            if (nodePrefix == null) {
+                return false;
             }
-            return equalStrings(testNS, nodeNS);
+            return equalStrings(parent.getNamespaceURI(testPrefix), parent
+                    .getNamespaceURI(nodePrefix));
         }
         return false;
     }
@@ -123,7 +117,7 @@ public class DOMAttributeIterator implements NodeIterator {
             NamedNodeMap nnm = element.getAttributes();
             for (int i = 0; i < nnm.getLength(); i++) {
                 attr = (Attr) nnm.item(i);
-                if (testAttr(attr, name)) {
+                if (testAttr(attr)) {
                     return attr;
                 }
             }
diff --git a/src/java/org/apache/commons/jxpath/ri/model/jdom/JDOMAttributeIterator.java b/src/java/org/apache/commons/jxpath/ri/model/jdom/JDOMAttributeIterator.java
index e52ee1ef..d7b7a302 100644
--- a/src/java/org/apache/commons/jxpath/ri/model/jdom/JDOMAttributeIterator.java
+++ b/src/java/org/apache/commons/jxpath/ri/model/jdom/JDOMAttributeIterator.java
@@ -67,11 +67,9 @@ public class JDOMAttributeIterator implements NodeIterator {
             String lname = name.getName();
             if (!lname.equals("*")) {
                 attributes = new ArrayList();
-                if (ns != null) {
-                    Attribute attr = element.getAttribute(lname, ns);
-                    if (attr != null) {
-                        attributes.add(attr);
-                    }
+                Attribute attr = element.getAttribute(lname, ns);
+                if (attr != null) {
+                    attributes.add(attr);
                 }
             }
             else {
@@ -79,7 +77,8 @@ public class JDOMAttributeIterator implements NodeIterator {
                 List allAttributes = element.getAttributes();
                 for (int i = 0; i < allAttributes.size(); i++) {
                     Attribute attr = (Attribute) allAttributes.get(i);
-                    if (attr.getNamespace().equals(ns)) {
+                    if (ns == Namespace.NO_NAMESPACE
+                            || attr.getNamespace().equals(ns)) {
                         attributes.add(attr);
                     }
                 }
diff --git a/src/test/org/apache/commons/jxpath/JXPathTestCase.java b/src/test/org/apache/commons/jxpath/JXPathTestCase.java
index 48d63c9e..0b048cab 100644
--- a/src/test/org/apache/commons/jxpath/JXPathTestCase.java
+++ b/src/test/org/apache/commons/jxpath/JXPathTestCase.java
@@ -250,6 +250,13 @@ public abstract class JXPathTestCase extends TestCase {
         return list;
     }
 
+    protected static Set set(Object o1, Object o2) {
+        Set list = new HashSet();
+        list.add(o1);
+        list.add(o2);
+        return list;
+    }
+
     protected static Set set(Object o1, Object o2, Object o3) {
         Set list = new HashSet();
         list.add(o1);
diff --git a/src/test/org/apache/commons/jxpath/ri/model/XMLModelTestCase.java b/src/test/org/apache/commons/jxpath/ri/model/XMLModelTestCase.java
index c1b292c6..05200272 100644
--- a/src/test/org/apache/commons/jxpath/ri/model/XMLModelTestCase.java
+++ b/src/test/org/apache/commons/jxpath/ri/model/XMLModelTestCase.java
@@ -552,9 +552,16 @@ public abstract class XMLModelTestCase extends JXPathTestCase {
             set("100", "", "local"));
 
         // attribute:: with default namespace and wildcard
+        assertXPathValueIterator(
+                context,
+                "vendor/product/price:amount/@*",
+                //use a set because DOM returns attrs sorted by name, JDOM by occurrence order:
+                set("10%", "20%"));
+
+        // attribute:: select non-ns'd attributes only
         assertXPathValueIterator(
             context,
-            "vendor/product/price:amount/@*",
+            "vendor/product/price:amount/@*[namespace-uri() = '']",
             list("20%"));
 
         // Empty attribute
