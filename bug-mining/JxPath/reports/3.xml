<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:12:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JXPATH-50] does not properly handle NodeSet returned by extension function</title>
                <link>https://issues.apache.org/jira/browse/JXPATH-50</link>
                <project id="12310480" key="JXPATH">Commons JXPath</project>
                    <description>&lt;p&gt;Per the documentation, my function is returning a BasicNodeSet containing zero&lt;br/&gt;
or more pointers:&lt;/p&gt;

&lt;p&gt;  public static NodeSet observations(ExpressionContext context) {&lt;br/&gt;
    // the cast below shouldn&apos;t break, as this is the only pointer type that&lt;br/&gt;
    // makes sense in this context&lt;br/&gt;
    List&amp;lt;NodePointer&amp;gt; ptrs = extractObservations(&lt;br/&gt;
                                  (NodePointer)context.getContextNodePointer(), &lt;br/&gt;
                                  new ArrayList&amp;lt;NodePointer&amp;gt;());&lt;br/&gt;
    BasicNodeSet result = new BasicNodeSet();&lt;br/&gt;
    for (NodePointer ptr : ptrs) &lt;/p&gt;
{
      result.add(ptr);
    }
&lt;p&gt;    return result;&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;However, if I call JXPathContext.selectNodes(&quot;ems:observations()&quot;), I&apos;m getting&lt;br/&gt;
a single node containing the BasicNodeSet. I notice that there is a testcase for&lt;br/&gt;
functions that return NodeSets, but that it uses expressions that actually&lt;br/&gt;
return the children of the NodeSet (&quot;test:nodeSet()/name&quot;).&lt;/p&gt;

&lt;p&gt;There appear to be two problems. First, Expression.iterate() and&lt;br/&gt;
Expression.iteratePointers() do not correctly recognize a NodeSet as something&lt;br/&gt;
iterable. I&apos;ve resolved this by reaching into the NodeSet and getting an&lt;br/&gt;
iterator over its pointers.&lt;/p&gt;

&lt;p&gt;Second, Expression.PointerIterator doesn&apos;t recognize when it already has a&lt;br/&gt;
pointer, and instead tries to wrap it in a new pointer. This ends up treating&lt;br/&gt;
the pointer as a bean.&lt;/p&gt;

&lt;p&gt;I&apos;ve made these changes, and written a testcase that uses an unadorned NodeSet&lt;br/&gt;
function. I also found a class that used a variable named &quot;enum&quot;, and changed&lt;br/&gt;
this so that it would compile under 1.5.&lt;/p&gt;

&lt;p&gt;The patch is attached. It&apos;s relative to &quot;commons-jxpath-1.2&quot; (root of extract&lt;br/&gt;
directory).&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: other&lt;br/&gt;
Platform: All&lt;/p&gt;</environment>
        <key id="12342946">JXPATH-50</key>
            <summary>does not properly handle NodeSet returned by extension function</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kgregory@healthmarketscience.com">Keith D Gregory</reporter>
                        <labels>
                    </labels>
                <created>Sat, 4 Mar 2006 01:52:05 +0000</created>
                <updated>Mon, 10 Mar 2008 21:24:29 +0000</updated>
                            <resolved>Wed, 10 Jan 2007 22:43:27 +0000</resolved>
                                    <version>1.2 Final</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12411529" author="kgregory@healthmarketscience.com" created="Sat, 4 Mar 2006 01:53:13 +0000"  >&lt;p&gt;Created an attachment (id=17828)&lt;br/&gt;
Appears to fix the problem; unit tests remain green&lt;/p&gt;</comment>
                            <comment id="12462512" author="mbenson" created="Fri, 5 Jan 2007 15:51:55 +0000"  >&lt;p&gt;RE the use of &quot;enum&quot; as a variable name, Martin van den Bemt fixed this in SVN revision 374128.&lt;/p&gt;</comment>
                            <comment id="12462525" author="mbenson" created="Fri, 5 Jan 2007 16:39:50 +0000"  >&lt;p&gt;my kingdom for a unified diff... nevertheless, I will persevere.  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12462532" author="kgregory@healthmarketscience.com" created="Fri, 5 Jan 2007 16:56:32 +0000"  >&lt;p&gt;Sorry &apos;bout that &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I think there were only 1 or 2 files that got changed, particularly if you delete the &quot;enum&quot; patch.&lt;/p&gt;

&lt;p&gt;Glad to see that JxPath development seems to be moving again.&lt;/p&gt;</comment>
                            <comment id="12462535" author="mbenson" created="Fri, 5 Jan 2007 16:59:47 +0000"  >&lt;p&gt;Keith, since you&apos;re watching... right, only 2 files.  Apparently there was no licensing at the time you submitted your original patch.  When I just submitted my rework, I mistakenly selected the grant option, but since the work is actually yours for the most part that was wrong.  Probably if you clarify your intent that the original patch be incorporated (sounds silly, huh?) it would be for the best here.&lt;/p&gt;

&lt;p&gt;-Matt&lt;/p&gt;</comment>
                            <comment id="12462541" author="kgregory@healthmarketscience.com" created="Fri, 5 Jan 2007 17:16:47 +0000"  >&lt;p&gt;No problem. I hereby grant the Apache Software Foundation rights to this patch as described by &quot;Individual Contributor License Agreement V2.0&quot; ( &lt;a href=&quot;http://www.apache.org/licenses/icla.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/icla.txt&lt;/a&gt; ), submitted separately.&lt;/p&gt;</comment>
                            <comment id="12463739" author="mbenson" created="Wed, 10 Jan 2007 22:43:27 +0000"  >&lt;p&gt;applied to SVN HEAD.  Thanks, Keith!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12334048" name="ASF.LICENSE.NOT.GRANTED--jxpath-nodeset-functions.patch" size="5206" author="kgregory@healthmarketscience.com" created="Sat, 4 Mar 2006 01:53:13 +0000"/>
                            <attachment id="12348375" name="jxpath-50.patch.txt" size="3352" author="mbenson" created="Fri, 5 Jan 2007 16:57:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38841</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34020</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 46 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0xpdj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>194748</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>