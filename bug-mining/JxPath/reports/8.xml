<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:12:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JXPATH-10] JXPath 1.1 code using custom functions failing when run in 1.2 onwards</title>
                <link>https://issues.apache.org/jira/browse/JXPATH-10</link>
                <project id="12310480" key="JXPATH">Commons JXPath</project>
                    <description>&lt;p&gt;We have recently attempted to upgrade from a 1.1 release of jxpath&lt;br/&gt;
to 1.2 and found a great deal of our jxpath code fails to run correctly. &lt;/p&gt;

&lt;p&gt;We isolated the problem to relating to the use of Custom Extension&lt;br/&gt;
Functions and have included sample junit test case snippets that should &lt;br/&gt;
demonstrate the issue clearly. &lt;/p&gt;

&lt;p&gt;The background on what we are trying to do with jxpath is as follows&lt;br/&gt;
(included so its clear on what we are trying to use jxpath to achieve):&lt;/p&gt;

&lt;p&gt;Within our project, we make extensive use of Custom Extension Functions in JXPath.  &lt;/p&gt;

&lt;p&gt;We also use JXPath variables significantly, in combination with these functions, &lt;br/&gt;
that often take a JXPath variable as an argument(s) to the function.&lt;/p&gt;

&lt;p&gt;We now rely heavily on the use of the ExpressionContext interface as the first &lt;br/&gt;
argument to many of our functions.  The reason for this is that we need a&lt;br/&gt;
convienient way to obtain access to &apos;original&apos; object references within the&lt;br/&gt;
context invoked by the function (as you would expect).&lt;/p&gt;

&lt;p&gt;However, we have also begun using a very useful combination of features, which&lt;br/&gt;
the API supports in version 1.1, where the first argument always defines the&lt;br/&gt;
ExpressionContext interface (which isn&apos;t really part of the method signature -&lt;br/&gt;
from a caller perspective), and a 2nd argument as &apos;Object&apos; type. Within body of&lt;br/&gt;
the function, we then cast the object of the 2nd argument as a NodeSet (or&lt;br/&gt;
define the NodeSet type within the method signature - either appears to work),&lt;br/&gt;
which provides us with access to the pointers for the object. &lt;/p&gt;

&lt;p&gt;As previously mentioned, a jxpath variable is passed from the caller of the&lt;br/&gt;
function (received via the 2nd argument in the method signature), which is&lt;br/&gt;
automatically resolved, by jxpath, to the object itself.&lt;/p&gt;

&lt;p&gt;The benefit of casting the object to NodeSet (interface) enables us to retrieve&lt;br/&gt;
the first pointer in the NodeSet list. The first pointer concerns us, as it&lt;br/&gt;
refers to the String value passed to the argument of the function which we need&lt;br/&gt;
access to.  The object reference itself is of little concern in this case, as&lt;br/&gt;
once we have access to the variable name sent to the function, we can access the&lt;br/&gt;
object via the ExpressionContext.&lt;/p&gt;

&lt;p&gt;This all works fine in jxpath 1.1, however, in version 1.2 this functionality is&lt;br/&gt;
now broken, since our objects are no longer being cast to NodeSet (previously&lt;br/&gt;
achieved via the internal implementation of jxpath NodeSet using a SimpleNodeSet&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;as per inspecting jxpath 1.1 source code).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Note on the use of ExpressionContext: For those methods that declare the&lt;br/&gt;
ExpressionContext interface (which must be the first argument, if used), as part&lt;br/&gt;
of the argument list, the method signature from the caller perspective, excludes&lt;br/&gt;
it from the argument list, as it is implied by jxpath.  In other words, there&lt;br/&gt;
will be one less argument from the caller when the interface is used.  In the&lt;br/&gt;
case where this interface was the only argument, which is common, then the&lt;br/&gt;
caller would be invoking a zero-argument method.  This is behaviour we expect.&lt;/p&gt;


&lt;p&gt;Here is a simplified example of one of our functions using the techniques&lt;br/&gt;
discussed:-&lt;/p&gt;

&lt;p&gt;public static void deleteSomeObject(ExpressionContext expContext, Object obj) {&lt;/p&gt;

&lt;p&gt; // create a local jxpath context to retrieve values for jxpath variables&lt;br/&gt;
 JXPathContext localContext = expContext.getJXPathContext();&lt;/p&gt;

&lt;p&gt; // Nodeset of the object passed to method&lt;br/&gt;
 NodeSet nodeset = (NodeSet)obj;&lt;br/&gt;
 // Retrieve variable name passed to function&lt;br/&gt;
 String declaredVariable = nodeset.getPointers().get(0).toString();&lt;br/&gt;
 Object objectToDelete = null;&lt;br/&gt;
// If this method was passed the $obj1 var to delete, then retrieve &apos;Object Type&lt;br/&gt;
1&apos; via $obj1 variable &lt;br/&gt;
   if (declaredVariable.equals(&quot;$obj1&quot;)) &lt;/p&gt;
{			
	objectToDelete = (ObjectType1)localContext.getValue(&quot;$obj1&quot;);
	}

&lt;p&gt;	// If this method was passed the $obj2 var to delete, then retrieve &apos;Object&lt;br/&gt;
Type 2&apos; via $obj2 variable &lt;br/&gt;
	if (declaredVariable.equals(&quot;$obj2&quot;)) &lt;/p&gt;
{			
		objectToDelete = (ObjectType2)localContext.getValue(&quot;$obj2&quot;);
		}

&lt;p&gt;	collectionOfSomeObjects.delete(objectToDelete);&lt;br/&gt;
 }&lt;/p&gt;

&lt;p&gt;Which would be used (called) in the following way:-&lt;br/&gt;
...&lt;br/&gt;
// add to collection&lt;br/&gt;
ObjectType1 objectType1 = new ObjectType1();&lt;br/&gt;
ObjectType2 objectType2 = new ObjectType2();&lt;br/&gt;
CollectionOfSomeObjects.add(objectType1);&lt;br/&gt;
CollectionOfSomeObjects.add(objectType2);&lt;br/&gt;
// add collection to jxpath context&lt;br/&gt;
JXPathContext context = JXPathContext.newContext(collectionOfSomeObjects);&lt;br/&gt;
// define jxpath variables&lt;br/&gt;
context.getVariables().declareVariable(&quot;obj1&quot;, objectType1);&lt;br/&gt;
context.getVariables().declareVariable(&quot;obj2&quot;, objectType2);&lt;/p&gt;

&lt;p&gt;// call jxpath Custom Extension Function&lt;/p&gt;

&lt;p&gt;String method2Invoke;&lt;br/&gt;
method2Invoke = &quot;ftn:deleteSomeObject($obj1)&quot;&lt;br/&gt;
context.getValue(method2Invoke);  // &#223; invoke function &amp;amp; return value (for&lt;br/&gt;
non-void methods)&lt;br/&gt;
method2Invoke = &quot;ftn:deleteSomeObject($obj2)&quot;&lt;br/&gt;
context.getValue(method2Invoke);  // &#223; invoke function &amp;amp; return value (for&lt;br/&gt;
non-void methods)&lt;/p&gt;


&lt;p&gt;In addition to the above example, I have prepared a suite of JUnit tests (&amp;amp;&lt;br/&gt;
functions) that work against JXPath version 1.1, &lt;br/&gt;
but fail against version 1.2.  These code snippets can simply be dropped into&lt;br/&gt;
the appropriate classes and executed.&lt;/p&gt;

&lt;p&gt;Also, I would like to note that the JXPath user guide is a little unclear with&lt;br/&gt;
respect to the use of NodeSet&apos;s.  &lt;br/&gt;
After looking at many of the existing JUnit tests for JXPath, many un-documented&lt;br/&gt;
features became evident &amp;amp; existing features became a little obscure, such as&lt;br/&gt;
&apos;Collections as NodeSets&apos;.&lt;/p&gt;

&lt;p&gt;The code examples provided should give you our perspective on it&apos;s use.&lt;/p&gt;


&lt;p&gt;CODE SNIPPETS BELOW TO INSERT INTO EXISTING JXPATH TEST SUITE:&lt;br/&gt;
Below you will find two sections:-&lt;br/&gt;
(1) JUnit Tests to test Extension Functions&lt;br/&gt;
(2) Additional Extension Functions for these new tests &lt;/p&gt;


&lt;p&gt;---------------------------------------------------------------------------------------------------------&lt;br/&gt;
3 JUnit Tests to add to &apos;ExtensionFunctionTest.java&quot; (in package&lt;br/&gt;
org.apache.commons.jxpath.ri.compiler) :&lt;/p&gt;


&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;To test the use of NodeSet to retrieve String value passed to argument of&lt;br/&gt;
method&lt;br/&gt;
     */   &lt;br/&gt;
    public void testMyTestNodeSetOnly() 
{
    	
    	context.getVariables().declareVariable(&quot;obj1&quot;, new String(&quot;$12345.00&quot;));

    	assertXPathValue(
                context,
                &quot;test:myTestNodeSetOnly($obj1)&quot;,
                &quot;$obj1&quot;);
    	
    }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;To test the use of ContextExpression &amp;amp; NodeSet Combined&lt;br/&gt;
     */   &lt;br/&gt;
    public void testMyTestContextExpressionAndNodeSetCombined() 
{
    	HashMap map = new HashMap();
    	map.put(&quot;1&quot;,new String(&quot;Item 1&quot;));
    	map.put(&quot;2&quot;,new String(&quot;Item 2&quot;));
    	map.put(&quot;3&quot;,new String(&quot;Item 3&quot;));
    	
    	context.getVariables().declareVariable(&quot;obj2&quot;, map);

    	assertXPathValue(
                context,
                &quot;test:myTestContextExpressionAndNodeSetCombined($obj2)&quot;,
                &quot;$obj2&quot;);
    	
    }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;To test the use of ContextExpression &amp;amp; NodeSet Combined with additional&lt;br/&gt;
arguments&lt;br/&gt;
     */   &lt;br/&gt;
    public void testMyTestContextExpressionAndNodeSetCombinedExtraArgs() 
{
    	HashMap map = new HashMap();
    	map.put(&quot;1&quot;,new String(&quot;Item 1&quot;));
    	map.put(&quot;2&quot;,new String(&quot;Item 2&quot;));
    	map.put(&quot;3&quot;,new String(&quot;Item 3&quot;));
    	HashMap map2 = new HashMap();
    	map2.put(&quot;another collection&quot;,map);
    	map2.put(&quot;a bean&quot;,new TestBean());
    	TestBean testBean = new TestBean();
    	Map beanMap = testBean.getMap();

    	context.getVariables().declareVariable(&quot;obj1&quot;, beanMap);
    	context.getVariables().declareVariable(&quot;obj2&quot;, map2);
    	context.getVariables().declareVariable(&quot;obj3&quot;, testBean);
    	context.getVariables().declareVariable(&quot;obj4&quot;, new Integer(10));

    	assertXPathValue(
                context,
                &quot;test:myTestContextExpressionAndNodeSetCombinedExtraArgs($obj1,
$obj2, $obj3, $obj4)&quot;,
                &quot;$obj1&quot;);
    	
    }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;---------------------------------------------------------------------------------------------------------&lt;br/&gt;
3 Additional Functions to add to &apos;TestFunctions.java&apos; (in package&lt;br/&gt;
org.apache.commons.jxpath.ri.compiler) :&lt;/p&gt;


&lt;p&gt;    public static String myTestNodeSetOnly(NodeSet obj) {&lt;/p&gt;

&lt;p&gt;    	// Nodeset of the object passed to method&lt;br/&gt;
		NodeSet nodeset = (NodeSet)obj;&lt;/p&gt;

&lt;p&gt;		// Retrieve variable name passed to function&lt;br/&gt;
		String declaredVariable = &quot;&quot;;&lt;br/&gt;
		declaredVariable = nodeset.getPointers().get(0).toString();    	&lt;/p&gt;

&lt;p&gt;//		for (int i=0; i &amp;lt; nodeset.getPointers().size();i++ ) &lt;/p&gt;
{
//			declaredVariable = nodeset.getPointers().get(i).toString(); 	
//	        System.out.println(&quot;  declaredVariable Name = &quot;+declaredVariable+&quot;  
value =&quot;+nodeset.getNodes().get(i));   	
//
//		}

&lt;p&gt;//        System.out.println(&quot;  declaredVariable Name = &quot;+declaredVariable);    	&lt;/p&gt;

&lt;p&gt;    	return declaredVariable;&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;    public static String&lt;br/&gt;
myTestContextExpressionAndNodeSetCombined(ExpressionContext expContext, Object&lt;br/&gt;
obj) &lt;/p&gt;
{

    	// create a local jxpath context to retrieve values for jxpath variables
		JXPathContext localContext = expContext.getJXPathContext();

		// Nodeset of the object passed to method
		NodeSet nodeset = (NodeSet)obj;
		
		// Retrieve variable name passed to function
		String declaredVariable = nodeset.getPointers().get(0).toString();
		
//        System.out.println(&quot;  declaredVariable Name = &quot;+declaredVariable);
        HashMap object = (HashMap)localContext.getValue(declaredVariable);
//        System.out.println(&quot;  declaredVariable reference to object via context
= &quot;+object);
    	
    	
    	return declaredVariable;
    }

&lt;p&gt;    public static String&lt;br/&gt;
myTestContextExpressionAndNodeSetCombinedExtraArgs(ExpressionContext expContext,&lt;br/&gt;
Object obj1, Object obj2, Object obj3, Object obj4 ) &lt;/p&gt;
{

    	// create a local jxpath context to retrieve values for jxpath variables
		JXPathContext localContext = expContext.getJXPathContext();

		// Nodesets of the object(s) passed to method
		NodeSet nodeset1 = (NodeSet)obj1;
		NodeSet nodeset2 = (NodeSet)obj2;
		NodeSet nodeset3 = (NodeSet)obj3;
		NodeSet nodeset4 = (NodeSet)obj4;
		
		// Retrieve variable name passed to function
		String declaredVariable = nodeset1.getPointers().get(0).toString();
		
//        System.out.println(&quot;  declaredVariable 1 Name = &quot;+declaredVariable);
        HashMap object = (HashMap)localContext.getValue(declaredVariable);
//        System.out.println(&quot;  declaredVariable reference to object via context
= &quot;+object);
    	
    	return declaredVariable;
    }</description>
                <environment>&lt;p&gt;Operating System: other&lt;br/&gt;
Platform: PC&lt;/p&gt;</environment>
        <key id="12342746">JXPATH-10</key>
            <summary>JXPath 1.1 code using custom functions failing when run in 1.2 onwards</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="paul.parisi@iag.com.au">Paul Parisi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Nov 2005 11:29:25 +0000</created>
                <updated>Mon, 10 Mar 2008 21:20:35 +0000</updated>
                            <resolved>Wed, 10 Jan 2007 23:18:34 +0000</resolved>
                                    <version>1.2 Final</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12410951" author="joerg.heinicke@gmx.de" created="Mon, 28 Nov 2005 17:13:28 +0000"  >&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/JXPATH-32&quot; title=&quot;JXPath 1.1 code using custom functions failing when run in 1.2 onwards&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JXPATH-32&quot;&gt;&lt;del&gt;COM-2593&lt;/del&gt;&lt;/a&gt; has been marked as a duplicate of this bug. ***&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12462553" author="mbenson" created="Fri, 5 Jan 2007 18:28:00 +0000"  >&lt;p&gt;Okay... this bug is a little more than a year old, so I&apos;m not sure how the original reporter has fared since its origination, but anyway:&lt;/p&gt;

&lt;p&gt;As you may have realized, this regression is an artifact of the feature added with JXPath 1.2 whereby an Object argument signifies that Pointers and NodeSets should be decoded to the objects they represent.  I hope to have a fairly easy workaround completed soon.  More later...&lt;/p&gt;</comment>
                            <comment id="12463199" author="paul.parisi@iag.com.au" created="Tue, 9 Jan 2007 06:26:27 +0000"  ></comment>
                            <comment id="12463204" author="paul.parisi@iag.com.au" created="Tue, 9 Jan 2007 06:44:15 +0000"  >&lt;p&gt;Hello Matt,&lt;br/&gt;
  We originally logged this defected some time back.  I note you are interested in knowing our&lt;br/&gt;
progress from your comments. &lt;/p&gt;

&lt;p&gt;Since logging this defect we stopped using jxpath 1.2 and commented out all the unit tests we had&lt;br/&gt;
developed that depending on its functionality (we cannot run two versions of jxpath in our &lt;br/&gt;
build system) So essentially we have not been able to upgrade jxpath, however we still would like&lt;br/&gt;
to do this as we eventually.  If you are able to provide a workaround we would be keen to try it out.&lt;/p&gt;

&lt;p&gt;regards,&lt;br/&gt;
Paul Parisi&lt;/p&gt;</comment>
                            <comment id="12463754" author="mbenson" created="Wed, 10 Jan 2007 23:18:34 +0000"  >&lt;p&gt;Hi Paul, I have committed to SVN HEAD a TypeConverter implementation that bypasses the Pointer conversions introduced in version 1.2 .  In order to use it, you must first execute the following:&lt;/p&gt;

&lt;p&gt;TypeUtils.setTypeConverter(new JXPath11CompatibleTypeConverter());&lt;/p&gt;

&lt;p&gt;And I think that&apos;s the best I&apos;ll be able to do for you.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37658</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>146369</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 46 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0xnu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>194499</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>