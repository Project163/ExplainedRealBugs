<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:12:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JXPATH-68] StackOverflow error on a call to &apos;JXPathContext.createPath()&apos;</title>
                <link>https://issues.apache.org/jira/browse/JXPATH-68</link>
                <project id="12310480" key="JXPATH">Commons JXPath</project>
                    <description>&lt;p&gt;I&apos;m running into a StackOverflow error on a call to&lt;br/&gt;
&apos;JXPathContext.createPath()&apos; whenever I have a path that looks like&lt;br/&gt;
&apos;a/b&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;/c&apos;.  I took a quick look at the code and it appears JXPath, when&lt;br/&gt;
trying to create its parent pointer, simply recreates an equivalent&lt;br/&gt;
pointer(???).&lt;/p&gt;

&lt;p&gt;Here is code to reproduce the problem.&lt;/p&gt;


&lt;p&gt;    Map map = new HashMap();&lt;br/&gt;
    map.put(&quot;a&quot;, null);&lt;/p&gt;

&lt;p&gt;    JXPathContext pathContext = JXPathContext.newContext(map);&lt;br/&gt;
    pathContext.setFactory(new AbstractFactory() {&lt;br/&gt;
      public boolean createObject(&lt;br/&gt;
          JXPathContext context, Pointer pointer, Object parent, String&lt;br/&gt;
name, int index) {&lt;/p&gt;

&lt;p&gt;        Map parentMap = (Map)parent;&lt;br/&gt;
        System.out.println(parent + &quot;:&quot; + name + &quot;:&quot; + index);&lt;br/&gt;
        if (index &amp;gt; -1) {&lt;br/&gt;
          List list = (List)parentMap.get(name);&lt;br/&gt;
          if (list == null) &lt;/p&gt;
{
            list = new ArrayList();
          }&lt;br/&gt;
          int size = list.size();&lt;br/&gt;
          for (int i = size; i &amp;lt;= index; i++) {
            list.add(i, null);
          }&lt;br/&gt;
          parentMap.put(name, list);&lt;br/&gt;
        } else {
          parentMap.put(name, new HashMap());
        }&lt;br/&gt;
        return true;&lt;br/&gt;
      }&lt;br/&gt;
      &lt;br/&gt;
    });&lt;br/&gt;
    pathContext.createPath(&quot;a/b&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;/c&quot;);&lt;br/&gt;
&lt;br/&gt;
***************&lt;br/&gt;
&lt;br/&gt;
I have continued looking into this, and found that the problem is that, if&lt;br/&gt;
the List is created with a &apos;null&apos; element, JXPath gets stuck in infinite&lt;br/&gt;
recursion.&lt;br/&gt;
&lt;br/&gt;
To discover this, I changed my Factory to implement the following method:&lt;br/&gt;
&lt;br/&gt;
      public boolean createObject(&lt;br/&gt;
          JXPathContext context, Pointer pointer, Object parent, &lt;br/&gt;
          String name, int index) {&lt;br/&gt;
&lt;br/&gt;
        if (pointer instanceof NodePointer) {
          index = ((NodePointer)pointer).getIndex();
        }&lt;br/&gt;
        System.out.println(parent + &quot;:&quot; + name + &quot;:&quot; + index);&lt;br/&gt;
        Map parentMap = (Map)parent;&lt;br/&gt;
        if (index &amp;gt; -1) {&lt;br/&gt;
          List list = (List)parentMap.get(name);&lt;br/&gt;
          if (list == null) {            list = new ArrayList();          }
&lt;p&gt;          int size = list.size();&lt;br/&gt;
          for (int i = size; i &amp;lt;= index; i++) &lt;/p&gt;
{
            list.add(i, new HashMap());  // !!!!!!  Don&apos;t set to &apos;null&apos;
          }
&lt;p&gt;          parentMap.put(name, list);&lt;br/&gt;
        } else &lt;/p&gt;
{
          parentMap.put(name, new HashMap());
        }
&lt;p&gt;        return true;&lt;br/&gt;
      }&lt;/p&gt;

&lt;p&gt;Then I ran the following code:&lt;/p&gt;

&lt;p&gt;    pathContext.createPath(&quot;a/b&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;/c&quot;);&lt;br/&gt;
    pathContext.createPath(&quot;a/b&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;/c&quot;);  // STACK OVERFLOW HERE&lt;/p&gt;

&lt;p&gt;Here is the stack trace at the beginning, where&lt;br/&gt;
&apos;ValueUtils.expandCollection()&apos; is called.  It puts &apos;null&apos; into the list,&lt;br/&gt;
thus causing the stack overflow as we cycle between createPath() &amp;amp;&lt;br/&gt;
createChild().&lt;/p&gt;

&lt;p&gt;Thread &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; (Suspended (breakpoint at line 227 in DynamicPropertyPointer))&lt;br/&gt;
	DynamicPropertyPointer.createPath(JXPathContext) line: 227&lt;br/&gt;
	DynamicPropertyPointer(PropertyPointer).createChild(JXPathContext,&lt;br/&gt;
QName, int) line: 188&lt;br/&gt;
	NullElementPointer.createPath(JXPathContext) line: 82&lt;br/&gt;
	NullPointer.createPath(JXPathContext) line: 86&lt;br/&gt;
	NullPropertyPointer.createPath(JXPathContext) line: 103&lt;br/&gt;
	NullPointer.createPath(JXPathContext) line: 86&lt;br/&gt;
	NullPropertyPointer.createPath(JXPathContext) line: 103&lt;br/&gt;
	JXPathContextReferenceImpl.createPath(String, Expression) line: 447&lt;br/&gt;
	JXPathContextReferenceImpl.createPath(String) line: 427&lt;br/&gt;
	Test.test4() line: 75&lt;br/&gt;
	Test.main(String[]) line: 38&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows XP Professional, Sun JDK 1.4.2&lt;br/&gt;
Run with JXPath v1.2 and v20060530&lt;/p&gt;</environment>
        <key id="12344024">JXPATH-68</key>
            <summary>StackOverflow error on a call to &apos;JXPathContext.createPath()&apos;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jvc2010">Joseph Campolongo</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Jun 2006 01:49:54 +0000</created>
                <updated>Wed, 10 Jan 2007 23:00:14 +0000</updated>
                            <resolved>Wed, 10 Jan 2007 23:00:14 +0000</resolved>
                                    <version>1.2 Final</version>
                    <version>Nightly Builds</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12463749" author="mbenson" created="Wed, 10 Jan 2007 23:00:14 +0000"  >&lt;p&gt;The bottom line here is that your AbstractFactory implementation is faulty.  Per the contract of AbstractFactory.createObject(), when you return true from this method you are signifying that you have created a (non-null) value at the specified place in the object hierarchy.  The only thing that can be done is to install a check to detect the situation and throw a meaningful exception informing you of your error.  This change has been made in SVN HEAD for commons-jxpath 1.3 .&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Matt&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34005</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 46 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0xprr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>194812</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>