diff --git a/mqtt-cs/src/main/java/org/apache/rocketmq/mqtt/cs/session/infly/MqttMsgId.java b/mqtt-cs/src/main/java/org/apache/rocketmq/mqtt/cs/session/infly/MqttMsgId.java
index 72b0f57..03e2a35 100644
--- a/mqtt-cs/src/main/java/org/apache/rocketmq/mqtt/cs/session/infly/MqttMsgId.java
+++ b/mqtt-cs/src/main/java/org/apache/rocketmq/mqtt/cs/session/infly/MqttMsgId.java
@@ -60,7 +60,7 @@ public class MqttMsgId {
         synchronized (msgIdEntry) {
             int startingMessageId = msgIdEntry.nextMsgId;
             int loopCount = 0;
-            int maxLoopCount = 2;
+            int maxLoopCount = 1;
             do {
                 msgIdEntry.nextMsgId++;
                 if (msgIdEntry.nextMsgId > MAX_MSG_ID) {
@@ -69,7 +69,7 @@ public class MqttMsgId {
                 if (msgIdEntry.nextMsgId == startingMessageId) {
                     loopCount++;
                     if (loopCount >= maxLoopCount) {
-                        msgIdEntry.nextMsgId++;
+                        msgIdEntry.inUseMsgIds.clear();
                         break;
                     }
                 }
diff --git a/mqtt-cs/src/main/java/org/apache/rocketmq/mqtt/cs/session/infly/PushAction.java b/mqtt-cs/src/main/java/org/apache/rocketmq/mqtt/cs/session/infly/PushAction.java
index 4eb9349..f1308ff 100644
--- a/mqtt-cs/src/main/java/org/apache/rocketmq/mqtt/cs/session/infly/PushAction.java
+++ b/mqtt-cs/src/main/java/org/apache/rocketmq/mqtt/cs/session/infly/PushAction.java
@@ -136,6 +136,10 @@ public class PushAction {
     }
 
     public void rollNextByAck(Session session, int mqttId) {
+        if (session == null) {
+            return;
+        }
+        mqttMsgId.releaseId(mqttId, session.getClientId());
         InFlyCache.PendingDown pendingDown = inFlyCache.getPendingDownCache().get(session.getChannelId(), mqttId);
         if (pendingDown == null) {
             return;
@@ -144,7 +148,7 @@ public class PushAction {
     }
 
     public void rollNext(Session session, int mqttId) {
-        if (session == null || session.isDestroyed()) {
+        if (session == null) {
             return;
         }
         mqttMsgId.releaseId(mqttId, session.getClientId());
