diff --git a/flink-tests/src/test/java/org/apache/flink/test/checkpointing/UnalignedCheckpointITCase.java b/flink-tests/src/test/java/org/apache/flink/test/checkpointing/UnalignedCheckpointITCase.java
index b7be1e14c00..6445750c3f4 100644
--- a/flink-tests/src/test/java/org/apache/flink/test/checkpointing/UnalignedCheckpointITCase.java
+++ b/flink-tests/src/test/java/org/apache/flink/test/checkpointing/UnalignedCheckpointITCase.java
@@ -26,6 +26,7 @@ import org.apache.flink.api.common.state.ListStateDescriptor;
 import org.apache.flink.api.common.state.ValueState;
 import org.apache.flink.api.common.state.ValueStateDescriptor;
 import org.apache.flink.api.common.typeinfo.BasicTypeInfo;
+import org.apache.flink.api.java.typeutils.GenericTypeInfo;
 import org.apache.flink.configuration.Configuration;
 import org.apache.flink.runtime.state.FunctionInitializationContext;
 import org.apache.flink.runtime.state.FunctionSnapshotContext;
@@ -505,7 +506,9 @@ public class UnalignedCheckpointITCase extends UnalignedCheckpointTestBase {
         public void initializeState(FunctionInitializationContext context) throws Exception {
             stateList =
                     context.getOperatorStateStore()
-                            .getListState(new ListStateDescriptor<>("state", BitSet.class));
+                            .getListState(
+                                    new ListStateDescriptor<>(
+                                            "state", new GenericTypeInfo<>(BitSet.class)));
             this.seenRecords = getOnlyElement(stateList.get(), new BitSet());
         }
     }
diff --git a/flink-tests/src/test/java/org/apache/flink/test/checkpointing/UnalignedCheckpointTestBase.java b/flink-tests/src/test/java/org/apache/flink/test/checkpointing/UnalignedCheckpointTestBase.java
index 352a53060d2..9e8211070c5 100644
--- a/flink-tests/src/test/java/org/apache/flink/test/checkpointing/UnalignedCheckpointTestBase.java
+++ b/flink-tests/src/test/java/org/apache/flink/test/checkpointing/UnalignedCheckpointTestBase.java
@@ -73,7 +73,6 @@ import java.nio.file.Files;
 import java.nio.file.Path;
 import java.util.ArrayList;
 import java.util.Collections;
-import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
 import java.util.concurrent.CompletableFuture;
@@ -325,6 +324,10 @@ public abstract class UnalignedCheckpointTestBase extends TestLogger {
                 this.numCompletedCheckpoints = numCompletedCheckpoints;
             }
 
+            public int getBaseNumber() {
+                return (int) (nextNumber % increment);
+            }
+
             @Override
             public String splitId() {
                 return String.valueOf(increment);
@@ -379,13 +382,9 @@ public abstract class UnalignedCheckpointTestBase extends TestLogger {
             public void addReader(int subtaskId) {
                 if (context.registeredReaders().size() == context.currentParallelism()
                         && !state.unassignedSplits.isEmpty()) {
-                    int numReaders = context.registeredReaders().size();
-                    Map<Integer, List<LongSplit>> assignment = new HashMap<>();
-                    for (int i = 0; i < state.unassignedSplits.size(); i++) {
-                        assignment
-                                .computeIfAbsent(i % numReaders, t -> new ArrayList<>())
-                                .add(state.unassignedSplits.get(i));
-                    }
+                    Map<Integer, List<LongSplit>> assignment =
+                            state.unassignedSplits.stream()
+                                    .collect(Collectors.groupingBy(LongSplit::getBaseNumber));
                     LOG.info("Assigning splits {}", assignment);
                     context.assignSplits(new SplitsAssignment<>(assignment));
                     state.unassignedSplits.clear();
