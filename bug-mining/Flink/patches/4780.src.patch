diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/DispatcherTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/DispatcherTest.java
index 603dd3d2b37..15ebe8d8370 100755
--- a/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/DispatcherTest.java
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/dispatcher/DispatcherTest.java
@@ -742,9 +742,13 @@ public class DispatcherTest extends TestLogger {
 	@Test
 	public void testOnRemovedJobGraphDoesNotCleanUpHAFiles() throws Exception {
 		final CompletableFuture<JobID> removeJobGraphFuture = new CompletableFuture<>();
+		final CompletableFuture<JobID> releaseJobGraphFuture = new CompletableFuture<>();
+
 		final TestingJobGraphStore testingJobGraphStore = TestingJobGraphStore.newBuilder()
 			.setRemoveJobGraphConsumer(removeJobGraphFuture::complete)
+			.setReleaseJobGraphConsumer(releaseJobGraphFuture::complete)
 			.build();
+		testingJobGraphStore.start(null);
 
 		dispatcher = new TestingDispatcherBuilder()
 			.setInitialJobGraphs(Collections.singleton(jobGraph))
@@ -756,6 +760,8 @@ public class DispatcherTest extends TestLogger {
 
 		processFuture.join();
 
+		assertThat(releaseJobGraphFuture.get(), is(jobGraph.getJobID()));
+
 		try {
 			removeJobGraphFuture.get(10L, TimeUnit.MILLISECONDS);
 			fail("onRemovedJobGraph should not remove the job from the JobGraphStore.");
