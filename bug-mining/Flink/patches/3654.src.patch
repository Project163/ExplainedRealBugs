diff --git a/flink-core/src/main/java/org/apache/flink/core/plugin/PluginLoader.java b/flink-core/src/main/java/org/apache/flink/core/plugin/PluginLoader.java
index eb7b1c54fc3..94f04a37e15 100644
--- a/flink-core/src/main/java/org/apache/flink/core/plugin/PluginLoader.java
+++ b/flink-core/src/main/java/org/apache/flink/core/plugin/PluginLoader.java
@@ -24,6 +24,11 @@ import org.apache.flink.util.ChildFirstClassLoader;
 
 import javax.annotation.concurrent.ThreadSafe;
 
+import java.io.IOException;
+import java.net.URL;
+import java.net.URLClassLoader;
+import java.util.Arrays;
+import java.util.Enumeration;
 import java.util.Iterator;
 import java.util.ServiceLoader;
 
@@ -46,7 +51,7 @@ public class PluginLoader {
 
 	@VisibleForTesting
 	public static ClassLoader createPluginClassLoader(PluginDescriptor pluginDescriptor, ClassLoader parentClassLoader, String[] alwaysParentFirstPatterns) {
-		return new ChildFirstClassLoader(
+		return new PluginClassLoader(
 			pluginDescriptor.getPluginResourceURLs(),
 			parentClassLoader,
 			ArrayUtils.concat(alwaysParentFirstPatterns, pluginDescriptor.getLoaderExcludePatterns()));
@@ -100,4 +105,82 @@ public class PluginLoader {
 		}
 	}
 
+	/**
+	 * Loads all classes from the plugin jar except for explicitly white-listed packages (org.apache.flink, logging).
+	 *
+	 * <p>No class/resource in the system class loader (everything in lib/) can be seen in the plugin except those
+	 * starting with a whitelist prefix.
+	 */
+	private static final class PluginClassLoader extends URLClassLoader {
+		private final ClassLoader flinkClassLoader;
+
+		private final String[] allowedFlinkPackages;
+
+		private final String[] allowedResourcePrefixes;
+
+		PluginClassLoader(URL[] pluginResourceURLs, ClassLoader flinkClassLoader, String[] allowedFlinkPackages) {
+			super(pluginResourceURLs, null);
+			this.flinkClassLoader = flinkClassLoader;
+			this.allowedFlinkPackages = allowedFlinkPackages;
+			allowedResourcePrefixes = Arrays.stream(allowedFlinkPackages)
+				.map(packageName -> packageName.replace('.', '/'))
+				.toArray(String[]::new);
+		}
+
+		@Override
+		protected Class<?> loadClass(final String name, final boolean resolve) throws ClassNotFoundException {
+			synchronized (getClassLoadingLock(name)) {
+				final Class<?> loadedClass = findLoadedClass(name);
+				if (loadedClass != null) {
+					return resolveIfNeeded(resolve, loadedClass);
+				}
+
+				if (isAllowedFlinkClass(name)) {
+					try {
+						return resolveIfNeeded(resolve, flinkClassLoader.loadClass(name));
+					} catch (ClassNotFoundException e) {
+						// fallback to resolving it in this classloader
+						// for cases where the plugin uses org.apache.flink namespace
+					}
+				}
+
+				return super.loadClass(name, resolve);
+			}
+		}
+
+		private Class<?> resolveIfNeeded(final boolean resolve, final Class<?> loadedClass) {
+			if (resolve) {
+				resolveClass(loadedClass);
+			}
+
+			return loadedClass;
+		}
+
+		@Override
+		public URL getResource(final String name) {
+			if (isAllowedFlinkResource(name)) {
+				return flinkClassLoader.getResource(name);
+			}
+
+			return super.getResource(name);
+		}
+
+		@Override
+		public Enumeration<URL> getResources(final String name) throws IOException {
+			// ChildFirstClassLoader merges child and parent resources
+			if (isAllowedFlinkResource(name)) {
+				return flinkClassLoader.getResources(name);
+			}
+
+			return super.getResources(name);
+		}
+
+		private boolean isAllowedFlinkClass(final String name) {
+			return Arrays.stream(allowedFlinkPackages).anyMatch(name::startsWith);
+		}
+
+		private boolean isAllowedFlinkResource(final String name) {
+			return Arrays.stream(allowedResourcePrefixes).anyMatch(name::startsWith);
+		}
+	}
 }
diff --git a/flink-tests/src/test/java/org/apache/flink/test/plugin/PluginLoaderTest.java b/flink-tests/src/test/java/org/apache/flink/test/plugin/PluginLoaderTest.java
index ec57acbb83a..fff49f71a3b 100644
--- a/flink-tests/src/test/java/org/apache/flink/test/plugin/PluginLoaderTest.java
+++ b/flink-tests/src/test/java/org/apache/flink/test/plugin/PluginLoaderTest.java
@@ -38,7 +38,8 @@ public class PluginLoaderTest extends PluginTestBase {
 
 		final URL classpathA = createPluginJarURLFromString(PLUGIN_A);
 
-		PluginDescriptor pluginDescriptorA = new PluginDescriptor("A", new URL[]{classpathA}, new String[0]);
+		String[] parentPatterns = { TestSpi.class.getName(), OtherTestSpi.class.getName() };
+		PluginDescriptor pluginDescriptorA = new PluginDescriptor("A", new URL[]{classpathA}, parentPatterns);
 		ClassLoader pluginClassLoaderA = PluginLoader.createPluginClassLoader(pluginDescriptorA, PARENT_CLASS_LOADER, new String[0]);
 		Assert.assertNotEquals(PARENT_CLASS_LOADER, pluginClassLoaderA);
 		final PluginLoader pluginLoaderA = new PluginLoader(pluginClassLoaderA);
diff --git a/flink-tests/src/test/java/org/apache/flink/test/plugin/PluginManagerTest.java b/flink-tests/src/test/java/org/apache/flink/test/plugin/PluginManagerTest.java
index 7439da15f1e..03586d4127c 100644
--- a/flink-tests/src/test/java/org/apache/flink/test/plugin/PluginManagerTest.java
+++ b/flink-tests/src/test/java/org/apache/flink/test/plugin/PluginManagerTest.java
@@ -83,7 +83,8 @@ public class PluginManagerTest extends PluginTestBase {
 	@Test
 	public void testPluginLoading() {
 
-		final PluginManager pluginManager = new PluginManager(descriptors, PARENT_CLASS_LOADER, new String[0]);
+		String[] parentPatterns = { TestSpi.class.getName(), OtherTestSpi.class.getName() };
+		final PluginManager pluginManager = new PluginManager(descriptors, PARENT_CLASS_LOADER, parentPatterns);
 		final List<TestSpi> serviceImplList = Lists.newArrayList(pluginManager.load(TestSpi.class));
 		Assert.assertEquals(2, serviceImplList.size());
 
