diff --git a/flink-end-to-end-tests/flink-elasticsearch7-test/src/main/java/org/apache/flink/streaming/tests/Elasticsearch7SinkExample.java b/flink-end-to-end-tests/flink-elasticsearch7-test/src/main/java/org/apache/flink/streaming/tests/Elasticsearch7SinkExample.java
index 65dde5e3ae7..10a4bc785ac 100644
--- a/flink-end-to-end-tests/flink-elasticsearch7-test/src/main/java/org/apache/flink/streaming/tests/Elasticsearch7SinkExample.java
+++ b/flink-end-to-end-tests/flink-elasticsearch7-test/src/main/java/org/apache/flink/streaming/tests/Elasticsearch7SinkExample.java
@@ -18,28 +18,23 @@
 package org.apache.flink.streaming.tests;
 
 import org.apache.flink.api.common.functions.FlatMapFunction;
-import org.apache.flink.api.common.functions.RuntimeContext;
 import org.apache.flink.api.java.tuple.Tuple2;
 import org.apache.flink.api.java.utils.ParameterTool;
+import org.apache.flink.connector.elasticsearch.sink.Elasticsearch7SinkBuilder;
+import org.apache.flink.connector.elasticsearch.sink.ElasticsearchSink;
 import org.apache.flink.streaming.api.datastream.DataStream;
 import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;
-import org.apache.flink.streaming.connectors.elasticsearch.ActionRequestFailureHandler;
-import org.apache.flink.streaming.connectors.elasticsearch.RequestIndexer;
-import org.apache.flink.streaming.connectors.elasticsearch7.ElasticsearchSink;
 import org.apache.flink.util.Collector;
 
 import org.apache.http.HttpHost;
-import org.elasticsearch.action.ActionRequest;
 import org.elasticsearch.action.index.IndexRequest;
 import org.elasticsearch.action.update.UpdateRequest;
 import org.elasticsearch.client.Requests;
 
-import java.util.ArrayList;
 import java.util.HashMap;
-import java.util.List;
 import java.util.Map;
 
-/** End to end test for Elasticsearch6Sink. */
+/** End to end test for Elasticsearch7Sink. */
 public class Elasticsearch7SinkExample {
 
     public static void main(String[] args) throws Exception {
@@ -56,7 +51,7 @@ public class Elasticsearch7SinkExample {
         env.enableCheckpointing(5000);
 
         DataStream<Tuple2<String, String>> source =
-                env.generateSequence(0, parameterTool.getInt("numRecords") - 1)
+                env.fromSequence(0, parameterTool.getInt("numRecords") - 1)
                         .flatMap(
                                 new FlatMapFunction<Long, Tuple2<String, String>>() {
                                     @Override
@@ -69,71 +64,29 @@ public class Elasticsearch7SinkExample {
                                     }
                                 });
 
-        List<HttpHost> httpHosts = new ArrayList<>();
-        httpHosts.add(new HttpHost("127.0.0.1", 9200, "http"));
-
-        ElasticsearchSink.Builder<Tuple2<String, String>> esSinkBuilder =
-                new ElasticsearchSink.Builder<>(
-                        httpHosts,
-                        (Tuple2<String, String> element,
-                                RuntimeContext ctx,
-                                RequestIndexer indexer) -> {
-                            indexer.add(createIndexRequest(element.f1, parameterTool));
-                            indexer.add(createUpdateRequest(element, parameterTool));
-                        });
-
-        esSinkBuilder.setFailureHandler(
-                new CustomFailureHandler(parameterTool.getRequired("index")));
-
-        // this instructs the sink to emit after every element, otherwise they would be buffered
-        esSinkBuilder.setBulkFlushMaxActions(1);
-
-        source.addSink(esSinkBuilder.build());
-
+        ElasticsearchSink<Tuple2<String, String>> sink =
+                new Elasticsearch7SinkBuilder<Tuple2<String, String>>()
+                        .setHosts(new HttpHost("127.0.0.1", 9200, "http"))
+                        .setEmitter(
+                                (element, ctx, indexer) -> {
+                                    indexer.add(createIndexRequest(element.f1, parameterTool));
+                                    indexer.add(createUpdateRequest(element, parameterTool));
+                                })
+                        .setBulkFlushMaxActions(1) // emit after every element, don't buffer
+                        .build();
+
+        source.sinkTo(sink);
         env.execute("Elasticsearch 7.x end to end sink test example");
     }
 
-    private static class CustomFailureHandler implements ActionRequestFailureHandler {
-
-        private static final long serialVersionUID = 942269087742453482L;
-
-        private final String index;
-
-        CustomFailureHandler(String index) {
-            this.index = index;
-        }
-
-        @Override
-        public void onFailure(
-                ActionRequest action, Throwable failure, int restStatusCode, RequestIndexer indexer)
-                throws Throwable {
-            if (action instanceof IndexRequest) {
-                Map<String, Object> json = new HashMap<>();
-                json.put("data", ((IndexRequest) action).source());
-
-                indexer.add(
-                        Requests.indexRequest()
-                                .index(index)
-                                .id(((IndexRequest) action).id())
-                                .source(json));
-            } else {
-                throw new IllegalStateException("unexpected");
-            }
-        }
-    }
-
     private static IndexRequest createIndexRequest(String element, ParameterTool parameterTool) {
         Map<String, Object> json = new HashMap<>();
         json.put("data", element);
 
-        String index;
-        if (element.startsWith("message #15")) {
-            index = ":intentional invalid index:";
-        } else {
-            index = parameterTool.getRequired("index");
-        }
-
-        return Requests.indexRequest().index(index).id(element).source(json);
+        return Requests.indexRequest()
+                .index(parameterTool.getRequired("index"))
+                .id(element)
+                .source(json);
     }
 
     private static UpdateRequest createUpdateRequest(
