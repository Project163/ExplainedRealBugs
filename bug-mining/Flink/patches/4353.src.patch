diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/jobmaster/slotpool/SlotPoolImpl.java b/flink-runtime/src/main/java/org/apache/flink/runtime/jobmaster/slotpool/SlotPoolImpl.java
index 41bfdf1060f..8fb502c6f77 100644
--- a/flink-runtime/src/main/java/org/apache/flink/runtime/jobmaster/slotpool/SlotPoolImpl.java
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/jobmaster/slotpool/SlotPoolImpl.java
@@ -553,15 +553,19 @@ public class SlotPoolImpl implements SlotPool {
 			log.debug("Fulfilling pending slot request [{}] with slot [{}]",
 				pendingRequest.getSlotRequestId(), allocatedSlot.getAllocationId());
 
-			// this allocation may become orphan once its corresponding request is removed
-			final AllocationID allocationIdOfRequest = pendingRequests.getKeyBByKeyA(pendingRequest.getSlotRequestId());
-
 			removePendingRequest(pendingRequest.getSlotRequestId());
 
 			allocatedSlots.add(pendingRequest.getSlotRequestId(), allocatedSlot);
 			pendingRequest.getAllocatedSlotFuture().complete(allocatedSlot);
 
-			maybeRemapOrphanedAllocation(allocationIdOfRequest, allocatedSlot.getAllocationId());
+			// this allocation may become orphan once its corresponding request is removed
+			final Optional<AllocationID> allocationIdOfRequest = pendingRequest.getAllocationId();
+
+			// the allocation id can be null if the request was fulfilled by a slot directly offered
+			// by a reconnected TaskExecutor before the ResourceManager is connected
+			if (allocationIdOfRequest.isPresent()) {
+				maybeRemapOrphanedAllocation(allocationIdOfRequest.get(), allocatedSlot.getAllocationId());
+			}
 		} else {
 			log.debug("Adding slot [{}] to available slots", allocatedSlot.getAllocationId());
 			availableSlots.add(allocatedSlot, clock.relativeTimeMillis());
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/jobmaster/slotpool/SlotPoolImplTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/jobmaster/slotpool/SlotPoolImplTest.java
index cdd15195a29..389641528ab 100644
--- a/flink-runtime/src/test/java/org/apache/flink/runtime/jobmaster/slotpool/SlotPoolImplTest.java
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/jobmaster/slotpool/SlotPoolImplTest.java
@@ -797,14 +797,40 @@ public class SlotPoolImplTest extends TestLogger {
 		}
 	}
 
+	/**
+	 * In this case a slot is offered to the SlotPoolImpl before the ResourceManager is connected.
+	 * It can happen in production if a TaskExecutor is reconnected to a restarted JobMaster.
+	 */
+	@Test
+	public void testSlotsOfferedWithoutResourceManagerConnected() throws Exception {
+		try (SlotPoolImpl slotPool = createSlotPoolImpl()) {
+			slotPool.start(JobMasterId.generate(), "mock-address", mainThreadExecutor);
+
+			final SlotRequestId slotRequestId = new SlotRequestId();
+			final CompletableFuture<PhysicalSlot> slotFuture = requestNewAllocatedSlot(slotPool, slotRequestId);
+
+			assertThat(slotPool.getWaitingForResourceManager().values(), hasSize(1));
+
+			final AllocationID allocationId = new AllocationID();
+			offerSlot(slotPool, allocationId);
+
+			assertThat(slotPool.getWaitingForResourceManager().values(), hasSize(0));
+			assertThat(slotFuture.isDone(), is(true));
+			assertThat(slotFuture.isCompletedExceptionally(), is(false));
+			assertThat(slotFuture.getNow(null).getAllocationId(), is(allocationId));
+		}
+	}
+
 	private void requestNewAllocatedSlots(final SlotPool slotPool, final SlotRequestId... slotRequestIds) {
 		for (SlotRequestId slotRequestId : slotRequestIds) {
 			requestNewAllocatedSlot(slotPool, slotRequestId);
 		}
 	}
 
-	private void requestNewAllocatedSlot(final SlotPool slotPool, final SlotRequestId slotRequestId) {
-		slotPool.requestNewAllocatedSlot(slotRequestId, ResourceProfile.UNKNOWN, timeout);
+	private CompletableFuture<PhysicalSlot> requestNewAllocatedSlot(
+			final SlotPool slotPool,
+			final SlotRequestId slotRequestId) {
+		return slotPool.requestNewAllocatedSlot(slotRequestId, ResourceProfile.UNKNOWN, timeout);
 	}
 
 	private void offerSlot(final SlotPoolImpl slotPool, final AllocationID allocationId) {
