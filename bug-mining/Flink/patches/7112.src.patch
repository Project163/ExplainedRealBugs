diff --git a/docs/layouts/shortcodes/generated/optimizer_config_configuration.html b/docs/layouts/shortcodes/generated/optimizer_config_configuration.html
index e31fda01b33..305aa89e467 100644
--- a/docs/layouts/shortcodes/generated/optimizer_config_configuration.html
+++ b/docs/layouts/shortcodes/generated/optimizer_config_configuration.html
@@ -95,5 +95,11 @@ ONE_PHASE: Enforce to use one stage aggregate which only has CompleteGlobalAggre
             <td>Boolean</td>
             <td>When it is true, the optimizer will collect and use the statistics from source connectors if the source extends from SupportsStatisticReport and the statistics from catalog is UNKNOWN.Default value is true.</td>
         </tr>
+        <tr>
+            <td><h5>table.optimizer.sql2rel.project-merge.enabled</h5><br> <span class="label label-primary">Batch</span> <span class="label label-primary">Streaming</span></td>
+            <td style="word-wrap: break-word;">false</td>
+            <td>Boolean</td>
+            <td>If set to true, it will merge projects when converting SqlNode to RelNode.<br />Note: it is not recommended to turn on unless you are aware of possible side effects, such as causing the output of certain non-deterministic expressions to not meet expectations(see FLINK-20887).</td>
+        </tr>
     </tbody>
 </table>
diff --git a/flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/api/config/OptimizerConfigOptions.java b/flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/api/config/OptimizerConfigOptions.java
index 75060af338a..16efe665209 100644
--- a/flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/api/config/OptimizerConfigOptions.java
+++ b/flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/api/config/OptimizerConfigOptions.java
@@ -198,6 +198,22 @@ public class OptimizerConfigOptions {
                                                     "Default value is `IGNORE`, the optimizer does no changes.")
                                             .build());
 
+    @Documentation.TableOption(execMode = Documentation.ExecMode.BATCH_STREAMING)
+    public static final ConfigOption<Boolean> TABLE_OPTIMIZER_SQL2REL_PROJECT_MERGE_ENABLED =
+            key("table.optimizer.sql2rel.project-merge.enabled")
+                    .booleanType()
+                    .defaultValue(false)
+                    .withDeprecatedKeys("table.optimizer.sql-to-rel.project.merge.enabled")
+                    .withDescription(
+                            Description.builder()
+                                    .text(
+                                            "If set to true, it will merge projects when converting SqlNode to RelNode.")
+                                    .linebreak()
+                                    .text(
+                                            "Note: it is not recommended to turn on unless you are aware of possible side effects, "
+                                                    + "such as causing the output of certain non-deterministic expressions to not meet expectations(see FLINK-20887).")
+                                    .build());
+
     /** Strategy for handling non-deterministic updates. */
     @PublicEvolving
     public enum NonDeterministicUpdateStrategy {
diff --git a/flink-table/flink-table-planner/src/main/java/org/apache/flink/table/planner/delegation/PlannerContext.java b/flink-table/flink-table-planner/src/main/java/org/apache/flink/table/planner/delegation/PlannerContext.java
index afe8290cc5f..66297964b35 100644
--- a/flink-table/flink-table-planner/src/main/java/org/apache/flink/table/planner/delegation/PlannerContext.java
+++ b/flink-table/flink-table-planner/src/main/java/org/apache/flink/table/planner/delegation/PlannerContext.java
@@ -23,6 +23,7 @@ import org.apache.flink.sql.parser.validate.FlinkSqlConformance;
 import org.apache.flink.table.api.SqlDialect;
 import org.apache.flink.table.api.TableConfig;
 import org.apache.flink.table.api.TableException;
+import org.apache.flink.table.api.config.OptimizerConfigOptions;
 import org.apache.flink.table.catalog.CatalogManager;
 import org.apache.flink.table.catalog.FunctionCatalog;
 import org.apache.flink.table.module.ModuleManager;
@@ -286,15 +287,30 @@ public class PlannerContext {
         return JavaScalaConversionUtil.<SqlToRelConverter.Config>toJava(
                         getCalciteConfig().getSqlToRelConverterConfig())
                 .orElseGet(
-                        () ->
-                                SqlToRelConverter.config()
-                                        .withTrimUnusedFields(false)
-                                        .withHintStrategyTable(
-                                                FlinkHintStrategies.createHintStrategyTable())
-                                        .withInSubQueryThreshold(Integer.MAX_VALUE)
-                                        .withExpand(false)
-                                        .withRelBuilderFactory(
-                                                FlinkRelFactories.FLINK_REL_BUILDER()));
+                        () -> {
+                            SqlToRelConverter.Config config =
+                                    SqlToRelConverter.config()
+                                            .withTrimUnusedFields(false)
+                                            .withHintStrategyTable(
+                                                    FlinkHintStrategies.createHintStrategyTable())
+                                            .withInSubQueryThreshold(Integer.MAX_VALUE)
+                                            .withExpand(false)
+                                            .withRelBuilderFactory(
+                                                    FlinkRelFactories.FLINK_REL_BUILDER());
+
+                            // disable project merge in sql2rel phase, let it done by the optimizer
+                            boolean mergeProjectsDuringSqlToRel =
+                                    context.getTableConfig()
+                                            .getConfiguration()
+                                            .getBoolean(
+                                                    OptimizerConfigOptions
+                                                            .TABLE_OPTIMIZER_SQL2REL_PROJECT_MERGE_ENABLED);
+                            if (!mergeProjectsDuringSqlToRel) {
+                                config = config.addRelBuilderConfigTransform(c -> c.withBloat(-1));
+                            }
+
+                            return config;
+                        });
     }
 
     /** Returns the operator table for this environment including a custom Calcite configuration. */
diff --git a/flink-table/flink-table-planner/src/test/java/org/apache/flink/table/planner/plan/rules/logical/PushProjectIntoTableSourceScanRuleTest.java b/flink-table/flink-table-planner/src/test/java/org/apache/flink/table/planner/plan/rules/logical/PushProjectIntoTableSourceScanRuleTest.java
index f78db9014a8..5b2ea8135cc 100644
--- a/flink-table/flink-table-planner/src/test/java/org/apache/flink/table/planner/plan/rules/logical/PushProjectIntoTableSourceScanRuleTest.java
+++ b/flink-table/flink-table-planner/src/test/java/org/apache/flink/table/planner/plan/rules/logical/PushProjectIntoTableSourceScanRuleTest.java
@@ -26,6 +26,7 @@ import org.apache.flink.table.planner.calcite.CalciteConfig;
 import org.apache.flink.table.planner.factories.TableFactoryHarness;
 import org.apache.flink.table.planner.plan.optimize.program.BatchOptimizeContext;
 import org.apache.flink.table.planner.plan.optimize.program.FlinkBatchProgram;
+import org.apache.flink.table.planner.plan.optimize.program.FlinkChainedProgram;
 import org.apache.flink.table.planner.plan.optimize.program.FlinkHepRuleSetProgramBuilder;
 import org.apache.flink.table.planner.plan.optimize.program.HEP_RULES_EXECUTION_TYPE;
 import org.apache.flink.table.planner.utils.TableConfigUtils;
@@ -34,6 +35,7 @@ import org.apache.flink.testutils.junit.SharedObjects;
 import org.apache.flink.testutils.junit.SharedReference;
 
 import org.apache.calcite.plan.hep.HepMatchOrder;
+import org.apache.calcite.rel.rules.CoreRules;
 import org.apache.calcite.tools.RuleSets;
 import org.junit.Rule;
 import org.junit.Test;
@@ -312,7 +314,9 @@ public class PushProjectIntoTableSourceScanRuleTest
         util().tableEnv().createTable("T3", sourceDescriptor);
 
         util().verifyRelPlan("SELECT 1 FROM T3");
-        assertThat(appliedKeys.get()).hasSize(1);
+        // Because we turned off the project merge in the sql2rel phase, the source node will see
+        // the original unmerged project with all columns selected in this rule test
+        assertThat(appliedKeys.get()).hasSize(3);
     }
 
     @Test
@@ -331,6 +335,8 @@ public class PushProjectIntoTableSourceScanRuleTest
 
     @Test
     public void testProjectionIncludingOnlyMetadata() {
+        replaceProgramWithProjectMergeRule();
+
         final AtomicReference<DataType> appliedProjectionDataType = new AtomicReference<>(null);
         final AtomicReference<DataType> appliedMetadataDataType = new AtomicReference<>(null);
         final TableDescriptor sourceDescriptor =
@@ -352,8 +358,25 @@ public class PushProjectIntoTableSourceScanRuleTest
                 .containsExactly("metadata");
     }
 
+    private void replaceProgramWithProjectMergeRule() {
+        FlinkChainedProgram programs = new FlinkChainedProgram<BatchOptimizeContext>();
+        programs
+                .addLast(
+                        "rules",
+                        FlinkHepRuleSetProgramBuilder.<BatchOptimizeContext>newBuilder()
+                                .setHepRulesExecutionType(HEP_RULES_EXECUTION_TYPE.RULE_SEQUENCE())
+                                .setHepMatchOrder(HepMatchOrder.BOTTOM_UP)
+                                .add(RuleSets.ofList(
+                                        CoreRules.PROJECT_MERGE,
+                                        PushProjectIntoTableSourceScanRule.INSTANCE))
+                                .build());
+        util().replaceBatchProgram(programs);
+    }
+
     @Test
     public void testProjectionWithMetadataAndPhysicalFields() {
+        replaceProgramWithProjectMergeRule();
+
         final AtomicReference<DataType> appliedProjectionDataType = new AtomicReference<>(null);
         final AtomicReference<DataType> appliedMetadataDataType = new AtomicReference<>(null);
         final TableDescriptor sourceDescriptor =
diff --git a/flink-table/flink-table-planner/src/test/resources/digest/testGetDigestWithDynamicFunctionView.out b/flink-table/flink-table-planner/src/test/resources/digest/testGetDigestWithDynamicFunctionView.out
index 152f3a4444a..50e44d8bcce 100644
--- a/flink-table/flink-table-planner/src/test/resources/digest/testGetDigestWithDynamicFunctionView.out
+++ b/flink-table/flink-table-planner/src/test/resources/digest/testGetDigestWithDynamicFunctionView.out
@@ -1,14 +1,17 @@
 LogicalIntersect(all=[false]), rowType=[RecordType(INTEGER random)]
 LogicalIntersect(all=[false]), rowType=[RecordType(INTEGER random)]
 LogicalProject(inputs=[0]), rowType=[RecordType(INTEGER random)]
+LogicalProject(inputs=[0]), rowType=[RecordType(INTEGER random)]
 LogicalSort(sort0=[$1], dir0=[ASC-nulls-first], fetch=[1]), rowType=[RecordType(INTEGER random, DOUBLE EXPR$1)]
 LogicalProject(exprs=[[$1, RAND()]]), rowType=[RecordType(INTEGER random, DOUBLE EXPR$1)]
 LogicalTableScan(table=[[default_catalog, default_database, MyTable]]), rowType=[RecordType(VARCHAR(2147483647) first, INTEGER id, DOUBLE score, VARCHAR(2147483647) last)]
 LogicalProject(inputs=[0]), rowType=[RecordType(INTEGER random)]
+LogicalProject(inputs=[0]), rowType=[RecordType(INTEGER random)]
 LogicalSort(sort0=[$1], dir0=[ASC-nulls-first], fetch=[1]), rowType=[RecordType(INTEGER random, DOUBLE EXPR$1)]
 LogicalProject(exprs=[[$1, RAND()]]), rowType=[RecordType(INTEGER random, DOUBLE EXPR$1)]
 LogicalTableScan(table=[[default_catalog, default_database, MyTable]]), rowType=[RecordType(VARCHAR(2147483647) first, INTEGER id, DOUBLE score, VARCHAR(2147483647) last)]
 LogicalProject(inputs=[0]), rowType=[RecordType(INTEGER random)]
+LogicalProject(inputs=[0]), rowType=[RecordType(INTEGER random)]
 LogicalSort(sort0=[$1], dir0=[ASC-nulls-first], fetch=[1]), rowType=[RecordType(INTEGER random, DOUBLE EXPR$1)]
 LogicalProject(exprs=[[$1, RAND()]]), rowType=[RecordType(INTEGER random, DOUBLE EXPR$1)]
 LogicalTableScan(table=[[default_catalog, default_database, MyTable]]), rowType=[RecordType(VARCHAR(2147483647) first, INTEGER id, DOUBLE score, VARCHAR(2147483647) last)]
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/connector/file/table/FileSystemTableSourceTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/connector/file/table/FileSystemTableSourceTest.xml
index 6f93f52a3f3..f916d6b7909 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/connector/file/table/FileSystemTableSourceTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/connector/file/table/FileSystemTableSourceTest.xml
@@ -43,8 +43,9 @@ Sink(table=[default_catalog.default_database.MySink], fields=[a, b, c])
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.MySink], targetColumns=[[0],[1],[2]], fields=[a, b, filemeta])
-+- LogicalProject(a=[$0], b=[$1], filemeta=[CAST($3):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTableWithMeta]])
++- LogicalProject(a=[$0], b=[$1], filemeta=[$3])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], filemeta=[CAST($3):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTableWithMeta]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/api/stream/ExplainTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/api/stream/ExplainTest.xml
index 75287581fbd..e72ee7cf088 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/api/stream/ExplainTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/api/stream/ExplainTest.xml
@@ -409,69 +409,77 @@ SortLimit(orderBy=[a ASC], offset=[0], fetch=[5], strategy=[AppendFastStrategy])
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`appendSink1`], fields=[a, b])
 +- LogicalProject(id1=[$0], EXPR$1=[$2])
    +- LogicalAggregate(group=[{0, 1}], EXPR$1=[LISTAGG($2, $3)])
-      +- LogicalProject(id1=[$0], $f1=[$TUMBLE($2, 8000:INTERVAL SECOND)], text=[$1], $f3=[_UTF-16LE'#'])
-         +- LogicalFilter(condition=[AND(=($0, $3), >($2, -($7, 300000:INTERVAL MINUTE)), <($2, +($7, 180000:INTERVAL MINUTE)))])
-            +- LogicalJoin(condition=[true], joinType=[inner])
-               :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($2, 0:INTERVAL MILLISECOND)])
-               :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 0:INTERVAL MILLISECOND)])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+      +- LogicalProject(id1=[$0], $f1=[$TUMBLE($1, 8000:INTERVAL SECOND)], text=[$2], $f3=[_UTF-16LE'#'])
+         +- LogicalProject(id1=[$0], ts=[$2], text=[$1])
+            +- LogicalFilter(condition=[AND(=($0, $3), >($2, -($7, 300000:INTERVAL MINUTE)), <($2, +($7, 180000:INTERVAL MINUTE)))])
+               +- LogicalJoin(condition=[true], joinType=[inner])
+                  :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($2, 0:INTERVAL MILLISECOND)])
+                  :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+                  +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 0:INTERVAL MILLISECOND)])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`appendSink2`], fields=[a, b])
 +- LogicalProject(id1=[$0], EXPR$1=[$2])
    +- LogicalAggregate(group=[{0, 1}], EXPR$1=[LISTAGG($2, $3)])
-      +- LogicalProject(id1=[$0], $f1=[$HOP($2, 12000:INTERVAL SECOND, 6000:INTERVAL SECOND)], text=[$1], $f3=[_UTF-16LE'*'])
-         +- LogicalFilter(condition=[AND(=($0, $3), >($2, -($7, 300000:INTERVAL MINUTE)), <($2, +($7, 180000:INTERVAL MINUTE)))])
-            +- LogicalJoin(condition=[true], joinType=[inner])
-               :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($2, 0:INTERVAL MILLISECOND)])
-               :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 0:INTERVAL MILLISECOND)])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+      +- LogicalProject(id1=[$0], $f1=[$HOP($1, 12000:INTERVAL SECOND, 6000:INTERVAL SECOND)], text=[$2], $f3=[_UTF-16LE'*'])
+         +- LogicalProject(id1=[$0], ts=[$2], text=[$1])
+            +- LogicalFilter(condition=[AND(=($0, $3), >($2, -($7, 300000:INTERVAL MINUTE)), <($2, +($7, 180000:INTERVAL MINUTE)))])
+               +- LogicalJoin(condition=[true], joinType=[inner])
+                  :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($2, 0:INTERVAL MILLISECOND)])
+                  :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+                  +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 0:INTERVAL MILLISECOND)])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 
 == Optimized Physical Plan ==
 LegacySink(name=[`default_catalog`.`default_database`.`appendSink1`], fields=[a, b], changelogMode=[NONE]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-+- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, rowtime, 8000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
++- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, ts, 8000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
    +- Exchange(distribution=[hash[id1]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-      +- Calc(select=[id1, rowtime, text, _UTF-16LE'#' AS $f3], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-         +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=4], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, cnt, name, goods, rowtime0], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-            :- Exchange(distribution=[hash[id1]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-            :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-            :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-            +- Exchange(distribution=[hash[id2]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-               +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-                  +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+      +- Calc(select=[id1, ts, text, _UTF-16LE'#' AS $f3], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+         +- Calc(select=[id1, rowtime AS ts, text], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+            +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, rowtime0], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+               :- Exchange(distribution=[hash[id1]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+               :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+               :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+               +- Exchange(distribution=[hash[id2]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+                  +- Calc(select=[id2, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+                     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+                        +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
 
 LegacySink(name=[`default_catalog`.`default_database`.`appendSink2`], fields=[a, b], changelogMode=[NONE]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-+- GroupWindowAggregate(groupBy=[id1], window=[SlidingGroupWindow('w$, rowtime, 6000, 12000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
++- GroupWindowAggregate(groupBy=[id1], window=[SlidingGroupWindow('w$, ts, 6000, 12000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
    +- Exchange(distribution=[hash[id1]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-      +- Calc(select=[id1, rowtime, text, _UTF-16LE'*' AS $f3], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-         +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=4], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, cnt, name, goods, rowtime0], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-            :- Exchange(distribution=[hash[id1]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-            :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-            :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-            +- Exchange(distribution=[hash[id2]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-               +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
-                  +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+      +- Calc(select=[id1, ts, text, _UTF-16LE'*' AS $f3], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+         +- Calc(select=[id1, rowtime AS ts, text], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+            +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, rowtime0], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+               :- Exchange(distribution=[hash[id1]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+               :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+               :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+               +- Exchange(distribution=[hash[id2]], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+                  +- Calc(select=[id2, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+                     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
+                        +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime], changelogMode=[I]): rowcount = , cumulative cost = {rows, cpu, io, network, memory}
 
 == Optimized Execution Plan ==
-IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=4], where=[((id1 = id2) AND (rowtime > (rowtime0 - 300000:INTERVAL MINUTE)) AND (rowtime < (rowtime0 + 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, cnt, name, goods, rowtime0])(reuse_id=[1])
-:- Exchange(distribution=[hash[id1]])
-:  +- WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 0:INTERVAL MILLISECOND)])
-:     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime])
-+- Exchange(distribution=[hash[id2]])
-   +- WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 0:INTERVAL MILLISECOND)])
-      +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime])
+Calc(select=[id1, rowtime AS ts, text])(reuse_id=[1])
++- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=1], where=[((id1 = id2) AND (rowtime > (rowtime0 - 300000:INTERVAL MINUTE)) AND (rowtime < (rowtime0 + 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, rowtime0])
+   :- Exchange(distribution=[hash[id1]])
+   :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 0:INTERVAL MILLISECOND)])
+   :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime])
+   +- Exchange(distribution=[hash[id2]])
+      +- Calc(select=[id2, rowtime])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 0:INTERVAL MILLISECOND)])
+            +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime])
 
 LegacySink(name=[`default_catalog`.`default_database`.`appendSink1`], fields=[a, b])
-+- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, rowtime, 8000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
++- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, ts, 8000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
    +- Exchange(distribution=[hash[id1]])
-      +- Calc(select=[id1, rowtime, text, '#' AS $f3])
+      +- Calc(select=[id1, ts, text, '#' AS $f3])
          +- Reused(reference_id=[1])
 
 LegacySink(name=[`default_catalog`.`default_database`.`appendSink2`], fields=[a, b])
-+- GroupWindowAggregate(groupBy=[id1], window=[SlidingGroupWindow('w$, rowtime, 6000, 12000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
++- GroupWindowAggregate(groupBy=[id1], window=[SlidingGroupWindow('w$, ts, 6000, 12000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
    +- Exchange(distribution=[hash[id1]])
-      +- Calc(select=[id1, rowtime, text, '*' AS $f3])
+      +- Calc(select=[id1, ts, text, '*' AS $f3])
          +- Reused(reference_id=[1])
 ]]>
     </Resource>
@@ -503,69 +511,77 @@ Union(all=[true], union=[a, b, c])
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`appendSink1`], fields=[a, b])
 +- LogicalProject(id1=[$0], EXPR$1=[$2])
    +- LogicalAggregate(group=[{0, 1}], EXPR$1=[LISTAGG($2, $3)])
-      +- LogicalProject(id1=[$0], $f1=[$TUMBLE($2, 8000:INTERVAL SECOND)], text=[$1], $f3=[_UTF-16LE'#'])
-         +- LogicalFilter(condition=[AND(=($0, $3), >($2, -($7, 300000:INTERVAL MINUTE)), <($2, +($7, 180000:INTERVAL MINUTE)))])
-            +- LogicalJoin(condition=[true], joinType=[inner])
-               :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($2, 0:INTERVAL MILLISECOND)])
-               :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 0:INTERVAL MILLISECOND)])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+      +- LogicalProject(id1=[$0], $f1=[$TUMBLE($1, 8000:INTERVAL SECOND)], text=[$2], $f3=[_UTF-16LE'#'])
+         +- LogicalProject(id1=[$0], ts=[$2], text=[$1])
+            +- LogicalFilter(condition=[AND(=($0, $3), >($2, -($7, 300000:INTERVAL MINUTE)), <($2, +($7, 180000:INTERVAL MINUTE)))])
+               +- LogicalJoin(condition=[true], joinType=[inner])
+                  :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($2, 0:INTERVAL MILLISECOND)])
+                  :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+                  +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 0:INTERVAL MILLISECOND)])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`appendSink2`], fields=[a, b])
 +- LogicalProject(id1=[$0], EXPR$1=[$2])
    +- LogicalAggregate(group=[{0, 1}], EXPR$1=[LISTAGG($2, $3)])
-      +- LogicalProject(id1=[$0], $f1=[$HOP($2, 12000:INTERVAL SECOND, 6000:INTERVAL SECOND)], text=[$1], $f3=[_UTF-16LE'*'])
-         +- LogicalFilter(condition=[AND(=($0, $3), >($2, -($7, 300000:INTERVAL MINUTE)), <($2, +($7, 180000:INTERVAL MINUTE)))])
-            +- LogicalJoin(condition=[true], joinType=[inner])
-               :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($2, 0:INTERVAL MILLISECOND)])
-               :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 0:INTERVAL MILLISECOND)])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+      +- LogicalProject(id1=[$0], $f1=[$HOP($1, 12000:INTERVAL SECOND, 6000:INTERVAL SECOND)], text=[$2], $f3=[_UTF-16LE'*'])
+         +- LogicalProject(id1=[$0], ts=[$2], text=[$1])
+            +- LogicalFilter(condition=[AND(=($0, $3), >($2, -($7, 300000:INTERVAL MINUTE)), <($2, +($7, 180000:INTERVAL MINUTE)))])
+               +- LogicalJoin(condition=[true], joinType=[inner])
+                  :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($2, 0:INTERVAL MILLISECOND)])
+                  :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+                  +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 0:INTERVAL MILLISECOND)])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 
 == Optimized Physical Plan ==
 LegacySink(name=[`default_catalog`.`default_database`.`appendSink1`], fields=[a, b])
-+- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, rowtime, 8000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
++- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, ts, 8000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
    +- Exchange(distribution=[hash[id1]])
-      +- Calc(select=[id1, rowtime, text, _UTF-16LE'#' AS $f3])
-         +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=4], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, cnt, name, goods, rowtime0])
-            :- Exchange(distribution=[hash[id1]])
-            :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)])
-            :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime])
-            +- Exchange(distribution=[hash[id2]])
-               +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)])
-                  +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime])
+      +- Calc(select=[id1, ts, text, _UTF-16LE'#' AS $f3])
+         +- Calc(select=[id1, rowtime AS ts, text])
+            +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, rowtime0])
+               :- Exchange(distribution=[hash[id1]])
+               :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)])
+               :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime])
+               +- Exchange(distribution=[hash[id2]])
+                  +- Calc(select=[id2, rowtime])
+                     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)])
+                        +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime])
 
 LegacySink(name=[`default_catalog`.`default_database`.`appendSink2`], fields=[a, b])
-+- GroupWindowAggregate(groupBy=[id1], window=[SlidingGroupWindow('w$, rowtime, 6000, 12000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
++- GroupWindowAggregate(groupBy=[id1], window=[SlidingGroupWindow('w$, ts, 6000, 12000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
    +- Exchange(distribution=[hash[id1]])
-      +- Calc(select=[id1, rowtime, text, _UTF-16LE'*' AS $f3])
-         +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=4], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, cnt, name, goods, rowtime0])
-            :- Exchange(distribution=[hash[id1]])
-            :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)])
-            :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime])
-            +- Exchange(distribution=[hash[id2]])
-               +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)])
-                  +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime])
+      +- Calc(select=[id1, ts, text, _UTF-16LE'*' AS $f3])
+         +- Calc(select=[id1, rowtime AS ts, text])
+            +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, rowtime0])
+               :- Exchange(distribution=[hash[id1]])
+               :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)])
+               :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime])
+               +- Exchange(distribution=[hash[id2]])
+                  +- Calc(select=[id2, rowtime])
+                     +- WatermarkAssigner(rowtime=[rowtime], watermark=[-(rowtime, 0:INTERVAL MILLISECOND)])
+                        +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime])
 
 == Optimized Execution Plan ==
-IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=4], where=[((id1 = id2) AND (rowtime > (rowtime0 - 300000:INTERVAL MINUTE)) AND (rowtime < (rowtime0 + 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, cnt, name, goods, rowtime0])(reuse_id=[1])
-:- Exchange(distribution=[hash[id1]])
-:  +- WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 0:INTERVAL MILLISECOND)])
-:     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime])
-+- Exchange(distribution=[hash[id2]])
-   +- WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 0:INTERVAL MILLISECOND)])
-      +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime])
+Calc(select=[id1, rowtime AS ts, text])(reuse_id=[1])
++- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=2, rightTimeIndex=1], where=[((id1 = id2) AND (rowtime > (rowtime0 - 300000:INTERVAL MINUTE)) AND (rowtime < (rowtime0 + 180000:INTERVAL MINUTE)))], select=[id1, text, rowtime, id2, rowtime0])
+   :- Exchange(distribution=[hash[id1]])
+   :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 0:INTERVAL MILLISECOND)])
+   :     +- DataStreamScan(table=[[default_catalog, default_database, T1]], fields=[id1, text, rowtime])
+   +- Exchange(distribution=[hash[id2]])
+      +- Calc(select=[id2, rowtime])
+         +- WatermarkAssigner(rowtime=[rowtime], watermark=[(rowtime - 0:INTERVAL MILLISECOND)])
+            +- DataStreamScan(table=[[default_catalog, default_database, T2]], fields=[id2, cnt, name, goods, rowtime])
 
 LegacySink(name=[`default_catalog`.`default_database`.`appendSink1`], fields=[a, b])
-+- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, rowtime, 8000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
++- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, ts, 8000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
    +- Exchange(distribution=[hash[id1]])
-      +- Calc(select=[id1, rowtime, text, '#' AS $f3])
+      +- Calc(select=[id1, ts, text, '#' AS $f3])
          +- Reused(reference_id=[1])
 
 LegacySink(name=[`default_catalog`.`default_database`.`appendSink2`], fields=[a, b])
-+- GroupWindowAggregate(groupBy=[id1], window=[SlidingGroupWindow('w$, rowtime, 6000, 12000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
++- GroupWindowAggregate(groupBy=[id1], window=[SlidingGroupWindow('w$, ts, 6000, 12000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
    +- Exchange(distribution=[hash[id1]])
-      +- Calc(select=[id1, rowtime, text, '*' AS $f3])
+      +- Calc(select=[id1, ts, text, '*' AS $f3])
          +- Reused(reference_id=[1])
 ]]>
     </Resource>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/catalog/JavaCatalogTableTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/catalog/JavaCatalogTableTest.xml
index d2aba0ee2af..22f82b06a25 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/catalog/JavaCatalogTableTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/catalog/JavaCatalogTableTest.xml
@@ -92,7 +92,9 @@ GroupWindowAggregate(window=[TumblingGroupWindow('w, proctime, 600000)], select=
 LogicalProject(EXPR$0=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$0=[COUNT()])
    +- LogicalProject($f0=[$TUMBLE($1, 600000:INTERVAL MINUTE)])
-      +- LogicalTableScan(table=[[testCatalog, default, testTable]])
+      +- LogicalProject(count=[$0], rowtime=[$1], proctime=[$2])
+         +- LogicalProject(count=[$0], rowtime=[$1], proctime=[PROCTIME()])
+            +- LogicalTableScan(table=[[testCatalog, default, testTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -113,9 +115,10 @@ HashWindowAggregate(window=[TumblingGroupWindow('w$, rowtime, 600000)], select=[
 LogicalProject(EXPR$0=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$0=[COUNT()])
    +- LogicalProject($f0=[$TUMBLE($1, 600000:INTERVAL MINUTE)])
-      +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($1, 5000:INTERVAL SECOND)])
-         +- LogicalProject(count=[$0], rowtime=[$1], proctime=[PROCTIME()])
-            +- LogicalTableScan(table=[[testCatalog, default, testTable]])
+      +- LogicalProject(count=[$0], rowtime=[$1], proctime=[$2])
+         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($1, 5000:INTERVAL SECOND)])
+            +- LogicalProject(count=[$0], rowtime=[$1], proctime=[PROCTIME()])
+               +- LogicalTableScan(table=[[testCatalog, default, testTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/CalcTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/CalcTest.xml
index 1b76056df4e..0b04d0a7924 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/CalcTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/CalcTest.xml
@@ -277,8 +277,9 @@ Calc(select=[a._1 AS _1, a._2 AS _2, c, b._1 AS _10, b._2 AS _20])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(c=[$2])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+LogicalProject(c=[$1])
++- LogicalProject(a=[$0], c=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -474,7 +475,8 @@ Calc(select=[a, b, c, 1984-07-12 AS EXPR$3, 14:34:24 AS EXPR$4, 1984-07-12 14:34
     <Resource name="ast">
       <![CDATA[
 LogicalProject(1-_./Ü=[$0], b=[$1], c=[$2])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
++- LogicalProject(1-_./Ü=[$0], b=[$1], c=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DagOptimizationTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DagOptimizationTest.xml
index 6a7353a1fd7..7c91bb1b865 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DagOptimizationTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DagOptimizationTest.xml
@@ -31,11 +31,13 @@ LogicalLegacySink(name=[`default_catalog`.`default_database`.`sink2`], fields=[b
          +- LogicalProject(b=[$1], a=[$0])
             +- LogicalUnion(all=[true])
                :- LogicalProject(a=[$0], b=[$1], c=[$2])
-               :  +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%hello%')])
-               :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+               :  +- LogicalProject(a=[$0], b=[$1], c=[$2])
+               :     +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%hello%')])
+               :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
                +- LogicalProject(a=[$0], b=[$1], c=[$2])
-                  +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%world%')])
-                     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2])
+                     +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%world%')])
+                        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`sink3`], fields=[b, cnt])
 +- LogicalProject(b=[$0], cnt=[$1])
@@ -44,11 +46,13 @@ LogicalLegacySink(name=[`default_catalog`.`default_database`.`sink3`], fields=[b
          +- LogicalProject(b=[$1], a=[$0])
             +- LogicalUnion(all=[true])
                :- LogicalProject(a=[$0], b=[$1], c=[$2])
-               :  +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%hello%')])
-               :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+               :  +- LogicalProject(a=[$0], b=[$1], c=[$2])
+               :     +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%hello%')])
+               :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
                +- LogicalProject(a=[$0], b=[$1], c=[$2])
-                  +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%world%')])
-                     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2])
+                     +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%world%')])
+                        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -85,17 +89,19 @@ LegacySink(name=[`default_catalog`.`default_database`.`sink3`], fields=[b, cnt])
       <![CDATA[
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`sink1`], fields=[total_sum])
 +- LogicalAggregate(group=[{}], total_sum=[SUM($0)])
-   +- LogicalProject(sum_a=[$1])
-      +- LogicalAggregate(group=[{0}], sum_a=[SUM($1)])
-         +- LogicalProject(c=[$2], a=[$0])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(sum_a=[$0])
+      +- LogicalProject(sum_a=[$1], c=[$0])
+         +- LogicalAggregate(group=[{0}], sum_a=[SUM($1)])
+            +- LogicalProject(c=[$2], a=[$0])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`sink2`], fields=[total_min])
 +- LogicalAggregate(group=[{}], total_min=[MIN($0)])
-   +- LogicalProject(sum_a=[$1])
-      +- LogicalAggregate(group=[{0}], sum_a=[SUM($1)])
-         +- LogicalProject(c=[$2], a=[$0])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(sum_a=[$0])
+      +- LogicalProject(sum_a=[$1], c=[$0])
+         +- LogicalAggregate(group=[{0}], sum_a=[SUM($1)])
+            +- LogicalProject(c=[$2], a=[$0])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -127,28 +133,32 @@ LegacySink(name=[`default_catalog`.`default_database`.`sink2`], fields=[total_mi
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`sink1`], fields=[a, b1])
 +- LogicalUnion(all=[true])
    :- LogicalProject(a1=[$0], b1=[$1])
-   :  +- LogicalFilter(condition=[<=($0, 10)])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
-   +- LogicalProject(a=[$2], b1=[$1])
-      +- LogicalFilter(condition=[=($2, $0)])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalProject(a1=[$0], b1=[$1])
-            :  +- LogicalFilter(condition=[<=($0, 10)])
-            :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]])
+   :  +- LogicalProject(a1=[$0], b1=[$1])
+   :     +- LogicalFilter(condition=[<=($0, 10)])
+   :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a=[$0], b1=[$1])
+      +- LogicalProject(a=[$2], b1=[$1])
+         +- LogicalFilter(condition=[=($2, $0)])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalProject(a1=[$0], b1=[$1])
+               :  +- LogicalFilter(condition=[<=($0, 10)])
+               :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]])
 
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`sink2`], fields=[a, b1])
 +- LogicalUnion(all=[true])
    :- LogicalProject(a1=[$0], b1=[$1])
-   :  +- LogicalFilter(condition=[<=($0, 10)])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
-   +- LogicalProject(a=[$2], b1=[$1])
-      +- LogicalFilter(condition=[=($2, $0)])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalProject(a1=[$0], b1=[$1])
-            :  +- LogicalFilter(condition=[<=($0, 10)])
-            :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]])
+   :  +- LogicalProject(a1=[$0], b1=[$1])
+   :     +- LogicalFilter(condition=[<=($0, 10)])
+   :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a=[$0], b1=[$1])
+      +- LogicalProject(a=[$2], b1=[$1])
+         +- LogicalFilter(condition=[=($2, $0)])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalProject(a1=[$0], b1=[$1])
+               :  +- LogicalFilter(condition=[<=($0, 10)])
+               :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -189,35 +199,37 @@ LogicalLegacySink(name=[`default_catalog`.`default_database`.`sink1`], fields=[a
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`sink2`], fields=[a, b1])
 +- LogicalUnion(all=[true])
    :- LogicalProject(a1=[$0], b1=[$1])
-   :  +- LogicalFilter(condition=[<=($0, 10)])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
-   +- LogicalProject(a=[$2], b1=[$1])
-      +- LogicalFilter(condition=[=($2, $0)])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalProject(a1=[$0], b1=[$1])
-            :  +- LogicalFilter(condition=[<=($0, 10)])
-            :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]])
+   :  +- LogicalProject(a1=[$0], b1=[$1])
+   :     +- LogicalFilter(condition=[<=($0, 10)])
+   :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a=[$0], b1=[$1])
+      +- LogicalProject(a=[$2], b1=[$1])
+         +- LogicalFilter(condition=[=($2, $0)])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalProject(a1=[$0], b1=[$1])
+               :  +- LogicalFilter(condition=[<=($0, 10)])
+               :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[a AS a1, b AS b1])(reuse_id=[1])
-+- Calc(select=[a, b, c], where=[(a <= 10)])
-   +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]], fields=[a, b, c])
+Calc(select=[a, b], where=[(a <= 10)])(reuse_id=[1])
++- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]], fields=[a, b, c])
 
-Calc(select=[a, b1])(reuse_id=[2])
-+- HashJoin(joinType=[InnerJoin], where=[(a = a1)], select=[a1, b1, a, b, c, d, e], build=[left])
-   :- Exchange(distribution=[hash[a1]])
+Calc(select=[a0 AS a, b AS b1])(reuse_id=[2])
++- HashJoin(joinType=[InnerJoin], where=[(a0 = a)], select=[a, b, a0], build=[right])
+   :- Exchange(distribution=[hash[a]])
    :  +- Reused(reference_id=[1])
    +- Exchange(distribution=[hash[a]])
-      +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]], fields=[a, b, c, d, e])
+      +- Calc(select=[a])
+         +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]], fields=[a, b, c, d, e])
 
 LegacySink(name=[`default_catalog`.`default_database`.`sink1`], fields=[a, b1])
 +- Reused(reference_id=[2])
 
 LegacySink(name=[`default_catalog`.`default_database`.`sink2`], fields=[a, b1])
-+- Union(all=[true], union=[a1, b1])
++- Union(all=[true], union=[a, b])
    :- Reused(reference_id=[1])
    +- Reused(reference_id=[2])
 ]]>
@@ -297,13 +309,15 @@ LegacySink(name=[`default_catalog`.`default_database`.`sink2`], fields=[a1, b, c
       <![CDATA[
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`sink1`], fields=[total_sum])
 +- LogicalAggregate(group=[{}], total_sum=[SUM($0)])
-   +- LogicalProject(a=[random_udf($0)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a=[$0])
+      +- LogicalProject(a=[random_udf($0)], c=[$2])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`sink2`], fields=[total_min])
 +- LogicalAggregate(group=[{}], total_min=[MIN($0)])
-   +- LogicalProject(a=[random_udf($0)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a=[$0])
+      +- LogicalProject(a=[random_udf($0)], c=[$2])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -615,8 +629,9 @@ LogicalLegacySink(name=[`default_catalog`.`default_database`.`sink1`], fields=[a
          :              :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
          :              +- LogicalTableFunctionScan(invocation=[split($cor0.c)], rowType=[RecordType(VARCHAR(2147483647) f0)], elementType=[class [Ljava.lang.Object;])
          +- LogicalProject(a=[$0], total_c=[0])
-            +- LogicalFilter(condition=[>=($1, UNIX_TIMESTAMP(_UTF-16LE'${startTime}'))])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+            +- LogicalProject(a=[$0], b=[-($1, MOD($1, 300))], c=[$2])
+               +- LogicalFilter(condition=[>=($1, UNIX_TIMESTAMP(_UTF-16LE'${startTime}'))])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`sink2`], fields=[a, total_c])
 +- LogicalProject(a=[$0], total_c=[$1])
@@ -632,8 +647,9 @@ LogicalLegacySink(name=[`default_catalog`.`default_database`.`sink2`], fields=[a
          :              :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
          :              +- LogicalTableFunctionScan(invocation=[split($cor0.c)], rowType=[RecordType(VARCHAR(2147483647) f0)], elementType=[class [Ljava.lang.Object;])
          +- LogicalProject(a=[$0], total_c=[0])
-            +- LogicalFilter(condition=[>=($1, UNIX_TIMESTAMP(_UTF-16LE'${startTime}'))])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+            +- LogicalProject(a=[$0], b=[-($1, MOD($1, 300))], c=[$2])
+               +- LogicalFilter(condition=[>=($1, UNIX_TIMESTAMP(_UTF-16LE'${startTime}'))])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -739,15 +755,17 @@ LegacySink(name=[`default_catalog`.`default_database`.`appendSink`], fields=[a1,
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`appendSink`], fields=[a1, b1])
 +- LogicalUnion(all=[true])
    :- LogicalProject(a1=[$0], b1=[$1])
-   :  +- LogicalFilter(condition=[<=($0, 10)])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
-   +- LogicalProject(a=[$2], b1=[$1])
-      +- LogicalFilter(condition=[=($2, $0)])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalProject(a1=[$0], b1=[$1])
-            :  +- LogicalFilter(condition=[<=($0, 10)])
-            :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+   :  +- LogicalProject(a1=[$0], b1=[$1])
+   :     +- LogicalFilter(condition=[<=($0, 10)])
+   :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a=[$0], b1=[$1])
+      +- LogicalProject(a=[$2], b1=[$1])
+         +- LogicalFilter(condition=[=($2, $0)])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalProject(a1=[$0], b1=[$1])
+               :  +- LogicalFilter(condition=[<=($0, 10)])
+               :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DeadlockBreakupTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DeadlockBreakupTest.xml
index df69ff98aba..be14feb4cf6 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DeadlockBreakupTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DeadlockBreakupTest.xml
@@ -298,14 +298,15 @@ SELECT * FROM
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
-:- LogicalProject(cnt1=[$1], cnt2=[$3])
-:  +- LogicalJoin(condition=[=($0, $2)], joinType=[left])
-:     :- LogicalAggregate(group=[{0}], cnt1=[COUNT()])
-:     :  +- LogicalProject(a=[$0])
-:     :     +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-:     +- LogicalAggregate(group=[{0}], cnt2=[COUNT()])
-:        +- LogicalProject(d=[$0])
-:           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
+:- LogicalProject(cnt1=[$0], cnt2=[$1])
+:  +- LogicalProject(cnt1=[$1], cnt2=[$3])
+:     +- LogicalJoin(condition=[=($0, $2)], joinType=[left])
+:        :- LogicalAggregate(group=[{0}], cnt1=[COUNT()])
+:        :  +- LogicalProject(a=[$0])
+:        :     +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+:        +- LogicalAggregate(group=[{0}], cnt2=[COUNT()])
+:           +- LogicalProject(d=[$0])
+:              +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
 +- LogicalProject(cnt1=[$3], cnt2=[$1])
    +- LogicalJoin(condition=[=($0, $2)], joinType=[left])
       :- LogicalAggregate(group=[{0}], cnt2=[COUNT()])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DynamicFilteringTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DynamicFilteringTest.xml
index 6a1c1550a51..57933e6bf34 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DynamicFilteringTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/DynamicFilteringTest.xml
@@ -221,14 +221,15 @@ HashJoin(joinType=[InnerJoin], where=[(p1 = p)], select=[a1, b1, c1, p1, x, y, z
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], x=[$4], y=[$5], z=[$6], p=[$7], a10=[$8], b10=[$9], c10=[$10], p10=[$11])
-+- LogicalJoin(condition=[=($5, $12)], joinType=[inner])
-   :- LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], x=[$4], y=[$5], z=[$6], p=[$7])
-   :  +- LogicalFilter(condition=[AND(=($3, $7), >($4, 10))])
-   :     +- LogicalJoin(condition=[true], joinType=[inner])
-   :        :- LogicalTableScan(table=[[default_catalog, default_database, fact1]])
-   :        +- LogicalTableScan(table=[[default_catalog, default_database, dim]])
-   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], b10=[CAST($1):BIGINT])
-      +- LogicalTableScan(table=[[default_catalog, default_database, fact1]])
++- LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], x=[$4], y=[$5], z=[$6], p=[$7], a10=[$8], b10=[$9], c10=[$10], p10=[$11])
+   +- LogicalJoin(condition=[=($5, $12)], joinType=[inner])
+      :- LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], x=[$4], y=[$5], z=[$6], p=[$7])
+      :  +- LogicalFilter(condition=[AND(=($3, $7), >($4, 10))])
+      :     +- LogicalJoin(condition=[true], joinType=[inner])
+      :        :- LogicalTableScan(table=[[default_catalog, default_database, fact1]])
+      :        +- LogicalTableScan(table=[[default_catalog, default_database, dim]])
+      +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], b10=[CAST($1):BIGINT])
+         +- LogicalTableScan(table=[[default_catalog, default_database, fact1]])
 
 == Optimized Physical Plan ==
 Calc(select=[a1, b1, c1, p1, x, y, z, p, a10, b10, c10, p10])
@@ -380,14 +381,15 @@ Calc(select=[a1, b1, c1, p1, x, y, z, p, a10, b10, c10, p10])
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], x=[$4], y=[$5], z=[$6], p=[$7], a10=[$8], b10=[$9], c10=[$10], p10=[$11])
-+- LogicalJoin(condition=[=($5, $12)], joinType=[inner])
-   :- LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], x=[$4], y=[$5], z=[$6], p=[$7])
-   :  +- LogicalFilter(condition=[AND(=($3, $7), >($4, 10))])
-   :     +- LogicalJoin(condition=[true], joinType=[inner])
-   :        :- LogicalTableScan(table=[[default_catalog, default_database, fact1]])
-   :        +- LogicalTableScan(table=[[default_catalog, default_database, dim]])
-   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], b10=[CAST($1):BIGINT])
-      +- LogicalTableScan(table=[[default_catalog, default_database, fact1]])
++- LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], x=[$4], y=[$5], z=[$6], p=[$7], a10=[$8], b10=[$9], c10=[$10], p10=[$11])
+   +- LogicalJoin(condition=[=($5, $12)], joinType=[inner])
+      :- LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], x=[$4], y=[$5], z=[$6], p=[$7])
+      :  +- LogicalFilter(condition=[AND(=($3, $7), >($4, 10))])
+      :     +- LogicalJoin(condition=[true], joinType=[inner])
+      :        :- LogicalTableScan(table=[[default_catalog, default_database, fact1]])
+      :        +- LogicalTableScan(table=[[default_catalog, default_database, dim]])
+      +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], p1=[$3], b10=[CAST($1):BIGINT])
+         +- LogicalTableScan(table=[[default_catalog, default_database, fact1]])
 
 == Optimized Physical Plan ==
 Calc(select=[a1, b1, c1, p1, x, y, z, p, a10, b10, c10, p10])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/ForwardHashExchangeTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/ForwardHashExchangeTest.xml
index 898426eb39e..24b9307f575 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/ForwardHashExchangeTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/ForwardHashExchangeTest.xml
@@ -26,10 +26,11 @@ SELECT sum(b1) FROM r group by a1]]>
 LogicalProject(EXPR$0=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
    +- LogicalProject(a1=[$0], b1=[$1])
-      +- LogicalFilter(condition=[AND(=($0, $4), LIKE($2, _UTF-16LE'He%'))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+      +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], d2=[$7])
+         +- LogicalFilter(condition=[AND(=($0, $4), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -58,10 +59,11 @@ SELECT sum(b1) FROM r group by a1]]>
 LogicalProject(EXPR$0=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
    +- LogicalProject(a1=[$0], b1=[$1])
-      +- LogicalFilter(condition=[AND(=($0, $4), LIKE($2, _UTF-16LE'He%'))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+      +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], d2=[$7])
+         +- LogicalFilter(condition=[AND(=($0, $4), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -89,9 +91,10 @@ SELECT sum(b1) FROM r]]>
       <![CDATA[
 LogicalAggregate(group=[{}], EXPR$0=[SUM($0)])
 +- LogicalProject(b1=[$1])
-   +- LogicalJoin(condition=[true], joinType=[full])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], d2=[$7])
+      +- LogicalJoin(condition=[true], joinType=[full])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -175,35 +178,38 @@ SELECT * FROM
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
-:- LogicalProject(b=[$5], sd=[$1], sy=[$2], sz=[$3])
-:  +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
-:     :- LogicalAggregate(group=[{0}], sd=[SUM($1)], sy=[SUM($2)], sz=[SUM($3)])
-:     :  +- LogicalProject(b=[$4], d=[$6], ny=[$1], nz=[$2])
-:     :     +- LogicalJoin(condition=[=($0, $6)], joinType=[inner])
-:     :        :- LogicalJoin(condition=[=($0, $3)], joinType=[left])
-:     :        :  :- LogicalProject(a=[$0], ny=[$7], nz=[$11])
-:     :        :  :  +- LogicalJoin(condition=[=($0, $11)], joinType=[left])
-:     :        :  :     :- LogicalJoin(condition=[=($0, $7)], joinType=[left])
-:     :        :  :     :  :- LogicalTableScan(table=[[default_catalog, default_database, x]])
-:     :        :  :     :  +- LogicalTableScan(table=[[default_catalog, default_database, y]])
-:     :        :  :     +- LogicalTableScan(table=[[default_catalog, default_database, z]])
-:     :        :  +- LogicalTableScan(table=[[default_catalog, default_database, t]])
-:     :        +- LogicalTableScan(table=[[default_catalog, default_database, y]])
-:     +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+:- LogicalProject(b=[$0], sd=[$1], sy=[$2], sz=[$3])
+:  +- LogicalProject(b=[$5], sd=[$1], sy=[$2], sz=[$3])
+:     +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
+:        :- LogicalAggregate(group=[{0}], sd=[SUM($1)], sy=[SUM($2)], sz=[SUM($3)])
+:        :  +- LogicalProject(b=[$1], d=[$2], ny=[$3], nz=[$4])
+:        :     +- LogicalProject(a=[$0], b=[$4], d=[$6], ny=[$1], nz=[$2])
+:        :        +- LogicalJoin(condition=[=($0, $6)], joinType=[inner])
+:        :           :- LogicalJoin(condition=[=($0, $3)], joinType=[left])
+:        :           :  :- LogicalProject(a=[$0], ny=[$7], nz=[$11])
+:        :           :  :  +- LogicalJoin(condition=[=($0, $11)], joinType=[left])
+:        :           :  :     :- LogicalJoin(condition=[=($0, $7)], joinType=[left])
+:        :           :  :     :  :- LogicalTableScan(table=[[default_catalog, default_database, x]])
+:        :           :  :     :  +- LogicalTableScan(table=[[default_catalog, default_database, y]])
+:        :           :  :     +- LogicalTableScan(table=[[default_catalog, default_database, z]])
+:        :           :  +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+:        :           +- LogicalTableScan(table=[[default_catalog, default_database, y]])
+:        +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 +- LogicalProject(e=[$5], sd=[$1], sy=[$2], sz=[$3])
    +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
       :- LogicalAggregate(group=[{0}], sd=[SUM($1)], sy=[SUM($2)], sz=[SUM($3)])
-      :  +- LogicalProject(b=[$8], d=[$3], ny=[$1], nz=[$2])
-      :     +- LogicalJoin(condition=[=($0, $7)], joinType=[inner])
-      :        :- LogicalJoin(condition=[=($0, $3)], joinType=[left])
-      :        :  :- LogicalProject(a=[$0], ny=[$7], nz=[$11])
-      :        :  :  +- LogicalJoin(condition=[=($0, $11)], joinType=[left])
-      :        :  :     :- LogicalJoin(condition=[=($0, $7)], joinType=[left])
-      :        :  :     :  :- LogicalTableScan(table=[[default_catalog, default_database, x]])
-      :        :  :     :  +- LogicalTableScan(table=[[default_catalog, default_database, y]])
-      :        :  :     +- LogicalTableScan(table=[[default_catalog, default_database, z]])
-      :        :  +- LogicalTableScan(table=[[default_catalog, default_database, y]])
-      :        +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+      :  +- LogicalProject(b=[$1], d=[$2], ny=[$3], nz=[$4])
+      :     +- LogicalProject(a=[$0], b=[$8], d=[$3], ny=[$1], nz=[$2])
+      :        +- LogicalJoin(condition=[=($0, $7)], joinType=[inner])
+      :           :- LogicalJoin(condition=[=($0, $3)], joinType=[left])
+      :           :  :- LogicalProject(a=[$0], ny=[$7], nz=[$11])
+      :           :  :  +- LogicalJoin(condition=[=($0, $11)], joinType=[left])
+      :           :  :     :- LogicalJoin(condition=[=($0, $7)], joinType=[left])
+      :           :  :     :  :- LogicalTableScan(table=[[default_catalog, default_database, x]])
+      :           :  :     :  +- LogicalTableScan(table=[[default_catalog, default_database, y]])
+      :           :  :     +- LogicalTableScan(table=[[default_catalog, default_database, z]])
+      :           :  +- LogicalTableScan(table=[[default_catalog, default_database, y]])
+      :           +- LogicalTableScan(table=[[default_catalog, default_database, t]])
       +- LogicalTableScan(table=[[default_catalog, default_database, y]])
 ]]>
     </Resource>
@@ -251,10 +257,11 @@ SELECT sum(b1) FROM r group by a1]]>
 LogicalProject(EXPR$0=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
    +- LogicalProject(a1=[$0], b1=[$1])
-      +- LogicalFilter(condition=[AND(=($0, $4), LIKE($2, _UTF-16LE'He%'))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+      +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], d2=[$7])
+         +- LogicalFilter(condition=[AND(=($0, $4), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -613,9 +620,10 @@ SELECT sum(b1) FROM r]]>
       <![CDATA[
 LogicalAggregate(group=[{}], EXPR$0=[SUM($0)])
 +- LogicalProject(b1=[$1])
-   +- LogicalJoin(condition=[true], joinType=[full])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], d2=[$7])
+      +- LogicalJoin(condition=[true], joinType=[full])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -665,10 +673,11 @@ SELECT sum(b1) FROM r group by a1]]>
 LogicalProject(EXPR$0=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
    +- LogicalProject(a1=[$0], b1=[$1])
-      +- LogicalFilter(condition=[AND(=($0, $4), LIKE($2, _UTF-16LE'He%'))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+      +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], d2=[$7])
+         +- LogicalFilter(condition=[AND(=($0, $4), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/LegacySinkTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/LegacySinkTest.xml
index ed2f07c1e2e..386213fa174 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/LegacySinkTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/LegacySinkTest.xml
@@ -43,17 +43,19 @@ LegacySink(name=[`default_catalog`.`default_database`.`sink`], fields=[a])
       <![CDATA[
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`sink1`], fields=[total_sum])
 +- LogicalAggregate(group=[{}], total_sum=[SUM($0)])
-   +- LogicalProject(sum_a=[$1])
-      +- LogicalAggregate(group=[{0}], sum_a=[SUM($1)])
-         +- LogicalProject(c=[$2], a=[$0])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalProject(sum_a=[$0])
+      +- LogicalProject(sum_a=[$1], c=[$0])
+         +- LogicalAggregate(group=[{0}], sum_a=[SUM($1)])
+            +- LogicalProject(c=[$2], a=[$0])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`sink2`], fields=[total_min])
 +- LogicalAggregate(group=[{}], total_min=[MIN($0)])
-   +- LogicalProject(sum_a=[$1])
-      +- LogicalAggregate(group=[{0}], sum_a=[SUM($1)])
-         +- LogicalProject(c=[$2], a=[$0])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalProject(sum_a=[$0])
+      +- LogicalProject(sum_a=[$1], c=[$0])
+         +- LogicalAggregate(group=[{0}], sum_a=[SUM($1)])
+            +- LogicalProject(c=[$2], a=[$0])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/MultipleInputCreationTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/MultipleInputCreationTest.xml
index ec5b58248f6..bae88395aab 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/MultipleInputCreationTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/MultipleInputCreationTest.xml
@@ -164,9 +164,10 @@ LogicalProject(a=[$0])
 +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
    :- LogicalUnion(all=[true])
    :  :- LogicalProject(a=[$0])
-   :  :  +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-   :  :     :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-   :  :     +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   :  :  +- LogicalProject(a=[$0])
+   :  :     +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+   :  :        :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+   :  :        +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
    :  +- LogicalProject(a=[$0])
    :     +- LogicalJoin(condition=[>($0, $3)], joinType=[full])
    :        :- LogicalTableScan(table=[[default_catalog, default_database, t]])
@@ -220,9 +221,10 @@ LogicalProject(a=[$0])
 +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
    :- LogicalUnion(all=[true])
    :  :- LogicalProject(a=[$0])
-   :  :  +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-   :  :     :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-   :  :     +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   :  :  +- LogicalProject(a=[$0])
+   :  :     +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+   :  :        :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+   :  :        +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
    :  +- LogicalProject(a=[$0])
    :     +- LogicalJoin(condition=[>($0, $3)], joinType=[full])
    :        :- LogicalTableScan(table=[[default_catalog, default_database, t]])
@@ -276,9 +278,10 @@ LogicalProject(a=[$0])
 +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
    :- LogicalUnion(all=[true])
    :  :- LogicalProject(a=[$0])
-   :  :  +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-   :  :     :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-   :  :     +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   :  :  +- LogicalProject(a=[$0])
+   :  :     +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+   :  :        :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+   :  :        +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
    :  +- LogicalProject(a=[$0])
    :     +- LogicalJoin(condition=[>($0, $3)], joinType=[full])
    :        :- LogicalTableScan(table=[[default_catalog, default_database, t]])
@@ -327,7 +330,8 @@ LogicalProject(a=[$0], d=[$1], e=[$2], f=[$3], ny=[$4])
 +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
    :- LogicalUnion(all=[true])
    :  :- LogicalProject(a=[$0])
-   :  :  +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+   :  :  +- LogicalProject(a=[$0])
+   :  :     +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
    :  +- LogicalProject(a=[$0])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, t]])
    +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
@@ -360,7 +364,8 @@ LogicalProject(a=[$0], d=[$1], e=[$2], f=[$3], ny=[$4])
 +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
    :- LogicalUnion(all=[true])
    :  :- LogicalProject(a=[$0])
-   :  :  +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+   :  :  +- LogicalProject(a=[$0])
+   :  :     +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
    :  +- LogicalProject(a=[$0])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, t]])
    +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
@@ -393,7 +398,8 @@ LogicalProject(a=[$0], d=[$1], e=[$2], f=[$3], ny=[$4])
 +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
    :- LogicalUnion(all=[true])
    :  :- LogicalProject(a=[$0])
-   :  :  +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+   :  :  +- LogicalProject(a=[$0])
+   :  :     +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
    :  +- LogicalProject(a=[$0])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, t]])
    +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
@@ -506,10 +512,12 @@ SELECT * FROM
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
-:- LogicalProject(a=[$0], EXPR$1=[+($0, 1)])
-:  +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-:     :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-:     +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:- LogicalProject(a=[$0], EXPR$1=[$1])
+:  +- LogicalProject(a=[$0], EXPR$1=[+($0, 1)])
+:     +- LogicalProject(a=[$0])
+:        +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+:           :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 +- LogicalProject(a=[$0], b=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
 ]]>
@@ -544,10 +552,12 @@ SELECT * FROM
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
-:- LogicalProject(a=[$0], EXPR$1=[+($0, 1)])
-:  +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-:     :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-:     +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:- LogicalProject(a=[$0], EXPR$1=[$1])
+:  +- LogicalProject(a=[$0], EXPR$1=[+($0, 1)])
+:     +- LogicalProject(a=[$0])
+:        +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+:           :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 +- LogicalProject(a=[$0], b=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
 ]]>
@@ -582,10 +592,12 @@ SELECT * FROM
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
-:- LogicalProject(a=[$0], EXPR$1=[+($0, 1)])
-:  +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-:     :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-:     +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:- LogicalProject(a=[$0], EXPR$1=[$1])
+:  +- LogicalProject(a=[$0], EXPR$1=[+($0, 1)])
+:     +- LogicalProject(a=[$0])
+:        +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+:           :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 +- LogicalProject(a=[$0], b=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
 ]]>
@@ -867,7 +879,8 @@ LogicalProject(a=[$0], d=[$1], e=[$2], f=[$3], ny=[$4])
 +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
    :- LogicalUnion(all=[true])
    :  :- LogicalProject(a=[$0])
-   :  :  +- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
+   :  :  +- LogicalProject(a=[$0])
+   :  :     +- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
    :  +- LogicalProject(a=[$0])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, t]])
    +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
@@ -898,7 +911,8 @@ LogicalProject(a=[$0], d=[$1], e=[$2], f=[$3], ny=[$4])
 +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
    :- LogicalUnion(all=[true])
    :  :- LogicalProject(a=[$0])
-   :  :  +- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
+   :  :  +- LogicalProject(a=[$0])
+   :  :     +- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
    :  +- LogicalProject(a=[$0])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, t]])
    +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
@@ -929,7 +943,8 @@ LogicalProject(a=[$0], d=[$1], e=[$2], f=[$3], ny=[$4])
 +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
    :- LogicalUnion(all=[true])
    :  :- LogicalProject(a=[$0])
-   :  :  +- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
+   :  :  +- LogicalProject(a=[$0])
+   :  :     +- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
    :  +- LogicalProject(a=[$0])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, t]])
    +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
@@ -963,14 +978,16 @@ LogicalProject(a=[$0], cnt=[$1], d=[$2], sm=[$3])
 +- LogicalJoin(condition=[=($0, $2)], joinType=[left])
    :- LogicalAggregate(group=[{0}], cnt=[COUNT()])
    :  +- LogicalProject(a=[$0])
-   :     +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-   :        :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-   :        +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   :     +- LogicalProject(a=[$0], d=[$4])
+   :        +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
    +- LogicalAggregate(group=[{0}], sm=[SUM($1)])
-      +- LogicalProject(d=[$4], a=[$0])
-         +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+      +- LogicalProject(d=[$1], a=[$0])
+         +- LogicalProject(a=[$0], d=[$4])
+            +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1012,14 +1029,16 @@ LogicalProject(a=[$0], cnt=[$1], d=[$2], sm=[$3])
 +- LogicalJoin(condition=[=($0, $2)], joinType=[left])
    :- LogicalAggregate(group=[{0}], cnt=[COUNT()])
    :  +- LogicalProject(a=[$0])
-   :     +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-   :        :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-   :        +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   :     +- LogicalProject(a=[$0], d=[$4])
+   :        +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
    +- LogicalAggregate(group=[{0}], sm=[SUM($1)])
-      +- LogicalProject(d=[$4], a=[$0])
-         +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+      +- LogicalProject(d=[$1], a=[$0])
+         +- LogicalProject(a=[$0], d=[$4])
+            +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1061,14 +1080,16 @@ LogicalProject(a=[$0], cnt=[$1], d=[$2], sm=[$3])
 +- LogicalJoin(condition=[=($0, $2)], joinType=[left])
    :- LogicalAggregate(group=[{0}], cnt=[COUNT()])
    :  +- LogicalProject(a=[$0])
-   :     +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-   :        :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-   :        +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   :     +- LogicalProject(a=[$0], d=[$4])
+   :        +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
    +- LogicalAggregate(group=[{0}], sm=[SUM($1)])
-      +- LogicalProject(d=[$4], a=[$0])
-         +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+      +- LogicalProject(d=[$1], a=[$0])
+         +- LogicalProject(a=[$0], d=[$4])
+            +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1172,13 +1193,16 @@ SELECT * FROM
       <![CDATA[
 LogicalUnion(all=[true])
 :- LogicalProject(a=[$0])
-:  +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
-:     :- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
-:     +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:  +- LogicalProject(a=[$0])
+:     +- LogicalProject(a=[$0])
+:        +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
+:           :- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
+:           +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
 +- LogicalProject(a=[$0])
-   +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
-      :- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   +- LogicalProject(a=[$0])
+      +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
+         :- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1211,13 +1235,16 @@ SELECT * FROM
       <![CDATA[
 LogicalUnion(all=[true])
 :- LogicalProject(a=[$0])
-:  +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
-:     :- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
-:     +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:  +- LogicalProject(a=[$0])
+:     +- LogicalProject(a=[$0])
+:        +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
+:           :- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
+:           +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
 +- LogicalProject(a=[$0])
-   +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
-      :- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   +- LogicalProject(a=[$0])
+      +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
+         :- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1261,35 +1288,38 @@ SELECT * FROM
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
-:- LogicalProject(b=[$5], sd=[$1], sy=[$2], sz=[$3])
-:  +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
-:     :- LogicalAggregate(group=[{0}], sd=[SUM($1)], sy=[SUM($2)], sz=[SUM($3)])
-:     :  +- LogicalProject(b=[$4], d=[$6], ny=[$1], nz=[$2])
-:     :     +- LogicalJoin(condition=[=($0, $6)], joinType=[inner])
-:     :        :- LogicalJoin(condition=[=($0, $3)], joinType=[left])
-:     :        :  :- LogicalProject(a=[$0], ny=[$7], nz=[$11])
-:     :        :  :  +- LogicalJoin(condition=[=($0, $11)], joinType=[left])
-:     :        :  :     :- LogicalJoin(condition=[=($0, $7)], joinType=[left])
-:     :        :  :     :  :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-:     :        :  :     :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-:     :        :  :     +- LogicalTableScan(table=[[default_catalog, default_database, z, source: [TestTableSource(g, h, i, nz)]]])
-:     :        :  +- LogicalTableScan(table=[[default_catalog, default_database, t]])
-:     :        +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-:     +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+:- LogicalProject(b=[$0], sd=[$1], sy=[$2], sz=[$3])
+:  +- LogicalProject(b=[$5], sd=[$1], sy=[$2], sz=[$3])
+:     +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
+:        :- LogicalAggregate(group=[{0}], sd=[SUM($1)], sy=[SUM($2)], sz=[SUM($3)])
+:        :  +- LogicalProject(b=[$1], d=[$2], ny=[$3], nz=[$4])
+:        :     +- LogicalProject(a=[$0], b=[$4], d=[$6], ny=[$1], nz=[$2])
+:        :        +- LogicalJoin(condition=[=($0, $6)], joinType=[inner])
+:        :           :- LogicalJoin(condition=[=($0, $3)], joinType=[left])
+:        :           :  :- LogicalProject(a=[$0], ny=[$7], nz=[$11])
+:        :           :  :  +- LogicalJoin(condition=[=($0, $11)], joinType=[left])
+:        :           :  :     :- LogicalJoin(condition=[=($0, $7)], joinType=[left])
+:        :           :  :     :  :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:        :           :  :     :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:        :           :  :     +- LogicalTableScan(table=[[default_catalog, default_database, z, source: [TestTableSource(g, h, i, nz)]]])
+:        :           :  +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+:        :           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:        +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 +- LogicalProject(e=[$5], sd=[$1], sy=[$2], sz=[$3])
    +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
       :- LogicalAggregate(group=[{0}], sd=[SUM($1)], sy=[SUM($2)], sz=[SUM($3)])
-      :  +- LogicalProject(b=[$8], d=[$3], ny=[$1], nz=[$2])
-      :     +- LogicalJoin(condition=[=($0, $7)], joinType=[inner])
-      :        :- LogicalJoin(condition=[=($0, $3)], joinType=[left])
-      :        :  :- LogicalProject(a=[$0], ny=[$7], nz=[$11])
-      :        :  :  +- LogicalJoin(condition=[=($0, $11)], joinType=[left])
-      :        :  :     :- LogicalJoin(condition=[=($0, $7)], joinType=[left])
-      :        :  :     :  :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-      :        :  :     :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-      :        :  :     +- LogicalTableScan(table=[[default_catalog, default_database, z, source: [TestTableSource(g, h, i, nz)]]])
-      :        :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-      :        +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+      :  +- LogicalProject(b=[$1], d=[$2], ny=[$3], nz=[$4])
+      :     +- LogicalProject(a=[$0], b=[$8], d=[$3], ny=[$1], nz=[$2])
+      :        +- LogicalJoin(condition=[=($0, $7)], joinType=[inner])
+      :           :- LogicalJoin(condition=[=($0, $3)], joinType=[left])
+      :           :  :- LogicalProject(a=[$0], ny=[$7], nz=[$11])
+      :           :  :  +- LogicalJoin(condition=[=($0, $11)], joinType=[left])
+      :           :  :     :- LogicalJoin(condition=[=($0, $7)], joinType=[left])
+      :           :  :     :  :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+      :           :  :     :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+      :           :  :     +- LogicalTableScan(table=[[default_catalog, default_database, z, source: [TestTableSource(g, h, i, nz)]]])
+      :           :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+      :           +- LogicalTableScan(table=[[default_catalog, default_database, t]])
       +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 ]]>
     </Resource>
@@ -1358,35 +1388,38 @@ SELECT * FROM
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
-:- LogicalProject(b=[$5], sd=[$1], sy=[$2], sz=[$3])
-:  +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
-:     :- LogicalAggregate(group=[{0}], sd=[SUM($1)], sy=[SUM($2)], sz=[SUM($3)])
-:     :  +- LogicalProject(b=[$4], d=[$6], ny=[$1], nz=[$2])
-:     :     +- LogicalJoin(condition=[=($0, $6)], joinType=[inner])
-:     :        :- LogicalJoin(condition=[=($0, $3)], joinType=[left])
-:     :        :  :- LogicalProject(a=[$0], ny=[$7], nz=[$11])
-:     :        :  :  +- LogicalJoin(condition=[=($0, $11)], joinType=[left])
-:     :        :  :     :- LogicalJoin(condition=[=($0, $7)], joinType=[left])
-:     :        :  :     :  :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-:     :        :  :     :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-:     :        :  :     +- LogicalTableScan(table=[[default_catalog, default_database, z, source: [TestTableSource(g, h, i, nz)]]])
-:     :        :  +- LogicalTableScan(table=[[default_catalog, default_database, t]])
-:     :        +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-:     +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+:- LogicalProject(b=[$0], sd=[$1], sy=[$2], sz=[$3])
+:  +- LogicalProject(b=[$5], sd=[$1], sy=[$2], sz=[$3])
+:     +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
+:        :- LogicalAggregate(group=[{0}], sd=[SUM($1)], sy=[SUM($2)], sz=[SUM($3)])
+:        :  +- LogicalProject(b=[$1], d=[$2], ny=[$3], nz=[$4])
+:        :     +- LogicalProject(a=[$0], b=[$4], d=[$6], ny=[$1], nz=[$2])
+:        :        +- LogicalJoin(condition=[=($0, $6)], joinType=[inner])
+:        :           :- LogicalJoin(condition=[=($0, $3)], joinType=[left])
+:        :           :  :- LogicalProject(a=[$0], ny=[$7], nz=[$11])
+:        :           :  :  +- LogicalJoin(condition=[=($0, $11)], joinType=[left])
+:        :           :  :     :- LogicalJoin(condition=[=($0, $7)], joinType=[left])
+:        :           :  :     :  :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:        :           :  :     :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:        :           :  :     +- LogicalTableScan(table=[[default_catalog, default_database, z, source: [TestTableSource(g, h, i, nz)]]])
+:        :           :  +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+:        :           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:        +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 +- LogicalProject(e=[$5], sd=[$1], sy=[$2], sz=[$3])
    +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
       :- LogicalAggregate(group=[{0}], sd=[SUM($1)], sy=[SUM($2)], sz=[SUM($3)])
-      :  +- LogicalProject(b=[$8], d=[$3], ny=[$1], nz=[$2])
-      :     +- LogicalJoin(condition=[=($0, $7)], joinType=[inner])
-      :        :- LogicalJoin(condition=[=($0, $3)], joinType=[left])
-      :        :  :- LogicalProject(a=[$0], ny=[$7], nz=[$11])
-      :        :  :  +- LogicalJoin(condition=[=($0, $11)], joinType=[left])
-      :        :  :     :- LogicalJoin(condition=[=($0, $7)], joinType=[left])
-      :        :  :     :  :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-      :        :  :     :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-      :        :  :     +- LogicalTableScan(table=[[default_catalog, default_database, z, source: [TestTableSource(g, h, i, nz)]]])
-      :        :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-      :        +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+      :  +- LogicalProject(b=[$1], d=[$2], ny=[$3], nz=[$4])
+      :     +- LogicalProject(a=[$0], b=[$8], d=[$3], ny=[$1], nz=[$2])
+      :        +- LogicalJoin(condition=[=($0, $7)], joinType=[inner])
+      :           :- LogicalJoin(condition=[=($0, $3)], joinType=[left])
+      :           :  :- LogicalProject(a=[$0], ny=[$7], nz=[$11])
+      :           :  :  +- LogicalJoin(condition=[=($0, $11)], joinType=[left])
+      :           :  :     :- LogicalJoin(condition=[=($0, $7)], joinType=[left])
+      :           :  :     :  :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+      :           :  :     :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+      :           :  :     +- LogicalTableScan(table=[[default_catalog, default_database, z, source: [TestTableSource(g, h, i, nz)]]])
+      :           :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+      :           +- LogicalTableScan(table=[[default_catalog, default_database, t]])
       +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 ]]>
     </Resource>
@@ -1455,35 +1488,38 @@ SELECT * FROM
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
-:- LogicalProject(b=[$5], sd=[$1], sy=[$2], sz=[$3])
-:  +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
-:     :- LogicalAggregate(group=[{0}], sd=[SUM($1)], sy=[SUM($2)], sz=[SUM($3)])
-:     :  +- LogicalProject(b=[$4], d=[$6], ny=[$1], nz=[$2])
-:     :     +- LogicalJoin(condition=[=($0, $6)], joinType=[inner])
-:     :        :- LogicalJoin(condition=[=($0, $3)], joinType=[left])
-:     :        :  :- LogicalProject(a=[$0], ny=[$7], nz=[$11])
-:     :        :  :  +- LogicalJoin(condition=[=($0, $11)], joinType=[left])
-:     :        :  :     :- LogicalJoin(condition=[=($0, $7)], joinType=[left])
-:     :        :  :     :  :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-:     :        :  :     :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-:     :        :  :     +- LogicalTableScan(table=[[default_catalog, default_database, z, source: [TestTableSource(g, h, i, nz)]]])
-:     :        :  +- LogicalTableScan(table=[[default_catalog, default_database, t]])
-:     :        +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-:     +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+:- LogicalProject(b=[$0], sd=[$1], sy=[$2], sz=[$3])
+:  +- LogicalProject(b=[$5], sd=[$1], sy=[$2], sz=[$3])
+:     +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
+:        :- LogicalAggregate(group=[{0}], sd=[SUM($1)], sy=[SUM($2)], sz=[SUM($3)])
+:        :  +- LogicalProject(b=[$1], d=[$2], ny=[$3], nz=[$4])
+:        :     +- LogicalProject(a=[$0], b=[$4], d=[$6], ny=[$1], nz=[$2])
+:        :        +- LogicalJoin(condition=[=($0, $6)], joinType=[inner])
+:        :           :- LogicalJoin(condition=[=($0, $3)], joinType=[left])
+:        :           :  :- LogicalProject(a=[$0], ny=[$7], nz=[$11])
+:        :           :  :  +- LogicalJoin(condition=[=($0, $11)], joinType=[left])
+:        :           :  :     :- LogicalJoin(condition=[=($0, $7)], joinType=[left])
+:        :           :  :     :  :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:        :           :  :     :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:        :           :  :     +- LogicalTableScan(table=[[default_catalog, default_database, z, source: [TestTableSource(g, h, i, nz)]]])
+:        :           :  +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+:        :           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:        +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 +- LogicalProject(e=[$5], sd=[$1], sy=[$2], sz=[$3])
    +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
       :- LogicalAggregate(group=[{0}], sd=[SUM($1)], sy=[SUM($2)], sz=[SUM($3)])
-      :  +- LogicalProject(b=[$8], d=[$3], ny=[$1], nz=[$2])
-      :     +- LogicalJoin(condition=[=($0, $7)], joinType=[inner])
-      :        :- LogicalJoin(condition=[=($0, $3)], joinType=[left])
-      :        :  :- LogicalProject(a=[$0], ny=[$7], nz=[$11])
-      :        :  :  +- LogicalJoin(condition=[=($0, $11)], joinType=[left])
-      :        :  :     :- LogicalJoin(condition=[=($0, $7)], joinType=[left])
-      :        :  :     :  :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-      :        :  :     :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-      :        :  :     +- LogicalTableScan(table=[[default_catalog, default_database, z, source: [TestTableSource(g, h, i, nz)]]])
-      :        :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-      :        +- LogicalTableScan(table=[[default_catalog, default_database, t]])
+      :  +- LogicalProject(b=[$1], d=[$2], ny=[$3], nz=[$4])
+      :     +- LogicalProject(a=[$0], b=[$8], d=[$3], ny=[$1], nz=[$2])
+      :        +- LogicalJoin(condition=[=($0, $7)], joinType=[inner])
+      :           :- LogicalJoin(condition=[=($0, $3)], joinType=[left])
+      :           :  :- LogicalProject(a=[$0], ny=[$7], nz=[$11])
+      :           :  :  +- LogicalJoin(condition=[=($0, $11)], joinType=[left])
+      :           :  :     :- LogicalJoin(condition=[=($0, $7)], joinType=[left])
+      :           :  :     :  :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+      :           :  :     :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+      :           :  :     +- LogicalTableScan(table=[[default_catalog, default_database, z, source: [TestTableSource(g, h, i, nz)]]])
+      :           :  +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+      :           +- LogicalTableScan(table=[[default_catalog, default_database, t]])
       +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 ]]>
     </Resource>
@@ -1541,18 +1577,21 @@ SELECT * FROM T2 LEFT JOIN t ON T2.a = t.a
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], a0=[$2], b0=[$3], c=[$4])
-+- LogicalJoin(condition=[=($0, $5)], joinType=[left])
-   :- LogicalUnion(all=[true])
-   :  :- LogicalProject(a=[$4], b=[$0])
-   :  :  +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
-   :  :     :- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-   :  :     +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-   :  +- LogicalProject(a=[$1], b=[$0])
-   :     +- LogicalAggregate(group=[{0}], a=[COUNT($1)])
-   :        +- LogicalProject(b=[$1], a=[$0])
-   :           +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], a0=[CAST($0):BIGINT])
-      +- LogicalTableScan(table=[[default_catalog, default_database, t]])
++- LogicalProject(a=[$0], b=[$1], a0=[$2], b0=[$3], c=[$4])
+   +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
+      :- LogicalUnion(all=[true])
+      :  :- LogicalProject(a=[$0], b=[$1])
+      :  :  +- LogicalProject(a=[$0], b=[$1])
+      :  :     +- LogicalProject(a=[$4], b=[$0])
+      :  :        +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
+      :  :           :- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+      :  :           +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+      :  +- LogicalProject(a=[$1], b=[$0])
+      :     +- LogicalAggregate(group=[{0}], a=[COUNT($1)])
+      :        +- LogicalProject(b=[$1], a=[$0])
+      :           +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], a0=[CAST($0):BIGINT])
+         +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1590,13 +1629,16 @@ SELECT * FROM
       <![CDATA[
 LogicalUnion(all=[true])
 :- LogicalProject(a=[$0])
-:  +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
-:     :- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
-:     +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:  +- LogicalProject(a=[$0])
+:     +- LogicalProject(a=[$0])
+:        +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
+:           :- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
+:           +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
 +- LogicalProject(a=[$0])
-   +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
-      :- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   +- LogicalProject(a=[$0])
+      +- LogicalJoin(condition=[=($0, $1)], joinType=[left])
+         :- LogicalTableScan(table=[[default_catalog, default_database, chainable]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1691,10 +1733,12 @@ SELECT * FROM T2 LEFT JOIN t ON T2.a = t.a
 LogicalProject(a=[$0], b=[$1], a0=[$2], b0=[$3], c=[$4])
 +- LogicalJoin(condition=[=($0, $2)], joinType=[left])
    :- LogicalUnion(all=[true])
-   :  :- LogicalProject(a=[$4], b=[$0])
-   :  :  +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
-   :  :     :- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-   :  :     +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+   :  :- LogicalProject(a=[$0], b=[$1])
+   :  :  +- LogicalProject(a=[$0], b=[$1])
+   :  :     +- LogicalProject(a=[$4], b=[$0])
+   :  :        +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
+   :  :           :- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   :  :           +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
    :  +- LogicalProject(a=[$0], b=[$1])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, t]])
@@ -1733,10 +1777,12 @@ SELECT * FROM T2 LEFT JOIN t ON T2.a = t.a
 LogicalProject(a=[$0], b=[$1], a0=[$2], b0=[$3], c=[$4])
 +- LogicalJoin(condition=[=($0, $2)], joinType=[left])
    :- LogicalUnion(all=[true])
-   :  :- LogicalProject(a=[$4], b=[$0])
-   :  :  +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
-   :  :     :- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-   :  :     +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+   :  :- LogicalProject(a=[$0], b=[$1])
+   :  :  +- LogicalProject(a=[$0], b=[$1])
+   :  :     +- LogicalProject(a=[$4], b=[$0])
+   :  :        +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
+   :  :           :- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   :  :           +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
    :  +- LogicalProject(a=[$0], b=[$1])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, t]])
@@ -1776,23 +1822,29 @@ SELECT cnt FROM
 LogicalUnion(all=[true])
 :- LogicalProject(cnt=[$0])
 :  +- LogicalUnion(all=[true])
-:     :- LogicalProject(cnt=[$1])
-:     :  +- LogicalAggregate(group=[{0}], cnt=[COUNT()])
-:     :     +- LogicalProject(a=[$0])
-:     :        +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-:     +- LogicalProject(cnt=[$1])
-:        +- LogicalAggregate(group=[{0}], cnt=[COUNT()])
-:           +- LogicalProject(d=[$0])
-:              +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:     :- LogicalProject(cnt=[$0])
+:     :  +- LogicalProject(cnt=[$0])
+:     :     +- LogicalProject(cnt=[$1])
+:     :        +- LogicalAggregate(group=[{0}], cnt=[COUNT()])
+:     :           +- LogicalProject(a=[$0])
+:     :              +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:     +- LogicalProject(cnt=[$0])
+:        +- LogicalProject(cnt=[$1])
+:           +- LogicalAggregate(group=[{0}], cnt=[COUNT()])
+:              +- LogicalProject(d=[$0])
+:                 +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 +- LogicalUnion(all=[true])
    :- LogicalProject(cnt=[$0])
-   :  +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-   :     :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-   +- LogicalProject(cnt=[$1])
-      +- LogicalJoin(condition=[=($1, $5)], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   :  +- LogicalProject(cnt=[$0])
+   :     +- LogicalProject(cnt=[$0])
+   :        +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   +- LogicalProject(cnt=[$0])
+      +- LogicalProject(cnt=[$1])
+         +- LogicalJoin(condition=[=($1, $5)], joinType=[inner])
+            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1843,10 +1895,12 @@ SELECT * FROM T2 LEFT JOIN t ON T2.a = t.a
 LogicalProject(a=[$0], b=[$1], a0=[$2], b0=[$3], c=[$4])
 +- LogicalJoin(condition=[=($0, $2)], joinType=[left])
    :- LogicalUnion(all=[true])
-   :  :- LogicalProject(a=[$4], b=[$0])
-   :  :  +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
-   :  :     :- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-   :  :     +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+   :  :- LogicalProject(a=[$0], b=[$1])
+   :  :  +- LogicalProject(a=[$0], b=[$1])
+   :  :     +- LogicalProject(a=[$4], b=[$0])
+   :  :        +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
+   :  :           :- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   :  :           +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
    :  +- LogicalProject(a=[$0], b=[$1])
    :     +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, t]])
@@ -1883,18 +1937,21 @@ SELECT * FROM T2 LEFT JOIN t ON T2.a = t.a
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], a0=[$2], b0=[$3], c=[$4])
-+- LogicalJoin(condition=[=($0, $5)], joinType=[left])
-   :- LogicalUnion(all=[true])
-   :  :- LogicalProject(a=[$4], b=[$0])
-   :  :  +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
-   :  :     :- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-   :  :     +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-   :  +- LogicalProject(a=[$1], b=[$0])
-   :     +- LogicalAggregate(group=[{0}], a=[COUNT($1)])
-   :        +- LogicalProject(b=[$1], a=[$0])
-   :           +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], a0=[CAST($0):BIGINT])
-      +- LogicalTableScan(table=[[default_catalog, default_database, t]])
++- LogicalProject(a=[$0], b=[$1], a0=[$2], b0=[$3], c=[$4])
+   +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
+      :- LogicalUnion(all=[true])
+      :  :- LogicalProject(a=[$0], b=[$1])
+      :  :  +- LogicalProject(a=[$0], b=[$1])
+      :  :     +- LogicalProject(a=[$4], b=[$0])
+      :  :        +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
+      :  :           :- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+      :  :           +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+      :  +- LogicalProject(a=[$1], b=[$0])
+      :     +- LogicalAggregate(group=[{0}], a=[COUNT($1)])
+      :        +- LogicalProject(b=[$1], a=[$0])
+      :           +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], a0=[CAST($0):BIGINT])
+         +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1931,16 +1988,19 @@ SELECT * FROM
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
-:- LogicalProject(a=[$0], b=[$2])
-:  +- LogicalJoin(condition=[=($1, $2)], joinType=[left])
-:     :- LogicalProject(a=[$0], a0=[CAST($0):BIGINT])
-:     :  +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-:     :     :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-:     :     +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-:     +- LogicalProject(b=[$1])
-:        +- LogicalJoin(condition=[=($1, $5)], joinType=[inner])
-:           :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-:           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:- LogicalProject(a=[$0], b=[$1])
+:  +- LogicalProject(a=[$0], b=[$1])
+:     +- LogicalProject(a=[$0], b=[$2])
+:        +- LogicalJoin(condition=[=($1, $2)], joinType=[left])
+:           :- LogicalProject(a=[$0], a0=[CAST($0):BIGINT])
+:           :  +- LogicalProject(a=[$0])
+:           :     +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+:           :        :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:           :        +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:           +- LogicalProject(b=[$1])
+:              +- LogicalJoin(condition=[=($1, $5)], joinType=[inner])
+:                 :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:                 +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 +- LogicalProject(a=[$0], b=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
 ]]>
@@ -1986,18 +2046,21 @@ SELECT * FROM T2 LEFT JOIN t ON T2.a = t.a
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], a0=[$2], b0=[$3], c=[$4])
-+- LogicalJoin(condition=[=($0, $5)], joinType=[left])
-   :- LogicalUnion(all=[true])
-   :  :- LogicalProject(a=[$4], b=[$0])
-   :  :  +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
-   :  :     :- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-   :  :     +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-   :  +- LogicalProject(a=[$1], b=[$0])
-   :     +- LogicalAggregate(group=[{0}], a=[COUNT($1)])
-   :        +- LogicalProject(b=[$1], a=[$0])
-   :           +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-   +- LogicalProject(a=[$0], b=[$1], c=[$2], a0=[CAST($0):BIGINT])
-      +- LogicalTableScan(table=[[default_catalog, default_database, t]])
++- LogicalProject(a=[$0], b=[$1], a0=[$2], b0=[$3], c=[$4])
+   +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
+      :- LogicalUnion(all=[true])
+      :  :- LogicalProject(a=[$0], b=[$1])
+      :  :  +- LogicalProject(a=[$0], b=[$1])
+      :  :     +- LogicalProject(a=[$4], b=[$0])
+      :  :        +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
+      :  :           :- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+      :  :           +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+      :  +- LogicalProject(a=[$1], b=[$0])
+      :     +- LogicalAggregate(group=[{0}], a=[COUNT($1)])
+      :        +- LogicalProject(b=[$1], a=[$0])
+      :           +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], a0=[CAST($0):BIGINT])
+         +- LogicalTableScan(table=[[default_catalog, default_database, t]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -2034,16 +2097,19 @@ SELECT * FROM
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
-:- LogicalProject(a=[$0], b=[$2])
-:  +- LogicalJoin(condition=[=($1, $2)], joinType=[left])
-:     :- LogicalProject(a=[$0], a0=[CAST($0):BIGINT])
-:     :  +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-:     :     :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-:     :     +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-:     +- LogicalProject(b=[$1])
-:        +- LogicalJoin(condition=[=($1, $5)], joinType=[inner])
-:           :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-:           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:- LogicalProject(a=[$0], b=[$1])
+:  +- LogicalProject(a=[$0], b=[$1])
+:     +- LogicalProject(a=[$0], b=[$2])
+:        +- LogicalJoin(condition=[=($1, $2)], joinType=[left])
+:           :- LogicalProject(a=[$0], a0=[CAST($0):BIGINT])
+:           :  +- LogicalProject(a=[$0])
+:           :     +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+:           :        :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:           :        +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:           +- LogicalProject(b=[$1])
+:              +- LogicalJoin(condition=[=($1, $5)], joinType=[inner])
+:                 :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:                 +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 +- LogicalProject(a=[$0], b=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
 ]]>
@@ -2092,23 +2158,29 @@ SELECT cnt FROM
 LogicalUnion(all=[true])
 :- LogicalProject(cnt=[$0])
 :  +- LogicalUnion(all=[true])
-:     :- LogicalProject(cnt=[$1])
-:     :  +- LogicalAggregate(group=[{0}], cnt=[COUNT()])
-:     :     +- LogicalProject(a=[$0])
-:     :        +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-:     +- LogicalProject(cnt=[$1])
-:        +- LogicalAggregate(group=[{0}], cnt=[COUNT()])
-:           +- LogicalProject(d=[$0])
-:              +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:     :- LogicalProject(cnt=[$0])
+:     :  +- LogicalProject(cnt=[$0])
+:     :     +- LogicalProject(cnt=[$1])
+:     :        +- LogicalAggregate(group=[{0}], cnt=[COUNT()])
+:     :           +- LogicalProject(a=[$0])
+:     :              +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:     +- LogicalProject(cnt=[$0])
+:        +- LogicalProject(cnt=[$1])
+:           +- LogicalAggregate(group=[{0}], cnt=[COUNT()])
+:              +- LogicalProject(d=[$0])
+:                 +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 +- LogicalUnion(all=[true])
    :- LogicalProject(cnt=[$0])
-   :  +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-   :     :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-   +- LogicalProject(cnt=[$1])
-      +- LogicalJoin(condition=[=($1, $5)], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   :  +- LogicalProject(cnt=[$0])
+   :     +- LogicalProject(cnt=[$0])
+   :        +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   +- LogicalProject(cnt=[$0])
+      +- LogicalProject(cnt=[$1])
+         +- LogicalJoin(condition=[=($1, $5)], joinType=[inner])
+            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -2156,16 +2228,19 @@ SELECT * FROM
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
-:- LogicalProject(a=[$0], b=[$2])
-:  +- LogicalJoin(condition=[=($1, $2)], joinType=[left])
-:     :- LogicalProject(a=[$0], a0=[CAST($0):BIGINT])
-:     :  +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-:     :     :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-:     :     +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-:     +- LogicalProject(b=[$1])
-:        +- LogicalJoin(condition=[=($1, $5)], joinType=[inner])
-:           :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-:           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:- LogicalProject(a=[$0], b=[$1])
+:  +- LogicalProject(a=[$0], b=[$1])
+:     +- LogicalProject(a=[$0], b=[$2])
+:        +- LogicalJoin(condition=[=($1, $2)], joinType=[left])
+:           :- LogicalProject(a=[$0], a0=[CAST($0):BIGINT])
+:           :  +- LogicalProject(a=[$0])
+:           :     +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+:           :        :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:           :        +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:           +- LogicalProject(b=[$1])
+:              +- LogicalJoin(condition=[=($1, $5)], joinType=[inner])
+:                 :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:                 +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 +- LogicalProject(a=[$0], b=[$1])
    +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
 ]]>
@@ -2214,23 +2289,29 @@ SELECT cnt FROM
 LogicalUnion(all=[true])
 :- LogicalProject(cnt=[$0])
 :  +- LogicalUnion(all=[true])
-:     :- LogicalProject(cnt=[$1])
-:     :  +- LogicalAggregate(group=[{0}], cnt=[COUNT()])
-:     :     +- LogicalProject(a=[$0])
-:     :        +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-:     +- LogicalProject(cnt=[$1])
-:        +- LogicalAggregate(group=[{0}], cnt=[COUNT()])
-:           +- LogicalProject(d=[$0])
-:              +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+:     :- LogicalProject(cnt=[$0])
+:     :  +- LogicalProject(cnt=[$0])
+:     :     +- LogicalProject(cnt=[$1])
+:     :        +- LogicalAggregate(group=[{0}], cnt=[COUNT()])
+:     :           +- LogicalProject(a=[$0])
+:     :              +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+:     +- LogicalProject(cnt=[$0])
+:        +- LogicalProject(cnt=[$1])
+:           +- LogicalAggregate(group=[{0}], cnt=[COUNT()])
+:              +- LogicalProject(d=[$0])
+:                 +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 +- LogicalUnion(all=[true])
    :- LogicalProject(cnt=[$0])
-   :  +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
-   :     :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
-   +- LogicalProject(cnt=[$1])
-      +- LogicalJoin(condition=[=($1, $5)], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   :  +- LogicalProject(cnt=[$0])
+   :     +- LogicalProject(cnt=[$0])
+   :        +- LogicalJoin(condition=[=($0, $4)], joinType=[inner])
+   :           :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+   :           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
+   +- LogicalProject(cnt=[$0])
+      +- LogicalProject(cnt=[$1])
+         +- LogicalJoin(condition=[=($1, $5)], joinType=[inner])
+            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c, nx)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f, ny)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RankTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RankTest.xml
index 58dbad5526a..1f15f4a1f2a 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RankTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RankTest.xml
@@ -346,12 +346,13 @@ FROM
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(url=[CONCAT(_UTF-16LE'http://txmov2.a.yximgs.com', $0)], download_count=[$1], timestamp=[$2])
-+- LogicalFilter(condition=[<=($3, 100000)])
-   +- LogicalProject(uri=[$0], reqcount=[$1], start_time=[$2], rownum_2=[RANK() OVER (PARTITION BY $2 ORDER BY $1 DESC NULLS LAST)])
-      +- LogicalFilter(condition=[<=($3, 100000)])
-         +- LogicalProject(uri=[$0], reqcount=[$1], start_time=[$2], rownum_1=[RANK() OVER (PARTITION BY $2, $3 ORDER BY $1 DESC NULLS LAST)])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+LogicalProject(url=[CONCAT(_UTF-16LE'http://txmov2.a.yximgs.com', $0)], download_count=[$1], timestamp=[$3])
++- LogicalProject(uri=[$0], reqcount=[$1], rownum_2=[$3], start_time=[$2])
+   +- LogicalFilter(condition=[<=($3, 100000)])
+      +- LogicalProject(uri=[$0], reqcount=[$1], start_time=[$2], rownum_2=[RANK() OVER (PARTITION BY $2 ORDER BY $1 DESC NULLS LAST)])
+         +- LogicalFilter(condition=[<=($3, 100000)])
+            +- LogicalProject(uri=[$0], reqcount=[$1], start_time=[$2], rownum_1=[RANK() OVER (PARTITION BY $2, $3 ORDER BY $1 DESC NULLS LAST)])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RemoveCollationTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RemoveCollationTest.xml
index 6f394a947c8..b7cb75e2f9a 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RemoveCollationTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RemoveCollationTest.xml
@@ -28,10 +28,11 @@ SELECT sum(b) FROM r group by a
 LogicalProject(EXPR$0=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
    +- LogicalProject(a=[$0], b=[$1])
-      +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+         +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -63,10 +64,11 @@ SELECT sum(b) FROM r group by d
 LogicalProject(EXPR$0=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
    +- LogicalProject(d=[$3], b=[$1])
-      +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+         +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -348,21 +350,23 @@ LogicalProject(id=[$0], tb2_ids=[$2], tb3_ids=[$3], name=[$4], tb2_names=[$6], t
    :  :  :- LogicalJoin(condition=[=($0, $5)], joinType=[left])
    :  :  :  :- LogicalTableScan(table=[[default_catalog, default_database, tb1, source: [TestTableSource(id, key, tb2_ids, tb3_ids, name)]]])
    :  :  :  +- LogicalAggregate(group=[{0}], tb2_names=[LISTAGG($1, $2)])
-   :  :  :     +- LogicalProject(tb1_id=[$0], tb2_name=[$3], $f2=[_UTF-16LE','])
-   :  :  :        +- LogicalJoin(condition=[=($1, $2)], joinType=[left])
-   :  :  :           :- LogicalProject(id=[$0], tb2_id=[$5])
-   :  :  :           :  +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
-   :  :  :           :     :- LogicalTableScan(table=[[default_catalog, default_database, tb1, source: [TestTableSource(id, key, tb2_ids, tb3_ids, name)]]])
-   :  :  :           :     +- LogicalTableFunctionScan(invocation=[split($cor0.tb2_ids)], rowType=[RecordType(VARCHAR(2147483647) f0)], elementType=[class [Ljava.lang.Object;])
-   :  :  :           +- LogicalTableScan(table=[[default_catalog, default_database, tb2, source: [TestTableSource(id, name)]]])
+   :  :  :     +- LogicalProject(tb1_id=[$0], tb2_name=[$1], $f2=[_UTF-16LE','])
+   :  :  :        +- LogicalProject(tb1_id=[$0], tb2_name=[$3])
+   :  :  :           +- LogicalJoin(condition=[=($1, $2)], joinType=[left])
+   :  :  :              :- LogicalProject(id=[$0], tb2_id=[$5])
+   :  :  :              :  +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
+   :  :  :              :     :- LogicalTableScan(table=[[default_catalog, default_database, tb1, source: [TestTableSource(id, key, tb2_ids, tb3_ids, name)]]])
+   :  :  :              :     +- LogicalTableFunctionScan(invocation=[split($cor0.tb2_ids)], rowType=[RecordType(VARCHAR(2147483647) f0)], elementType=[class [Ljava.lang.Object;])
+   :  :  :              +- LogicalTableScan(table=[[default_catalog, default_database, tb2, source: [TestTableSource(id, name)]]])
    :  :  +- LogicalAggregate(group=[{0}], tb3_names=[LISTAGG($1, $2)])
-   :  :     +- LogicalProject(tb1_id=[$0], tb3_name=[$3], $f2=[_UTF-16LE','])
-   :  :        +- LogicalJoin(condition=[=($1, $2)], joinType=[left])
-   :  :           :- LogicalProject(id=[$0], tb3_id=[$5])
-   :  :           :  +- LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{3}])
-   :  :           :     :- LogicalTableScan(table=[[default_catalog, default_database, tb1, source: [TestTableSource(id, key, tb2_ids, tb3_ids, name)]]])
-   :  :           :     +- LogicalTableFunctionScan(invocation=[split($cor1.tb3_ids)], rowType=[RecordType(VARCHAR(2147483647) f0)], elementType=[class [Ljava.lang.Object;])
-   :  :           +- LogicalTableScan(table=[[default_catalog, default_database, tb3, source: [TestTableSource(id, name)]]])
+   :  :     +- LogicalProject(tb1_id=[$0], tb3_name=[$1], $f2=[_UTF-16LE','])
+   :  :        +- LogicalProject(tb1_id=[$0], tb3_name=[$3])
+   :  :           +- LogicalJoin(condition=[=($1, $2)], joinType=[left])
+   :  :              :- LogicalProject(id=[$0], tb3_id=[$5])
+   :  :              :  +- LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{3}])
+   :  :              :     :- LogicalTableScan(table=[[default_catalog, default_database, tb1, source: [TestTableSource(id, key, tb2_ids, tb3_ids, name)]]])
+   :  :              :     +- LogicalTableFunctionScan(invocation=[split($cor1.tb3_ids)], rowType=[RecordType(VARCHAR(2147483647) f0)], elementType=[class [Ljava.lang.Object;])
+   :  :              +- LogicalTableScan(table=[[default_catalog, default_database, tb3, source: [TestTableSource(id, name)]]])
    :  +- LogicalTableScan(table=[[default_catalog, default_database, tb4, source: [TestTableSource(id, name)]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, tb5, source: [TestTableSource(id, name)]]])
 ]]>
@@ -553,9 +557,10 @@ SELECT a, SUM(b) FROM (
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
 +- LogicalProject(a=[$0], b=[$1])
-   +- LogicalFilter(condition=[<=($2, 10)])
-      +- LogicalProject(a=[$0], b=[$1], rk=[RANK() OVER (PARTITION BY $0 ORDER BY $1 NULLS FIRST)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a=[$0], b=[$1], rk=[$2])
+      +- LogicalFilter(condition=[<=($2, 10)])
+         +- LogicalProject(a=[$0], b=[$1], rk=[RANK() OVER (PARTITION BY $0 ORDER BY $1 NULLS FIRST)])
+            +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -588,9 +593,10 @@ SELECT a, b, MAX(c) FROM (
       <![CDATA[
 LogicalAggregate(group=[{0, 1}], EXPR$2=[MAX($2)])
 +- LogicalProject(a=[$0], b=[$1], c=[$2])
-   +- LogicalFilter(condition=[<=($3, 10)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], rk=[RANK() OVER (PARTITION BY $0 ORDER BY $1 NULLS FIRST)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], rk=[$3])
+      +- LogicalFilter(condition=[<=($3, 10)])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], rk=[RANK() OVER (PARTITION BY $0 ORDER BY $1 NULLS FIRST)])
+            +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -623,7 +629,8 @@ SELECT * FROM (
 LogicalProject(a=[$0], b=[$1], c=[$2], rk=[$3])
 +- LogicalFilter(condition=[<=($3, 10)])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], rk=[RANK() OVER (PARTITION BY $0 ORDER BY $1 NULLS FIRST)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2])
+         +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -689,9 +696,10 @@ SELECT COUNT(a), SUM(b) FROM (
       <![CDATA[
 LogicalAggregate(group=[{}], EXPR$0=[COUNT($0)], EXPR$1=[SUM($1)])
 +- LogicalProject(a=[$0], b=[$1])
-   +- LogicalFilter(condition=[<=($2, 10)])
-      +- LogicalProject(a=[$0], b=[$1], rk=[RANK() OVER (ORDER BY $1 NULLS FIRST)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a=[$0], b=[$1], rk=[$2])
+      +- LogicalFilter(condition=[<=($2, 10)])
+         +- LogicalProject(a=[$0], b=[$1], rk=[RANK() OVER (ORDER BY $1 NULLS FIRST)])
+            +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RemoveShuffleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RemoveShuffleTest.xml
index f0ad7df8cfe..9b5170ca2de 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RemoveShuffleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/RemoveShuffleTest.xml
@@ -205,10 +205,11 @@ SELECT sum(b) FROM r group by a
 LogicalProject(EXPR$0=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
    +- LogicalProject(a=[$0], b=[$1])
-      +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+         +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -240,10 +241,11 @@ SELECT sum(b) FROM r group by a, d
 LogicalProject(EXPR$0=[$2])
 +- LogicalAggregate(group=[{0, 1}], EXPR$0=[SUM($2)])
    +- LogicalProject(a=[$0], d=[$3], b=[$1])
-      +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+         +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -273,10 +275,11 @@ SELECT sum(b) FROM r group by d
 LogicalProject(EXPR$0=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
    +- LogicalProject(d=[$3], b=[$1])
-      +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+         +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -730,9 +733,10 @@ SELECT a, SUM(b) FROM (
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
 +- LogicalProject(a=[$0], b=[$1])
-   +- LogicalFilter(condition=[<=($3, 10)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], rk=[RANK() OVER (PARTITION BY $0, $2 ORDER BY $1 NULLS FIRST)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], rk=[$3])
+      +- LogicalFilter(condition=[<=($3, 10)])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], rk=[RANK() OVER (PARTITION BY $0, $2 ORDER BY $1 NULLS FIRST)])
+            +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -919,10 +923,11 @@ SELECT sum(b) FROM r group by a
 LogicalProject(EXPR$0=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
    +- LogicalProject(a=[$0], b=[$1])
-      +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+         +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -956,10 +961,11 @@ SELECT sum(b) FROM r group by a, d
 LogicalProject(EXPR$0=[$2])
 +- LogicalAggregate(group=[{0, 1}], EXPR$0=[SUM($2)])
    +- LogicalProject(a=[$0], d=[$3], b=[$1])
-      +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+         +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -991,10 +997,11 @@ SELECT sum(b) FROM r group by d
 LogicalProject(EXPR$0=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
    +- LogicalProject(d=[$3], b=[$1])
-      +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+         +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableScanTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableScanTest.xml
index a3989cbbbfe..9446dc78fe9 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableScanTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableScanTest.xml
@@ -40,8 +40,9 @@ Calc(select=[ts, a, b], where=[(a > 1)])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[+($0, 1)], d=[TO_TIMESTAMP($1)], e=[my_udf($0)])
-+- LogicalTableScan(table=[[default_catalog, default_database, computed_column_t]])
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
++- LogicalProject(a=[$0], b=[$1], c=[+($0, 1)], d=[TO_TIMESTAMP($1)], e=[my_udf($0)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, computed_column_t]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -57,8 +58,9 @@ Calc(select=[a, b, (a + 1) AS c, TO_TIMESTAMP(b) AS d, my_udf(a) AS e])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[+($0, 1)], d=[TO_TIMESTAMP($1)], e=[my_udf($0)], ptime=[PROCTIME()])
-+- LogicalTableScan(table=[[default_catalog, default_database, proctime_t]])
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], ptime=[$5])
++- LogicalProject(a=[$0], b=[$1], c=[+($0, 1)], d=[TO_TIMESTAMP($1)], e=[my_udf($0)], ptime=[PROCTIME()])
+   +- LogicalTableScan(table=[[default_catalog, default_database, proctime_t]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -74,8 +76,9 @@ Calc(select=[a, b, (a + 1) AS c, TO_TIMESTAMP(b) AS d, my_udf(a) AS e, PROCTIME_
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[+($0, 1)], d=[TO_TIMESTAMP($1)], e=[my_udf($0)])
-+- LogicalTableScan(table=[[default_catalog, default_database, c_watermark_t]])
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
++- LogicalProject(a=[$0], b=[$1], c=[+($0, 1)], d=[TO_TIMESTAMP($1)], e=[my_udf($0)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, c_watermark_t]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableSinkTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableSinkTest.xml
index a7bdaeef54a..a2ee2013686 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableSinkTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableSinkTest.xml
@@ -80,17 +80,19 @@ Sink(table=[default_catalog.default_database.sink], fields=[cnt])
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink1], fields=[total_sum])
 +- LogicalAggregate(group=[{}], total_sum=[SUM($0)])
-   +- LogicalProject(sum_a=[$1])
-      +- LogicalAggregate(group=[{0}], sum_a=[SUM($1)])
-         +- LogicalProject(c=[$2], a=[$0])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalProject(sum_a=[$0])
+      +- LogicalProject(sum_a=[$1], c=[$0])
+         +- LogicalAggregate(group=[{0}], sum_a=[SUM($1)])
+            +- LogicalProject(c=[$2], a=[$0])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 
 LogicalSink(table=[default_catalog.default_database.sink2], fields=[total_min])
 +- LogicalAggregate(group=[{}], total_min=[MIN($0)])
-   +- LogicalProject(sum_a=[$1])
-      +- LogicalAggregate(group=[{0}], sum_a=[SUM($1)])
-         +- LogicalProject(c=[$2], a=[$0])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalProject(sum_a=[$0])
+      +- LogicalProject(sum_a=[$1], c=[$0])
+         +- LogicalAggregate(group=[{0}], sum_a=[SUM($1)])
+            +- LogicalProject(c=[$2], a=[$0])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableSourceTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableSourceTest.xml
index c7321c882d1..556f880e2f1 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableSourceTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/TableSourceTest.xml
@@ -108,7 +108,8 @@ FROM T
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.nested2.num), $2)])
-+- LogicalTableScan(table=[[default_catalog, default_database, T]])
++- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/ValuesTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/ValuesTest.xml
index 9939abb1e62..943b60bc496 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/ValuesTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/ValuesTest.xml
@@ -23,11 +23,12 @@ limitations under the License.
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1]), rowType=[RecordType(INTEGER a, DECIMAL(20, 1) b)]
-+- LogicalUnion(all=[true]), rowType=[RecordType(INTEGER EXPR$0, DECIMAL(20, 1) EXPR$1)]
-   :- LogicalProject(EXPR$0=[1], EXPR$1=[2.0:DECIMAL(2, 1)]), rowType=[RecordType(INTEGER EXPR$0, DECIMAL(2, 1) EXPR$1)]
-   :  +- LogicalValues(tuples=[[{ 0 }]]), rowType=[RecordType(INTEGER ZERO)]
-   +- LogicalProject(EXPR$0=[3], EXPR$1=[4:BIGINT]), rowType=[RecordType(INTEGER EXPR$0, BIGINT EXPR$1)]
-      +- LogicalValues(tuples=[[{ 0 }]]), rowType=[RecordType(INTEGER ZERO)]
++- LogicalProject(a=[$0], b=[$1]), rowType=[RecordType(INTEGER a, DECIMAL(20, 1) b)]
+   +- LogicalUnion(all=[true]), rowType=[RecordType(INTEGER EXPR$0, DECIMAL(20, 1) EXPR$1)]
+      :- LogicalProject(EXPR$0=[1], EXPR$1=[2.0:DECIMAL(2, 1)]), rowType=[RecordType(INTEGER EXPR$0, DECIMAL(2, 1) EXPR$1)]
+      :  +- LogicalValues(tuples=[[{ 0 }]]), rowType=[RecordType(INTEGER ZERO)]
+      +- LogicalProject(EXPR$0=[3], EXPR$1=[4:BIGINT]), rowType=[RecordType(INTEGER EXPR$0, BIGINT EXPR$1)]
+         +- LogicalValues(tuples=[[{ 0 }]]), rowType=[RecordType(INTEGER ZERO)]
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -81,13 +82,14 @@ Values(tuples=[[{ 1, 2, 3 }]], values=[a, b, c])
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1])
-+- LogicalUnion(all=[true])
-   :- LogicalProject(EXPR$0=[1], EXPR$1=[2])
-   :  +- LogicalValues(tuples=[[{ 0 }]])
-   :- LogicalProject(EXPR$0=[3], EXPR$1=[null:INTEGER])
-   :  +- LogicalValues(tuples=[[{ 0 }]])
-   +- LogicalProject(EXPR$0=[4], EXPR$1=[5])
-      +- LogicalValues(tuples=[[{ 0 }]])
++- LogicalProject(a=[$0], b=[$1])
+   +- LogicalUnion(all=[true])
+      :- LogicalProject(EXPR$0=[1], EXPR$1=[2])
+      :  +- LogicalValues(tuples=[[{ 0 }]])
+      :- LogicalProject(EXPR$0=[3], EXPR$1=[null:INTEGER])
+      :  +- LogicalValues(tuples=[[{ 0 }]])
+      +- LogicalProject(EXPR$0=[4], EXPR$1=[5])
+         +- LogicalValues(tuples=[[{ 0 }]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -108,8 +110,9 @@ Union(all=[true], union=[EXPR$0, EXPR$1])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[null:INTEGER])
-+- LogicalValues(tuples=[[{ 0 }]])
+LogicalProject(EXPR$0=[$0])
++- LogicalProject(EXPR$0=[null:INTEGER])
+   +- LogicalValues(tuples=[[{ 0 }]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/AggregateReduceGroupingTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/AggregateReduceGroupingTest.xml
index ca504fdc51e..855646fe424 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/AggregateReduceGroupingTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/AggregateReduceGroupingTest.xml
@@ -24,9 +24,10 @@ limitations under the License.
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a1=[$0], b1=[$1], a2=[$4], b2=[$5], c1=[$2])
-   +- LogicalJoin(condition=[=($0, $5)], joinType=[full])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6])
+      +- LogicalJoin(condition=[=($0, $5)], joinType=[full])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -52,9 +53,10 @@ Calc(select=[a1, b1, a2, b2, EXPR$4])
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a1=[$0], b1=[$1], a3=[$4], b3=[$5], c1=[$2])
-   +- LogicalJoin(condition=[=($0, $4)], joinType=[full])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a3=[$4], b3=[$5], c3=[$6], d3=[$7])
+      +- LogicalJoin(condition=[=($0, $4)], joinType=[full])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -81,10 +83,11 @@ Calc(select=[a1, b1, a3, b3, EXPR$4])
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a1=[$0], b1=[$1], a2=[$4], b2=[$5], c1=[$2])
-   +- LogicalFilter(condition=[=($0, $5)])
-      +- LogicalJoin(condition=[true], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6])
+      +- LogicalFilter(condition=[=($0, $5)])
+         +- LogicalJoin(condition=[true], joinType=[inner])
+            :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -109,10 +112,11 @@ HashAggregate(isMerge=[false], groupBy=[a1], auxGrouping=[b1, a2, b2], select=[a
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)], EXPR$5=[AVG($5)])
 +- LogicalProject(a2=[$0], b2=[$1], a3=[$3], b3=[$4], c2=[$2], d3=[$6])
-   +- LogicalFilter(condition=[=($1, $3)])
-      +- LogicalJoin(condition=[true], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+   +- LogicalProject(a2=[$0], b2=[$1], c2=[$2], a3=[$3], b3=[$4], c3=[$5], d3=[$6])
+      +- LogicalFilter(condition=[=($1, $3)])
+         +- LogicalJoin(condition=[true], joinType=[inner])
+            :- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -137,12 +141,13 @@ Calc(select=[a2, b2, a3, b3, EXPR$4, EXPR$5])
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3, 4, 5}], EXPR$6=[COUNT($6)])
 +- LogicalProject(a1=[$0], b1=[$1], a2=[$4], b2=[$5], a3=[$7], b3=[$8], c1=[$2])
-   +- LogicalFilter(condition=[AND(=($0, $5), =($0, $7))])
-      +- LogicalJoin(condition=[true], joinType=[inner])
-         :- LogicalJoin(condition=[true], joinType=[inner])
-         :  :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-         :  +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], a3=[$7], b3=[$8], c3=[$9], d3=[$10])
+      +- LogicalFilter(condition=[AND(=($0, $5), =($0, $7))])
+         +- LogicalJoin(condition=[true], joinType=[inner])
+            :- LogicalJoin(condition=[true], joinType=[inner])
+            :  :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+            :  +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -172,9 +177,10 @@ Calc(select=[a1, b1, a2, b2, a3, b3, ($f4 * $f2) AS $f8])
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a1=[$0], b1=[$1], a2=[$4], b2=[$5], c1=[$2])
-   +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6])
+      +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -199,9 +205,10 @@ HashAggregate(isMerge=[false], groupBy=[a1], auxGrouping=[b1, a2, b2], select=[a
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a1=[$0], b1=[$1], a3=[$4], b3=[$5], c1=[$2])
-   +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a3=[$4], b3=[$5], c3=[$6], d3=[$7])
+      +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -227,9 +234,10 @@ Calc(select=[a1, b1, a3, b3, EXPR$4])
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a3=[$0], b3=[$1], a1=[$4], b1=[$5], c1=[$6])
-   +- LogicalJoin(condition=[=($4, $0)], joinType=[left])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+   +- LogicalProject(a3=[$0], b3=[$1], c3=[$2], d3=[$3], a1=[$4], b1=[$5], c1=[$6], d1=[$7])
+      +- LogicalJoin(condition=[=($4, $0)], joinType=[left])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -253,8 +261,9 @@ HashAggregate(isMerge=[false], groupBy=[a3, b3], auxGrouping=[a1, b1], select=[a
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT($3)])
-+- LogicalProject(a1=[$0], b1=[$1], c=[COUNT() OVER (PARTITION BY $2)], d1=[$3])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
++- LogicalProject(a1=[$0], b1=[$1], c=[$3], d1=[$2])
+   +- LogicalProject(a1=[$0], b1=[$1], d1=[$3], c=[COUNT() OVER (PARTITION BY $2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -280,9 +289,10 @@ Calc(select=[a1, b1, c, EXPR$3])
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a1=[$0], b1=[$1], a2=[$4], b2=[$5], c1=[$2])
-   +- LogicalJoin(condition=[=($0, $5)], joinType=[right])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6])
+      +- LogicalJoin(condition=[=($0, $5)], joinType=[right])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -308,9 +318,10 @@ Calc(select=[a1, b1, a2, b2, EXPR$4])
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a1=[$0], b1=[$1], a3=[$4], b3=[$5], c1=[$2])
-   +- LogicalJoin(condition=[=($0, $4)], joinType=[right])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a3=[$4], b3=[$5], c3=[$6], d3=[$7])
+      +- LogicalJoin(condition=[=($0, $4)], joinType=[right])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -336,9 +347,10 @@ Calc(select=[a1, b1, a3, b3, EXPR$4])
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a3=[$0], b3=[$1], a1=[$4], b1=[$5], c1=[$6])
-   +- LogicalJoin(condition=[=($4, $0)], joinType=[right])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+   +- LogicalProject(a3=[$0], b3=[$1], c3=[$2], d3=[$3], a1=[$4], b1=[$5], c1=[$6], d1=[$7])
+      +- LogicalJoin(condition=[=($4, $0)], joinType=[right])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -402,10 +414,11 @@ HashWindowAggregate(groupBy=[a4], auxGrouping=[c4], window=[TumblingGroupWindow(
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT($3)])
-+- LogicalProject(a4=[$0], c4=[$1], s=[TUMBLE_START($2)], b4=[$3])
-   +- LogicalAggregate(group=[{0, 1, 2}], b4=[VAR_POP($3)])
-      +- LogicalProject(a4=[$0], c4=[$2], $f2=[$TUMBLE($3, 900000:INTERVAL MINUTE)], b4=[$1])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4, d4)]]])
++- LogicalProject(a4=[$0], c4=[$1], s=[$3], b4=[$2])
+   +- LogicalProject(a4=[$0], c4=[$1], b4=[$3], s=[TUMBLE_START($2)], e=[TUMBLE_END($2)])
+      +- LogicalAggregate(group=[{0, 1, 2}], b4=[VAR_POP($3)])
+         +- LogicalProject(a4=[$0], c4=[$2], $f2=[$TUMBLE($3, 900000:INTERVAL MINUTE)], b4=[$1])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4, d4)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -430,10 +443,11 @@ Calc(select=[a4, c4, s, EXPR$3])
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT($3)])
-+- LogicalProject(a4=[$0], c4=[$1], e=[TUMBLE_END($2)], b4=[$3])
-   +- LogicalAggregate(group=[{0, 1, 2}], b4=[VAR_POP($3)])
-      +- LogicalProject(a4=[$0], c4=[$2], $f2=[$TUMBLE($3, 900000:INTERVAL MINUTE)], b4=[$1])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4, d4)]]])
++- LogicalProject(a4=[$0], c4=[$1], e=[$4], b4=[$2])
+   +- LogicalProject(a4=[$0], c4=[$1], b4=[$3], s=[TUMBLE_START($2)], e=[TUMBLE_END($2)])
+      +- LogicalAggregate(group=[{0, 1, 2}], b4=[VAR_POP($3)])
+         +- LogicalProject(a4=[$0], c4=[$2], $f2=[$TUMBLE($3, 900000:INTERVAL MINUTE)], b4=[$1])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4, d4)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -458,10 +472,11 @@ Calc(select=[a4, c4, e, EXPR$3])
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()])
-+- LogicalProject(a4=[$0], b4=[$3], c4=[$1])
-   +- LogicalAggregate(group=[{0, 1, 2}], b4=[VAR_POP($3)])
-      +- LogicalProject(a4=[$0], c4=[$2], $f2=[$TUMBLE($3, 900000:INTERVAL MINUTE)], b4=[$1])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4, d4)]]])
++- LogicalProject(a4=[$0], b4=[$2], c4=[$1])
+   +- LogicalProject(a4=[$0], c4=[$1], b4=[$3], s=[TUMBLE_START($2)], e=[TUMBLE_END($2)])
+      +- LogicalAggregate(group=[{0, 1, 2}], b4=[VAR_POP($3)])
+         +- LogicalProject(a4=[$0], c4=[$2], $f2=[$TUMBLE($3, 900000:INTERVAL MINUTE)], b4=[$1])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4, d4)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -469,8 +484,8 @@ LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()])
 HashAggregate(isMerge=[true], groupBy=[a4, b4], auxGrouping=[c4], select=[a4, b4, c4, Final_COUNT(count1$0) AS EXPR$3])
 +- Exchange(distribution=[hash[a4, b4]])
    +- LocalHashAggregate(groupBy=[a4, b4], auxGrouping=[c4], select=[a4, b4, c4, Partial_COUNT(*) AS count1$0])
-      +- Calc(select=[a4, c4, CAST((($f2 - (($f3 * $f3) / $f4)) / $f4) AS INTEGER) AS b4])
-         +- HashWindowAggregate(groupBy=[a4], auxGrouping=[c4], window=[TumblingGroupWindow('w$, d4, 900000)], select=[a4, c4 AS $f2, SUM($f4) AS $f2, SUM(b4) AS $f3, COUNT(b4) AS $f4])
+      +- Calc(select=[a4, CAST((($f2 - (($f3 * $f3) / $f4)) / $f4) AS INTEGER) AS b4, c4])
+         +- HashWindowAggregate(groupBy=[a4], auxGrouping=[c4], window=[TumblingGroupWindow('w$, d4, 900000)], properties=[w$start, w$end, w$rowtime], select=[a4, c4 AS $f2, SUM($f4) AS $f2, SUM(b4) AS $f3, COUNT(b4) AS $f4])
             +- Exchange(distribution=[keep_input_as_is[hash[a4]]])
                +- Calc(select=[a4, c4, d4, b4, (b4 * b4) AS $f4])
                   +- Exchange(distribution=[hash[a4]])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/GroupWindowTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/GroupWindowTest.xml
index 42c6213691b..60c4e4af421 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/GroupWindowTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/GroupWindowTest.xml
@@ -694,8 +694,9 @@ GROUP BY TUMBLE(b, INTERVAL '15' MINUTE)
       <![CDATA[
 LogicalProject(s=[$1], a=[$2], wStart=[TUMBLE_START($0)])
 +- LogicalAggregate(group=[{0}], s=[SUM($1)], a=[AVG($1)])
-   +- LogicalProject($f0=[$TUMBLE($1, 900000:INTERVAL MINUTE)], correct=[CASE(=($0, 1), 1, 99)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c, d)]]])
+   +- LogicalProject($f0=[$TUMBLE($1, 900000:INTERVAL MINUTE)], correct=[$0])
+      +- LogicalProject(correct=[CASE(=($0, 1), 1, 99)], b=[$1])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c, d)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -703,8 +704,8 @@ LogicalProject(s=[$1], a=[$2], wStart=[TUMBLE_START($0)])
 Calc(select=[CAST(s AS INTEGER) AS s, CAST(a AS INTEGER) AS a, w$start AS wStart])
 +- HashWindowAggregate(window=[TumblingGroupWindow('w$, b, 900000)], properties=[w$start, w$end, w$rowtime], select=[Final_SUM(sum$0) AS s, Final_AVG(sum$1, count$2) AS a])
    +- Exchange(distribution=[single])
-      +- LocalHashWindowAggregate(window=[TumblingGroupWindow('w$, b, 900000)], properties=[w$start, w$end, w$rowtime], select=[Partial_SUM($f1) AS sum$0, Partial_AVG($f1) AS (sum$1, count$2)])
-         +- Calc(select=[b, CASE((a = 1), 1, 99) AS $f1])
+      +- LocalHashWindowAggregate(window=[TumblingGroupWindow('w$, b, 900000)], properties=[w$start, w$end, w$rowtime], select=[Partial_SUM(correct) AS sum$0, Partial_AVG(correct) AS (sum$1, count$2)])
+         +- Calc(select=[b, CASE((a = 1), 1, 99) AS correct])
             +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c, d)]]], fields=[a, b, c, d])
 ]]>
     </Resource>
@@ -730,16 +731,17 @@ GROUP BY TUMBLE(b, INTERVAL '15' MINUTE)
       <![CDATA[
 LogicalProject(s=[$1], a=[$2], wStart=[TUMBLE_START($0)])
 +- LogicalAggregate(group=[{0}], s=[SUM($1)], a=[AVG($1)])
-   +- LogicalProject($f0=[$TUMBLE($1, 900000:INTERVAL MINUTE)], correct=[CASE(=($0, 1), 1, 99)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c, d)]]])
+   +- LogicalProject($f0=[$TUMBLE($1, 900000:INTERVAL MINUTE)], correct=[$0])
+      +- LogicalProject(correct=[CASE(=($0, 1), 1, 99)], b=[$1])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c, d)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[CAST(s AS INTEGER) AS s, CAST(a AS INTEGER) AS a, w$start AS wStart])
-+- HashWindowAggregate(window=[TumblingGroupWindow('w$, b, 900000)], properties=[w$start, w$end, w$rowtime], select=[SUM($f1) AS s, AVG($f1) AS a])
++- HashWindowAggregate(window=[TumblingGroupWindow('w$, b, 900000)], properties=[w$start, w$end, w$rowtime], select=[SUM(correct) AS s, AVG(correct) AS a])
    +- Exchange(distribution=[single])
-      +- Calc(select=[b, CASE((a = 1), 1, 99) AS $f1])
+      +- Calc(select=[b, CASE((a = 1), 1, 99) AS correct])
          +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c, d)]]], fields=[a, b, c, d])
 ]]>
     </Resource>
@@ -765,8 +767,9 @@ GROUP BY TUMBLE(b, INTERVAL '15' MINUTE)
       <![CDATA[
 LogicalProject(s=[$1], a=[$2], wStart=[TUMBLE_START($0)])
 +- LogicalAggregate(group=[{0}], s=[SUM($1)], a=[AVG($1)])
-   +- LogicalProject($f0=[$TUMBLE($1, 900000:INTERVAL MINUTE)], correct=[CASE(=($0, 1), 1, 99)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c, d)]]])
+   +- LogicalProject($f0=[$TUMBLE($1, 900000:INTERVAL MINUTE)], correct=[$0])
+      +- LogicalProject(correct=[CASE(=($0, 1), 1, 99)], b=[$1])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c, d)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -774,8 +777,8 @@ LogicalProject(s=[$1], a=[$2], wStart=[TUMBLE_START($0)])
 Calc(select=[CAST(s AS INTEGER) AS s, CAST(a AS INTEGER) AS a, w$start AS wStart])
 +- HashWindowAggregate(window=[TumblingGroupWindow('w$, b, 900000)], properties=[w$start, w$end, w$rowtime], select=[Final_SUM(sum$0) AS s, Final_AVG(sum$1, count$2) AS a])
    +- Exchange(distribution=[single])
-      +- LocalHashWindowAggregate(window=[TumblingGroupWindow('w$, b, 900000)], properties=[w$start, w$end, w$rowtime], select=[Partial_SUM($f1) AS sum$0, Partial_AVG($f1) AS (sum$1, count$2)])
-         +- Calc(select=[b, CASE((a = 1), 1, 99) AS $f1])
+      +- LocalHashWindowAggregate(window=[TumblingGroupWindow('w$, b, 900000)], properties=[w$start, w$end, w$rowtime], select=[Partial_SUM(correct) AS sum$0, Partial_AVG(correct) AS (sum$1, count$2)])
+         +- Calc(select=[b, CASE((a = 1), 1, 99) AS correct])
             +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c, d)]]], fields=[a, b, c, d])
 ]]>
     </Resource>
@@ -1497,14 +1500,16 @@ UNION ALL
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
-:- LogicalProject(EXPR$0=[1])
-:  +- LogicalAggregate(group=[{0}])
-:     +- LogicalProject($f0=[$HOP($4, 3600000:INTERVAL HOUR, 3600000:INTERVAL HOUR)])
-:        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, ts)]]])
-+- LogicalProject(EXPR$0=[1])
-   +- LogicalAggregate(group=[{0}])
-      +- LogicalProject($f0=[$HOP($4, 3600000:INTERVAL HOUR, 7200000:INTERVAL HOUR)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, ts)]]])
+:- LogicalProject(EXPR$0=[$0])
+:  +- LogicalProject(EXPR$0=[1])
+:     +- LogicalAggregate(group=[{0}])
+:        +- LogicalProject($f0=[$HOP($4, 3600000:INTERVAL HOUR, 3600000:INTERVAL HOUR)])
+:           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, ts)]]])
++- LogicalProject(EXPR$0=[$0])
+   +- LogicalProject(EXPR$0=[1])
+      +- LogicalAggregate(group=[{0}])
+         +- LogicalProject($f0=[$HOP($4, 3600000:INTERVAL HOUR, 7200000:INTERVAL HOUR)])
+            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, ts)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1570,14 +1575,16 @@ UNION ALL
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
-:- LogicalProject(EXPR$0=[1])
-:  +- LogicalAggregate(group=[{0}])
-:     +- LogicalProject($f0=[$HOP($4, 3600000:INTERVAL HOUR, 3600000:INTERVAL HOUR)])
-:        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, ts)]]])
-+- LogicalProject(EXPR$0=[1])
-   +- LogicalAggregate(group=[{0}])
-      +- LogicalProject($f0=[$HOP($4, 3600000:INTERVAL HOUR, 7200000:INTERVAL HOUR)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, ts)]]])
+:- LogicalProject(EXPR$0=[$0])
+:  +- LogicalProject(EXPR$0=[1])
+:     +- LogicalAggregate(group=[{0}])
+:        +- LogicalProject($f0=[$HOP($4, 3600000:INTERVAL HOUR, 3600000:INTERVAL HOUR)])
+:           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, ts)]]])
++- LogicalProject(EXPR$0=[$0])
+   +- LogicalProject(EXPR$0=[1])
+      +- LogicalAggregate(group=[{0}])
+         +- LogicalProject($f0=[$HOP($4, 3600000:INTERVAL HOUR, 7200000:INTERVAL HOUR)])
+            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, ts)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1640,14 +1647,16 @@ UNION ALL
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
-:- LogicalProject(EXPR$0=[1])
-:  +- LogicalAggregate(group=[{0}])
-:     +- LogicalProject($f0=[$HOP($4, 3600000:INTERVAL HOUR, 3600000:INTERVAL HOUR)])
-:        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, ts)]]])
-+- LogicalProject(EXPR$0=[1])
-   +- LogicalAggregate(group=[{0}])
-      +- LogicalProject($f0=[$HOP($4, 3600000:INTERVAL HOUR, 7200000:INTERVAL HOUR)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, ts)]]])
+:- LogicalProject(EXPR$0=[$0])
+:  +- LogicalProject(EXPR$0=[1])
+:     +- LogicalAggregate(group=[{0}])
+:        +- LogicalProject($f0=[$HOP($4, 3600000:INTERVAL HOUR, 3600000:INTERVAL HOUR)])
+:           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, ts)]]])
++- LogicalProject(EXPR$0=[$0])
+   +- LogicalProject(EXPR$0=[1])
+      +- LogicalAggregate(group=[{0}])
+         +- LogicalProject($f0=[$HOP($4, 3600000:INTERVAL HOUR, 7200000:INTERVAL HOUR)])
+            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, ts)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/GroupingSetsTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/GroupingSetsTest.xml
index ba8d992317f..f4c20840d82 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/GroupingSetsTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/agg/GroupingSetsTest.xml
@@ -486,10 +486,11 @@ FROM emp GROUP BY ROLLUP(deptno, gender)
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(c=[$2], g=[$3], gid=[0:BIGINT], gd=[$4], gg=[$5], ggd=[$6], gdg=[$7])
-+- LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], c=[COUNT()], g=[GROUPING($0)], gd=[GROUPING_ID($0)], gg=[GROUPING_ID($1)], ggd=[GROUPING_ID($1, $0)], gdg=[GROUPING_ID($0, $1)])
-   +- LogicalProject(deptno=[$1], gender=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, emp, source: [TestTableSource(ename, deptno, gender)]]])
+LogicalProject(c=[$2], g=[$3], gid=[$4], gd=[$5], gg=[$6], ggd=[$7], gdg=[$8])
++- LogicalProject(deptno=[$0], gender=[$1], c=[$2], g=[$3], gid=[0:BIGINT], gd=[$4], gg=[$5], ggd=[$6], gdg=[$7])
+   +- LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], c=[COUNT()], g=[GROUPING($0)], gd=[GROUPING_ID($0)], gg=[GROUPING_ID($1)], ggd=[GROUPING_ID($1, $0)], gdg=[GROUPING_ID($0, $1)])
+      +- LogicalProject(deptno=[$1], gender=[$2])
+         +- LogicalTableScan(table=[[default_catalog, default_database, emp, source: [TestTableSource(ename, deptno, gender)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -520,15 +521,16 @@ FROM emp
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(deptno=[$0], gender=[$1], gd=[$2], gg=[$3], dg=[$4], gd0=[$5], gid=[0:BIGINT], c=[$6])
-+- LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {1}, {}]], gd=[GROUPING($0)], gg=[GROUPING($1)], dg=[GROUPING_ID($0, $1)], gd=[GROUPING_ID($1, $0)], c=[COUNT()])
-   +- LogicalProject(deptno=[$1], gender=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, emp, source: [TestTableSource(ename, deptno, gender)]]])
+LogicalProject(deptno=[$0], gender=[$1], gd=[$2], gg=[$3], dg=[$4], gd0=[$5], gid=[$6], c=[$7])
++- LogicalProject(deptno=[$0], gender=[$1], gd=[$2], gg=[$3], dg=[$4], gd_0=[$5], gid=[0:BIGINT], c=[$6])
+   +- LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {1}, {}]], gd=[GROUPING($0)], gg=[GROUPING($1)], dg=[GROUPING_ID($0, $1)], gd=[GROUPING_ID($1, $0)], c=[COUNT()])
+      +- LogicalProject(deptno=[$1], gender=[$2])
+         +- LogicalTableScan(table=[[default_catalog, default_database, emp, source: [TestTableSource(ename, deptno, gender)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[deptno, gender, CASE(SEARCH($e, Sarg[0, 1]), 0, 1) AS gd, CASE(($e = 0), 0, ($e = 1), 1, ($e = 2), 0, 1) AS gg, CASE(($e = 0), 0, ($e = 1), 1, ($e = 2), 2, 3) AS dg, CASE(($e = 0), 0, ($e = 1), 2, ($e = 2), 1, 3) AS gd0, 0 AS gid, c])
+Calc(select=[deptno, gender, CASE(SEARCH($e, Sarg[0, 1]), 0, 1) AS gd, CASE(($e = 0), 0, ($e = 1), 1, ($e = 2), 0, 1) AS gg, CASE(($e = 0), 0, ($e = 1), 1, ($e = 2), 2, 3) AS dg, CASE(($e = 0), 0, ($e = 1), 2, ($e = 2), 1, 3) AS gd_0, 0 AS gid, c])
 +- HashAggregate(isMerge=[true], groupBy=[deptno, gender, $e], select=[deptno, gender, $e, Final_COUNT(count1$0) AS c])
    +- Exchange(distribution=[hash[deptno, gender, $e]])
       +- LocalHashAggregate(groupBy=[deptno, gender, $e], select=[deptno, gender, $e, Partial_COUNT(*) AS count1$0])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/LookupJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/LookupJoinTest.xml
index 004c4249c7d..1c72540f9ac 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/LookupJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/LookupJoinTest.xml
@@ -37,14 +37,15 @@ GROUP BY b
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)], EXPR$2=[SUM($2)], EXPR$3=[SUM($3)])
 +- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3])
-   +- LogicalFilter(condition=[>($7, 10)])
-      +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1, 4}])
-         :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proctime=[PROCTIME()])
-         :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
-         :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-         +- LogicalFilter(condition=[=($cor0.a, $0)])
-            +- LogicalSnapshot(period=[$cor0.proctime])
-               +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
+   +- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3], proctime=[$4])
+      +- LogicalFilter(condition=[>($7, 10)])
+         +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1, 4}])
+            :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proctime=[PROCTIME()])
+            :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
+            :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+            +- LogicalFilter(condition=[=($cor0.a, $0)])
+               +- LogicalSnapshot(period=[$cor0.proctime])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -83,14 +84,15 @@ GROUP BY b
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)], EXPR$2=[SUM($2)], EXPR$3=[SUM($3)])
 +- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3])
-   +- LogicalFilter(condition=[>($7, 10)])
-      +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1, 4}])
-         :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proctime=[PROCTIME()])
-         :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
-         :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-         +- LogicalFilter(condition=[=($cor0.a, $0)])
-            +- LogicalSnapshot(period=[$cor0.proctime])
-               +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable, source: [TestTemporalTable(id, name, age)]]])
+   +- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3], proctime=[$4])
+      +- LogicalFilter(condition=[>($7, 10)])
+         +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1, 4}])
+            :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proctime=[PROCTIME()])
+            :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
+            :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+            +- LogicalFilter(condition=[=($cor0.a, $0)])
+               +- LogicalSnapshot(period=[$cor0.proctime])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable, source: [TestTemporalTable(id, name, age)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -455,14 +457,15 @@ GROUP BY b
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)], EXPR$2=[SUM($2)], EXPR$3=[SUM($3)])
 +- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3])
-   +- LogicalFilter(condition=[>($7, 10)])
-      +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1, 4}])
-         :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proctime=[PROCTIME()])
-         :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
-         :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-         +- LogicalFilter(condition=[=($cor0.a, $0)])
-            +- LogicalSnapshot(period=[$cor0.proctime])
-               +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
+   +- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3], proctime=[$4])
+      +- LogicalFilter(condition=[>($7, 10)])
+         +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1, 4}])
+            :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proctime=[PROCTIME()])
+            :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
+            :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+            +- LogicalFilter(condition=[=($cor0.a, $0)])
+               +- LogicalSnapshot(period=[$cor0.proctime])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -500,14 +503,15 @@ GROUP BY b
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)], EXPR$2=[SUM($2)], EXPR$3=[SUM($3)])
 +- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3])
-   +- LogicalFilter(condition=[>($7, 10)])
-      +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1, 4}])
-         :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proctime=[PROCTIME()])
-         :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
-         :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-         +- LogicalFilter(condition=[=($cor0.a, $0)])
-            +- LogicalSnapshot(period=[$cor0.proctime])
-               +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable, source: [TestTemporalTable(id, name, age)]]])
+   +- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3], proctime=[$4])
+      +- LogicalFilter(condition=[>($7, 10)])
+         +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1, 4}])
+            :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proctime=[PROCTIME()])
+            :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
+            :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+            +- LogicalFilter(condition=[=($cor0.a, $0)])
+               +- LogicalSnapshot(period=[$cor0.proctime])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable, source: [TestTemporalTable(id, name, age)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -570,14 +574,15 @@ LogicalProject(EXPR$0=[$2], EXPR$1=[$3], EXPR$2=[$4])
             :           +- LogicalSnapshot(period=[$cor0.proctime])
             :              +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable, source: [TestTemporalTable(id, name, age)]]])
             +- LogicalProject(a=[$5], b=[$0])
-               +- LogicalFilter(condition=[>($7, 10)])
-                  +- LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{1, 4}])
-                     :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proctime=[PROCTIME()])
-                     :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
-                     :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-                     +- LogicalFilter(condition=[=($cor1.a, $0)])
-                        +- LogicalSnapshot(period=[$cor1.proctime])
-                           +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable, source: [TestTemporalTable(id, name, age)]]])
+               +- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3], proctime=[$4], id=[$5], name=[$6], age=[$7])
+                  +- LogicalFilter(condition=[>($7, 10)])
+                     +- LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{1, 4}])
+                        :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proctime=[PROCTIME()])
+                        :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
+                        :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+                        +- LogicalFilter(condition=[=($cor1.a, $0)])
+                           +- LogicalSnapshot(period=[$cor1.proctime])
+                              +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable, source: [TestTemporalTable(id, name, age)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -646,14 +651,15 @@ LogicalProject(EXPR$0=[$2], EXPR$1=[$3], EXPR$2=[$4])
             :           +- LogicalSnapshot(period=[$cor0.proctime])
             :              +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
             +- LogicalProject(a=[$5], b=[$0])
-               +- LogicalFilter(condition=[>($7, 10)])
-                  +- LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{1, 4}])
-                     :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proctime=[PROCTIME()])
-                     :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
-                     :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-                     +- LogicalFilter(condition=[=($cor1.a, $0)])
-                        +- LogicalSnapshot(period=[$cor1.proctime])
-                           +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
+               +- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3], proctime=[$4], id=[$5], name=[$6], age=[$7])
+                  +- LogicalFilter(condition=[>($7, 10)])
+                     +- LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{1, 4}])
+                        :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proctime=[PROCTIME()])
+                        :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
+                        :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+                        +- LogicalFilter(condition=[=($cor1.a, $0)])
+                           +- LogicalSnapshot(period=[$cor1.proctime])
+                              +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/NestedLoopSemiAntiJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/NestedLoopSemiAntiJoinTest.xml
index 1020d9e41c5..54de0c603a5 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/NestedLoopSemiAntiJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/NestedLoopSemiAntiJoinTest.xml
@@ -1326,11 +1326,13 @@ SELECT c FROM l WHERE a IN
 LogicalProject(c=[$2])
 +- LogicalFilter(condition=[IN($0, {
 LogicalProject(d=[$0])
-  LogicalJoin(condition=[=($1, $4)], joinType=[full])
-    LogicalTableScan(table=[[default_catalog, default_database, r, source: [TestTableSource(d, e, f)]]])
-    LogicalProject(i=[$0], i0=[CAST($0):BIGINT])
-      LogicalFilter(condition=[>($0, 10)])
-        LogicalTableScan(table=[[default_catalog, default_database, t, source: [TestTableSource(i, j, k)]]])
+  LogicalProject(d=[$0], e=[$1], f=[$2], i=[$3])
+    LogicalJoin(condition=[=($1, $4)], joinType=[full])
+      LogicalTableScan(table=[[default_catalog, default_database, r, source: [TestTableSource(d, e, f)]]])
+      LogicalProject(i=[$0], i0=[CAST($0):BIGINT])
+        LogicalProject(i=[$0])
+          LogicalFilter(condition=[>($0, 10)])
+            LogicalTableScan(table=[[default_catalog, default_database, t, source: [TestTableSource(i, j, k)]]])
 })])
    +- LogicalTableScan(table=[[default_catalog, default_database, l, source: [TestTableSource(a, b, c)]]])
 ]]>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SemiAntiJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SemiAntiJoinTest.xml
index 6242c9fa8e5..0c93102527e 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SemiAntiJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SemiAntiJoinTest.xml
@@ -1376,11 +1376,13 @@ SELECT c FROM l WHERE a IN
 LogicalProject(c=[$2])
 +- LogicalFilter(condition=[IN($0, {
 LogicalProject(d=[$0])
-  LogicalJoin(condition=[=($1, $4)], joinType=[full])
-    LogicalTableScan(table=[[default_catalog, default_database, r, source: [TestTableSource(d, e, f)]]])
-    LogicalProject(i=[$0], i0=[CAST($0):BIGINT])
-      LogicalFilter(condition=[>($0, 10)])
-        LogicalTableScan(table=[[default_catalog, default_database, t, source: [TestTableSource(i, j, k)]]])
+  LogicalProject(d=[$0], e=[$1], f=[$2], i=[$3])
+    LogicalJoin(condition=[=($1, $4)], joinType=[full])
+      LogicalTableScan(table=[[default_catalog, default_database, r, source: [TestTableSource(d, e, f)]]])
+      LogicalProject(i=[$0], i0=[CAST($0):BIGINT])
+        LogicalProject(i=[$0])
+          LogicalFilter(condition=[>($0, 10)])
+            LogicalTableScan(table=[[default_catalog, default_database, t, source: [TestTableSource(i, j, k)]]])
 })])
    +- LogicalTableScan(table=[[default_catalog, default_database, l, source: [TestTableSource(a, b, c)]]])
 ]]>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/ShuffledHashSemiAntiJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/ShuffledHashSemiAntiJoinTest.xml
index 150eebcdd7a..d98446ee0f5 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/ShuffledHashSemiAntiJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/ShuffledHashSemiAntiJoinTest.xml
@@ -1179,11 +1179,13 @@ SELECT c FROM l WHERE a IN
 LogicalProject(c=[$2])
 +- LogicalFilter(condition=[IN($0, {
 LogicalProject(d=[$0])
-  LogicalJoin(condition=[=($1, $4)], joinType=[full])
-    LogicalTableScan(table=[[default_catalog, default_database, r, source: [TestTableSource(d, e, f)]]])
-    LogicalProject(i=[$0], i0=[CAST($0):BIGINT])
-      LogicalFilter(condition=[>($0, 10)])
-        LogicalTableScan(table=[[default_catalog, default_database, t, source: [TestTableSource(i, j, k)]]])
+  LogicalProject(d=[$0], e=[$1], f=[$2], i=[$3])
+    LogicalJoin(condition=[=($1, $4)], joinType=[full])
+      LogicalTableScan(table=[[default_catalog, default_database, r, source: [TestTableSource(d, e, f)]]])
+      LogicalProject(i=[$0], i0=[CAST($0):BIGINT])
+        LogicalProject(i=[$0])
+          LogicalFilter(condition=[>($0, 10)])
+            LogicalTableScan(table=[[default_catalog, default_database, t, source: [TestTableSource(i, j, k)]]])
 })])
    +- LogicalTableScan(table=[[default_catalog, default_database, l, source: [TestTableSource(a, b, c)]]])
 ]]>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SortMergeSemiAntiJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SortMergeSemiAntiJoinTest.xml
index 3e858db9c09..d5d9fce29ad 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SortMergeSemiAntiJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/batch/sql/join/SortMergeSemiAntiJoinTest.xml
@@ -1179,11 +1179,13 @@ SELECT c FROM l WHERE a IN
 LogicalProject(c=[$2])
 +- LogicalFilter(condition=[IN($0, {
 LogicalProject(d=[$0])
-  LogicalJoin(condition=[=($1, $4)], joinType=[full])
-    LogicalTableScan(table=[[default_catalog, default_database, r, source: [TestTableSource(d, e, f)]]])
-    LogicalProject(i=[$0], i0=[CAST($0):BIGINT])
-      LogicalFilter(condition=[>($0, 10)])
-        LogicalTableScan(table=[[default_catalog, default_database, t, source: [TestTableSource(i, j, k)]]])
+  LogicalProject(d=[$0], e=[$1], f=[$2], i=[$3])
+    LogicalJoin(condition=[=($1, $4)], joinType=[full])
+      LogicalTableScan(table=[[default_catalog, default_database, r, source: [TestTableSource(d, e, f)]]])
+      LogicalProject(i=[$0], i0=[CAST($0):BIGINT])
+        LogicalProject(i=[$0])
+          LogicalFilter(condition=[>($0, 10)])
+            LogicalTableScan(table=[[default_catalog, default_database, t, source: [TestTableSource(i, j, k)]]])
 })])
    +- LogicalTableScan(table=[[default_catalog, default_database, l, source: [TestTableSource(a, b, c)]]])
 ]]>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/common/ViewsExpandingTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/common/ViewsExpandingTest.xml
index 0f039c0c3f9..d8bf60b4952 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/common/ViewsExpandingTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/common/ViewsExpandingTest.xml
@@ -23,7 +23,9 @@ limitations under the License.
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalTableScan(table=[[default_catalog, default_database, t1]])
++- LogicalProject(a=[$0], b=[$1], c=[$2])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -39,7 +41,9 @@ BoundedStreamScan(table=[[default_catalog, default_database, t1]], fields=[a, b,
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalTableScan(table=[[default_catalog, default_database, t1]])
++- LogicalProject(a=[$0], b=[$1], c=[$2])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -55,10 +59,11 @@ DataStreamScan(table=[[default_catalog, default_database, t1]], fields=[a, b, c]
     <Resource name="ast">
       <![CDATA[
 LogicalProject(f0=[$0], f1=[$1])
-+- LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{0}])
-   :- LogicalProject(f0=[AS($0, _UTF-16LE'f0')])
-   :  +- LogicalValues(tuples=[[{ _UTF-16LE'danny#21' }, { _UTF-16LE'julian#55' }, { _UTF-16LE'fabian#30' }]])
-   +- LogicalTableFunctionScan(invocation=[myFunc($cor1.f0)], rowType=[*org.apache.flink.table.planner.utils.SimpleUser<`name` STRING, `age` INT NOT NULL>* NOT NULL])
++- LogicalProject(f0=[$0], f1=[$1])
+   +- LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{0}])
+      :- LogicalProject(f0=[AS($0, _UTF-16LE'f0')])
+      :  +- LogicalValues(tuples=[[{ _UTF-16LE'danny#21' }, { _UTF-16LE'julian#55' }, { _UTF-16LE'fabian#30' }]])
+      +- LogicalTableFunctionScan(invocation=[myFunc($cor1.f0)], rowType=[*org.apache.flink.table.planner.utils.SimpleUser<`name` STRING, `age` INT NOT NULL>* NOT NULL])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -77,7 +82,10 @@ Calc(select=[f0, name AS f1])
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalTableScan(table=[[default_catalog, default_database, t1]])
++- LogicalProject(a=[$0], b=[$1], c=[$2])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2])
+         +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -93,7 +101,10 @@ BoundedStreamScan(table=[[default_catalog, default_database, t1]], fields=[a, b,
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2])
-+- LogicalTableScan(table=[[default_catalog, default_database, t1]])
++- LogicalProject(a=[$0], b=[$1], c=[$2])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2])
+         +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -132,9 +143,10 @@ DataStreamScan(table=[[default_catalog, default_database, t1]], fields=[a, b, c]
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[CAST($0):INTEGER NOT NULL], b=[$1], c=[CAST($2):INTEGER])
-+- LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT($2)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
+LogicalProject(a=[$0], b=[$1], c=[$2])
++- LogicalProject(a=[CAST($0):INTEGER NOT NULL], b=[$1], c=[CAST($2):INTEGER])
+   +- LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT($2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -154,10 +166,11 @@ Calc(select=[CAST(a AS INTEGER) AS a, b, CAST(EXPR$2 AS INTEGER) AS c])
     <Resource name="ast">
       <![CDATA[
 LogicalProject(f0=[$0], f1=[$1])
-+- LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{0}])
-   :- LogicalProject(f0=[AS($0, _UTF-16LE'f0')])
-   :  +- LogicalValues(tuples=[[{ _UTF-16LE'danny#21' }, { _UTF-16LE'julian#55' }, { _UTF-16LE'fabian#30' }]])
-   +- LogicalTableFunctionScan(invocation=[myFunc($cor1.f0)], rowType=[*org.apache.flink.table.planner.utils.SimpleUser<`name` STRING, `age` INT NOT NULL>* NOT NULL])
++- LogicalProject(f0=[$0], f1=[$1])
+   +- LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{0}])
+      :- LogicalProject(f0=[AS($0, _UTF-16LE'f0')])
+      :  +- LogicalValues(tuples=[[{ _UTF-16LE'danny#21' }, { _UTF-16LE'julian#55' }, { _UTF-16LE'fabian#30' }]])
+      +- LogicalTableFunctionScan(invocation=[myFunc($cor1.f0)], rowType=[*org.apache.flink.table.planner.utils.SimpleUser<`name` STRING, `age` INT NOT NULL>* NOT NULL])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -175,9 +188,10 @@ Calc(select=[f0, name AS f1])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[CAST($0):INTEGER NOT NULL], b=[$1], c=[CAST($2):INTEGER])
-+- LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT($2)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
+LogicalProject(a=[$0], b=[$1], c=[$2])
++- LogicalProject(a=[CAST($0):INTEGER NOT NULL], b=[$1], c=[CAST($2):INTEGER])
+   +- LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT($2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hint/OptionsHintTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hint/OptionsHintTest.xml
index fd4e91ca7ed..5cadc9cb9f7 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hint/OptionsHintTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/hint/OptionsHintTest.xml
@@ -22,8 +22,9 @@ limitations under the License.
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[+($0, 1)])
-+- LogicalTableScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=v1, k2=v2, a.b.c=fakeVal, k5=v5})], dynamic options: {a.b.c=fakeVal, k5=v5}]], hints=[[[OPTIONS inheritPath:[] options:{a.b.c=fakeVal, k5=v5}]]])
+LogicalProject(a=[$0], b=[$1], c=[$2])
++- LogicalProject(a=[$0], b=[$1], c=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=v1, k2=v2, a.b.c=fakeVal, k5=v5})], dynamic options: {a.b.c=fakeVal, k5=v5}]], hints=[[[OPTIONS inheritPath:[] options:{a.b.c=fakeVal, k5=v5}]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -39,37 +40,15 @@ Calc(select=[a, b, (a + 1) AS c])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[+($0, 1)])
-+- LogicalTableScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=v1, k2=v2, a.b.c=fakeVal, k5=v5})], dynamic options: {a.b.c=fakeVal, k5=v5}]], hints=[[[OPTIONS inheritPath:[] options:{a.b.c=fakeVal, k5=v5}]]])
+LogicalProject(a=[$0], b=[$1], c=[$2])
++- LogicalProject(a=[$0], b=[$1], c=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=v1, k2=v2, a.b.c=fakeVal, k5=v5})], dynamic options: {a.b.c=fakeVal, k5=v5}]], hints=[[[OPTIONS inheritPath:[] options:{a.b.c=fakeVal, k5=v5}]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
 Calc(select=[a, b, (a + 1) AS c])
 +- LegacyTableSourceScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=v1, k2=v2, a.b.c=fakeVal, k5=v5})], dynamic options: {a.b.c=fakeVal, k5=v5}]], fields=[a, b], hints=[[[OPTIONS options:{a.b.c=fakeVal, k5=v5}]]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testOptionsHintOnTableApiView[0: is-bounded=true]">
-    <Resource name="sql">
-      <![CDATA[select * from view1/*+ OPTIONS(k1='#v1', k2='#v2', k3='#v3', k4='#v4') */]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
-+- LogicalJoin(condition=[=($0, $3)], joinType=[inner])
-   :- LogicalProject(a=[$0], b=[$1], c=[+($0, 1)])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=v1, k2=v2})]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={k3=v3, k4=v4})]]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-MultipleInput(readOrder=[0,1], members=[\nHashJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f], build=[right])\n:- Calc(select=[a, b, (a + 1) AS c])\n:  +- [#2] Exchange(distribution=[hash[a]])\n+- [#1] Exchange(distribution=[hash[d]])\n])
-:- Exchange(distribution=[hash[d]])
-:  +- LegacyTableSourceScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={k3=v3, k4=v4})]]], fields=[d, e, f])
-+- Exchange(distribution=[hash[a]])
-   +- LegacyTableSourceScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=v1, k2=v2})]]], fields=[a, b])
 ]]>
     </Resource>
   </TestCase>
@@ -132,36 +111,25 @@ Join(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f], leftInput
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinWithOverriddenOptions[0: is-bounded=true]">
+  <TestCase name="testOverrideOptions[0: is-bounded=true]">
     <Resource name="sql">
-      <![CDATA[
-select * from
-t1 /*+ OPTIONS(k1='#v1', k2='#v2') */
-join
-t2 /*+ OPTIONS(k3='#v3', k4='#v4') */
-on t1.a = t2.d
-]]>
+      <![CDATA[select * from t1/*+ OPTIONS(k1='#v1', k2='#v2') */]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
-+- LogicalJoin(condition=[=($0, $3)], joinType=[inner])
-   :- LogicalProject(a=[$0], b=[$1], c=[+($0, 1)])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=#v1, k2=#v2})], dynamic options: {k1=#v1, k2=#v2}]], hints=[[[OPTIONS inheritPath:[] options:{k1=#v1, k2=#v2}]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={k3=#v3, k4=#v4})], dynamic options: {k3=#v3, k4=#v4}]], hints=[[[OPTIONS inheritPath:[] options:{k3=#v3, k4=#v4}]]])
+LogicalProject(a=[$0], b=[$1], c=[$2])
++- LogicalProject(a=[$0], b=[$1], c=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=#v1, k2=#v2})], dynamic options: {k1=#v1, k2=#v2}]], hints=[[[OPTIONS inheritPath:[] options:{k1=#v1, k2=#v2}]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-MultipleInput(readOrder=[0,1], members=[\nHashJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f], build=[right])\n:- Calc(select=[a, b, (a + 1) AS c])\n:  +- [#2] Exchange(distribution=[hash[a]])\n+- [#1] Exchange(distribution=[hash[d]])\n])
-:- Exchange(distribution=[hash[d]])
-:  +- LegacyTableSourceScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={k3=#v3, k4=#v4})], dynamic options: {k3=#v3, k4=#v4}]], fields=[d, e, f], hints=[[[OPTIONS options:{k3=#v3, k4=#v4}]]])
-+- Exchange(distribution=[hash[a]])
-   +- LegacyTableSourceScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=#v1, k2=#v2})], dynamic options: {k1=#v1, k2=#v2}]], fields=[a, b], hints=[[[OPTIONS options:{k1=#v1, k2=#v2}]]])
+Calc(select=[a, b, (a + 1) AS c])
++- LegacyTableSourceScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=#v1, k2=#v2})], dynamic options: {k1=#v1, k2=#v2}]], fields=[a, b], hints=[[[OPTIONS options:{k1=#v1, k2=#v2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testJoinWithOverriddenOptions[1: is-bounded=false]">
+  <TestCase name="testJoinWithOverriddenOptions[0: is-bounded=true]">
     <Resource name="sql">
       <![CDATA[
 select * from
@@ -182,47 +150,23 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Join(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-:- Exchange(distribution=[hash[a]])
-:  +- Calc(select=[a, b, (a + 1) AS c])
-:     +- LegacyTableSourceScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=#v1, k2=#v2})], dynamic options: {k1=#v1, k2=#v2}]], fields=[a, b], hints=[[[OPTIONS options:{k1=#v1, k2=#v2}]]])
-+- Exchange(distribution=[hash[d]])
-   +- LegacyTableSourceScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={k3=#v3, k4=#v4})], dynamic options: {k3=#v3, k4=#v4}]], fields=[d, e, f], hints=[[[OPTIONS options:{k3=#v3, k4=#v4}]]])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testOptionsHintOnSQLView[1: is-bounded=false]">
-    <Resource name="sql">
-      <![CDATA[select * from view1/*+ OPTIONS(k1='#v1', k2='#v2', k3='#v3', k4='#v4') */]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
-+- LogicalJoin(condition=[=($0, $3)], joinType=[inner])
-   :- LogicalProject(a=[$0], b=[$1], c=[+($0, 1)])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=v1, k2=v2})]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={k3=v3, k4=v4})]]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Join(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
-:- Exchange(distribution=[hash[a]])
-:  +- Calc(select=[a, b, (a + 1) AS c])
-:     +- LegacyTableSourceScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=v1, k2=v2})]]], fields=[a, b])
-+- Exchange(distribution=[hash[d]])
-   +- LegacyTableSourceScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={k3=v3, k4=v4})]]], fields=[d, e, f])
+MultipleInput(readOrder=[0,1], members=[\nHashJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f], build=[right])\n:- Calc(select=[a, b, (a + 1) AS c])\n:  +- [#2] Exchange(distribution=[hash[a]])\n+- [#1] Exchange(distribution=[hash[d]])\n])
+:- Exchange(distribution=[hash[d]])
+:  +- LegacyTableSourceScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={k3=#v3, k4=#v4})], dynamic options: {k3=#v3, k4=#v4}]], fields=[d, e, f], hints=[[[OPTIONS options:{k3=#v3, k4=#v4}]]])
++- Exchange(distribution=[hash[a]])
+   +- LegacyTableSourceScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=#v1, k2=#v2})], dynamic options: {k1=#v1, k2=#v2}]], fields=[a, b], hints=[[[OPTIONS options:{k1=#v1, k2=#v2}]]])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOverrideOptions[0: is-bounded=true]">
+  <TestCase name="testOverrideOptions[1: is-bounded=false]">
     <Resource name="sql">
       <![CDATA[select * from t1/*+ OPTIONS(k1='#v1', k2='#v2') */]]>
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[+($0, 1)])
-+- LogicalTableScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=#v1, k2=#v2})], dynamic options: {k1=#v1, k2=#v2}]], hints=[[[OPTIONS inheritPath:[] options:{k1=#v1, k2=#v2}]]])
+LogicalProject(a=[$0], b=[$1], c=[$2])
++- LogicalProject(a=[$0], b=[$1], c=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=#v1, k2=#v2})], dynamic options: {k1=#v1, k2=#v2}]], hints=[[[OPTIONS inheritPath:[] options:{k1=#v1, k2=#v2}]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -232,40 +176,23 @@ Calc(select=[a, b, (a + 1) AS c])
 ]]>
     </Resource>
   </TestCase>
-  <TestCase name="testOptionsHintOnSQLView[0: is-bounded=true]">
+  <TestCase name="testJoinWithOverriddenOptions[1: is-bounded=false]">
     <Resource name="sql">
-      <![CDATA[select * from view1/*+ OPTIONS(k1='#v1', k2='#v2', k3='#v3', k4='#v4') */]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
-+- LogicalJoin(condition=[=($0, $3)], joinType=[inner])
-   :- LogicalProject(a=[$0], b=[$1], c=[+($0, 1)])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=v1, k2=v2})]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={k3=v3, k4=v4})]]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
       <![CDATA[
-MultipleInput(readOrder=[0,1], members=[\nHashJoin(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f], build=[right])\n:- Calc(select=[a, b, (a + 1) AS c])\n:  +- [#2] Exchange(distribution=[hash[a]])\n+- [#1] Exchange(distribution=[hash[d]])\n])
-:- Exchange(distribution=[hash[d]])
-:  +- LegacyTableSourceScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={k3=v3, k4=v4})]]], fields=[d, e, f])
-+- Exchange(distribution=[hash[a]])
-   +- LegacyTableSourceScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=v1, k2=v2})]]], fields=[a, b])
+select * from
+t1 /*+ OPTIONS(k1='#v1', k2='#v2') */
+join
+t2 /*+ OPTIONS(k3='#v3', k4='#v4') */
+on t1.a = t2.d
 ]]>
     </Resource>
-  </TestCase>
-  <TestCase name="testOptionsHintOnTableApiView[1: is-bounded=false]">
-    <Resource name="sql">
-      <![CDATA[select * from view1/*+ OPTIONS(k1='#v1', k2='#v2', k3='#v3', k4='#v4') */]]>
-    </Resource>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
 +- LogicalJoin(condition=[=($0, $3)], joinType=[inner])
    :- LogicalProject(a=[$0], b=[$1], c=[+($0, 1)])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=v1, k2=v2})]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={k3=v3, k4=v4})]]])
+   :  +- LogicalTableScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=#v1, k2=#v2})], dynamic options: {k1=#v1, k2=#v2}]], hints=[[[OPTIONS inheritPath:[] options:{k1=#v1, k2=#v2}]]])
+   +- LogicalTableScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={k3=#v3, k4=#v4})], dynamic options: {k3=#v3, k4=#v4}]], hints=[[[OPTIONS inheritPath:[] options:{k3=#v3, k4=#v4}]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -273,26 +200,9 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
 Join(joinType=[InnerJoin], where=[(a = d)], select=[a, b, c, d, e, f], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey])
 :- Exchange(distribution=[hash[a]])
 :  +- Calc(select=[a, b, (a + 1) AS c])
-:     +- LegacyTableSourceScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=v1, k2=v2})]]], fields=[a, b])
+:     +- LegacyTableSourceScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=#v1, k2=#v2})], dynamic options: {k1=#v1, k2=#v2}]], fields=[a, b], hints=[[[OPTIONS options:{k1=#v1, k2=#v2}]]])
 +- Exchange(distribution=[hash[d]])
-   +- LegacyTableSourceScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={k3=v3, k4=v4})]]], fields=[d, e, f])
-]]>
-    </Resource>
-  </TestCase>
-  <TestCase name="testOverrideOptions[1: is-bounded=false]">
-    <Resource name="sql">
-      <![CDATA[select * from t1/*+ OPTIONS(k1='#v1', k2='#v2') */]]>
-    </Resource>
-    <Resource name="ast">
-      <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[+($0, 1)])
-+- LogicalTableScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=#v1, k2=#v2})], dynamic options: {k1=#v1, k2=#v2}]], hints=[[[OPTIONS inheritPath:[] options:{k1=#v1, k2=#v2}]]])
-]]>
-    </Resource>
-    <Resource name="optimized exec plan">
-      <![CDATA[
-Calc(select=[a, b, (a + 1) AS c])
-+- LegacyTableSourceScan(table=[[default_catalog, default_database, t1, source: [OptionsTableSource(props={k1=#v1, k2=#v2})], dynamic options: {k1=#v1, k2=#v2}]], fields=[a, b], hints=[[[OPTIONS options:{k1=#v1, k2=#v2}]]])
+   +- LegacyTableSourceScan(table=[[default_catalog, default_database, t2, source: [OptionsTableSource(props={k3=#v3, k4=#v4})], dynamic options: {k3=#v3, k4=#v4}]], fields=[d, e, f], hints=[[[OPTIONS options:{k3=#v3, k4=#v4}]]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/nodes/exec/operator/BatchOperatorNameTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/nodes/exec/operator/BatchOperatorNameTest.xml
index d9f69879d16..13183114bc6 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/nodes/exec/operator/BatchOperatorNameTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/nodes/exec/operator/BatchOperatorNameTest.xml
@@ -196,7 +196,8 @@ Calc(select=[EXPR$0 AS s])
 LogicalProject(b=[$0], window_end=[TUMBLE_END($1)], EXPR$2=[$2])
 +- LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()])
    +- LogicalProject(b=[$1], $f1=[$TUMBLE($4, 900000:INTERVAL MINUTE)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 
 == Optimized Physical Plan ==
 Calc(select=[b, w$end AS window_end, EXPR$2])
@@ -263,7 +264,8 @@ Calc(select=[b, w$end AS window_end, EXPR$2])
 LogicalProject(b=[$0], window_end=[TUMBLE_END($1)], EXPR$2=[$2])
 +- LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()])
    +- LogicalProject(b=[$1], $f1=[$TUMBLE($4, 900000:INTERVAL MINUTE)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 
 == Optimized Physical Plan ==
 Calc(select=[b, w$end AS window_end, EXPR$2])
@@ -1326,7 +1328,8 @@ NestedLoopJoin(joinType=[InnerJoin], where=[(a = d0)], select=[a, b, c, d, a0, b
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(b=[$1], cnt1=[COUNT($0) OVER (PARTITION BY $1 ORDER BY $4 NULLS FIRST ROWS 2 PRECEDING)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 
 == Optimized Physical Plan ==
 Calc(select=[b, w0$o0 AS $1])
@@ -1392,7 +1395,8 @@ Calc(select=[b, w0$o0 AS $1])
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(b=[$1], cnt1=[COUNT($0) OVER (PARTITION BY $1 ORDER BY $4 NULLS FIRST ROWS 2 PRECEDING)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 
 == Optimized Physical Plan ==
 Calc(select=[b, w0$o0 AS $1])
@@ -2032,7 +2036,8 @@ SortMergeJoin(joinType=[InnerJoin], where=[(a = d0)], select=[a, b, c, d, a0, b0
 LogicalProject(b=[$0], window_end=[TUMBLE_END($1)], EXPR$2=[$2])
 +- LogicalAggregate(group=[{0, 1}], EXPR$2=[FIRST_VALUE($2)])
    +- LogicalProject(b=[$1], $f1=[$TUMBLE($4, 900000:INTERVAL MINUTE)], a=[$0])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 
 == Optimized Physical Plan ==
 Calc(select=[b, w$end AS window_end, EXPR$2])
@@ -2156,7 +2161,8 @@ SortMergeJoin(joinType=[InnerJoin], where=[(a = d0)], select=[a, b, c, d, a0, b0
 LogicalProject(b=[$0], window_end=[TUMBLE_END($1)], EXPR$2=[$2])
 +- LogicalAggregate(group=[{0, 1}], EXPR$2=[FIRST_VALUE($2)])
    +- LogicalProject(b=[$1], $f1=[$TUMBLE($4, 900000:INTERVAL MINUTE)], a=[$0])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rowtime=[$4], proctime=[PROCTIME()])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 
 == Optimized Physical Plan ==
 Calc(select=[b, w$end AS window_end, EXPR$2])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/nodes/exec/operator/StreamOperatorNameTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/nodes/exec/operator/StreamOperatorNameTest.xml
index f18b3e24d9e..f7bb10c45a2 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/nodes/exec/operator/StreamOperatorNameTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/nodes/exec/operator/StreamOperatorNameTest.xml
@@ -2650,8 +2650,9 @@ Calc(select=[a, w0$o0])
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(f0=[$0], f1=[$1])
-+- LogicalTableAggregate(group=[{}], tableAggregate=[[*org.apache.flink.table.planner.utils.Top3*($0)]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MySource]])
++- LogicalProject(f0=[$0], f1=[$1])
+   +- LogicalTableAggregate(group=[{}], tableAggregate=[[*org.apache.flink.table.planner.utils.Top3*($0)]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MySource]])
 
 == Optimized Physical Plan ==
 GroupTableAggregate(select=[*org.apache.flink.table.planner.utils.Top3*(f0) AS (f0, f1)])
@@ -2701,8 +2702,9 @@ GroupTableAggregate(select=[*org.apache.flink.table.planner.utils.Top3*(f0) AS (
     <Resource name="explain">
       <![CDATA[== Abstract Syntax Tree ==
 LogicalProject(f0=[$0], f1=[$1])
-+- LogicalTableAggregate(group=[{}], tableAggregate=[[*org.apache.flink.table.planner.utils.Top3*($0)]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MySource]])
++- LogicalProject(f0=[$0], f1=[$1])
+   +- LogicalTableAggregate(group=[{}], tableAggregate=[[*org.apache.flink.table.planner.utils.Top3*($0)]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MySource]])
 
 == Optimized Physical Plan ==
 GroupTableAggregate(select=[*org.apache.flink.table.planner.utils.Top3*(f0) AS (f0, f1)])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/AggregateReduceGroupingRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/AggregateReduceGroupingRuleTest.xml
index 74f871b805f..7dc441741a1 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/AggregateReduceGroupingRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/AggregateReduceGroupingRuleTest.xml
@@ -24,9 +24,10 @@ limitations under the License.
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a1=[$0], b1=[$1], a2=[$4], b2=[$5], c1=[$2])
-   +- LogicalJoin(condition=[=($0, $5)], joinType=[full])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6])
+      +- LogicalJoin(condition=[=($0, $5)], joinType=[full])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -49,9 +50,10 @@ FlinkLogicalCalc(select=[a1, b1, a2, b2, EXPR$4])
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a1=[$0], b1=[$1], a3=[$4], b3=[$5], c1=[$2])
-   +- LogicalJoin(condition=[=($0, $4)], joinType=[full])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a3=[$4], b3=[$5], c3=[$6], d3=[$7])
+      +- LogicalJoin(condition=[=($0, $4)], joinType=[full])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -74,10 +76,11 @@ FlinkLogicalCalc(select=[a1, b1, a3, b3, EXPR$4])
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a1=[$0], b1=[$1], a2=[$4], b2=[$5], c1=[$2])
-   +- LogicalFilter(condition=[=($0, $5)])
-      +- LogicalJoin(condition=[true], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6])
+      +- LogicalFilter(condition=[=($0, $5)])
+         +- LogicalJoin(condition=[true], joinType=[inner])
+            :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -99,10 +102,11 @@ FlinkLogicalAggregate(group=[{0}], b1=[AUXILIARY_GROUP($1)], a2=[AUXILIARY_GROUP
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)], EXPR$5=[AVG($5)])
 +- LogicalProject(a2=[$0], b2=[$1], a3=[$3], b3=[$4], c2=[$2], d3=[$6])
-   +- LogicalFilter(condition=[=($1, $3)])
-      +- LogicalJoin(condition=[true], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+   +- LogicalProject(a2=[$0], b2=[$1], c2=[$2], a3=[$3], b3=[$4], c3=[$5], d3=[$6])
+      +- LogicalFilter(condition=[=($1, $3)])
+         +- LogicalJoin(condition=[true], joinType=[inner])
+            :- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -124,12 +128,13 @@ FlinkLogicalCalc(select=[a2, b2, a3, b3, EXPR$4, EXPR$5])
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3, 4, 5}], EXPR$6=[COUNT($6)])
 +- LogicalProject(a1=[$0], b1=[$1], a2=[$4], b2=[$5], a3=[$7], b3=[$8], c1=[$2])
-   +- LogicalFilter(condition=[AND(=($0, $5), =($0, $7))])
-      +- LogicalJoin(condition=[true], joinType=[inner])
-         :- LogicalJoin(condition=[true], joinType=[inner])
-         :  :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-         :  +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6], a3=[$7], b3=[$8], c3=[$9], d3=[$10])
+      +- LogicalFilter(condition=[AND(=($0, $5), =($0, $7))])
+         +- LogicalJoin(condition=[true], joinType=[inner])
+            :- LogicalJoin(condition=[true], joinType=[inner])
+            :  :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+            :  +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -156,9 +161,10 @@ FlinkLogicalCalc(select=[a1, b1, a2, b2, a3, b3, *($f4, $f2) AS $f8])
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a1=[$0], b1=[$1], a2=[$4], b2=[$5], c1=[$2])
-   +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6])
+      +- LogicalJoin(condition=[=($0, $5)], joinType=[left])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -180,9 +186,10 @@ FlinkLogicalAggregate(group=[{0}], b1=[AUXILIARY_GROUP($1)], a2=[AUXILIARY_GROUP
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a1=[$0], b1=[$1], a3=[$4], b3=[$5], c1=[$2])
-   +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a3=[$4], b3=[$5], c3=[$6], d3=[$7])
+      +- LogicalJoin(condition=[=($0, $4)], joinType=[left])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -205,9 +212,10 @@ FlinkLogicalCalc(select=[a1, b1, a3, b3, EXPR$4])
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a3=[$0], b3=[$1], a1=[$4], b1=[$5], c1=[$6])
-   +- LogicalJoin(condition=[=($4, $0)], joinType=[left])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+   +- LogicalProject(a3=[$0], b3=[$1], c3=[$2], d3=[$3], a1=[$4], b1=[$5], c1=[$6], d1=[$7])
+      +- LogicalJoin(condition=[=($4, $0)], joinType=[left])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -228,8 +236,9 @@ FlinkLogicalAggregate(group=[{0, 1}], a1=[AUXILIARY_GROUP($2)], b1=[AUXILIARY_GR
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT($3)])
-+- LogicalProject(a1=[$0], b1=[$1], c=[COUNT() OVER (PARTITION BY $2)], d1=[$3])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
++- LogicalProject(a1=[$0], b1=[$1], c=[$3], d1=[$2])
+   +- LogicalProject(a1=[$0], b1=[$1], d1=[$3], c=[COUNT() OVER (PARTITION BY $2)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -250,9 +259,10 @@ FlinkLogicalCalc(select=[a1, b1, c, EXPR$3])
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a1=[$0], b1=[$1], a2=[$4], b2=[$5], c1=[$2])
-   +- LogicalJoin(condition=[=($0, $5)], joinType=[right])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a2=[$4], b2=[$5], c2=[$6])
+      +- LogicalJoin(condition=[=($0, $5)], joinType=[right])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -275,9 +285,10 @@ FlinkLogicalCalc(select=[a1, b1, a2, b2, EXPR$4])
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a1=[$0], b1=[$1], a3=[$4], b3=[$5], c1=[$2])
-   +- LogicalJoin(condition=[=($0, $4)], joinType=[right])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+   +- LogicalProject(a1=[$0], b1=[$1], c1=[$2], d1=[$3], a3=[$4], b3=[$5], c3=[$6], d3=[$7])
+      +- LogicalJoin(condition=[=($0, $4)], joinType=[right])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -300,9 +311,10 @@ FlinkLogicalCalc(select=[a1, b1, a3, b3, EXPR$4])
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2, 3}], EXPR$4=[COUNT($4)])
 +- LogicalProject(a3=[$0], b3=[$1], a1=[$4], b1=[$5], c1=[$6])
-   +- LogicalJoin(condition=[=($4, $0)], joinType=[right])
-      :- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
-      +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
+   +- LogicalProject(a3=[$0], b3=[$1], c3=[$2], d3=[$3], a1=[$4], b1=[$5], c1=[$6], d1=[$7])
+      +- LogicalJoin(condition=[=($4, $0)], joinType=[right])
+         :- LogicalTableScan(table=[[default_catalog, default_database, T3, source: [TestTableSource(a3, b3, c3, d3)]]])
+         +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a1, b1, c1, d1)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -361,10 +373,11 @@ FlinkLogicalWindowAggregate(group=[{0}], c4=[AUXILIARY_GROUP($2)], EXPR$2=[COUNT
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT($3)])
-+- LogicalProject(a4=[$0], c4=[$1], s=[TUMBLE_START($2)], b4=[$3])
-   +- LogicalAggregate(group=[{0, 1, 2}], b4=[VAR_POP($3)])
-      +- LogicalProject(a4=[$0], c4=[$2], $f2=[$TUMBLE($3, 900000:INTERVAL MINUTE)], b4=[$1])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4, d4)]]])
++- LogicalProject(a4=[$0], c4=[$1], s=[$3], b4=[$2])
+   +- LogicalProject(a4=[$0], c4=[$1], b4=[$3], s=[TUMBLE_START($2)], e=[TUMBLE_END($2)])
+      +- LogicalAggregate(group=[{0, 1, 2}], b4=[VAR_POP($3)])
+         +- LogicalProject(a4=[$0], c4=[$2], $f2=[$TUMBLE($3, 900000:INTERVAL MINUTE)], b4=[$1])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4, d4)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -385,10 +398,11 @@ FlinkLogicalCalc(select=[a4, c4, s, EXPR$3])
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT($3)])
-+- LogicalProject(a4=[$0], c4=[$1], e=[TUMBLE_END($2)], b4=[$3])
-   +- LogicalAggregate(group=[{0, 1, 2}], b4=[VAR_POP($3)])
-      +- LogicalProject(a4=[$0], c4=[$2], $f2=[$TUMBLE($3, 900000:INTERVAL MINUTE)], b4=[$1])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4, d4)]]])
++- LogicalProject(a4=[$0], c4=[$1], e=[$4], b4=[$2])
+   +- LogicalProject(a4=[$0], c4=[$1], b4=[$3], s=[TUMBLE_START($2)], e=[TUMBLE_END($2)])
+      +- LogicalAggregate(group=[{0, 1, 2}], b4=[VAR_POP($3)])
+         +- LogicalProject(a4=[$0], c4=[$2], $f2=[$TUMBLE($3, 900000:INTERVAL MINUTE)], b4=[$1])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4, d4)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -409,17 +423,18 @@ FlinkLogicalCalc(select=[a4, c4, e, EXPR$3])
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()])
-+- LogicalProject(a4=[$0], b4=[$3], c4=[$1])
-   +- LogicalAggregate(group=[{0, 1, 2}], b4=[VAR_POP($3)])
-      +- LogicalProject(a4=[$0], c4=[$2], $f2=[$TUMBLE($3, 900000:INTERVAL MINUTE)], b4=[$1])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4, d4)]]])
++- LogicalProject(a4=[$0], b4=[$2], c4=[$1])
+   +- LogicalProject(a4=[$0], c4=[$1], b4=[$3], s=[TUMBLE_START($2)], e=[TUMBLE_END($2)])
+      +- LogicalAggregate(group=[{0, 1, 2}], b4=[VAR_POP($3)])
+         +- LogicalProject(a4=[$0], c4=[$2], $f2=[$TUMBLE($3, 900000:INTERVAL MINUTE)], b4=[$1])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4, d4)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-FlinkLogicalAggregate(group=[{0, 2}], c4=[AUXILIARY_GROUP($1)], EXPR$3=[COUNT()])
-+- FlinkLogicalCalc(select=[a4, c4, CAST(/(-($f2, /(*($f3, $f3), $f4)), $f4) AS INTEGER) AS b4])
-   +- FlinkLogicalWindowAggregate(group=[{0}], c4=[AUXILIARY_GROUP($1)], agg#1=[SUM($4)], agg#2=[SUM($3)], agg#3=[COUNT($3)], window=[TumblingGroupWindow('w$, d4, 900000)], properties=[])
+FlinkLogicalAggregate(group=[{0, 1}], c4=[AUXILIARY_GROUP($2)], EXPR$3=[COUNT()])
++- FlinkLogicalCalc(select=[a4, CAST(/(-($f2, /(*($f3, $f3), $f4)), $f4) AS INTEGER) AS b4, c4])
+   +- FlinkLogicalWindowAggregate(group=[{0}], c4=[AUXILIARY_GROUP($1)], agg#1=[SUM($4)], agg#2=[SUM($3)], agg#3=[COUNT($3)], window=[TumblingGroupWindow('w$, d4, 900000)], properties=[w$start, w$end, w$rowtime])
       +- FlinkLogicalCalc(select=[a4, c4, d4, b4, *(b4, b4) AS $f4])
          +- FlinkLogicalLegacyTableSourceScan(table=[[default_catalog, default_database, T4, source: [TestTableSource(a4, b4, c4, d4)]]], fields=[a4, b4, c4, d4])
 ]]>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/CorrelateSortToRankRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/CorrelateSortToRankRuleTest.xml
index e0f29580f19..ee03899eaef 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/CorrelateSortToRankRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/CorrelateSortToRankRuleTest.xml
@@ -78,8 +78,9 @@ FROM
 LogicalProject(f0=[$0], f1=[$1])
 +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
    :- LogicalAggregate(group=[{0}])
-   :  +- LogicalProject(f0=[+($0, $1)])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
+   :  +- LogicalProject(f0=[$0])
+   :     +- LogicalProject(f0=[+($0, $1)])
+   :        +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
    +- LogicalSort(sort0=[$1], dir0=[DESC-nulls-last], fetch=[3])
       +- LogicalProject(f1=[$1], f2=[$2])
          +- LogicalFilter(condition=[=(CAST($0):BIGINT, $cor0.f0)])
@@ -91,8 +92,9 @@ LogicalProject(f0=[$0], f1=[$1])
 LogicalProject(f0=[$0], f1=[$1])
 +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{0}])
    :- LogicalAggregate(group=[{0}])
-   :  +- LogicalProject(f0=[+($0, $1)])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
+   :  +- LogicalProject(f0=[$0])
+   :     +- LogicalProject(f0=[+($0, $1)])
+   :        +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
    +- LogicalSort(sort0=[$1], dir0=[DESC-nulls-last], fetch=[3])
       +- LogicalProject(f1=[$1], f2=[$2])
          +- LogicalFilter(condition=[=(CAST($0):BIGINT, $cor0.f0)])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkAggregateJoinTransposeRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkAggregateJoinTransposeRuleTest.xml
index 46e62c77bf4..4d10c1f1f97 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkAggregateJoinTransposeRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/FlinkAggregateJoinTransposeRuleTest.xml
@@ -26,10 +26,11 @@ SELECT a2, b2, c2, SUM(a) FROM (SELECT * FROM T2, T WHERE a2 = a) GROUP BY a2, b
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[SUM($3)])
 +- LogicalProject(a2=[$0], b2=[$1], c2=[$2], a=[$3])
-   +- LogicalFilter(condition=[=($0, $3)])
-      +- LogicalJoin(condition=[true], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a2=[$0], b2=[$1], c2=[$2], a=[$3], b=[$4], c=[$5])
+      +- LogicalFilter(condition=[=($0, $3)])
+         +- LogicalJoin(condition=[true], joinType=[inner])
+            :- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -53,10 +54,11 @@ SELECT a2, b2, c, SUM(a) FROM (SELECT * FROM T2, T WHERE a2 = a) GROUP BY a2, b2
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[SUM($3)])
 +- LogicalProject(a2=[$0], b2=[$1], c=[$5], a=[$3])
-   +- LogicalFilter(condition=[=($0, $3)])
-      +- LogicalJoin(condition=[true], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a2=[$0], b2=[$1], c2=[$2], a=[$3], b=[$4], c=[$5])
+      +- LogicalFilter(condition=[=($0, $3)])
+         +- LogicalJoin(condition=[true], joinType=[inner])
+            :- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -81,10 +83,11 @@ SELECT a2, b2, c2, SUM(a) FROM (SELECT * FROM T2, T WHERE b2 = b) GROUP BY a2, b
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[SUM($3)])
 +- LogicalProject(a2=[$0], b2=[$1], c2=[$2], a=[$3])
-   +- LogicalFilter(condition=[=($1, $4)])
-      +- LogicalJoin(condition=[true], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a2=[$0], b2=[$1], c2=[$2], a=[$3], b=[$4], c=[$5])
+      +- LogicalFilter(condition=[=($1, $4)])
+         +- LogicalJoin(condition=[true], joinType=[inner])
+            :- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -108,10 +111,11 @@ SELECT a2, b2, c, SUM(a) FROM (SELECT * FROM T2, T WHERE b2 = b) GROUP BY a2, b2
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[SUM($3)])
 +- LogicalProject(a2=[$0], b2=[$1], c=[$5], a=[$3])
-   +- LogicalFilter(condition=[=($1, $4)])
-      +- LogicalJoin(condition=[true], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a2=[$0], b2=[$1], c2=[$2], a=[$3], b=[$4], c=[$5])
+      +- LogicalFilter(condition=[=($1, $4)])
+         +- LogicalJoin(condition=[true], joinType=[inner])
+            :- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -140,17 +144,18 @@ SELECT MIN(a1), MIN(b1), MIN(a2), MIN(b2), a, b, COUNT(c) FROM
 LogicalProject(EXPR$0=[$2], EXPR$1=[$3], EXPR$2=[$4], EXPR$3=[$5], a=[$0], b=[$1], EXPR$6=[$6])
 +- LogicalAggregate(group=[{0, 1}], EXPR$0=[MIN($2)], EXPR$1=[MIN($3)], EXPR$2=[MIN($4)], EXPR$3=[MIN($5)], EXPR$6=[COUNT($6)])
    +- LogicalProject(a=[$4], b=[$5], a1=[$0], b1=[$1], a2=[$2], b2=[$3], c=[$6])
-      +- LogicalFilter(condition=[AND(=($0, $3), =($0, $4))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalJoin(condition=[true], joinType=[inner])
-            :  :- LogicalAggregate(group=[{0}], b1=[COUNT($1)])
-            :  :  +- LogicalProject(a1=[$0], b=[$1])
-            :  :     +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [TestTableSource(a, b, c)]]])
-            :  +- LogicalProject(a2=[$1], b2=[$0])
-            :     +- LogicalAggregate(group=[{0}], a2=[COUNT($1)])
-            :        +- LogicalProject(b2=[$1], a=[$0])
-            :           +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [TestTableSource(a, b, c)]]])
+      +- LogicalProject(a1=[$0], b1=[$1], a2=[$2], b2=[$3], a=[$4], b=[$5], c=[$6])
+         +- LogicalFilter(condition=[AND(=($0, $3), =($0, $4))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalJoin(condition=[true], joinType=[inner])
+               :  :- LogicalAggregate(group=[{0}], b1=[COUNT($1)])
+               :  :  +- LogicalProject(a1=[$0], b=[$1])
+               :  :     +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [TestTableSource(a, b, c)]]])
+               :  +- LogicalProject(a2=[$1], b2=[$0])
+               :     +- LogicalAggregate(group=[{0}], a2=[COUNT($1)])
+               :        +- LogicalProject(b2=[$1], a=[$0])
+               :           +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -181,10 +186,11 @@ SELECT MIN(a2), MIN(b2), a, b, COUNT(c2) FROM
 LogicalProject(EXPR$0=[$2], EXPR$1=[$3], a=[$0], b=[$1], EXPR$4=[$4])
 +- LogicalAggregate(group=[{0, 1}], EXPR$0=[MIN($2)], EXPR$1=[MIN($3)], EXPR$4=[COUNT($4)])
    +- LogicalProject(a=[$3], b=[$4], a2=[$0], b2=[$1], c2=[$2])
-      +- LogicalFilter(condition=[=($1, $3)])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [TestTableSource(a, b, c)]]])
+      +- LogicalProject(a2=[$0], b2=[$1], c2=[$2], a=[$3], b=[$4], c=[$5])
+         +- LogicalFilter(condition=[=($1, $3)])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a2, b2, c2)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinConditionEqualityTransferRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinConditionEqualityTransferRuleTest.xml
index 3cff1e22def..5a9ace9c2c7 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinConditionEqualityTransferRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinConditionEqualityTransferRuleTest.xml
@@ -85,20 +85,22 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$4], e=[$5], f=[$6])
-+- LogicalJoin(condition=[AND(=($0, $4), =($0, $5), =($3, $4))], joinType=[inner])
-   :- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[+($1, 1)])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [TestTableSource(a, b, c)]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(d, e, f)]]])
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$4], e=[$5], f=[$6])
+   +- LogicalJoin(condition=[AND(=($0, $4), =($0, $5), =($3, $4))], joinType=[inner])
+      :- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[+($1, 1)])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [TestTableSource(a, b, c)]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(d, e, f)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[$2], d=[$4], e=[$5], f=[$6])
-+- LogicalJoin(condition=[AND(=($0, $3), =($5, $4), =($0, $5))], joinType=[inner])
-   :- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[+($1, 1)])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [TestTableSource(a, b, c)]]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(d, e, f)]]])
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$4], e=[$5], f=[$6])
+   +- LogicalJoin(condition=[AND(=($0, $3), =($5, $4), =($0, $5))], joinType=[inner])
+      :- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[+($1, 1)])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [TestTableSource(a, b, c)]]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(d, e, f)]]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinConditionTypeCoerceRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinConditionTypeCoerceRuleTest.xml
index bcb0620fc9b..1802dc6fb50 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinConditionTypeCoerceRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/JoinConditionTypeCoerceRuleTest.xml
@@ -204,23 +204,25 @@ LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4]), rowType=[RecordType(INTE
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0]), rowType=[RecordType(INTEGER a)]
-+- LogicalJoin(condition=[=($5, $6)], joinType=[left]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e, BIGINT a0, BIGINT cnt)]
-   :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], a0=[CAST($0):BIGINT]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e, BIGINT a0)]
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a, b, c, d, e)]]]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
-   +- LogicalAggregate(group=[{}], cnt=[COUNT()]), rowType=[RecordType(BIGINT cnt)]
-      +- LogicalProject($f0=[0]), rowType=[RecordType(INTEGER $f0)]
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a, b, c, d, e)]]]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], cnt=[$6]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e, BIGINT cnt)]
+   +- LogicalJoin(condition=[=($5, $6)], joinType=[left]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e, BIGINT a0, BIGINT cnt)]
+      :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], a0=[CAST($0):BIGINT]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e, BIGINT a0)]
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a, b, c, d, e)]]]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
+      +- LogicalAggregate(group=[{}], cnt=[COUNT()]), rowType=[RecordType(BIGINT cnt)]
+         +- LogicalProject($f0=[0]), rowType=[RecordType(INTEGER $f0)]
+            +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a, b, c, d, e)]]]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(a=[$0]), rowType=[RecordType(INTEGER a)]
-+- LogicalJoin(condition=[=($5, $6)], joinType=[left]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e, BIGINT a0, BIGINT cnt)]
-   :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], a0=[CAST($0):BIGINT]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e, BIGINT a0)]
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a, b, c, d, e)]]]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
-   +- LogicalAggregate(group=[{}], cnt=[COUNT()]), rowType=[RecordType(BIGINT cnt)]
-      +- LogicalProject($f0=[0]), rowType=[RecordType(INTEGER $f0)]
-         +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a, b, c, d, e)]]]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], cnt=[$6]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e, BIGINT cnt)]
+   +- LogicalJoin(condition=[=($5, $6)], joinType=[left]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e, BIGINT a0, BIGINT cnt)]
+      :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], a0=[CAST($0):BIGINT]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e, BIGINT a0)]
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T1, source: [TestTableSource(a, b, c, d, e)]]]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
+      +- LogicalAggregate(group=[{}], cnt=[COUNT()]), rowType=[RecordType(BIGINT cnt)]
+         +- LogicalProject($f0=[0]), rowType=[RecordType(INTEGER $f0)]
+            +- LogicalTableScan(table=[[default_catalog, default_database, T2, source: [TestTableSource(a, b, c, d, e)]]]), rowType=[RecordType(INTEGER a, BIGINT b, FLOAT c, DOUBLE d, DECIMAL(38, 18) e)]
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushProjectIntoLegacyTableSourceScanRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushProjectIntoLegacyTableSourceScanRuleTest.xml
index c98e184e195..b7f0c4194ec 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushProjectIntoLegacyTableSourceScanRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushProjectIntoLegacyTableSourceScanRuleTest.xml
@@ -39,14 +39,16 @@ LogicalProject(a=[$0], c=[$2], EXPR$2=[+($1, 1)])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], c=[$2], d=[+($0, 1)], EXPR$3=[+($1, 1)])
-+- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [TestSource(physical fields: a, b, c)]]])
+LogicalProject(a=[$0], c=[$2], d=[$3], EXPR$3=[+($1, 1)])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [TestSource(physical fields: a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(a=[$0], c=[$2], d=[+($0, 1)], EXPR$3=[+($1, 1)])
-+- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [TestSource(physical fields: a, b, c)]]])
+LogicalProject(a=[$0], c=[$2], d=[$3], EXPR$3=[+($1, 1)])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [TestSource(physical fields: a, b, c)]]])
 ]]>
     </Resource>
   </TestCase>
@@ -116,14 +118,16 @@ LogicalProject(a=[$0], EXPR$1=[TRIM(FLAG(BOTH), _UTF-16LE' ', $1)])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], EXPR$1=[my_udf(+($0, 1))])
-+- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [TestSource(physical fields: a, b, c)]]])
+LogicalProject(a=[$0], EXPR$1=[my_udf($3)])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [TestSource(physical fields: a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(a=[$0], EXPR$1=[my_udf(+($0, 1))])
-+- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [TestSource(physical fields: a)]]])
+LogicalProject(a=[$0], EXPR$1=[my_udf($3)])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [TestSource(physical fields: a, b, c)]]])
 ]]>
     </Resource>
   </TestCase>
@@ -133,14 +137,16 @@ LogicalProject(a=[$0], EXPR$1=[my_udf(+($0, 1))])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], d=[+($0, 1)])
-+- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [TestSource(physical fields: a, b, c)]]])
+LogicalProject(a=[$0], d=[$3])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [TestSource(physical fields: a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(a=[$0], d=[+($0, 1)])
-+- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [TestSource(physical fields: a)]]])
+LogicalProject(a=[$0], d=[$3])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, source: [TestSource(physical fields: a, b, c)]]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushProjectIntoTableSourceScanRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushProjectIntoTableSourceScanRuleTest.xml
index e56fc529d68..710ffa05498 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushProjectIntoTableSourceScanRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PushProjectIntoTableSourceScanRuleTest.xml
@@ -39,14 +39,16 @@ LogicalProject(a=[$0], c=[$2], EXPR$2=[+($1, 1)])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], c=[$2], d=[+($0, 1)], EXPR$3=[+($1, 1)])
-+- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+LogicalProject(a=[$0], c=[$2], d=[$3], EXPR$3=[+($1, 1)])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(a=[$0], c=[$2], d=[+($0, 1)], EXPR$3=[+($1, 1)])
-+- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+LogicalProject(a=[$0], c=[$2], d=[$3], EXPR$3=[+($1, 1)])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
   </TestCase>
@@ -76,13 +78,15 @@ LogicalProject(id=[$0], nestedName=[$1], nestedSum=[+($2, $3)])
     <Resource name="ast">
       <![CDATA[
 LogicalProject(m1=[$0], metadata=[$1])
-+- LogicalTableScan(table=[[default_catalog, default_database, T2]])
++- LogicalProject(m1=[$0], metadata=[$1], m3=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(m1=[$0], metadata=[$1])
-+- LogicalTableScan(table=[[default_catalog, default_database, T2]])
++- LogicalProject(m1=[$0], metadata=[$1], m3=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 ]]>
     </Resource>
   </TestCase>
@@ -93,13 +97,15 @@ LogicalProject(m1=[$0], metadata=[$1])
     <Resource name="ast">
       <![CDATA[
 LogicalProject(EXPR$0=[1])
-+- LogicalTableScan(table=[[default_catalog, default_database, T4]])
++- LogicalProject(m1=[$0], metadata=[$1], m3=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T4]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(EXPR$0=[1])
-+- LogicalTableScan(table=[[default_catalog, default_database, T4]])
++- LogicalProject(m1=[$0], metadata=[$1], m3=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T4]])
 ]]>
     </Resource>
   </TestCase>
@@ -110,12 +116,15 @@ LogicalProject(EXPR$0=[1])
     <Resource name="ast">
       <![CDATA[
 LogicalProject(m1=[$0], metadata=[$1])
-+- LogicalTableScan(table=[[default_catalog, default_database, T1]])
++- LogicalProject(m1=[$0], metadata=[$1], m3=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalTableScan(table=[[default_catalog, default_database, T1, metadata=[m1, m2]]])
+LogicalProject(m1=[$0], metadata=[$1])
++- LogicalProject(m1=[$0], metadata=[$1], m3=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
 ]]>
     </Resource>
   </TestCase>
@@ -126,13 +135,15 @@ LogicalTableScan(table=[[default_catalog, default_database, T1, metadata=[m1, m2
     <Resource name="ast">
       <![CDATA[
 LogicalProject(EXPR$0=[1])
-+- LogicalTableScan(table=[[default_catalog, default_database, T3]])
++- LogicalProject(m1=[$0], metadata=[$1], m3=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LogicalProject(EXPR$0=[1])
-+- LogicalTableScan(table=[[default_catalog, default_database, T3, metadata=[m1]]])
++- LogicalProject(m1=[$0], metadata=[$1], m3=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T3]])
 ]]>
     </Resource>
   </TestCase>
@@ -218,13 +229,15 @@ FROM MetadataTable]]>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.nested2.num), $2)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable]])
++- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(id=[$0], nested1=[$1], results=[+(+($1.value, $2), $3)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, project=[id, deepNested_nested1, deepNested_nested2_num], metadata=[metadata_1]]])
+LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.nested2.num), $2)])
++- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, project=[id, deepNested], metadata=[metadata_1, metadata_2]]])
 ]]>
     </Resource>
   </TestCase>
@@ -237,13 +250,15 @@ FROM MetadataTable]]>
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.nested2.num), $2)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable]])
++- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(id=[$0], nested1=[$1], results=[+(+($1.value, $2), $3)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, project=[id, deepNested_nested1, deepNested_nested2_num], metadata=[metadata_1]]])
+LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.nested2.num), $2)])
++- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, project=[id, deepNested], metadata=[metadata_1, metadata_2]]])
 ]]>
     </Resource>
   </TestCase>
@@ -271,7 +286,8 @@ LogicalProject(EXPR$0=[ITEM($0.data_arr, $1).value], EXPR$1=[ITEM($0.data_map, _
     <Resource name="ast">
       <![CDATA[
 LogicalProject(metadata=[$1], f1=[$0])
-+- LogicalTableScan(table=[[default_catalog, default_database, T5]])
++- LogicalProject(f1=[$0], metadata=[$1], m3=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T5]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -288,7 +304,8 @@ LogicalProject(metadata=[$1], f1=[$0])
     <Resource name="ast">
       <![CDATA[
 LogicalProject(metadata=[$1])
-+- LogicalTableScan(table=[[default_catalog, default_database, T5]])
++- LogicalProject(f1=[$0], metadata=[$1], m3=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T5]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -321,14 +338,16 @@ LogicalProject(id=[$0], EXPR$1=[ITEM($1, _UTF-16LE'e')])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], metadata_3=[CAST($2):BIGINT], metadata_1=[$2])
-+- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable]])
+LogicalProject(id=[$0], metadata_3=[$4], metadata_1=[$2])
++- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(id=[$0], metadata_3=[CAST($1):BIGINT], metadata_1=[$1])
-+- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, project=[id], metadata=[metadata_1]]])
+LogicalProject(id=[$0], metadata_3=[$4], metadata_1=[$2])
++- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3], metadata_3=[CAST($2):BIGINT])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable, project=[id, deepNested], metadata=[metadata_1, metadata_2]]])
 ]]>
     </Resource>
   </TestCase>
@@ -374,14 +393,16 @@ LogicalProject(a=[$0], EXPR$1=[TRIM(FLAG(BOTH), _UTF-16LE' ', $1)])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], EXPR$1=[my_udf(+($0, 1))])
-+- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+LogicalProject(a=[$0], EXPR$1=[my_udf($3)])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(a=[$0], EXPR$1=[my_udf(+($0, 1))])
-+- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, project=[a], metadata=[]]])
+LogicalProject(a=[$0], EXPR$1=[my_udf($3)])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
   </TestCase>
@@ -391,14 +412,16 @@ LogicalProject(a=[$0], EXPR$1=[my_udf(+($0, 1))])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], d=[+($0, 1)])
-+- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
+LogicalProject(a=[$0], d=[$3])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
-LogicalProject(a=[$0], d=[+($0, 1)])
-+- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable, project=[a], metadata=[]]])
+LogicalProject(a=[$0], d=[$3])
++- LogicalProject(a=[$0], b=[$1], c=[$2], d=[+($0, 1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, VirtualTable]])
 ]]>
     </Resource>
   </TestCase>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PythonCalcSplitRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PythonCalcSplitRuleTest.xml
index cbf6c0d2705..f1007afea5f 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PythonCalcSplitRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/PythonCalcSplitRuleTest.xml
@@ -414,8 +414,9 @@ FlinkLogicalCalc(select=[f0 AS EXPR$0, +(c, 1) AS EXPR$1])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(f0=[pyFunc5($3._1).f0], f1=[pyFunc5($3._1).f1])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c, d)]]])
+LogicalProject(f0=[$0.f0], f1=[$0.f1])
++- LogicalProject(e=[pyFunc5($3._1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c, d)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -472,8 +473,9 @@ FlinkLogicalCalc(select=[+(a, 1) AS EXPR$0], where=[AND(IS NULL(f0.f0), >(b, 0))
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(f0=[pyFunc5($0).f0], f1=[pyFunc5($0).f1])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c, d)]]])
+LogicalProject(f0=[$0.f0], f1=[$0.f1])
++- LogicalProject(e=[pyFunc5($0)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c, d)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -490,8 +492,9 @@ FlinkLogicalCalc(select=[f0.f0 AS f0, f0.f1 AS f1])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(f0=[pyFunc5($0).f0], f1=[pyFunc5($0).f1], f00=[pyFunc5($1).f0], f10=[pyFunc5($1).f1])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c, d)]]])
+LogicalProject(f0=[$0.f0], f1=[$0.f1], f00=[$1.f0], f10=[$1.f1])
++- LogicalProject(e=[pyFunc5($0)], f=[pyFunc5($1)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c, d)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/RemoveUnreachableCoalesceArgumentsRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/RemoveUnreachableCoalesceArgumentsRuleTest.xml
index 2d766d1c679..e1ed6ffec6d 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/RemoveUnreachableCoalesceArgumentsRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/RemoveUnreachableCoalesceArgumentsRuleTest.xml
@@ -108,11 +108,12 @@ Calc(select=[f0, f1, f2], where=[=(COALESCE(f0, f1), 'abc')])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(f0=[$0], f1=[$1], f2=[$2], f00=[$4], f10=[$5], f20=[$6])
-+- LogicalJoin(condition=[=($3, $4)], joinType=[left])
-   :- LogicalProject(f0=[$0], f1=[$1], f2=[$2], $f3=[COALESCE($0, _UTF-16LE'-', $2)])
-   :  +- LogicalTableScan(table=[[default_catalog, default_database, T]])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T]])
+LogicalProject(f0=[$0], f1=[$1], f2=[$2], f00=[$3], f10=[$4], f20=[$5])
++- LogicalProject(f0=[$0], f1=[$1], f2=[$2], f00=[$4], f10=[$5], f20=[$6])
+   +- LogicalJoin(condition=[=($3, $4)], joinType=[left])
+      :- LogicalProject(f0=[$0], f1=[$1], f2=[$2], $f3=[COALESCE($0, _UTF-16LE'-', $2)])
+      :  +- LogicalTableScan(table=[[default_catalog, default_database, T]])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SplitAggregateRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SplitAggregateRuleTest.xml
index f992471c5f4..d054a354c04 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SplitAggregateRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SplitAggregateRuleTest.xml
@@ -98,9 +98,10 @@ LogicalProject(c=[$0], b=[$1], d=[$2], a=[$3], a0=[$4], b0=[$5], c0=[$6])
    :- LogicalProject(c=[$0], b=[$1], d=[$1], a=[$2])
    :  +- LogicalAggregate(group=[{0}], d=[SUM($1)], a=[COUNT(DISTINCT $2)])
    :     +- LogicalProject(c=[$2], b=[$1], a=[$0])
-   :        +- LogicalAggregate(group=[{0}], b=[COUNT(DISTINCT $1)], d=[SUM($1)])
-   :           +- LogicalProject(a=[$0], b=[$1])
-   :              +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   :        +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$2])
+   :           +- LogicalAggregate(group=[{0}], b=[COUNT(DISTINCT $1)], d=[SUM($1)])
+   :              +- LogicalProject(a=[$0], b=[$1])
+   :                 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SplitPythonConditionFromJoinRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SplitPythonConditionFromJoinRuleTest.xml
index b61490487be..4ba39790832 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SplitPythonConditionFromJoinRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/logical/SplitPythonConditionFromJoinRuleTest.xml
@@ -54,11 +54,12 @@ SELECT a, d + 1 FROM(
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], EXPR$1=[+($1, 1)])
-+- LogicalFilter(condition=[=(pyFunc($0, $1), *($0, $1))])
-   +- LogicalProject(a=[$0], d=[$3])
-      +- LogicalJoin(condition=[AND(=($0, $3), =(pyFunc($0, $0), +($0, $3)))], joinType=[inner])
-         :- LogicalTableScan(table=[[default_catalog, default_database, leftTable, source: [TestTableSource(a, b, c)]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, rightTable, source: [TestTableSource(d, e, f)]]])
++- LogicalProject(a=[$0], d=[$1])
+   +- LogicalFilter(condition=[=(pyFunc($0, $1), *($0, $1))])
+      +- LogicalProject(a=[$0], d=[$3])
+         +- LogicalJoin(condition=[AND(=($0, $3), =(pyFunc($0, $0), +($0, $3)))], joinType=[inner])
+            :- LogicalTableScan(table=[[default_catalog, default_database, leftTable, source: [TestTableSource(a, b, c)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, rightTable, source: [TestTableSource(d, e, f)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/PushLocalAggIntoTableSourceScanRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/PushLocalAggIntoTableSourceScanRuleTest.xml
index b8de2fc902e..118dc7f02e8 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/PushLocalAggIntoTableSourceScanRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/PushLocalAggIntoTableSourceScanRuleTest.xml
@@ -295,7 +295,8 @@ FROM inventory_meta
       <![CDATA[
 LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()])
 +- LogicalProject(id=[$0], name=[$1])
-   +- LogicalTableScan(table=[[default_catalog, default_database, inventory_meta]])
+   +- LogicalProject(id=[$0], name=[$1], amount=[$2], price=[$3], type=[$4], metadata_1=[$5], metadata_2=[$6])
+      +- LogicalTableScan(table=[[default_catalog, default_database, inventory_meta]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalHashAggRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalHashAggRuleTest.xml
index a119cacadbe..2c5b94ea524 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalHashAggRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalHashAggRuleTest.xml
@@ -54,10 +54,11 @@ SELECT SUM(b) FROM r GROUP BY a
 LogicalProject(EXPR$0=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
    +- LogicalProject(a=[$0], b=[$1])
-      +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+         +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -89,9 +90,10 @@ SELECT a, SUM(b) FROM (
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
 +- LogicalProject(a=[$0], b=[$1])
-   +- LogicalFilter(condition=[<=($3, 10)])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], rk=[RANK() OVER (PARTITION BY $0, $2 ORDER BY $1 NULLS FIRST)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], rk=[$3])
+      +- LogicalFilter(condition=[<=($3, 10)])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], rk=[RANK() OVER (PARTITION BY $0, $2 ORDER BY $1 NULLS FIRST)])
+            +- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalSortAggRuleTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalSortAggRuleTest.xml
index 80f76f3e2f0..ae00d6a0c9f 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalSortAggRuleTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/batch/RemoveRedundantLocalSortAggRuleTest.xml
@@ -28,10 +28,11 @@ SELECT sum(b) FROM r group by a
 LogicalProject(EXPR$0=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
    +- LogicalProject(a=[$0], b=[$1])
-      +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+         +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -91,10 +92,11 @@ SELECT sum(b) FROM r group by a
 LogicalProject(EXPR$0=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)])
    +- LogicalProject(a=[$0], b=[$1])
-      +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+         +- LogicalFilter(condition=[AND(=($0, $3), LIKE($2, _UTF-16LE'He%'))])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/ChangelogModeInferenceTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/ChangelogModeInferenceTest.xml
index 2d0a54e7d86..7719e16d90b 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/ChangelogModeInferenceTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/rules/physical/stream/ChangelogModeInferenceTest.xml
@@ -335,28 +335,33 @@ LogicalSink(table=[default_catalog.default_database.sink1], fields=[number, word
 +- LogicalProject(number=[$0], word=[$1])
    +- LogicalFilter(condition=[>($1, _UTF-16LE'a')])
       +- LogicalUnion(all=[true])
-         :- LogicalProject(number=[+($1, 1)], word=[$0])
-         :  +- LogicalAggregate(group=[{0}], number=[SUM($1)])
-         :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
-         +- LogicalProject(number=[-($1, 1)], word=[$0])
-            +- LogicalAggregate(group=[{0}], number=[SUM($1)])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
+         :- LogicalProject(number=[+($0, 1)], word=[$1])
+         :  +- LogicalProject(number=[$1], word=[$0])
+         :     +- LogicalAggregate(group=[{0}], number=[SUM($1)])
+         :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
+         +- LogicalProject(number=[-($0, 1)], word=[$1])
+            +- LogicalProject(number=[$1], word=[$0])
+               +- LogicalAggregate(group=[{0}], number=[SUM($1)])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
 
 LogicalSink(table=[default_catalog.default_database.sink1], fields=[number, word])
 +- LogicalProject(number=[$0], word=[$1])
    +- LogicalFilter(condition=[<($1, _UTF-16LE'a')])
       +- LogicalUnion(all=[true])
-         :- LogicalProject(number=[+($1, 1)], word=[$0])
-         :  +- LogicalAggregate(group=[{0}], number=[SUM($1)])
-         :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
-         +- LogicalProject(number=[-($1, 1)], word=[$0])
-            +- LogicalAggregate(group=[{0}], number=[SUM($1)])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
+         :- LogicalProject(number=[+($0, 1)], word=[$1])
+         :  +- LogicalProject(number=[$1], word=[$0])
+         :     +- LogicalAggregate(group=[{0}], number=[SUM($1)])
+         :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
+         +- LogicalProject(number=[-($0, 1)], word=[$1])
+            +- LogicalProject(number=[$1], word=[$0])
+               +- LogicalAggregate(group=[{0}], number=[SUM($1)])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
 
 LogicalSink(table=[default_catalog.default_database.sink2], fields=[number, word])
-+- LogicalProject(number=[$1], word=[$0])
-   +- LogicalAggregate(group=[{0}], number=[SUM($1)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
++- LogicalProject(number=[$0], word=[$1])
+   +- LogicalProject(number=[$1], word=[$0])
+      +- LogicalAggregate(group=[{0}], number=[SUM($1)])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -365,25 +370,29 @@ Sink(table=[default_catalog.default_database.sink1], fields=[number, word], chan
 +- Calc(select=[number, word], where=[>(word, 'a')], changelogMode=[I,UB,UA])
    +- Union(all=[true], union=[number, word], changelogMode=[I,UB,UA])
       :- Calc(select=[+(number, 1) AS number, word], changelogMode=[I,UB,UA])
-      :  +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
-      :     +- Exchange(distribution=[hash[word]], changelogMode=[I])
-      :        +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
+      :  +- Calc(select=[number, word], changelogMode=[I,UB,UA])
+      :     +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
+      :        +- Exchange(distribution=[hash[word]], changelogMode=[I])
+      :           +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
       +- Calc(select=[-(number, 1) AS number, word], changelogMode=[I,UB,UA])
-         +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
-            +- Exchange(distribution=[hash[word]], changelogMode=[I])
-               +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
+         +- Calc(select=[number, word], changelogMode=[I,UB,UA])
+            +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
+               +- Exchange(distribution=[hash[word]], changelogMode=[I])
+                  +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
 
 Sink(table=[default_catalog.default_database.sink1], fields=[number, word], changelogMode=[NONE])
 +- Calc(select=[number, word], where=[<(word, 'a')], changelogMode=[I,UB,UA])
    +- Union(all=[true], union=[number, word], changelogMode=[I,UB,UA])
       :- Calc(select=[+(number, 1) AS number, word], changelogMode=[I,UB,UA])
-      :  +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
-      :     +- Exchange(distribution=[hash[word]], changelogMode=[I])
-      :        +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
+      :  +- Calc(select=[number, word], changelogMode=[I,UB,UA])
+      :     +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
+      :        +- Exchange(distribution=[hash[word]], changelogMode=[I])
+      :           +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
       +- Calc(select=[-(number, 1) AS number, word], changelogMode=[I,UB,UA])
-         +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
-            +- Exchange(distribution=[hash[word]], changelogMode=[I])
-               +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
+         +- Calc(select=[number, word], changelogMode=[I,UB,UA])
+            +- GroupAggregate(groupBy=[word], select=[word, SUM(number) AS number], changelogMode=[I,UB,UA])
+               +- Exchange(distribution=[hash[word]], changelogMode=[I])
+                  +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [CollectionTableSource(word, number)]]], fields=[word, number], changelogMode=[I])
 
 Sink(table=[default_catalog.default_database.sink2], fields=[number, word], changelogMode=[NONE])
 +- Calc(select=[number, word], changelogMode=[I,UB,UA])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/CalcTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/CalcTest.xml
index 2ca7ed8ea80..4397895cebc 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/CalcTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/CalcTest.xml
@@ -260,8 +260,9 @@ Calc(select=[a._1 AS _1, a._2 AS _2, c, b._1 AS _10, b._2 AS _20])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(c=[$2])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+LogicalProject(c=[$1])
++- LogicalProject(a=[$0], c=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -457,7 +458,8 @@ Calc(select=[a, b, c, 1984-07-12 AS EXPR$3, 14:34:24 AS EXPR$4, 1984-07-12 14:34
     <Resource name="ast">
       <![CDATA[
 LogicalProject(1-_./Ü=[$0], b=[$1], c=[$2])
-+- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
++- LogicalProject(1-_./Ü=[$0], b=[$1], c=[$2])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DagOptimizationTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DagOptimizationTest.xml
index 71d741060be..0dc07f2d2ed 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DagOptimizationTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DagOptimizationTest.xml
@@ -31,11 +31,13 @@ LogicalLegacySink(name=[`default_catalog`.`default_database`.`retractSink`], fie
          +- LogicalProject(b=[$1], a=[$0])
             +- LogicalUnion(all=[true])
                :- LogicalProject(a=[$0], b=[$1], c=[$2])
-               :  +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%hello%')])
-               :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+               :  +- LogicalProject(a=[$0], b=[$1], c=[$2])
+               :     +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%hello%')])
+               :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
                +- LogicalProject(a=[$0], b=[$1], c=[$2])
-                  +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%world%')])
-                     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2])
+                     +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%world%')])
+                        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`upsertSink`], fields=[b, cnt])
 +- LogicalProject(b=[$0], cnt=[$1])
@@ -44,11 +46,13 @@ LogicalLegacySink(name=[`default_catalog`.`default_database`.`upsertSink`], fiel
          +- LogicalProject(b=[$1], a=[$0])
             +- LogicalUnion(all=[true])
                :- LogicalProject(a=[$0], b=[$1], c=[$2])
-               :  +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%hello%')])
-               :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+               :  +- LogicalProject(a=[$0], b=[$1], c=[$2])
+               :     +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%hello%')])
+               :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
                +- LogicalProject(a=[$0], b=[$1], c=[$2])
-                  +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%world%')])
-                     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2])
+                     +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%world%')])
+                        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -86,17 +90,19 @@ LegacySink(name=[`default_catalog`.`default_database`.`upsertSink`], fields=[b,
       <![CDATA[
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`retractSink1`], fields=[total_sum])
 +- LogicalAggregate(group=[{}], total_sum=[SUM($0)])
-   +- LogicalProject(sum_a=[$1])
-      +- LogicalAggregate(group=[{0}], sum_a=[SUM($1)])
-         +- LogicalProject(c=[$2], a=[$0])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(sum_a=[$0])
+      +- LogicalProject(sum_a=[$1], c=[$0])
+         +- LogicalAggregate(group=[{0}], sum_a=[SUM($1)])
+            +- LogicalProject(c=[$2], a=[$0])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`retractSink2`], fields=[total_min])
 +- LogicalAggregate(group=[{}], total_min=[MIN($0)])
-   +- LogicalProject(sum_a=[$1])
-      +- LogicalAggregate(group=[{0}], sum_a=[SUM($1)])
-         +- LogicalProject(c=[$2], a=[$0])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(sum_a=[$0])
+      +- LogicalProject(sum_a=[$1], c=[$0])
+         +- LogicalAggregate(group=[{0}], sum_a=[SUM($1)])
+            +- LogicalProject(c=[$2], a=[$0])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -127,28 +133,32 @@ LegacySink(name=[`default_catalog`.`default_database`.`retractSink2`], fields=[t
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`appendSink1`], fields=[a, b1])
 +- LogicalUnion(all=[true])
    :- LogicalProject(a1=[$0], b1=[$1])
-   :  +- LogicalFilter(condition=[<=($0, 10)])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
-   +- LogicalProject(a=[$2], b1=[$1])
-      +- LogicalFilter(condition=[=($2, $0)])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalProject(a1=[$0], b1=[$1])
-            :  +- LogicalFilter(condition=[<=($0, 10)])
-            :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]])
+   :  +- LogicalProject(a1=[$0], b1=[$1])
+   :     +- LogicalFilter(condition=[<=($0, 10)])
+   :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a=[$0], b1=[$1])
+      +- LogicalProject(a=[$2], b1=[$1])
+         +- LogicalFilter(condition=[=($2, $0)])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalProject(a1=[$0], b1=[$1])
+               :  +- LogicalFilter(condition=[<=($0, 10)])
+               :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]])
 
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`appendSink2`], fields=[a, b1])
 +- LogicalUnion(all=[true])
    :- LogicalProject(a1=[$0], b1=[$1])
-   :  +- LogicalFilter(condition=[<=($0, 10)])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
-   +- LogicalProject(a=[$2], b1=[$1])
-      +- LogicalFilter(condition=[=($2, $0)])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalProject(a1=[$0], b1=[$1])
-            :  +- LogicalFilter(condition=[<=($0, 10)])
-            :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]])
+   :  +- LogicalProject(a1=[$0], b1=[$1])
+   :     +- LogicalFilter(condition=[<=($0, 10)])
+   :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a=[$0], b1=[$1])
+      +- LogicalProject(a=[$2], b1=[$1])
+         +- LogicalFilter(condition=[=($2, $0)])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalProject(a1=[$0], b1=[$1])
+               :  +- LogicalFilter(condition=[<=($0, 10)])
+               :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -196,42 +206,43 @@ LogicalLegacySink(name=[`default_catalog`.`default_database`.`appendSink1`], fie
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`appendSink2`], fields=[a, b1])
 +- LogicalUnion(all=[true])
    :- LogicalProject(a1=[$0], b1=[$1])
-   :  +- LogicalFilter(condition=[<=($0, 10)])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
-   +- LogicalProject(a=[$2], b1=[$1])
-      +- LogicalFilter(condition=[=($2, $0)])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalProject(a1=[$0], b1=[$1])
-            :  +- LogicalFilter(condition=[<=($0, 10)])
-            :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]])
+   :  +- LogicalProject(a1=[$0], b1=[$1])
+   :     +- LogicalFilter(condition=[<=($0, 10)])
+   :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a=[$0], b1=[$1])
+      +- LogicalProject(a=[$2], b1=[$1])
+         +- LogicalFilter(condition=[=($2, $0)])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalProject(a1=[$0], b1=[$1])
+               :  +- LogicalFilter(condition=[<=($0, 10)])
+               :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
       <![CDATA[
 LegacySink(name=[`default_catalog`.`default_database`.`appendSink1`], fields=[a, b1], changelogMode=[NONE])
-+- Calc(select=[a, b1], changelogMode=[I])
-   +- Join(joinType=[InnerJoin], where=[=(a, a1)], select=[a1, b1, a, b, c, d, e], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey], changelogMode=[I])
-      :- Exchange(distribution=[hash[a1]], changelogMode=[I])
-      :  +- Calc(select=[a AS a1, b AS b1], changelogMode=[I])
-      :     +- Calc(select=[a, b, c], where=[<=(a, 10)], changelogMode=[I])
-      :        +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]], fields=[a, b, c], changelogMode=[I])
++- Calc(select=[a0 AS a, b AS b1], changelogMode=[I])
+   +- Join(joinType=[InnerJoin], where=[=(a0, a)], select=[a, b, a0], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey], changelogMode=[I])
+      :- Exchange(distribution=[hash[a]], changelogMode=[I])
+      :  +- Calc(select=[a, b], where=[<=(a, 10)], changelogMode=[I])
+      :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]], fields=[a, b, c], changelogMode=[I])
       +- Exchange(distribution=[hash[a]], changelogMode=[I])
-         +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]], fields=[a, b, c, d, e], changelogMode=[I])
+         +- Calc(select=[a], changelogMode=[I])
+            +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]], fields=[a, b, c, d, e], changelogMode=[I])
 
 LegacySink(name=[`default_catalog`.`default_database`.`appendSink2`], fields=[a, b1], changelogMode=[NONE])
-+- Union(all=[true], union=[a1, b1], changelogMode=[I])
-   :- Calc(select=[a AS a1, b AS b1], changelogMode=[I])
-   :  +- Calc(select=[a, b, c], where=[<=(a, 10)], changelogMode=[I])
-   :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]], fields=[a, b, c], changelogMode=[I])
-   +- Calc(select=[a, b1], changelogMode=[I])
-      +- Join(joinType=[InnerJoin], where=[=(a, a1)], select=[a1, b1, a, b, c, d, e], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey], changelogMode=[I])
-         :- Exchange(distribution=[hash[a1]], changelogMode=[I])
-         :  +- Calc(select=[a AS a1, b AS b1], changelogMode=[I])
-         :     +- Calc(select=[a, b, c], where=[<=(a, 10)], changelogMode=[I])
-         :        +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]], fields=[a, b, c], changelogMode=[I])
++- Union(all=[true], union=[a, b], changelogMode=[I])
+   :- Calc(select=[a, b], where=[<=(a, 10)], changelogMode=[I])
+   :  +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]], fields=[a, b, c], changelogMode=[I])
+   +- Calc(select=[a0 AS a, b AS b1], changelogMode=[I])
+      +- Join(joinType=[InnerJoin], where=[=(a0, a)], select=[a, b, a0], leftInputSpec=[NoUniqueKey], rightInputSpec=[NoUniqueKey], changelogMode=[I])
+         :- Exchange(distribution=[hash[a]], changelogMode=[I])
+         :  +- Calc(select=[a, b], where=[<=(a, 10)], changelogMode=[I])
+         :     +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]], fields=[a, b, c], changelogMode=[I])
          +- Exchange(distribution=[hash[a]], changelogMode=[I])
-            +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]], fields=[a, b, c, d, e], changelogMode=[I])
+            +- Calc(select=[a], changelogMode=[I])
+               +- LegacyTableSourceScan(table=[[default_catalog, default_database, MyTable2, source: [TestTableSource(a, b, c, d, e)]]], fields=[a, b, c, d, e], changelogMode=[I])
 ]]>
     </Resource>
   </TestCase>
@@ -312,13 +323,15 @@ LegacySink(name=[`default_catalog`.`default_database`.`appendSink2`], fields=[a1
       <![CDATA[
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`retractSink1`], fields=[total_sum])
 +- LogicalAggregate(group=[{}], total_sum=[SUM($0)])
-   +- LogicalProject(a=[random_udf($0)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a=[$0])
+      +- LogicalProject(a=[random_udf($0)], c=[$2])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`retractSink2`], fields=[total_min])
 +- LogicalAggregate(group=[{}], total_min=[MIN($0)])
-   +- LogicalProject(a=[random_udf($0)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a=[$0])
+      +- LogicalProject(a=[random_udf($0)], c=[$2])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -354,8 +367,9 @@ LogicalLegacySink(name=[`default_catalog`.`default_database`.`retractSink1`], fi
          :              :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
          :              +- LogicalTableFunctionScan(invocation=[split($cor0.c)], rowType=[RecordType(VARCHAR(2147483647) f0)], elementType=[class [Ljava.lang.Object;])
          +- LogicalProject(a=[$0], total_c=[0])
-            +- LogicalFilter(condition=[>=($1, UNIX_TIMESTAMP(_UTF-16LE'${startTime}'))])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+            +- LogicalProject(a=[$0], b=[-($1, MOD($1, 300))], c=[$2])
+               +- LogicalFilter(condition=[>=($1, UNIX_TIMESTAMP(_UTF-16LE'${startTime}'))])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`retractSink2`], fields=[a, total_c])
 +- LogicalProject(a=[$0], total_c=[$1])
@@ -371,8 +385,9 @@ LogicalLegacySink(name=[`default_catalog`.`default_database`.`retractSink2`], fi
          :              :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
          :              +- LogicalTableFunctionScan(invocation=[split($cor0.c)], rowType=[RecordType(VARCHAR(2147483647) f0)], elementType=[class [Ljava.lang.Object;])
          +- LogicalProject(a=[$0], total_c=[0])
-            +- LogicalFilter(condition=[>=($1, UNIX_TIMESTAMP(_UTF-16LE'${startTime}'))])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+            +- LogicalProject(a=[$0], b=[-($1, MOD($1, 300))], c=[$2])
+               +- LogicalFilter(condition=[>=($1, UNIX_TIMESTAMP(_UTF-16LE'${startTime}'))])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -683,11 +698,13 @@ LogicalLegacySink(name=[`default_catalog`.`default_database`.`retractSink1`], fi
    +- LogicalFilter(condition=[>=($1, 5)])
       +- LogicalUnion(all=[true])
          :- LogicalProject(a=[$0], b=[$1], c=[$2])
-         :  +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%hello%')])
-         :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+         :  +- LogicalProject(a=[$0], b=[$1], c=[$2])
+         :     +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%hello%')])
+         :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
          +- LogicalProject(a=[$0], b=[$1], c=[$2])
-            +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%world%')])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2])
+               +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%world%')])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`retractSink2`], fields=[b, cnt])
 +- LogicalProject(b=[$0], cnt=[$1])
@@ -696,11 +713,13 @@ LogicalLegacySink(name=[`default_catalog`.`default_database`.`retractSink2`], fi
          +- LogicalProject(b=[$1], a=[$0])
             +- LogicalUnion(all=[true])
                :- LogicalProject(a=[$0], b=[$1], c=[$2])
-               :  +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%hello%')])
-               :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+               :  +- LogicalProject(a=[$0], b=[$1], c=[$2])
+               :     +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%hello%')])
+               :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
                +- LogicalProject(a=[$0], b=[$1], c=[$2])
-                  +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%world%')])
-                     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2])
+                     +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%world%')])
+                        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`upsertSink`], fields=[b, cnt])
 +- LogicalProject(b=[$0], cnt=[$1])
@@ -709,11 +728,13 @@ LogicalLegacySink(name=[`default_catalog`.`default_database`.`upsertSink`], fiel
          +- LogicalProject(b=[$1], a=[$0])
             +- LogicalUnion(all=[true])
                :- LogicalProject(a=[$0], b=[$1], c=[$2])
-               :  +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%hello%')])
-               :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+               :  +- LogicalProject(a=[$0], b=[$1], c=[$2])
+               :     +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%hello%')])
+               :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
                +- LogicalProject(a=[$0], b=[$1], c=[$2])
-                  +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%world%')])
-                     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2])
+                     +- LogicalFilter(condition=[LIKE($2, _UTF-16LE'%world%')])
+                        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -825,15 +846,17 @@ LegacySink(name=[`default_catalog`.`default_database`.`appendSink`], fields=[a1,
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`appendSink`], fields=[a1, b1])
 +- LogicalUnion(all=[true])
    :- LogicalProject(a1=[$0], b1=[$1])
-   :  +- LogicalFilter(condition=[<=($0, 10)])
-   :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
-   +- LogicalProject(a=[$2], b1=[$1])
-      +- LogicalFilter(condition=[=($2, $0)])
-         +- LogicalJoin(condition=[true], joinType=[inner])
-            :- LogicalProject(a1=[$0], b1=[$1])
-            :  +- LogicalFilter(condition=[<=($0, 10)])
-            :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+   :  +- LogicalProject(a1=[$0], b1=[$1])
+   :     +- LogicalFilter(condition=[<=($0, 10)])
+   :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(a=[$0], b1=[$1])
+      +- LogicalProject(a=[$2], b1=[$1])
+         +- LogicalFilter(condition=[=($2, $0)])
+            +- LogicalJoin(condition=[true], joinType=[inner])
+               :- LogicalProject(a1=[$0], b1=[$1])
+               :  +- LogicalFilter(condition=[<=($0, 10)])
+               :     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -1040,7 +1063,8 @@ LogicalLegacySink(name=[`default_catalog`.`default_database`.`retractSink`], fie
 +- LogicalProject(a=[$0], b=[$1], c=[$2], rank_num=[$3])
    +- LogicalFilter(condition=[<=($3, 10)])
       +- LogicalProject(a=[$0], b=[$1], c=[$2], rank_num=[ROW_NUMBER() OVER (PARTITION BY $1 ORDER BY $2 DESC NULLS LAST)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2])
+            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`upsertSink`], fields=[a, b])
 +- LogicalProject(a=[$0], b=[$1])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DeduplicateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DeduplicateTest.xml
index 62312e2c5b9..e5a52edd290 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DeduplicateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/DeduplicateTest.xml
@@ -78,10 +78,11 @@ Calc(select=[a, 3 AS $1])
 LogicalProject(b=[$0], EXPR$1=[$2], EXPR$2=[TUMBLE_START($1)])
 +- LogicalAggregate(group=[{0, 1}], EXPR$1=[SUM($2)])
    +- LogicalProject(b=[$1], $f1=[$TUMBLE($2, 4:INTERVAL SECOND)], a=[$0])
-      +- LogicalFilter(condition=[=($3, 1)])
-         +- LogicalProject(a=[$0], b=[$1], ts=[$2], rowNum=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $2 DESC NULLS LAST)])
-            +- LogicalWatermarkAssigner(rowtime=[ts], watermark=[$2])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [CollectionTableSource(a, b, ts)]]])
+      +- LogicalProject(a=[$0], b=[$1], ts=[$2])
+         +- LogicalFilter(condition=[=($3, 1)])
+            +- LogicalProject(a=[$0], b=[$1], ts=[$2], rowNum=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $2 DESC NULLS LAST)])
+               +- LogicalWatermarkAssigner(rowtime=[ts], watermark=[$2])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [CollectionTableSource(a, b, ts)]]])
 
 == Optimized Physical Plan ==
 Calc(select=[b, EXPR$1, w$start AS EXPR$2])
@@ -122,11 +123,12 @@ SELECT COUNT(b) FROM (
       <![CDATA[
 LogicalAggregate(group=[{}], EXPR$0=[COUNT($0)])
 +- LogicalProject(b=[$1])
-   +- LogicalFilter(condition=[<=($4, 1)])
-      +- LogicalProject(a=[$0], b=[$1], rowtime=[$2], proctime=[$3], rank_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $2 NULLS FIRST)])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
-            +- LogicalProject(a=[$0], b=[$1], rowtime=[$2], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [CollectionTableSource(a, b, rowtime)]]])
+   +- LogicalProject(a=[$0], b=[$1])
+      +- LogicalFilter(condition=[<=($4, 1)])
+         +- LogicalProject(a=[$0], b=[$1], rowtime=[$2], proctime=[$3], rank_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $2 NULLS FIRST)])
+            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
+               +- LogicalProject(a=[$0], b=[$1], rowtime=[$2], proctime=[PROCTIME()])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [CollectionTableSource(a, b, rowtime)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -162,11 +164,12 @@ SELECT COUNT(b) FROM (
       <![CDATA[
 LogicalAggregate(group=[{}], EXPR$0=[COUNT($0)])
 +- LogicalProject(b=[$1])
-   +- LogicalFilter(condition=[=($4, 1)])
-      +- LogicalProject(a=[$0], b=[$1], rowtime=[$2], proctime=[$3], rank_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $2 DESC NULLS LAST)])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
-            +- LogicalProject(a=[$0], b=[$1], rowtime=[$2], proctime=[PROCTIME()])
-               +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [CollectionTableSource(a, b, rowtime)]]])
+   +- LogicalProject(a=[$0], b=[$1])
+      +- LogicalFilter(condition=[=($4, 1)])
+         +- LogicalProject(a=[$0], b=[$1], rowtime=[$2], proctime=[$3], rank_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $2 DESC NULLS LAST)])
+            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$2])
+               +- LogicalProject(a=[$0], b=[$1], rowtime=[$2], proctime=[PROCTIME()])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, T, source: [CollectionTableSource(a, b, rowtime)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MatchRecognizeTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MatchRecognizeTest.xml
index 0040d931ae4..17d9f91cd31 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MatchRecognizeTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MatchRecognizeTest.xml
@@ -143,9 +143,10 @@ FROM T
     <Resource name="ast">
       <![CDATA[
 LogicalProject(symbol=[$0], price=[$1], tax=[$2], matchRowtime=[$3], price_sum=[CASE(>(COUNT($1) OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST), 0), $SUM0($1) OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST), null:INTEGER)]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime, INTEGER price_sum)]
-+- LogicalMatch(partition=[[0]], order=[[1 ASC-nulls-first]], outputFields=[[symbol, price, tax, matchRowtime]], allRows=[false], after=[FLAG(SKIP TO NEXT ROW)], pattern=[_UTF-16LE'A'], isStrictStarts=[false], isStrictEnds=[false], subsets=[[]], patternDefinitions=[[>(PREV(A.$2, 0), 0)]], inputFields=[[symbol, ts_ltz, price, tax]]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime)]
-   +- LogicalWatermarkAssigner(rowtime=[ts_ltz], watermark=[-($1, 1000:INTERVAL SECOND)]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_LTZ(3) *ROWTIME* ts_ltz, INTEGER price, INTEGER tax)]
-      +- LogicalTableScan(table=[[default_catalog, default_database, Ticker]]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) ts_ltz, INTEGER price, INTEGER tax)]
++- LogicalProject(symbol=[$0], price=[$1], tax=[$2], matchRowtime=[$3]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime)]
+   +- LogicalMatch(partition=[[0]], order=[[1 ASC-nulls-first]], outputFields=[[symbol, price, tax, matchRowtime]], allRows=[false], after=[FLAG(SKIP TO NEXT ROW)], pattern=[_UTF-16LE'A'], isStrictStarts=[false], isStrictEnds=[false], subsets=[[]], patternDefinitions=[[>(PREV(A.$2, 0), 0)]], inputFields=[[symbol, ts_ltz, price, tax]]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime)]
+      +- LogicalWatermarkAssigner(rowtime=[ts_ltz], watermark=[-($1, 1000:INTERVAL SECOND)]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_LTZ(3) *ROWTIME* ts_ltz, INTEGER price, INTEGER tax)]
+         +- LogicalTableScan(table=[[default_catalog, default_database, Ticker]]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) ts_ltz, INTEGER price, INTEGER tax)]
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -219,9 +220,10 @@ FROM TABLE(TUMBLE(TABLE T, DESCRIPTOR(matchRowtime), INTERVAL '3' second))
 LogicalProject(symbol=[$0], price=[$1], tax=[$2], matchRowtime=[$3], window_start=[$4], window_end=[$5], window_time=[$6]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *ROWTIME* window_time)]
 +- LogicalTableFunctionScan(invocation=[TUMBLE($3, DESCRIPTOR($3), 3000:INTERVAL SECOND)], rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *ROWTIME* window_time)]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP_LTZ(3) *ROWTIME* window_time)]
    +- LogicalProject(symbol=[$0], price=[$1], tax=[$2], matchRowtime=[$3]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime)]
-      +- LogicalMatch(partition=[[0]], order=[[1 ASC-nulls-first]], outputFields=[[symbol, price, tax, matchRowtime]], allRows=[false], after=[FLAG(SKIP TO NEXT ROW)], pattern=[_UTF-16LE'A'], isStrictStarts=[false], isStrictEnds=[false], subsets=[[]], patternDefinitions=[[>(PREV(A.$2, 0), 0)]], inputFields=[[symbol, ts_ltz, price, tax]]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime)]
-         +- LogicalWatermarkAssigner(rowtime=[ts_ltz], watermark=[-($1, 1000:INTERVAL SECOND)]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_LTZ(3) *ROWTIME* ts_ltz, INTEGER price, INTEGER tax)]
-            +- LogicalTableScan(table=[[default_catalog, default_database, Ticker]]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) ts_ltz, INTEGER price, INTEGER tax)]
+      +- LogicalProject(symbol=[$0], price=[$1], tax=[$2], matchRowtime=[$3]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime)]
+         +- LogicalMatch(partition=[[0]], order=[[1 ASC-nulls-first]], outputFields=[[symbol, price, tax, matchRowtime]], allRows=[false], after=[FLAG(SKIP TO NEXT ROW)], pattern=[_UTF-16LE'A'], isStrictStarts=[false], isStrictEnds=[false], subsets=[[]], patternDefinitions=[[>(PREV(A.$2, 0), 0)]], inputFields=[[symbol, ts_ltz, price, tax]]), rowType=[RecordType(VARCHAR(2147483647) symbol, INTEGER price, INTEGER tax, TIMESTAMP_LTZ(3) *ROWTIME* matchRowtime)]
+            +- LogicalWatermarkAssigner(rowtime=[ts_ltz], watermark=[-($1, 1000:INTERVAL SECOND)]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_LTZ(3) *ROWTIME* ts_ltz, INTEGER price, INTEGER tax)]
+               +- LogicalTableScan(table=[[default_catalog, default_database, Ticker]]), rowType=[RecordType(VARCHAR(2147483647) symbol, TIMESTAMP_WITH_LOCAL_TIME_ZONE(3) ts_ltz, INTEGER price, INTEGER tax)]
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MiniBatchIntervalInferTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MiniBatchIntervalInferTest.xml
index 2b272c6efa5..211411cb722 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MiniBatchIntervalInferTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/MiniBatchIntervalInferTest.xml
@@ -35,13 +35,14 @@ limitations under the License.
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)])
 +- LogicalProject(b=[$1], a=[$0])
-   +- LogicalJoin(condition=[AND(=($0, $5), >=($4, -($9, 5000:INTERVAL SECOND)), <=($4, +($9, 10000:INTERVAL SECOND)))], joinType=[inner])
-      :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
-      :  +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
-      :     +- LogicalTableScan(table=[[default_catalog, default_database, wmTable1]])
-      +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
-            +- LogicalTableScan(table=[[default_catalog, default_database, wmTable2]])
+   +- LogicalProject(a=[$0], b=[$1])
+      +- LogicalJoin(condition=[AND(=($0, $5), >=($4, -($9, 5000:INTERVAL SECOND)), <=($4, +($9, 10000:INTERVAL SECOND)))], joinType=[inner])
+         :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
+         :  +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
+         :     +- LogicalTableScan(table=[[default_catalog, default_database, wmTable1]])
+         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
+               +- LogicalTableScan(table=[[default_catalog, default_database, wmTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -98,7 +99,8 @@ Calc(select=[long, cnt, w$end AS rt])
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[COUNT(DISTINCT $1)], EXPR$2=[MAX($0)], EXPR$3=[SUM($2)])
 +- LogicalProject(b=[$1], a=[$0], c=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -155,14 +157,15 @@ GlobalGroupAggregate(groupBy=[b], select=[b, COUNT(distinct$0 count$0) AS EXPR$1
       <![CDATA[
 LogicalProject(b=[$0], EXPR$1=[$2], EXPR$2=[TUMBLE_START($1)], EXPR$3=[TUMBLE_END($1)])
 +- LogicalAggregate(group=[{0, 1}], EXPR$1=[COUNT($2)])
-   +- LogicalProject(b=[$1], $f1=[$TUMBLE($4, 5000:INTERVAL SECOND)], a=[$0])
-      +- LogicalJoin(condition=[AND(=($0, $5), >=($4, -($9, 5000:INTERVAL SECOND)), <=($4, +($9, 10000:INTERVAL SECOND)))], joinType=[inner])
-         :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
-         :  +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
-         :     +- LogicalTableScan(table=[[default_catalog, default_database, wmTable1]])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
-               +- LogicalTableScan(table=[[default_catalog, default_database, wmTable2]])
+   +- LogicalProject(b=[$1], $f1=[$TUMBLE($2, 5000:INTERVAL SECOND)], a=[$0])
+      +- LogicalProject(a=[$0], b=[$1], rt=[$4])
+         +- LogicalJoin(condition=[AND(=($0, $5), >=($4, -($9, 5000:INTERVAL SECOND)), <=($4, +($9, 10000:INTERVAL SECOND)))], joinType=[inner])
+            :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
+            :  +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
+            :     +- LogicalTableScan(table=[[default_catalog, default_database, wmTable1]])
+            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, wmTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -212,20 +215,21 @@ Calc(select=[b, EXPR$1, w$start AS EXPR$2, w$end AS EXPR$3])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(b=[$0], EXPR$1=[COUNT($1) OVER (PARTITION BY $0 ORDER BY $2 NULLS FIRST ROWS 5 PRECEDING)])
-+- LogicalJoin(condition=[AND(=($1, $4), >=($2, -($5, 5000:INTERVAL SECOND)), <=($2, +($5, 10000:INTERVAL SECOND)))], joinType=[inner])
-   :- LogicalProject(b=[$0], a=[$2], rt=[TUMBLE_ROWTIME($1)])
-   :  +- LogicalAggregate(group=[{0, 1}], a=[COUNT($2)])
-   :     +- LogicalProject(b=[$1], $f1=[$TUMBLE($4, 5000:INTERVAL SECOND)], a=[$0])
-   :        +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
-   :           +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
-   :              +- LogicalTableScan(table=[[default_catalog, default_database, wmTable1]])
-   +- LogicalProject(b=[$0], a=[$2], rt=[HOP_ROWTIME($1)])
-      +- LogicalAggregate(group=[{0, 1}], a=[COUNT($2)])
-         +- LogicalProject(b=[$1], $f1=[$HOP($4, 5000:INTERVAL SECOND, 6000:INTERVAL SECOND)], a=[$0])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, wmTable2]])
+LogicalProject(b=[$1], EXPR$1=[COUNT($0) OVER (PARTITION BY $1 ORDER BY $2 NULLS FIRST ROWS 5 PRECEDING)])
++- LogicalProject(a=[$1], b=[$0], rt=[$2])
+   +- LogicalJoin(condition=[AND(=($1, $4), >=($2, -($5, 5000:INTERVAL SECOND)), <=($2, +($5, 10000:INTERVAL SECOND)))], joinType=[inner])
+      :- LogicalProject(b=[$0], a=[$2], rt=[TUMBLE_ROWTIME($1)])
+      :  +- LogicalAggregate(group=[{0, 1}], a=[COUNT($2)])
+      :     +- LogicalProject(b=[$1], $f1=[$TUMBLE($4, 5000:INTERVAL SECOND)], a=[$0])
+      :        +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
+      :           +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
+      :              +- LogicalTableScan(table=[[default_catalog, default_database, wmTable1]])
+      +- LogicalProject(b=[$0], a=[$2], rt=[HOP_ROWTIME($1)])
+         +- LogicalAggregate(group=[{0, 1}], a=[COUNT($2)])
+            +- LogicalProject(b=[$1], $f1=[$HOP($4, 5000:INTERVAL SECOND, 6000:INTERVAL SECOND)], a=[$0])
+               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, wmTable2]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -273,18 +277,21 @@ Calc(select=[b, w0$o0 AS $1])
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1])
-+- LogicalJoin(condition=[=($2, $4)], joinType=[inner])
-   :- LogicalProject(a=[$0], b=[$1], a0=[CAST($0):BIGINT])
-   :  +- LogicalAggregate(group=[{0}], b=[COUNT($1)])
-   :     +- LogicalProject(a=[$0], b=[$1])
-   :        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
-   +- LogicalAggregate(group=[{0}], a=[COUNT()])
-      +- LogicalProject(b=[$0])
-         +- LogicalAggregate(group=[{0, 1}], a=[COUNT($2)])
-            +- LogicalProject(b=[$1], $f1=[$HOP($4, 5000:INTERVAL SECOND, 6000:INTERVAL SECOND)], a=[$0])
-               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
-                  +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
-                     +- LogicalTableScan(table=[[default_catalog, default_database, wmTable1]])
++- LogicalProject(a=[$0], b=[$1], b0=[$3], a1=[$4])
+   +- LogicalJoin(condition=[=($2, $4)], joinType=[inner])
+      :- LogicalProject(a=[$0], b=[$1], a0=[CAST($0):BIGINT])
+      :  +- LogicalAggregate(group=[{0}], b=[COUNT($1)])
+      :     +- LogicalProject(a=[$0], b=[$1])
+      :        +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
+      :           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+      +- LogicalAggregate(group=[{0}], a=[COUNT()])
+         +- LogicalProject(b=[$0])
+            +- LogicalProject(b=[$0], a=[$2], rt=[HOP_ROWTIME($1)])
+               +- LogicalAggregate(group=[{0, 1}], a=[COUNT($2)])
+                  +- LogicalProject(b=[$1], $f1=[$HOP($4, 5000:INTERVAL SECOND, 6000:INTERVAL SECOND)], a=[$0])
+                     +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
+                        +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
+                           +- LogicalTableScan(table=[[default_catalog, default_database, wmTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -316,32 +323,23 @@ Calc(select=[a, b])
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`appendSink1`], fields=[a, b])
 +- LogicalProject(id1=[$1], EXPR$1=[$2])
    +- LogicalAggregate(group=[{0, 1}], EXPR$1=[LISTAGG($2, $3)])
-      +- LogicalProject($f0=[$HOP(TUMBLE_ROWTIME($0), 12000:INTERVAL SECOND, 4000:INTERVAL SECOND)], id1=[$1], text=[$2], $f3=[_UTF-16LE'*'])
-         +- LogicalAggregate(group=[{0, 1}], text=[LISTAGG($2, $3)])
-            +- LogicalProject($f0=[$TUMBLE($1, 6000:INTERVAL SECOND)], id1=[$0], text=[$2], $f3=[_UTF-16LE'#'])
-               +- LogicalFilter(condition=[AND(=($0, $3), >($1, -($4, 300000:INTERVAL MINUTE)), <($1, +($4, 180000:INTERVAL MINUTE)))])
-                  +- LogicalJoin(condition=[true], joinType=[inner])
-                     :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
-                     :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-                     +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
-                        +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+      +- LogicalProject($f0=[$HOP($2, 12000:INTERVAL SECOND, 4000:INTERVAL SECOND)], id1=[$0], text=[$1], $f3=[_UTF-16LE'*'])
+         +- LogicalProject(id1=[$1], text=[$2], ts=[TUMBLE_ROWTIME($0)])
+            +- LogicalAggregate(group=[{0, 1}], text=[LISTAGG($2, $3)])
+               +- LogicalProject($f0=[$TUMBLE($1, 6000:INTERVAL SECOND)], id1=[$0], text=[$2], $f3=[_UTF-16LE'#'])
+                  +- LogicalProject(id1=[$0], ts=[$1], text=[$2])
+                     +- LogicalFilter(condition=[AND(=($0, $3), >($1, -($4, 300000:INTERVAL MINUTE)), <($1, +($4, 180000:INTERVAL MINUTE)))])
+                        +- LogicalJoin(condition=[true], joinType=[inner])
+                           :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
+                           :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+                           +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
+                              +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`appendSink2`], fields=[a, b])
 +- LogicalProject(id1=[$1], EXPR$1=[$2])
    +- LogicalAggregate(group=[{0, 1}], EXPR$1=[LISTAGG($2, $3)])
       +- LogicalProject($f0=[$TUMBLE($1, 9000:INTERVAL SECOND)], id1=[$0], text=[$2], $f3=[_UTF-16LE'-'])
-         +- LogicalFilter(condition=[AND(=($0, $3), >($1, -($4, 300000:INTERVAL MINUTE)), <($1, +($4, 180000:INTERVAL MINUTE)))])
-            +- LogicalJoin(condition=[true], joinType=[inner])
-               :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
-               :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
-
-LogicalLegacySink(name=[`default_catalog`.`default_database`.`appendSink3`], fields=[a, b])
-+- LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)])
-   +- LogicalProject(id1=[$1], text=[$2])
-      +- LogicalAggregate(group=[{0, 1}], text=[LISTAGG($2, $3)])
-         +- LogicalProject($f0=[$TUMBLE($1, 6000:INTERVAL SECOND)], id1=[$0], text=[$2], $f3=[_UTF-16LE'#'])
+         +- LogicalProject(id1=[$0], ts=[$1], text=[$2])
             +- LogicalFilter(condition=[AND(=($0, $3), >($1, -($4, 300000:INTERVAL MINUTE)), <($1, +($4, 180000:INTERVAL MINUTE)))])
                +- LogicalJoin(condition=[true], joinType=[inner])
                   :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
@@ -349,80 +347,98 @@ LogicalLegacySink(name=[`default_catalog`.`default_database`.`appendSink3`], fie
                   +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
                      +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
 
+LogicalLegacySink(name=[`default_catalog`.`default_database`.`appendSink3`], fields=[a, b])
++- LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)])
+   +- LogicalProject(id1=[$0], text=[$1])
+      +- LogicalProject(id1=[$1], text=[$2], ts=[TUMBLE_ROWTIME($0)])
+         +- LogicalAggregate(group=[{0, 1}], text=[LISTAGG($2, $3)])
+            +- LogicalProject($f0=[$TUMBLE($1, 6000:INTERVAL SECOND)], id1=[$0], text=[$2], $f3=[_UTF-16LE'#'])
+               +- LogicalProject(id1=[$0], ts=[$1], text=[$2])
+                  +- LogicalFilter(condition=[AND(=($0, $3), >($1, -($4, 300000:INTERVAL MINUTE)), <($1, +($4, 180000:INTERVAL MINUTE)))])
+                     +- LogicalJoin(condition=[true], joinType=[inner])
+                        :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
+                        :  +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+                        +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$1])
+                           +- LogicalTableScan(table=[[default_catalog, default_database, T2]])
+
 == Optimized Physical Plan ==
 LegacySink(name=[`default_catalog`.`default_database`.`appendSink1`], fields=[a, b])
 +- GroupWindowAggregate(groupBy=[id1], window=[SlidingGroupWindow('w$, $f0, 4000, 12000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
    +- Exchange(distribution=[hash[id1]])
       +- Calc(select=[w$rowtime AS $f0, id1, text, _UTF-16LE'*' AS $f3])
-         +- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, rowtime, 6000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[id1, LISTAGG(text, $f3) AS text, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])
+         +- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, ts, 6000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[id1, LISTAGG(text, $f3) AS text, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])
             +- Exchange(distribution=[hash[id1]])
-               +- Calc(select=[rowtime, id1, text, _UTF-16LE'#' AS $f3])
-                  +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=1, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, rowtime, text, id2, rowtime0, cnt, name, goods])
-                     :- Exchange(distribution=[hash[id1]])
-                     :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-                     :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[id1, rowtime, text])
-                     +- Exchange(distribution=[hash[id2]])
-                        +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-                           +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[id2, rowtime, cnt, name, goods])
+               +- Calc(select=[ts, id1, text, _UTF-16LE'#' AS $f3])
+                  +- Calc(select=[id1, rowtime AS ts, text])
+                     +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=1, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, rowtime, text, id2, rowtime0])
+                        :- Exchange(distribution=[hash[id1]])
+                        :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+                        :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[id1, rowtime, text])
+                        +- Exchange(distribution=[hash[id2]])
+                           +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+                              +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[id2, rowtime], metadata=[]]], fields=[id2, rowtime])
 
 LegacySink(name=[`default_catalog`.`default_database`.`appendSink2`], fields=[a, b])
-+- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, rowtime, 9000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
++- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, ts, 9000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
    +- Exchange(distribution=[hash[id1]])
-      +- Calc(select=[rowtime, id1, text, _UTF-16LE'-' AS $f3])
-         +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=1, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, rowtime, text, id2, rowtime0, cnt, name, goods])
-            :- Exchange(distribution=[hash[id1]])
-            :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-            :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[id1, rowtime, text])
-            +- Exchange(distribution=[hash[id2]])
-               +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-                  +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[id2, rowtime, cnt, name, goods])
+      +- Calc(select=[ts, id1, text, _UTF-16LE'-' AS $f3])
+         +- Calc(select=[id1, rowtime AS ts, text])
+            +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=1, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, rowtime, text, id2, rowtime0])
+               :- Exchange(distribution=[hash[id1]])
+               :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+               :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[id1, rowtime, text])
+               +- Exchange(distribution=[hash[id2]])
+                  +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+                     +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[id2, rowtime], metadata=[]]], fields=[id2, rowtime])
 
 LegacySink(name=[`default_catalog`.`default_database`.`appendSink3`], fields=[a, b])
 +- GlobalGroupAggregate(groupBy=[id1], select=[id1, COUNT(count$0) AS EXPR$1])
    +- Exchange(distribution=[hash[id1]])
       +- LocalGroupAggregate(groupBy=[id1], select=[id1, COUNT(text) AS count$0])
-         +- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, rowtime, 6000)], select=[id1, LISTAGG(text, $f3) AS text])
+         +- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, ts, 6000)], select=[id1, LISTAGG(text, $f3) AS text])
             +- Exchange(distribution=[hash[id1]])
-               +- Calc(select=[rowtime, id1, text, _UTF-16LE'#' AS $f3])
-                  +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=1, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, rowtime, text, id2, rowtime0, cnt, name, goods])
-                     :- Exchange(distribution=[hash[id1]])
-                     :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-                     :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[id1, rowtime, text])
-                     +- Exchange(distribution=[hash[id2]])
-                        +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-                           +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[id2, rowtime, cnt, name, goods])
+               +- Calc(select=[ts, id1, text, _UTF-16LE'#' AS $f3])
+                  +- Calc(select=[id1, rowtime AS ts, text])
+                     +- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=1, rightTimeIndex=1], where=[AND(=(id1, id2), >(rowtime, -(rowtime0, 300000:INTERVAL MINUTE)), <(rowtime, +(rowtime0, 180000:INTERVAL MINUTE)))], select=[id1, rowtime, text, id2, rowtime0])
+                        :- Exchange(distribution=[hash[id1]])
+                        :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+                        :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[id1, rowtime, text])
+                        +- Exchange(distribution=[hash[id2]])
+                           +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+                              +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[id2, rowtime], metadata=[]]], fields=[id2, rowtime])
 
 == Optimized Execution Plan ==
-IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=1, rightTimeIndex=1], where=[((id1 = id2) AND (rowtime > (rowtime0 - 300000:INTERVAL MINUTE)) AND (rowtime < (rowtime0 + 180000:INTERVAL MINUTE)))], select=[id1, rowtime, text, id2, rowtime0, cnt, name, goods])(reuse_id=[1])
-:- Exchange(distribution=[hash[id1]])
-:  +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-:     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[id1, rowtime, text])
-+- Exchange(distribution=[hash[id2]])
-   +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
-      +- TableSourceScan(table=[[default_catalog, default_database, T2]], fields=[id2, rowtime, cnt, name, goods])
+Calc(select=[id1, rowtime AS ts, text])(reuse_id=[1])
++- IntervalJoin(joinType=[InnerJoin], windowBounds=[isRowTime=true, leftLowerBound=-299999, leftUpperBound=179999, leftTimeIndex=1, rightTimeIndex=1], where=[((id1 = id2) AND (rowtime > (rowtime0 - 300000:INTERVAL MINUTE)) AND (rowtime < (rowtime0 + 180000:INTERVAL MINUTE)))], select=[id1, rowtime, text, id2, rowtime0])
+   :- Exchange(distribution=[hash[id1]])
+   :  +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+   :     +- TableSourceScan(table=[[default_catalog, default_database, T1]], fields=[id1, rowtime, text])
+   +- Exchange(distribution=[hash[id2]])
+      +- WatermarkAssigner(rowtime=[rowtime], watermark=[rowtime])
+         +- TableSourceScan(table=[[default_catalog, default_database, T2, project=[id2, rowtime], metadata=[]]], fields=[id2, rowtime])
 
 Exchange(distribution=[hash[id1]])(reuse_id=[2])
-+- Calc(select=[rowtime, id1, text, '#' AS $f3])
++- Calc(select=[ts, id1, text, '#' AS $f3])
    +- Reused(reference_id=[1])
 
 LegacySink(name=[`default_catalog`.`default_database`.`appendSink1`], fields=[a, b])
 +- GroupWindowAggregate(groupBy=[id1], window=[SlidingGroupWindow('w$, $f0, 4000, 12000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
    +- Exchange(distribution=[hash[id1]])
       +- Calc(select=[w$rowtime AS $f0, id1, text, '*' AS $f3])
-         +- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, rowtime, 6000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[id1, LISTAGG(text, $f3) AS text, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])
+         +- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, ts, 6000)], properties=[w$start, w$end, w$rowtime, w$proctime], select=[id1, LISTAGG(text, $f3) AS text, start('w$) AS w$start, end('w$) AS w$end, rowtime('w$) AS w$rowtime, proctime('w$) AS w$proctime])
             +- Reused(reference_id=[2])
 
 LegacySink(name=[`default_catalog`.`default_database`.`appendSink2`], fields=[a, b])
-+- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, rowtime, 9000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
++- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, ts, 9000)], select=[id1, LISTAGG(text, $f3) AS EXPR$1])
    +- Exchange(distribution=[hash[id1]])
-      +- Calc(select=[rowtime, id1, text, '-' AS $f3])
+      +- Calc(select=[ts, id1, text, '-' AS $f3])
          +- Reused(reference_id=[1])
 
 LegacySink(name=[`default_catalog`.`default_database`.`appendSink3`], fields=[a, b])
 +- GlobalGroupAggregate(groupBy=[id1], select=[id1, COUNT(count$0) AS EXPR$1])
    +- Exchange(distribution=[hash[id1]])
       +- LocalGroupAggregate(groupBy=[id1], select=[id1, COUNT(text) AS count$0])
-         +- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, rowtime, 6000)], select=[id1, LISTAGG(text, $f3) AS text])
+         +- GroupWindowAggregate(groupBy=[id1], window=[TumblingGroupWindow('w$, ts, 6000)], select=[id1, LISTAGG(text, $f3) AS text])
             +- Reused(reference_id=[2])
 ]]>
     </Resource>
@@ -443,8 +459,9 @@ LegacySink(name=[`default_catalog`.`default_database`.`appendSink3`], fields=[a,
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)])
-+- LogicalProject(cnt=[COUNT($2) OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST ROWS 5 PRECEDING)], int=[$1])
-   +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
++- LogicalProject(cnt=[$1], int=[$0])
+   +- LogicalProject(int=[$1], cnt=[COUNT($2) OVER (PARTITION BY $0 ORDER BY $3 NULLS FIRST ROWS 5 PRECEDING)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -475,10 +492,11 @@ GlobalGroupAggregate(groupBy=[cnt], select=[cnt, COUNT(count$0) AS EXPR$1])
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)])
-+- LogicalProject(cnt=[COUNT($0) OVER (PARTITION BY $2 ORDER BY $4 NULLS FIRST ROWS 5 PRECEDING)], c=[$2])
-   +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
-         +- LogicalTableScan(table=[[default_catalog, default_database, wmTable1]])
++- LogicalProject(cnt=[$1], c=[$0])
+   +- LogicalProject(c=[$2], cnt=[COUNT($0) OVER (PARTITION BY $2 ORDER BY $4 NULLS FIRST ROWS 5 PRECEDING)])
+      +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
+            +- LogicalTableScan(table=[[default_catalog, default_database, wmTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -537,12 +555,13 @@ GlobalGroupAggregate(groupBy=[b], select=[b, COUNT(distinct$0 count$0) AS EXPR$1
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)])
-+- LogicalProject(r_a=[$5], o_a=[$0])
-   +- LogicalFilter(condition=[=($1, $6)])
-      +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{4}])
-         :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 0:INTERVAL MILLISECOND)])
-         :  +- LogicalTableScan(table=[[default_catalog, default_database, MyDataStream1]])
-         +- LogicalTableFunctionScan(invocation=[Rates($cor0.rowtime)], rowType=[RecordType:peek_no_expand(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) *ROWTIME* rowtime)])
++- LogicalProject(r_a=[$1], o_a=[$0])
+   +- LogicalProject(o_a=[$0], r_a=[$5])
+      +- LogicalFilter(condition=[=($1, $6)])
+         +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{4}])
+            :- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($4, 0:INTERVAL MILLISECOND)])
+            :  +- LogicalTableScan(table=[[default_catalog, default_database, MyDataStream1]])
+            +- LogicalTableFunctionScan(invocation=[Rates($cor0.rowtime)], rowType=[RecordType:peek_no_expand(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) *ROWTIME* rowtime)])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -584,12 +603,13 @@ GlobalGroupAggregate(groupBy=[r_a], select=[r_a, COUNT(count$0) AS EXPR$1])
       <![CDATA[
 LogicalProject(b=[$0], EXPR$1=[$2])
 +- LogicalAggregate(group=[{0, 1}], EXPR$1=[SUM($2)])
-   +- LogicalProject(b=[$0], $f1=[$TUMBLE(TUMBLE_ROWTIME($1), 5000:INTERVAL SECOND)], cnt=[$2])
-      +- LogicalAggregate(group=[{0, 1}], cnt=[COUNT($2)])
-         +- LogicalProject(b=[$1], $f1=[$TUMBLE($4, 10000:INTERVAL SECOND)], a=[$0])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, wmTable1]])
+   +- LogicalProject(b=[$0], $f1=[$TUMBLE($2, 5000:INTERVAL SECOND)], cnt=[$1])
+      +- LogicalProject(b=[$0], cnt=[$2], rt=[TUMBLE_ROWTIME($1)])
+         +- LogicalAggregate(group=[{0, 1}], cnt=[COUNT($2)])
+            +- LogicalProject(b=[$1], $f1=[$TUMBLE($4, 10000:INTERVAL SECOND)], a=[$0])
+               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, wmTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -622,12 +642,13 @@ GroupWindowAggregate(groupBy=[b], window=[TumblingGroupWindow('w$, $f1, 5000)],
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[SUM($1)])
-+- LogicalProject(b=[$0], cnt=[$2])
-   +- LogicalAggregate(group=[{0, 1}], cnt=[COUNT($2)])
-      +- LogicalProject(b=[$1], $f1=[$HOP($4, 5000:INTERVAL SECOND, 6000:INTERVAL SECOND)], a=[$0])
-         +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
-               +- LogicalTableScan(table=[[default_catalog, default_database, wmTable1]])
++- LogicalProject(b=[$0], cnt=[$1])
+   +- LogicalProject(b=[$0], cnt=[$2], w_start=[HOP_START($1)], w_end=[HOP_END($1)])
+      +- LogicalAggregate(group=[{0, 1}], cnt=[COUNT($2)])
+         +- LogicalProject(b=[$1], $f1=[$HOP($4, 5000:INTERVAL SECOND, 6000:INTERVAL SECOND)], a=[$0])
+            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[$4])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[PROCTIME()], rowtime=[$3])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, wmTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/NonDeterministicDagTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/NonDeterministicDagTest.xml
index 0407c12db84..c8a69536d4c 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/NonDeterministicDagTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/NonDeterministicDagTest.xml
@@ -1069,12 +1069,13 @@ from cdc t1 join cdc t2
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
-+- LogicalProject(a=[$0], b=[$6], c=[$2])
-   +- LogicalJoin(condition=[=($4, $9)], joinType=[inner])
-      :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], $f4=[ndFunc($1)])
-      :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
-      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], $f4=[ndFunc($1)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
++- LogicalProject(a=[$0], b=[$5], c=[$2])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], a0=[$5], b0=[$6], c0=[$7], d0=[$8])
+      +- LogicalJoin(condition=[=($4, $9)], joinType=[inner])
+         :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], $f4=[ndFunc($1)])
+         :  +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], $f4=[ndFunc($1)])
+            +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1512,7 +1513,8 @@ from cdc_with_meta
       <![CDATA[
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`legacy_retract_sink`], fields=[a, b, c])
 +- LogicalProject(a=[$0], metadata_3=[$6], c=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6])
+      +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1535,7 +1537,8 @@ from cdc_with_meta
       <![CDATA[
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`legacy_upsert_sink`], fields=[a, b, c])
 +- LogicalProject(a=[CAST($0):INTEGER], b=[$6], c=[CAST($2):VARCHAR(100) CHARACTER SET "UTF-16LE"])
-   +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6])
+      +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1559,7 +1562,8 @@ from cdc_with_meta
       <![CDATA[
 LogicalLegacySink(name=[`default_catalog`.`default_database`.`legacy_upsert_sink`], fields=[a, b, c])
 +- LogicalProject(a=[CAST($0):INTEGER], b=[$6], c=[CAST($2):VARCHAR(100) CHARACTER SET "UTF-16LE"])
-   +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6])
+      +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1581,8 +1585,9 @@ select a, b, c, e from cdc_with_meta_rename
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink_with_composite_pk], fields=[a, b, c, e])
-+- LogicalProject(a=[$0], b=[$1], c=[$2], e=[$4])
-   +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta_rename]])
++- LogicalProject(a=[$0], b=[$1], c=[$2], e=[$5])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_3=[$4], e=[$4])
+      +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta_rename]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1604,7 +1609,8 @@ from cdc_with_meta
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink_with_composite_pk], fields=[a, b, c, metadata_3])
 +- LogicalProject(a=[$0], b=[$1], c=[$2], metadata_3=[$6])
-   +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6])
+      +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1626,7 +1632,8 @@ from cdc_with_meta
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, metadata_3, c])
 +- LogicalProject(a=[$0], metadata_3=[$6], c=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6])
+      +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1649,7 +1656,8 @@ from cdc_with_meta
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, metadata_3, c])
 +- LogicalProject(a=[$0], metadata_3=[$6], c=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6])
+      +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1673,7 +1681,8 @@ from cdc_with_meta
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, metadata_3, c])
 +- LogicalProject(a=[$0], metadata_3=[$6], c=[$2])
-   +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6])
+      +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1907,8 +1916,9 @@ group by `day`
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0}], cnt=[COUNT()], qmt=[SUM($1)])
-+- LogicalProject(day=[CONCAT(CAST($0):VARCHAR(2147483647) CHARACTER SET "UTF-16LE" NOT NULL, DATE_FORMAT(CURRENT_TIMESTAMP, _UTF-16LE'yyMMdd'))], b=[$1])
-   +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
++- LogicalProject(day=[$4], b=[$1])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], day=[CONCAT(CAST($0):VARCHAR(2147483647) CHARACTER SET "UTF-16LE" NOT NULL, DATE_FORMAT(CURRENT_TIMESTAMP, _UTF-16LE'yyMMdd'))])
+      +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1937,8 +1947,9 @@ group by `day`, a
 LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, cnt, day])
 +- LogicalProject(a=[$1], cnt=[$2], day=[$0])
    +- LogicalAggregate(group=[{0, 1}], cnt=[COUNT()])
-      +- LogicalProject(day=[DATE_FORMAT(CURRENT_TIMESTAMP, _UTF-16LE'yyMMdd')], a=[$0])
-         +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
+      +- LogicalProject(day=[$4], a=[$0])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], day=[DATE_FORMAT(CURRENT_TIMESTAMP, _UTF-16LE'yyMMdd')])
+            +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -2367,14 +2378,18 @@ Sink(table=[default_catalog.default_database.sink_with_pk], fields=[a, qmt, day]
 LogicalSink(table=[default_catalog.default_database.sink1], fields=[a, b, d])
 +- LogicalProject(a=[$0], b=[$1], d=[CAST($2):BIGINT])
    +- LogicalAggregate(group=[{0, 1}], EXPR$2=[SUM($2)])
-      +- LogicalProject(a=[$1.nested2.num], day=[DATE_FORMAT(CURRENT_TIMESTAMP, _UTF-16LE'yyMMdd')], b=[+(+($1.nested1.value, $1.nested2.num), $3)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, nested_src]])
+      +- LogicalProject(a=[$0], day=[$2], b=[$1])
+         +- LogicalProject(a=[$1], b=[$3], day=[DATE_FORMAT(CURRENT_TIMESTAMP, _UTF-16LE'yyMMdd')])
+            +- LogicalProject(id=[$0], a=[$1.nested2.num], name=[$1.nested1.name], b=[+(+($1.nested1.value, $1.nested2.num), $3)])
+               +- LogicalProject(id=[$0], deepNested=[$1], name=[$2], metadata_1=[$3], metadata_2=[$4])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, nested_src]])
 
 LogicalSink(table=[default_catalog.default_database.sink2], fields=[a, b, d])
 +- LogicalProject(a=[$1], b=[$2], d=[CAST($3):BIGINT])
    +- LogicalFilter(condition=[>($3, 100)])
       +- LogicalProject(id=[$0], a=[$1.nested2.num], name=[$1.nested1.name], b=[+(+($1.nested1.value, $1.nested2.num), $3)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, nested_src]])
+         +- LogicalProject(id=[$0], deepNested=[$1], name=[$2], metadata_1=[$3], metadata_2=[$4])
+            +- LogicalTableScan(table=[[default_catalog, default_database, nested_src]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -2504,9 +2519,11 @@ select a, b, c, d from (
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, b, c])
 +- LogicalProject(a=[$0], b=[IF(>($0, 100), +($1, $3), $1)], c=[CASE(>($3, 100), JSON_VALUE($2, _UTF-16LE'$.count'), ||(CAST($1):VARCHAR(2147483647) CHARACTER SET "UTF-16LE", _UTF-16LE'#'))])
-   +- LogicalFilter(condition=[=($4, 1)])
-      +- LogicalProject(a=[$0], b=[$3], c=[$2], d=[ndFunc($1)], rn=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY ndFunc($1) DESC NULLS LAST)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
+      +- LogicalFilter(condition=[=($4, 1)])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], rn=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $3 DESC NULLS LAST)])
+            +- LogicalProject(a=[$0], b=[$3], c=[$2], d=[ndFunc($1)])
+               +- LogicalTableScan(table=[[default_catalog, default_database, cdc]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -2852,8 +2869,9 @@ Join(joinType=[LeftSemiJoin], where=[(c = c0)], select=[a, b, c, d], leftInputSp
 LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a, EXPR$1, day])
 +- LogicalProject(a=[$0], EXPR$1=[$2], day=[$1])
    +- LogicalAggregate(group=[{0, 1}], EXPR$1=[SUM($2)])
-      +- LogicalProject(a=[$0], day=[DATE_FORMAT(CURRENT_TIMESTAMP, _UTF-16LE'yyMMdd')], b=[$1])
-         +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_computed_col]])
+      +- LogicalProject(a=[$0], day=[$4], b=[$1])
+         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], day=[DATE_FORMAT(CURRENT_TIMESTAMP, _UTF-16LE'yyMMdd')])
+            +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_computed_col]])
 
 LogicalSink(table=[default_catalog.default_database.sink_with_pk], fields=[a, b, day])
 +- LogicalProject(a=[$0], b=[$1], day=[$4])
@@ -2921,7 +2939,8 @@ LogicalSink(table=[default_catalog.default_database.sink_with_composite_pk], fie
    :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
    :  +- LogicalTableScan(table=[[default_catalog, default_database, src]])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], metadata_3=[$6])
-      +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6])
+         +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -2952,7 +2971,8 @@ LogicalSink(table=[default_catalog.default_database.sink_without_pk], fields=[a,
    :- LogicalProject(a=[$0], b=[$1], c=[$2])
    :  +- LogicalTableScan(table=[[default_catalog, default_database, src]])
    +- LogicalProject(a=[$0], metadata_3=[$6], c=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6])
+         +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -2983,7 +3003,8 @@ LogicalSink(table=[default_catalog.default_database.sink_with_composite_pk], fie
    :- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
    :  +- LogicalTableScan(table=[[default_catalog, default_database, src]])
    +- LogicalProject(a=[$0], b=[$1], c=[$2], metadata_3=[$6])
-      +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], metadata_1=[$4], metadata_2=[$5], metadata_3=[$6])
+         +- LogicalTableScan(table=[[default_catalog, default_database, cdc_with_meta]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/RankTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/RankTest.xml
index 2e0cf0e5065..ed4bc9f8583 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/RankTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/RankTest.xml
@@ -148,11 +148,14 @@ WHERE rank_num <= 10
 LogicalProject(a=[$0], b=[$1], count_c=[$2], rank_num=[$3])
 +- LogicalFilter(condition=[<=($3, 10)])
    +- LogicalProject(a=[$0], b=[$1], count_c=[$2], rank_num=[ROW_NUMBER() OVER (ORDER BY $2 DESC NULLS LAST)])
-      +- LogicalFilter(condition=[<=($3, 10)])
-         +- LogicalProject(a=[$0], b=[$1], count_c=[$3], row_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $3 DESC NULLS LAST)])
-            +- LogicalAggregate(group=[{0, 1, 2}], count_c=[COUNT()])
-               +- LogicalProject(a=[$0], b=[$1], cn=[_UTF-16LE'cn'])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a=[$0], b=[$1], count_c=[$2], row_num=[$3])
+         +- LogicalFilter(condition=[<=($3, 10)])
+            +- LogicalProject(a=[$0], b=[$1], count_c=[$2], row_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $2 DESC NULLS LAST)])
+               +- LogicalProject(a=[$0], b=[$1], count_c=[$3])
+                  +- LogicalAggregate(group=[{0, 1, 2}], count_c=[COUNT()])
+                     +- LogicalProject(a=[$0], b=[$1], cn=[$5])
+                        +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], cn=[_UTF-16LE'cn'])
+                           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -443,12 +446,13 @@ FROM
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(url=[CONCAT(_UTF-16LE'http://txmov2.a.yximgs.com', $0)], download_count=[$1], timestamp=[$2])
-+- LogicalFilter(condition=[<=($3, 100000)])
-   +- LogicalProject(uri=[$0], reqcount=[$1], start_time=[$2], rownum_2=[ROW_NUMBER() OVER (PARTITION BY $2 ORDER BY $1 DESC NULLS LAST)])
-      +- LogicalFilter(condition=[<=($3, 100000)])
-         +- LogicalProject(uri=[$0], reqcount=[$1], start_time=[$2], rownum_1=[ROW_NUMBER() OVER (PARTITION BY $2, $3 ORDER BY $1 DESC NULLS LAST)])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+LogicalProject(url=[CONCAT(_UTF-16LE'http://txmov2.a.yximgs.com', $0)], download_count=[$1], timestamp=[$3])
++- LogicalProject(uri=[$0], reqcount=[$1], rownum_2=[$3], start_time=[$2])
+   +- LogicalFilter(condition=[<=($3, 100000)])
+      +- LogicalProject(uri=[$0], reqcount=[$1], start_time=[$2], rownum_2=[ROW_NUMBER() OVER (PARTITION BY $2 ORDER BY $1 DESC NULLS LAST)])
+         +- LogicalFilter(condition=[<=($3, 100000)])
+            +- LogicalProject(uri=[$0], reqcount=[$1], start_time=[$2], rownum_1=[ROW_NUMBER() OVER (PARTITION BY $2, $3 ORDER BY $1 DESC NULLS LAST)])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -729,11 +733,12 @@ LogicalProject(name=[$0], ids=[$1], rank_num=[$2])
    +- LogicalProject(name=[$0], ids=[$1], rank_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $1 DESC NULLS LAST)])
       +- LogicalAggregate(group=[{0}], ids=[SUM($1) FILTER $2])
          +- LogicalProject(name=[$6], id=[$5], $f2=[IS TRUE(>($5, 0))])
-            +- LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{0, 3}])
-               :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-               +- LogicalFilter(condition=[=($cor1.a, $0)])
-                  +- LogicalSnapshot(period=[$cor1.proctime])
-                     +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], id=[$5], name=[$6], age=[$7])
+               +- LogicalCorrelate(correlation=[$cor1], joinType=[inner], requiredColumns=[{0, 3}])
+                  :- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+                  +- LogicalFilter(condition=[=($cor1.a, $0)])
+                     +- LogicalSnapshot(period=[$cor1.proctime])
+                        +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -770,11 +775,12 @@ WHERE row_num <= 10
       <![CDATA[
 LogicalAggregate(group=[{}], EXPR$0=[MAX($0)])
 +- LogicalProject(a=[$0])
-   +- LogicalFilter(condition=[<=($3, 10)])
-      +- LogicalProject(a=[$0], b=[$1], count_c=[$2], row_num=[ROW_NUMBER() OVER (PARTITION BY $1 ORDER BY $2 DESC NULLS LAST)])
-         +- LogicalAggregate(group=[{0, 1}], count_c=[COUNT()])
-            +- LogicalProject(a=[$0], b=[$1])
-               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalProject(a=[$0], b=[$1], count_c=[$2], row_num=[$3])
+      +- LogicalFilter(condition=[<=($3, 10)])
+         +- LogicalProject(a=[$0], b=[$1], count_c=[$2], row_num=[ROW_NUMBER() OVER (PARTITION BY $1 ORDER BY $2 DESC NULLS LAST)])
+            +- LogicalAggregate(group=[{0, 1}], count_c=[COUNT()])
+               +- LogicalProject(a=[$0], b=[$1])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -1024,10 +1030,12 @@ WHERE row_num <= 10
       <![CDATA[
 LogicalProject(a=[$0], b=[$1], count_c=[$2], row_num=[$3])
 +- LogicalFilter(condition=[<=($3, 10)])
-   +- LogicalProject(a=[$0], b=[$1], count_c=[$3], row_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $3 DESC NULLS LAST)])
-      +- LogicalAggregate(group=[{0, 1, 2}], count_c=[COUNT()])
-         +- LogicalProject(a=[$0], b=[$1], cn=[_UTF-16LE'cn'])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalProject(a=[$0], b=[$1], count_c=[$2], row_num=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $2 DESC NULLS LAST)])
+      +- LogicalProject(a=[$0], b=[$1], count_c=[$3])
+         +- LogicalAggregate(group=[{0, 1, 2}], count_c=[COUNT()])
+            +- LogicalProject(a=[$0], b=[$1], cn=[$5])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], cn=[_UTF-16LE'cn'])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -1160,9 +1168,10 @@ LogicalProject(c=[$0], b=[$1], d=[$2])
    +- LogicalProject(c=[$0], b=[$1], d=[$2], rn=[ROW_NUMBER() OVER (PARTITION BY $0, $1 ORDER BY $2 DESC NULLS LAST)])
       +- LogicalAggregate(group=[{0, 1}], d=[SUM($2) FILTER $3])
          +- LogicalProject(c=[$2], b=[$1], a=[$0], $f3=[IS TRUE(>($0, 0))])
-            +- LogicalFilter(condition=[=($5, 1)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], rowNum=[ROW_NUMBER() OVER (PARTITION BY $2 ORDER BY PROCTIME() NULLS FIRST)])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], rowNum=[$5])
+               +- LogicalFilter(condition=[=($5, 1)])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], rowNum=[ROW_NUMBER() OVER (PARTITION BY $2 ORDER BY PROCTIME() NULLS FIRST)])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/RelTimeIndicatorConverterTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/RelTimeIndicatorConverterTest.xml
index dc9a38757bb..9fc53d2df1d 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/RelTimeIndicatorConverterTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/RelTimeIndicatorConverterTest.xml
@@ -170,10 +170,11 @@ SELECT TUMBLE_END(newrowtime, INTERVAL '30' SECOND), long, sum(`int`) FROM (
       <![CDATA[
 LogicalProject(EXPR$0=[TUMBLE_END($0)], long=[$1], EXPR$2=[$2])
 +- LogicalAggregate(group=[{0, 1}], EXPR$2=[SUM($2)])
-   +- LogicalProject($f0=[$TUMBLE(TUMBLE_ROWTIME($0), 30000:INTERVAL SECOND)], long=[$1], int=[$2])
-      +- LogicalAggregate(group=[{0, 1}], int=[SUM($2)])
-         +- LogicalProject($f0=[$TUMBLE($0, 10000:INTERVAL SECOND)], long=[$1], int=[$2])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
+   +- LogicalProject($f0=[$TUMBLE($0, 30000:INTERVAL SECOND)], long=[$1], int=[$2])
+      +- LogicalProject(newrowtime=[TUMBLE_ROWTIME($0)], long=[$1], int=[$2])
+         +- LogicalAggregate(group=[{0, 1}], int=[SUM($2)])
+            +- LogicalProject($f0=[$TUMBLE($0, 10000:INTERVAL SECOND)], long=[$1], int=[$2])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -214,9 +215,10 @@ SELECT rowtime FROM
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(rowtime=[FLOOR($0, FLAG(DAY))])
-+- LogicalFilter(condition=[>($1, 0)])
-   +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+LogicalProject(rowtime=[$0])
++- LogicalProject(rowtime=[FLOOR($0, FLAG(DAY))], long=[$1])
+   +- LogicalFilter(condition=[>($1, 0)])
+      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SubplanReuseTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SubplanReuseTest.xml
index 83ce7c4c507..2ebfaf84748 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SubplanReuseTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/SubplanReuseTest.xml
@@ -504,15 +504,17 @@ SELECT a, b * 2 AS b FROM r
       <![CDATA[
 LogicalUnion(all=[true])
 :- LogicalProject(a=[$0], b=[$1])
-:  +- LogicalFilter(condition=[AND(>($1, 1), <($4, 2))])
-:     +- LogicalJoin(condition=[OR(=(ABS($0), ABS($3)), =($2, $5))], joinType=[full])
-:        :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-:        +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
+:  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+:     +- LogicalFilter(condition=[AND(>($1, 1), <($4, 2))])
+:        +- LogicalJoin(condition=[OR(=(ABS($0), ABS($3)), =($2, $5))], joinType=[full])
+:           :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+:           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
 +- LogicalProject(a=[$0], b=[*($1, 2)])
-   +- LogicalFilter(condition=[AND(>($1, 1), <($4, 2))])
-      +- LogicalJoin(condition=[OR(=(ABS($0), ABS($3)), =($2, $5))], joinType=[full])
-         :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+      +- LogicalFilter(condition=[AND(>($1, 1), <($4, 2))])
+         +- LogicalJoin(condition=[OR(=(ABS($0), ABS($3)), =($2, $5))], joinType=[full])
+            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -546,15 +548,17 @@ SELECT a, b * 2 AS b FROM r
       <![CDATA[
 LogicalUnion(all=[true])
 :- LogicalProject(a=[$0], b=[$1])
-:  +- LogicalFilter(condition=[AND(>($1, 1), <($4, 2))])
-:     +- LogicalJoin(condition=[OR(=(random_udf($0), random_udf($3)), =($2, $5))], joinType=[full])
-:        :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-:        +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
+:  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+:     +- LogicalFilter(condition=[AND(>($1, 1), <($4, 2))])
+:        +- LogicalJoin(condition=[OR(=(random_udf($0), random_udf($3)), =($2, $5))], joinType=[full])
+:           :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+:           +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
 +- LogicalProject(a=[$0], b=[*($1, 2)])
-   +- LogicalFilter(condition=[AND(>($1, 1), <($4, 2))])
-      +- LogicalJoin(condition=[OR(=(random_udf($0), random_udf($3)), =($2, $5))], joinType=[full])
-         :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
-         +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], f=[$5])
+      +- LogicalFilter(condition=[AND(>($1, 1), <($4, 2))])
+         +- LogicalJoin(condition=[OR(=(random_udf($0), random_udf($3)), =($2, $5))], joinType=[full])
+            :- LogicalTableScan(table=[[default_catalog, default_database, x, source: [TestTableSource(a, b, c)]]])
+            +- LogicalTableScan(table=[[default_catalog, default_database, y, source: [TestTableSource(d, e, f)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableScanTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableScanTest.xml
index e24c0ca5b38..289c6f0e921 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableScanTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableScanTest.xml
@@ -148,8 +148,9 @@ Calc(select=[ts, a, b], where=[(a > 1)])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], b=[$1], c=[+($0, 1)], d=[TO_TIMESTAMP($1)], e=[my_udf($0)])
-+- LogicalTableScan(table=[[default_catalog, default_database, t1]])
+LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
++- LogicalProject(a=[$0], b=[$1], c=[+($0, 1)], d=[TO_TIMESTAMP($1)], e=[my_udf($0)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, t1]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -187,8 +188,9 @@ Calc(select=[ts, a, b, my_ts, PROCTIME_MATERIALIZE(proc) AS proc], where=[(a > 1
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(a=[$0], other_metadata=[CAST($4):INTEGER], b=[$1], c=[$2], metadata_1=[$3], computed=[UPPER($3)])
-+- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable]])
+LogicalProject(a=[$0], other_metadata=[$1], b=[$2], c=[$3], metadata_1=[$4], computed=[$5])
++- LogicalProject(a=[$0], other_metadata=[CAST($4):INTEGER], b=[$1], c=[$2], metadata_1=[$3], computed=[UPPER($3)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -204,8 +206,9 @@ Calc(select=[a, CAST(other_metadata AS INTEGER) AS other_metadata, b, c, metadat
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(b=[$1], other_metadata=[CAST($4):INTEGER])
-+- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable]])
+LogicalProject(b=[$2], other_metadata=[$1])
++- LogicalProject(a=[$0], other_metadata=[CAST($4):INTEGER], b=[$1], c=[$2], metadata_1=[$3])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -221,8 +224,9 @@ Calc(select=[b, CAST(other_metadata AS INTEGER) AS other_metadata])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(timestamp=[$0], metadata_timestamp=[$2], other=[$1], computed_other=[UPPER($1)], computed_timestamp=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
-+- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable]])
+LogicalProject(timestamp=[$0], metadata_timestamp=[$1], other=[$2], computed_other=[$3], computed_timestamp=[$4])
++- LogicalProject(timestamp=[$0], metadata_timestamp=[$2], other=[$1], computed_other=[UPPER($1)], computed_timestamp=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
+   +- LogicalTableScan(table=[[default_catalog, default_database, MetadataTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -671,8 +675,9 @@ GROUP BY TUMBLE(ts, INTERVAL '10' SECOND)
       <![CDATA[
 LogicalProject(EXPR$0=[TUMBLE_START($0)], EXPR$1=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$1=[COUNT()])
-   +- LogicalProject($f0=[$TUMBLE(PROCTIME(), 10000:INTERVAL SECOND)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, src]])
+   +- LogicalProject($f0=[$TUMBLE($0, 10000:INTERVAL SECOND)])
+      +- LogicalProject(ts=[PROCTIME()], a=[$0], b=[$1])
+         +- LogicalTableScan(table=[[default_catalog, default_database, src]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableSinkTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableSinkTest.xml
index 6e1aa742fe8..92df1692b5e 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableSinkTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableSinkTest.xml
@@ -721,9 +721,10 @@ SELECT person, sum_votes FROM
 LogicalSink(table=[default_catalog.default_database.SinkRankChangeLog], fields=[person, sum_votes])
 +- LogicalProject(person=[$0], sum_votes=[$1])
    +- LogicalFilter(condition=[<($2, 10)])
-      +- LogicalProject(person=[$0], sum_votes=[$1], rank_number=[ROW_NUMBER() OVER (PARTITION BY /($1, 2) ORDER BY $1 DESC NULLS LAST)])
-         +- LogicalAggregate(group=[{0}], sum_votes=[SUM($1)])
-            +- LogicalTableScan(table=[[default_catalog, default_database, src]])
+      +- LogicalProject(person=[$0], sum_votes=[$1], rank_number=[ROW_NUMBER() OVER (PARTITION BY $2 ORDER BY $1 DESC NULLS LAST)])
+         +- LogicalProject(person=[$0], sum_votes=[$1], vote_section=[/($1, 2)])
+            +- LogicalAggregate(group=[{0}], sum_votes=[SUM($1)])
+               +- LogicalTableScan(table=[[default_catalog, default_database, src]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableSourceTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableSourceTest.xml
index 76471c8e796..697fc02d83a 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableSourceTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/TableSourceTest.xml
@@ -74,7 +74,8 @@ FROM T
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.nested2.num), $2)])
-+- LogicalTableScan(table=[[default_catalog, default_database, T]])
++- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -96,7 +97,8 @@ FROM T
     <Resource name="ast">
       <![CDATA[
 LogicalProject(id=[$0], nested1=[$1.nested1], results=[+(+($1.nested1.value, $1.nested2.num), $2)])
-+- LogicalTableScan(table=[[default_catalog, default_database, T]])
++- LogicalProject(id=[$0], deepNested=[$1], metadata_1=[$2], metadata_2=[$3])
+   +- LogicalTableScan(table=[[default_catalog, default_database, T]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -112,8 +114,9 @@ Calc(select=[id, deepNested.nested1 AS nested1, ((deepNested.nested1.value + dee
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], ts1=[+($4, 10000:INTERVAL SECOND)], tags=[$2])
-+- LogicalTableScan(table=[[default_catalog, default_database, src]])
+LogicalProject(id=[$0], ts1=[$5], tags=[$2])
++- LogicalProject(id=[$0], name=[$1], tags=[$2], op=[$3], ts=[$4], ts1=[+($4, 10000:INTERVAL SECOND)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, src]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -208,8 +211,9 @@ Calc(select=[PROCTIME_MATERIALIZE(ptime) AS ptime, name, val, id])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], ts1=[+($4, 10000:INTERVAL SECOND)], op=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
-+- LogicalTableScan(table=[[default_catalog, default_database, src]])
+LogicalProject(id=[$0], ts1=[$5], op=[$3])
++- LogicalProject(id=[$0], name=[$1], tags=[CAST($3):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], op=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], ts=[$4], ts1=[+($4, 10000:INTERVAL SECOND)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, src]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -225,8 +229,9 @@ Calc(select=[id, (ts + 10000:INTERVAL SECOND) AS ts1, CAST(op AS VARCHAR(2147483
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], ts1=[+($4, 10000:INTERVAL SECOND)], op=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
-+- LogicalTableScan(table=[[default_catalog, default_database, src]])
+LogicalProject(id=[$0], ts1=[$5], op=[$3])
++- LogicalProject(id=[$0], name=[$1], tags=[CAST($3):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], op=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], ts=[$4], ts1=[+($4, 10000:INTERVAL SECOND)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, src]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -273,8 +278,9 @@ Calc(select=[name, w$end AS EXPR$1, EXPR$2])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(ts=[$4], id=[$0], name=[$1], tags=[CAST($3):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], op=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
-+- LogicalTableScan(table=[[default_catalog, default_database, src]])
+LogicalProject(ts=[$4], id=[$0], name=[$1], tags=[$2], op=[$3])
++- LogicalProject(id=[$0], name=[$1], tags=[CAST($3):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], op=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], ts=[$4], ts1=[+($4, 10000:INTERVAL SECOND)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, src]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -290,8 +296,9 @@ Calc(select=[ts, id, name, CAST(tags AS VARCHAR(2147483647)) AS tags, CAST(op AS
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], ts=[$4], tags=[CAST($3):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
-+- LogicalTableScan(table=[[default_catalog, default_database, src]])
+LogicalProject(id=[$0], ts=[$4], tags=[$2])
++- LogicalProject(id=[$0], name=[$1], tags=[CAST($3):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], op=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], ts=[$4], ts1=[+($4, 10000:INTERVAL SECOND)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, src]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -326,8 +333,9 @@ Calc(select=[rowtime, id, name, val])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(id=[$0], ts=[$4], tags=[CAST($3):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"])
-+- LogicalTableScan(table=[[default_catalog, default_database, src]])
+LogicalProject(id=[$0], ts=[$4], tags=[$2])
++- LogicalProject(id=[$0], name=[$1], tags=[CAST($3):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], op=[CAST($2):VARCHAR(2147483647) CHARACTER SET "UTF-16LE"], ts=[$4], ts1=[+($4, 10000:INTERVAL SECOND)])
+   +- LogicalTableScan(table=[[default_catalog, default_database, src]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/ValuesTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/ValuesTest.xml
index b8d15a99b4c..48aac784bb2 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/ValuesTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/ValuesTest.xml
@@ -23,11 +23,12 @@ limitations under the License.
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1]), rowType=[RecordType(INTEGER a, DECIMAL(20, 1) b)]
-+- LogicalUnion(all=[true]), rowType=[RecordType(INTEGER EXPR$0, DECIMAL(20, 1) EXPR$1)]
-   :- LogicalProject(EXPR$0=[1], EXPR$1=[2.0:DECIMAL(2, 1)]), rowType=[RecordType(INTEGER EXPR$0, DECIMAL(2, 1) EXPR$1)]
-   :  +- LogicalValues(tuples=[[{ 0 }]]), rowType=[RecordType(INTEGER ZERO)]
-   +- LogicalProject(EXPR$0=[3], EXPR$1=[4:BIGINT]), rowType=[RecordType(INTEGER EXPR$0, BIGINT EXPR$1)]
-      +- LogicalValues(tuples=[[{ 0 }]]), rowType=[RecordType(INTEGER ZERO)]
++- LogicalProject(a=[$0], b=[$1]), rowType=[RecordType(INTEGER a, DECIMAL(20, 1) b)]
+   +- LogicalUnion(all=[true]), rowType=[RecordType(INTEGER EXPR$0, DECIMAL(20, 1) EXPR$1)]
+      :- LogicalProject(EXPR$0=[1], EXPR$1=[2.0:DECIMAL(2, 1)]), rowType=[RecordType(INTEGER EXPR$0, DECIMAL(2, 1) EXPR$1)]
+      :  +- LogicalValues(tuples=[[{ 0 }]]), rowType=[RecordType(INTEGER ZERO)]
+      +- LogicalProject(EXPR$0=[3], EXPR$1=[4:BIGINT]), rowType=[RecordType(INTEGER EXPR$0, BIGINT EXPR$1)]
+         +- LogicalValues(tuples=[[{ 0 }]]), rowType=[RecordType(INTEGER ZERO)]
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -63,13 +64,14 @@ Values(tuples=[[{ 1, 2, 3 }]])
     <Resource name="ast">
       <![CDATA[
 LogicalProject(a=[$0], b=[$1])
-+- LogicalUnion(all=[true])
-   :- LogicalProject(EXPR$0=[1], EXPR$1=[2])
-   :  +- LogicalValues(tuples=[[{ 0 }]])
-   :- LogicalProject(EXPR$0=[3], EXPR$1=[null:INTEGER])
-   :  +- LogicalValues(tuples=[[{ 0 }]])
-   +- LogicalProject(EXPR$0=[4], EXPR$1=[5])
-      +- LogicalValues(tuples=[[{ 0 }]])
++- LogicalProject(a=[$0], b=[$1])
+   +- LogicalUnion(all=[true])
+      :- LogicalProject(EXPR$0=[1], EXPR$1=[2])
+      :  +- LogicalValues(tuples=[[{ 0 }]])
+      :- LogicalProject(EXPR$0=[3], EXPR$1=[null:INTEGER])
+      :  +- LogicalValues(tuples=[[{ 0 }]])
+      +- LogicalProject(EXPR$0=[4], EXPR$1=[5])
+         +- LogicalValues(tuples=[[{ 0 }]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -90,8 +92,9 @@ Union(all=[true], union=[EXPR$0, EXPR$1])
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(EXPR$0=[null:INTEGER])
-+- LogicalValues(tuples=[[{ 0 }]])
+LogicalProject(EXPR$0=[$0])
++- LogicalProject(EXPR$0=[null:INTEGER])
+   +- LogicalValues(tuples=[[{ 0 }]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowDeduplicateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowDeduplicateTest.xml
index aec880d991b..0411fc6572e 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowDeduplicateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowDeduplicateTest.xml
@@ -110,14 +110,15 @@ GROUP BY window_start, window_end
 LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()], EXPR$3=[SUM($2)], EXPR$4=[MAX($2) FILTER $3], wAvg=[weightedAvg($4, $5)], uv=[COUNT(DISTINCT $6)])
 +- LogicalProject(window_start=[$6], window_end=[$7], d=[$4], $f3=[IS TRUE(>($2, 1000))], b=[$2], e=[$5], c=[$3])
    +- LogicalTableFunctionScan(invocation=[TUMBLE($5, DESCRIPTOR($0), 900000:INTERVAL MINUTE)], rowType=[RecordType(TIMESTAMP(3) *ROWTIME* rowtime, INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      +- LogicalProject(rowtime=[$9], a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-         +- LogicalFilter(condition=[<=($10, 1)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $7, $8 ORDER BY $5 DESC NULLS LAST)])
-               +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-                  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-                     +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-                        +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(rowtime=[$0], a=[$1], b=[$2], c=[$3], d=[$4], e=[$5])
+         +- LogicalProject(rowtime=[$9], a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
+            +- LogicalFilter(condition=[<=($10, 1)])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $7, $8 ORDER BY $5 DESC NULLS LAST)])
+                  +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+                     +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+                        +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                           +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                              +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowRankTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowRankTest.xml
index 691613166cd..8cb00c94feb 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowRankTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/WindowRankTest.xml
@@ -238,16 +238,17 @@ GROUP BY a, window_start, window_end
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[SUM($3)], EXPR$4=[SUM($4)], EXPR$5=[MAX($5)])
 +- LogicalProject(a=[$1], window_start=[$7], window_end=[$8], cnt=[$2], sum_d=[$3], max_d=[$4])
    +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($0), 3600000:INTERVAL HOUR)], rowType=[RecordType(TIMESTAMP(3) *ROWTIME* rowtime, INTEGER a, BIGINT cnt, DECIMAL(38, 3) sum_d, DECIMAL(10, 3) max_d, BIGINT wAvg, BIGINT uv, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      +- LogicalProject(rowtime=[$3], a=[$0], cnt=[$4], sum_d=[$5], max_d=[$6], wAvg=[$7], uv=[$8])
-         +- LogicalFilter(condition=[<=($9, 3)])
-            +- LogicalProject(a=[$0], window_start=[$1], window_end=[$2], window_time=[$3], cnt=[$4], sum_d=[$5], max_d=[$6], wAvg=[$7], uv=[$8], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $1, $2 ORDER BY $4 DESC NULLS LAST)])
-               +- LogicalAggregate(group=[{0, 1, 2, 3}], cnt=[COUNT()], sum_d=[SUM($4)], max_d=[MAX($4) FILTER $5], wAvg=[weightedAvg($6, $7)], uv=[COUNT(DISTINCT $8)])
-                  +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], window_time=[$9], d=[$3], $f5=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
-                     +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-                        +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-                           +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-                              +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                                 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(rowtime=[$0], a=[$1], cnt=[$2], sum_d=[$3], max_d=[$4], wAvg=[$5], uv=[$6])
+         +- LogicalProject(rowtime=[$3], a=[$0], cnt=[$4], sum_d=[$5], max_d=[$6], wAvg=[$7], uv=[$8])
+            +- LogicalFilter(condition=[<=($9, 3)])
+               +- LogicalProject(a=[$0], window_start=[$1], window_end=[$2], window_time=[$3], cnt=[$4], sum_d=[$5], max_d=[$6], wAvg=[$7], uv=[$8], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $1, $2 ORDER BY $4 DESC NULLS LAST)])
+                  +- LogicalAggregate(group=[{0, 1, 2, 3}], cnt=[COUNT()], sum_d=[SUM($4)], max_d=[MAX($4) FILTER $5], wAvg=[weightedAvg($6, $7)], uv=[COUNT(DISTINCT $8)])
+                     +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], window_time=[$9], d=[$3], $f5=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
+                        +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+                           +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+                              +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                                 +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                                    +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -439,14 +440,15 @@ GROUP BY a, window_start, window_end
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
 +- LogicalProject(a=[$1], window_start=[$6], window_end=[$7], d=[$4], $f4=[IS TRUE(>($2, 1000))], b=[$2], e=[$5], c=[$3])
    +- LogicalTableFunctionScan(invocation=[TUMBLE($5, DESCRIPTOR($0), 900000:INTERVAL MINUTE)], rowType=[RecordType(TIMESTAMP(3) *ROWTIME* rowtime, INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      +- LogicalProject(rowtime=[$9], a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
-         +- LogicalFilter(condition=[<=($10, 3)])
-            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $7, $8 ORDER BY $1 DESC NULLS LAST)])
-               +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-                  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-                     +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-                        +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(rowtime=[$0], a=[$1], b=[$2], c=[$3], d=[$4], e=[$5])
+         +- LogicalProject(rowtime=[$9], a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
+            +- LogicalFilter(condition=[<=($10, 3)])
+               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $7, $8 ORDER BY $1 DESC NULLS LAST)])
+                  +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+                     +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+                        +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                           +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                              +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/AggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/AggregateTest.xml
index 05a20d291d9..d3283169018 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/AggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/AggregateTest.xml
@@ -264,7 +264,8 @@ GroupAggregate(select=[COUNT(*) AS EXPR$0])
       <![CDATA[
 LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
 +- LogicalProject($f0=[0])
-   +- LogicalTableScan(table=[[default_catalog, default_database, src]])
+   +- LogicalProject(sys_col=[$2], id=[$0], cnt=[$1])
+      +- LogicalTableScan(table=[[default_catalog, default_database, src]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -284,7 +285,8 @@ GroupAggregate(select=[COUNT(*) AS EXPR$0])
       <![CDATA[
 LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
 +- LogicalProject($f0=[0])
-   +- LogicalTableScan(table=[[default_catalog, default_database, src]])
+   +- LogicalProject(sys_col=[$2], id=[$1], cnt=[$0])
+      +- LogicalTableScan(table=[[default_catalog, default_database, src]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -304,7 +306,8 @@ GroupAggregate(select=[COUNT(*) AS EXPR$0])
       <![CDATA[
 LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
 +- LogicalProject($f0=[0])
-   +- LogicalTableScan(table=[[default_catalog, default_database, src]])
+   +- LogicalProject(nested=[$0], sys_col=[$3], id=[$1], cnt=[$2])
+      +- LogicalTableScan(table=[[default_catalog, default_database, src]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/GroupWindowTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/GroupWindowTest.xml
index f0ab685b719..53acfb61550 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/GroupWindowTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/GroupWindowTest.xml
@@ -146,8 +146,9 @@ group by HOP(c, INTERVAL '1' SECOND, INTERVAL '1' MINUTE)
       <![CDATA[
 LogicalProject(EXPR$0=[$1], EXPR$1=[$2])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)], EXPR$1=[MAX($2)])
-   +- LogicalProject($f0=[$HOP(PROCTIME(), 1000:INTERVAL SECOND, 60000:INTERVAL MINUTE)], a=[$0], b=[$1])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [CollectionTableSource(a, b)]]])
+   +- LogicalProject($f0=[$HOP($2, 1000:INTERVAL SECOND, 60000:INTERVAL MINUTE)], a=[$0], b=[$1])
+      +- LogicalProject(a=[$0], b=[$1], c=[PROCTIME()])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [CollectionTableSource(a, b)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -300,10 +301,11 @@ GROUP BY TUMBLE(zzzzz, INTERVAL '0.004' SECOND)
       <![CDATA[
 LogicalProject(EXPR$0=[TUMBLE_ROWTIME($0)], EXPR$1=[TUMBLE_END($0)], a=[$1])
 +- LogicalAggregate(group=[{0}], a=[COUNT()])
-   +- LogicalProject($f0=[$TUMBLE(TUMBLE_ROWTIME($0), 4:INTERVAL SECOND)])
-      +- LogicalAggregate(group=[{0}], a=[COUNT($1)])
-         +- LogicalProject($f0=[$TUMBLE($4, 2:INTERVAL SECOND)], a=[$0])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalProject($f0=[$TUMBLE($1, 4:INTERVAL SECOND)])
+      +- LogicalProject(a=[$1], zzzzz=[TUMBLE_ROWTIME($0)])
+         +- LogicalAggregate(group=[{0}], a=[COUNT($1)])
+            +- LogicalProject($f0=[$TUMBLE($4, 2:INTERVAL SECOND)], a=[$0])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -334,10 +336,11 @@ GROUP BY b, d
       <![CDATA[
 LogicalProject(EXPR$0=[$2])
 +- LogicalAggregate(group=[{0, 1}], EXPR$0=[weightedAvg($2, $3)])
-   +- LogicalProject(b=[$1], d=[$4], c=[$2], $f3=[CAST($0):BIGINT])
-      +- LogicalAggregate(group=[{0, 1, 2, 3}], d=[COUNT()])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$TUMBLE($4, 900000:INTERVAL MINUTE)])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalProject(b=[$1], d=[$3], c=[$2], $f3=[CAST($0):BIGINT])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$4], ping_start=[TUMBLE_START($3)])
+         +- LogicalAggregate(group=[{0, 1, 2, 3}], d=[COUNT()])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$TUMBLE($4, 900000:INTERVAL MINUTE)])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -374,8 +377,9 @@ GROUP BY TUMBLE(rowtime, INTERVAL '15' MINUTE)
       <![CDATA[
 LogicalProject(s=[$1], a=[$2], wStart=[TUMBLE_START($0)])
 +- LogicalAggregate(group=[{0}], s=[SUM($1)], a=[AVG($1)])
-   +- LogicalProject($f0=[$TUMBLE($4, 900000:INTERVAL MINUTE)], correct=[CASE(=($0, 1), 1, 99)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalProject($f0=[$TUMBLE($1, 900000:INTERVAL MINUTE)], correct=[$0])
+      +- LogicalProject(correct=[CASE(=($0, 1), 1, 99)], rowtime=[$4])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -429,8 +433,9 @@ group by SESSION(c, INTERVAL '1' MINUTE)
       <![CDATA[
 LogicalProject(EXPR$0=[$1], EXPR$1=[$2])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)], EXPR$1=[MAX($2)])
-   +- LogicalProject($f0=[$SESSION(PROCTIME(), 60000:INTERVAL MINUTE)], a=[$0], b=[$1])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [CollectionTableSource(a, b)]]])
+   +- LogicalProject($f0=[$SESSION($2, 60000:INTERVAL MINUTE)], a=[$0], b=[$1])
+      +- LogicalProject(a=[$0], b=[$1], c=[PROCTIME()])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [CollectionTableSource(a, b)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -456,10 +461,11 @@ GROUP BY b, d, ping_start
       <![CDATA[
 LogicalProject(EXPR$0=[$3])
 +- LogicalAggregate(group=[{0, 1, 2}], EXPR$0=[weightedAvg($3, $4)])
-   +- LogicalProject(b=[$1], d=[$4], ping_start=[TUMBLE_START($3)], c=[$2], $f4=[CAST($0):BIGINT])
-      +- LogicalAggregate(group=[{0, 1, 2, 3}], d=[COUNT()])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$TUMBLE($4, 900000:INTERVAL MINUTE)])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalProject(b=[$1], d=[$3], ping_start=[$4], c=[$2], $f4=[CAST($0):BIGINT])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$4], ping_start=[TUMBLE_START($3)])
+         +- LogicalAggregate(group=[{0, 1, 2, 3}], d=[COUNT()])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$TUMBLE($4, 900000:INTERVAL MINUTE)])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -520,10 +526,11 @@ SELECT weightedAvg(c, a) FROM
       <![CDATA[
 LogicalProject(EXPR$0=[$2])
 +- LogicalAggregate(group=[{0, 1}], EXPR$0=[weightedAvg($2, $3)])
-   +- LogicalProject(b=[$1], ping_start=[TUMBLE_START($3)], c=[$2], $f3=[CAST($0):BIGINT])
-      +- LogicalAggregate(group=[{0, 1, 2, 3}])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$TUMBLE($4, 900000:INTERVAL MINUTE)])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalProject(b=[$1], ping_start=[$3], c=[$2], $f3=[CAST($0):BIGINT])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], ping_start=[TUMBLE_START($3)])
+         +- LogicalAggregate(group=[{0, 1, 2, 3}])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$TUMBLE($4, 900000:INTERVAL MINUTE)])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -555,9 +562,10 @@ GROUP BY b
 LogicalProject(EXPR$0=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$0=[weightedAvg($1, $2)])
    +- LogicalProject(b=[$1], c=[$2], $f2=[CAST($0):BIGINT])
-      +- LogicalAggregate(group=[{0, 1, 2, 3}])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$TUMBLE($4, 900000:INTERVAL MINUTE)])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], ping_start=[TUMBLE_START($3)])
+         +- LogicalAggregate(group=[{0, 1, 2, 3}])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], $f3=[$TUMBLE($4, 900000:INTERVAL MINUTE)])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -581,8 +589,9 @@ Calc(select=[EXPR$0])
       <![CDATA[
 LogicalProject(EXPR$0=[$1], EXPR$1=[$2])
 +- LogicalAggregate(group=[{0}], EXPR$0=[SUM($1)], EXPR$1=[MAX($2)])
-   +- LogicalProject($f0=[$TUMBLE(PROCTIME(), 1000:INTERVAL SECOND)], a=[$0], b=[$1])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [CollectionTableSource(a, b)]]])
+   +- LogicalProject($f0=[$TUMBLE($2, 1000:INTERVAL SECOND)], a=[$0], b=[$1])
+      +- LogicalProject(a=[$0], b=[$1], c=[PROCTIME()])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable1, source: [CollectionTableSource(a, b)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -613,10 +622,11 @@ GROUP BY TUMBLE(`rowtime`, INTERVAL '1' SECOND)
       <![CDATA[
 LogicalProject(EXPR$0=[TUMBLE_START($0)], cnt=[$1])
 +- LogicalAggregate(group=[{0}], cnt=[COUNT()])
-   +- LogicalProject($f0=[$TUMBLE($4, 1000:INTERVAL SECOND)])
-      +- LogicalFilter(condition=[=($5, 1)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], rowNum=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $4 DESC NULLS LAST)])
-            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalProject($f0=[$TUMBLE($3, 1000:INTERVAL SECOND)])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$4])
+         +- LogicalFilter(condition=[=($5, 1)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], proctime=[$3], rowtime=[$4], rowNum=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $4 DESC NULLS LAST)])
+               +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -644,8 +654,9 @@ GROUP BY TUMBLE(ts, INTERVAL '10' SECOND)
       <![CDATA[
 LogicalProject(EXPR$0=[TUMBLE_START($0)], EXPR$1=[$1])
 +- LogicalAggregate(group=[{0}], EXPR$1=[COUNT()])
-   +- LogicalProject($f0=[$TUMBLE(PROCTIME(), 10000:INTERVAL SECOND)])
-      +- LogicalTableScan(table=[[default_catalog, default_database, src]])
+   +- LogicalProject($f0=[$TUMBLE($0, 10000:INTERVAL SECOND)])
+      +- LogicalProject(ts=[PROCTIME()], a=[$0], b=[$1])
+         +- LogicalTableScan(table=[[default_catalog, default_database, src]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -734,14 +745,16 @@ UNION ALL
     <Resource name="ast">
       <![CDATA[
 LogicalUnion(all=[true])
-:- LogicalProject(EXPR$0=[1])
-:  +- LogicalAggregate(group=[{0}])
-:     +- LogicalProject($f0=[$HOP($4, 3600000:INTERVAL HOUR, 3600000:INTERVAL HOUR)])
-:        +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-+- LogicalProject(EXPR$0=[1])
-   +- LogicalAggregate(group=[{0}])
-      +- LogicalProject($f0=[$HOP($4, 3600000:INTERVAL HOUR, 7200000:INTERVAL HOUR)])
-         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+:- LogicalProject(EXPR$0=[$0])
+:  +- LogicalProject(EXPR$0=[1])
+:     +- LogicalAggregate(group=[{0}])
+:        +- LogicalProject($f0=[$HOP($4, 3600000:INTERVAL HOUR, 3600000:INTERVAL HOUR)])
+:           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
++- LogicalProject(EXPR$0=[$0])
+   +- LogicalProject(EXPR$0=[1])
+      +- LogicalAggregate(group=[{0}])
+         +- LogicalProject($f0=[$HOP($4, 3600000:INTERVAL HOUR, 7200000:INTERVAL HOUR)])
+            +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/GroupingSetsTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/GroupingSetsTest.xml
index aaf23ca13ec..3d44e12d4c8 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/GroupingSetsTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/GroupingSetsTest.xml
@@ -429,10 +429,11 @@ FROM emp GROUP BY ROLLUP(deptno, gender)
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(c=[$2], g=[$3], gid=[0:BIGINT], gd=[$4], gg=[$5], ggd=[$6], gdg=[$7])
-+- LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], c=[COUNT()], g=[GROUPING($0)], gd=[GROUPING_ID($0)], gg=[GROUPING_ID($1)], ggd=[GROUPING_ID($1, $0)], gdg=[GROUPING_ID($0, $1)])
-   +- LogicalProject(deptno=[$1], gender=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, emp, source: [TestTableSource(ename, deptno, gender)]]])
+LogicalProject(c=[$2], g=[$3], gid=[$4], gd=[$5], gg=[$6], ggd=[$7], gdg=[$8])
++- LogicalProject(deptno=[$0], gender=[$1], c=[$2], g=[$3], gid=[0:BIGINT], gd=[$4], gg=[$5], ggd=[$6], gdg=[$7])
+   +- LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {}]], c=[COUNT()], g=[GROUPING($0)], gd=[GROUPING_ID($0)], gg=[GROUPING_ID($1)], ggd=[GROUPING_ID($1, $0)], gdg=[GROUPING_ID($0, $1)])
+      +- LogicalProject(deptno=[$1], gender=[$2])
+         +- LogicalTableScan(table=[[default_catalog, default_database, emp, source: [TestTableSource(ename, deptno, gender)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -462,15 +463,16 @@ FROM emp
     </Resource>
     <Resource name="ast">
       <![CDATA[
-LogicalProject(deptno=[$0], gender=[$1], gd=[$2], gg=[$3], dg=[$4], gd0=[$5], gid=[0:BIGINT], c=[$6])
-+- LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {1}, {}]], gd=[GROUPING($0)], gg=[GROUPING($1)], dg=[GROUPING_ID($0, $1)], gd=[GROUPING_ID($1, $0)], c=[COUNT()])
-   +- LogicalProject(deptno=[$1], gender=[$2])
-      +- LogicalTableScan(table=[[default_catalog, default_database, emp, source: [TestTableSource(ename, deptno, gender)]]])
+LogicalProject(deptno=[$0], gender=[$1], gd=[$2], gg=[$3], dg=[$4], gd0=[$5], gid=[$6], c=[$7])
++- LogicalProject(deptno=[$0], gender=[$1], gd=[$2], gg=[$3], dg=[$4], gd_0=[$5], gid=[0:BIGINT], c=[$6])
+   +- LogicalAggregate(group=[{0, 1}], groups=[[{0, 1}, {0}, {1}, {}]], gd=[GROUPING($0)], gg=[GROUPING($1)], dg=[GROUPING_ID($0, $1)], gd=[GROUPING_ID($1, $0)], c=[COUNT()])
+      +- LogicalProject(deptno=[$1], gender=[$2])
+         +- LogicalTableScan(table=[[default_catalog, default_database, emp, source: [TestTableSource(ename, deptno, gender)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
       <![CDATA[
-Calc(select=[deptno, gender, CASE(SEARCH($e, Sarg[0, 1]), 0, 1) AS gd, CASE(($e = 0), 0, ($e = 1), 1, ($e = 2), 0, 1) AS gg, CASE(($e = 0), 0, ($e = 1), 1, ($e = 2), 2, 3) AS dg, CASE(($e = 0), 0, ($e = 1), 2, ($e = 2), 1, 3) AS gd0, 0 AS gid, c])
+Calc(select=[deptno, gender, CASE(SEARCH($e, Sarg[0, 1]), 0, 1) AS gd, CASE(($e = 0), 0, ($e = 1), 1, ($e = 2), 0, 1) AS gg, CASE(($e = 0), 0, ($e = 1), 1, ($e = 2), 2, 3) AS dg, CASE(($e = 0), 0, ($e = 1), 2, ($e = 2), 1, 3) AS gd_0, 0 AS gid, c])
 +- GroupAggregate(groupBy=[deptno, gender, $e], select=[deptno, gender, $e, COUNT(*) AS c])
    +- Exchange(distribution=[hash[deptno, gender, $e]])
       +- Expand(projects=[{deptno, gender, 0 AS $e}, {deptno, null AS gender, 1 AS $e}, {null AS deptno, gender, 2 AS $e}, {null AS deptno, null AS gender, 3 AS $e}])
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/TwoStageAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/TwoStageAggregateTest.xml
index 5dbfdf53f6f..eaab162d3f1 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/TwoStageAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/TwoStageAggregateTest.xml
@@ -94,8 +94,9 @@ Calc(select=[EXPR$0])
       <![CDATA[
 LogicalProject(EXPR$0=[$1], EXPR$1=[$2])
 +- LogicalAggregate(group=[{0}], EXPR$0=[MIN($1)], EXPR$1=[AVG($2)])
-   +- LogicalProject(d=[+($1, 3)], c=[$2], a=[$0])
-      +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
+   +- LogicalProject(d=[$1], c=[$2], a=[$0])
+      +- LogicalProject(a=[$0], d=[+($1, 3)], c=[$2])
+         +- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/WindowAggregateTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/WindowAggregateTest.xml
index 7c7de7a16b5..f51f83aadd8 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/WindowAggregateTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/agg/WindowAggregateTest.xml
@@ -38,13 +38,14 @@ GROUP BY window_start, window_end
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()], EXPR$3=[SUM($2)], EXPR$4=[MAX($2) FILTER $3], wAvg=[weightedAvg($4, $5)], uv=[COUNT(DISTINCT $6)])
-+- LogicalProject(window_start=[$7], window_end=[$8], d=[$3], $f3=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
-   +- LogicalFilter(condition=[>=($7, 2021-01-01 10:10:00)])
-      +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
++- LogicalProject(window_start=[$0], window_end=[$7], d=[$2], $f3=[IS TRUE(>($5, 1000))], b=[$5], e=[$4], c=[$6])
+   +- LogicalProject(window_start=[$7], rowtime=[$5], d=[$3], proctime=[$6], e=[$4], b=[$1], c=[$2], window_end=[$8], window_time=[$9], a=[$0])
+      +- LogicalFilter(condition=[>=($7, 2021-01-01 10:10:00)])
+         +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -81,13 +82,14 @@ GROUP BY window_start, window_end
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()], EXPR$3=[SUM($2)], EXPR$4=[MAX($2) FILTER $3], wAvg=[weightedAvg($4, $5)], uv=[COUNT(DISTINCT $6)])
-+- LogicalProject(window_start=[$7], window_end=[$8], d=[$3], $f3=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
-   +- LogicalFilter(condition=[>=($7, 2021-01-01 10:10:00)])
-      +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
++- LogicalProject(window_start=[$0], window_end=[$7], d=[$2], $f3=[IS TRUE(>($5, 1000))], b=[$5], e=[$4], c=[$6])
+   +- LogicalProject(window_start=[$7], rowtime=[$5], d=[$3], proctime=[$6], e=[$4], b=[$1], c=[$2], window_end=[$8], window_time=[$9], a=[$0])
+      +- LogicalFilter(condition=[>=($7, 2021-01-01 10:10:00)])
+         +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -216,13 +218,14 @@ GROUP BY window_start, window_end
       <![CDATA[
 LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()], EXPR$3=[SUM($2)], EXPR$4=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
 +- LogicalProject(window_start=[$7], window_end=[$8], len=[$10], d=[$3], $f4=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
-   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
-      :- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      :  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-      :     +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-      :        +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-      :           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalTableFunctionScan(invocation=[len_udtf($cor0.c)], rowType=[RecordType(INTEGER EXPR$0)])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], len=[$10])
+      +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
+         :- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+         :  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+         :     +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+         :        +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+         :           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+         +- LogicalTableFunctionScan(invocation=[len_udtf($cor0.c)], rowType=[RecordType(INTEGER EXPR$0)])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -262,13 +265,14 @@ GROUP BY window_start, window_end
       <![CDATA[
 LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()], EXPR$3=[SUM($2)], EXPR$4=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
 +- LogicalProject(window_start=[$7], window_end=[$8], len=[$10], d=[$3], $f4=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
-   +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
-      :- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      :  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-      :     +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-      :        +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-      :           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-      +- LogicalTableFunctionScan(invocation=[len_udtf($cor0.c)], rowType=[RecordType(INTEGER EXPR$0)])
+   +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], len=[$10])
+      +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{2}])
+         :- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+         :  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+         :     +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+         :        +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+         :           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+         +- LogicalTableFunctionScan(invocation=[len_udtf($cor0.c)], rowType=[RecordType(INTEGER EXPR$0)])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -1574,20 +1578,22 @@ Calc(select=[a, b, uv])
 LogicalSink(table=[default_catalog.default_database.s1], fields=[window_start, window_end, wAvg])
 +- LogicalAggregate(group=[{0, 1}], wAvg=[weightedAvg($2, $3)])
    +- LogicalProject(window_start=[$7], window_end=[$8], b=[$1], e=[$4])
-      +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9])
+         +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 
 LogicalSink(table=[default_catalog.default_database.s1], fields=[window_start, window_end, EXPR$2])
 +- LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()])
    +- LogicalProject(window_start=[$7], window_end=[$8])
-      +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9])
+         +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1614,20 +1620,22 @@ Sink(table=[default_catalog.default_database.s1], fields=[window_start, window_e
 LogicalSink(table=[default_catalog.default_database.s1], fields=[window_start, window_end, wAvg])
 +- LogicalAggregate(group=[{0, 1}], wAvg=[weightedAvg($2, $3)])
    +- LogicalProject(window_start=[$7], window_end=[$8], b=[$1], e=[$4])
-      +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9])
+         +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 
 LogicalSink(table=[default_catalog.default_database.s1], fields=[window_start, window_end, EXPR$2])
 +- LogicalAggregate(group=[{0, 1}], EXPR$2=[COUNT()])
    +- LogicalProject(window_start=[$7], window_end=[$8])
-      +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9])
+         +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -1673,13 +1681,14 @@ GROUP BY a, window_start, window_end
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
-+- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
-   +- LogicalFilter(condition=[>($1, 1000)])
-      +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
++- LogicalProject(a=[$9], window_start=[$0], window_end=[$7], d=[$2], $f4=[IS TRUE(>($5, 1000))], b=[$5], e=[$4], c=[$6])
+   +- LogicalProject(window_start=[$7], rowtime=[$5], d=[$3], proctime=[$6], e=[$4], b=[$1], c=[$2], window_end=[$8], window_time=[$9], a=[$0])
+      +- LogicalFilter(condition=[>($1, 1000)])
+         +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -1716,13 +1725,14 @@ GROUP BY a, window_start, window_end
     <Resource name="ast">
       <![CDATA[
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[COUNT()], EXPR$4=[SUM($3)], EXPR$5=[MAX($3) FILTER $4], wAvg=[weightedAvg($5, $6)], uv=[COUNT(DISTINCT $7)])
-+- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], d=[$3], $f4=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
-   +- LogicalFilter(condition=[>($1, 1000)])
-      +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
++- LogicalProject(a=[$9], window_start=[$0], window_end=[$7], d=[$2], $f4=[IS TRUE(>($5, 1000))], b=[$5], e=[$4], c=[$6])
+   +- LogicalProject(window_start=[$7], rowtime=[$5], d=[$3], proctime=[$6], e=[$4], b=[$1], c=[$2], window_end=[$8], window_time=[$9], a=[$0])
+      +- LogicalFilter(condition=[>($1, 1000)])
+         +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -1756,14 +1766,15 @@ GROUP BY a, window_start, window_end
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[SUM($3)], EXPR$4=[SUM($4)], EXPR$5=[MAX($5)])
 +- LogicalProject(a=[$0], window_start=[$6], window_end=[$7], cnt=[$3], sum_d=[$4], max_d=[$5])
    +- LogicalTableFunctionScan(invocation=[TUMBLE($5, DESCRIPTOR($2), 600000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, TIMESTAMP(3) *ROWTIME* rowtime, BIGINT cnt, DECIMAL(38, 3) sum_d, DECIMAL(10, 3) max_d, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      +- LogicalProject(a=[$0], b=[$4], rowtime=[$3], cnt=[$5], sum_d=[$6], max_d=[$7])
-         +- LogicalAggregate(group=[{0, 1, 2, 3, 4}], cnt=[COUNT()], sum_d=[SUM($5)], max_d=[MAX($5)])
-            +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], rowtime=[$9], b=[$1], d=[$3])
-               +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-                  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-                     +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-                        +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a=[$0], b=[$1], rowtime=[$2], cnt=[$3], sum_d=[$4], max_d=[$5])
+         +- LogicalProject(a=[$0], b=[$4], rowtime=[$3], cnt=[$5], sum_d=[$6], max_d=[$7])
+            +- LogicalAggregate(group=[{0, 1, 2, 3, 4}], cnt=[COUNT()], sum_d=[SUM($5)], max_d=[MAX($5)])
+               +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], rowtime=[$9], b=[$1], d=[$3])
+                  +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+                     +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+                        +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                           +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                              +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -1798,14 +1809,15 @@ GROUP BY a, window_start, window_end
 LogicalAggregate(group=[{0, 1, 2}], EXPR$3=[SUM($3)], EXPR$4=[SUM($4)], EXPR$5=[MAX($5)])
 +- LogicalProject(a=[$0], window_start=[$6], window_end=[$7], cnt=[$3], sum_d=[$4], max_d=[$5])
    +- LogicalTableFunctionScan(invocation=[TUMBLE($5, DESCRIPTOR($2), 600000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, TIMESTAMP(3) *ROWTIME* rowtime, BIGINT cnt, DECIMAL(38, 3) sum_d, DECIMAL(10, 3) max_d, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      +- LogicalProject(a=[$0], b=[$4], rowtime=[$3], cnt=[$5], sum_d=[$6], max_d=[$7])
-         +- LogicalAggregate(group=[{0, 1, 2, 3, 4}], cnt=[COUNT()], sum_d=[SUM($5)], max_d=[MAX($5)])
-            +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], rowtime=[$9], b=[$1], d=[$3])
-               +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-                  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-                     +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-                        +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+      +- LogicalProject(a=[$0], b=[$1], rowtime=[$2], cnt=[$3], sum_d=[$4], max_d=[$5])
+         +- LogicalProject(a=[$0], b=[$4], rowtime=[$3], cnt=[$5], sum_d=[$6], max_d=[$7])
+            +- LogicalAggregate(group=[{0, 1, 2, 3, 4}], cnt=[COUNT()], sum_d=[SUM($5)], max_d=[MAX($5)])
+               +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], rowtime=[$9], b=[$1], d=[$3])
+                  +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 300000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+                     +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+                        +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                           +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                              +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -2401,12 +2413,13 @@ GROUP BY a, window_start, window_end, ws, window_time
       <![CDATA[
 LogicalProject(a=[$0], window_start=[$1], ws=[$3], window_end=[$2], window_time=[$4], EXPR$5=[$5], EXPR$6=[$6], EXPR$7=[$7], wAvg=[$8], uv=[$9])
 +- LogicalAggregate(group=[{0, 1, 2, 3, 4}], EXPR$5=[COUNT()], EXPR$6=[SUM($5)], EXPR$7=[MAX($5) FILTER $6], wAvg=[weightedAvg($7, $8)], uv=[COUNT(DISTINCT $9)])
-   +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], ws=[$7], window_time=[$9], d=[$3], $f6=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
-      +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], ws=[$10], window_time=[$9], d=[$3], $f6=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], ws=[$7])
+         +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -2445,12 +2458,13 @@ GROUP BY a, window_start, window_end, ws, window_time
       <![CDATA[
 LogicalProject(a=[$0], window_start=[$1], ws=[$3], window_end=[$2], window_time=[$4], EXPR$5=[$5], EXPR$6=[$6], EXPR$7=[$7], wAvg=[$8], uv=[$9])
 +- LogicalAggregate(group=[{0, 1, 2, 3, 4}], EXPR$5=[COUNT()], EXPR$6=[SUM($5)], EXPR$7=[MAX($5) FILTER $6], wAvg=[weightedAvg($7, $8)], uv=[COUNT(DISTINCT $9)])
-   +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], ws=[$7], window_time=[$9], d=[$3], $f6=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
-      +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
-            +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
-               +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+   +- LogicalProject(a=[$0], window_start=[$7], window_end=[$8], ws=[$10], window_time=[$9], d=[$3], $f6=[IS TRUE(>($1, 1000))], b=[$1], e=[$4], c=[$2])
+      +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6], window_start=[$7], window_end=[$8], window_time=[$9], ws=[$7])
+         +- LogicalTableFunctionScan(invocation=[TUMBLE($6, DESCRIPTOR($5), 900000:INTERVAL MINUTE)], rowType=[RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, DECIMAL(10, 3) d, BIGINT e, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+            +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[$6])
+               +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($5, 1000:INTERVAL SECOND)])
+                  +- LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4], rowtime=[$5], proctime=[PROCTIME()])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/LookupJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/LookupJoinTest.xml
index 1ca9c2545c2..4af9d167195 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/LookupJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/LookupJoinTest.xml
@@ -467,14 +467,15 @@ GROUP BY b
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)], EXPR$2=[SUM($2)], EXPR$3=[SUM($3)])
 +- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3])
-   +- LogicalFilter(condition=[>($7, 10)])
-      +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1, 4}])
-         :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proc=[PROCTIME()])
-         :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
-         :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-         +- LogicalFilter(condition=[=($cor0.a, $0)])
-            +- LogicalSnapshot(period=[$cor0.proc])
-               +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
+   +- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3], proc=[$4])
+      +- LogicalFilter(condition=[>($7, 10)])
+         +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1, 4}])
+            :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proc=[PROCTIME()])
+            :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
+            :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+            +- LogicalFilter(condition=[=($cor0.a, $0)])
+               +- LogicalSnapshot(period=[$cor0.proc])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
@@ -511,14 +512,15 @@ GROUP BY b
       <![CDATA[
 LogicalAggregate(group=[{0}], EXPR$1=[COUNT($1)], EXPR$2=[SUM($2)], EXPR$3=[SUM($3)])
 +- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3])
-   +- LogicalFilter(condition=[>($7, 10)])
-      +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1, 4}])
-         :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proc=[PROCTIME()])
-         :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
-         :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
-         +- LogicalFilter(condition=[=($cor0.a, $0)])
-            +- LogicalSnapshot(period=[$cor0.proc])
-               +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable, source: [TestTemporalTable(id, name, age)]]])
+   +- LogicalProject(b=[$0], a=[$1], c=[$2], d=[$3], proc=[$4])
+      +- LogicalFilter(condition=[>($7, 10)])
+         +- LogicalCorrelate(correlation=[$cor0], joinType=[inner], requiredColumns=[{1, 4}])
+            :- LogicalProject(b=[$1], a=[$0], c=[$2], d=[$3], proc=[PROCTIME()])
+            :  +- LogicalAggregate(group=[{0, 1}], c=[SUM($2)], d=[SUM($3)])
+            :     +- LogicalTableScan(table=[[default_catalog, default_database, T1]])
+            +- LogicalFilter(condition=[=($cor0.a, $0)])
+               +- LogicalSnapshot(period=[$cor0.proc])
+                  +- LogicalTableScan(table=[[default_catalog, default_database, LookupTable, source: [TestTemporalTable(id, name, age)]]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/SemiAntiJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/SemiAntiJoinTest.xml
index 57a7b48adda..eac4344357f 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/SemiAntiJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/SemiAntiJoinTest.xml
@@ -1375,11 +1375,13 @@ SELECT c FROM l WHERE a IN
 LogicalProject(c=[$2])
 +- LogicalFilter(condition=[IN($0, {
 LogicalProject(d=[$0])
-  LogicalJoin(condition=[=($1, $4)], joinType=[full])
-    LogicalTableScan(table=[[default_catalog, default_database, r, source: [TestTableSource(d, e, f)]]])
-    LogicalProject(i=[$0], i0=[CAST($0):BIGINT])
-      LogicalFilter(condition=[>($0, 10)])
-        LogicalTableScan(table=[[default_catalog, default_database, t, source: [TestTableSource(i, j, k)]]])
+  LogicalProject(d=[$0], e=[$1], f=[$2], i=[$3])
+    LogicalJoin(condition=[=($1, $4)], joinType=[full])
+      LogicalTableScan(table=[[default_catalog, default_database, r, source: [TestTableSource(d, e, f)]]])
+      LogicalProject(i=[$0], i0=[CAST($0):BIGINT])
+        LogicalProject(i=[$0])
+          LogicalFilter(condition=[>($0, 10)])
+            LogicalTableScan(table=[[default_catalog, default_database, t, source: [TestTableSource(i, j, k)]]])
 })])
    +- LogicalTableScan(table=[[default_catalog, default_database, l, source: [TestTableSource(a, b, c)]]])
 ]]>
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/TemporalJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/TemporalJoinTest.xml
index f809e5b9c24..df38c1a2dcd 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/TemporalJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/TemporalJoinTest.xml
@@ -549,8 +549,9 @@ LogicalProject(amount=[$0], currency=[$1], rowtime=[$2], proctime=[$3], currency
       +- LogicalSnapshot(period=[$cor0.proctime])
          +- LogicalProject(currency=[$0], rate=[$1], proctime=[$2])
             +- LogicalFilter(condition=[=($3, 1)])
-               +- LogicalProject(currency=[$0], rate=[$1], proctime=[PROCTIME()], rowNum=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY PROCTIME() DESC NULLS LAST)])
-                  +- LogicalTableScan(table=[[default_catalog, default_database, RatesOnly]])
+               +- LogicalProject(currency=[$0], rate=[$1], proctime=[$2], rowNum=[ROW_NUMBER() OVER (PARTITION BY $0 ORDER BY $2 DESC NULLS LAST)])
+                  +- LogicalProject(currency=[$0], rate=[$1], proctime=[PROCTIME()])
+                     +- LogicalTableScan(table=[[default_catalog, default_database, RatesOnly]])
 ]]>
     </Resource>
     <Resource name="optimized exec plan">
diff --git a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/WindowJoinTest.xml b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/WindowJoinTest.xml
index f94791d3b5a..5c90457b64e 100644
--- a/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/WindowJoinTest.xml
+++ b/flink-table/flink-table-planner/src/test/resources/org/apache/flink/table/planner/plan/stream/sql/join/WindowJoinTest.xml
@@ -161,36 +161,38 @@ WindowJoin(leftWindow=[TUMBLE(win_start=[window_start], win_end=[window_end], si
     <Resource name="ast">
       <![CDATA[
 LogicalSink(table=[default_catalog.default_database.sink1], fields=[window_start, window_end, user_id, dt, hour])
-+- LogicalProject(window_start=[$1], window_end=[$2], user_id=[$0], dt=[DATE_FORMAT(+($2, 25200000:INTERVAL HOUR), _UTF-16LE'yyyyMMdd')], hour=[DATE_FORMAT(+($2, 25200000:INTERVAL HOUR), _UTF-16LE'HH')])
-   +- LogicalJoin(condition=[AND(=($0, $3), =($1, $4), =($2, $5))], joinType=[left])
-      :- LogicalAggregate(group=[{0, 1, 2}])
-      :  +- LogicalProject(user_id=[$0], window_start=[$4], window_end=[$5])
-      :     +- LogicalTableFunctionScan(invocation=[TUMBLE($3, DESCRIPTOR($3), 60000:INTERVAL MINUTE)], rowType=[RecordType(VARCHAR(2147483647) user_id, VARCHAR(2147483647) order_id, INTEGER amount, TIMESTAMP(3) *ROWTIME* event_time, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      :        +- LogicalProject(user_id=[$0], order_id=[$1], amount=[$2], event_time=[$3])
-      :           +- LogicalWatermarkAssigner(rowtime=[event_time], watermark=[$3])
-      :              +- LogicalTableScan(table=[[default_catalog, default_database, food_order]])
-      +- LogicalAggregate(group=[{0, 1, 2}])
-         +- LogicalProject(user_id=[$0], window_start=[$4], window_end=[$5])
-            +- LogicalTableFunctionScan(invocation=[TUMBLE($3, DESCRIPTOR($3), 60000:INTERVAL MINUTE)], rowType=[RecordType(VARCHAR(2147483647) user_id, VARCHAR(2147483647) order_id, INTEGER amount, TIMESTAMP(3) *ROWTIME* event_time, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-               +- LogicalProject(user_id=[$0], order_id=[$1], amount=[$2], event_time=[$3])
-                  +- LogicalWatermarkAssigner(rowtime=[event_time], watermark=[$3])
-                     +- LogicalTableScan(table=[[default_catalog, default_database, food_order]])
++- LogicalProject(window_start=[$0], window_end=[$1], user_id=[$2], dt=[$3], hour=[$4])
+   +- LogicalProject(window_start=[$1], window_end=[$2], user_id=[$0], dt=[DATE_FORMAT(+($2, 25200000:INTERVAL HOUR), _UTF-16LE'yyyyMMdd')], hour=[DATE_FORMAT(+($2, 25200000:INTERVAL HOUR), _UTF-16LE'HH')])
+      +- LogicalJoin(condition=[AND(=($0, $3), =($1, $4), =($2, $5))], joinType=[left])
+         :- LogicalAggregate(group=[{0, 1, 2}])
+         :  +- LogicalProject(user_id=[$0], window_start=[$4], window_end=[$5])
+         :     +- LogicalTableFunctionScan(invocation=[TUMBLE($3, DESCRIPTOR($3), 60000:INTERVAL MINUTE)], rowType=[RecordType(VARCHAR(2147483647) user_id, VARCHAR(2147483647) order_id, INTEGER amount, TIMESTAMP(3) *ROWTIME* event_time, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+         :        +- LogicalProject(user_id=[$0], order_id=[$1], amount=[$2], event_time=[$3])
+         :           +- LogicalWatermarkAssigner(rowtime=[event_time], watermark=[$3])
+         :              +- LogicalTableScan(table=[[default_catalog, default_database, food_order]])
+         +- LogicalAggregate(group=[{0, 1, 2}])
+            +- LogicalProject(user_id=[$0], window_start=[$4], window_end=[$5])
+               +- LogicalTableFunctionScan(invocation=[TUMBLE($3, DESCRIPTOR($3), 60000:INTERVAL MINUTE)], rowType=[RecordType(VARCHAR(2147483647) user_id, VARCHAR(2147483647) order_id, INTEGER amount, TIMESTAMP(3) *ROWTIME* event_time, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+                  +- LogicalProject(user_id=[$0], order_id=[$1], amount=[$2], event_time=[$3])
+                     +- LogicalWatermarkAssigner(rowtime=[event_time], watermark=[$3])
+                        +- LogicalTableScan(table=[[default_catalog, default_database, food_order]])
 
 LogicalSink(table=[default_catalog.default_database.sink2], fields=[window_start, window_end, user_id, dt, hour])
-+- LogicalProject(window_start=[$1], window_end=[$2], user_id=[$0], dt=[DATE_FORMAT(+($2, 25200000:INTERVAL HOUR), _UTF-16LE'yyyyMMdd')], hour=[DATE_FORMAT(+($2, 25200000:INTERVAL HOUR), _UTF-16LE'HH')])
-   +- LogicalJoin(condition=[AND(=($0, $3), =($1, $4), =($2, $5))], joinType=[left])
-      :- LogicalAggregate(group=[{0, 1, 2}])
-      :  +- LogicalProject(user_id=[$0], window_start=[$4], window_end=[$5])
-      :     +- LogicalTableFunctionScan(invocation=[TUMBLE($3, DESCRIPTOR($3), 60000:INTERVAL MINUTE)], rowType=[RecordType(VARCHAR(2147483647) user_id, VARCHAR(2147483647) order_id, INTEGER amount, TIMESTAMP(3) *ROWTIME* event_time, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-      :        +- LogicalProject(user_id=[$0], order_id=[$1], amount=[$2], event_time=[$3])
-      :           +- LogicalWatermarkAssigner(rowtime=[event_time], watermark=[$3])
-      :              +- LogicalTableScan(table=[[default_catalog, default_database, food_order]])
-      +- LogicalAggregate(group=[{0, 1, 2}])
-         +- LogicalProject(user_id=[$0], window_start=[$4], window_end=[$5])
-            +- LogicalTableFunctionScan(invocation=[TUMBLE($3, DESCRIPTOR($3), 60000:INTERVAL MINUTE)], rowType=[RecordType(VARCHAR(2147483647) user_id, VARCHAR(2147483647) order_id, INTEGER amount, TIMESTAMP(3) *ROWTIME* event_time, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-               +- LogicalProject(user_id=[$0], order_id=[$1], amount=[$2], event_time=[$3])
-                  +- LogicalWatermarkAssigner(rowtime=[event_time], watermark=[$3])
-                     +- LogicalTableScan(table=[[default_catalog, default_database, food_order]])
++- LogicalProject(window_start=[$0], window_end=[$1], user_id=[$2], dt=[$3], hour=[$4])
+   +- LogicalProject(window_start=[$1], window_end=[$2], user_id=[$0], dt=[DATE_FORMAT(+($2, 25200000:INTERVAL HOUR), _UTF-16LE'yyyyMMdd')], hour=[DATE_FORMAT(+($2, 25200000:INTERVAL HOUR), _UTF-16LE'HH')])
+      +- LogicalJoin(condition=[AND(=($0, $3), =($1, $4), =($2, $5))], joinType=[left])
+         :- LogicalAggregate(group=[{0, 1, 2}])
+         :  +- LogicalProject(user_id=[$0], window_start=[$4], window_end=[$5])
+         :     +- LogicalTableFunctionScan(invocation=[TUMBLE($3, DESCRIPTOR($3), 60000:INTERVAL MINUTE)], rowType=[RecordType(VARCHAR(2147483647) user_id, VARCHAR(2147483647) order_id, INTEGER amount, TIMESTAMP(3) *ROWTIME* event_time, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+         :        +- LogicalProject(user_id=[$0], order_id=[$1], amount=[$2], event_time=[$3])
+         :           +- LogicalWatermarkAssigner(rowtime=[event_time], watermark=[$3])
+         :              +- LogicalTableScan(table=[[default_catalog, default_database, food_order]])
+         +- LogicalAggregate(group=[{0, 1, 2}])
+            +- LogicalProject(user_id=[$0], window_start=[$4], window_end=[$5])
+               +- LogicalTableFunctionScan(invocation=[TUMBLE($3, DESCRIPTOR($3), 60000:INTERVAL MINUTE)], rowType=[RecordType(VARCHAR(2147483647) user_id, VARCHAR(2147483647) order_id, INTEGER amount, TIMESTAMP(3) *ROWTIME* event_time, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+                  +- LogicalProject(user_id=[$0], order_id=[$1], amount=[$2], event_time=[$3])
+                     +- LogicalWatermarkAssigner(rowtime=[event_time], watermark=[$3])
+                        +- LogicalTableScan(table=[[default_catalog, default_database, food_order]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
@@ -2383,22 +2385,23 @@ WHERE rownum <= 3
       <![CDATA[
 LogicalProject(window_start=[$0], window_end=[$1], a=[$2], l_cnt=[$3], l_uv=[$4], r_cnt=[$5], r_uv=[$6], rownum=[$7])
 +- LogicalFilter(condition=[<=($7, 3)])
-   +- LogicalProject(window_start=[$1], window_end=[$2], a=[$0], l_cnt=[$4], l_uv=[$5], r_cnt=[$10], r_uv=[$11], rownum=[ROW_NUMBER() OVER (PARTITION BY $1, $2 ORDER BY $4 DESC NULLS LAST)])
-      +- LogicalJoin(condition=[AND(=($1, $7), =($2, $8), =($0, $6))], joinType=[inner])
-         :- LogicalAggregate(group=[{0, 1, 2, 3}], cnt=[COUNT()], uv=[COUNT(DISTINCT $4)])
-         :  +- LogicalProject(a=[$0], window_start=[$5], window_end=[$6], window_time=[$7], c=[$2])
-         :     +- LogicalTableFunctionScan(invocation=[CUMULATE($4, DESCRIPTOR($3), 600000:INTERVAL MINUTE, 3600000:INTERVAL HOUR)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-         :        +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4])
-         :           +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
-         :              +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
-         :                 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
-         +- LogicalAggregate(group=[{0, 1, 2, 3}], cnt=[COUNT()], uv=[COUNT(DISTINCT $4)])
-            +- LogicalProject(a=[$0], window_start=[$5], window_end=[$6], window_time=[$7], c=[$2])
-               +- LogicalTableFunctionScan(invocation=[CUMULATE($4, DESCRIPTOR($3), 600000:INTERVAL MINUTE, 3600000:INTERVAL HOUR)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
-                  +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4])
-                     +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
-                        +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
-                           +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
+   +- LogicalProject(window_start=[$0], window_end=[$1], a=[$2], l_cnt=[$3], l_uv=[$4], r_cnt=[$5], r_uv=[$6], rownum=[ROW_NUMBER() OVER (PARTITION BY $0, $1 ORDER BY $3 DESC NULLS LAST)])
+      +- LogicalProject(window_start=[$1], window_end=[$2], a=[$0], l_cnt=[$4], l_uv=[$5], r_cnt=[$10], r_uv=[$11])
+         +- LogicalJoin(condition=[AND(=($1, $7), =($2, $8), =($0, $6))], joinType=[inner])
+            :- LogicalAggregate(group=[{0, 1, 2, 3}], cnt=[COUNT()], uv=[COUNT(DISTINCT $4)])
+            :  +- LogicalProject(a=[$0], window_start=[$5], window_end=[$6], window_time=[$7], c=[$2])
+            :     +- LogicalTableFunctionScan(invocation=[CUMULATE($4, DESCRIPTOR($3), 600000:INTERVAL MINUTE, 3600000:INTERVAL HOUR)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+            :        +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4])
+            :           +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
+            :              +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
+            :                 +- LogicalTableScan(table=[[default_catalog, default_database, MyTable]])
+            +- LogicalAggregate(group=[{0, 1, 2, 3}], cnt=[COUNT()], uv=[COUNT(DISTINCT $4)])
+               +- LogicalProject(a=[$0], window_start=[$5], window_end=[$6], window_time=[$7], c=[$2])
+                  +- LogicalTableFunctionScan(invocation=[CUMULATE($4, DESCRIPTOR($3), 600000:INTERVAL MINUTE, 3600000:INTERVAL HOUR)], rowType=[RecordType(INTEGER a, VARCHAR(2147483647) b, BIGINT c, TIMESTAMP(3) *ROWTIME* rowtime, TIMESTAMP_LTZ(3) *PROCTIME* proctime, TIMESTAMP(3) window_start, TIMESTAMP(3) window_end, TIMESTAMP(3) *ROWTIME* window_time)])
+                     +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[$4])
+                        +- LogicalWatermarkAssigner(rowtime=[rowtime], watermark=[-($3, 1000:INTERVAL SECOND)])
+                           +- LogicalProject(a=[$0], b=[$1], c=[$2], rowtime=[$3], proctime=[PROCTIME()])
+                              +- LogicalTableScan(table=[[default_catalog, default_database, MyTable2]])
 ]]>
     </Resource>
     <Resource name="optimized rel plan">
diff --git a/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/batch/sql/RankTest.scala b/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/batch/sql/RankTest.scala
index 9c4eff755a7..bc18eebfe0b 100644
--- a/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/batch/sql/RankTest.scala
+++ b/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/batch/sql/RankTest.scala
@@ -47,11 +47,9 @@ class RankTest extends TableTestBase {
         |SELECT *
         |FROM (
         |  SELECT a, b,
-        |  ROW_NUMBER() OVER (PARTITION BY b ORDER BY key) AS row_num
-        |  FROM (
-        |  SELECT *, '2023-03-29' AS key
+        |  ROW_NUMBER() OVER (PARTITION BY b ORDER BY '2023-03-29') AS row_num
         |  FROM MyTable
-        |  ) tmp)
+        |)
         |WHERE row_num <= 10
       """.stripMargin
 
diff --git a/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/stream/sql/LegacySinkTest.scala b/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/stream/sql/LegacySinkTest.scala
index 074e6bde45a..9b066752afc 100644
--- a/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/stream/sql/LegacySinkTest.scala
+++ b/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/stream/sql/LegacySinkTest.scala
@@ -68,7 +68,7 @@ class LegacySinkTest extends TableTestBase {
     thrown.expect(classOf[TableException])
     thrown.expectMessage(
       "OverAggregate doesn't support consuming update changes " +
-        "which is produced by node GroupAggregate(groupBy=[a], select=[a, COUNT(*) AS cnt])")
+        "which is produced by node Calc(select=[cnt]")
     util.verifyRelPlan(stmtSet)
   }
 
diff --git a/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/stream/sql/TableSinkTest.scala b/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/stream/sql/TableSinkTest.scala
index 2b3a0c7f1e7..0df9269c97f 100644
--- a/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/stream/sql/TableSinkTest.scala
+++ b/flink-table/flink-table-planner/src/test/scala/org/apache/flink/table/planner/plan/stream/sql/TableSinkTest.scala
@@ -144,7 +144,7 @@ class TableSinkTest extends TableTestBase {
     thrown.expect(classOf[TableException])
     thrown.expectMessage(
       "OverAggregate doesn't support consuming update changes " +
-        "which is produced by node GroupAggregate(groupBy=[a], select=[a, COUNT(*) AS cnt])")
+        "which is produced by node Calc(select=[cnt])")
     util.verifyRelPlan(stmtSet, ExplainDetail.CHANGELOG_MODE)
   }
 
