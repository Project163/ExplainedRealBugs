diff --git a/flink-core/src/main/java/org/apache/flink/api/java/typeutils/RowTypeInfo.java b/flink-core/src/main/java/org/apache/flink/api/java/typeutils/RowTypeInfo.java
index 536bc7df214..9c5b174ae21 100644
--- a/flink-core/src/main/java/org/apache/flink/api/java/typeutils/RowTypeInfo.java
+++ b/flink-core/src/main/java/org/apache/flink/api/java/typeutils/RowTypeInfo.java
@@ -313,7 +313,7 @@ public class RowTypeInfo extends TupleTypeInfoBase<Row> {
         for (int i = 0; i < len; i++) {
             fieldSerializers[i] = types[i].createSerializer(config);
         }
-        return new RowSerializer(fieldSerializers, null, true);
+        return new RowSerializer(fieldSerializers, null, false);
     }
 
     /** Tests whether an other object describes the same, schema-equivalent row information. */
diff --git a/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/RowSerializer.java b/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/RowSerializer.java
index d9bfc677441..d5f62d8071a 100644
--- a/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/RowSerializer.java
+++ b/flink-core/src/main/java/org/apache/flink/api/java/typeutils/runtime/RowSerializer.java
@@ -77,9 +77,9 @@ public final class RowSerializer extends TypeSerializer<Row> {
     // legacy, don't touch until we drop support for 1.9 savepoints
     private static final long serialVersionUID = 1L;
 
-    private final boolean legacyModeEnabled;
+    private final boolean supportsRowKind;
 
-    private final int legacyOffset;
+    private final int rowKindOffset;
 
     private final TypeSerializer<Object>[] fieldSerializers;
 
@@ -92,26 +92,26 @@ public final class RowSerializer extends TypeSerializer<Row> {
     private transient Row reuseRowPositionBased;
 
     public RowSerializer(TypeSerializer<?>[] fieldSerializers) {
-        this(fieldSerializers, null, false);
+        this(fieldSerializers, null, true);
     }
 
     public RowSerializer(
             TypeSerializer<?>[] fieldSerializers,
             @Nullable LinkedHashMap<String, Integer> positionByName) {
-        this(fieldSerializers, positionByName, false);
+        this(fieldSerializers, positionByName, true);
     }
 
     @SuppressWarnings("unchecked")
     public RowSerializer(
             TypeSerializer<?>[] fieldSerializers,
             @Nullable LinkedHashMap<String, Integer> positionByName,
-            boolean legacyModeEnabled) {
-        this.legacyModeEnabled = legacyModeEnabled;
-        this.legacyOffset = legacyModeEnabled ? 0 : ROW_KIND_OFFSET;
+            boolean supportsRowKind) {
+        this.supportsRowKind = supportsRowKind;
+        this.rowKindOffset = supportsRowKind ? ROW_KIND_OFFSET : 0;
         this.fieldSerializers = (TypeSerializer<Object>[]) checkNotNull(fieldSerializers);
         this.arity = fieldSerializers.length;
         this.positionByName = positionByName;
-        this.mask = new boolean[legacyOffset + fieldSerializers.length];
+        this.mask = new boolean[rowKindOffset + fieldSerializers.length];
         this.reuseRowPositionBased = new Row(fieldSerializers.length);
     }
 
@@ -126,7 +126,7 @@ public final class RowSerializer extends TypeSerializer<Row> {
         for (int i = 0; i < fieldSerializers.length; i++) {
             duplicateFieldSerializers[i] = fieldSerializers[i].duplicate();
         }
-        return new RowSerializer(duplicateFieldSerializers, positionByName, legacyModeEnabled);
+        return new RowSerializer(duplicateFieldSerializers, positionByName, supportsRowKind);
     }
 
     @Override
@@ -296,7 +296,7 @@ public final class RowSerializer extends TypeSerializer<Row> {
         }
 
         // write bitmask
-        fillMask(length, record, mask, legacyModeEnabled, legacyOffset);
+        fillMask(length, record, mask, supportsRowKind, rowKindOffset);
         writeMask(mask, target);
 
         // serialize non-null fields
@@ -332,7 +332,7 @@ public final class RowSerializer extends TypeSerializer<Row> {
 
         // read row kind
         final RowKind kind;
-        if (legacyModeEnabled) {
+        if (!supportsRowKind) {
             kind = RowKind.INSERT;
         } else {
             kind = readKindFromMask(mask);
@@ -341,7 +341,7 @@ public final class RowSerializer extends TypeSerializer<Row> {
         // deserialize fields
         final Object[] fieldByPosition = new Object[length];
         for (int fieldPos = 0; fieldPos < length; fieldPos++) {
-            if (!mask[legacyOffset + fieldPos]) {
+            if (!mask[rowKindOffset + fieldPos]) {
                 fieldByPosition[fieldPos] = fieldSerializers[fieldPos].deserialize(source);
             }
         }
@@ -369,13 +369,13 @@ public final class RowSerializer extends TypeSerializer<Row> {
 
         // read bitmask
         readIntoMask(source, mask);
-        if (!legacyModeEnabled) {
+        if (supportsRowKind) {
             reuse.setKind(readKindFromMask(mask));
         }
 
         // deserialize fields
         for (int fieldPos = 0; fieldPos < length; fieldPos++) {
-            if (mask[legacyOffset + fieldPos]) {
+            if (mask[rowKindOffset + fieldPos]) {
                 reuse.setField(fieldPos, null);
             } else {
                 Object reuseField = reuse.getField(fieldPos);
@@ -400,7 +400,7 @@ public final class RowSerializer extends TypeSerializer<Row> {
 
         // copy non-null fields
         for (int fieldPos = 0; fieldPos < len; fieldPos++) {
-            if (!mask[legacyOffset + fieldPos]) {
+            if (!mask[rowKindOffset + fieldPos]) {
                 fieldSerializers[fieldPos].copy(source, target);
             }
         }
@@ -415,13 +415,13 @@ public final class RowSerializer extends TypeSerializer<Row> {
             return false;
         }
         RowSerializer that = (RowSerializer) o;
-        return legacyModeEnabled == that.legacyModeEnabled
+        return supportsRowKind == that.supportsRowKind
                 && Arrays.equals(fieldSerializers, that.fieldSerializers);
     }
 
     @Override
     public int hashCode() {
-        int result = Objects.hash(legacyModeEnabled);
+        int result = Objects.hash(supportsRowKind);
         result = 31 * result + Arrays.hashCode(fieldSerializers);
         return result;
     }
@@ -443,7 +443,7 @@ public final class RowSerializer extends TypeSerializer<Row> {
 
     private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException {
         in.defaultReadObject();
-        this.mask = new boolean[legacyOffset + fieldSerializers.length];
+        this.mask = new boolean[rowKindOffset + fieldSerializers.length];
         this.reuseRowPositionBased = new Row(fieldSerializers.length);
     }
 
@@ -452,15 +452,15 @@ public final class RowSerializer extends TypeSerializer<Row> {
     // --------------------------------------------------------------------------------------------
 
     private static void fillMask(
-            int fieldLength, Row row, boolean[] mask, boolean legacyModeEnabled, int legacyOffset) {
-        if (!legacyModeEnabled) {
+            int fieldLength, Row row, boolean[] mask, boolean supportsRowKind, int rowKindOffset) {
+        if (supportsRowKind) {
             final byte kind = row.getKind().toByteValue();
             mask[0] = (kind & 0x01) > 0;
             mask[1] = (kind & 0x02) > 0;
         }
 
         for (int fieldPos = 0; fieldPos < fieldLength; fieldPos++) {
-            mask[legacyOffset + fieldPos] = row.getField(fieldPos) == null;
+            mask[rowKindOffset + fieldPos] = row.getField(fieldPos) == null;
         }
     }
 
@@ -519,11 +519,11 @@ public final class RowSerializer extends TypeSerializer<Row> {
     public static final class RowSerializerSnapshot
             extends CompositeTypeSerializerSnapshot<Row, RowSerializer> {
 
-        private static final int VERSION = 3;
+        private static final int VERSION = 4;
 
-        private static final int LAST_VERSION_WITHOUT_ROW_KIND = 2;
+        private static final int FIRST_VERSION_WITH_ROW_KIND = 3;
 
-        private int readVersion = VERSION;
+        private boolean supportsRowKind = true;
 
         public RowSerializerSnapshot() {
             super(RowSerializer.class);
@@ -531,6 +531,7 @@ public final class RowSerializer extends TypeSerializer<Row> {
 
         RowSerializerSnapshot(RowSerializer serializerInstance) {
             super(serializerInstance);
+            this.supportsRowKind = serializerInstance.supportsRowKind;
         }
 
         @Override
@@ -540,14 +541,26 @@ public final class RowSerializer extends TypeSerializer<Row> {
 
         @Override
         protected void readOuterSnapshot(
-                int readOuterSnapshotVersion, DataInputView in, ClassLoader userCodeClassLoader) {
-            readVersion = readOuterSnapshotVersion;
+                int readOuterSnapshotVersion, DataInputView in, ClassLoader userCodeClassLoader)
+                throws IOException {
+            if (readOuterSnapshotVersion < FIRST_VERSION_WITH_ROW_KIND) {
+                supportsRowKind = false;
+            } else if (readOuterSnapshotVersion == FIRST_VERSION_WITH_ROW_KIND) {
+                supportsRowKind = true;
+            } else {
+                supportsRowKind = in.readBoolean();
+            }
+        }
+
+        @Override
+        protected void writeOuterSnapshot(DataOutputView out) throws IOException {
+            out.writeBoolean(supportsRowKind);
         }
 
         @Override
         protected OuterSchemaCompatibility resolveOuterSchemaCompatibility(
                 RowSerializer newSerializer) {
-            if (readVersion <= LAST_VERSION_WITHOUT_ROW_KIND) {
+            if (supportsRowKind != newSerializer.supportsRowKind) {
                 return OuterSchemaCompatibility.COMPATIBLE_AFTER_MIGRATION;
             }
             return OuterSchemaCompatibility.COMPATIBLE_AS_IS;
@@ -561,8 +574,7 @@ public final class RowSerializer extends TypeSerializer<Row> {
         @Override
         protected RowSerializer createOuterSerializerWithNestedSerializers(
                 TypeSerializer<?>[] nestedSerializers) {
-            return new RowSerializer(
-                    nestedSerializers, null, readVersion <= LAST_VERSION_WITHOUT_ROW_KIND);
+            return new RowSerializer(nestedSerializers, null, supportsRowKind);
         }
     }
 }
diff --git a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/TypeSerializerUpgradeTestBase.java b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/TypeSerializerUpgradeTestBase.java
index a69d1540303..0dbe642116a 100644
--- a/flink-core/src/test/java/org/apache/flink/api/common/typeutils/TypeSerializerUpgradeTestBase.java
+++ b/flink-core/src/test/java/org/apache/flink/api/common/typeutils/TypeSerializerUpgradeTestBase.java
@@ -292,7 +292,6 @@ public abstract class TypeSerializerUpgradeTestBase<PreviousElementT, UpgradedEl
                     restoredSerializerSnapshot.restoreSerializer();
             assertSerializerIsValid(
                     restoredSerializer,
-                    true,
                     dataUnderTest(),
                     testSpecification.verifier.testDataMatcher());
         }
@@ -346,10 +345,7 @@ public abstract class TypeSerializerUpgradeTestBase<PreviousElementT, UpgradedEl
 
             // .. and then assert that the upgraded serializer is valid with the migrated data
             assertSerializerIsValid(
-                    upgradedSerializer,
-                    false,
-                    migratedData,
-                    testSpecification.verifier.testDataMatcher());
+                    upgradedSerializer, migratedData, testSpecification.verifier.testDataMatcher());
         }
     }
 
@@ -373,7 +369,6 @@ public abstract class TypeSerializerUpgradeTestBase<PreviousElementT, UpgradedEl
                     upgradeCompatibility.getReconfiguredSerializer();
             assertSerializerIsValid(
                     reconfiguredUpgradedSerializer,
-                    false,
                     dataUnderTest(),
                     testSpecification.verifier.testDataMatcher());
         }
@@ -397,7 +392,6 @@ public abstract class TypeSerializerUpgradeTestBase<PreviousElementT, UpgradedEl
 
             assertSerializerIsValid(
                     upgradedSerializer,
-                    false,
                     dataUnderTest(),
                     testSpecification.verifier.testDataMatcher());
         }
@@ -420,20 +414,14 @@ public abstract class TypeSerializerUpgradeTestBase<PreviousElementT, UpgradedEl
      * </ul>
      */
     private static <T> void assertSerializerIsValid(
-            TypeSerializer<T> serializer,
-            boolean isRestoreSerializer,
-            DataInputView dataInput,
-            Matcher<T> testDataMatcher)
+            TypeSerializer<T> serializer, DataInputView dataInput, Matcher<T> testDataMatcher)
             throws Exception {
 
         DataInputView serializedData =
                 readAndThenWriteData(dataInput, serializer, serializer, testDataMatcher);
-        if (!isRestoreSerializer) {
-            TypeSerializerSnapshot<T> snapshot = writeAndThenReadSerializerSnapshot(serializer);
-            TypeSerializer<T> restoreSerializer = snapshot.restoreSerializer();
-            readAndThenWriteData(
-                    serializedData, restoreSerializer, restoreSerializer, testDataMatcher);
-        }
+        TypeSerializerSnapshot<T> snapshot = writeAndThenReadSerializerSnapshot(serializer);
+        TypeSerializer<T> restoreSerializer = snapshot.restoreSerializer();
+        readAndThenWriteData(serializedData, restoreSerializer, restoreSerializer, testDataMatcher);
     }
 
     // ------------------------------------------------------------------------------
diff --git a/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunction.java b/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunction.java
index f18f96a16ed..99ab2c6897d 100644
--- a/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunction.java
+++ b/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunction.java
@@ -929,11 +929,11 @@ public abstract class TwoPhaseCommitSinkFunction<IN, TXN, CONTEXT> extends RichS
             extends CompositeTypeSerializerSnapshot<
                     State<TXN, CONTEXT>, StateSerializer<TXN, CONTEXT>> {
 
-        private static final int VERSION = 3;
+        private static final int VERSION = 4;
 
         private static final int FIRST_VERSION_SUPPORTING_NULL_TRANSACTIONS = 3;
 
-        private int readVersion = VERSION;
+        private boolean supportsNullTransaction = true;
 
         @SuppressWarnings("WeakerAccess")
         public StateSerializerSnapshot() {
@@ -942,6 +942,7 @@ public abstract class TwoPhaseCommitSinkFunction<IN, TXN, CONTEXT> extends RichS
 
         StateSerializerSnapshot(StateSerializer<TXN, CONTEXT> serializerInstance) {
             super(serializerInstance);
+            this.supportsNullTransaction = serializerInstance.supportNullPendingTransaction;
         }
 
         @Override
@@ -953,13 +954,24 @@ public abstract class TwoPhaseCommitSinkFunction<IN, TXN, CONTEXT> extends RichS
         protected void readOuterSnapshot(
                 int readOuterSnapshotVersion, DataInputView in, ClassLoader userCodeClassLoader)
                 throws IOException {
-            readVersion = readOuterSnapshotVersion;
+            if (readOuterSnapshotVersion < FIRST_VERSION_SUPPORTING_NULL_TRANSACTIONS) {
+                supportsNullTransaction = false;
+            } else if (readOuterSnapshotVersion == FIRST_VERSION_SUPPORTING_NULL_TRANSACTIONS) {
+                supportsNullTransaction = true;
+            } else {
+                supportsNullTransaction = in.readBoolean();
+            }
+        }
+
+        @Override
+        protected void writeOuterSnapshot(DataOutputView out) throws IOException {
+            out.writeBoolean(supportsNullTransaction);
         }
 
         @Override
         protected OuterSchemaCompatibility resolveOuterSchemaCompatibility(
                 StateSerializer<TXN, CONTEXT> newSerializer) {
-            if (readVersion < FIRST_VERSION_SUPPORTING_NULL_TRANSACTIONS) {
+            if (supportsNullTransaction != newSerializer.supportNullPendingTransaction) {
                 return OuterSchemaCompatibility.COMPATIBLE_AFTER_MIGRATION;
             }
 
@@ -978,9 +990,7 @@ public abstract class TwoPhaseCommitSinkFunction<IN, TXN, CONTEXT> extends RichS
                     (TypeSerializer<CONTEXT>) nestedSerializers[1];
 
             return new StateSerializer<>(
-                    transactionSerializer,
-                    contextSerializer,
-                    readVersion >= FIRST_VERSION_SUPPORTING_NULL_TRANSACTIONS);
+                    transactionSerializer, contextSerializer, supportsNullTransaction);
         }
 
         @Override
diff --git a/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/typeutils/LinkedListSerializer.java b/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/typeutils/LinkedListSerializer.java
index ca0f3f90ec4..9fe9ba42e12 100644
--- a/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/typeutils/LinkedListSerializer.java
+++ b/flink-table/flink-table-runtime/src/main/java/org/apache/flink/table/runtime/typeutils/LinkedListSerializer.java
@@ -216,11 +216,11 @@ public final class LinkedListSerializer<T> extends TypeSerializer<LinkedList<T>>
     public static class LinkedListSerializerSnapshot<T>
             extends CompositeTypeSerializerSnapshot<LinkedList<T>, LinkedListSerializer<T>> {
 
-        private static final int CURRENT_VERSION = 2;
+        private static final int CURRENT_VERSION = 3;
 
         private static final int FIRST_VERSION_WITH_NULL_MASK = 2;
 
-        private int readVersion = CURRENT_VERSION;
+        private boolean hasNullMask = true;
 
         /** Constructor for read instantiation. */
         public LinkedListSerializerSnapshot() {
@@ -230,6 +230,7 @@ public final class LinkedListSerializer<T> extends TypeSerializer<LinkedList<T>>
         /** Constructor to create the snapshot for writing. */
         public LinkedListSerializerSnapshot(LinkedListSerializer<T> listSerializer) {
             super(listSerializer);
+            this.hasNullMask = listSerializer.hasNullMask;
         }
 
         @Override
@@ -239,14 +240,26 @@ public final class LinkedListSerializer<T> extends TypeSerializer<LinkedList<T>>
 
         @Override
         protected void readOuterSnapshot(
-                int readOuterSnapshotVersion, DataInputView in, ClassLoader userCodeClassLoader) {
-            readVersion = readOuterSnapshotVersion;
+                int readOuterSnapshotVersion, DataInputView in, ClassLoader userCodeClassLoader)
+                throws IOException {
+            if (readOuterSnapshotVersion < FIRST_VERSION_WITH_NULL_MASK) {
+                hasNullMask = false;
+            } else if (readOuterSnapshotVersion == FIRST_VERSION_WITH_NULL_MASK) {
+                hasNullMask = true;
+            } else {
+                hasNullMask = in.readBoolean();
+            }
+        }
+
+        @Override
+        protected void writeOuterSnapshot(DataOutputView out) throws IOException {
+            out.writeBoolean(hasNullMask);
         }
 
         @Override
         protected OuterSchemaCompatibility resolveOuterSchemaCompatibility(
                 LinkedListSerializer<T> newSerializer) {
-            if (readVersion < FIRST_VERSION_WITH_NULL_MASK) {
+            if (hasNullMask != newSerializer.hasNullMask) {
                 return OuterSchemaCompatibility.COMPATIBLE_AFTER_MIGRATION;
             }
             return OuterSchemaCompatibility.COMPATIBLE_AS_IS;
@@ -257,8 +270,7 @@ public final class LinkedListSerializer<T> extends TypeSerializer<LinkedList<T>>
                 TypeSerializer<?>[] nestedSerializers) {
             @SuppressWarnings("unchecked")
             TypeSerializer<T> elementSerializer = (TypeSerializer<T>) nestedSerializers[0];
-            return new LinkedListSerializer<>(
-                    elementSerializer, readVersion >= FIRST_VERSION_WITH_NULL_MASK);
+            return new LinkedListSerializer<>(elementSerializer, hasNullMask);
         }
 
         @Override
