diff --git a/flink-connectors/flink-connector-kinesis/src/test/java/org/apache/flink/streaming/connectors/kinesis/FlinkKinesisConsumerMigrationTest.java b/flink-connectors/flink-connector-kinesis/src/test/java/org/apache/flink/streaming/connectors/kinesis/FlinkKinesisConsumerMigrationTest.java
index c705de05b6a..1573783e4e5 100644
--- a/flink-connectors/flink-connector-kinesis/src/test/java/org/apache/flink/streaming/connectors/kinesis/FlinkKinesisConsumerMigrationTest.java
+++ b/flink-connectors/flink-connector-kinesis/src/test/java/org/apache/flink/streaming/connectors/kinesis/FlinkKinesisConsumerMigrationTest.java
@@ -327,14 +327,26 @@ public class FlinkKinesisConsumerMigrationTest {
 
 	@SuppressWarnings("unchecked")
 	private void writeSnapshot(String path, HashMap<StreamShardMetadata, SequenceNumber> state) throws Exception {
+		final List<StreamShardHandle> initialDiscoveryShards = new ArrayList<>(state.size());
+		for (StreamShardMetadata shardMetadata : state.keySet()) {
+			Shard shard = new Shard();
+			shard.setShardId(shardMetadata.getShardId());
+
+			SequenceNumberRange sequenceNumberRange = new SequenceNumberRange();
+			sequenceNumberRange.withStartingSequenceNumber("1");
+			shard.setSequenceNumberRange(sequenceNumberRange);
+
+			initialDiscoveryShards.add(new StreamShardHandle(shardMetadata.getStreamName(), shard));
+		}
+
 		final TestFetcher<String> fetcher = new TestFetcher<>(
 			Collections.singletonList(TEST_STREAM_NAME),
 			new TestSourceContext<>(),
 			new TestRuntimeContext(true, 1, 0),
-			new Properties(),
+			TestUtils.getStandardProperties(),
 			new KinesisDeserializationSchemaWrapper<>(new SimpleStringSchema()),
 			state,
-			null);
+			initialDiscoveryShards);
 
 		final DummyFlinkKinesisConsumer<String> consumer = new DummyFlinkKinesisConsumer<>(
 			fetcher, new KinesisDeserializationSchemaWrapper<>(new SimpleStringSchema()));
