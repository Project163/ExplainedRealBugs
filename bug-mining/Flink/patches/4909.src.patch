diff --git a/flink-core/src/main/java/org/apache/flink/api/connector/source/lib/util/IteratorSourceReader.java b/flink-core/src/main/java/org/apache/flink/api/connector/source/lib/util/IteratorSourceReader.java
index 92ab0543de6..d16e5970c5e 100644
--- a/flink-core/src/main/java/org/apache/flink/api/connector/source/lib/util/IteratorSourceReader.java
+++ b/flink-core/src/main/java/org/apache/flink/api/connector/source/lib/util/IteratorSourceReader.java
@@ -27,6 +27,7 @@ import javax.annotation.Nullable;
 
 import java.util.ArrayDeque;
 import java.util.ArrayList;
+import java.util.Collections;
 import java.util.Iterator;
 import java.util.List;
 import java.util.Queue;
@@ -129,8 +130,12 @@ public class IteratorSourceReader<E, IterT extends Iterator<E>, SplitT extends I
 
 	@Override
 	public List<SplitT> snapshotState(long checkpointId) {
+		if (remainingSplits == null) {
+			// no assignment yet
+			return Collections.emptyList();
+		}
 		final ArrayList<SplitT> allSplits = new ArrayList<>(1 + remainingSplits.size());
-		if (iterator != null) {
+		if (iterator != null && iterator.hasNext()) {
 			@SuppressWarnings("unchecked")
 			final SplitT inProgressSplit = (SplitT) currentSplit.getUpdatedSplitForIterator(iterator);
 			allSplits.add(inProgressSplit);
diff --git a/flink-tests/src/test/java/org/apache/flink/api/connector/source/lib/NumberSequenceSourceITCase.java b/flink-tests/src/test/java/org/apache/flink/api/connector/source/lib/NumberSequenceSourceITCase.java
new file mode 100644
index 00000000000..764fb6a8179
--- /dev/null
+++ b/flink-tests/src/test/java/org/apache/flink/api/connector/source/lib/NumberSequenceSourceITCase.java
@@ -0,0 +1,59 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *    http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.flink.api.connector.source.lib;
+
+import org.apache.flink.api.common.restartstrategy.RestartStrategies;
+import org.apache.flink.streaming.api.CheckpointingMode;
+import org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;
+import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;
+import org.apache.flink.streaming.util.StreamCollector;
+
+import org.junit.Rule;
+import org.junit.Test;
+
+import java.util.Collection;
+import java.util.concurrent.CompletableFuture;
+import java.util.stream.LongStream;
+
+import static org.junit.Assert.assertArrayEquals;
+
+/**
+ * Tests {@link NumberSequenceSource}.
+ */
+public class NumberSequenceSourceITCase {
+	@Rule
+	public StreamCollector collector = new StreamCollector();
+
+	@Test
+	public void testCheckpointingWithDelayedAssignment() throws Exception {
+		StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
+		env.setParallelism(1);
+		env.setRestartStrategy(new RestartStrategies.NoRestartStrategyConfiguration());
+		env.enableCheckpointing(10, CheckpointingMode.EXACTLY_ONCE);
+		final SingleOutputStreamOperator<Long> stream = env
+			.fromSequence(0, 100)
+			.map(x -> {
+				Thread.sleep(10);
+				return x;
+			});
+		final CompletableFuture<Collection<Long>> result = collector.collect(stream);
+		env.execute();
+
+		assertArrayEquals(LongStream.rangeClosed(0, 100).boxed().toArray(), result.get().toArray());
+	}
+}
