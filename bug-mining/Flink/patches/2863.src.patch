diff --git a/flink-core/src/main/java/org/apache/flink/util/InstantiationUtil.java b/flink-core/src/main/java/org/apache/flink/util/InstantiationUtil.java
index f4600a28122..644289133b2 100644
--- a/flink-core/src/main/java/org/apache/flink/util/InstantiationUtil.java
+++ b/flink-core/src/main/java/org/apache/flink/util/InstantiationUtil.java
@@ -43,6 +43,7 @@ import java.io.OutputStream;
 import java.io.Serializable;
 import java.lang.reflect.Constructor;
 import java.lang.reflect.Modifier;
+import java.lang.reflect.Proxy;
 import java.util.Collections;
 import java.util.HashMap;
 import java.util.HashSet;
@@ -91,6 +92,40 @@ public final class InstantiationUtil {
 			return super.resolveClass(desc);
 		}
 
+		@Override
+		protected Class<?> resolveProxyClass(String[] interfaces) throws IOException, ClassNotFoundException {
+			if (classLoader != null) {
+				ClassLoader nonPublicLoader = null;
+				boolean hasNonPublicInterface = false;
+
+				// define proxy in class loader of non-public interface(s), if any
+				Class<?>[] classObjs = new Class<?>[interfaces.length];
+				for (int i = 0; i < interfaces.length; i++) {
+					Class<?> cl = Class.forName(interfaces[i], false, classLoader);
+					if ((cl.getModifiers() & Modifier.PUBLIC) == 0) {
+						if (hasNonPublicInterface) {
+							if (nonPublicLoader != cl.getClassLoader()) {
+								throw new IllegalAccessError(
+									"conflicting non-public interface class loaders");
+							}
+						} else {
+							nonPublicLoader = cl.getClassLoader();
+							hasNonPublicInterface = true;
+						}
+					}
+					classObjs[i] = cl;
+				}
+				try {
+					return Proxy.getProxyClass(
+						hasNonPublicInterface ? nonPublicLoader : classLoader, classObjs);
+				} catch (IllegalArgumentException e) {
+					throw new ClassNotFoundException(null, e);
+				}
+			}
+
+			return super.resolveProxyClass(interfaces);
+		}
+
 		// ------------------------------------------------
 
 		private static final HashMap<String, Class<?>> primitiveClasses = new HashMap<>(9);
diff --git a/flink-core/src/test/java/org/apache/flink/util/InstantiationUtilTest.java b/flink-core/src/test/java/org/apache/flink/util/InstantiationUtilTest.java
index 0e8639109c7..3de393e7d89 100644
--- a/flink-core/src/test/java/org/apache/flink/util/InstantiationUtilTest.java
+++ b/flink-core/src/test/java/org/apache/flink/util/InstantiationUtilTest.java
@@ -23,15 +23,22 @@ import org.apache.flink.configuration.Configuration;
 import org.apache.flink.core.io.IOReadableWritable;
 import org.apache.flink.core.memory.DataInputView;
 import org.apache.flink.core.memory.DataOutputView;
+import org.apache.flink.testutils.ClassLoaderUtils;
 import org.apache.flink.types.DoubleValue;
 import org.apache.flink.types.StringValue;
 import org.apache.flink.types.Value;
 
+import org.junit.ClassRule;
 import org.junit.Test;
+import org.junit.rules.TemporaryFolder;
 
+import java.io.ByteArrayInputStream;
+import java.io.ByteArrayOutputStream;
 import java.io.IOException;
 import java.io.ObjectInputStream;
 import java.io.ObjectOutputStream;
+import java.io.Serializable;
+import java.net.URLClassLoader;
 import java.util.Objects;
 import java.util.Random;
 
@@ -46,6 +53,32 @@ import static org.junit.Assert.fail;
  */
 public class InstantiationUtilTest extends TestLogger {
 
+	@ClassRule
+	public static TemporaryFolder temporaryFolder = new TemporaryFolder();
+
+	@Test
+	public void testResolveProxyClass() throws Exception {
+
+		UserDefineFunctionImpl method = new UserDefineFunctionImpl();
+		final String className = "UserDefineFunctionImpl";
+		final URLClassLoader userClassLoader = ClassLoaderUtils.compileAndLoadJava(
+			temporaryFolder.newFolder(),
+			className + ".java",
+			"import java.io.Serializable;\n"
+				+ "interface UserDefineFunction { void test();}\n"
+				+ "public class " + className + " implements UserDefineFunction, Serializable {public void test() {} }");
+
+		ByteArrayOutputStream baos = new ByteArrayOutputStream();
+
+		InstantiationUtil.serializeObject(baos, method);
+
+		InstantiationUtil.ClassLoaderObjectInputStream cloi = new InstantiationUtil.ClassLoaderObjectInputStream(
+			new ByteArrayInputStream(baos.toByteArray()), userClassLoader);
+		cloi.resolveProxyClass(new String[]{"UserDefineFunction"});
+
+		userClassLoader.close();
+	}
+
 	@Test
 	public void testInstantiationOfStringValue() {
 		StringValue stringValue = InstantiationUtil.instantiate(
@@ -153,6 +186,17 @@ public class InstantiationUtilTest extends TestLogger {
 
 	// --------------------------------------------------------------------------------------------
 
+	interface UserDefineFunction extends Serializable {
+		void test();
+	}
+
+	private static class UserDefineFunctionImpl implements UserDefineFunction {
+		@Override
+		public void test() {
+
+		}
+	}
+
 	private class TestClass {}
 
 	private static class TestException extends IOException {
