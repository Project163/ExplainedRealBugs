diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/tasks/mailbox/MailboxExecutorImplTest.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/tasks/mailbox/MailboxExecutorImplTest.java
index 11b7b27f3e0..e18f28611d6 100644
--- a/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/tasks/mailbox/MailboxExecutorImplTest.java
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/runtime/tasks/mailbox/MailboxExecutorImplTest.java
@@ -82,14 +82,17 @@ public class MailboxExecutorImplTest {
 
     @Test
     public void testIsIdle() throws Exception {
-        MailboxProcessor processor = new MailboxProcessor();
+        MailboxProcessor processor =
+                new MailboxProcessor(MailboxDefaultAction.Controller::suspendDefaultAction);
         MailboxExecutorImpl executor =
                 (MailboxExecutorImpl) processor.getMailboxExecutor(DEFAULT_PRIORITY);
 
         assertFalse(executor.isIdle());
 
-        processor.runMailboxStep(); // suspend default action after suspension
-        processor.mailbox.drain(); // drop any control mails
+        processor.runMailboxStep(); // let the default action suspend mailbox
+        processor.allActionsCompleted();
+        // process allActionsCompleted() mail or any other remaining control mails
+        while (processor.runMailboxStep()) {}
 
         assertTrue(executor.isIdle());
 
