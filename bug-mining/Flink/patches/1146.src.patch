diff --git a/flink-core/src/main/java/org/apache/flink/core/memory/MemorySegmentFactory.java b/flink-core/src/main/java/org/apache/flink/core/memory/MemorySegmentFactory.java
index 882c37dcd91..1e5c3adb17c 100644
--- a/flink-core/src/main/java/org/apache/flink/core/memory/MemorySegmentFactory.java
+++ b/flink-core/src/main/java/org/apache/flink/core/memory/MemorySegmentFactory.java
@@ -22,13 +22,15 @@ import org.apache.flink.annotation.Internal;
 
 import java.nio.ByteBuffer;
 
+import static org.apache.flink.util.Preconditions.checkNotNull;
+
 /**
  * A factory for memory segments. The purpose of this factory is to make sure that all memory segments
  * for heap data are of the same type. That way, the runtime does not mix the various specializations
  * of the {@link org.apache.flink.core.memory.MemorySegment}. Not mixing them has shown to be beneficial
  * to method specialization by the JIT and to overall performance.
- * <p>
- * Note that this factory auto-initialized to use {@link org.apache.flink.core.memory.HeapMemorySegment},
+ * 
+ * <p>Note that this factory auto-initialized to use {@link org.apache.flink.core.memory.HeapMemorySegment},
  * if a request to create a segment comes before the initialization.
  */
 @Internal
@@ -36,7 +38,7 @@ public class MemorySegmentFactory {
 
 	/** The factory to use */
 	private static volatile Factory factory;
-	
+
 	/**
 	 * Creates a new memory segment that targets the given heap memory region.
 	 * This method should be used to turn short lived byte arrays into memory segments.
@@ -110,26 +112,28 @@ public class MemorySegmentFactory {
 		ensureInitialized();
 		return factory.wrapPooledOffHeapMemory(memory, owner);
 	}
-	
+
 	// ------------------------------------------------------------------------
-	
+
 	/**
-	 * Initializes this factory with the given concrete factory.
-	 * 
+	 * Initializes this factory with the given concrete factory, iff it is not yet initialized.
+	 * This also checks if the factory is already initialized to the exact same concrete factory
+	 * as given.
+	 *
 	 * @param f The concrete factory to use.
-	 * @throws java.lang.IllegalStateException Thrown, if this factory has been initialized before.
+	 * @return True, if the factory is initialized with the given concrete factory, or if it was already
+	 *         initialized with the exact same concrete factory. False, if it is already initialized with
+	 *         a different concrete factory.
 	 */
-	public static void initializeFactory(Factory f) {
-		if (f == null) {
-			throw new NullPointerException();
-		}
-	
+	public static boolean initializeIfNotInitialized(Factory f) {
+		checkNotNull(f);
+
 		synchronized (MemorySegmentFactory.class) {
 			if (factory == null) {
 				factory = f;
-			}
-			else {
-				throw new IllegalStateException("Factory has already been initialized");
+				return true;
+			} else {
+				return factory == f;
 			}
 		}
 	}
@@ -151,10 +155,17 @@ public class MemorySegmentFactory {
 	public static Factory getFactory() {
 		return factory;
 	}
-	
+
+	/**
+	 * Sets the factory to the {@link HeapMemorySegment#FACTORY} is no factory has been initialized, yet.
+	 */
 	private static void ensureInitialized() {
 		if (factory == null) {
-			factory = HeapMemorySegment.FACTORY;
+			synchronized (MemorySegmentFactory.class) {
+				if (factory == null) {
+					factory = HeapMemorySegment.FACTORY;
+				}
+			}
 		}
 	}
 
@@ -165,7 +176,7 @@ public class MemorySegmentFactory {
 	/**
 	 * A concrete factory for memory segments.
 	 */
-	public static interface Factory {
+	public interface Factory {
 
 		/**
 		 * Creates a new memory segment that targets the given heap memory region.
diff --git a/flink-core/src/test/java/org/apache/flink/core/memory/MemorySegmentFactoryTest.java b/flink-core/src/test/java/org/apache/flink/core/memory/MemorySegmentFactoryTest.java
new file mode 100644
index 00000000000..84105cf455a
--- /dev/null
+++ b/flink-core/src/test/java/org/apache/flink/core/memory/MemorySegmentFactoryTest.java
@@ -0,0 +1,62 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.flink.core.memory;
+
+import org.junit.Test;
+
+import java.lang.reflect.Field;
+
+import static org.junit.Assert.*;
+
+public class MemorySegmentFactoryTest {
+
+	@Test
+	public void testInitializationToHeapSegments() throws Exception {
+		clearSegmentFactory();
+
+		assertFalse(MemorySegmentFactory.isInitialized());
+		assertTrue(MemorySegmentFactory.initializeIfNotInitialized(HeapMemorySegment.FACTORY));
+		assertTrue(MemorySegmentFactory.isInitialized());
+
+		assertTrue(MemorySegmentFactory.initializeIfNotInitialized(HeapMemorySegment.FACTORY));
+		assertFalse(MemorySegmentFactory.initializeIfNotInitialized(HybridMemorySegment.FACTORY));
+
+		assertEquals(HeapMemorySegment.FACTORY, MemorySegmentFactory.getFactory());
+	}
+
+	@Test
+	public void testInitializationToOffHeapSegments() throws Exception {
+		clearSegmentFactory();
+
+		assertFalse(MemorySegmentFactory.isInitialized());
+		assertTrue(MemorySegmentFactory.initializeIfNotInitialized(HybridMemorySegment.FACTORY));
+		assertTrue(MemorySegmentFactory.isInitialized());
+
+		assertTrue(MemorySegmentFactory.initializeIfNotInitialized(HybridMemorySegment.FACTORY));
+		assertFalse(MemorySegmentFactory.initializeIfNotInitialized(HeapMemorySegment.FACTORY));
+
+		assertEquals(HybridMemorySegment.FACTORY, MemorySegmentFactory.getFactory());
+	}
+
+	private static void clearSegmentFactory() throws Exception {
+		Field factoryField = MemorySegmentFactory.class.getDeclaredField("factory");
+		factoryField.setAccessible(true);
+		factoryField.set(null, null);
+	}
+}
diff --git a/flink-runtime/src/main/scala/org/apache/flink/runtime/taskmanager/TaskManager.scala b/flink-runtime/src/main/scala/org/apache/flink/runtime/taskmanager/TaskManager.scala
index e732214ceec..5a95143fd6b 100644
--- a/flink-runtime/src/main/scala/org/apache/flink/runtime/taskmanager/TaskManager.scala
+++ b/flink-runtime/src/main/scala/org/apache/flink/runtime/taskmanager/TaskManager.scala
@@ -2054,19 +2054,13 @@ object TaskManager {
     // initialize the memory segment factory accordingly
     memType match {
       case MemoryType.HEAP =>
-        if (!MemorySegmentFactory.isInitialized()) {
-          MemorySegmentFactory.initializeFactory(HeapMemorySegment.FACTORY)
-        }
-        else if (MemorySegmentFactory.getFactory() != HeapMemorySegment.FACTORY) {
+        if (!MemorySegmentFactory.initializeIfNotInitialized(HeapMemorySegment.FACTORY)) {
           throw new Exception("Memory type is set to heap memory, but memory segment " +
             "factory has been initialized for off-heap memory segments")
         }
 
       case MemoryType.OFF_HEAP =>
-        if (!MemorySegmentFactory.isInitialized()) {
-          MemorySegmentFactory.initializeFactory(HybridMemorySegment.FACTORY)
-        }
-        else if (MemorySegmentFactory.getFactory() != HybridMemorySegment.FACTORY) {
+        if (!MemorySegmentFactory.initializeIfNotInitialized(HybridMemorySegment.FACTORY)) {
           throw new Exception("Memory type is set to off-heap memory, but memory segment " +
             "factory has been initialized for heap memory segments")
         }
